- en: Azure Security and Administration
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 安全性与管理
- en: Security is often one of main reasons why many organizations are postponing
    their move to the cloud. There are too many unknown factors; people don't understand
    how security is set up and often don't trust anyone with their data. "If it leaves
    our data center, then I don't know what is happening to it" is something I have
    heard often over the years.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 安全性常常是许多组织推迟迁移到云端的主要原因之一。原因在于存在太多未知因素；人们不理解安全性是如何设置的，且往往不信任任何人管理他们的数据。我常年听到的一句话是：“如果它离开了我们的数据中心，我就不知道它发生了什么。”
- en: The truth is that your data is probably far more secure in Azure than it could
    ever be in your local center. In this chapter, I'll try to explain how security
    in Azure is set up and remove any doubts about cloud security.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，你的数据在 Azure 中可能比在本地数据中心更为安全。在本章中，我将尽力解释 Azure 安全性是如何设置的，并消除关于云安全的疑虑。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Azure Active Directory multi-factor authentication
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory 多重身份验证
- en: Azure Network Security
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 网络安全
- en: Azure Firewall
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 防火墙
- en: Data encryption
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据加密
- en: Azure Key Vault
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 密钥保管库
- en: Azure Security Center
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 安全中心
- en: Advanced threat protection
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高级威胁防护
- en: Just-in-Time access
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按需访问
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'For this chapter you''ll need the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章需要以下内容：
- en: An Azure subscription
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 Azure 订阅
- en: PowerShell
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PowerShell
- en: Azure PowerShell
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure PowerShell
- en: Demystifying cloud security
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 揭开云安全的面纱
- en: So, how secure is Azure really? Let's start by saying very secure.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，Azure 真的有多安全呢？我们可以从非常安全开始说起。
- en: Microsoft is investing heavily in Azure, and particularly in Azure Security.
    Azure has extensive compliance offerings, including HIPAA, FFIEC, PCI DSS, ISO
    9001, and ISO 27001, just to name a few.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 微软正在大力投资 Azure，特别是在 Azure 安全性方面。Azure 提供了广泛的合规性服务，包括 HIPAA、FFIEC、PCI DSS、ISO
    9001 和 ISO 27001，仅举几例。
- en: Azure Security starts with physical security. Data center has dedicated security
    staff around the clock; everything is covered by cameras and alarms, and there
    are several layers of perimeter checks.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 安全性始于物理安全。数据中心有专门的安全人员全天候值守；所有区域都被摄像头和报警系统覆盖，且有多个外围检查层级。
- en: To enter the Azure data center, you need to pass several checkpoints and provide
    valid authentication and authorization. Authentication is done on multi-factor
    levels, and besides providing a PIN or password, you must pass biometric and card
    reader checks as well.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 要进入 Azure 数据中心，你需要通过多个检查点并提供有效的身份验证和授权。身份验证采用多因素认证，除了提供 PIN 或密码外，你还必须通过生物识别和卡片读取器检查。
- en: Everything within data centers is encrypted and secure. All data is encrypted
    at rest, and even if someone manages to steal a disk containing your data, it
    would be unusable. All data transferring is also encrypted per industry standards.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 数据中心内的所有内容都经过加密和保护。所有数据在静态时都被加密，即便有人设法偷走了含有你数据的磁盘，它也是无法使用的。所有数据传输也都按照行业标准进行加密。
- en: Another important part of data security is redundancy to ensure that data is
    never lost. The default redundancy in Azure is 3 (three). When you create a new
    resource, Azure VM for example, a disk is created with three copies. This ensures
    that data is always available, and even if one disk fails, there are an additional
    two copies. Redundant 3 is present even with backup power generators; if one fails,
    there are two additional backups.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 数据安全的另一个重要方面是冗余，以确保数据永远不会丢失。Azure 默认的冗余级别是 3（三个）。例如，当你创建一个新的资源，像是 Azure 虚拟机时，系统会创建一个有三个副本的磁盘。这保证了数据始终可用，即使其中一个磁盘发生故障，仍然有两个额外的副本。冗余
    3 同样适用于备份发电机；如果一个发生故障，还有两个备份。
- en: And even Microsoft is heavily involved in Azure Security; it's not enough to
    put your data into Azure for it to be safe. The partnership with Microsoft takes
    care of one part of security and provides various tools and services to help you
    stay secure. However, you are responsible for how you implement these tools and
    put them to use.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 即使微软也深度参与了 Azure 安全性，但仅仅将数据放入 Azure 并不足以确保它的安全。与微软的合作负责安全的一部分，并提供各种工具和服务来帮助你保持安全。然而，如何实施这些工具并将它们投入使用，仍然由你负责。
- en: Securing your identity
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保护你的身份
- en: Securing your identity is a very important part of IT security. Most data breaches
    happen as a result of social engineering or phishing attacks. So, in most cases,
    leaked credentials are responsible for breaches.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 保护你的身份是 IT 安全中非常重要的一部分。大多数数据泄露是由于社会工程学或钓鱼攻击所致。因此，在大多数情况下，泄露的凭证是导致数据泄露的主要原因。
- en: Azure Active Directory offers a few tools to improve security, and one that
    stands up is **multi-factor authentication** (**MFA**). MFA requires users to
    provide additional security authentication after signing in. After a user provides
    a username and password, additional action is required to prove their identity. Many
    different tools can be used for additional checks, like biometric readers or card
    readers, but the most popular tool is a mobile device. After signing in, a user
    receives a notification on their mobile device and needs to provide additional
    confirmation. Notifications can be in the form of a phone call (the user needs
    to provide a code during the call), a text message (a user receives a code that
    needs to be provided during login), or an application (connected to the user account
    and requires confirmation that the user is trying to log in).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Active Directory 提供了一些工具来提高安全性，其中最突出的一个是**多重身份验证**（**MFA**）。MFA 要求用户在登录后提供额外的安全身份验证。用户提供用户名和密码后，还需要进行额外的操作来证明身份。可以使用许多不同的工具进行附加检查，如生物识别读卡器或卡片读卡器，但最常用的工具是移动设备。登录后，用户会在移动设备上收到通知，并需要提供额外的确认。通知可以通过电话（用户需要在通话中提供代码）、短信（用户收到需要在登录时提供的代码）或应用程序（与用户账户连接，并需要确认用户正在尝试登录）进行。
- en: When MFA is enabled, leaked credentials are less of a concern, as stealing a
    username and password is not enough to access data anymore. Access to a user's
    mobile device is required to authorize your sign-in attempt, and this makes data
    breaching much harder.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 MFA 后，泄露的凭据不再那么令人担忧，因为窃取用户名和密码已不足以访问数据。需要访问用户的移动设备以授权你的登录尝试，这使得数据泄露变得更加困难。
- en: Enabling multi-factor authentication
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用多重身份验证
- en: 'Enabling MFA in Azure Active Directory is simple and fast. In Azure Active
    Directory, under User management you need to select Multi-Factor Authentication.
    An example is shown in the screenshot:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure Active Directory 中启用 MFA 非常简单和快速。在 Azure Active Directory 中，在**用户管理**下需要选择多重身份验证。截图中展示了一个示例：
- en: '![](img/d7072359-f3db-423f-bf95-142b5e799985.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d7072359-f3db-423f-bf95-142b5e799985.png)'
- en: 'A new window will open in which all MFA is done. Here, you can set up individual
    user settings or do bulk updates for multiple users. Under Service settings, you
    can also edit what options are available for MFA and choose between a phone call,
    text message, mobile app, or token. To enable a single user for MFA, select the
    user and click Enable in the settings on the right side, as shown:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 一个新窗口会打开，在其中完成所有的 MFA 设置。你可以为单个用户设置个性化的设置，或者批量更新多个用户。在服务设置下，你还可以编辑 MFA 可用的选项，并选择电话、短信、移动应用或令牌。要启用单个用户的
    MFA，选择该用户并在右侧的设置中点击启用，如下所示：
- en: '![](img/32bbd793-cc46-41ee-9d99-932f4fcadf67.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](img/32bbd793-cc46-41ee-9d99-932f4fcadf67.png)'
- en: MFA is free for users with the global administrator role. So, there is no excuse
    for not adding an additional layer of security for admins as a leaked admin account
    can do far more damage than a regular user. However, if you want to enable MFA
    for all users, then an additional license is required. MFA comes with Azure Active
    Directory Premium, but can be licensed as a standalone service per user or per
    login.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有全局管理员角色的用户可以免费使用 MFA。因此，对于管理员来说，没有理由不添加额外的安全层，因为泄露的管理员账户可能造成的损害远超过普通用户。然而，如果你想为所有用户启用
    MFA，则需要额外的许可证。MFA 随 Azure Active Directory Premium 提供，但也可以按用户或每次登录为独立服务进行授权。
- en: Other identity security options
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他身份安全选项
- en: Azure Active Directory offers other services that can help you increase security.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Active Directory 还提供其他可以帮助你增强安全性的服务。
- en: Other service such as conditional access or privileged identity management can
    help us increase security and prevent unauthorized access. We can use audit logs
    and risky sign-ins to review who tried to access services and data and when. There
    are extensive Azure Active Directory logs that can be used for audits as well.
    Most of these features come with AAD Premium and aren't available with a basic
    or free license.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 其他服务如条件访问或特权身份管理可以帮助我们提高安全性并防止未经授权的访问。我们可以使用审计日志和风险性登录来查看谁尝试访问服务和数据以及何时访问。Azure
    Active Directory 提供了大量的日志，可以用于审计。大部分这些功能都需要 AAD Premium，并且在基础版或免费版许可证中不可用。
- en: Securing the network
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保护网络
- en: The next step in staying secure is securing our network resources. Leaving a
    network unprotected can result in data breaches or service denial. Even the Azure
    networking stack comes with lots of security features, such as default DDOS protection
    or network security groups; sometimes this is not enough and we need to take additional
    steps.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 保持安全的下一步是保护我们的网络资源。如果网络没有保护，可能会导致数据泄露或服务拒绝。即使Azure网络堆栈提供了许多安全功能，例如默认的DDOS保护或网络安全组，有时这些也不够，我们需要采取额外的措施。
- en: Azure Firewall
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Firewall
- en: Azure Firewall is a managed, cloud-based network security service that protects
    Azure Virtual Network resources. It is Firewall as a Service with built-in high
    availability and scalability.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Firewall是一个托管的、基于云的网络安全服务，保护Azure虚拟网络资源。它是一个作为服务提供的防火墙，内置高可用性和可扩展性。
- en: With Azure Firewall, you can create, enforce, and log application and network
    connectivity policies. Static public IP addresses for your virtual network resources
    allow outside firewalls to identify traffic originating from your virtual network.
    The service is integrated with Azure Monitor for logging and analytics.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Azure Firewall，您可以创建、执行和记录应用程序及网络连接策略。为虚拟网络资源分配的静态公共IP地址可以让外部防火墙识别来自您的虚拟网络的流量。该服务与Azure
    Monitor集成，用于日志记录和分析。
- en: Preparing the environment
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备环境
- en: Azure Firewall requires you to be connected to a subnet named AzureFirewallSubnet.
    We can create a new Azure VNet and a new subnet in the process of creating new
    Azure Firewall. But as I already have the VNet that I want to use, I'll add a
    new subnet to `PackVnet`, which was previously created.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Firewall要求连接到一个名为AzureFirewallSubnet的子网。我们可以在创建新的Azure Firewall过程中创建一个新的Azure
    VNet和子网。但由于我已经有了想要使用的VNet，我将向之前创建的`PackVnet`中添加一个新的子网。
- en: 'An example of how to add a new subnet for Azure Firewall is shown in the following
    screenshot:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了如何为Azure Firewall添加新子网的示例：
- en: '![](img/cdefc1e3-463f-436c-869f-04d06174824f.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cdefc1e3-463f-436c-869f-04d06174824f.png)'
- en: Creating an Azure Firewall
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建Azure Firewall
- en: 'To create a new Azure Firewall, we need to provide a Subscription, Resource
    group, Name, and Location. Additionally, we need to provide a Virtual network
    and Public IP address. In both cases, we can Use existing resources or Create
    new ones. Note that for the existing virtual network, `AzureFirewallSubnet` must
    exist. Example parameters are shown in the screenshot:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个新的Azure Firewall，我们需要提供订阅、资源组、名称和位置。此外，还需要提供虚拟网络和公共IP地址。在这两种情况下，我们可以选择使用现有资源或创建新资源。请注意，对于现有虚拟网络，必须存在`AzureFirewallSubnet`。示例参数如截图所示：
- en: '![](img/009801d9-757d-439e-865c-5506e2448322.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/009801d9-757d-439e-865c-5506e2448322.png)'
- en: After the deployment is finished, Azure Firewall is ready for use and we can
    start the configuration. For now, take note of the Private IP address (remember
    it or write it down), as we are going to need it in the next few steps.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 部署完成后，Azure Firewall已准备好使用，我们可以开始配置。此时，请注意私有IP地址（记住它或写下来），因为我们将在接下来的几个步骤中使用它。
- en: 'The Azure Firewall blade is shown in the following screenshot:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是Azure Firewall面板的截图：
- en: '![](img/bd63d41f-4b2c-40d9-9377-a6b062c8972e.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bd63d41f-4b2c-40d9-9377-a6b062c8972e.png)'
- en: To deploy Azure Firewall, we can use ARM templates as well.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以使用ARM模板来部署Azure Firewall。
- en: 'Here is the ARM template to deploy a new Azure Firewall:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是部署新Azure Firewall的ARM模板：
- en: '[PRE0]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Azure Route Table
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Route Table
- en: 'Now we want to create a route table that will direct all traffic through Azure
    Firewall. To create a new Azure Route Table, we need to provide a Name, Subscription,
    Resource group, and Location. Optionally, we can enable or disable BGP route propagation.
    An example of how to create a new route table is shown in the following screenshot:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们要创建一个路由表，将所有流量通过Azure Firewall。要创建一个新的Azure路由表，我们需要提供名称、订阅、资源组和位置。我们还可以选择启用或禁用BGP路由传播。以下截图展示了如何创建新的路由表：
- en: '![](img/2d75d61e-157b-446d-921f-5767afa60650.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2d75d61e-157b-446d-921f-5767afa60650.png)'
- en: 'After the route table is created, we need to associate it with a subnet and
    create a route. Under the Subnets option in the route table blade, select Associate,
    as shown:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建路由表后，我们需要将其与子网关联并创建路由。在路由表面板的子网选项下，选择“关联”，如图所示：
- en: '![](img/47884909-abd2-4f4c-92f3-daf9173e12e5.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/47884909-abd2-4f4c-92f3-daf9173e12e5.png)'
- en: 'To associate a route table with a subnet, we need to provide a Virtual network
    and Subnet in that network. In the following example, the Virtual network PacktVnet
    is selected and the Subnet is default:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 要将路由表与子网关联，我们需要提供虚拟网络和该网络中的子网。在以下示例中，选择了虚拟网络 PacktVnet，子网为默认子网：
- en: '![](img/d2cdb8cd-26bc-4e40-a83a-9d5f37aa9a39.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d2cdb8cd-26bc-4e40-a83a-9d5f37aa9a39.png)'
- en: 'Finally, we need to add a route. We need to provide a Route name, Address prefix,
    Next hop type, and Next hop address. For the Next hop type, we need to select
    Virtual appliance. Azure Firewall is a Firewall as a Service, but it still falls
    under this category. To create a similar effect, we could use any virtual appliance
    in which we would use third-party firewalls in IaaS mode. Under Next hop address,
    we enter the private IP address of our Azure Firewall (I previously mentioned
    that you needed to remember this address). An example of route settings is shown
    in the following screenshot:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要添加一条路由。我们需要提供路由名称、地址前缀、下一跳类型和下一跳地址。对于下一跳类型，我们需要选择虚拟设备。Azure 防火墙作为服务（Firewall
    as a Service），但仍属于这一类别。为了实现类似效果，我们可以使用任何虚拟设备，在其中使用 IaaS 模式的第三方防火墙。在下一跳地址下，我们输入
    Azure 防火墙的私有 IP 地址（我之前提到过，您需要记住这个地址）。路由设置的示例如下所示：
- en: '![](img/2945731a-cb3c-444c-8672-18d95d6c0963.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2945731a-cb3c-444c-8672-18d95d6c0963.png)'
- en: All traffic from the default subnet in the `PacktVnet` virtual network is now
    routed to our Azure Firewall. We can proceed and create rules on what will be
    allowed or denied.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 来自`PacktVnet`虚拟网络默认子网的所有流量现在都被路由到我们的 Azure 防火墙。我们可以继续并创建规则，决定允许或拒绝的内容。
- en: Configuring Azure Firewall
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 Azure 防火墙
- en: 'Under Rules in the Azure Firewall blade, we have three options: NAT rule collection,
    Network rule collection, and Application rule collection. Depending on what we
    want to achieve, we can use NAT rules to rewrite the source address. We can use
    network rules to define traffic from what source is allowed to go to what target,
    or with application rules we can define FQDNs that are allowed or denied. An example
    of the Rules blade in Azure Firewall is shown here:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 防火墙面板中的规则下，我们有三个选项：NAT 规则集合、网络规则集合和应用规则集合。根据我们的需求，可以使用 NAT 规则重写源地址。我们可以使用网络规则定义允许哪些源流量到达哪些目标，或者通过应用规则定义允许或拒绝的
    FQDN。Azure 防火墙中规则面板的示例如下所示：
- en: '![](img/bb40fad8-666f-4a33-b773-1398804379dc.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bb40fad8-666f-4a33-b773-1398804379dc.png)'
- en: Let's create a rule that will allow for traffic from the default subnet to VSTS.
    First, we need to provide a Name, Priority, and Action (Allow or Deny). Then we
    need to define SOURCE ADDRESSES, a PROTOCOL:PORT, and TARGET FQDNS. Optionally,
    we can add tags to our rule. For the SOURCE ADDRESSES, I'll add a subnet, as I
    want VSTS to be reached from anywhere on the subnet. You can use a smaller scope
    of IP addresses if you want to restrict where FQDN can be reached from.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一条规则，允许默认子网的流量访问 VSTS。首先，我们需要提供名称、优先级和动作（允许或拒绝）。然后，我们需要定义源地址、协议：端口和目标 FQDN。可选地，我们可以为规则添加标签。对于源地址，我将添加一个子网，因为我希望从子网中的任何地方都能访问
    VSTS。如果您希望限制 FQDN 的访问来源，可以使用更小范围的 IP 地址。
- en: 'The protocol will be HTTP and HTTPS and the TARGET FQDNS is `*.visualstudio.com`.
    An example of a new application rule is shown here:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 协议将是 HTTP 和 HTTPS，目标 FQDN 为 `*.visualstudio.com`。新的应用规则示例如下所示：
- en: '![](img/1466506a-541e-47b0-9b46-2241aaa2f216.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1466506a-541e-47b0-9b46-2241aaa2f216.png)'
- en: Note that you can have more than one rule in a collection and you can create
    all rules that apply to a specific service in a single collection. This makes
    it easier to manage and maintain Azure Firewall rules.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，您可以在一个集合中拥有多个规则，并且可以将适用于特定服务的所有规则创建在一个集合中。这使得管理和维护 Azure 防火墙规则变得更加容易。
- en: If everything is configured correctly, you can go to VM, located in the default
    subnet, and open any browser. You should be able to access any VSTS collection,
    but nothing else will be allowed.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切配置正确，您可以进入位于默认子网中的虚拟机（VM），并打开任何浏览器。您应该能够访问任何 VSTS 集合，但其他任何内容都将被禁止访问。
- en: Other network security options
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他网络安全选项
- en: 'Besides using default Azure components such as NSG, route tables, or even Azure
    Firewall, there are a number of third-party firewalls that are available as virtual
    appliances. Virtual appliances are set up as Azure VMs, and most industry leaders
    in network security are available in Azure. Managing virtual appliances has two
    components: managing Azure VM and managing firewalls. We already talked about
    managing Azure VMs, and managing firewalls depends on the manufacturer and isn''t
    any different than managing those firewalls on-premises.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用默认的Azure组件，如NSG、路由表，甚至Azure防火墙之外，还有许多作为虚拟设备提供的第三方防火墙。虚拟设备作为Azure虚拟机（VM）设置，网络安全领域的大多数行业领导者都可以在Azure上使用。管理虚拟设备包括两个部分：管理Azure虚拟机和管理防火墙。我们已经讨论过如何管理Azure虚拟机，至于防火墙的管理则取决于制造商，和在本地管理这些防火墙没有什么不同。
- en: Other than that, we can collect logs from our network resources with Azure Monitor
    and Log Analytics to help us audit and troubleshoot Azure Network. There is another
    tool that can help us monitor Azure Network, which is called Network Watcher. Azure
    Network Watcher provides tools to monitor, diagnose, view metrics, and enable
    or disable logs for resources in an Azure virtual network.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 除此之外，我们可以通过Azure Monitor和Log Analytics收集网络资源的日志，帮助我们审核和故障排除Azure网络。还有一个工具可以帮助我们监控Azure网络，它被称为Network
    Watcher。Azure Network Watcher提供了监控、诊断、查看指标并启用或禁用虚拟网络资源日志的工具。
- en: With Azure Network Watcher, we can monitor endpoints, network flow, hops, VPNs,
    and everything else network-related. It's a great tool, as it allows us to graphically
    display our network schema and locate issues in an easier way.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Azure Network Watcher，我们可以监控端点、网络流量、跳数、VPN和其他一切与网络相关的内容。它是一个非常棒的工具，因为它允许我们以图形方式显示网络架构，并更轻松地定位问题。
- en: Encryption
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加密
- en: Another important step in security is encryption. We want our data to be encrypted
    always—in rest and transit. Everything is redundant to ensure there is no data
    is lost, and even with three copies of that, all of them encrypted, we have the
    option to create additional redundancy with geo-replication and other settings.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 安全中的另一个重要步骤是加密。我们希望我们的数据始终保持加密——无论是在静态存储时还是在传输中。一切都具有冗余性，确保没有数据丢失，即使有三份加密的副本，我们也可以选择使用地理复制和其他设置来创建额外的冗余。
- en: All resources in Azure are encrypted at rest by default. But sometimes we need
    additional security to ensure data is more protected. For example, disks for our
    Azure VMs are encrypted inside the Azure data center, and even if the disk was
    accessed without authorization, no one could read data on that disk. But what
    if the disk was downloaded? In this case, the disk could be used. Data could be
    read or attached to another VM, or a VM could be created with that disk.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Azure中的所有资源在静态存储时都会进行加密。但有时我们需要额外的安全性来确保数据得到更好的保护。例如，我们的Azure虚拟机磁盘在Azure数据中心内是加密的，即使磁盘未经授权访问，也没人能够读取磁盘上的数据。但如果磁盘被下载呢？在这种情况下，磁盘是可以被使用的。数据可以被读取或附加到另一个虚拟机，或者可以使用该磁盘创建一个虚拟机。
- en: We can apply additional encryption and make our resources more secure by using
    **Azure Key Vault**.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过使用**Azure Key Vault**来应用额外的加密并使我们的资源更加安全。
- en: Azure Key Vault
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Key Vault
- en: Azure Key Vault is used to store secrets, keys, and certificates. It's a centralized
    management solution for holding, distributing, and controlling secrets, keys,
    and certificates. Secrets in Azure Key Vault can be called during deployment so
    you can prevent passwords from being shown in plain text. Keys can be used to
    encrypt storage and disks. You can use certificates in Azure Key Vault and assign
    them to services during deployment to secure SSL and TLS.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Key Vault用于存储机密、密钥和证书。它是一个集中式管理解决方案，用于保存、分发和控制机密、密钥和证书。在部署过程中可以调用Azure
    Key Vault中的机密，以防止密码以明文形式显示。密钥可以用来加密存储和磁盘。你可以在Azure Key Vault中使用证书，并在部署过程中将其分配给服务以保障SSL和TLS安全。
- en: Azure Key Vault greatly reduces the chances that secrets may be accidentally
    leaked, increases the security of your resources at rest by using keys to encrypt,
    and increases security in transit by assigning certificates.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Key Vault大大减少了机密被意外泄露的可能性，通过使用密钥加密增加了资源静态存储时的安全性，并通过分配证书增加了传输过程中的安全性。
- en: Creating an Azure Key Vault
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建Azure Key Vault
- en: 'To create a new Key Vault, we need to provide a Name, Subscription, Resource
    Group, and Location. We can optionally change the Pricing tier, assign Access
    policies, and provide Virtual Network Access. The tier comes with two options: Standard
    and Premium. The only difference is that Premium supports **hardware security
    modules** (**HSMs**). The default policy assigned is to grant all access to the
    person creating the vault. You can additionally add policies as needed at any
    time, either during creation or later. Virtual Network Access is granted to all
    networks in your subscription by default, but you can edit this and grant access
    to specific networks only. An example of the default settings is shown here:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 创建新的密钥库时，我们需要提供名称、订阅、资源组和位置。我们还可以选择更改定价层、分配访问策略，并提供虚拟网络访问。定价层有两个选项：标准和高级。唯一的区别是高级支持**硬件安全模块**（**HSM**）。默认分配的策略是授予创建密钥库的人员所有访问权限。您还可以在创建过程中或之后随时添加策略。虚拟网络访问默认授予您订阅中的所有网络，但您可以编辑此设置，只授予特定网络访问权限。这里显示了默认设置的示例：
- en: '![](img/39e071e3-ae20-4fcd-9102-79c6c7600ce4.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](img/39e071e3-ae20-4fcd-9102-79c6c7600ce4.png)'
- en: 'Creating an Azure Key Vault is relatively fast and should be completed in under
    one minute. Note the DNS Name, as this will be used later. An example of an Azure
    Key Vault blade is shown in the following screenshot:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 Azure 密钥库相对快速，应该在一分钟内完成。请注意 DNS 名称，因为稍后会用到它。以下截图显示了一个 Azure 密钥库页面的示例：
- en: '![](img/1f76fda4-c3ea-465d-b0ab-854aabef74d2.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1f76fda4-c3ea-465d-b0ab-854aabef74d2.png)'
- en: 'To deploy Azure Key Vault, you can use the following ARM template:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 要部署 Azure 密钥库，您可以使用以下 ARM 模板：
- en: '[PRE1]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Adding keys and secrets
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加密钥和机密
- en: After the Key Vault is created, we can add secrets and keys.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 密钥库创建完成后，我们可以添加机密和密钥。
- en: 'Let''s first add a key that we''ll use for encryption later. Keys can be generated,
    imported, or restored from backup. An example of how to add a new key is shown
    here:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们添加一个密钥，以便稍后用于加密。密钥可以生成、导入或从备份中恢复。如何添加新密钥的示例如下：
- en: '![](img/a389addd-9dcc-4658-89db-14797600cd5d.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a389addd-9dcc-4658-89db-14797600cd5d.png)'
- en: 'Secrets can be used to provide passwords when creating resources. When you
    are creating resources using an ARM template, you need to provide a password.
    To prevent the password from being shown as plain text, you can use secrets in
    Key Vault to provide a value for the password and prevent this. Secrets can be
    manually created or imported from the certificate. In this example, we can see
    how to add a new secret manually:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 密钥库中的密钥可以用来提供创建资源时需要的密码。在使用 ARM 模板创建资源时，您需要提供密码。为了防止密码以明文显示，您可以使用密钥库中的机密提供密码的值，防止密码泄露。机密可以手动创建或从证书中导入。以下示例展示了如何手动添加新的机密：
- en: '![](img/15fdf418-7f07-4c14-9ee2-45537e1e730f.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/15fdf418-7f07-4c14-9ee2-45537e1e730f.png)'
- en: Similar to these two examples, you can add certificates. Certificates can be
    generated or imported. Note that if you want to use these certificates for publicly
    available applications, you must use a valid certificate issued by a public certification
    authority.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 与这两个示例类似，您可以添加证书。证书可以生成或导入。请注意，如果您想将这些证书用于公开的应用程序，必须使用由公认证机构颁发的有效证书。
- en: Encrypting the storage account
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加密存储账户
- en: 'As mentioned, most resources are encrypted by default, and the same goes with
    the Azure Storage Account. However, you have the option to use your own key to
    encrypt storage. To use your own key, you must select Use your own key, which
    will allow you to select the Key Vault and the key that will be used for encryption.
    An example is shown in the following screenshot:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，大多数资源默认是加密的，Azure 存储账户也不例外。然而，您可以选择使用自己的密钥来加密存储。要使用自己的密钥，您必须选择“使用您自己的密钥”，这将允许您选择将用于加密的密钥库和密钥。以下截图显示了一个示例：
- en: '![](img/52f50779-c14a-44e9-99ae-3892c42b5586.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/52f50779-c14a-44e9-99ae-3892c42b5586.png)'
- en: The time it takes to encrypt storage depends on the amount of data in the storage
    account. For smaller storage, it's a matter of seconds, but with large storage
    accounts it can take hours until the process is completed. If you are encrypting
    large storage accounts in a production environment, try doing this outside of
    working hours as it may impact performance.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 加密存储的时间取决于存储账户中的数据量。对于较小的存储，几秒钟就能完成，但对于大型存储账户，可能需要几个小时才能完成加密过程。如果您在生产环境中加密大型存储账户，请尽量在非工作时间进行，因为这可能会影响性能。
- en: Encrypting databases
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加密数据库
- en: 'Azure SQL Databases are encrypted with TDE. This option is now enabled by default
    when creating a new Azure SQL Database. If you have older databases, created before
    this became a default option, it''s enough to change the option to ON and save.
    The Transparent database encryption options in the Azure SQL Database blade are
    shown here:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: Azure SQL 数据库使用 TDE 进行加密。在创建新的 Azure SQL 数据库时，默认启用此选项。如果您有更早创建的数据库，可以将此选项更改为启用并保存。Azure
    SQL 数据库窗口中的透明数据库加密选项如下所示：
- en: '![](img/4025bb91-4b6a-400f-b00c-d0ee6b89bbb2.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4025bb91-4b6a-400f-b00c-d0ee6b89bbb2.png)'
- en: When TDE is enabled for Azure SQL Database, data and backups are encrypted at
    rest. But if you download or export a backup, this will no longer be the case.
    To have a database encrypted even after leaving Azure data center, we can use
    our own key for encryption. To do so we'll need to use Azure PowerShell.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 当 Azure SQL 数据库启用 TDE 时，数据和备份在静止状态下被加密。但如果您下载或导出备份，则情况会有所不同。为了确保数据库在离开 Azure
    数据中心后仍然加密，我们可以使用自己的密钥进行加密。为此，我们需要使用 Azure PowerShell。
- en: Installing Azure PowerShell
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 Azure PowerShell
- en: PowerShell is a command-line shell and scripting language based on the .NET
    Framework. It's used by system administrators to automate tasks and manage operating
    systems.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell 是基于 .NET Framework 的命令行外壳和脚本语言。系统管理员使用它来自动化任务和管理操作系统。
- en: Azure PowerShell is a PowerShell module that allows us to automate and manage
    Azure resources.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Azure PowerShell 是一个 PowerShell 模块，允许我们自动化和管理 Azure 资源。
- en: To install Azure PowerShell, we need to have Windows PowerShell installed. Luckily,
    Windows PowerShell comes pre-installed on Microsoft OS from Windows 7 (Client
    OS) and Windows Server 2012 R2 (Server OS).
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 Azure PowerShell，我们需要先安装 Windows PowerShell。幸运的是，Windows PowerShell 从 Windows
    7（客户端操作系统）和 Windows Server 2012 R2（服务器操作系统）开始，微软的操作系统就已经预装了 Windows PowerShell。
- en: 'To install Azure PowerShell, we need to run the following command:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 Azure PowerShell，我们需要运行以下命令：
- en: '[PRE2]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, we need to import the module:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要导入模块：
- en: '[PRE3]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'If the module is already installed, we can update it with:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 如果模块已安装，我们可以使用以下命令更新它：
- en: '[PRE4]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'After we have successfully imported the module, we can connect to Azure with:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 成功导入模块后，我们可以使用以下命令连接到 Azure：
- en: '[PRE5]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Using your own key for Azure SQL Database encryption
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用您自己的密钥进行 Azure SQL 数据库加密
- en: To use our own key for Azure SQL Database TDE, we must execute a few commands.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用自己的密钥进行 Azure SQL 数据库 TDE，我们必须执行几个命令。
- en: 'First, we need to sign our Azure Active Directory identity in to our Azure
    SQL server:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要将我们的 Azure Active Directory 身份登录到 Azure SQL 服务器：
- en: '[PRE6]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Second, we must grant Key Vault permission to our server:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我们必须授予服务器对 Key Vault 的权限：
- en: '[PRE7]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Third, we add the Key Vault key to the server and set the TDE protection level:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，我们将 Key Vault 密钥添加到服务器并设置 TDE 保护级别：
- en: '[PRE8]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Finally, we turn on the TDE:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们启用 TDE：
- en: '[PRE9]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: All parameters in Azure PowerShell script can be edited. To execute this on
    any Azure SQL Database using any Key Vault, change the names of the parameters
    accordingly.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: Azure PowerShell 脚本中的所有参数都可以编辑。要在任何 Azure SQL 数据库中使用任何 Key Vault 执行此操作，请相应地更改参数的名称。
- en: Encrypting VM disks
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加密虚拟机（VM）磁盘
- en: 'A similar thing can be applied to Azure VMs. Disks are encrypted by default
    and data is protected at rest. But as mentioned, when a disk is exported or downloaded,
    it''s no longer protected. Using Key Vault, we can set additional encryption to
    our Azure VM disks and protect data in any situation. If we open disks in any
    of our Azure VMs, we can see that the disk is not encrypted, as shown:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 同样的操作也适用于 Azure 虚拟机（VM）。磁盘默认加密，并且数据在静止状态下受到保护。但正如前面所提到的，当磁盘被导出或下载时，它将不再受到保护。通过使用
    Key Vault，我们可以为 Azure VM 磁盘设置额外的加密保护，确保任何情况下的数据安全。如果我们查看任何 Azure VM 中的磁盘，我们会看到磁盘未加密，如下所示：
- en: '![](img/2333194d-b184-46db-9bef-69b8ae2acedd.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2333194d-b184-46db-9bef-69b8ae2acedd.png)'
- en: 'To enable disk encryption, first we must enable the Key Vault for disk encryption:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用磁盘加密，我们首先必须启用用于磁盘加密的 Key Vault：
- en: '[PRE10]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Now we can enable disk encryption:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以启用磁盘加密：
- en: '[PRE11]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The command will run in 5-15 minutes, depending on the size of the disk. After
    we receive a message that it''s completed, we can check the disk status again
    and see that encryption is enabled:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令将在 5 到 15 分钟内运行，具体时间取决于磁盘的大小。收到完成消息后，我们可以再次检查磁盘状态，查看加密是否已启用：
- en: '![](img/a311bb86-5c5f-41a6-85da-e959bf3e0cae.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a311bb86-5c5f-41a6-85da-e959bf3e0cae.png)'
- en: Azure Security Center
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 安全中心
- en: Azure Security Center provides a central place for security management and advanced
    threat protection across Azure and the hybrid cloud. With security center, we
    can apply security policies across workloads, limit exposure to threats, and detect
    and respond to attacks. It comes in two tiers, free and standard. The free tier
    is enabled by default, and it provides a security policy, continuous security
    assessment, and actionable security recommendations to protect Azure resources.
    The standard tier extends to private or hybrid cloud workloads and adds advanced
    threat detection. Advanced threat detection uses built-in behavioral analytics
    and machine learning to identify attacks and zero-day exploits to reduce exposure
    to any type of attack.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 安全中心提供了一个集中式的安全管理和高级威胁防护平台，涵盖 Azure 和混合云环境。通过安全中心，我们可以在工作负载中应用安全策略，限制对威胁的暴露，并检测和响应攻击。它分为两个层级：免费版和标准版。免费版默认启用，提供安全策略、持续的安全评估以及可操作的安全建议，以保护
    Azure 资源。标准版扩展到私有或混合云工作负载，并增加了高级威胁检测。高级威胁检测使用内置的行为分析和机器学习技术来识别攻击和零日漏洞，减少暴露于任何类型的攻击。
- en: Azure Security Center overview
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 安全中心概述
- en: 'The Overview dashboard in the Azure Security Center blade provides an instant
    summary of the security status of your Azure and non-Azure workloads, enabling
    you to discover and assess the security of your workloads and to identify and
    mitigate risks. We can see different metrics that allow us to instantly identify
    any security risks and see recommendations on what needs to be improved in our
    subscription based on best practices. An example of the Overview dashboard in
    Azure Security Center is shown in the screenshot:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 安全中心概览仪表板提供了您 Azure 和非 Azure 工作负载的安全状态的即时总结，使您能够发现并评估工作负载的安全性，识别和减轻风险。我们可以看到不同的指标，这些指标使我们能够立即识别任何安全风险，并根据最佳实践看到需要改进的推荐事项。Azure
    安全中心中的概览仪表板示例如下图所示：
- en: '![](img/bf282a44-618d-47ea-82a1-b35c8ecd5f57.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bf282a44-618d-47ea-82a1-b35c8ecd5f57.png)'
- en: Azure Security Center is a complex service with a lot of options. As with many
    other services, it deserves a book of its own and it would be hard to cover all
    options in a single chapter. We are going to concentrate on the most important
    ones that will help you instantly increase your security.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 安全中心是一个功能复杂的服务，提供了很多选项。与许多其他服务一样，它值得一本专书，而很难在一个章节中涵盖所有选项。我们将专注于一些最重要的选项，这些选项将帮助您立即提升安全性。
- en: Azure Security Center recommendations
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 安全中心推荐
- en: 'Azure Security Center analyzes your security settings and compares them to
    best practices. Based on this, you can see recommended changes that need to be
    implemented under Security Center - Recommendations. Recommendations are divided
    into four categories—Compute & apps, Data & storage, Networking, and Identity
    & access (Preview). All resources can have three statuses: green, orange, and
    red. Green shows that all security best practices are enabled and that the resource
    is secure; orange represents recommendations that should be implemented but aren''t
    critical; and red shows recommendations that present high security risks and should
    be implemented immediately. We can also see our security score based on what is
    implemented and what remains to be resolved as a possible security risk. The Security
    Center - Recommendations blade is shown in the following screenshot:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 安全中心分析您的安全设置并将其与最佳实践进行对比。基于此，您可以看到在安全中心 - 推荐中需要实施的建议变更。建议分为四类——计算与应用、数据与存储、网络、以及身份与访问（预览）。所有资源可以有三种状态：绿色、橙色和红色。绿色表示所有安全最佳实践已启用，并且资源是安全的；橙色表示应实施但不关键的建议；红色表示存在高安全风险的建议，应该立即实施。我们还可以看到基于已实施和待解决的内容，可能存在的安全风险的安全得分。安全中心
    - 推荐仪表板如下图所示：
- en: '![](img/36668786-11ca-4f38-8c17-30b3cf19b595.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](img/36668786-11ca-4f38-8c17-30b3cf19b595.png)'
- en: 'Let''s take the Compute section as an example. Here, we can find a list of
    all security issues that are related to compute resources (Vms and Computers,
    App services (Preview), and Cloud services). In this list of recommendations,
    we can see descriptions of issues and how many resources are affected by these
    issues. In the example here, we can see at the top of the list that 8 out of 10
    VMs don''t have endpoint protection enabled and that this is classified as red:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 以“计算”部分为例。在这里，我们可以找到与计算资源（虚拟机和计算机、应用服务（预览）以及云服务）相关的所有安全问题列表。在这些推荐列表中，我们可以看到问题描述以及这些问题影响了多少资源。在此示例中，我们可以看到列表顶部列出，8
    个虚拟机中有 10 个没有启用端点保护，并且被标记为红色：
- en: '![](img/67328018-7f64-4b78-921c-c864f6946501.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/67328018-7f64-4b78-921c-c864f6946501.png)'
- en: Enabling endpoint protection
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用端点保护
- en: 'As an example, let''s click on this recommendation and resolve it. A new blade
    will open with a list of VMs that don''t have endpoint protection. We can select
    specific VMs or all of them, and can opt to install endpoint protection. Installation
    will start, and after it is completed, we''ll see that the recommendation is resolved:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 作为示例，让我们点击这个推荐并解决它。会打开一个新窗口，列出没有启用端点保护的虚拟机（VM）。我们可以选择特定的虚拟机或所有虚拟机，并选择安装端点保护。安装将开始，完成后我们会看到推荐已解决：
- en: '![](img/4c989d75-1d8c-434e-b711-98c7ce19670f.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4c989d75-1d8c-434e-b711-98c7ce19670f.png)'
- en: Similar to this, we can resolve most security center recommendations. We click
    on the recommendation and follow the steps. However, some recommendations can't
    be resolved in this way and require additional steps. In this case, you will be
    taken to documentation that describes the issue and provides steps to resolving
    it.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 类似这样，我们可以解决大多数安全中心的推荐。我们点击推荐并按照步骤操作。然而，有些推荐无法通过这种方式解决，需要额外的步骤。在这种情况下，你将被引导到文档中，描述该问题并提供解决步骤。
- en: Azure Security Center Alerts
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 安全中心警报
- en: 'Alerts are another part of Azure Security Center; these are very helpful and
    allow you to detect possible issues. The security alerts section allows you to
    track and see when unauthorized access to your resources was attempted. In the
    overview of alerts in Azure Security Center, you can see a list of possible attacks
    on your resources and see when they happened, as shown in the following screenshot:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 警报是 Azure 安全中心的另一部分；这些警报非常有用，可以帮助你检测潜在问题。安全警报部分可以让你追踪并查看何时有未授权访问你的资源的尝试。在 Azure
    安全中心的警报概览中，你可以看到可能的资源攻击列表，并且能查看它们发生的时间，如下图所示：
- en: '![](img/e804c86b-050a-42b7-ad47-6fa0a6ff0faf.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e804c86b-050a-42b7-ad47-6fa0a6ff0faf.png)'
- en: If we select any alerts, we will see more information such as a date, what credentials
    were used, the number of login attempts, and other information. Under Geo and
    Threat Intelligence Information, we can see from where an attack took place, giving
    us a detailed geographical location of the attack origin. Based on the login information
    and geo-location, we can detect if this was a legitimate user or a brute-force
    attack on our resources. If we have a valid user attempting this three times from
    a known location, we can assume this was a user who has simply forgotten their
    password.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们选择任何警报，我们会看到更多信息，如日期、使用了什么凭证、登录尝试次数以及其他信息。在“地理和威胁情报信息”下，我们可以看到攻击发生的地点，提供了详细的地理位置信息。根据登录信息和地理位置，我们可以判断这是否是合法用户，还是对资源进行的暴力破解攻击。如果有一个有效用户在已知地点尝试了三次，我们可以推测这可能是用户忘记了密码。
- en: 'If we have 50 attempts from unknown user(s) from unknown location(s), we can
    assume it was a brute-force attack. Under Remediation steps, we have instructions
    on how to prevent similar attacks in the future. A sample of suspicious authentication
    activity is shown here:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们有 50 次来自未知用户的登录尝试，且来自未知地点，我们可以推测这是一次暴力破解攻击。在“修复步骤”下，我们会有如何防止未来类似攻击的说明。这里展示了一个可疑的认证活动示例：
- en: '![](img/50027950-2ffa-4fe1-bb98-5d0a09170e1d.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![](img/50027950-2ffa-4fe1-bb98-5d0a09170e1d.png)'
- en: 'At the bottom, we have two additional actions—Investigate and View playbooks.
    Investigate allows us to review details about incidents with more details. View
    playbooks allows us to create (or use an existing) logic app that will take action
    if similar events happen in the future. With a logic app, we can design steps
    and actions that will prevent attacks. For example, if login with an invalid user
    is attempted more than three times, it will add an NSG rule that will prevent
    access to a resource for the next 48 hours. An example of investigation details
    is shown in the following screenshot:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在底部，我们有两个附加操作——“调查”（Investigate）和“查看操作手册”（View playbooks）。调查允许我们查看事件的详细信息。查看操作手册允许我们创建（或使用现有的）逻辑应用程序，如果将来发生类似事件，它将采取相应措施。通过逻辑应用程序，我们可以设计步骤和操作来防止攻击。例如，如果尝试使用无效用户登录超过三次，它将添加一个NSG规则，阻止访问资源48小时。调查详情的示例如下所示：
- en: '![](img/5584f19d-281c-4106-a3a1-dbc8806af21a.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5584f19d-281c-4106-a3a1-dbc8806af21a.png)'
- en: Just-in-Time access
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 即时访问
- en: One of the best features in Azure Security Center is Just-in-Time access. Just-in-Time
    access prevents access to Azure VMs unless it's been specifically requested. By
    default, all management ports are closed, and you need to request access from
    specific IP address(es) for a short period of time to enable such access.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: Azure安全中心的最佳功能之一就是即时访问。即时访问可以防止访问Azure虚拟机，除非该访问已被特别请求。默认情况下，所有管理端口都被关闭，您需要从特定的IP地址请求访问，并且仅在短时间内启用此访问。
- en: 'To set up Just-in-Time access on Azure VM, go to the Just-in-Time access blade
    in the Security Center and select one or more VMs from the list, as shown:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Azure虚拟机上设置即时访问，请进入安全中心的即时访问面板并从列表中选择一个或多个虚拟机，如下所示：
- en: '![](img/aaf61239-c0f0-4186-b737-17d88ea458cd.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aaf61239-c0f0-4186-b737-17d88ea458cd.png)'
- en: 'After you select the VM(s) that will have Just-in-Time access enabled, a new
    blade will open. Here we must define ports that will be closed by default and
    enabled only on request. The default ports are SSH (`22`), RDP (`3389`), and WinRM
    (`5985` and `5986`), but you can remove and add any port you want. An example
    of the default settings is shown in the following screenshot:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择要启用即时访问的虚拟机后，将会打开一个新面板。在这里，我们必须定义默认关闭且仅在请求时启用的端口。默认端口包括SSH（`22`）、RDP（`3389`）和WinRM（`5985`和`5986`），但您可以删除和添加任何您需要的端口。以下截图显示了默认设置的示例：
- en: '![](img/552f65da-0fc6-4109-b93d-634de40cea5b.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![](img/552f65da-0fc6-4109-b93d-634de40cea5b.png)'
- en: 'After Just-in-Time access is enabled, the option to connect to the VM will
    not be available. To access the VM, you must request access in Azure Security
    Center. Here, you need to define which port you want to open, from which IP address(es)
    it will be able to connect, and for how long (from 1 to 3 hours). An example of
    the request blade is shown here, where we can see how to open the RDP port from
    the current IP address for one hour:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 启用即时访问后，连接虚拟机的选项将不可用。要访问虚拟机，您必须在Azure安全中心请求访问。在这里，您需要定义要打开的端口、允许从哪些IP地址连接以及允许连接的时长（1到3小时）。以下是请求面板的示例，您可以看到如何从当前IP地址打开RDP端口一小时：
- en: '![](img/542743ad-46c8-48b7-acce-dff56bc2fcad.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![](img/542743ad-46c8-48b7-acce-dff56bc2fcad.png)'
- en: With Just-in-Time access, you are controlling who can access your VMs, when,
    and from where. Unauthorized access is brought to a minimum and your VMs are protected.
    Another amazing thing is that with Azure Security Center in the standard tier,
    you can register and protect resources in private and hybrid clouds. This option
    is not limited only to Azure VMs, but can be enabled for on-premises VMs as well.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 通过即时访问（Just-in-Time access），您可以控制谁可以访问您的虚拟机（VM）、何时访问以及从哪里访问。未经授权的访问降到最低，您的虚拟机得到了保护。另一个令人惊叹的功能是，在标准层的Azure安全中心中，您可以注册并保护私有和混合云中的资源。此选项不仅仅限于Azure虚拟机，还可以为本地虚拟机启用。
- en: Summary
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Microsoft takes Azure Security very seriously. Lot of steps are taken to ensure
    your resources are protected and safe in Azure. In addition to this, Microsoft
    offers lots of additional services that we can use to improve security further.
    To be secure and achieve maximum, it takes combines effort from Microsoft and
    us, and we need to take advantage of the security services that Azure has to offer
    in addition to what Microsoft is already doing to secure our data and services. Besides
    security features that are declared as security services (such as Key Vault or
    security center), there are lots of security features that services have built
    in (such as Azure SQL Firewall or network security groups).
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 微软非常重视Azure安全。采取了许多步骤来确保您的资源在Azure中得到保护和安全。除此之外，微软还提供了许多额外的服务，帮助我们进一步提高安全性。为了确保安全并实现最大化保护，需要微软和我们的共同努力，我们需要利用Azure提供的安全服务，除了微软已经在保护我们的数据和服务之外。此外，除了被声明为安全服务的安全功能（例如密钥保管库或安全中心），还有很多服务内置的安全功能（例如Azure
    SQL防火墙或网络安全组）。
- en: As we are getting toward the end, we are going to review what we have learned.
    In the last chapter, we are going to talk about services we already discussed
    and the best practices when using them. Infrastructure-as-Code is a very important
    part of cloud computing, and we're going to talk about tools that will allow us
    to work with Azure by automating tasks. Using the Azure portal is a great way
    to learn about Azure, but if you want to take full advantage, Infrastructure-as-Code
    is what you want to use.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们逐渐接近尾声，我们将回顾我们所学的内容。在最后一章，我们将讨论我们之前讨论过的服务以及使用它们的最佳实践。基础设施即代码（Infrastructure-as-Code）是云计算中非常重要的一部分，我们将讨论一些工具，这些工具可以通过自动化任务帮助我们与Azure进行工作。使用Azure门户是了解Azure的一个很好的方式，但如果你想充分利用它，基础设施即代码是你需要使用的工具。
- en: Questions
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Everything in Azure is redundant and has how many copies?
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure中的一切都是冗余的，拥有多少份副本？
- en: One
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一
- en: Two
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两个
- en: Three
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 三个
- en: Most data breaches are caused by...
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 大多数数据泄露是由...引起的
- en: Brute-force attacks
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 暴力破解攻击
- en: Leaked credentials
  id: totrans-181
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 泄露的凭证
- en: Viruses
  id: totrans-182
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 病毒
- en: MFA stands for...
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: MFA代表...
- en: Multi-factor authentication
  id: totrans-184
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 多因素认证
- en: Multi-factor authorization
  id: totrans-185
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 多因素授权
- en: Multi-factor activation
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 多因素激活
- en: 'MFA can be configured to use:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 多因素认证（MFA）可以配置为使用：
- en: Phone calls
  id: totrans-188
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 电话呼叫
- en: Text messages
  id: totrans-189
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 短信
- en: A mobile app
  id: totrans-190
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移动应用程序
- en: All of the above
  id: totrans-191
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以上所有
- en: Azure Firewall is...
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure防火墙是...
- en: Infrastructure as a Service
  id: totrans-193
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 基础设施即服务
- en: Firewall as a Service
  id: totrans-194
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 防火墙即服务
- en: Both
  id: totrans-195
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Azure resources can be encrypted using...
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure资源可以使用...进行加密
- en: An Azure-provided key
  id: totrans-197
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure提供的密钥
- en: A custom key
  id: totrans-198
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 自定义密钥
- en: Both
  id: totrans-199
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: To use custom keys, we must use...
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使用自定义密钥，我们必须使用...
- en: Azure Security Center
  id: totrans-201
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure安全中心
- en: Azure Key Vault
  id: totrans-202
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure密钥保管库
- en: Both
  id: totrans-203
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Azure Security Center provides...
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure安全中心提供...
- en: Security management
  id: totrans-205
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安全管理
- en: Advanced threat protection
  id: totrans-206
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 高级威胁防护
- en: Both
  id: totrans-207
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Azure Security Center can be used to protect...
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure安全中心可以用于保护...
- en: Azure resources
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure资源
- en: On-premises resources
  id: totrans-210
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本地资源
- en: Both
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Just-in-Time access provides...
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 即时访问提供...
- en: Control over management access for our VMs
  id: totrans-213
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们对虚拟机（VM）管理访问的控制
- en: Live monitoring of access to VMs
  id: totrans-214
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实时监控虚拟机的访问
- en: Both
  id: totrans-215
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
