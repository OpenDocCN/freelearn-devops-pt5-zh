- en: Azure Storage, Backup, and Site Recovery - Moving your Data to Azure
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Storage、备份和站点恢复 - 将数据迁移到Azure
- en: In this chapter, we will focus on migrating data to Azure. We'll start with
    Azure Storage as one of the most important services in Azure. Everything begins
    with Storage and it's important to understand how it's used. We'll discuss how
    to use Azure Storage for backup and how to migrate your workloads to the cloud.
    Further, we'll discuss how to use Azure Backup and **Azure Site Recovery** (**ASR**)
    to speed up your journey and migrate data to Azure.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将重点讨论将数据迁移到Azure。我们将从Azure Storage开始，因为它是Azure中最重要的服务之一。一切从Storage开始，了解它的使用非常重要。我们将讨论如何使用Azure
    Storage进行备份，以及如何将工作负载迁移到云端。此外，我们还将讨论如何使用**Azure备份**和**Azure站点恢复**（**ASR**）加快迁移过程，并将数据迁移到Azure。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Azure Storage
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Storage
- en: Azure Backup
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure备份
- en: Azure Site Recovery
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure站点恢复
- en: Creating highly available Azure SQL Database
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建高可用性的Azure SQL数据库
- en: Creating SQL Server high availability solutions can be complicated, hard to
    configure, and even harder to maintain and manage. Azure SQL Database high availability
    is much easier to create and requires almost no maintenance.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 创建SQL Server高可用性解决方案可能会非常复杂，配置困难，维护和管理起来更是困难重重。而Azure SQL数据库的高可用性则容易得多，几乎不需要维护。
- en: 'The option we need to start with is Geo-Replication. The geo-replication blade
    shows the world map with marks showing data centers in which databases are currently
    located and all data centers available for replication. The current data center,
    in which the database is located, is marked in blue. The data center recommended
    for replication is marked in purple (this will be the data center closest to the
    current data center) and all other available data centers are marked green. On
    the map, you can see information about the current database that will be our primary
    database. An image of a geo-replication blade is shown in following image:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要从Geo-Replication开始。地理复制刀片显示了世界地图，并标示了当前数据库所在的以及所有可供复制的数据中心。当前数据库所在的数据中心用蓝色标记。建议用于复制的数据中心用紫色标记（这是离当前数据中心最近的数据中心），其他所有可用数据中心用绿色标记。在地图上，您可以看到有关当前数据库的信息，该数据库将是我们的主数据库。以下是地理复制刀片的示意图：
- en: '![](img/c93ac8ca-fe2c-4f7c-8af5-551e6693a9ef.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c93ac8ca-fe2c-4f7c-8af5-551e6693a9ef.png)'
- en: 'To create a new database replica, we can select any data center on the map
    to start a new blade. The Create secondary blade will open, in which we need to
    provide a target SQL Server (create a new server if it doesn''t exist in location
    selected). The Database name will be the same as the original one, and the database the
    will be in read-only mode. The Pricing tier will be same as the original, but
    you can change the tier to another value. An example of the settings needed to
    create a secondary database is shown here:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建新的数据库副本，我们可以在地图上选择任何数据中心来启动新的刀片。将打开“创建辅助刀片”，在其中我们需要提供目标SQL Server（如果选定位置没有该服务器，则创建新服务器）。数据库名称将与原始名称相同，并且数据库将处于只读模式。定价层次将与原始相同，但您可以将层次更改为另一个值。创建辅助数据库所需的设置示例如下所示：
- en: '![](img/340f7479-a3f4-4806-a6a2-a16c9269642c.png)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![](img/340f7479-a3f4-4806-a6a2-a16c9269642c.png)'
- en: After deployment is finished, the map will change, showing the connection between the
    primary and secondary database. Deployment time depends on the database size.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 部署完成后，地图会发生变化，显示主数据库和辅助数据库之间的连接。部署时间取决于数据库的大小。
- en: 'During deployment, the empty database is created in the secondary data center,
    and then the data is copied from primary to secondary. A map with the replication
    in place is shown here:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在部署过程中，空数据库会在辅助数据中心创建，然后数据从主数据库复制到辅助数据库。以下是实施复制后的地图示例：
- en: '![](img/60a73975-f797-4724-ad58-aa8afd933587.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![](img/60a73975-f797-4724-ad58-aa8afd933587.png)'
- en: However, notice that this is only creating a readable copy of the primary database.
    In the case of disaster or if the primary database is unavailable, the secondary
    database must be manually changed from read-only to read/write and all connection
    strings to the database must be changed manually. This doesn't really represent
    a high availability solution, so we need to take an additional step by creating
    a failover group.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，请注意，这只是创建主数据库的可读副本。在灾难发生或主数据库不可用的情况下，辅助数据库必须手动从只读模式切换为读/写模式，并且所有连接字符串必须手动更改。这实际上并不能算作高可用性解决方案，因此我们需要通过创建故障切换组来采取额外的步骤。
- en: In the Failover group blade, we need to provide a Primary server, Secondary
    server, Failover group name, Read/Write failover policy, and Read/Write grace
    period (hours). The failover group name must be unique, and this will be the new
    endpoint for the connection to our database. Connecting to the failover group
    name will automatically point us to the primary server whenever the primary server
    is available.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在故障转移组面板中，我们需要提供主服务器、备用服务器、故障转移组名称、读/写故障转移策略以及读/写宽限期（小时）。故障转移组名称必须唯一，这将成为连接到数据库的新端点。连接到故障转移组名称时，只要主服务器可用，连接将自动指向主服务器。
- en: 'If that primary server isn''t available, all connections to the failover group
    name will be pointed to the secondary server. All failover and failback happens
    automatically and requires no user action. A screenshot of the Failover group
    options is shown here:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 如果主服务器不可用，所有指向故障转移组名称的连接将会自动指向备用服务器。所有故障转移和故障恢复过程都将自动进行，无需用户操作。这里展示了故障转移组选项的截图：
- en: '![](img/bfd5a959-3b77-45bd-bee3-a41d1b1b6928.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bfd5a959-3b77-45bd-bee3-a41d1b1b6928.png)'
- en: As you can see, creating the Azure SQL Database high availability solution is
    simple and fast. It requires no user action once it's created, and failover and
    failback happen automatically. If you have ever created a similar solution in
    an on-premises environment, you probably know how complicated a failback process
    can be.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，创建 Azure SQL 数据库高可用性解决方案简单快捷。创建后无需用户操作，故障转移和故障恢复都会自动进行。如果您曾在本地环境中创建过类似的解决方案，您可能知道故障恢复过程有多复杂。
- en: Azure SQL Database security
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure SQL 数据库安全
- en: When it comes to data, security is very important (not that other resources
    should be left unsecured). Under the Azure SQL Database blade, we have a set of
    options related to security. SECURITY options include Advanced Threat Protection,
    Auditing, Dynamic Data Masking, and Transparent data encryption. Advanced Threat
    Protection and Auditing can be applied on the server level (for all databases
    on the server) or for a single database.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据而言，安全性非常重要（并非其他资源可以忽视安全性）。在 Azure SQL 数据库面板下，我们有一组与安全性相关的选项。安全选项包括高级威胁保护、审计、动态数据掩码和透明数据加密。高级威胁保护和审计可以在服务器级别（针对该服务器上的所有数据库）或单个数据库上应用。
- en: 'Advanced Threat Protection contains three subsections:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 高级威胁保护包含三个子部分：
- en: Data Discovery & Classification (preview)
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据发现与分类（预览）
- en: Vulnerability Assessment
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞评估
- en: Threat Detection
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 威胁检测
- en: The Data Discovery & Classification (preview) feature is still in beta but can
    be very useful. A scan of the database will be performed, and recommendations
    will be provided on which columns in your database should be marked as classified.
    This can be especially useful when considering data that should be considered
    regarding the **general data protection regulation** (**GDPR**).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 数据发现与分类（预览）功能仍处于测试阶段，但非常有用。数据库将进行扫描，并提供建议，指出哪些列应标记为分类数据。在考虑需要遵守**通用数据保护条例**（**GDPR**）时，这尤其有用。
- en: Vulnerability Assessment will perform a security scan and provide security recommendations
    for your database. Examples of recommendations would be to to track firewall rules
    or to classify sensitive data.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 漏洞评估将进行安全扫描，并为您的数据库提供安全建议。例如，建议跟踪防火墙规则或分类敏感数据。
- en: Threat Detection applies machine learning to your security. This feature analyzes
    normal behavior and alerts you to any action that is out of the ordinary. For
    example, if one of the SQL logins always accesses the database in work hours and
    suddenly tries to log in during other periods, you will be alerted. Or, if one
    of the logins is always coming from a specific IP address and tries to access the
    database from the other side of the world, action will be detected and you will
    be alerted.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 威胁检测将机器学习应用于您的安全性。此功能分析正常行为，并提醒您任何异常操作。例如，如果某个 SQL 登录帐户通常只在工作时间访问数据库，而突然在其他时间尝试登录，您将收到警报。或者，如果某个登录帐户始终来自特定
    IP 地址，但尝试从世界另一端访问数据库，系统也会检测到并提醒您。
- en: 'A screenshot of advanced threat protection is shown here:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这里展示了高级威胁保护的截图：
- en: '![](img/440c4355-54e5-414d-a55a-4f3bf0064292.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/440c4355-54e5-414d-a55a-4f3bf0064292.png)'
- en: 'Auditing allows us to track events and log them to the storage account. We
    can define the log retention period, and whether events are logged on the database
    or server level. As auditing is often a requirement for many organizations, especially
    in order to be compliant to different standards, this option allows you to fulfill
    that requirement. A screenshot for audit logs is shown here:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 审计功能允许我们跟踪事件并将其记录到存储帐户中。我们可以定义日志保留期，以及是否在数据库或服务器级别记录事件。由于审计通常是许多组织的要求，特别是为了符合不同的标准，这个选项允许您满足这一要求。以下是审计日志的截图：
- en: '![](img/5275f29e-39f1-4433-b8e0-d2afcd17c0af.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5275f29e-39f1-4433-b8e0-d2afcd17c0af.png)'
- en: 'Before we proceed to dynamic data masking, let''s run a simple query. Selecting the
    top 100 rows on the table `SalesLT.Customers` will return all information on the
    first 100 customers from the table. Here we have various types of data, and we
    may not want everyone with access to the database to see everything. Let''s take
    a phone number, for example. Note that in the following screenshot, we can see
    that running the query will return the phone column:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续进行动态数据屏蔽之前，让我们先运行一个简单的查询。在表 `SalesLT.Customers` 中选择前 100 行将返回该表中前 100 个客户的所有信息。这里有各种类型的数据，我们可能不希望所有有数据库访问权限的人都能看到这些信息。我们以电话号码为例。请注意，在以下截图中，我们可以看到运行查询会返回电话列：
- en: '![](img/87a9fc9d-514c-408d-8108-b8690090f305.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/87a9fc9d-514c-408d-8108-b8690090f305.png)'
- en: 'The dynamic data masking blade will provide information on all the masking
    rules currently applied and recommendations for rules that you also may want to
    consider for masking. Note that the SQL administrator is excluded from data masking,
    and that you can add additional users to be excluded. A screenshot of dynamic
    data masking is shown here:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 动态数据屏蔽面板将提供有关当前应用的所有屏蔽规则的信息，并建议您可能想要考虑用于屏蔽的其他规则。请注意，SQL 管理员不受数据屏蔽影响，您可以添加额外的用户来排除在外。以下是动态数据屏蔽的截图：
- en: '![](img/c9f37723-53f1-410d-b5b9-8a951053f9a2.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c9f37723-53f1-410d-b5b9-8a951053f9a2.png)'
- en: 'To add a new rule, we need to provide the Schema, Table, Column, and Masking
    field format. The Masking field format will allow you to control what masked data
    looks like in a query result. An example of how to add the phone column for data
    masking is shown here:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加新的规则，我们需要提供架构、表、列和屏蔽字段格式。屏蔽字段格式将允许您控制查询结果中屏蔽数据的显示方式。下面是如何为数据屏蔽添加电话列的示例：
- en: '![](img/fe815f65-080c-4b9f-8102-7fa3ace29ece.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fe815f65-080c-4b9f-8102-7fa3ace29ece.png)'
- en: 'Once the data masking rule is applied, we can run the query again. As you can
    see in the following screenshot, the result will be different when the masking
    rule is applied, and the phone column will then return `xxx` for all values:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦应用了数据屏蔽规则，我们可以再次运行查询。如以下截图所示，应用屏蔽规则后，结果将会不同，电话列的所有值都会返回`xxx`：
- en: '![](img/cb8ddac7-a86c-4ce6-a8c2-30a1399e0dbe.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cb8ddac7-a86c-4ce6-a8c2-30a1399e0dbe.png)'
- en: Using dynamic data masking, we can control user access to data and prevent them
    seeing confidential information. For example, if we have billing information and
    contact information in the same table, we may want to provide access to the table
    to different users but allow them to see different information. We can allow our
    sales department to see an email or phone number, but want to prevent them from
    seeing credit card information. On the other hand, we don't want to prevent everyone
    from seeing credit card information and want to allow this information to be accessed
    by the finance department. Dynamic data masking is ideal for this scenario, wherein
    users can have access to the same table but see different sets of information.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 使用动态数据屏蔽，我们可以控制用户对数据的访问，防止他们查看机密信息。例如，如果我们在同一张表中有账单信息和联系信息，我们可能希望为不同的用户提供对该表的访问权限，但允许他们查看不同的信息。我们可以允许销售部门查看电子邮件或电话号码，但希望防止他们查看信用卡信息。另一方面，我们不希望阻止所有人查看信用卡信息，并希望允许财务部门访问这些信息。动态数据屏蔽非常适合这种场景，其中用户可以访问相同的表格，但查看不同的信息集。
- en: '**Transparent data encryption** (**TDE**) is used for encrypting databases
    in rest mode. This feature is available for on-premises versions of SQL Server
    but requires an implementation that isn''t so simple. For Azure SQL Databases,
    this feature is turned on automatically for newly created databases. This wasn''t
    always the case, and for older databases you can turn it on simply by switching
    the TDE option on. As simple as that, databases (and all backups) are encrypted
    at rest. Transparent database encryption is shown in the following screenshot:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '**透明数据加密**（**TDE**）用于加密处于静态状态的数据库。此功能适用于本地版本的 SQL Server，但实现起来并不简单。对于 Azure
    SQL 数据库，创建的新数据库会自动开启此功能。以前并非如此，对于旧数据库，可以通过简单地开启 TDE 选项来启用此功能。就是这么简单，数据库（以及所有备份）都会在静态状态下被加密。下面的截图展示了透明数据库加密的界面：'
- en: '![](img/f5128e67-618b-4dbb-95c6-9a918ee6da68.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f5128e67-618b-4dbb-95c6-9a918ee6da68.png)'
- en: Monitoring and troubleshooting Azure SQL Database
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控和故障排除 Azure SQL 数据库
- en: MONITORING options for Azure SQL Databases is very similar to options for other
    Azure resources. Options available for MONITORING are Alerts (Classic), Metrics
    (preview), and Diagnostic settings. All of these features are available for Azure
    Virtual Machines and Azure Web Apps, and these were covered in previous chapters.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: Azure SQL 数据库的监控选项与其他 Azure 资源的选项非常相似。监控选项包括警报（经典）、度量（预览）和诊断设置。所有这些功能也适用于 Azure
    虚拟机和 Azure Web 应用程序，这些内容在前几章中已有介绍。
- en: SUPPORT + TROUBLESHOOTING options bring us a few features that are specific
    to Azure SQL Databases. Features such as Resource health and New support request
    are present, as for other Azure resources. New features are Performance overview,
    Performance recommendations, Query Performance Insight, and Automatic tuning.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 支持 + 故障排除选项为我们提供了一些特定于 Azure SQL 数据库的功能。功能包括资源健康和新支持请求，和其他 Azure 资源类似。新功能包括性能概述、性能推荐、查询性能洞察和自动调优。
- en: 'Performance overview gives us an overview of query performance. Here we can
    find information on resource consumption by queries. Overview gives us insight
    into aggregated consumption for queries per resource type. Resource type can be
    DTU, CPU, and IOPS. This aggregation will show queries which create the biggest
    resource cost, but as this is aggregated consumption, it can be the result of the
    query being executed often and not of the query spending resources in a single
    run. A list of queries which take more time to execute can be found under the
    Long running queries tab. This information can help us improve performance, as
    queries that are often executed and queries that take a long time to execute are
    spending lot of resources. Editing these queries can improve performance and save
    money in the long run as well. A graph showing CPU consumption in the Performance
    overview category is shown here:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 性能概述为我们提供了查询性能的概览。在这里，我们可以查看查询的资源消耗情况。概述为我们提供了按资源类型聚合的查询消耗情况。资源类型包括 DTU、CPU
    和 IOPS。此聚合会显示消耗最大资源的查询，但由于这是聚合消耗，可能是查询频繁执行的结果，而不是单次执行时消耗大量资源。我们可以在“长时间运行的查询”选项卡下查看执行时间较长的查询列表。这些信息可以帮助我们提高性能，因为经常执行的查询和执行时间较长的查询消耗了大量资源。优化这些查询可以提高性能，并在长期内节省成本。以下图表展示了性能概述中
    CPU 消耗的情况：
- en: '![](img/907d6721-f6e7-4809-af86-bda292f18c72.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/907d6721-f6e7-4809-af86-bda292f18c72.png)'
- en: 'Under performance list, we can see Recommendations based on performance history
    for our database. It will give us a list of Recommendations, along with the options
    to automatically apply these recommendations. In the Performance recommendation
    blade, we can see both new Recommendations and recommendations already applied,
    shown as follows:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在性能列表下，我们可以看到根据数据库的性能历史记录提供的推荐事项。它会给出推荐的列表，并提供自动应用这些建议的选项。在性能推荐面板中，我们可以看到新的推荐事项以及已应用的推荐，如下所示：
- en: '![](img/b68c4a19-0c70-4cd0-93a7-841ef3264c98.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b68c4a19-0c70-4cd0-93a7-841ef3264c98.png)'
- en: 'Query Performance Insight gives us very similar options to performance overview.
    The difference is that you can customize and edit graphs and dashboards in Query
    Performance Insight. You can change different metrics and time periods that will
    be displayed, helping you to observe performance over longer periods of time.
    The default blade for Query Performance Insight is shown here:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 查询性能洞察提供了与性能概览非常相似的选项。不同之处在于，你可以在查询性能洞察中自定义和编辑图表与仪表板。你可以更改显示的不同指标和时间段，帮助你在更长时间内观察性能。查询性能洞察的默认界面如下所示：
- en: '![](img/57123b54-39fb-4ba3-b86e-b7ff5092d7e9.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](img/57123b54-39fb-4ba3-b86e-b7ff5092d7e9.png)'
- en: 'Automatic tuning options is a dream come true for all database administrators.
    This option will use built-in intelligence, observing performance over time and
    applying machine learning to solutions to improve the performance of the database.
    The option can be automatically enabled on a server or subscription level. Further,
    it can be set on and off for individual databases. Settings available for automatic
    tuning are FORCE PLAN, CREATE INDEX, and DROP INDEX. If enabled, automatic tuning
    will analyze the performance and automatically apply changes that will improve
    performance. Examples of automatic tuning settings are shown here:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 自动调优选项是所有数据库管理员的梦想成真。此选项将使用内置的智能，观察性能随时间的变化，并应用机器学习解决方案来提高数据库性能。此选项可以在服务器或订阅级别自动启用。此外，还可以为单个数据库启用或禁用该选项。自动调优可用的设置包括FORCE
    PLAN、CREATE INDEX和DROP INDEX。如果启用，自动调优将分析性能并自动应用有助于提高性能的更改。以下是自动调优设置的示例：
- en: '![](img/5b8b29b9-59f0-4d19-97b7-9fd461cf549d.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b8b29b9-59f0-4d19-97b7-9fd461cf549d.png)'
- en: Azure SQL Database backup
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure SQL数据库备份
- en: A very important task for any database administrator is backup. This option
    is automatically enabled in Azure SQL Database. When a new database is created,
    geo-redundant storage is created in the process and backups are performed in this
    storage. This feature is provided automatically and free of charge. For Azure
    SQL Database, SQL Server backup technology is used to create full, differential,
    and transaction backups. Transaction backups are performed every 12 hours and
    differential backups every 5–10 minutes, depending on database size and activity.
    This allows us to have a point-in-time restore by restoring the last full backup
    before the point selected, all differential backups between the full backup and the
    point selected, and, finally, all transnational backups between the last differential
    backup and the point selected.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 对任何数据库管理员来说，备份是非常重要的任务。此选项在Azure SQL数据库中默认启用。当创建新的数据库时，会在过程中创建地理冗余存储，并在此存储中执行备份。此功能是自动提供的，且免费。对于Azure
    SQL数据库，使用SQL Server备份技术来创建完整、差异和事务备份。事务备份每12小时执行一次，差异备份则根据数据库大小和活动，每5至10分钟执行一次。这使得我们能够通过恢复所选时间点之前的最后一次完整备份、完整备份和所选时间点之间的所有差异备份，最后还原最后一次差异备份和所选时间点之间的所有事务备份，从而实现时间点恢复。
- en: The retention period for the backup depends on the database tier and can be
    from 7–35 days. There is also the option to enable **long-term retention backup**
    (**LTRB**) and keep backups for up to 10 years. The default backup is the option
    provided with no additional charge, but LTRB uses additional storage that is charged
    extra. However, there are situations in which we are required to keep a backup
    for a longer period of time and this option can be useful. Also, the price of
    storage is low, so this doesn't create a big addition to your bill.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 备份的保留期限取决于数据库层级，可从7天至35天不等。还可以启用**长期保留备份**（**LTRB**）选项，保留备份最长可达10年。默认备份是提供的无额外费用的选项，但LTRB使用额外的存储，且需要额外收费。然而，在某些情况下，我们需要长时间保留备份，这时此选项非常有用。此外，存储费用较低，因此不会对账单产生较大的影响。
- en: Another option directly connected to backups is database export. This allows
    you to keep an additional copy of your database in separate storage. This backup
    can be used to restore a database on a new server or another subscription. Export
    will create a BACPAC file that contains schema and data.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个与备份直接相关的选项是数据库导出。此功能允许你将数据库的额外副本保存在独立存储中。此备份可以用于在新服务器或另一个订阅中恢复数据库。导出将创建一个包含模式和数据的BACPAC文件。
- en: Other data services in Azure
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure中的其他数据服务
- en: SQL Server in VM and Azure SQL Database are just a fraction of the Azure data
    platform offering.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机中的SQL Server和Azure SQL数据库仅是Azure数据平台的一部分。
- en: 'When we talk about RDBMS in IaaS, we really don''t have any restrictions. We
    can create any type of VM with a number of different operating systems and install
    anything we want, such as Oracle, MySQL, PostgreSQL, and so on. There are also
    a number of images that include this software pre-installed. The same thing goes
    for NoSQL databases: we can install anything on our VM, or we can even choose
    an image that includes MongoDB, CouchDB, and many others.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们谈论IaaS中的RDBMS时，其实我们没有任何限制。我们可以创建任何类型的虚拟机，安装多种不同的操作系统，安装任何我们想要的软件，比如Oracle、MySQL、PostgreSQL等。也有许多包含预装该软件的镜像。同样，NoSQL数据库也是如此：我们可以在虚拟机上安装任何东西，或者选择一个已经包含MongoDB、CouchDB等的镜像。
- en: When talking about RDBMS in the PaaS model, we have also different options such
    as MySQL, PostgreSQL, SQL data warehouses, and others. Running NoSQL as PaaS also
    offers different options, including Azure Cosmos DB or MongoDB.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 当谈论PaaS模型中的RDBMS时，我们也有不同的选项，如MySQL、PostgreSQL、SQL数据仓库等。作为PaaS运行NoSQL也提供了不同的选项，包括Azure
    Cosmos DB或MongoDB。
- en: Azure data platform is extended with analytic services in Azure that also have
    multiple options for both IaaS or PaaS models.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Azure数据平台通过Azure的分析服务得到扩展，这些服务在IaaS或PaaS模型中都有多种选择。
- en: Overall, Microsoft Azure offers different options for data and analytics, whether
    you're migrating existing solutions or building a new cloud solution. You can
    choose between different IaaS and PaaS services and combine them for specific
    scenarios to get the best possible results.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，Microsoft Azure为数据和分析提供了不同的选项，无论你是迁移现有解决方案还是构建新的云解决方案。你可以在不同的IaaS和PaaS服务之间进行选择，并结合它们为特定场景提供最佳的结果。
- en: 'A screenshot showing some of the database and analytics options in Azure follows:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是显示Azure中一些数据库和分析选项的截图：
- en: '![](img/588a1e6a-1dde-4b33-a85c-923c104236ff.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/588a1e6a-1dde-4b33-a85c-923c104236ff.png)'
- en: Summary
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: The Azure data platform offers multiple options when deciding to use both IaaS and
    PaaS. Running databases in IaaS offers more control, but requires more maintenance
    and administration as well. DaaS has many features which make a database administrator's
    life easier, but it lacks support to run certain features and legacy applications.
    The bottom line is that we need to decide how we want to proceed and assess the
    ideal option for our scenario based on the options required by our solution and
    offered by different data services.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: Azure数据平台在选择同时使用IaaS和PaaS时提供了多种选项。在IaaS中运行数据库提供了更多的控制，但也需要更多的维护和管理。DaaS具有许多使数据库管理员生活更轻松的功能，但它不支持运行某些功能和遗留应用程序。最重要的是，我们需要决定如何继续，并根据我们解决方案所需的选项以及不同数据服务提供的选项来评估理想的选择。
- en: Once data is in the cloud, Azure offers many analytics options which can help
    us to extend our solution. Again, we can choose between different IaaS and PaaS
    services to select the best fit for us.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦数据进入云端，Azure提供了许多分析选项，这些选项可以帮助我们扩展我们的解决方案。同样，我们可以在不同的IaaS和PaaS服务中进行选择，挑选最适合我们的服务。
- en: In previous chapters, we discussed how to set up applications and data in Azure. Creating
    and designing new applications is great, but not always an option. In most cases, the journey
    starts with moving existing solutions from on-premises to the cloud. In the next
    chapter, we are going to explain options available for migrating our existing
    applications and databases to Azure.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在前几章中，我们讨论了如何在Azure中设置应用程序和数据。创建和设计新应用程序是很棒的，但并不总是可行的。在大多数情况下，旅程从将现有解决方案从本地迁移到云开始。在下一章中，我们将解释迁移现有应用程序和数据库到Azure的可用选项。
- en: Questions
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Database in Azure can be run as...
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Azure中，数据库可以运行为...
- en: IaaS
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: IaaS
- en: PaaS
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: PaaS
- en: Both
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Azure Virtual Machine with SQL is different from VM without SQL because of...
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 带有SQL的Azure虚拟机与不带SQL的虚拟机不同，因为...
- en: SQL server configuration
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: SQL服务器配置
- en: Amount of memory and CPU
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 内存和CPU的数量
- en: Its name
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它的名称
- en: Azure SQL Database is also called...
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure SQL数据库也叫做...
- en: Database as a Service
  id: totrans-81
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据库即服务
- en: SQL as a Service
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: SQL即服务
- en: Data as a Service
  id: totrans-83
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据即服务
- en: The Azure SQL Database tier can be measured in...
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure SQL数据库的层级可以以...来衡量
- en: DTUs
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: DTU
- en: vCores
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: vCores
- en: Both
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: You can run a query on Azure SQL Database with...
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以在Azure SQL数据库上运行查询，使用...
- en: SQL Server Management Studio
  id: totrans-89
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: SQL Server管理工作室
- en: Query Editor in Azure Portal
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure门户中的查询编辑器
- en: Both
  id: totrans-91
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: To connect to Azure SQL Database, you need to...
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要连接到Azure SQL数据库，你需要...
- en: Add an IP address to a firewall rule
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向防火墙规则添加IP地址
- en: Allow an IP in VNet
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在VNet中允许IP
- en: Allow an IP in the master database
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主数据库中允许IP
- en: To create an Azure SQL Database replica, you can use...
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建 Azure SQL 数据库副本，您可以使用...
- en: Database backup
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据库备份
- en: Database export
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据库导出
- en: Geo-replication
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 地理复制
- en: To create a highly available Azure SQL Database, you need to create a...
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建一个高度可用的 Azure SQL 数据库，您需要创建一个...
- en: Failover group
  id: totrans-101
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 故障切换组
- en: Failover cluster
  id: totrans-102
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 故障切换集群
- en: Always-On
  id: totrans-103
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 常开
- en: To mask columns in Azure SQL Database, you use...
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在 Azure SQL 数据库中遮蔽列，您可以使用...
- en: Transparent data encryption
  id: totrans-105
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 透明数据加密
- en: Dynamic data masking
  id: totrans-106
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 动态数据遮蔽
- en: Data classification
  id: totrans-107
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据分类
- en: To detect potential threats to your database, you use...
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了检测数据库的潜在威胁，您可以使用...
- en: Vulnerability assessment
  id: totrans-109
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 漏洞评估
- en: Advanced threat protection
  id: totrans-110
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 高级威胁防护
- en: Both
  id: totrans-111
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Technical requirements
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'For this chapter, you''ll need:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 本章所需内容：
- en: An Azure subscription
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 Azure 订阅
- en: A local server running Windows Server 2012 R2 or later
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个运行 Windows Server 2012 R2 或更高版本的本地服务器
- en: A Hyper-V Server
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 Hyper-V 服务器
- en: A local instance of SQL Server 2012 or later
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个本地的 SQL Server 2012 或更高版本实例
- en: Azure Storage
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 存储
- en: Azure Storage is a service that plays a very important part in Microsoft Azure.
    Almost all Azure services use storage in one form or another. In some cases, it's
    obvious that storage is used, in others it's a service in the background we don't
    realize even exists.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 存储是 Microsoft Azure 中一个非常重要的服务。几乎所有 Azure 服务都以某种形式使用存储。在某些情况下，存储的使用是显而易见的，而在其他情况下，它则是一个我们未曾察觉、默默运行的后台服务。
- en: For example, if we create a new VM, virtual disks are created in the process.
    These disks are stored in Azure Storage. If managed disks are used, storage is
    created in the background and not visible. If we don't use managed disks, storage
    created in the process is shown among resources, since managing storage is our
    responsibility when managed disks are not used.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果我们创建一个新的虚拟机，虚拟磁盘将在此过程中创建。这些磁盘会存储在 Azure 存储中。如果使用托管磁盘，存储会在后台创建且不可见。如果我们不使用托管磁盘，创建过程中产生的存储将显示在资源中，因为当没有使用托管磁盘时，存储的管理由我们负责。
- en: Similar to this, when any PaaS resource is created, storage is created in the
    background. In most PaaS cases, storage is not directly visible, but we can see
    the amount of storage available and used in the resource blade. For example, Azure
    SQL database or Azure App Service plan have a certain amount of resources available
    depending on the tier. We don't have direct access to storage management but we
    can see information about storage space.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，当任何 PaaS 资源被创建时，存储会在后台创建。在大多数 PaaS 案例中，存储不可直接看到，但我们可以在资源面板中看到可用和使用的存储量。例如，Azure
    SQL 数据库或 Azure 应用服务计划会根据不同的层级提供一定数量的资源。我们没有直接访问存储管理的权限，但可以看到关于存储空间的信息。
- en: But Azure Storage can be used as stand alone service and managed independently.
    In order to explain this service, let's start with creating a new Azure Storage
    account.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 但 Azure 存储也可以作为独立服务使用并进行独立管理。为了说明这个服务，我们先从创建一个新的 Azure 存储账户开始。
- en: Azure Recovery Service
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 恢复服务
- en: 'Another service to help migration to the cloud is the Azure Recovery Service.
    This service contains features that can help us move data to the cloud:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个帮助迁移到云的服务是 Azure 恢复服务。这个服务包含一些功能，能够帮助我们将数据迁移到云端：
- en: Azure Backup
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 备份
- en: Azure Site Recovery
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 站点恢复
- en: Both services aren't only used to move data to the cloud but to protect both
    Azure and on-premises resources. Their primary purpose is in fact to protect resources
    but once we have data in the cloud, this data can be used to perform migration.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 这两项服务不仅用于将数据迁移到云端，还用于保护 Azure 和本地资源。它们的主要目的是保护资源，但一旦我们将数据存储在云中，这些数据也可以用于迁移操作。
- en: Creating a recovery service vault
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建恢复服务保管库
- en: 'In order to start using the Azure recovery service, we must create a Recovery
    Services vault. All usual parameters are needed: Name, Subscription, Resource
    group, and Location. Note that Location is very important if you want to protect
    Azure resources. You will not be able to protect resources that are in the same
    location as the recovery services vault. A screenshot showing an example of parameters
    for recovery services vault is given here:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 为了开始使用 Azure 恢复服务，我们必须创建一个恢复服务保管库。需要提供所有常规参数：名称、订阅、资源组和位置。请注意，如果您想保护 Azure 资源，位置非常重要。您将无法保护与恢复服务保管库位于同一位置的资源。下面是一个示例截图，展示了恢复服务保管库的参数设置：
- en: '![](img/9fbcd0b0-2b4d-4556-998e-128e5ea3d712.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9fbcd0b0-2b4d-4556-998e-128e5ea3d712.png)'
- en: Creating an Azure Storage account
  id: totrans-131
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个 Azure 存储账户
- en: In order to create an Azure storage account, we need to provide a Name, Deployment
    model, Account kind, Location, Replication policy, Performance, Secure transfer
    required, Subscription, and Resource group. Subscription, Location, and Resource
    group are the usual settings needed for all Azure resources.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 为了创建 Azure 存储账户，我们需要提供名称、部署模型、账户类型、位置、复制策略、性能、安全传输要求、订阅和资源组。订阅、位置和资源组是所有 Azure
    资源所需的常见设置。
- en: The name must be unique within Azure as it's used to form an URL for your storage
    account. The URL is formed by adding the storage account name in front of the
    standard DNS suffix. For example, naming the storage account `packtdemo` would
    create the URL `packtdemo.core.windows.net` and therefore the storage account
    name must be unique.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 存储账户名称必须在 Azure 中唯一，因为它用于构建存储账户的 URL。URL 是通过将存储账户名称加在标准 DNS 后缀前面构成的。例如，将存储账户命名为
    `packtdemo` 会创建 URL `packtdemo.core.windows.net`，因此存储账户名称必须唯一。
- en: The Deployment model allows us to choose between Resource manager and Classic
    model. As the Classic model is outdated and using Resource manager is recommended,
    I advise you choose Resource manager whenever creating a new resource.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 部署模型允许我们在资源管理器和经典模型之间进行选择。由于经典模型已过时，推荐使用资源管理器，因此每次创建新资源时，我建议你选择资源管理器。
- en: Performance allows us to choose between Standard and Premium storage. This is
    basically choosing between HDD and SSD, but will also impact the price of your
    storage. Premium storage comes with SSD and significantly better performance,
    but the price increase is equally significant.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 性能选项让我们可以在标准存储和高级存储之间进行选择。这基本上是选择 HDD 和 SSD，但也会影响存储的价格。高级存储采用 SSD，提供显著更好的性能，但价格上涨同样显著。
- en: Secure transfer required allows us to choose between enabling and disabling
    this option. Enabling will require all incoming requests to our storage to be
    done over HTTPS and automatically blocking any requests coming over HTTP. The
    feature is very similar to Allow only HTTPS in Azure web apps. As this feature
    is security related, I recommend enabling this option.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 安全传输要求让我们选择启用或禁用此选项。启用时，所有传入的请求都必须通过 HTTPS 完成，并自动阻止任何通过 HTTP 的请求。此功能类似于 Azure
    Web 应用中的“仅允许 HTTPS”。由于此功能与安全性相关，我建议启用此选项。
- en: 'A screenshot with Azure Storage account options is shown here:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 这里显示了一张带有 Azure 存储账户选项的截图：
- en: '![](img/5b486daf-03f1-4bb9-8f7d-43336238d8d2.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b486daf-03f1-4bb9-8f7d-43336238d8d2.png)'
- en: Now we come to a couple of settings that are related only to the Azure Storage
    account. Even through the performance option is also related directly to storage,
    we can see the option to choose storage performance in other services too, such
    as VMs or even some PaaS resources. Options unique to the Storage account are
    account kind and replication.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将介绍一些仅与 Azure 存储账户相关的设置。尽管性能选项也直接与存储相关，我们还可以在其他服务中看到选择存储性能的选项，例如虚拟机或某些
    PaaS 资源。仅与存储账户相关的选项有账户类型和复制策略。
- en: '**Account kind** allows us to choose between three options:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '**账户类型** 让我们在三种选项之间进行选择：'
- en: Storage (general purpose v1)
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储（通用目的 v1）
- en: StorageV2 (general purpose v2)
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储V2（通用目的 v2）
- en: Blob storage
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Blob 存储
- en: General purpose v2 storage supports all features that are supported by general
    purpose v1, and brings some newer features. It's recommended you use general purpose
    v2, especially if you want to use the latest APIs and features such as access
    tier, that allows you to use hot and cold storage.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 通用目的 v2 存储支持所有通用目的 v1 支持的功能，并带来了一些更新的功能。特别是如果你想使用最新的 API 和功能，比如访问层，推荐使用通用目的
    v2 存储，这样你可以使用热存储和冷存储。
- en: Hot and cold storage allows you to choose what kind of access tier you want
    to use based on the data you are storing. Hot costs more per GB stored but transactions
    to storage are lower. Cold costs less per GB stored but transactions to storage
    come with higher prices. This makes the cold access tier more suitable for archive
    and the hot access tier for active storage. What's great about this feature is
    that you can switch between access tiers and change from one to another at any
    time.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 热存储和冷存储让你可以根据存储的数据选择你想要使用的访问层。热存储每 GB 存储的费用较高，但存储事务的费用较低。冷存储每 GB 存储的费用较低，但存储事务的费用较高。因此，冷存储更适合用于归档，而热存储则适用于活跃的存储。这个功能的优势在于，你可以随时在不同的访问层之间切换，进行更改。
- en: An upgrade from general purpose v1 to general purpose v2 can be made at any
    time (but not the other way around) in case you already have a storage account
    in v1 and want to benefit from features of v2\. However, there are some cases
    in which you need to use v1 as the only option. For example, when classic deployment
    is needed (general purpose v2 is only supported in resource manager), or where
    you need to use an older storage service REST API.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 从通用目的 v1 升级到通用目的 v2 可以在任何时候进行（但不能反向操作），如果您已经拥有 v1 存储帐户并希望受益于 v2 的功能。然而，在某些情况下，您需要使用
    v1 作为唯一选项。例如，当需要经典部署时（通用目的 v2 仅在资源管理器中受支持），或者当您需要使用较旧的存储服务 REST API 时。
- en: A Blob storage account supports the same features as general purpose v2 when
    it comes to block blobs, but are limited only to block blobs; they don't support
    page blobs. As the price is very similar, it's recommended you use general purpose
    v2 storage as this comes with the same price but more options.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: Blob 存储帐户在处理块 Blob 时，支持与通用目的 v2 相同的功能，但仅限于块 Blob，不支持页面 Blob。由于价格非常相似，建议使用通用目的
    v2 存储，因为它具有相同的价格但更多的选项。
- en: 'Options for account kind are shown in the screenshot here:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 帐户类型的选项如下图所示：
- en: '![](img/b43a14f0-8006-4e4e-8e45-e2f7eebc95ab.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b43a14f0-8006-4e4e-8e45-e2f7eebc95ab.png)'
- en: 'Replication comes with three options, which are the same as account kind. We
    can choose between:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 复制有三种选项，这些选项与帐户类型相同。我们可以在以下选项中进行选择：
- en: Locally-redundant storage (LRS)
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本地冗余存储（LRS）
- en: Geo-redundant storage (GRS)
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地理冗余存储（GRS）
- en: Read-access geo-redundant storage (RA-GRS)
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只读访问地理冗余存储（RA-GRS）
- en: LRS is based on a strategy similar to availability set and availability zones
    for VMs. Additional copies of data are kept across the Azure Datacenter to provide
    durability and redundancy in case of hardware faults or updates. It's designed
    to provide SLA of 99.999999999% (11 9s). All data is kept inside a single Datacenter,
    and possible failover is triggered automatically.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: LRS 基于类似于虚拟机的可用性集和可用性区域的策略。数据的额外副本保存在 Azure 数据中心中，以在硬件故障或更新时提供持久性和冗余。它旨在提供 99.999999999%（11个9）的
    SLA。所有数据都保存在单一的数据中心内，并且可能的故障切换会自动触发。
- en: GRS is designed in a very similar fashion, with the difference being that copies
    are in different Azure Datacenters which are, thousands of miles away from the
    original Datacenter. Because of this, additional durability is in place with an
    SLA of 99.99999999999999% (16 9s) . Redundant copy is available for access only
    when automatic failover is triggered.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: GRS 的设计方式与 LRS 非常相似，不同之处在于副本存储在不同的 Azure 数据中心，这些数据中心距离原始数据中心数千英里。由于这一点，增加了持久性，SLA
    为 99.99999999999999%（16个9）。冗余副本仅在自动故障切换触发时可供访问。
- en: RA-GRS is designed in the same way as GRS, but with the difference that redundant
    copy is available for read, even when failover isn't activated.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: RA-GRS 与 GRS 的设计方式相同，不同之处在于即使未激活故障切换，冗余副本也可以进行读取。
- en: 'Replication options are shown in following screenshot:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 复制选项如下截图所示：
- en: '![](img/b4677b4e-8e30-47a8-a602-e5fa6542ad67.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b4677b4e-8e30-47a8-a602-e5fa6542ad67.png)'
- en: Additional options for the Azure Storage account are virtual networks and data
    lake storage v2.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 存储帐户的其他选项包括虚拟网络和数据湖存储 v2。
- en: 'If we enable Virtual networks, we can select an existing VNet (or create a
    new one) and select a Subnets. This will join our storage to the selected subnet
    on the selected VNet and assign a private IP address to our storage, allowing
    us to access storage over a private network rather then over the internet. Data
    lake storage v2 is in preview, and can be enabled only if a few requirements are
    met. We need to choose general purpose v2 storage, it''s available only in a limited
    number of Azure Datacenters, and preview must be pre-approved. These options are
    shown in the following screenshot:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们启用虚拟网络，我们可以选择现有的虚拟网络（或创建一个新网络）并选择子网。这样，我们的存储将加入到选定虚拟网络上的子网，并为我们的存储分配一个私有
    IP 地址，允许我们通过私有网络而不是互联网访问存储。数据湖存储 v2 目前是预览版，仅在满足一些要求的情况下可以启用。我们需要选择通用目的 v2 存储，它仅在有限数量的
    Azure 数据中心中可用，并且预览版必须经过预批准。以下截图展示了这些选项：
- en: '![](img/22cae5ae-c5c6-4d17-85ff-3efa72bfc3a3.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](img/22cae5ae-c5c6-4d17-85ff-3efa72bfc3a3.png)'
- en: Note that account kind, replication, and performance will impact the price of
    Azure Storage. Location is also a factor as not all resources cost the same in
    all Azure Datacenters, but this doesn't have as much impact as the other three
    options.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，帐户类型、复制和性能会影响 Azure 存储的价格。位置也是一个因素，因为并非所有资源在所有 Azure 数据中心的费用相同，但这对价格的影响不如其他三个选项重要。
- en: Deployment of the Azure Storage account is fast and is usually done in under
    one minute.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 存储帐户的部署非常迅速，通常在一分钟内完成。
- en: Azure Storage settings
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 存储设置
- en: Once the Azure Storage account is created, we can use different options to manage
    it. Some of the options are similar to the options available to other Azure resources,
    so let's focus on the Azure Storage account unique options.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 Azure 存储帐户后，我们可以使用不同的选项来管理它。一些选项与其他 Azure 资源的选项相似，因此我们将重点关注 Azure 存储帐户的独特选项。
- en: The first option under Settings is Access keys. Access keys are used to authenticate
    access to your Azure Storage account. They are usually used to enable access from
    applications, so you can find connection strings here along with access keys.
    There are two access keys available, and you can regenerate them if you think
    the original keys have been stolen or compromised.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 设置中的第一个选项是访问密钥。访问密钥用于验证对 Azure 存储帐户的访问。它们通常用于启用应用程序访问，因此你可以在这里找到连接字符串和访问密钥。共有两个访问密钥，如果你认为原始密钥已被窃取或泄露，可以重新生成它们。
- en: '**Cross-origin resource sharing** (**CORS**) allows you to define trusted domains.
    Web browsers implement security restrictions that prevent applications from calling
    APIs in a different domain. CORS provides ways for the original domain to securely
    access an API from another domain.'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '**跨源资源共享**（**CORS**）允许你定义受信任的域。Web 浏览器实施安全限制，防止应用程序调用来自不同域的 API。CORS 提供了原始域安全访问来自其他域的
    API 的方式。'
- en: Configuration allows us to change some of the settings that are available when
    creating the Storage account. Under this option, we can upgrade storage from general
    purpose v1 to v2, we can change performance, and replication settings, and enable
    or disable secure transfer requirements.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 配置允许我们更改一些在创建存储帐户时可用的设置。在此选项下，我们可以将存储从通用目的 v1 升级到 v2，修改性能和复制设置，启用或禁用安全传输要求。
- en: Azure Storage is automatically encrypted and protects data at rest. Automatic
    encryption is done using using Microsoft Managed Keys for Azure blobs, tables,
    files and queues. However, the encryption option allows us to bring our own key
    and encrypt storage with that key instead.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 存储会自动加密并保护静态数据。自动加密使用 Microsoft 管理密钥对 Azure 的 Blob、表、文件和队列进行加密。然而，加密选项允许我们使用自定义密钥进行加密。
- en: '**Shared access signature** (**SAS**) provides an access key that lasts a limited
    time. We can use this key to provide temporary access to our storage and can define
    how long this access is going to last. After the key expires, it can''t be used
    again.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '**共享访问签名**（**SAS**）提供了一个有限时长的访问密钥。我们可以使用这个密钥为存储提供临时访问，并定义访问持续的时间。密钥过期后，无法再次使用。'
- en: Under Firewall and Virtual network settings, we can change networking and access
    settings for our storage. We can attach storage to VNet (and subnet) or change
    the VNet storage it's associated with. Using firewall, we can block access to
    our storage to anyone who isn't coming from a trusted IP address. We can white
    list our on-premises IP addresses or other trusted IP addresses to allow Azure
    Storage access only from these addresses and to prevent anyone else from gaining
    access.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在防火墙和虚拟网络设置下，我们可以更改存储的网络和访问设置。我们可以将存储附加到虚拟网络（VNet）和子网，或者更改它所关联的虚拟网络。通过防火墙，我们可以阻止来自不受信任
    IP 地址的存储访问。我们可以将本地 IP 地址或其他受信任的 IP 地址列入白名单，只允许这些地址访问 Azure 存储，并防止其他人访问。
- en: Properties, Locks, and Automation scripts are options available to all Azure
    resources.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 属性、锁定和自动化脚本是所有 Azure 资源的可用选项。
- en: The next set of options is related to blob service. Here we have Blobs, Custom
    domains, Soft delete, Azure CDN, and Azure search.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 下一组选项与 Blob 服务相关。这里有 Blobs、定制域、软删除、Azure CDN 和 Azure 搜索。
- en: Blobs allow you to see the current list of blobs in the storage account and
    perform actions such as creating a new blob or deleting an existing one. Further,
    you can access a blob and see the list of files inside the blob and perform actions
    on files such as download or delete.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: Blob允许您查看存储帐户中当前的Blob列表，并执行如创建新Blob或删除现有Blob等操作。此外，您可以访问Blob并查看其中的文件列表，并对文件执行操作，如下载或删除。
- en: Custom domain allows you to use a custom domain with your storage account. Instead
    of using the provided DNS, you can set up CNAME on your custom domain and point
    it to your storage to start using the custom domain.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义域名允许您为存储帐户使用自定义域名。您可以设置CNAME记录，将其指向您的存储帐户，从而开始使用自定义域名，而无需使用提供的DNS。
- en: Soft delete allows you to set up a retention policy for your storage. If enabled,
    the default retention policy is seven days but this can be change to up to 365
    days. Soft delete will give you ability to recover any deleted blobs. This extends
    to blobs that are deleted as result of overwrite, so you can recover deleted blobs
    or older versions of blobs.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 软删除允许您为存储设置保留策略。如果启用，默认的保留策略是七天，但可以更改为最长365天。软删除使您能够恢复任何已删除的Blob。这也适用于由于覆盖而删除的Blob，因此您可以恢复已删除的Blob或Blob的旧版本。
- en: Azure CDN and Azure search are options to link these Azure services to your
    storage account. Azure CDN is used to cache storage content in order to increase
    performance and minimize latency. Azure search is a fully managed cloud search
    service that provides a better user experience.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: Azure CDN和Azure搜索是将这些Azure服务链接到您的存储帐户的选项。Azure CDN用于缓存存储内容，从而提高性能并减少延迟。Azure搜索是一个完全托管的云搜索服务，提供更好的用户体验。
- en: The following options allow us to manage the file service, table service, and
    queue service. For each of these services, we can see a list of existing file
    services in the storage account and we can perform different operations such as
    Delete existing service, Create a new one or Set up access policies.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 以下选项允许我们管理文件服务、表服务和队列服务。对于这些服务中的每一个，我们可以看到存储帐户中现有文件服务的列表，并且可以执行不同的操作，如删除现有服务、创建新服务或设置访问策略。
- en: Migrating a database to the cloud
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将数据库迁移到云端
- en: Once we have our Storage account, we can start loading data. This can be any
    type of file, we can use storage as a staging phase in which we prepare uploaded
    files before they are actually used, or we can upload files that are directly
    used by our applications.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们拥有存储帐户，就可以开始加载数据。这可以是任何类型的文件，我们可以将存储用作暂存阶段，在此阶段我们准备上传的文件，之后这些文件将被实际使用，或者我们可以上传直接由应用程序使用的文件。
- en: Over the years, I've seen many organizations using Azure Storage as a backup
    location for on-premises SQL databases. This is a convenient way to start our
    cloud journey as we get relatively cheap storage that is offsite and encrypted.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 多年来，我看到许多组织使用Azure存储作为本地SQL数据库的备份位置。这是一种便捷的方式，可以让我们开始云端之旅，因为它提供了相对便宜、离线且加密的存储。
- en: Once databases are stored to cloud, the next step would be to use backups to
    restore a database in Azure and start using them either as IaaS or PaaS.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦数据库存储到云端，下一步将是使用备份恢复Azure中的数据库，并开始将其作为IaaS或PaaS使用。
- en: Let's see how we can back up our database directly to Azure Storage.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何直接将数据库备份到Azure存储。
- en: Backing up a database to storage
  id: totrans-184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将数据库备份到存储
- en: 'In order to back up the database to Azure Storage, first we need to open **SQL
    Server Management Studio** (**SSMS**), select the database we want to back up,
    and then select Tasks | Back Up.... The first step is shown in this screenshot:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将数据库备份到Azure存储，首先需要打开**SQL Server Management Studio**（**SSMS**），选择要备份的数据库，然后选择任务
    | 备份.... 第一步在此截图中显示：
- en: '![](img/b9eefea3-b389-4148-a63f-26924e56016c.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b9eefea3-b389-4148-a63f-26924e56016c.png)'
- en: 'New windows will open with options to select the Database (this will already
    be selected if we selected a proper database in the first step, but can be changed
    or we can select multiple databases), Backup type (usually a full backup is recommended)
    and finally, Destination. The default option is Disk, and we need to change this
    to an URL. A screenshot of these options is shown here:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 新窗口将打开，提供选项以选择数据库（如果在第一步中选择了正确的数据库，则该选项已经被选中，但可以更改，或者我们可以选择多个数据库）、备份类型（通常推荐全量备份）以及最后的目标位置。默认选项是磁盘，我们需要将其更改为URL。以下是这些选项的截图：
- en: '![](img/9995ab5d-15c7-4611-8060-78b475a5ab27.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9995ab5d-15c7-4611-8060-78b475a5ab27.png)'
- en: 'After selecting the URL as the destination, we must select add in order to
    provide the path. This will open a new window in which we need to provide our
    Azure account information in order to access our Azure subscription. After this
    is done, we have access to our Azure subscription from SSMS and can select our
    storage account and blob where the backup will be stored. As **Shared Access Signature**
    (**SAS**) is used to perform the backup, we must create a new SAS and provide
    a date of expiration. Setting up a destination for the backup is shown in this
    screenshot:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 URL 作为目标后，我们必须选择添加，以提供路径。这将打开一个新窗口，我们需要提供 Azure 帐户信息以访问 Azure 订阅。完成后，我们可以从
    SSMS 访问 Azure 订阅，并选择存储账户和 Blob 来存储备份。由于备份是通过 **共享访问签名**（**SAS**）执行的，因此我们必须创建一个新的
    SAS 并提供过期日期。设置备份目标的过程如以下截图所示：
- en: '![](img/98b57bbd-f4e2-4650-8d0e-3d93fac23a11.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](img/98b57bbd-f4e2-4650-8d0e-3d93fac23a11.png)'
- en: 'Finally, we click OK and the backup is performed. Time to perform the backup
    depends on bandwidth, database size, and storage type. In this case, the storage
    type is usually standard, as storing backups to premium storage is overkill and
    we would be paying a premium service for an archive. After the backup is completed,
    we can see the file information in the Azure portal under the storage account
    in the blob we selected. An example of the file information in the Azure portal
    is shown here:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们点击确定，执行备份。备份所需的时间取决于带宽、数据库大小和存储类型。在此案例中，存储类型通常是标准存储，因为将备份存储到高级存储是多余的，并且我们为存档付费的服务是高端的。备份完成后，我们可以在
    Azure 门户中看到存储账户下所选 Blob 中的文件信息。以下是 Azure 门户中文件信息的示例：
- en: '![](img/83af4d50-b3e9-4079-a430-e56c1c18c7a7.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](img/83af4d50-b3e9-4079-a430-e56c1c18c7a7.png)'
- en: After the backup is performed, we can use this backup to restore the database
    in Azure. However, full backup can be only restored on an SQL Server running on
    an Azure Virtual Machine (IaaS). In order to restore a backup in the Azure SQL
    Database (PaaS), we must use BACPAC. BACPAC contains data and metadata of the
    SQL database. The process to backup BACPAC to Azure Storage is similar to the
    process of creating a full backup of the database.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 备份完成后，我们可以使用该备份在 Azure 中恢复数据库。然而，完整备份只能恢复到运行在 Azure 虚拟机（IaaS）上的 SQL Server 中。为了在
    Azure SQL 数据库（PaaS）中恢复备份，我们必须使用 BACPAC。BACPAC 包含 SQL 数据库的 数据和元数据。将 BACPAC 备份到
    Azure 存储的过程与创建数据库完整备份的过程类似。
- en: Migrating a database to Azure SQL
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将数据库迁移到 Azure SQL
- en: Creating backup and restoring it is not the only option on how to migrate the
    database to Azure. This process can be done without using a backup, directly migrating
    the database to Azure.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 创建备份并恢复并不是迁移数据库到 Azure 的唯一选项。此过程可以在不使用备份的情况下，直接将数据库迁移到 Azure。
- en: 'In order to do this, the first step is to select the database, click on bold
    Tasks and select the option to Deploy Database to Microsoft Azure SQL Database
    in SSMS. The first step is shown in this screenshot:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一目标，第一步是选择数据库，点击加粗的任务（**Tasks**）并选择在 SSMS 中将数据库部署到 Microsoft Azure SQL
    数据库的选项。第一步如以下截图所示：
- en: '![](img/52ecb141-3a47-4719-89ee-c7365bc0d09e.png)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![](img/52ecb141-3a47-4719-89ee-c7365bc0d09e.png)'
- en: 'The second step is to connect to your Azure SQL Server. In order to do this,
    we select Connect... in the new window that opened after selecting the options
    in the first step. This window is shown in this screenshot:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 第二步是连接到你的 Azure SQL Server。为此，我们需要在选择第一步中的选项后，选择新窗口中的连接...。此窗口如以下截图所示：
- en: '![](img/35609ae5-65e1-4bcc-b09e-1e0d0fea3e4b.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](img/35609ae5-65e1-4bcc-b09e-1e0d0fea3e4b.png)'
- en: 'In order to connect to the Azure SQL database, we need to provide the server
    URL, username, and password. Make sure that the public IP address of your server
    is added to the firewall rule of your Azure SQL Server, otherwise you will not
    be able to connect. An example of connection options is shown in this screenshot:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 为了连接到 Azure SQL 数据库，我们需要提供服务器 URL、用户名和密码。确保你的服务器的公共 IP 地址已添加到 Azure SQL Server
    的防火墙规则中，否则将无法连接。以下是连接选项的示例：
- en: '![](img/3f7bd223-ce50-45de-a8c4-7f3121012cd9.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f7bd223-ce50-45de-a8c4-7f3121012cd9.png)'
- en: 'After a connection is established, we are back to the window from the previous
    step. Finally, we must provide the database tier for the Azure SQL database that
    will be used for migration (a new database is created). An example of the database
    size option is shown here:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 连接建立后，我们回到上一步的窗口。最后，我们必须提供将用于迁移的 Azure SQL 数据库的数据库层（将创建一个新数据库）。以下是数据库大小选项的示例：
- en: '![](img/009235ab-f735-4eec-96c2-8b0de161f6d0.png)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![](img/009235ab-f735-4eec-96c2-8b0de161f6d0.png)'
- en: 'After the process is completed, we will receive a message about successful
    tasks. the time needed to complete migration can depend on many factors such as
    database size, bandwidth, and Azure SQL database tier. Note that selecting too
    small a tier (if we are migrating a large database) will result in an error as
    the performance of the target database can be insufficient to handle the workload
    needed to perform the migration of a large database. A screenshot of a successful
    migration is shown here:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 处理完成后，我们将收到关于任务成功的消息。完成迁移所需的时间可能会受到多个因素的影响，如数据库大小、带宽和 Azure SQL 数据库层级。请注意，选择过小的层级（如果我们迁移的是大型数据库）将导致错误，因为目标数据库的性能可能不足以处理迁移大型数据库所需的工作负载。成功迁移的截图如下所示：
- en: '![](img/f3507786-b1ff-4943-a8a9-22e83f8b8fb8.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f3507786-b1ff-4943-a8a9-22e83f8b8fb8.png)'
- en: 'After migration is completed, we can connect to the Azure SQL server with SSMS
    and find the database that is migrated, as shown here:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 迁移完成后，我们可以使用 SSMS 连接到 Azure SQL 服务器，并找到已迁移的数据库，如下所示：
- en: '![](img/dc67a728-c737-4957-84ca-72bf9841628f.png)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dc67a728-c737-4957-84ca-72bf9841628f.png)'
- en: In some cases, migration will fail even when the proper Azure SQL database tier
    is selected. This is due to database incompatibility with Azure SQL database.
    For example, when using Azure SQL database, a clustered index is required (recommended
    for on-premises). If the database that is migrated, doesn't contain clustered
    indexes, migration will fail. Luckily, there is a tool that can help us perform
    assessment that will tell us about possible issues and problems on our database.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，即使选择了正确的 Azure SQL 数据库层级，迁移仍然会失败。这是由于数据库与 Azure SQL 数据库不兼容。例如，在使用 Azure
    SQL 数据库时，需要有聚集索引（对于本地部署的数据库推荐）。如果迁移的数据库没有聚集索引，迁移将会失败。幸运的是，有一个工具可以帮助我们进行评估，告诉我们数据库中可能存在的问题和问题。
- en: Database assessment
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据库评估
- en: To create an assessment of our database and make sure it's ready for migration,
    we can use Microsoft Data Migration Assistant. This is tool is free and can be
    downloaded from the Microsoft Download Center.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建我们数据库的评估并确保它准备好进行迁移，我们可以使用 Microsoft 数据迁移助手。这个工具是免费的，可以从 Microsoft 下载中心下载。
- en: 'After you install this tool, you can start a new project. Select Assessment,
    provide the Project name, and Source server type, and Target server type,. For
    source, select SQL Server and for target, select Azure SQL Database. An example
    for a new project is shown here:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 安装此工具后，您可以开始一个新项目。选择评估，提供项目名称，源服务器类型和目标服务器类型。对于源，选择 SQL Server，对于目标，选择 Azure
    SQL 数据库。新项目的示例如下所示：
- en: '![](img/05db4e83-f1e9-419d-b45f-c650c00b5313.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![](img/05db4e83-f1e9-419d-b45f-c650c00b5313.png)'
- en: 'The second step is to select assessment options. You can select to check compatibility
    and feature parity. Compatibility will check your database features and provide
    if there are any blocking issues or deprecated features preventing migration.
    Feature parity will check if there are any features or functions that are not
    supported. For example, an Azure SQL database doesn''t support SQL Server Reporting
    Service (SSRS), so if your application is using SSRS, this can cause an issue.
    I recommend selecting both options, as shown here:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 第二步是选择评估选项。您可以选择检查兼容性和功能一致性。兼容性将检查您的数据库功能，并提供是否存在任何阻止迁移的问题或已弃用的功能。功能一致性将检查是否有任何不受支持的功能或功能。例如，Azure
    SQL 数据库不支持 SQL Server Reporting Service (SSRS)，因此如果您的应用程序正在使用 SSRS，这可能会导致问题。我建议选择这两个选项，如下所示：
- en: '![](img/e8a1c420-8f6b-4f9d-8458-ed261506b21a.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e8a1c420-8f6b-4f9d-8458-ed261506b21a.png)'
- en: 'After selecting what to check, we need to provide a source that will be checked.
    In order to make an assessment, this tool needs access to the database, so we
    must provide the SQL Server, credentials, and database. Selected databases will
    be shown in the list along with the SQL Server version, as shown here:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 选择要检查的内容后，我们需要提供将要检查的源。为了进行评估，工具需要访问数据库，因此我们必须提供 SQL Server、凭据和数据库。选定的数据库将与
    SQL Server 版本一起显示在列表中，如下所示：
- en: '![](img/6ae4cf50-0733-41b6-b16a-ec061a737d8a.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6ae4cf50-0733-41b6-b16a-ec061a737d8a.png)'
- en: 'The time needed to perform assessment depends on database size and complexity,
    and it can take from a couple of minutes to a couple of hours. After assessment
    is completed, we''ll receive two reports. The first report is on feature parity,
    and an example is shown here:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 执行评估所需的时间取决于数据库的大小和复杂性，可能需要几分钟到几个小时不等。评估完成后，我们将收到两个报告。第一个报告是关于功能兼容性的，以下是示例：
- en: '![](img/e1c4bdd2-6266-4600-9a4a-61b1455d0347.png)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e1c4bdd2-6266-4600-9a4a-61b1455d0347.png)'
- en: 'The second report is on database compatibility. With a little luck, and if
    the maintenance of the database was performed regularly, you will get a report
    shown in the following example, showing there are no compatibility issues preventing
    you from migrating your database to Azure SQL Database:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个报告是关于数据库兼容性的。如果运气好，而且数据库的维护定期进行，你将得到以下示例中的报告，显示没有兼容性问题，允许你将数据库迁移到 Azure SQL
    数据库：
- en: '![](img/5d6ec5d4-ec57-4d47-a44d-5ee94c706459.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5d6ec5d4-ec57-4d47-a44d-5ee94c706459.png)'
- en: One of the possible compatibility issues is a clustered index. It was recommended
    you have a clustered index for each table in the database but with an Azure SQL
    database, this is a requirement. Another example are CLR functions that are not
    supported in an Azure SQL database.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 可能的兼容性问题之一是聚集索引。建议为数据库中的每个表都有一个聚集索引，但在 Azure SQL 数据库中，这是一个要求。另一个例子是 CLR 函数，它在
    Azure SQL 数据库中不被支持。
- en: An assessment tool can be used to make an assessment, not only for migration
    to Azure SQL Database but to other versions of SQL Server. So, if you are planning
    on migrating a database to a newer version of SQL Server (in Azure or on-premises),
    this tool can make assessment for these migrations as well.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用评估工具进行评估，不仅适用于迁移到 Azure SQL 数据库，还适用于其他版本的 SQL Server。所以，如果你计划将数据库迁移到新版 SQL
    Server（无论是在 Azure 还是本地部署），该工具也能对这些迁移进行评估。
- en: Microsoft Data Migration Assistant can be used to perform the migration of database
    as well. Note that the difference between this migration and migration through
    SSMS is that here the Azure SQL database must be created (empty Azure SQL database)
    prior to migration.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft 数据迁移助手也可以用于执行数据库迁移。请注意，使用此迁移与通过 SSMS 迁移的区别在于，这里必须先创建 Azure SQL 数据库（空的
    Azure SQL 数据库），然后才能进行迁移。
- en: As a third option for migration, there is the Azure Database Migration Service.
    This migration is in fact a data sync option as a database and schema must exist
    before running this service. Azure Database Migration Service allows you to link
    source and target database and copy data from the source to the target for a complete
    database or for selected tables.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 作为第三种迁移选项，Azure 数据库迁移服务也可以使用。实际上，这个迁移是一种数据同步选项，因为在运行此服务之前，必须先存在数据库和架构。Azure
    数据库迁移服务允许你链接源数据库和目标数据库，将数据从源复制到目标，适用于整个数据库或选择的表。
- en: Enabling Azure Backup
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用 Azure 备份
- en: Once the recovery services vault is created, we can start configuring. As mentioned,
    we have two different services and both services can be used to protect resources
    in Azure and on-premises.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦恢复服务库创建完成，我们就可以开始配置。如前所述，我们有两种不同的服务，且两种服务都可以用于保护 Azure 和本地资源。
- en: 'Let''s start with enabling Azure Backup on Azure resources. If we select that
    we want to protect workloads in Azure under the Azure Backup configuration, options
    for protections are Virtual machine, Azure FileShare (Preview), and SQL Server
    in Azure VM (Preview). Let''s select Virtual machine and continue. An example
    of Azure resources for Azure Backup is shown here:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从在 Azure 资源上启用 Azure 备份开始。如果我们选择保护 Azure 中的工作负载，Azure 备份配置中可选的保护项有：虚拟机、Azure
    文件共享（预览版）和 SQL Server 在 Azure VM 中（预览版）。我们选择虚拟机并继续。Azure 备份的 Azure 资源示例如下：
- en: '![](img/44920fcc-ead0-42db-829d-6bc3b124dfe1.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![](img/44920fcc-ead0-42db-829d-6bc3b124dfe1.png)'
- en: 'A list of resources available will be automatically provided. As Virtual machine are
    selected, this will be a list of Azure VMs. If Azure FileShare (Preview) was selected,
    this would be a list of Azure Storage accounts containing FileShare. We select
    the Virtual machine that we want to back up, as shown in the following screenshot:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 可用资源的列表将自动提供。选择虚拟机时，这将是一个包含 Azure 虚拟机的列表。如果选择的是 Azure 文件共享（预览版），那么将是一个包含文件共享的
    Azure 存储帐户列表。我们选择要备份的虚拟机，如下截图所示：
- en: '![](img/6d908565-88ab-4eb7-b750-52654e90979e.png)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6d908565-88ab-4eb7-b750-52654e90979e.png)'
- en: 'After backup is enabled, we can see a list of protected VMs under backup items.
    The list will also show the STATUS, the TYPE of protected resources, and other
    useful information as shown here:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 启用备份后，我们可以在备份项下查看受保护虚拟机的列表。该列表还将显示状态、受保护资源的类型以及其他有用信息，如下所示：
- en: '![](img/1730b578-9e66-4205-966a-506b885e006b.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1730b578-9e66-4205-966a-506b885e006b.png)'
- en: Backing up on-premises resources
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 备份本地资源
- en: Using Azure Backup to protect on-premises resources requires a little more work.
    After selecting on-premises resources in the Azure Backup configuration, we get
    a different list from the one when we selected Azure resources. We can choose
    between Files and folders, Hyper-V Virtual Machines, VMware Virtual Machines,
    Microsoft SQL Server, Microsoft SharePoint, Microsoft Exchange, System state,
    and Bare Metal Recovery.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Azure 备份保护本地资源需要多做一些工作。在 Azure 备份配置中选择本地资源后，我们会看到一个与选择 Azure 资源时不同的列表。我们可以选择文件和文件夹、Hyper-V
    虚拟机、VMware 虚拟机、Microsoft SQL Server、Microsoft SharePoint、Microsoft Exchange、系统状态和裸机恢复。
- en: 'After configuration in the Azure portal, we need to install the Recovery Service
    Agent, which will allow us to register on-premises resources in the recovery services
    vault. A screenshot of the Recovery Service Agent is shown here:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户进行配置后，我们需要安装恢复服务代理，它将允许我们在恢复服务库中注册本地资源。下面是恢复服务代理的截图：
- en: '![](img/16efa466-b625-47ad-9cbc-ce68a428a75a.png)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![](img/16efa466-b625-47ad-9cbc-ce68a428a75a.png)'
- en: 'To proceed with registration, we must provide Vault Credentials. Vault Credentials
    are provided in the form of a file that can be downloaded from the recovery services
    vault. After the Vault Credentials are provided, the Recovery Service Agent will
    automatically load backup vault information, as shown here:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 为了继续注册，我们必须提供库凭证。库凭证以文件的形式提供，可以从恢复服务库下载。提供库凭证后，恢复服务代理将自动加载备份库信息，如下所示：
- en: '![](img/91e1795b-ee63-4376-a665-d57b01d38857.png)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
  zh: '![](img/91e1795b-ee63-4376-a665-d57b01d38857.png)'
- en: 'The following step is to provide a passphrase that will be used to encrypt
    and decrypt the backup. A passphrase must be a minimum of 16 characters and will
    be stored in the location of your choice. Make sure that you know where your passphrase
    is located. Otherwise, you will not be able to restore any of your backups, if
    needed. The process to create a passphrase is shown here:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是提供用于加密和解密备份的密码短语。密码短语必须至少包含 16 个字符，并将存储在您选择的位置。确保您知道密码短语存储的位置。否则，您将无法在需要时恢复任何备份。创建密码短语的过程如下所示：
- en: '![](img/c9c91152-0e73-4897-8492-4f899e17eb2a.png)'
  id: totrans-240
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c9c91152-0e73-4897-8492-4f899e17eb2a.png)'
- en: 'Once the server is registered in the recovery service vault, we can use Microsoft
    Azure Backup software on the target server (this can be installed on the client
    OS as well) to configure what and when we are going to back up. We can see the
    status of current jobs and perform other actions as shown here:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦服务器在恢复服务库中注册，我们可以在目标服务器（也可以安装在客户端操作系统上）上使用 Microsoft Azure Backup 软件，配置备份的内容和时间。我们可以查看当前任务的状态并执行其他操作，如下所示：
- en: '![](img/28998e28-745b-4dc4-be83-dcacac6c036e.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](img/28998e28-745b-4dc4-be83-dcacac6c036e.png)'
- en: 'To configure the backup job, we need to provide what we are going to back up.
    We can select an entire drive, or select specific files and folders as shown here:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置备份任务，我们需要提供备份的内容。我们可以选择整个驱动器，或选择特定的文件和文件夹，如下所示：
- en: '![](img/b82ee9a1-7080-4113-a039-2626cf0813c1.png)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b82ee9a1-7080-4113-a039-2626cf0813c1.png)'
- en: 'After selecting what to back up, we need to define when and the schedule when
    backup is going to be performed. We can select a weekly or daily backup (maximum
    is three times a day). An example of a schedule is shown here:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 选择备份内容后，我们需要定义备份的时间和计划。我们可以选择每周或每天备份（最多一天三次）。以下是一个计划示例：
- en: '![](img/f243b6cf-18b3-427a-bea9-034c4a9b6c26.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f243b6cf-18b3-427a-bea9-034c4a9b6c26.png)'
- en: 'After the schedule, we need to provide a retention policy. A retention policy
    defines how long our backups are going to be available and can be configured on
    a weekly, monthly and yearly basis. A default retention policy is shown here:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置了计划后，我们需要提供保留策略。保留策略定义了我们的备份将保持可用的时间，并可以按周、月和年进行配置。默认的保留策略如下所示：
- en: '![](img/2a211d42-430c-4efe-b932-9fe9cfc439a3.png)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2a211d42-430c-4efe-b932-9fe9cfc439a3.png)'
- en: 'The last option is to configure how the initial backup is going to be performed.
    As an initial backup usually means that a large amount of data is going to be
    backed up, we need to define if this is going to be performed directly over the
    network (possibly creating overload), or in stages by copying parts of data to
    Azure Storage and then copying data to the recovery vault. An example of options
    is shown here:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的选项是配置初始备份将如何执行。由于初始备份通常意味着将备份大量数据，我们需要定义是通过网络直接执行备份（可能会产生过载），还是通过分阶段将数据部分复制到Azure存储，然后再复制到恢复库。下面显示了一个选项示例：
- en: '![](img/fcf0764c-b8b5-4f0b-845e-bd41e5a1f969.png)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fcf0764c-b8b5-4f0b-845e-bd41e5a1f969.png)'
- en: Time to perform the initial backup depends on the size of data and the network
    bandwidth. After the initial backup, backups are performed as delta (copying only
    changes) and should not take long to complete. Note again that keeping the passphrase
    is very important, backups are encrypted and you will not be able to restore any
    data without the passphrase used to encrypt.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 执行初始备份的时间取决于数据的大小和网络带宽。初始备份后，备份会以增量的形式执行（仅复制更改），并且完成时间不应很长。再次强调，保存密码短语非常重要，因为备份是加密的，如果没有用于加密的密码短语，您将无法恢复任何数据。
- en: Azure Site Recovery
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure站点恢复
- en: ASR is not a backup solution but a **disaster recovery** (**DR**) site in the
    cloud. Having a DR site was never easier and never cheaper than having one in
    Azure. Most traditional DR sites involve equipment identical (or at least very
    similar) to the site that is protected, and cost around 80% of price of the original
    site. On the other hand, ASR is charged per protected node and for storage where
    data is stored, so comes very cheap. If recovery is activated in Azure, then compute
    prices is added for VMs. This way you are paying only for protection and compute
    prices only when failover occurs. If we create an on-premises DR site, we must
    pay for the hardware needed to run DR even when failover isn't in place but only
    used as protection.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: ASR不是一个备份解决方案，而是一个**灾难恢复**（**DR**）站点，位于云中。拥有一个DR站点从未像在Azure中那样变得更容易且更便宜。大多数传统的DR站点涉及与受保护站点相同（或至少非常相似）的设备，成本约为原站点价格的80%。另一方面，ASR按受保护节点和存储数据的存储收费，因此非常便宜。如果在Azure中启用恢复，那么还会按虚拟机的计算价格收费。通过这种方式，您只需在发生故障转移时支付保护和计算费用。如果我们创建本地DR站点，我们即使在没有发生故障转移时，也必须支付用于运行DR所需的硬件费用，但仅作为保护使用。
- en: ASR can also be used to perform the migration of VMs from on-premises to the
    cloud. As protecting Azure VMs is fairly simple, we will skip to protecting on-premises
    VMs and show how to protect local resources and use ASR to perform migration.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: ASR还可以用于将虚拟机从本地迁移到云端。由于保护Azure虚拟机相对简单，我们将跳过保护Azure虚拟机的部分，直接演示如何保护本地虚拟机资源并使用ASR进行迁移。
- en: Configuring ASR for on-premises resources
  id: totrans-255
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置ASR以保护本地资源
- en: 'To start creating disaster recovery in Azure, we must start by configuring
    ASR in the recovery services vault. Three steps are involved:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始在Azure中创建灾难恢复，我们必须首先在恢复服务库中配置ASR。涉及三个步骤：
- en: Prepare infrastructure
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准备基础设施
- en: Replicate application
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制应用程序
- en: Manage recovery plans
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 管理恢复计划
- en: After we select to Prepare infrastructure, a new blade will open. Here we have
    couple of options that we need to define. First, we need to select if we want
    to protect Azure or On-premises resources. As I want to demonstrate how to use
    ASR for migration, I'll select On-premises. The next option is to define where
    we want to replicate our resources, and the options available are Azure or another
    site.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 选择准备基础设施后，会打开一个新页面。在这里，我们有几个选项需要定义。首先，我们需要选择是否要保护Azure或本地资源。由于我想演示如何使用ASR进行迁移，我将选择本地资源。下一个选项是定义我们希望将资源复制到哪里，提供的选项是Azure或其他站点。
- en: 'We need to define if the infrastructure that we want to protect is virtualized,
    and if it is, we select between Hyper-V and VMware. If we are using Hyper-V, we
    need to define whether we are using SC VMM or not. A screenshot of the protection
    goal blade is show here:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要定义我们要保护的基础设施是否是虚拟化的，如果是，我们选择Hyper-V或VMware。如果我们使用Hyper-V，则需要定义是否使用SC VMM。下面是保护目标页面的截图：
- en: '![](img/be7be700-c31f-47c8-a93e-1511979b1928.png)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![](img/be7be700-c31f-47c8-a93e-1511979b1928.png)'
- en: 'The second step will lead you to Deployment planning. Here we can download
    a tool to estimate requirements for ASR in our on-premises infrastructure. This
    step isn''t required but it''s recommended as insufficient capacity can lead to
    replication issues. A deployment planner can be downloaded directly from the Azure
    portal as shown here:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 第二步将引导您进行部署规划。在此，我们可以下载工具来估算本地基础架构中ASR的要求。此步骤不是必须的，但建议执行，因为容量不足可能导致复制问题。可以直接从Azure门户下载部署规划工具，如下所示：
- en: '![](img/9a41579e-2f10-423e-b27c-4725e1d3de0a.png)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9a41579e-2f10-423e-b27c-4725e1d3de0a.png)'
- en: 'If the capacity is in order, we can proceed to Source preparation. We need
    to create a Hyper-V site and register a Hyper-V server that should be included
    in the replication, as shown here:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 如果容量没问题，我们可以继续进行源准备。我们需要创建一个Hyper-V站点并注册一个应包含在复制中的Hyper-V服务器，如下所示：
- en: '![](img/26662ad6-dccc-485e-9557-44a1e77d2882.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](img/26662ad6-dccc-485e-9557-44a1e77d2882.png)'
- en: 'After we create a new site, we need to download and install agents on all Hyper-V
    hosts that we want to protect on that site. Installation of this agent is similar
    to the backup agent (we need the vault credentials that can be downloaded from
    the recovery services vault) and after we have finished, we will have Hyper-V
    hosts available under our site. Note that after installation, it can take 15 to
    30 minutes before Hyper-V hosts are visible in the Azure portal. A successfully
    registered site and host are shown here:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建新站点后，我们需要在所有希望在该站点上保护的Hyper-V主机上下载并安装代理程序。此代理的安装类似于备份代理（我们需要从恢复服务保险库中下载的保险库凭据），完成安装后，Hyper-V主机将显示在我们站点下。请注意，安装完成后，可能需要15到30分钟才能在Azure门户中看到Hyper-V主机。以下是成功注册的站点和主机的示例：
- en: '![](img/baa0b991-3339-4d43-a287-09221fe3f580.png)'
  id: totrans-268
  prefs: []
  type: TYPE_IMG
  zh: '![](img/baa0b991-3339-4d43-a287-09221fe3f580.png)'
- en: 'After we set up the Source environment, we need to prepare the Target as well.
    We need to select the Azure Subscription, and deployment model, and prepare Azure
    infrastructure. Under infrastructure, we need to provide at least one storage
    account and one VNet for the target environment. The storage account must be provided
    for the VM disks and VNet is used in case DR is triggered and VMs must be restored
    to Azure (VM must be connected to VNet). The Target configuration is shown here:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置完源环境后，我们还需要准备目标环境。我们需要选择Azure订阅和部署模型，并准备Azure基础架构。在基础架构下，我们需要为目标环境提供至少一个存储帐户和一个VNet。存储帐户用于虚拟机磁盘，而VNet用于灾难恢复时，如果必须将虚拟机恢复到Azure，虚拟机必须连接到VNet。以下是目标配置的示例：
- en: '![](img/27a6d21f-0ebb-4592-b0e0-55bbca920b60.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](img/27a6d21f-0ebb-4592-b0e0-55bbca920b60.png)'
- en: 'The last step in infrastructure preparation is to create a replication policy.
    We need to define rules for frequency, recovery points retention, and some other
    settings. I recommend leaving everything on default settings except Copy frequency
    that may be changed based on the roles of the servers that are protected. You
    can also create multiple policies and apply them according to your requirements.
    You probably don''t need to replicate a web server as often as a database or file
    server and can use a different replication policy based on the roles of the protected
    server. An example of a default replication policy is shown here:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 基础架构准备的最后一步是创建复制策略。我们需要定义频率、恢复点保留以及一些其他设置的规则。我建议保留所有默认设置，除了可能基于受保护服务器的角色更改的复制频率外。您还可以创建多个策略并根据需要应用它们。您可能不需要像数据库或文件服务器那样频繁地复制Web服务器，可以根据受保护服务器的角色使用不同的复制策略。以下是默认复制策略的示例：
- en: '![](img/bab7f3b8-41da-4ab9-bd4e-514b4655fabe.png)'
  id: totrans-272
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bab7f3b8-41da-4ab9-bd4e-514b4655fabe.png)'
- en: Based on the previous steps, we can add multiple sources to a single key vault.
    In the same key vault, we can have registered Azure resources, multiple Hyper-V
    sites, VMware sites, or physical servers.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 基于前面的步骤，我们可以将多个源添加到单个密钥保险库。在同一个密钥保险库中，我们可以注册Azure资源、多个Hyper-V站点、VMware站点或物理服务器。
- en: 'After we prepare the infrastructure for ASR, we need to define what we are
    going to replicate and when. We need to select a source (Azure or On-premises)
    and select an appropriate location registered in recovery services vault. An example
    of Source selection is shown here:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在为ASR准备好基础架构后，我们需要定义要复制的内容及其时间。我们需要选择一个源（Azure或本地）并选择在恢复服务保险库中注册的适当位置。以下是源选择的示例：
- en: '![](img/1a23ab1c-71a9-4179-b74d-f89c5d090cd1.png)'
  id: totrans-275
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1a23ab1c-71a9-4179-b74d-f89c5d090cd1.png)'
- en: After we select Source, we need to select the Target as well. Required parameters
    are the Azure Subscription, resource group, deployment model, storage, and network
    settings. The resource group will be used as the location where the VMs will be
    created in case of failover.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 选择源后，我们还需要选择目标。必需的参数包括 Azure 订阅、资源组、部署模型、存储和网络设置。资源组将作为故障转移时虚拟机创建的位置。
- en: 'The same goes for the virtual network, it will be used only if failover is
    in place and VMs need to be created in Azure. Storage is used to place VM disks
    (VHDs) but it will be used even when failover isn''t in place, as data must be
    stored even when VM is not running. An example of Target settings is shown here:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网络也是如此，只有在发生故障转移并且需要在 Azure 中创建虚拟机时才会使用。存储用于放置虚拟机磁盘（VHD），即使没有故障转移，它也会被使用，因为即使虚拟机没有运行，数据也必须存储。目标设置的示例如下所示：
- en: '![](img/1cd3b0a9-1798-4583-96db-6b79cd92d8be.png)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1cd3b0a9-1798-4583-96db-6b79cd92d8be.png)'
- en: 'The Source and Target are in place and now we need to select what will be protected.
    This is done in two steps. The first will be to select Virtual machines in the
    previously selected site that we want to protect, as shown here:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 源和目标已经设置完毕，现在我们需要选择要保护的内容。这分为两步。第一步是选择我们希望保护的虚拟机，它们位于之前选择的站点中，如下所示：
- en: '![](img/97984e4e-8642-40a1-9261-e2135f8a980e.png)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
  zh: '![](img/97984e4e-8642-40a1-9261-e2135f8a980e.png)'
- en: 'After the Virtual machines that will be protected are selected, we must provide
    additional settings for these VMs. Settings that are required are the operating
    system for our VM, and disks that we want to replicate. An example is shown here:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择要保护的虚拟机后，我们必须为这些虚拟机提供其他设置。所需的设置包括虚拟机的操作系统和我们希望复制的磁盘。示例如下所示：
- en: '![](img/1e2ade1b-3c86-4bc0-8928-35bc887d6af6.png)'
  id: totrans-282
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1e2ade1b-3c86-4bc0-8928-35bc887d6af6.png)'
- en: 'One of the last steps is to select a replication policy that will be applied.
    As we can have multiple policies created, we can assign one that best fits the
    roles and settings of the VMs that are protected. An example of Replication settings
    is shown here:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的步骤之一是选择要应用的复制策略。由于我们可以创建多个策略，因此可以分配一个最适合受保护虚拟机角色和设置的策略。复制设置的示例如下所示：
- en: '![](img/cda4cccc-a1ad-432f-a891-a009d3455e9b.png)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cda4cccc-a1ad-432f-a891-a009d3455e9b.png)'
- en: 'Finally, everything is in place and by clicking OK, we can enable replication
    and start the protection of our VMs. The last step is shown here:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，一切就绪，点击“确定”后，我们可以启用复制并开始保护我们的虚拟机。最后一步如下所示：
- en: '![](img/2d984e09-3748-4b4e-bc2c-bb24f2c8224d.png)'
  id: totrans-286
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2d984e09-3748-4b4e-bc2c-bb24f2c8224d.png)'
- en: Using ASR as a migration tool
  id: totrans-287
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 ASR 作为迁移工具
- en: 'After replication is completed, you can see the status of replicated VMs under
    the protected items in the recovery services vault. You can use the same blade
    to monitor the replication process and see the percentage of replicated items.
    Time needed to complete initial replication depends on network bandwidth, storage
    settings, and the size of data that will be replicated. An example of a successful
    replication is shown here:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 复制完成后，您可以在恢复服务保管库中的“受保护项”下查看已复制虚拟机的状态。您可以使用相同的面板来监视复制过程，并查看已复制项的百分比。完成初始复制所需的时间取决于网络带宽、存储设置和要复制的数据大小。成功复制的示例如下所示：
- en: '![](img/5fd7d082-0bac-4221-8fa2-4eabfeaff8d1.png)'
  id: totrans-289
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5fd7d082-0bac-4221-8fa2-4eabfeaff8d1.png)'
- en: 'If we select any of the VMs under replicated items, we can find additional
    information on health, events, and options for failover (planned failover, failover,
    and test failover) as shown here:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们选择任何已复制项下的虚拟机，我们可以找到有关健康状态、事件以及故障转移选项（计划故障转移、故障转移和测试故障转移）的额外信息，如下所示：
- en: '![](img/ff9ee32f-44c3-4be5-92f2-3e9bfbfdeb22.png)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ff9ee32f-44c3-4be5-92f2-3e9bfbfdeb22.png)'
- en: There is a difference on different failovers and how they affect the primary
    VM. For example, a test failover will create a VM instance in Azure but will not
    affect the on-premises (primary) VM in any way. On the other hand, a planned failover
    and failover will create a new VM instance in Azure, declare it primary, and can
    even turn off the on-premises VM.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的故障转移方式以及它们对主虚拟机的影响是不同的。例如，测试故障转移将在 Azure 中创建一个虚拟机实例，但不会对本地（主）虚拟机产生任何影响。另一方面，计划故障转移和故障转移会在
    Azure 中创建一个新的虚拟机实例，将其声明为主虚拟机，甚至可以关闭本地虚拟机。
- en: 'Another thing that can be found in this blade is a diagram of the infrastructure
    involved, showing you how all components involved in the process are connected.
    A diagram for the Hyper-V site is shown in this screenshot:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 此窗格中还可以找到一个包含基础设施图的示意图，展示了在过程中涉及的所有组件如何连接。Hyper-V 站点的示意图如下所示：
- en: '![](img/122fd4de-4495-41fe-aea8-377251f5692a.png)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![](img/122fd4de-4495-41fe-aea8-377251f5692a.png)'
- en: Failover and migrating the VM
  id: totrans-295
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障切换和迁移虚拟机
- en: As the purpose of our replicating our VM is to migrate it to the cloud, let's
    move on and show how to perform this task.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们复制虚拟机的目的是将其迁移到云端，让我们继续并展示如何执行此任务。
- en: 'First, we will need to perform the failover of our VM. Here we need to select
    a Recovery Point we want to use, as we have multiple recovery points. Time needed
    for failover to complete depends on the size of the VM that will be created, amount
    of disks, and the size of data on these disks. An example for failover settings
    is shown here:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要执行虚拟机的故障切换。这里我们需要选择一个恢复点作为使用的恢复点，因为我们有多个恢复点。完成故障切换所需的时间取决于将要创建的虚拟机的大小、磁盘的数量以及这些磁盘上的数据大小。故障切换设置的示例如下所示：
- en: '![](img/92dd61e0-a9b3-42fc-8c09-193704ad1659.png)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
  zh: '![](img/92dd61e0-a9b3-42fc-8c09-193704ad1659.png)'
- en: 'After failover completes, the VM will be running, and Azure and you can manage
    it as any other Azure VM. Note that this VM will not be using managed disks. This
    is because ASR replicates disks to storage and creates copies of on-premises VHD.
    When failover occurs, VHDs are used for our VM and attach to it but as result
    disks are not managed. However, you can perform migration to managed disks when
    needed. If you plan to migrate this VM completely, I strongly recommend performing
    migration to managed disks. The VM after failover is shown here:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 故障切换完成后，虚拟机将会在 Azure 中运行，你可以像管理其他 Azure 虚拟机一样进行管理。请注意，这个虚拟机不会使用托管磁盘。这是因为 ASR
    会将磁盘复制到存储中，并创建本地 VHD 的副本。当故障切换发生时，VHD 会用于我们的虚拟机并附加到虚拟机上，但因此这些磁盘没有托管。不过，您可以在需要时将迁移到托管磁盘。如果你计划完全迁移该虚拟机，我强烈建议执行迁移到托管磁盘。故障切换后的虚拟机如下所示：
- en: '![](img/2b90e521-6ac7-414c-8229-f8ed8be1c4b6.png)'
  id: totrans-300
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2b90e521-6ac7-414c-8229-f8ed8be1c4b6.png)'
- en: 'After we complete failover, the VM is running in Azure but it''s still connected
    to the on-premises VM. We can perform failback at any time and the VM is listed
    under the replicated items in the recovery services vault. To complete migration
    and have the VM running only as an Azure VM, we need to perform a complete migration
    step. This will remove the association of our VM from the on-premises VM and the
    recovery service vault, as shown here:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 完成故障切换后，虚拟机将在 Azure 中运行，但仍然与本地虚拟机相连。我们可以随时执行故障恢复操作，虚拟机会在恢复服务库中的复制项下列出。要完成迁移并仅在
    Azure 中运行虚拟机，我们需要执行完整的迁移步骤。这将移除虚拟机与本地虚拟机以及恢复服务库的关联，如下所示：
- en: '![](img/67fb56a4-ff03-42f7-a35a-7f0ed8b61103.png)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![](img/67fb56a4-ff03-42f7-a35a-7f0ed8b61103.png)'
- en: Other options
  id: totrans-303
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他选项
- en: Finally, our VM is migrated to the cloud and running in Azure. Migrating with
    ASR allows us to minimize the downtime of our services but isn't the only option.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 最终，我们的虚拟机已迁移到云端并在 Azure 中运行。使用 ASR 进行迁移可以最小化服务的停机时间，但这并不是唯一的选项。
- en: AzCopy allows us to copy data from on-premises to the cloud as well, and can
    be used as a migration tool for all sorts of files. Another option is to use PowerShell
    to upload VHDs to Azure and use them to deploy the Azure VM.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: AzCopy 也允许我们将数据从本地复制到云端，并可以作为所有类型文件的迁移工具。另一种选择是使用 PowerShell 将 VHD 上传到 Azure
    并利用它们部署 Azure 虚拟机。
- en: Azure import/export job is used to transfer a large amount of data to Azure.
    Imagine you have disks with 4 TB of data. Copying that over internet would take
    a lot of time. With Azure import/export job, you can create a job in Azure, copy
    that to physical disks and ship them to the Azure Datacenter. Disks will be then
    available to you in the Azure portal and you can use this data in the cloud. The
    process can go in the other direction as well and you can export data from Azure
    and ship it to yourself.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 导入/导出作业用于将大量数据传输到 Azure。假设你有 4 TB 数据的磁盘，若通过互联网复制这些数据会耗费大量时间。使用 Azure 导入/导出作业，你可以在
    Azure 中创建一个作业，将数据复制到物理磁盘上并将其运送到 Azure 数据中心。然后，磁盘将会在 Azure 门户中对你可用，你可以在云中使用这些数据。该过程也可以反向进行，你可以将数据从
    Azure 导出并运送回自己。
- en: Summary
  id: totrans-307
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: After we introduced basic Azure services, both IaaS and PaaS, we explained the
    process of moving data to Azure. Microsoft offers extended options on how to assess
    if our data is cloud-ready, and also offers multiple tools to move data from on-premises
    to Azure. As the cost of inbound traffic is `0` and only outbound traffic from
    Azure is charged, we can see where Microsoft wants data to go.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们介绍了基本的 Azure 服务，包括 IaaS 和 PaaS 后，我们讲解了将数据迁移到 Azure 的过程。微软提供了多种评估数据是否适合迁移到云端的选项，并且提供了多个工具来帮助将数据从本地迁移到
    Azure。由于传入流量费用为 `0`，且只有从 Azure 输出的流量才会收费，因此我们可以看到微软希望数据去向何处。
- en: The next step in the Azure journey is a hybrid cloud that will help us use on-premises
    resources we already have, and extend them with all the benefits the cloud has
    to offer. This scenario is the reality for most companies as most of them are
    already invested in local resources. Ignoring existing resources is not an option
    and we can leverage the Azure offering by extending existing resources with a
    hybrid cloud. In [Chapter 7](a17b3c61-feb1-4c60-be4d-cd18694088ca.xhtml), *Hybrid
    Cloud with Azure – Extending Local Workloads to the Cloud*, we'll discuss how
    to create a secure connection between Azure and local infrastructure, and use
    Azure as a hybrid cloud.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 之旅的下一步是混合云，它将帮助我们利用已有的本地资源，并结合云端的所有好处进行扩展。对于大多数公司来说，这种情形已经成为现实，因为大多数公司已经投资于本地资源。忽视现有资源并非一种选择，我们可以通过使用混合云扩展现有资源，从而利用
    Azure 提供的服务。在[第七章](a17b3c61-feb1-4c60-be4d-cd18694088ca.xhtml)，《混合云与 Azure - 将本地工作负载扩展到云端》中，我们将讨论如何在
    Azure 与本地基础设施之间创建安全连接，并将 Azure 用作混合云。
- en: Questions
  id: totrans-310
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: An Azure Storage account can be deployed as...
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 存储帐户可以部署为...
- en: Resource manager
  id: totrans-312
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 资源管理器
- en: Classic
  id: totrans-313
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 经典
- en: Both
  id: totrans-314
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: To have maximum SLA, the Storage account should be...
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了获得最佳的服务级别协议（SLA），存储帐户应为...
- en: Locally redundant
  id: totrans-316
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本地冗余
- en: Geo-redundant
  id: totrans-317
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 地理冗余
- en: Both
  id: totrans-318
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: The Storage account tier can be...
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储帐户层级可以是...
- en: Standard
  id: totrans-320
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 标准
- en: Premium
  id: totrans-321
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 高级
- en: Both
  id: totrans-322
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Can a local database be backed up to the Azure Storage account?
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本地数据库能否备份到 Azure 存储帐户？
- en: 'Yes'
  id: totrans-324
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-325
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是
- en: Can a local database be deployed directly to Azure SQL database?
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本地数据库能否直接部署到 Azure SQL 数据库？
- en: 'Yes'
  id: totrans-327
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-328
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是
- en: To use ASR, you need to create...
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使用 ASR，您需要创建...
- en: Azure Storage account
  id: totrans-330
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 存储帐户
- en: Recovery services vault
  id: totrans-331
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 恢复服务保管库
- en: Azure Backup
  id: totrans-332
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 备份
- en: With Azure Backup, you can protect...
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Azure 备份，您可以保护...
- en: Azure resources
  id: totrans-334
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 资源
- en: On-premises resources
  id: totrans-335
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本地资源
- en: Both
  id: totrans-336
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: With ASR, you can protect...
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 ASR，您可以保护...
- en: Azure Virtual Machines
  id: totrans-338
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 虚拟机
- en: On-premises virtual machines
  id: totrans-339
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本地虚拟机
- en: Both
  id: totrans-340
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: To migrate a VM protected with ASR to the cloud, you must...
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了将受 ASR 保护的虚拟机迁移到云端，您必须...
- en: Replicate the VM
  id: totrans-342
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制虚拟机
- en: Perform failover
  id: totrans-343
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行故障转移
- en: Start the VM in Azure
  id: totrans-344
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 Azure 中的虚拟机
- en: To migrate a large amount of data to Azure, we must use...
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了将大量数据迁移到 Azure，必须使用...
- en: AzCopy
  id: totrans-346
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: AzCopy
- en: PowerShell
  id: totrans-347
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: PowerShell
- en: Azure import/export job
  id: totrans-348
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure 导入/导出作业
