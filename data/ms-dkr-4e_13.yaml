- en: '*Chapter 13*'
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: '*第 13 章*'
- en: Running Kubernetes in Public Clouds
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在公共云中运行 Kubernetes
- en: In the previous two chapters, we looked at the various ways that we can create,
    configure, and interact with Kubernetes clusters on our local machines.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在前两章中，我们已经了解了在本地机器上创建、配置和与 Kubernetes 集群交互的各种方式。
- en: 'Now it is time to take our Kubernetes journey into the cloud by looking at
    what is involved in launching, configuring, and using Kubernetes in the following
    public cloud providers using both the web portals from each provider and also
    their command-line tools:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候将我们的 Kubernetes 之旅带入云端，了解如何在以下公共云提供商中使用 Web 门户和命令行工具启动、配置和使用 Kubernetes：
- en: '**Microsoft Azure Kubernetes Service** (**AKS**)'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Microsoft Azure Kubernetes 服务**（**AKS**）'
- en: '**Google Kubernetes Engine** (**GKE**)'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Google Kubernetes 引擎**（**GKE**）'
- en: '**Amazon Elastic Kubernetes Service** (**EKS**)'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Amazon 弹性 Kubernetes 服务**（**EKS**）'
- en: '**DigitalOcean Kubernetes**'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DigitalOcean Kubernetes**'
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: This chapter assumes that you have access to one or all of the cloud providers
    that we will be covering. As such, please be aware that launching these services,
    depending on your account, will incur costs. You should also remember to remove
    any resources once you have finished with them or that you understand the costs
    if you choose to leave them running for any length of time.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本章假设你可以访问我们将涵盖的一个或多个云服务提供商。因此，请注意，根据你的帐户，启动这些服务将会产生费用。你还应该记得在完成使用后删除任何资源，或者了解如果你选择让它们运行一段时间的费用。
- en: As with the previous chapters, I will be using my preferred operating system,
    which is macOS. As such, some of the supporting commands, which will be few and
    far between, may only apply to macOS.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 与前几章一样，我将使用我偏好的操作系统——macOS。因此，某些支持命令可能仅适用于 macOS，并且出现频率较少。
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/336J7dE](https://bit.ly/336J7dE)'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频，了解代码在实践中的应用：[https://bit.ly/336J7dE](https://bit.ly/336J7dE)
- en: Microsoft Azure Kubernetes Service (AKS)
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Microsoft Azure Kubernetes 服务（AKS）
- en: 'Microsoft has long been a supporter of running container workloads in Microsoft
    Azure. Originally, Microsoft started by offering the Azure Container Service,
    which supported three different container orchestrators: Kubernetes, Mesosphere
    DC/OS, and Docker Swarm.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 微软一直是容器工作负载在 Microsoft Azure 上运行的支持者。最初，微软通过提供 Azure 容器服务来支持三种不同的容器编排工具：Kubernetes、Mesosphere
    DC/OS 和 Docker Swarm。
- en: However, in October 2017, Microsoft announced that they would be replacing Azure
    Container Service with the newly developed Azure Kubernetes Service—this, as you
    may already have guessed, dropped support for Mesosphere DC/OS and Docker Swarm.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在 2017 年 10 月，微软宣布将用新开发的 Azure Kubernetes 服务替代 Azure 容器服务——如你所料，这也意味着取消了对
    Mesosphere DC/OS 和 Docker Swarm 的支持。
- en: Since then, the service, which is a CNCF-certified Kubernetes hosting platform,
    has come on leaps and bounds, with a recent development being the general availability
    of Windows container support.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 自那时以来，这项服务作为一个 CNCF 认证的 Kubernetes 托管平台，已经取得了巨大的进展，最近的一个发展是 Windows 容器支持的普及。
- en: 'Rather than go into any more detail on this subject, let''s get on and launch
    an AKS cluster. We will be covering two ways of doing this: using the Azure web
    portal and setting it up from your local machine using the Azure command-line
    tools. Let''s start with the Azure web portal.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 与其深入探讨这个话题，不如直接启动一个 AKS 集群。我们将介绍两种方法：使用 Azure Web 门户和使用 Azure 命令行工具从本地机器进行设置。我们先从
    Azure Web 门户开始。
- en: Launching a cluster using the web portal
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Web 门户启动集群
- en: To start with, you need to be logged into the Azure web portal, which can be
    found at [https://portal.azure.com/](https://portal.azure.com/). Once logged in,
    enter `AKS` in the top search bar and click on the **Kubernetes services** item
    in the **Services** section of the search results.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要登录到 Azure 网络门户，地址是 [https://portal.azure.com/](https://portal.azure.com/)。登录后，在顶部搜索框中输入
    `AKS`，然后点击搜索结果中 **服务** 部分的 **Kubernetes 服务** 项。
- en: 'Once the page has loaded, you will be presented with a screen that looks like
    the following:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 页面加载后，你将看到一个如下所示的界面：
- en: '![Figure 13.1: Ready to create the cluster'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.1：准备创建集群'
- en: '](img/image_001.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_001.jpg)'
- en: 'Figure 13.1: Ready to create the cluster'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.1：准备创建集群
- en: 'Most of you will have already guessed what the next step in launching our AKS
    cluster is going to be. That''s right: click on the **+ Add** button and select
    **Add Kubernetes cluster**. There are seven sections that we are going to be working
    through to launch our cluster, listed as follows:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数人可能已经猜到我们启动 AKS 集群的下一步是什么了。没错：点击**+ 添加**按钮，然后选择**添加 Kubernetes 集群**。我们将通过七个部分来启动集群，具体如下：
- en: '**Basics**'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基础**'
- en: '**Node pools**'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**节点池**'
- en: '**Authentication**'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**身份验证**'
- en: '**Networking**'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络**'
- en: '**Integrations**'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集成**'
- en: '**Tags**'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标签**'
- en: '**Review + create**'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**审查并创建**'
- en: Let's start with the **Basics**. Here, you will be asked for several pieces
    of information, beginning with the **Project details**. Here, we need to define
    which **Subscription** and **Resource Group** should be used.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从**基础**开始。在这里，您将被要求提供几项信息，从**项目详情**开始。在这里，我们需要定义应该使用的**订阅**和**资源组**。
- en: Choose your required subscription and then click on the **Create new** link
    under **Resource Group**. Enter the name of the resource group you would like
    your cluster to be placed—I have called mine **mastering-docker-aks-rg**.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 选择所需的订阅，然后点击**创建新**链接，在**资源组**下选择。输入您希望将集群放置的资源组名称——我将其命名为**mastering-docker-aks-rg**。
- en: Once those two bits of information have been entered, we can move on to the
    `1.15.10` at the time of writing).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦输入了这两项信息，我们就可以继续进行`1.15.10`版本（截至写作时）。
- en: 'The last piece of basic information is for the **Primary node pool**. Here,
    we can define the **Node size** and the **Node count**. By default, these are
    set to **Standard DS2 v2** and **3**—for testing purposes, let''s leave these
    as their default settings. To progress to the next step, click on the **Next:
    Node pools >** button.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一项基础信息是**主节点池**。在这里，我们可以定义**节点大小**和**节点数量**。默认情况下，它们设置为**标准 DS2 v2**和**3**——为了测试，我们将保持这些默认设置。要进入下一步，点击**下一步：节点池
    >**按钮。
- en: On the **Node pools** screen, we can add more pools—for example, if you wanted
    to run a Windows host pool alongside the Linux one that we are launching, then
    you can click on the **+ Add node pool** button.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在**节点池**界面上，我们可以添加更多的池——例如，如果您希望在我们启动的 Linux 主机池旁边运行一个 Windows 主机池，您可以点击**+
    添加节点池**按钮。
- en: 'Here, you will be asked the following:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，您将被要求输入以下信息：
- en: '**Node pool name**: Name the new node pool.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**节点池名称**：为新的节点池命名。'
- en: '**OS type**: The underlying operating system that you want the new node pool
    to use. You have the choice of Linux or Windows.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作系统类型**：您希望新节点池使用的底层操作系统。您可以选择 Linux 或 Windows。'
- en: '**Node size**: The virtual machine size that the nodes in the new node pool
    should be.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**节点大小**：新节点池中节点的虚拟机大小。'
- en: '**Node count**: The number of nodes that you want in the pool.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**节点数量**：您希望在池中拥有的节点数量。'
- en: As we are launching a test cluster, we do not need any additional node pools,
    so let's move on to the next set of options.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们正在启动一个测试集群，因此不需要任何额外的节点池，因此我们可以继续选择下一个选项。
- en: '**Virtual nodes** allow you to use **Azure Container Instances**, which we
    looked at in [*Chapter 10*](B15659_10_Final_JM_ePub.xhtml#_idTextAnchor277), *Running
    Docker in Public Clouds*. Leave this setting as **Disabled**.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '**虚拟节点**允许您使用**Azure 容器实例**，我们在[*第 10 章*](B15659_10_Final_JM_ePub.xhtml#_idTextAnchor277)中介绍了它，*在公共云中运行
    Docker*。保持此设置为**禁用**。'
- en: 'Setting **VM scale sets** as **Enabled** will allow us to scale our cluster
    up and down, so let''s click on the **Next: Authentication >** button.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 将**VM 扩展集**设置为**启用**将允许我们按需扩展集群，因此我们点击**下一步：身份验证 >**按钮。
- en: 'The **Authentication** settings allow you to configure how the Kubernetes cluster
    will be able to interact with and even launch other Azure services. For our cluster,
    leave these at their defaults and click on the **Next: Networking >** button.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '**身份验证**设置允许您配置 Kubernetes 集群如何与其他 Azure 服务进行交互，甚至启动这些服务。对于我们的集群，保持默认设置，然后点击**下一步：网络
    >**按钮。'
- en: The **Networking** page has two different sets of options, the first being the
    **Network****Configuration**. Here, we have the option of choosing an existing
    **Virtual network** or creating one—for ease of use, let's stick with the defaults,
    which are already prefilled in for us, and move on to the **Network Settings**.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络**页面有两组不同的选项，第一组是**网络配置**。在这里，我们可以选择一个现有的**虚拟网络**，或者创建一个新的——为了方便起见，我们还是使用默认设置，这些设置已经为我们预填了，然后继续选择**网络设置**。'
- en: Here, we can again stick with the defaults, meaning that the only piece of information
    we need to provide is the **DNS name prefix**—I used **mastering-docker-aks**.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以继续使用默认设置，这意味着我们唯一需要提供的信息是**DNS 名称前缀**—我使用的是**mastering-docker-aks**。
- en: 'Clicking on **Next: Integrations >** will take you to the options, where you
    can connect your AKS cluster to an **Azure Container Registry**, which we discussed
    in [*Chapter 3*](B15659_03_Final_JM_ePub.xhtml#_idTextAnchor109)*, Storing & Distributing
    Images*. But as we are not using a system-assigned managed identity, this option
    is not available. The other integration we can configure is **Azure Monitor**.
    Leave these settings at their defaults, as we want a **Log Analytics workspace**
    set up for us.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**下一步：集成 >**将带你进入选项页面，在那里你可以将 AKS 集群连接到**Azure 容器注册表**，我们在[*第 3 章*](B15659_03_Final_JM_ePub.xhtml#_idTextAnchor109)《存储与分发镜像》中讨论过。但由于我们没有使用系统分配的托管身份，因此此选项不可用。我们可以配置的另一个集成是**Azure
    Monitor**。保持这些设置为默认值，因为我们希望为我们设置一个**日志分析工作区**。
- en: As our cluster is only temporary, you can click on the **Review + Create** button
    rather than adding the **Tags**.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的集群只是临时的，你可以点击**查看 + 创建**按钮，而不是添加**标签**。
- en: 'The first thing that happens is that your configuration is validated. If there
    are any problems, you will not be allowed to proceed until the problem is fixed.
    If everything goes as planned, then you should be presented with something that
    looks like the following screen:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 首先发生的事情是你的配置会被验证。如果有任何问题，你将无法继续，直到问题解决。如果一切按计划进行，你应该会看到类似下面的屏幕：
- en: '![Figure 13.2: A validated configuration'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.2：已验证的配置'
- en: '](img/image_002.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_002.jpg)'
- en: 'Figure 13.2: A validated configuration'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.2：已验证的配置
- en: 'Once validated, click on the **Create** button. Now would be a good time to
    grab a drink as a cluster could take anywhere from 10 to 20 minutes to deploy.
    Once deployed, you will see the following screen:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦验证通过，点击**创建**按钮。现在是时候去拿个饮料了，因为集群的部署可能需要 10 到 20 分钟。一旦部署完成，你将看到以下屏幕：
- en: '![Figure 13.3: The deployment has completed'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.3：部署已完成'
- en: '](img/image_003.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_003.jpg)'
- en: 'Figure 13.3: The deployment has completed'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.3：部署已完成
- en: Clicking on `kubectl` instance.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 点击`kubectl`实例。
- en: As Microsoft provides a shell built into Azure portal with both the Azure command-line
    tools and kubectl preinstalled; because we launched the cluster through the portal,
    we will use that.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Microsoft 在 Azure 门户中提供了一个内置的 shell，预安装了 Azure 命令行工具和 kubectl；因为我们是通过门户启动集群的，所以我们将使用它。
- en: Click on the Cloud Shell icon, which is the first of the icons in the top right
    of the screen after the search bar (it has **>_** on it). If you have used Cloud
    Shell before, then you will be logged straight in. If not, then follow the on-screen
    prompts.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 点击 Cloud Shell 图标，它是屏幕右上角搜索栏后的第一个图标（上面有**>_**）。如果你之前使用过 Cloud Shell，那么你会直接登录。如果没有，请按照屏幕上的提示操作。
- en: 'There are two different flavors of Cloud Shell: **Bash** and **PowerShell**.
    For our purposes, you need to make sure you are using **Bash**.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: Cloud Shell 有两种不同的版本：**Bash** 和 **PowerShell**。对于我们的目的，你需要确保使用的是**Bash**。
- en: 'Once you are at Command Prompt, enter the following command, making sure that
    you update the resource group and cluster name if you have used different values
    to the ones I used:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦进入命令提示符，输入以下命令，确保更新资源组和集群名称，如果你使用了与我不同的值：
- en: '[PRE0]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Once you have run the command, you can test the connectivity to the cluster
    by running the following:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你运行了命令，你可以通过运行以下命令来测试与集群的连接：
- en: '[PRE1]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This should return three nodes, each with the version of Kubernetes that we
    selected when we first went to configure our cluster:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该返回三个节点，每个节点都运行着我们在首次配置集群时选择的 Kubernetes 版本：
- en: '![Figure 13.4: Connecting kubectl to our AKS cluster using Cloud Shell'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.4：使用 Cloud Shell 连接 kubectl 到我们的 AKS 集群'
- en: '](img/image_004.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_004.jpg)'
- en: 'Figure 13.4: Connecting kubectl to our AKS cluster using Cloud Shell'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.4：使用 Cloud Shell 连接 kubectl 到我们的 AKS 集群
- en: Now we have our cluster up and running, you can skip the next part of this section
    where we launch the cluster using the Azure command-line tools and go straight
    to launching an application.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们的集群已经启动并运行，你可以跳过本节的下一部分，我们将使用 Azure 命令行工具启动集群，并直接进入启动应用程序。
- en: Launching a cluster using the command-line tools
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用命令行工具启动集群
- en: 'An alternative to launching the cluster through the Azure web portal is to
    use the Azure command-line tool. If you don''t already have it installed, then
    you can use the following instructions, starting with macOS:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Azure Web 门户启动集群的替代方法是使用 Azure 命令行工具。如果您还没有安装它，可以按照以下说明进行安装，从 macOS 开始：
- en: '[PRE2]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Windows users can open a PowerShell prompt as the Administrator user and run
    the following:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 用户可以以管理员身份打开 PowerShell 提示符并运行以下命令：
- en: '[PRE3]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Linux users using Debian-based machines can run the following:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Debian 系统的 Linux 用户可以运行以下命令：
- en: '[PRE4]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Linux users running Red-Hat-based operating systems can run the following:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 运行 Red-Hat 系统的 Linux 用户可以执行以下命令：
- en: '[PRE5]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once you have the Azure CLI package installed, the first command you should
    run is the following:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完 Azure CLI 包后，您应该运行的第一个命令如下：
- en: '[PRE6]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This will prompt you to log in to your Azure account.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 这将提示您登录到您的 Azure 账户。
- en: Important note
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Please make sure that the account you are logging in to has the subscription
    that you want to launch your resources in as the default subscription—if it doesn't,
    go to [https://docs.microsoft.com/en-us/cli/azure/manage-azure-subscriptions-azure-cli](https://docs.microsoft.com/en-us/cli/azure/manage-azure-subscriptions-azure-cli)
    for details on how to change the active subscription.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 请确保您登录的账户已将您想要启动资源的订阅设置为默认订阅——如果没有，请访问[https://docs.microsoft.com/en-us/cli/azure/manage-azure-subscriptions-azure-cli](https://docs.microsoft.com/en-us/cli/azure/manage-azure-subscriptions-azure-cli)了解如何更改活动订阅。
- en: Now that we have the Azure command-line tools installed and configured, we can
    launch our cluster. For macOS and Linux users, we can set some environment variables
    for values that we will be using through the cluster creation.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经安装并配置了 Azure 命令行工具，可以启动集群了。对于 macOS 和 Linux 用户，我们可以设置一些环境变量，这些值将在整个集群创建过程中使用。
- en: Important note
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Windows users should replace the variables in the commands used to launch the
    cluster with the corresponding values from the following four variables.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 用户应该将启动集群时使用的命令中的变量替换为以下四个变量中的相应值。
- en: 'These are the same values that we used in the last section, where we launched
    our cluster using the Azure web portal:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 这些值与我们在上一部分使用的相同，当时我们是通过 Azure Web 门户启动集群的：
- en: '[PRE7]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The first step in launching the cluster is to create the resource group. To
    do this, run the following:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 启动集群的第一步是创建资源组。为此，请运行以下命令：
- en: '[PRE8]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This should return a JSON file where the provisioning state should be `Succeeded`.
    Once the resource group has been created, we can launch our cluster by running
    the following command:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该返回一个 JSON 文件，其中的预配状态应为 `Succeeded`。资源组创建完成后，我们可以通过运行以下命令来启动集群：
- en: '[PRE9]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'While the cluster is launching, you will see a screen that looks like the following:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在集群启动时，您将看到如下界面：
- en: '![ Figure 13.5: Launching the cluster using the Azure CLI'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '![ 图 13.5：使用 Azure CLI 启动集群'
- en: '](img/image_005.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_005.jpg)'
- en: 'Figure 13.5: Launching the cluster using the Azure CLI'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.5：使用 Azure CLI 启动集群
- en: Just like when the cluster was launched using the Azure web portal, it will
    take between 10 and 20 minutes to complete, so don't worry too much if you see
    the preceding output for a while—it just takes a little time.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 就像通过 Azure Web 门户启动集群时一样，完成过程需要大约 10 到 20 分钟，所以如果您看到前面的输出一段时间，请不用担心——这只是需要一些时间。
- en: 'Once completed, the final step is the same as when we launched the cluster
    using the Azure web portal. We need to configure kubectl to point towards the
    new launching cluster. To do this, run the following command:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，最后一步与我们通过 Azure Web 门户启动集群时相同。我们需要配置 kubectl 以指向新启动的集群。为此，请运行以下命令：
- en: '[PRE10]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Once the configuration has been merged, you can run the following commands
    to check the connectivity with the cluster:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 配置合并完成后，您可以运行以下命令检查与集群的连接性：
- en: '[PRE11]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This should return something similar to the following output:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该返回类似以下的输出：
- en: '![Figure 13.6: Checking the cluster connectivity using kubectl'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.6：使用 kubectl 检查集群连接性'
- en: '](img/image_006.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_006.jpg)'
- en: 'Figure 13.6: Checking the cluster connectivity using kubectl'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.6：使用 kubectl 检查集群连接性
- en: We should now have an AKS cluster in the same state as if it were launched using
    the Azure web portal, which means that we can now launch an application.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在应该拥有一个与通过 Azure Web 门户启动的集群处于相同状态的 AKS 集群，这意味着我们现在可以启动应用程序了。
- en: Launching an application
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动应用程序
- en: As we are no longer using our local machine to run Kubernetes, we can launch
    an application that is a little more resource-intensive. For this, we are going
    to be using the microservices demo created and maintained by Weave.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们不再使用本地计算机来运行 Kubernetes，因此我们可以启动一个资源需求更高的应用程序。为此，我们将使用由 Weave 创建和维护的微服务示例。
- en: 'To launch the application, you simply need to run the following commands:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动应用程序，你只需运行以下命令：
- en: '[PRE12]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This will create a namespace called **sock-shop** and then the resource that
    is used to make up the application, which is an e-commerce site selling socks.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个名为**sock-shop**的命名空间，并创建组成应用程序的资源，这是一个销售袜子的电子商务网站。
- en: 'After a minute or two, you can run the following command to view the status
    of the pods:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 一两分钟后，你可以运行以下命令查看 pod 的状态：
- en: '[PRE13]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This should display something like the following output:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会显示类似以下的输出：
- en: '![Figure 13.7: Checking the status of the pods'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.7：检查 pod 的状态'
- en: '](img/image_007.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_007.jpg)'
- en: 'Figure 13.7: Checking the status of the pods'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.7：检查 pod 的状态
- en: 'Once all of the pods are running, you can check the status of the services
    by running the following:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦所有 pod 都在运行，你可以通过运行以下命令来检查服务的状态：
- en: '[PRE14]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Again, you should see something like the following:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，你应该看到类似以下的内容：
- en: '![Figure 13.8: Checking the status of the services'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.8：检查服务的状态'
- en: '](img/image_008.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_008.jpg)'
- en: 'Figure 13.8: Checking the status of the services'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.8：检查服务的状态
- en: 'Now that the application has been deployed, we need to expose it so that we
    can access it. To do this, run the following command:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 现在应用程序已经部署完毕，我们需要将其暴露出来以便可以访问。为此，请运行以下命令：
- en: '[PRE15]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Once exposed, you can run the following command to get information on the endpoint:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦暴露，你可以运行以下命令获取端点信息：
- en: '[PRE16]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'In the output, you are after the `LoadBalancer Ingress` and `Port`. See the
    following screenshot for an example output:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在输出中，你需要查找`LoadBalancer Ingress`和`Port`。请参考以下屏幕截图查看示例输出：
- en: '![Figure 13.9: Getting information on the exposed service'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.9：获取已暴露服务的信息'
- en: '](img/image_009.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_009.jpg)'
- en: 'Figure 13.9: Getting information on the exposed service'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.9：获取已暴露服务的信息
- en: 'Entering the `LoadBalancer Ingress` IP and `Port`—which for me was [http://52.191.99.154:8079/](http://52.191.99.154:8079/)—into
    a browser should open the store:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在浏览器中输入`LoadBalancer Ingress`的 IP 和`Port`—对于我来说是[http://52.191.99.154:8079/](http://52.191.99.154:8079/)，应该能打开商店：
- en: '![Figure 13.10 – The Sock Shop application'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.10：Sock Shop 应用程序'
- en: '](img/image_010.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_010.jpg)'
- en: Figure 13.10 – The Sock Shop application
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.10：Sock Shop 应用程序
- en: Click around the application—stick some socks in your basket, refresh pages,
    and so on. We are now going to take a look at the cluster in the Azure web portal.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在应用程序中点击—将一些袜子放入购物车，刷新页面，等等。接下来，我们将查看 Azure Web 门户中的集群。
- en: Cluster information
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 集群信息
- en: 'If you log in to the Azure web portal at [https://portal.azure.com/](https://portal.azure.com/)
    and then search for the name of your cluster in the search bar at the top of the
    page, you should be greeted with a page that looks like the following:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你登录到 Azure Web 门户（[https://portal.azure.com/](https://portal.azure.com/)），然后在页面顶部的搜索框中搜索你的集群名称，你应该会看到一个类似以下的页面：
- en: '![Figure 13.11 – Viewing the cluster in the Azure web portal'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.11：在 Azure Web 门户中查看集群'
- en: '](img/image_011.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_011.jpg)'
- en: Figure 13.11 – Viewing the cluster in the Azure web portal
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.11：在 Azure Web 门户中查看集群
- en: 'If you then click on the **Monitor container** button, you will be taken to
    a **Cluster** overview. Once there, click on **Containers**. Adding a filter for
    the **sock-shop** namespace will just select the containers that are running in
    the pods for our application. Selecting one and then clicking the **View live
    data (preview)** button will stream the logs from the container to the page:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你点击**Monitor container**按钮，你将进入**Cluster**概览页面。进入后，点击**Containers**。添加**sock-shop**命名空间的过滤器将仅选择在我们的应用程序的
    pod 中运行的容器。选择一个容器后，点击**View live data (preview)**按钮，将把该容器的日志实时流式传输到页面上：
- en: '![Figure 13.12 – Viewing the logs from the frontend container in the Azure
    web portal'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.12：在 Azure Web 门户中查看前端容器的日志'
- en: '](img/image_012.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_012.jpg)'
- en: Figure 13.12 – Viewing the logs from the frontend container in the Azure web
    portal
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.12：在 Azure Web 门户中查看前端容器的日志
- en: I would recommend having a click around some of the other tabs and options to
    get an idea of what else you can do with AKS.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议点击其他选项卡和设置，了解你可以使用 AKS 做些什么。
- en: 'Once you have finished with your AKS cluster, I recommend removing all of the
    resources created either through the Azure web portal or Azure CLI by deleting
    the resource groups. To do this, enter `Resource Groups` in the top search box
    and select the resource group related to your cluster. For example, as I launched
    my cluster, I have three resource groups, which I have highlighted in the following
    screenshot:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你完成了 AKS 集群的设置，我建议你通过 Azure Web 门户或 Azure CLI 删除创建的所有资源，方法是删除资源组。为此，在顶部搜索框中输入`Resource
    Groups`，然后选择与你的集群相关的资源组。例如，作为我启动集群的一部分，我有三个资源组，下面的截图中已将它们突出显示：
- en: '![Figure 13.13 – Finding the resource groups to delete'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '![图13.13 – 查找要删除的资源组'
- en: '](img/image_013.jpg)'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_013.jpg)'
- en: Figure 13.13 – Finding the resource groups to delete
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.13 – 查找要删除的资源组
- en: To remove them, click on the resource group name, double-check the resources
    in there and then if you are happy, they contain just the resources for your test
    cluster click on the **Delete resource group** button and follow the on-screen
    instructions.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除它们，点击资源组名称，仔细检查其中的资源，然后如果你确定其中仅包含测试集群的资源，点击 **删除资源组** 按钮并按照屏幕上的指示操作。
- en: Microsoft Azure Kubernetes Service summary
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Microsoft Azure Kubernetes 服务概述
- en: As I am sure you will agree, launching the cluster was quite a straightforward
    process using both the Azure web portal and Azure CLI. Once launched and kubectl
    configured to interact with the cluster, the commands that were used to launch
    the application were pretty much the same as the ones that we used in [*Chapter
    12*](B15659_12_Final_JM_ePub.xhtml#_idTextAnchor394), *Discovering other Kubernetes
    options*.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我相信你也会同意，使用 Azure Web 门户和 Azure CLI 启动集群是一个相当简单的过程。一旦集群启动并且 kubectl 配置完成，可以与集群进行交互，启动应用程序所使用的命令与我们在[*第12章*](B15659_12_Final_JM_ePub.xhtml#_idTextAnchor394)中使用的命令几乎相同，*发现其他
    Kubernetes 选项*。
- en: The cluster that we launched would have a running cost of around $215 per month,
    with the only cost being for the virtual machine resource. Microsoft does not
    charge for the resources required for cluster management; if we want to add an
    uptime SLA to the cluster, we would add a further $73.00 per month.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们启动的集群的运行成本约为每月 215 美元，唯一的费用是虚拟机资源的费用。Microsoft 不收取集群管理所需资源的费用；如果我们想为集群添加一个正常运行时间的
    SLA，我们需要再支付每月 73 美元。
- en: Being able to run multiple node pools with a mixture of Linux and Windows containers
    is a big plus point for the service, as is its integration with Azure Monitor
    and the Azure Container Registry service. Add to this services such as Azure DevOps
    and **Azure Sentinel for Security information and event management** (**SIEM**),
    and you have quite a powerful platform.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 能够运行多个节点池，混合使用 Linux 和 Windows 容器，这是该服务的一大亮点，此外它还与 Azure Monitor 和 Azure 容器注册表服务进行了集成。再加上如
    Azure DevOps 和 **Azure Sentinel 安全信息与事件管理**（**SIEM**）等服务，你将拥有一个相当强大的平台。
- en: Next up, we are going to move from Microsoft Azure to Google Cloud.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将从 Microsoft Azure 转移到 Google Cloud。
- en: Google Kubernetes Engine (GKE)
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Google Kubernetes 引擎（GKE）
- en: The GKE, as you may have already guessed, is very tightly integrated with Google's
    Cloud platform. Rather than going into more detail on how Kubernetes started off
    life at Google, let's dive straight in and launch a cluster.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 如你可能已经猜到的，GKE 与 Google 的云平台紧密集成。与其详细介绍 Kubernetes 在 Google 的起步历程，不如直接深入并启动一个集群。
- en: Going ahead, I am assuming that you already have a Google Cloud account and
    a project with billing enabled.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我假设你已经拥有一个 Google Cloud 账户，并且启用了计费功能的项目。
- en: Launching a cluster using the web portal
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Web 门户启动集群
- en: 'Once you are logged into [https://console.cloud.google.com/](https://console.cloud.google.com/),
    enter Kubernetes into the search box at the top of the page and select **Kubernetes
    Engine**. If you don''t have the service enabled for your project, it will automatically
    be enabled, and after a few seconds, you will be presented with a page that looks
    like the following:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你登录到 [https://console.cloud.google.com/](https://console.cloud.google.com/)，在页面顶部的搜索框中输入
    Kubernetes，并选择 **Kubernetes Engine**。如果你的项目尚未启用该服务，它将自动启用，几秒钟后，你将看到如下所示的页面：
- en: '![Figure 13.14 – The Kubernetes page in the Google Cloud web portal'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '![图13.14 – Google Cloud Web 门户中的 Kubernetes 页面'
- en: '](img/image_014.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_014.jpg)'
- en: Figure 13.14 – The Kubernetes page in the Google Cloud web portal
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.14 – Google Cloud Web 门户中的 Kubernetes 页面
- en: 'Again, as you might have already guessed, the first step to launching the cluster
    is to click on the **Create cluster** button. You will then be presented with
    quite a few options; however, we are going to use the defaults, other than the
    **Name**, which I am going to change to **mastering-docker-gke**. Once the name
    has been changed, click on the **Create** button:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 如你可能已经猜到的，启动集群的第一步是点击**创建集群**按钮。接下来，你会看到许多选项；不过，我们将使用默认选项，除了**名称**，我会将其更改为**mastering-docker-gke**。更改名称后，点击**创建**按钮：
- en: '![Figure 13.15 – Entering the cluster details'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.15 – 输入集群详情'
- en: '](img/image_015.jpg)'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_015.jpg)'
- en: Figure 13.15 – Entering the cluster details
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.15 – 输入集群详情
- en: 'Launching the cluster will take around 10 minutes. Once it is created, you
    should see something like the following:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 启动集群大约需要 10 分钟。创建完成后，你应该会看到如下内容：
- en: '![Figure 13.16 – The cluster is ready'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.16 – 集群已就绪'
- en: '](img/image_016.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_016.jpg)'
- en: Figure 13.16 – The cluster is ready
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.16 – 集群已就绪
- en: 'Like Microsoft Azure, Google Cloud has a shell built into the web interface,
    and the shell has `kubectl` and the `gcloud` command-line tool installed and configured.
    Open the shell by clicking on the `kubectl` accesses your cluster:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Microsoft Azure 类似，Google Cloud 在其 Web 界面中内置了一个 Shell，且该 Shell 已安装并配置了 `kubectl`
    和 `gcloud` 命令行工具。通过点击`kubectl` 进入 Shell 后，你就可以访问你的集群：
- en: '[PRE17]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Update the name and zone if you used anything other than what we set it to.
    Once configured, you should be able to run both of the following commands:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用了与我们设置的不同名称和区域，请更新名称和区域。配置完成后，你应该能够运行以下两个命令：
- en: '[PRE18]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'To test the connectivity, if everything has gone as planned, you should see
    something like the following:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试连接，如果一切按计划进行，你应该会看到如下信息：
- en: '![Figure 13.17 – Connecting kubectl to our cluster'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.17 – 将 kubectl 连接到我们的集群'
- en: '](img/image_017.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_017.jpg)'
- en: Figure 13.17 – Connecting kubectl to our cluster
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.17 – 将 kubectl 连接到我们的集群
- en: Launching a basic cluster using the Google Cloud web portal is a really simple
    process; however, using the `gcloud` CLI is just as easy.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Google Cloud 网络门户启动基本集群是一个非常简单的过程；然而，使用 `gcloud` CLI 同样简单。
- en: Launching a cluster using the command-line tools
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用命令行工具启动集群
- en: 'The `gcloud` command is provided by the Google Cloud SDK package. To install
    this on macOS using Homebrew and Cask, run the following command:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '`gcloud` 命令由 Google Cloud SDK 包提供。要在 macOS 上使用 Homebrew 和 Cask 安装，运行以下命令：'
- en: '[PRE19]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: If you are running Windows, then you can download the installer from [https://dl.google.com/dl/cloudsdk/channels/rapid/GoogleCloudSDKInstaller.exe](https://dl.google.com/dl/cloudsdk/channels/rapid/GoogleCloudSDKInstaller.exe).
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是 Windows 系统，可以从[https://dl.google.com/dl/cloudsdk/channels/rapid/GoogleCloudSDKInstaller.exe](https://dl.google.com/dl/cloudsdk/channels/rapid/GoogleCloudSDKInstaller.exe)下载安装程序。
- en: 'Linux users running a Debian-based operating system need to run the following:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 使用基于 Debian 的操作系统的 Linux 用户需要运行以下命令：
- en: '[PRE20]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Finally, Linux users running Red-Hat-based operating systems need to run the
    following:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，运行基于 Red-Hat 系统的 Linux 用户需要运行以下命令：
- en: '[PRE21]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Once the repository file is in place, you can install the package using the
    following command:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦存储库文件就位，你可以使用以下命令安装包：
- en: '[PRE22]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Should you have any problems with any of the preceding commands, a link for
    the quick starts for each of them containing common troubleshooting tips can be
    found in the further reading section of this chapter.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在执行上述命令时遇到任何问题，包含常见故障排除提示的快速入门链接可以在本章的进一步阅读部分找到。
- en: 'Once installed, you need to log in and then let the command-line tool know
    which project to use. You can do this by running the following commands:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，你需要登录并告诉命令行工具使用哪个项目。你可以通过运行以下命令来完成：
- en: '[PRE23]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: As you may have guessed, the project I am using is called **masteringdocker4**;
    you should update this to reflect your own project name.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如你可能已经猜到的，我使用的项目名为**masteringdocker4**；你应该更新为你自己的项目名称。
- en: 'Now that we have `gcloud` configured, we can launch our cluster. To do this,
    run the following:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经配置好了 `gcloud`，可以启动集群了。为此，请运行以下命令：
- en: '[PRE24]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'This will create a three-node cluster in the US Central 1c zone. Once launched,
    your kubectl will automatically be configured to communicate with the cluster,
    meaning that all you need to do is test connectivity by running the following:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 这将会在美国中部1c区域创建一个三节点集群。启动后，你的 kubectl 会自动配置为与集群通信，这意味着你只需通过运行以下命令来测试连接：
- en: '[PRE25]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'This should show you something similar to the following output:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会显示类似以下输出的内容：
- en: '![Figure 13.18 – Testing the connection to the Google Kubernetes Engine cluster'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.18 – 测试与 Google Kubernetes Engine 集群的连接'
- en: '](img/image_018.jpg)'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_018.jpg)'
- en: Figure 13.18 – Testing the connection to the Google Kubernetes Engine cluster
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.18 – 测试与 Google Kubernetes Engine 集群的连接
- en: Now that we have a Google Kubernetes Engine cluster up and running, we can now
    launch our application.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经成功创建并启动了 Google Kubernetes Engine 集群，接下来可以启动我们的应用程序。
- en: Launching an application
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动应用程序
- en: 'As we covered the launching of the application in detail in the *Microsoft
    Azure Kubernetes Service* section of this chapter, we are not going to go into
    much detail here, other than to say that you need to run the following commands
    to launch the app:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们在本章的*Microsoft Azure Kubernetes Service*部分已经详细介绍了应用程序的启动过程，因此这里不再详细讲解，只需说一下，您需要运行以下命令来启动应用程序：
- en: '[PRE26]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'You can check the status of the pods and services by running the following:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过运行以下命令检查 Pod 和服务的状态：
- en: '[PRE27]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Once everything looks as if it''s up and running, you can use the following:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦一切看起来都已经启动并运行，您可以使用以下命令：
- en: '[PRE28]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'This will expose the application. Once you have entered this, you can enter
    the following command:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 这将暴露应用程序。输入此后，您可以输入以下命令：
- en: '[PRE29]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: As we mentioned before, to get information on the exposed service you need the
    `LoadBalancer Ingress` and `Port`. Stick them both in a browser (for example,
    I used `http://104.154.45.136:8079/`) and you should see that the Sock Shop is
    up and running.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前提到的，要获取暴露的服务信息，您需要 `LoadBalancer Ingress` 和 `Port`。将这两个值粘贴到浏览器中（例如，我使用了
    `http://104.154.45.136:8079/`），您应该能看到 Sock Shop 已经成功启动。
- en: Cluster information
  id: totrans-215
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 集群信息
- en: 'Going back to the Google Cloud web portal and clicking on **Workloads** within
    your cluster will show you a list of the nonsystem workload. Clicking on the frontend
    deployment will show you something like the following:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 返回 Google Cloud 网络门户并点击您集群中的**工作负载**，将显示非系统工作负载的列表。点击前端部署将显示如下内容：
- en: '![Figure 13.19 – Viewing the deployment details'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.19 – 查看部署详情'
- en: '](img/image_019.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_019.jpg)'
- en: Figure 13.19 – Viewing the deployment details
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.19 – 查看部署详情
- en: 'Clicking on **Container logs**, which can be found at the bottom of the preceding
    screen, will take you to a page where you can view the logs being generated by
    the workload:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 点击位于前一屏幕底部的**容器日志**，将带您进入一个页面，您可以在其中查看工作负载生成的日志：
- en: '![Figure 13.20 – Viewing the logs for the frontend deployment'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.20 – 查看前端部署的日志'
- en: '](img/image_020.jpg)'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_020.jpg)'
- en: Figure 13.20 – Viewing the logs for the frontend deployment
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.20 – 查看前端部署的日志
- en: 'Again, spend a little time having a click around some of the other tabs and
    options to get an idea of what else you can do with GKE. Once you have finished
    spending some time getting to know GKE, you should remove all of the resources
    that were launched. To do this, simply select your cluster from the **Clusters**
    page of the **Kubernetes****Engine** section of the portal and then click on **Delete**.
    You will be given a warning before the cluster is removed:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 再次花些时间浏览其他标签和选项，了解您可以用 GKE 做些什么。一旦您花时间了解 GKE 后，应该删除所有已启动的资源。为此，只需在门户的**Kubernetes
    引擎**部分的**集群**页面选择您的集群，然后点击**删除**。在删除集群前，您会收到一个警告：
- en: '![Figure 13.21 – Are you sure you want to delete the cluster?'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.21 – 您确定要删除集群吗？'
- en: '](img/image_021.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_021.jpg)'
- en: Figure 13.21 – Are you sure you want to delete the cluster?
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.21 – 您确定要删除集群吗？
- en: If you are happy to proceed, then click on **DELETE** and give it about 10 minutes.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您决定继续，请点击**删除**，并大约等待 10 分钟。
- en: Google Kubernetes Engine summary
  id: totrans-229
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Google Kubernetes Engine 总结
- en: I am sure that you agree that the Google Kubernetes Service is another simple
    service to configure, and as you must now be noticing, once the cluster is up
    and running, interacting with it is a consistent experience. Again, Google offers
    deep integration with other Google Cloud services, such as its monitoring, databases,
    and load-balancing services.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 我相信您也同意，Google Kubernetes 服务是另一个简单的配置服务，而且正如您现在可能已经注意到的，一旦集群启动并运行，与之交互的体验是始终如一的。再说一次，Google
    提供了与其他 Google Cloud 服务的深度集成，如监控、数据库和负载均衡服务。
- en: Running the cluster at the specifications that we set up would cost around $150
    per month; however, $73 of that cost is the GKE cluster management fee, to run
    the cluster at the same specifications as the Microsoft Azure Kubernetes Service
    will cost around $220 per month, with the GKE cluster management fee staying the
    same.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 以我们设定的规格运行集群大约每月花费 $150；然而，其中 $73 的费用是 GKE 集群管理费，若要以与 Microsoft Azure Kubernetes
    服务相同的规格运行集群，每月将花费约 $220，GKE 集群管理费保持不变。
- en: Both Googles and Microsoft Kubernetes offerings have been established for quite
    a while, so let's take a look at the last of the big three cloud providers' Kubernetes
    offerings and move onto Amazon Web Services
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: Google 和 Microsoft 的 Kubernetes 服务已经推出有一段时间了，接下来我们来看看三大云服务商中的最后一个 Kubernetes
    服务，并继续了解亚马逊 Web 服务。
- en: Amazon Elastic Kubernetes Service (EKS)
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 亚马逊弹性 Kubernetes 服务（EKS）
- en: The next Kubernetes service we are going to take a look at is the Amazon Elastic
    Container Service for Kubernetes, or Amazon EKS for short. This is the most recently
    launched service of the three services we have covered so far. In fact, you could
    say that Amazon was very late to the Kubernetes party.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来我们将介绍的 Kubernetes 服务是亚马逊弹性容器服务 Kubernetes（简称 Amazon EKS）。这是我们迄今为止介绍的三项服务中最新推出的服务。事实上，您可以说亚马逊在
    Kubernetes 的推广上来得很晚。
- en: Unfortunately, the command-line tools for Amazon are not as user friendly as
    the ones we used for Microsoft Azure and Google Cloud. Because of this, we are
    going to be using a tool called `eksctl`, which was written by Weave, the same
    people who created the demo store we have been using. It has been adopted by Amazon
    as the official command client of EKS, as opposed to the commands built into their
    own client.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，亚马逊的命令行工具并不像我们用于 Microsoft Azure 和 Google Cloud 的工具那样用户友好。因此，我们将使用一个名为
    `eksctl` 的工具，它由 Weave 开发，Weave 同样也是我们一直使用的示范商店的创建者。该工具已被亚马逊作为 EKS 的官方命令行客户端，而不是他们自己客户端中内建的命令。
- en: Because of this, we are going to bypass the web-based portal and concentrate
    on `eksctl,` which itself makes use of the AWS command-line tools.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们将绕过基于 Web 的门户，专注于 `eksctl`，它本身利用了 AWS 的命令行工具。
- en: Launching a cluster using the command-line tools
  id: totrans-237
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用命令行工具启动集群
- en: 'Before we install `eksctl`, we need to install the AWS command-line tools.
    To do this on macOS using Homebrew, run the following command:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装 `eksctl` 之前，我们需要先安装 AWS 命令行工具。若要在 macOS 上通过 Homebrew 安装，请运行以下命令：
- en: '[PRE30]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: If you are a Windows user, then you can download the installer from [https://awscli.amazonaws.com/AWSCLIV2.msi](https://awscli.amazonaws.com/AWSCLIV2.msi).
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您是 Windows 用户，您可以从 [https://awscli.amazonaws.com/AWSCLIV2.msi](https://awscli.amazonaws.com/AWSCLIV2.msi)
    下载安装程序。
- en: 'Finally, Linux users can run the following commands to download and install
    the command-line tools:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，Linux 用户可以运行以下命令来下载并安装命令行工具：
- en: '[PRE31]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Once installed, you will need to configure your credentials. Unlike the `az`
    and `gcloud` commands, you need to log in to the AWS web portal to do this. Details
    on the steps you need to take can be found at [https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html).
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，您需要配置凭据。与 `az` 和 `gcloud` 命令不同，您需要登录到 AWS 网站门户进行配置。有关所需步骤的详细信息，请参阅 [https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html)。
- en: 'Once you have the AWS command-line tools installed and configured, you can
    proceed with installing `eksctl`, again starting with macOS and Homebrew:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 安装并配置好 AWS 命令行工具后，您可以继续安装 `eksctl`，再次从 macOS 和 Homebrew 开始：
- en: '[PRE32]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'It is recommended that Windows users use Chocolatey:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 建议 Windows 用户使用 Chocolatey：
- en: '[PRE33]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Finally, Linux users can download the precompiled binary straight from GitHub
    using the following commands:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，Linux 用户可以使用以下命令直接从 GitHub 下载预编译的二进制文件：
- en: '[PRE34]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Once installed, you will be able to run the following command to create and
    configure your cluster:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，您将能够运行以下命令来创建并配置您的集群：
- en: '[PRE35]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Once launched, you should see something like the following, which, as you can
    see, is quite descriptive:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 启动后，您应该会看到类似以下的内容，正如您所看到的，它非常具有描述性：
- en: '![Figure 13.22  – Launching the EKS cluster using eksctl'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.22 – 使用 eksctl 启动 EKS 集群'
- en: '](img/image_022.jpg)'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_022.jpg)'
- en: Figure 13.22 – Launching the EKS cluster using eksctl
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.22 – 使用 eksctl 启动 EKS 集群
- en: 'As part of the launch, `eksctl` will have configured your local `kubectl` context,
    meaning that you can run the following:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动过程中，`eksctl` 已经配置了你的本地 `kubectl` 环境，这意味着你可以运行以下命令：
- en: '[PRE36]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Now that we have the cluster up and running, we can launch the demo store, just
    like we did previously.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 现在集群已经启动并运行，我们可以像之前一样启动演示商店。
- en: Launching an application
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动应用程序
- en: 'You should be getting quite good at deploying the Sock Shop application now,
    so here is a recap of all of the commands you need:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该已经相当熟练地部署 Sock Shop 应用程序了，下面是你需要的所有命令回顾：
- en: '[PRE37]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'You may notice that the **LoadBalancer Ingres** is actually a fully qualified
    domain rather than an IP address:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会注意到，**LoadBalancer Ingres** 实际上是一个完全合格的域名，而不是 IP 地址：
- en: '![Figure 13.23 – Viewing details on the exposed service'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.23 – 查看暴露服务的详情](img/image_023.jpg)'
- en: '](img/image_023.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_023.jpg)'
- en: Figure 13.23 – Viewing details on the exposed service
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.23 – 查看暴露服务的详情
- en: You might need to give it a few minutes for the DNS for the load balancer to
    update, but you should be able to use the URL and port. For my cluster, I went
    to http://a5fecbaee10a04cfaa19846e116081f8-624222238.eu-west-1.elb.amazonaws.com:8079
    to access the Sock Shop.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能需要等几分钟，等待负载均衡器的 DNS 更新，但你应该能够使用该 URL 和端口。对于我的集群，我访问了 http://a5fecbaee10a04cfaa19846e116081f8-624222238.eu-west-1.elb.amazonaws.com:8079
    来访问 Sock Shop。
- en: Cluster information
  id: totrans-267
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 集群信息
- en: If I am honest, this section is pretty redundant as there isn't much information
    on the cluster exposed in the AWS web portal by default outside of the basic information
    on the VMs that make up the node cluster. Sure, you can enable some features in
    CloudWatch to start monitoring your cluster, but this is not done by default at
    the moment.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我说实话，这一部分其实有些多余，因为在 AWS 网页门户中，默认情况下，集群暴露的内容信息并不多，除了组成节点集群的虚拟机的基本信息。当然，你可以在
    CloudWatch 中启用一些功能来开始监控集群，但目前并不是默认启用的。
- en: 'The following command will immediately delete the cluster for you:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将立即删除集群：
- en: '[PRE38]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: However, I recommend double-checking for any resources left over in your AWS
    web portal, just to make sure you don't get any unexpected bills.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，我建议你再次检查 AWS 网页门户中是否有剩余的资源，以确保不会收到意外账单。
- en: Amazon Elastic Kubernetes Service summary
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 亚马逊弹性 Kubernetes 服务总结
- en: As already mentioned, the Amazon Elastic Kubernetes Service was the last of
    the big three public cloud providers' Kubernetes-as-a-service offerings to launch,
    and in my personal opinion, it is the weakest of the three offerings.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，亚马逊弹性 Kubernetes 服务是三大公共云提供商中的最后一个 Kubernetes 即服务产品上线的，依我个人的看法，它是三者中最弱的一个。
- en: While it is a CNCF-certified hosting platform, it simply doesn't feel as integrated
    or intuitive as the offerings from Microsoft and Google—everything just feels
    tacked on to the normally good AWS services; the same can also be said of the
    Amazon Container Service.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管它是 CNCF 认证的托管平台，但它的集成感和直观性不如微软和谷歌的服务——一切似乎都只是附加到通常不错的 AWS 服务上；亚马逊容器服务也有类似的问题。
- en: Costwise, the instances are charged at standard EC2 rates, and there is a charge
    of $0.10 per hour per Kubernetes cluster.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 在成本方面，实例按标准 EC2 费率收费，每个 Kubernetes 集群每小时收费 0.10 美元。
- en: Before we finish the chapter, let's look at one more Kubernetes offering, this
    time from DigitalOcean.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们结束本章之前，让我们再看一个 Kubernetes 服务，这次是来自 DigitalOcean 的。
- en: DigitalOcean Kubernetes
  id: totrans-277
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DigitalOcean Kubernetes
- en: 'As we are nearing the end of the chapter, we are going to very quickly take
    a look at the Kubernetes offering from DigitalOcean, as it represents good value
    for money and is simple to configure. To start with, log in to your DigitalOcean
    web portal and under the **Manage** section of the right-hand menu, click on **Kubernetes**:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 随着本章接近尾声，我们将很快浏览一下 DigitalOcean 的 Kubernetes 服务，因为它物有所值且配置简单。首先，登录到你的 DigitalOcean
    网页门户，在右侧菜单的 **Manage** 部分，点击 **Kubernetes**：
- en: '![Figure 13.24 – Details of the DigitalOcean Kubernetes offering'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.24 – DigitalOcean Kubernetes 服务详情](img/image_023.jpg)'
- en: '](img/image_024.jpg)'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_024.jpg)'
- en: Figure 13.24 – Details of the DigitalOcean Kubernetes offering
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.24 – DigitalOcean Kubernetes 服务详情
- en: 'Clicking the **Create a Kubernetes** **Cluster** button will take you to the
    **Create a cluster** page, from there just choose a datacenter region and scroll
    to the bottom of the page; DigitalOcean has some great defaults so we can skim
    past them. Once at the bottom, click on the **Create Cluster** button and wait.
    After around five minutes, your cluster will be available:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**创建 Kubernetes** **集群**按钮，将带你进入**创建集群**页面，在那里选择一个数据中心区域并滚动到页面底部；DigitalOcean
    提供了一些很好的默认设置，所以我们可以跳过它们。到底部后，点击**创建集群**按钮并等待。大约五分钟后，你的集群就可以使用了：
- en: '![Figure 13.25 – Viewing the newly created DigitalOcean Kubernetes cluster'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.25 – 查看新创建的 DigitalOcean Kubernetes 集群](img/image_027.jpg)'
- en: '](img/image_025.jpg)'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_025.jpg)'
- en: Figure 13.25 – Viewing the newly created DigitalOcean Kubernetes cluster
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.25 – 查看新创建的 DigitalOcean Kubernetes 集群
- en: Now that the cluster is up and running, you can click on the `kubectl` configuration
    for your cluster, or, if you have it installed (see the further reading section
    for a link), you can use the `doctl` command to download and configure your local
    `kubectl` to talk to your newly created cluster.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 现在集群已经启动并运行，你可以点击你的集群的`kubectl`配置，或者，如果你已经安装了（参见后续阅读部分的链接），你也可以使用`doctl`命令下载并配置本地的`kubectl`，使其与新创建的集群进行通信。
- en: 'The command to do this is as follows; please make sure that you update the
    name at the end to match that of your own cluster:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 执行此操作的命令如下；请确保你在最后更新集群的名称以匹配自己的集群：
- en: '[PRE39]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Once configured, you know what to do: launch the Sock Shop application using
    the same commands that we have been using throughout the chapter—well sort of;
    if you want to steam ahead and try to launch the application you would receive
    several errors. Go ahead and try it.'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完成后，你知道接下来该做什么：使用本章中一直使用的命令启动 Sock Shop 应用程序——嗯，算是吧；如果你想继续并尝试启动应用程序，你会收到几个错误。试试看吧。
- en: 'The errors, which look like the following screenshot, are there because of
    changes to the API in the later version of Kubernetes that DigitalOcean launches
    by default:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 这些错误，像下面的截图一样，出现是因为 Kubernetes 在后续版本中对 API 进行了更改，而 DigitalOcean 默认启动的版本就是基于这个更改：
- en: '![Figure 13.26 – Errors with the Sock Shop'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.26 – Sock Shop 错误](img/image_026.jpg)'
- en: '](img/image_026.jpg)'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_026.jpg)'
- en: Figure 13.26 – Errors with the Sock Shop
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.26 – Sock Shop 错误
- en: 'Never fear though—this is easily resolved. First, let''s remove the namespace
    with the partly deployed application in it:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 不过不用担心——这个问题很容易解决。首先，让我们删除其中部分部署的应用程序所在的命名空间：
- en: '[PRE40]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Once these are removed, we need to clone the Sock Shop repository and recreate
    the namespace. To do this, run the following command:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 删除这些后，我们需要克隆 Sock Shop 仓库并重新创建命名空间。为此，请运行以下命令：
- en: '[PRE41]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Next, we have to change directory to the Kubernetes deployment folder, update
    the definition files, and then launch the application. For this, we need to run
    the following:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要切换到 Kubernetes 部署文件夹，更新定义文件，然后启动应用程序。为此，我们需要运行以下命令：
- en: '[PRE42]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'From there, you can check the pods and services, expose the frontend, and get
    information on the exposed service using the following:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，你可以检查 pods 和服务，暴露前端，并使用以下命令获取暴露的服务信息：
- en: '[PRE43]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: It may take a minute or two for the services to be exposed as a DigitalOcean
    load balancer is launched.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 可能需要一两分钟才能将服务暴露，因为 DigitalOcean 会启动一个负载均衡器。
- en: 'Before we return to the DigitalOcean web portal, let''s enable the advanced
    cluster metrics. To do this, we need to deploy another application. You can do
    this by running the following two commands:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们返回 DigitalOcean 网络门户之前，让我们启用高级集群指标。为此，我们需要部署另一个应用程序。你可以通过运行以下两个命令来完成：
- en: '[PRE44]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Once installed, it will take a minute or two for the metrics to appear in the
    portal. You can find them by selecting your cluster and then clicking on the **Insights**
    tab:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，可能需要一两分钟时间，指标才会在门户中显示。你可以通过选择集群然后点击**Insights**标签来找到它们：
- en: '![Figure 13.27 – Viewing details on the cluster in the DigitalOcean web portal'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.27 – 在 DigitalOcean 网络门户查看集群详情](img/image_027.jpg)'
- en: '](img/image_027.jpg)'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/image_027.jpg)'
- en: Figure 13.27 – Viewing details on the cluster in the DigitalOcean web portal
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.27 – 在 DigitalOcean 网络门户查看集群详情
- en: I would recommend having a click around the DigitalOcean web portal before you
    remove the cluster, as I am sure you will agree that the service is quite well
    integrated and comes at a bargain price. The three-node cluster we launched would
    cost just $30 per month to run!
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议在删除集群之前，先在 DigitalOcean 网络门户上浏览一下，因为我相信你会同意这个服务整合得非常好，且价格非常实惠。我们启动的三节点集群每月只需
    30 美元！
- en: You can terminate the cluster through the web portal. Also, make sure that you
    also remove the load balancer as this will remain once the cluster has been terminated
    to avoid unexpected costs at the end of the month.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过 Web 门户终止集群。同时，确保删除负载均衡器，因为在集群终止后它仍然存在，以避免月底产生意外费用。
- en: Summary
  id: totrans-311
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we looked at launching Kubernetes clusters in various clouds
    and running the same demo application in all of them. I am sure that by the end
    of the chapter you were quite bored of launching the same application over and
    over again; however, that was the point.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们研究了如何在不同云中启动 Kubernetes 集群，并在其中运行相同的示范应用程序。我敢肯定，到本章结束时，你可能已经厌倦了一次又一次地启动相同的应用程序；然而，这正是本章的重点。
- en: We have looked at four very different and traditionally incompatible cloud providers
    and deployed the same application using the same tools and commands across all
    four of them. Admittedly, we had to make some allowances for the different versions
    of Kubernetes being used, but for the most part, we didn't have to make any provider-specific
    allowances once we started working with `kubectl`.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经研究了四个非常不同且传统上不兼容的云服务提供商，并在它们上使用相同的工具和命令部署了相同的应用程序。诚然，由于使用了不同版本的 Kubernetes，我们做了一些调整，但大部分情况下，一旦我们开始使用`kubectl`，就不需要做任何特定于提供商的调整。
- en: 'This is one of the key reasons why Kubernetes has become so popular: it truly
    does allow you to define and distribute your applications in a platform-agnostic
    way—even just a few years ago, being able to deploy an application locally and
    then across four public cloud providers using the same set of commands and configurations
    seemed impossible without a lot of complexity, which I am sure you will agree
    there has been none of in the last few chapters.'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 这正是 Kubernetes 成为如此流行的关键原因之一：它确实允许你以平台无关的方式定义和分发应用程序——即使是几年前，能够在本地部署一个应用程序，然后在四个公共云提供商之间使用相同的命令和配置部署，似乎是不可能的，没有大量复杂性的。而我相信，你也会同意，在过去几章中并没有复杂性。
- en: In the next chapter, we are going to go back to Docker and learn how to best
    secure your containers.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将回到 Docker，并学习如何最好地保护你的容器。
- en: Questions
  id: totrans-316
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Once our cluster launches, what command did we need to run to create the namespace
    for the Sock Shop store?
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦我们的集群启动，我们需要运行什么命令来为 Sock Shop 商店创建命名空间？
- en: How do you find out the full details of the Load Balancer?
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何查找负载均衡器的完整详细信息？
- en: Name the official Amazon Elastic Kubernetes Service CLI.
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请列出官方的亚马逊弹性 Kubernetes 服务 CLI。
- en: Further reading
  id: totrans-320
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 深入阅读
- en: 'The product pages for each of the Kubernetes services can be found at the following
    links:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 Kubernetes 服务的产品页面可以在以下链接找到：
- en: '**Azure Kubernetes Service:** [https://azure.microsoft.com/en-gb/services/kubernetes-service/](https://azure.microsoft.com/en-gb/services/kubernetes-service/)'
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Kubernetes 服务:** [https://azure.microsoft.com/en-gb/services/kubernetes-service/](https://azure.microsoft.com/en-gb/services/kubernetes-service/)'
- en: '**Google Kubernetes Engine:** [https://cloud.google.com/kubernetes-engine/](https://cloud.google.com/kubernetes-engine/)'
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**谷歌 Kubernetes 引擎:** [https://cloud.google.com/kubernetes-engine/](https://cloud.google.com/kubernetes-engine/)'
- en: '**Amazon Elastic Container Service for Kubernetes:** [https://aws.amazon.com/eks/](https://aws.amazon.com/eks/)'
  id: totrans-324
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**亚马逊弹性容器服务 Kubernetes 版:** [https://aws.amazon.com/eks/](https://aws.amazon.com/eks/)'
- en: '**DigitalOcean Kubernetes:** [https://www.digitalocean.com/products/kubernetes/](https://www.digitalocean.com/products/kubernetes/)'
  id: totrans-325
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DigitalOcean Kubernetes:** [https://www.digitalocean.com/products/kubernetes/](https://www.digitalocean.com/products/kubernetes/)'
- en: 'Quick starts for the various command-line tools used in the chapter can be
    found at the following links:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中使用的各种命令行工具的快速入门可以在以下链接找到：
- en: '**Azure CLI:** [https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest](https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest)'
  id: totrans-327
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure CLI:** [https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest](https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest)'
- en: '**Google Cloud SDK:** [https://cloud.google.com/sdk/](https://cloud.google.com/sdk/)'
  id: totrans-328
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**谷歌云 SDK:** [https://cloud.google.com/sdk/](https://cloud.google.com/sdk/)'
- en: '**AWS Command-Line Interface:** [https://aws.amazon.com/cli/](https://aws.amazon.com/cli/)'
  id: totrans-329
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS 命令行接口:** [https://aws.amazon.com/cli/](https://aws.amazon.com/cli/)'
- en: '**eksctl, the official CLI for Amazon EKS:** [https://eksctl.io/](https://eksctl.io/)'
  id: totrans-330
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**eksctl，Amazon EKS 官方 CLI:** [https://eksctl.io/](https://eksctl.io/)'
- en: '**doctl:** [https://github.com/digitalocean/doctl/](https://github.com/digitalocean/doctl/)'
  id: totrans-331
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**doctl:** [https://github.com/digitalocean/doctl/](https://github.com/digitalocean/doctl/)'
- en: 'Finally, for more details on the demo store, go to the following link:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，关于示范商店的更多详情，请访问以下链接：
- en: '**Sock Shop:** [https://microservices-demo.github.io/](https://microservices-demo.github.io/)'
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Sock Shop:** [https://microservices-demo.github.io/](https://microservices-demo.github.io/)'
- en: '**Section 3**: Best Practices'
  id: totrans-334
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**第3节**：最佳实践'
- en: In this section, we will take the skills learned from the previous chapters
    and cover how they can be used in the real world.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将结合前面章节所学的技能，探讨它们如何在现实世界中应用。
- en: 'This section comprises the following chapters:'
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 本节包含以下章节：
- en: '[*Chapter 14*](B15659_14_Final_JM_ePub.xhtml#_idTextAnchor787), *Securing Your
    Docker Environment*'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第14章*](B15659_14_Final_JM_ePub.xhtml#_idTextAnchor787)，*保护你的Docker环境*'
- en: '[*Chapter 15*](B15659_15_Final_JM_ePub.xhtml#_idTextAnchor823), *Docker Workflows*'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第15章*](B15659_15_Final_JM_ePub.xhtml#_idTextAnchor823)，*Docker工作流*'
- en: '[*Chapter 16*](B15659_16_Final_JM_ePub.xhtml#_idTextAnchor922), *Next Steps
    with Docker*'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第16章*](B15659_16_Final_JM_ePub.xhtml#_idTextAnchor922)，*Docker的下一步*'
