- en: Azure Networking - Foundation of Azure IaaS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 网络 - Azure IaaS 的基础
- en: The next step in our cloud journey is Azure networking. This step will lay the
    foundation for our Azure infrastructure and will be used by both IaaS and PaaS
    in chapters to come. It's important to design and implement your Azure network
    with consideration for all Azure services that will be used in the future. This
    will save you a lot of headaches, and keep your cloud journey safe and without
    turbulence.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们云旅程中的下一步是 Azure 网络。此步骤将为我们的 Azure 基础设施奠定基础，并将在接下来的章节中为 IaaS 和 PaaS 使用。设计和实施
    Azure 网络时，必须考虑到未来将使用的所有 Azure 服务。这将为你节省大量麻烦，并使你的云之旅安全且稳定。
- en: 'The areas that we''ll cover in this chapter are the following:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下内容：
- en: Azure VNet
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure VNet
- en: Address ranges
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地址范围
- en: Subntets
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 子网
- en: IP address types and reservations
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IP 地址类型和预留
- en: DNS
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS
- en: '**Network security groups** (**NSGs**)'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络安全组**（**NSGs**）'
- en: Azure virtual machine networking
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 虚拟机网络
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: For this chapter, you'll need an Azure subscription.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章内容你需要一个 Azure 订阅。
- en: Azure networking basics
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 网络基础
- en: The networking stack in Microsoft Azure is very important and is the foundation
    for other services, especially when we talk about IaaS. Setting up Azure networking
    correctly is very important, as it will be key to setting up your IaaS infrastructure
    and allowing your virtual machines to communicate. The networking stack in Azure
    is composed of two components, external and private. External is used to access
    service endpoints over the internet and private is used for communication between
    Azure services internally.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Azure 中的网络栈非常重要，它是其他服务的基础，特别是当我们谈到 IaaS 时。正确设置 Azure 网络非常重要，因为它是设置
    IaaS 基础设施并允许虚拟机进行通信的关键。Azure 中的网络栈由两个组成部分构成，外部和私有。外部用于通过互联网访问服务端点，私有用于 Azure 服务之间的内部通信。
- en: Almost all Azure services have external endpoints configured by default, but
    we have some special cases when we don't want to enable access over the internet.
    In these cases, we can disable external endpoints and set up these services to
    use private traffic only. This applies to PaaS as well, even though these services
    usually don't have private network access configured by default (except for some
    PaaS services that are designed for this, for example, app service isolated).
    In this chapter, we'll discuss basic networking features and will continue to
    explore networking options for specific services when the time comes.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎所有 Azure 服务默认都有外部端点配置，但在某些特殊情况下，我们不希望启用互联网访问。在这些情况下，我们可以禁用外部端点，并将这些服务设置为仅使用私有流量。这同样适用于
    PaaS，尽管这些服务通常默认没有配置私有网络访问（除了某些为此设计的 PaaS 服务，例如隔离应用服务）。在本章中，我们将讨论基本的网络功能，并将在适当时继续探讨针对特定服务的网络选项。
- en: IaaS usually has external endpoints configured as well, but we have the option
    to disable these and not allow access over the internet. On the other hand, IaaS
    always comes with a private network configured. Every virtual machine in Azure
    has to be assigned to a virtual network and have a private IP address assigned.
    Even if we have a single virtual machine configured and want to use it only for
    public access over the internet, a virtual network will be created in the background,
    and this VM will have a private IP address assigned.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: IaaS 通常也有外部端点配置，但我们可以选择禁用这些端点，不允许通过互联网访问。另一方面，IaaS 总是会配置一个私有网络。每个 Azure 虚拟机都必须分配到一个虚拟网络，并分配一个私有
    IP 地址。即使我们只配置了一个虚拟机，并希望它仅用于公共互联网访问，系统也会在后台创建一个虚拟网络，并为该虚拟机分配一个私有 IP 地址。
- en: Azure networking also extends to VPN options, which allow you to access services
    only over a private network and private IP addresses. This allows you to secure
    resources further and disable any kind of public access. We will explore these
    features and options when we discuss hybrid cloud with Microsoft Azure.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 网络还扩展到 VPN 选项，允许你仅通过私有网络和私有 IP 地址访问服务。这使你能够进一步保护资源，并禁用任何类型的公共访问。我们将在讨论与
    Microsoft Azure 的混合云时探讨这些功能和选项。
- en: Creating your first virtual network in Azure
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 Azure 中创建你的第一个虚拟网络
- en: '**Azure virtual network** (**Azure VNet**) is created in two cases, when you
    create a new VNet or when you create a new Azure virtual machine. Options are
    similar in both cases, but I recommend creating Azure VNet in advance and joining
    virtual machines to an existing VNet because this gives you a few more options.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**Azure 虚拟网络**（**Azure VNet**）有两种创建方式：一种是创建新的 VNet，另一种是创建新的 Azure 虚拟机。两者的选项相似，但我建议先创建
    Azure VNet，并将虚拟机加入到现有的 VNet 中，因为这样会有更多的选项。'
- en: 'To create a new Azure Vnet, open the Azure portal, select Create a resource
    and choose Virtual network in Networking services (or search for `Virtual network`
    in the search bar), as shown in the following screenshot:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个新的 Azure Vnet，请打开 Azure 门户，选择“创建资源”，然后在“网络服务”中选择“虚拟网络”（或在搜索栏中搜索`Virtual
    network`），如下面的截图所示：
- en: '![](img/8b11dcce-39f3-4980-9162-59b52e6da46f.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8b11dcce-39f3-4980-9162-59b52e6da46f.png)'
- en: You need parameters for your virtual network. The resource name must be unique
    on the resource group level and must be one string, with no spaces allowed. My
    resource Name is `PacktVNet`, but it could be `Packt_VNet` if I wanted to separate
    the words. The next parameter we need to provide is Address space. This will define
    how many IP addresses will be available in this VNet and uses CIDR format. The
    biggest address space is `/8` and smallest is `/29`. In this case, I'll use `/16`,
    which will give me plenty of address space to use. We need to select the subscription
    where we want to place our resource (only if we have multiple subscriptions; one
    will be selected by default in the case of a single subscription). Two options
    are available for Resource group name, either a new one or to select an existing
    resource group. As I usually configure virtual network prior to any other resource,
    a new resource group is created along with VNet. The next step is to select the
    region where we want to create the resource. I recommend to select the Azure data
    center closest to you geographically, as this will provide the least network latency
    in the future. If you selected an existing resource group, this option will be
    preselected as the same region in which the resource group is located. You need
    to name the default subnet and provide an address space for that subnet. The address
    range for the subnet must be inside the address range of your VNet address space.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要为虚拟网络提供一些参数。资源名称在资源组级别必须唯一，并且必须是单个字符串，不允许有空格。我的资源名称是 `PacktVNet`，但如果我想分开这两个词，也可以使用
    `Packt_VNet`。接下来的参数是地址空间。这将定义在此 VNet 中可用的 IP 地址数量，使用 CIDR 格式。最大的地址空间是 `/8`，最小的是
    `/29`。在这种情况下，我将使用 `/16`，这将为我提供足够的地址空间。我们需要选择放置资源的订阅（仅当有多个订阅时需要选择；如果只有一个订阅，系统将默认选择）。资源组名称有两个选项，可以选择创建一个新的资源组，也可以选择现有的资源组。由于我通常会在创建其他资源之前配置虚拟网络，因此会与
    VNet 一起创建一个新的资源组。接下来的步骤是选择我们希望创建资源的区域。我建议选择离你最近的 Azure 数据中心，因为这样将来能提供最低的网络延迟。如果选择了现有的资源组，该选项将自动选择资源组所在的相同区域。你需要为默认子网命名，并为该子网提供地址空间。子网的地址范围必须在
    VNet 地址空间的地址范围内。
- en: 'Basic DDoS protection is provided by default for free, but you can select the standard
    tier, which is charged separately. We will discuss DDoS further when we reach [Chapter
    9](0e16c405-a21c-4cfc-9dc6-e20fc05db041.xhtml), *Azure Security and Administration*.
    Examples of the information needed for virtual network deployment are shown in
    the following screenshot:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下提供基础的 DDoS 保护，是免费的，但你可以选择标准层，它需要单独收费。我们将在 [第九章](0e16c405-a21c-4cfc-9dc6-e20fc05db041.xhtml)，*Azure
    安全与管理* 中进一步讨论 DDoS。以下截图展示了虚拟网络部署所需的信息示例：
- en: '![](img/f237aaca-ae7a-447e-8603-2db4cdd05800.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f237aaca-ae7a-447e-8603-2db4cdd05800.png)'
- en: 'The final option is related to service endpoints. If we enable this, new windows
    will be shown, as in the following screenshot. This option enables you to attach
    PaaS services to your VNet. You can select between Azure Cosmos DB, event hub,
    key vault, service bus, SQL, and storage, or you can select all of them. At this
    time, I''ll disable endpoints and we''ll discuss them later:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的选项与服务端点有关。如果我们启用此功能，会显示新的窗口，如下面的截图所示。此选项允许你将 PaaS 服务附加到你的 VNet。你可以选择 Azure
    Cosmos DB、事件中心、密钥保管库、服务总线、SQL 和存储，或者选择全部。在此，我将禁用端点，稍后我们会讨论它们：
- en: '![](img/aef94448-da9a-4ac3-8540-4a9eaad02f6c.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aef94448-da9a-4ac3-8540-4a9eaad02f6c.png)'
- en: The last step is to confirm options and start the process of creating a resource.
    Azure virtual network works relatively fast and a resource should be created in
    less than a minute. This can depend on data center workload and the number of
    requests but should be completed relatively quickly, even in high-demand situations.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一步是确认选项并开始创建资源的过程。Azure虚拟网络工作相对较快，资源应该在不到一分钟的时间内创建完成。这可能取决于数据中心的工作负载和请求数量，但即使在需求量大的情况下，也应能相对快速地完成。
- en: Azure virtual network represents your own network in the cloud. It has similar
    features to your local network, such as IP address range and subnets. If you're
    familiar with networking in on-premises scenarios, it will be very easy to understand
    Azure networking.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Azure虚拟网络代表了你在云中的自有网络。它具备类似于本地网络的特性，例如IP地址范围和子网。如果你熟悉本地网络环境的网络设置，那么理解Azure网络将会非常容易。
- en: Azure virtual network options
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure虚拟网络选项
- en: Once deployment is finished, you have different management options available.
    Locate your resource group and open the VNet blade. In the Overview tab, you can
    see different information about your VNet, such as resource group, subscription
    location, and so on.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 部署完成后，你会有不同的管理选项可供选择。定位到你的资源组并打开虚拟网络选项卡。在“概览”标签页中，你可以看到有关虚拟网络的不同信息，比如资源组、订阅位置等等。
- en: 'In settings, we have multiple options that are available for configuration:
    Address space, Connected Devices, Subnets, DDoS protection, DNS servers, Peering,
    and Service endpoints. Properties, locks, and automation scripts are available
    for every resource in Azure and aren''t limited only to Azure VNet. Properties
    have read-only information about your resource, and locks point out if there are
    any services in dependency to this service. The automation script will generate
    an ARM template for resource redeployment. Note that this option generates an
    ARM template for a complete resource group, not only for a specific resource.
    The automation script can be used for future redeployment, in case we need to
    replicate resources for a new client or a new environment.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置中，我们有多个可供配置的选项：地址空间、连接设备、子网、DDoS保护、DNS服务器、对等连接和服务端点。每个Azure资源都有属性、锁定和自动化脚本，而这些不仅仅限于Azure虚拟网络。属性提供关于资源的只读信息，锁定显示是否有依赖于该服务的其他服务。自动化脚本会为资源的重新部署生成ARM模板。请注意，此选项会为整个资源组生成ARM模板，而不仅仅是为某个特定资源。自动化脚本可以在未来的重新部署中使用，万一我们需要为新的客户或新环境复制资源。
- en: 'In address space, we can edit an existing address space or add additional ones.
    There are two restrictions: address spaces can''t overlap and you can''t change
    an address space to be smaller than the subnets using that address space. For
    example, if you created address space `10.1.0.0/16` and subnet `10.1.0.0./16`,
    the address space can''t be changed to less than `10.1.0.0/16` unless the subnet
    is changed first. It''s important, how you use an address space; in terms of future
    VPN connection, you cannot connect Azure VNet to a network (Azure or physical)
    using the same address space. Adding a new address space can be seen in the following
    screenshot. Make sure the new address space doesn''t overlap with the existing
    one:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在地址空间中，我们可以编辑现有的地址空间或添加新的地址空间。这里有两个限制：地址空间不能重叠，并且不能将一个地址空间缩小到比使用该地址空间的子网还要小。例如，如果你创建了地址空间`10.1.0.0/16`和子网`10.1.0.0/16`，那么该地址空间不能更改为小于`10.1.0.0/16`，除非先更改子网。如何使用地址空间是很重要的；在未来的VPN连接中，你不能将Azure虚拟网络连接到使用相同地址空间的网络（无论是Azure网络还是物理网络）。添加新地址空间可以参见以下截图。确保新的地址空间不会与现有地址空间重叠：
- en: '![](img/6352acd0-2a3f-428d-83aa-233e0cab8707.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6352acd0-2a3f-428d-83aa-233e0cab8707.png)'
- en: 'In the subnet blade, you have two options: to change the existing subnet or
    to add a new one. For both options, you have to use existing address spaces, and
    subnets can''t overlap. An existing subnet can''t be changed to use less address
    space than already in use. For example, if you have an address space of `10.1.0.0/24`
    and have 200 VMs on the subnet already, then you can''t change to anything less
    than `/24`, as `/25` has only 128 addresses available.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在子网选项卡中，你有两个选择：更改现有子网或添加一个新的子网。对于这两种选项，你必须使用现有的地址空间，且子网不能重叠。现有的子网不能更改为使用比已用的地址空间更少的空间。例如，如果你的地址空间是`10.1.0.0/24`并且该子网已经有200个虚拟机，那么你不能将其更改为小于`/24`的地址空间，因为`/25`只有128个可用地址。
- en: Another thing to note is that you don't have the complete IP range available
    on your subnet; five IP addresses are reserved for Azure-provided network roles
    such as DNS or DHCP. Speaking of DHCP, having a custom DHCP solution in Azure
    is not supported, you have to use an Azure-provided DHCP. This is not the case
    with DNS; by default, you use the Azure DNS service, but can use a custom solution
    as well.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个需要注意的事项是，你在子网中并没有完整的 IP 地址范围；有五个 IP 地址被保留用于 Azure 提供的网络角色，例如 DNS 或 DHCP。说到
    DHCP，Azure 不支持自定义 DHCP 解决方案，你必须使用 Azure 提供的 DHCP。DNS 则不同；默认情况下，你使用的是 Azure DNS
    服务，但也可以使用自定义解决方案。
- en: To add a new subnet, you need to provide similar information to when you created
    the default one during VNet deployment, but you have a couple of additional options.
    Again, you need to provide a name for your subnet and IP address range that must
    use the existing IP address range of your VNet and must not overlap with other
    subnets on your VNet. Note that here you get information about the reservation
    of five IP addresses for Azure networking services. A similar VNet deployment
    is the service endpoint option, which allows you to add PaaS services to your
    subnet. You can assign a Network security group to the subnet level and assign
    Route table.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加一个新子网，你需要提供与 VNet 部署时创建默认子网时相似的信息，但你会有几个额外的选项。你需要提供子网的名称和 IP 地址范围，这些范围必须使用你
    VNet 中现有的 IP 地址，并且不能与 VNet 上的其他子网重叠。请注意，在这里你会看到关于为 Azure 网络服务保留五个 IP 地址的信息。类似的
    VNet 部署选项是服务端点选项，允许你将 PaaS 服务添加到子网中。你可以将网络安全组分配到子网级别，并分配路由表。
- en: 'NSGs are your main tool to control traffic on Azure Vnets, and we''ll discuss
    them in more detail later. Azure routes traffic automatically between all subnets
    on the same VNet, but you can create custom route tables to override the default
    options. This can be useful in cases when you have VPN or virtual appliance (third-party
    firewalls in Azure). An example of adding a new subnet to VNet is shown in the
    following screenshot:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 网络安全组（NSG）是你控制 Azure VNet 流量的主要工具，我们稍后会详细讨论它们。Azure 会自动在同一 VNet 上的所有子网之间路由流量，但你可以创建自定义路由表来覆盖默认选项。这在你使用
    VPN 或虚拟设备（例如第三方防火墙）时非常有用。如下图所示，这是向 VNet 添加新子网的示例：
- en: '![](img/d298e1e3-7721-4314-8571-c483c8cdcb11.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d298e1e3-7721-4314-8571-c483c8cdcb11.png)'
- en: The DNS blade allows us to add a custom DNS solution to our VNet. As mentioned
    before, this is Azure-provided by default but you can use your own DNS, either
    a VM with DNS or public DNS.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 窗格允许我们为 VNet 添加自定义 DNS 解决方案。如前所述，默认情况下这是 Azure 提供的，但你也可以使用自己的 DNS，无论是使用带有
    DNS 的虚拟机还是公共 DNS。
- en: 'If you have a Site2Site connection to your local network, this can be DNS for
    your local network. If this is the case, I would recommend using a replica of
    your DNS in Azure. This will make the response faster and DNS available on your
    Azure VNet in case the VPN connection or your local network is down for some reason.
    The option to provide custom DNS is shown in the following screenshot. You need
    to provide the IP address of the DNS server, the public IP in case you choose
    public DNS, or a private one if you deploy DNS on your VNet:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一个 Site2Site 连接到本地网络，那么它可以作为本地网络的 DNS。如果是这种情况，我建议在 Azure 中使用 DNS 的副本。这将使响应更快，并确保在
    VPN 连接或本地网络因某些原因不可用时，DNS 仍可在 Azure VNet 中使用。提供自定义 DNS 的选项如下图所示。你需要提供 DNS 服务器的
    IP 地址，如果选择使用公共 DNS，则提供公共 IP 地址；如果在 VNet 中部署 DNS，则提供私有 IP 地址：
- en: '![](img/11db6274-3098-461f-a78f-ae7648c290b6.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](img/11db6274-3098-461f-a78f-ae7648c290b6.png)'
- en: 'We had the option to add service endpoints to our VNet during deployment, but
    we can add them at any time using the service endpoint blade, shown in the following
    screenshot. As adding these services starts a provisioning process that will set
    up routing and rules, it can take up to 15 minutes for the process to complete.
    The service endpoint option is available on at the VNet and subnet levels, so
    you can enable endpoints either for a complete network or on a single subnet.
    Using a single subnet gives you more control and the ability to separate the PaaS
    service from rest of your virtual network:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在部署过程中，我们有机会为 VNet 添加服务端点，但我们可以随时使用服务端点窗格添加，如下图所示。由于添加这些服务会启动一个配置过程，设置路由和规则，因此该过程可能需要最多
    15 分钟才能完成。服务端点选项可用于 VNet 和子网级别，因此你可以为整个网络或单个子网启用端点。使用单个子网可以提供更多控制，并能够将 PaaS 服务与虚拟网络的其他部分分离：
- en: '![](img/4f2dc55d-584b-4138-8af4-b8334d5a5888.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4f2dc55d-584b-4138-8af4-b8334d5a5888.png)'
- en: Peering allows you to connect your VNet to other VNets in order to exchange
    traffic. This is available only for VNets in a single Azure tenant (but available
    across subscriptions in that tenant). You need to give a name to the connection
    and then select the appropriate subscription and virtual network. You have some
    additional options to define if needed, like if you want traffic forwarding, allowing
    gateway transit, and use of remote gateways. By default, only traffic coming from
    one VNet will go to the second VNet. Traffic coming from outside VNets that are
    connected by peering (coming from a second peer, only one of the VNets is involved
    in or coming over gateways) will not be forwarded unless you specify these options.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 对等连接允许你将 VNet 连接到其他 VNet，以便交换流量。这仅适用于同一个 Azure 租户中的 VNet（但可跨该租户中的订阅使用）。你需要为连接指定一个名称，然后选择适当的订阅和虚拟网络。你还有一些额外的选项可以定义，例如是否需要流量转发、是否允许网关中继以及是否使用远程网关。默认情况下，只有来自一个
    VNet 的流量会被转发到第二个 VNet。来自对等连接外部的流量（例如来自第二个对等网络，只有一个 VNet 涉及，或者通过网关传输的流量）不会被转发，除非你指定这些选项。
- en: 'For example, let''s say we have three VNets: A, B, and C. A is connected to
    B, and C is connected to B, but there is no direct connection between A and C.
    By default, traffic would be allowed for A to B, from B to A, from B to C, and
    C to B. No traffic would go from A to C or from C to A. If we enable traffic forwarding,
    traffic from A to C and C to A would go through.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设我们有三个 VNet：A、B 和 C。A 连接到 B，C 也连接到 B，但 A 和 C 之间没有直接连接。默认情况下，流量会被允许从 A 到
    B，从 B 到 A，从 B 到 C，以及从 C 到 B。A 到 C 或 C 到 A 的流量不会被允许。如果我们启用流量转发，A 到 C 和 C 到 A 的流量将会被转发。
- en: A similar thing goes for virtual gateways. Let's say we have networks A and
    B and peering between these VNets. VNet A has a virtual gateway and is connected
    to our on-premises network. By default, traffic would be allowed from A to B,
    B to A, from the on-premises network to A and from A to on-premises network. No
    traffic would be allowed from on-premises network to B and from B to on-premises
    network, unless we allow this traffic using extra options that allow gateway transit
    and the use of remote gateways.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网关也有类似的情况。假设我们有 A 和 B 两个网络，并且这两个 VNet 之间有对等连接。VNet A 有一个虚拟网关，并且已连接到我们的本地网络。默认情况下，A
    到 B、B 到 A、本地网络到 A 以及 A 到本地网络的流量都会被允许。除非我们使用额外选项允许网关中继和远程网关的使用，否则本地网络到 B 和 B 到本地网络的流量将不被允许。
- en: Another way to achieve this is to create a virtual gateway for each VNet and
    create a Site2Site connection, the same one that you would use in case you wanted
    to connect to your on-premises network (we'll discuss this in the hybrid cloud
    chapter). The big difference between the two approaches is that peering is free
    and you pay for a virtual gateway. If you want to connect two VNets that are located
    on different tenants, you need to use a virtual gateway; peering is available
    only for VNets on the same tenant.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种实现方式是为每个 VNet 创建一个虚拟网关，并创建一个 Site2Site 连接，这与连接到本地网络时所使用的连接方式相同（我们将在混合云章节讨论这个问题）。这两种方法的主要区别在于，对等连接是免费的，而虚拟网关是收费的。如果你希望连接位于不同租户的两个
    VNet，你需要使用虚拟网关；而对等连接仅适用于同一个租户中的 VNet。
- en: 'To connect different networks, either VNet to VNet or VNet to local network,
    IP address spaces/subnets must not overlap. If you have the same subnet for both
    networks, you won''t be able to create this connection as this would create confusion
    and make routing impossible. It would be impossible to distinguish which device
    is on which network and where traffic should go. How to connect your VNet to another
    VNet in your subscription is shown in the following screenshot:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 为了连接不同的网络，无论是 VNet 到 VNet 还是 VNet 到本地网络，IP 地址空间/子网不能重叠。如果两个网络使用相同的子网，你将无法创建该连接，因为这会造成混淆，并使路由变得不可能。将无法区分哪个设备属于哪个网络，也无法确定流量应该流向哪里。如何在你的订阅中将
    VNet 连接到另一个 VNet，如下图所示：
- en: '![](img/f2088ad9-ccee-4943-9ef2-eff8063208b1.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f2088ad9-ccee-4943-9ef2-eff8063208b1.png)'
- en: Where we have multiple networks connected either by peering or Site2Site, it's
    recommended to use route tables. Custom route tables allow us to create and forward
    traffic in specific cases and define rules concerning where traffic should go
    in each situation.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在多个网络通过对等连接或 Site2Site 连接的情况下，建议使用路由表。自定义路由表允许我们在特定情况下创建并转发流量，并定义有关流量应该去往哪里的一些规则。
- en: Connected devices
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 连接的设备
- en: We have our VNet configured and ready but we need resources in there to actually
    start using it. The first step is to add a new Azure virtual machine to our VNet
    in order to start using the Azure networking stack.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的虚拟网络已经配置好并准备就绪，但我们需要在其中添加资源才能实际使用它。第一步是将新的 Azure 虚拟机添加到虚拟网络中，以便开始使用 Azure
    网络栈。
- en: Creating an Azure virtual machine
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建 Azure 虚拟机
- en: 'In order to create a new Azure virtual machine through the portal, we have
    to take three steps. We need to select New resource and select a new virtual machine.
    We have hundreds of images available and we''ll discuss that in chapters to come:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 为了通过门户创建新的 Azure 虚拟机，我们需要执行三个步骤。我们需要选择“新建资源”，然后选择新的虚拟机。我们有成百上千的镜像可供选择，稍后将在章节中讨论这些镜像：
- en: 'In this case, we need a single VM only, to show networking options for it,
    and we''ll set all default parameters in order to get there quickly. I selected
    the Windows Server 2016 image and started providing the basic information needed:
    Name, VM disk type, Username, Password, Subscription, Resource group, and Location.
    Note that under Location, you have the options to create a new resource group
    and select an existing one. I selected to Use existing, the same one where our
    VNet is located.'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这种情况下，我们只需要一台虚拟机来展示其网络选项，并且我们将设置所有默认参数以便快速完成。我选择了 Windows Server 2016 镜像，并开始提供所需的基本信息：名称、虚拟机磁盘类型、用户名、密码、订阅、资源组和位置。请注意，在位置选项下，你可以选择创建新的资源组或选择现有的资源组。我选择了“使用现有资源组”，即与我们的虚拟网络所在的资源组相同。
- en: 'An example of basic VM creation is shown in the following screenshot:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 基本虚拟机创建的示例如下所示：
- en: '![](img/cf139d58-0d9c-4b30-b836-db2501700914.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cf139d58-0d9c-4b30-b836-db2501700914.png)'
- en: 'The next step is to choose virtual machine size. This again is not relevant to
    the networking part and I''ll select the first one offered, B1s, shown in the
    following screenshot:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是选择虚拟机的大小。这个步骤与网络部分无关，我将选择系统提供的第一个选项，B1s，见下图：
- en: '![](img/c1f64034-7e9b-4d48-b4de-6f8c65ac585d.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c1f64034-7e9b-4d48-b4de-6f8c65ac585d.png)'
- en: In the final step, we are getting to the part where we have some networking
    options. I'll leave all other options at their defaults and concentrate on the network
    part.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在最后一步，我们进入了包含网络选项的部分。我将所有其他选项保留默认设置，并专注于网络部分。
- en: 'First, we need to choose the Virtual network our VM will be connected to. We
    can choose either an existing one or create a new VNet. If no VNet is found, new
    VNet parameters will be automatically provided. If there is already a virtual
    network in the resource group where we place our VM, that VNet will be automatically
    selected. In our case, the PacktVNet created in the first step is shown in the
    following screenshot:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要选择虚拟机将连接的虚拟网络（VNet）。我们可以选择一个现有的虚拟网络或创建一个新的虚拟网络。如果没有找到任何虚拟网络，将自动提供新的虚拟网络参数。如果在我们放置虚拟机的资源组中已经存在一个虚拟网络，系统会自动选择该虚拟网络。在我们的案例中，第一步创建的 PacktVNet
    在以下截图中显示：
- en: '![](img/f671e0f2-5066-4a76-bf76-2549fc7b9385.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f671e0f2-5066-4a76-bf76-2549fc7b9385.png)'
- en: 'The second option we have is to choose the Subnet for our VM. If we are creating
    a new VNet along with the VM, this option will not be available; only the default
    subnet will be created. To be able to choose between subnets, a virtual network
    needs to be created prior to the VM, along with the subnet you want to use. In
    this case, I''ll choose to join the VM to the DMZ subnet I created before. Selecting
    the Subnet option is shown in the following screenshot:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的第二个选项是选择虚拟机的子网。如果我们在创建虚拟机的同时也创建了一个新的虚拟网络，这个选项将不可用；只有默认子网会被创建。为了能够在子网之间进行选择，虚拟网络必须在虚拟机之前创建，并且需要指定要使用的子网。在这种情况下，我将选择将虚拟机加入之前创建的
    DMZ 子网。选择子网选项如下图所示：
- en: '![](img/d913aedf-a375-4067-81ee-e0236077353b.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d913aedf-a375-4067-81ee-e0236077353b.png)'
- en: 'We also have options to choose the Public IP address for our VM. We can choose
    from an existing one (a reserved IP address no longer in use) or create a new
    public IP address. Same goes for Network Security Groups: we can choose an existing
    one or create a new one. I''ll select to create a new Public IP address and a
    new Network Security Group for my VM, as shown in the following screenshot:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以选择虚拟机的公共 IP 地址。我们可以选择一个现有的公共 IP 地址（一个不再使用的保留 IP 地址）或创建一个新的公共 IP 地址。网络安全组也是如此：我们可以选择现有的一个或创建一个新的。我将选择为我的虚拟机创建一个新的公共
    IP 地址和新的网络安全组，如下图所示：
- en: '![](img/229c263d-ff92-4152-8419-1a8ff9261189.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/229c263d-ff92-4152-8419-1a8ff9261189.png)'
- en: After this, the deployment of the VM starts and it takes a few minutes until
    the process is complete. The time required to deploy a new Azure virtual machine
    depends on the VM size, screenshot, and number of requests against the data center.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，虚拟机的部署开始，直到过程完成通常需要几分钟。部署一个新的 Azure 虚拟机所需的时间取决于虚拟机的大小、截图以及对数据中心的请求次数。
- en: IP address types
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IP 地址类型
- en: 'Once the deployment of the VM is finished, we can see the device in Connected
    devices under the virtual network blade. An example of what the connected device
    blade looks like is shown in the following screenshot. Information shown here
    includes the device name, type of device connected, private IP address, and subnet
    the device is assigned to. IP address information is related to a private IP address,
    one that was assigned to our VM on the VNet level and is used only for internal
    traffic. Note that type of device is Network interface. Every VM has a **network
    interface card** (**NIC**) that is used to communicate with the network and one
    is automatically created with your VM. A virtual machine can have more than one
    NIC if you need to connect to multiple subnets or make sure that the VM is available,
    even when one NIC fails. The number of NICs depends on VM size, it can be from
    1 for basic tier VMs to 8 for higher tiers:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦虚拟机的部署完成，我们可以在虚拟网络刃下的“已连接设备”中看到该设备。以下截图显示了连接设备刃的示例。这里显示的信息包括设备名称、连接的设备类型、私有
    IP 地址以及设备分配的子网。IP 地址信息与私有 IP 地址相关，这个 IP 地址是在 VNet 级别分配给我们虚拟机的，仅用于内部流量。请注意，设备类型是网络接口。每个虚拟机都有一个**网络接口卡**（**NIC**），用于与网络通信，并且会在创建虚拟机时自动创建一个。虚拟机可以有多个
    NIC，如果需要连接多个子网，或者确保虚拟机在一个 NIC 故障时仍然可用。NIC 的数量取决于虚拟机的大小，从基本层虚拟机的 1 个 NIC 到更高层虚拟机的
    8 个 NIC：
- en: '![](img/a66337bd-c431-4e79-ab10-b5a1393cebb1.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a66337bd-c431-4e79-ab10-b5a1393cebb1.png)'
- en: 'If we click on the device, it will take us to the NIC blade, as illustrated
    in the following screenshot. We can get to the same blade if we select NIC in
    the resource group. In IP configuration, we can enable or disable IP forwarding,
    change the Subnet that the NIC is connected to, and see the IP configurations
    for both private and public IP addresses:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们点击设备，它将带我们进入 NIC 刃如以下截图所示。我们也可以通过在资源组中选择 NIC 来进入相同的页面。在 IP 配置中，我们可以启用或禁用
    IP 转发，改变 NIC 连接的子网，并查看私有和公共 IP 地址的 IP 配置：
- en: '![](img/96bf93cf-2f4a-4831-b588-1af4e10be46e.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/96bf93cf-2f4a-4831-b588-1af4e10be46e.png)'
- en: Private IP addresses
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 私有 IP 地址
- en: If we select IP configuration, we have further options for IP addresses. An
    example is show in the following screenshot.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们选择 IP 配置，我们将有更多的 IP 地址选项。以下截图展示了一个示例。
- en: By default, a public IP address is enabled but we can disable it if needed.
    This is often used when the VM is in the backend and now public exposure is needed.
    In this case, we need to make sure that we have other options to connect to this
    VM, usually through a VPN. Disabling a public IP address is often in hybrid cloud scenarios when
    no access over the internet is needed. Beside using the public IP address assigned,
    we can create a new one as well here.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，公共 IP 地址是启用的，但如果需要，我们可以禁用它。这通常用于虚拟机位于后端且不需要公共曝光的场景。在这种情况下，我们需要确保有其他方式连接到虚拟机，通常是通过
    VPN。禁用公共 IP 地址通常发生在混合云场景中，当不需要通过互联网访问时。除了使用分配的公共 IP 地址外，我们还可以在这里创建一个新的 IP 地址。
- en: 'A private IP address is by default dynamic and can change over time. A change
    of IP address will not happen out of thin air but in the case of a VM restart
    or shutdown. If we use a private IP address for communication with other VMs on
    our VNet, we may want to keep this address. This can be done by setting IP address
    assignment from Dynamic to Static. This will reserve our IP for this NIC even
    if the VM is kept turned off for a long period of time:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，私有 IP 地址是动态的，并且会随着时间变化。IP 地址的变化不会无缘无故发生，而是在虚拟机重启或关闭的情况下发生。如果我们使用私有 IP
    地址与 VNet 上的其他虚拟机通信，我们可能希望保持该地址不变。可以通过将 IP 地址分配方式从动态设置为静态来实现。这将为该 NIC 保留 IP 地址，即使虚拟机长时间关闭：
- en: '![](img/e5d12c21-7387-42f3-99bd-4db4f9bd028c.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e5d12c21-7387-42f3-99bd-4db4f9bd028c.png)'
- en: 'DNS is another option that is available on both the Vnet and VM levels. We
    can assign Custom DNS that will apply only for this specific NIC. If we assign
    DNS to the VNet level, that DNS will be applied to all VMs connected to that VNet.
    The default option for NIC DNS is to inherit the setting from the virtual network.
    In this case, it will be either Azure DNS or custom DNS, depending on VNet settings.
    If we selected Custom DNS for VNet, we can no longer choose Azure DNS as an option
    on the NIC level. Our only option available is to use Inherit from virtual network
    or Custom DNS. The DNS blade on the NIC level is shown in the following screenshot:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 是 VNet 和虚拟机级别都可用的另一选项。我们可以为特定的 NIC 分配自定义 DNS。如果我们将 DNS 分配到 VNet 级别，该 DNS
    将应用于连接到该 VNet 的所有虚拟机。NIC DNS 的默认选项是继承自虚拟网络设置。在这种情况下，它将是 Azure DNS 或自定义 DNS，具体取决于
    VNet 设置。如果我们为 VNet 选择了自定义 DNS，则无法在 NIC 级别选择 Azure DNS。我们唯一的可选项是使用“从虚拟网络继承”或“自定义
    DNS”。NIC 级别的 DNS 刀锋如下图所示：
- en: '![](img/e600ed88-1b4a-4e19-a026-a012e5aaedf0.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e600ed88-1b4a-4e19-a026-a012e5aaedf0.png)'
- en: Network security groups
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络安全组
- en: 'NSGs are a set of security rules applied on your Azure network resources. They
    are the main tool to enforce and control network traffic rules for your resources.
    NSGs can be applied to two types of resources: subnets and NICs. If an NSG is
    applied to a subnet, the rules will be applied to all devices that are connected
    to that subnet. When an NSG is applied to an NIC, the rules will be applied only
    for that device.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: NSG（网络安全组）是一组应用于您的 Azure 网络资源的安全规则。它们是执行和控制资源网络流量规则的主要工具。NSG 可以应用于两种类型的资源：子网和
    NIC。如果 NSG 应用于子网，规则将应用于连接到该子网的所有设备。当 NSG 应用于 NIC 时，规则仅适用于该设备。
- en: In the overview of the NSG blade, we can see all the rules that are currently
    applied, both inbound and outbound. By default, all inbound traffic from outside
    is disabled, except port `3389`, which allows us to connect to the VM remotely.
    All inbound traffic coming from inside the virtual network or Azure load balancers
    is allowed. These rules can be edited and more added as needed.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在 NSG 刀锋的概览中，我们可以看到当前应用的所有规则，包括入站和出站规则。默认情况下，来自外部的所有入站流量都会被禁用，除了 `3389` 端口，它允许我们远程连接到虚拟机。来自虚拟网络内部或
    Azure 负载均衡器的所有入站流量是允许的。这些规则可以根据需要进行编辑和添加。
- en: Outbound traffic is by default allowed on all levels, going to the virtual network
    or outside. These rules can be edited as well, but there is usually no need to
    restrict outbound traffic.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，所有级别的出站流量都允许流向虚拟网络或外部。 这些规则也可以编辑，但通常无需限制出站流量。
- en: All rules have a priority assigned to them; a lower number represents a rule
    with a higher priority. For example, we have the RDP rule with priority `1000`
    and the `DenyAllInBound` rule (which will block all inbound traffic) with priority
    `65500`. Even though the `DenyAllInBound `rule to block all incoming traffic is
    enforced, the rule to allow RDP has a higher priority and will be enforced first.
    As a result, we have all inbound traffic blocked with the exception of RDP, which
    is allowed due to being a higher priority rule.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 所有规则都有一个优先级分配给它们；较低的数字表示具有较高优先级的规则。例如，我们有优先级为 `1000` 的 RDP 规则，以及优先级为 `65500`
    的 `DenyAllInBound` 规则（该规则会阻止所有入站流量）。即使强制执行了 `DenyAllInBound` 规则来阻止所有入站流量，允许 RDP
    的规则优先级更高，将首先执行。因此，所有入站流量都会被阻止，除了 RDP 规则，由于其优先级更高，允许连接。
- en: 'NSG settings can be opened either through the NIC blade or by selecting NSG
    in the list of resources in the resource group. The overview of the NSG blade
    is shown in the following screenshot:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: NSG 设置可以通过 NIC 刀锋或通过在资源组的资源列表中选择 NSG 打开。NSG 刀锋的概览如下图所示：
- en: '![](img/0b141627-152f-4af7-9ee5-9d464fda092f.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0b141627-152f-4af7-9ee5-9d464fda092f.png)'
- en: 'To add a new rule, go to Inbound security rules and select Add new rule. You
    can choose basic or advanced. If you choose basic, only a few options will be
    available to choose from. I recommend using advanced, as this will give you more
    control over rules:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加新规则，请转到入站安全规则并选择添加新规则。您可以选择基本或高级。如果选择基本，则只会提供一些选项供选择。我建议使用高级，这样可以让您对规则有更多的控制权：
- en: Source: For Source, you can select between several options. Any will allow traffic
    from any source. IP addresses will allow traffic only from named addresses; you
    can enter either a single IP or a range of IP addresses in the CIDR format. This
    can be very useful for restricting access over port `3389` and to secure your
    virtual machines. Service tag will allow traffic coming from a specific service.
    For example, using the Service tag option, you can allow traffic coming from Azure
    storage but block everything else.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 源：对于源，你可以在几个选项之间进行选择。`Any`将允许来自任何源的流量。`IP地址`将仅允许来自指定地址的流量；你可以输入单个IP或CIDR格式的IP地址范围。这对于限制通过端口`3389`的访问以及保护虚拟机非常有用。`服务标签`将允许来自特定服务的流量。例如，使用服务标签选项，你可以允许来自Azure存储的流量，但阻止其他所有流量。
- en: The last option for source is an **Application Security Group** (**ASG**). An
    ASG allows you to create rules and allow traffic only to a certain  group of resources
    on your network. For example, we have multiple servers in our VNet, web servers
    and database servers. Allowing traffic over port `1433 ` to database servers should
    be enabled for web servers but not over the internet. Placing web servers in an
    ASG and creating a rule would allow only web servers to access our databases over
    port `1433` and stop any other traffic.
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 源的最后一个选项是**应用程序安全组**（**ASG**）。ASG允许你创建规则并仅允许流量进入网络上某一特定资源组。例如，我们在VNet中有多个服务器，Web服务器和数据库服务器。允许通过端口`1433`到数据库服务器的流量应该对Web服务器启用，但不允许通过互联网。将Web服务器放入ASG并创建规则，可以只允许Web服务器通过端口`1433`访问我们的数据库，并阻止任何其他流量。
- en: Source port ranges: With Source port ranges, we can also restrict traffic and
    allow it only if it's coming from a specific port or port range.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 源端口范围：通过源端口范围，我们还可以限制流量，仅允许来自特定端口或端口范围的流量。
- en: Destination port ranges: The Destination port ranges option is similar to the source
    option; we have the same set of options available. An ASG is something that can
    be useful to allow traffic only to a certain type of VM on your network. For example,
    placing web servers in an ASG and allowing traffic over ports `443` or `80` would
    allow only these servers to be accessed over these ports and block traffic to
    any other type of VM.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 目标端口范围：目标端口范围选项与源选项类似；我们有相同的可用选项集。ASG可以用于仅允许网络中特定类型的虚拟机访问。例如，将Web服务器放入ASG，并允许通过端口`443`或`80`的流量，这样就只有这些服务器可以通过这些端口进行访问，并且阻止对任何其他类型虚拟机的流量。
- en: The Destination port ranges allow us to specify over which ports traffic is
    allowed, restricting it to a single port or a range.
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 目标端口范围允许我们指定流量允许经过的端口，可以将其限制为单一端口或一个范围。
- en: 'Protocol: It helps us define which protocols are allowed, choosing from either
    TCP or UDP.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 协议：它帮助我们定义哪些协议是允许的，可以选择TCP或UDP。
- en: 'Action: It defines whether this rule is used to allow traffic or block it.
    An NSG can be used either way, it can help us define if certain traffic is allowed,
    but can be used to deny traffic as well and help us secure our resources in Azure.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作：它定义了这个规则是用于允许流量还是阻止流量。NSG可以双向使用，它可以帮助我们定义是否允许特定的流量，但也可以用于拒绝流量，从而帮助我们在Azure中保护资源。
- en: 'Priority: This option is very important as it allows us to define which rules
    are applied first and which rules have the advantage. As mentioned before, the
    lower the priority number assigned to the rule, the higher priority the rule has. The
    rules are processed in order, from the highest priority rule (the lowest number)
    to the lower priority rule (higher number) until the condition is met. Once the
    condition is met, the rule is processed, and the rule processing stops. For example,
    let''s create a rule that will block all traffic over port `1433` and give it
    priority `1000`, and then create a rule that will allow certain sources to have
    traffic over port `1433` with priority `2000`. No traffic over port `1433` will
    ever go through, as a rule with a higher priority is blocking this traffic.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优先级：此选项非常重要，因为它帮助我们定义首先应用哪些规则，哪些规则具有优先权。如前所述，分配给规则的优先级数字越低，规则的优先级越高。规则会按顺序处理，从最高优先级的规则（数字最小）到优先级较低的规则（数字较大），直到满足条件。一旦条件满足，规则就会被处理，并且规则处理停止。例如，我们创建一个规则，阻止所有通过端口`1433`的流量，并给它优先级`1000`，然后创建一个规则，允许某些来源通过端口`1433`的流量，优先级为`2000`。由于优先级较高的规则正在阻止该流量，因此端口`1433`上的流量永远无法通过。
- en: 'Name: The last options are to Name the rule and enter a Description. The Description
    is optional, but I encourage you to fill this in, as it will help you later to
    keep track and understand why something was created in the first place.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：最后的选项是为规则命名并输入描述。描述是可选的，但我建议您填写，因为这将帮助您日后跟踪和理解为何首次创建某个规则。
- en: 'Example settings for advanced options in an NSG are shown in the following
    screenshot:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 示例设置展示了 NSG 中高级选项的配置，如下截图所示：
- en: '![](img/150a7fd7-3759-434d-a382-f6d849896d56.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/150a7fd7-3759-434d-a382-f6d849896d56.png)'
- en: NSGs can be applied on two levels, to NICs and to subnets. If an NSG is applied
    to an NIC, the rules defined in that NSG will be enforced only for the virtual
    machine attached to that NIC. If an NSG is applied to a subnet, the rules will
    be enforced on all VMs on that subnet.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: NSG 可以应用于两个级别，即网络接口卡 (NIC) 和子网。如果将 NSG 应用于 NIC，则该 NSG 中定义的规则仅对连接到该 NIC 的虚拟机生效。如果将
    NSG 应用于子网，则该子网上的所有虚拟机都将遵循这些规则。
- en: You can have an NSG applied both on a subnet and an NIC in some cases. Be careful
    with configuration in that case, as only traffic that is allowed on both levels
    will go through. If we have traffic over port `80` allowed on the subnet level
    but blocked on the NIC level, nothing will pass over port `80`. Same goes the other
    way around, if allowed on the NIC but blocked on the subnet, nothing will pass.
    If you want to block something on the VM that has NSG applied on both the subnet
    and NIC levels, it's enough to block traffic over the named port on one of the NSGs.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，可以同时在子网和 NIC 上应用 NSG。在这种情况下要小心配置，因为只有在两个级别都允许的流量才会通过。如果在子网级别允许端口 `80`
    的流量但在 NIC 级别阻止，端口 `80` 上将不会有流量通过。反之亦然，如果在 NIC 上允许但在子网上阻止，则端口上也不会有流量通过。如果要在已在子网和
    NIC 级别应用了 NSG 的 VM 上阻止某些内容，只需在其中一个 NSG 上阻止命名端口上的流量即可。
- en: Using NSGs in combination with ASGs is the best possible way to protect and
    secure your resources.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 NSG 与 ASG 结合是保护和确保资源安全的最佳方式。
- en: 'Let''s create a scenario where we have three groups of servers: web, application,
    and database.'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个场景，其中我们有三组服务器：web、应用和数据库。
- en: We need web servers to have a connection to application servers and application
    servers to have a connection to the database server. The only connection allowed
    over the internet would be to web servers and we don't want a connection over
    internet to database servers under any circumstances. The first step would be
    to create three Azure security groups, one ASG for each server role. The next
    step would be to configure NSG rules with the use of ASGs.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要使 web 服务器能够连接到应用服务器，应用服务器能够连接到数据库服务器。仅允许通过互联网连接到 web 服务器，而我们不希望在任何情况下通过互联网连接到数据库服务器。第一步是创建三个
    Azure 安全组，每个安全组用于一个服务器角色。接下来是使用 ASG 配置 NSG 规则。
- en: Connection over the internet would be allowed only to servers that are in the
    web ASG. Connection to application servers would be allowed only in the case that
    traffic is coming from servers placed in the web ASG. This would be achieved by
    setting a rule that would allow traffic to the application ASG from the web ASG,
    blocking everything else. Finally, we create a rule that allows traffic to database
    servers (the database ASG) only in cases when the traffic is coming from the application
    ASG.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 仅允许通过互联网连接到位于 web ASG 中的服务器。仅允许来自位于 web ASG 中的服务器的流量连接到应用服务器。通过设置一条规则来实现此目标，该规则允许来自应用
    ASG 的流量到达应用 ASG，阻止其他一切。最后，我们创建一条规则，允许仅在流量来自应用 ASG 时连接到数据库服务器 (数据库 ASG)。
- en: This approach makes administration and maintenance easier and more consistent.
    If you are adding a server to any of the three pools, you need to set proper rules
    and all apply the settings needed. It's easy to make a misstep that would result
    in that server not having all the needed connections or, in the worst case, being
    a security issue. When using an NSG and ASG to keep track of all the rules, all
    we need to do is add a new server to the proper ASG and all the rules and settings
    will automatically apply.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法使管理和维护变得更加简单和一致。如果要将服务器添加到任何三个池中的一个，您需要设置适当的规则并应用所需的设置。很容易犯错，导致该服务器未拥有所有必要的连接，或者在最坏的情况下成为安全问题。使用
    NSG 和 ASG 来跟踪所有规则时，我们只需将新服务器添加到适当的 ASG 中，所有规则和设置将自动应用。
- en: Public IP address
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 公共 IP 地址
- en: Public IP address settings are available through NSG settings or by selecting
    Public IP address from the resources in the Resource group blade.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 公共IP地址设置可以通过NSG设置进行访问，或者通过在资源组面板中选择公共IP地址来访问。
- en: Settings for public IP addresses are similar to private IP addresses. By default,
    they are Dynamic, so the IP can change in the case of a restart or shutdown, but
    we can change this setting to Static. Static will keep the reservation of our
    IP but there is a difference between public and private IP addresses in this case.
    Private IP reservation is free of charge as this is an internal IP, so you can
    choose the range and even set an IP address from that range to be reserved for
    a specific VM. Public IP addresses are assigned and there isn't the option to
    choose which IP address you want. The other difference is that public IP address
    reservation is not free; the first five public IP address reservations are free
    per subscription, but every reservation over that number is charged. The price
    of a reservation over the initial five public IP addresses is not much (around
    $3 per month), but it's good to know what you're paying for.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 公共IP地址的设置与私有IP地址类似。默认情况下，它们是动态的，因此在重启或关机时，IP可能会发生变化，但我们可以将此设置更改为静态。静态IP会保留我们的IP地址，但在这种情况下，公共IP地址和私有IP地址之间有一个区别。私有IP地址的保留是免费的，因为这是一个内部IP地址，所以你可以选择范围，甚至为特定虚拟机（VM）保留该范围内的IP地址。而公共IP地址是分配的，并且没有选择所需IP地址的选项。另一个区别是，公共IP地址的保留是收费的；每个订阅可以免费保留前五个公共IP地址，但超过这个数量的每次保留都将收费。超过前五个公共IP地址的保留价格并不高（大约每月$3），但了解你为此付费是很重要的。
- en: 'A public IP address can be removed from your NIC if you want to restrict access
    (private IP addresses can''t be removed). If you choose to use a public IP address,
    you''ll probably need it either to connect to your VM remotely or to use it for
    applications. If you don''t want to create a reservation, there is another option,
    to use a DNS name label. This option will assign a DNS name to your NIC and you
    can use it to access your VM. Any change of public IP address, which may happen
    as result of a restart or shutdown of your VM, will be handled by Azure DNS. Options
    for public IP address configuration are shown in the following screenshot:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想限制访问，可以从NIC中删除公共IP地址（私有IP地址不能删除）。如果你选择使用公共IP地址，你可能需要它来远程连接到虚拟机，或者用于应用程序。如果你不想创建保留，还有一个选项，可以使用DNS名称标签。此选项将为你的NIC分配一个DNS名称，你可以使用它来访问虚拟机。任何公共IP地址的变化（可能由于虚拟机重启或关机而发生）将由Azure
    DNS处理。公共IP地址配置的选项如下图所示：
- en: '![](img/c1ceee20-9179-4829-8e54-5052785a91fe.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c1ceee20-9179-4829-8e54-5052785a91fe.png)'
- en: Other Azure network services
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他Azure网络服务
- en: The Azure services that we have covered so far are just part of the Azure networking
    stack. The Azure networking stack doesn't stop here and there are many other Azure
    services that are network-related, such as traffic manager, load balancers, or
    virtual gateways. Some of them will be covered in chapters to come.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 我们目前所涵盖的Azure服务只是Azure网络栈的一部分。Azure网络栈并不止于此，还有许多其他与网络相关的Azure服务，例如流量管理器、负载均衡器或虚拟网关。其中一些将在后续章节中介绍。
- en: For example, we'll discuss load balancers with virtual machine high availability.
    A similar case will be with traffic manager when we discuss high availability
    for PaaS. Virtual gateways will be our topic in the chapter about hybrid cloud
    with Microsoft Azure.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们将讨论具有虚拟机高可用性的负载均衡器。当我们讨论PaaS的高可用性时，流量管理器将是一个类似的案例。虚拟网关将在关于Microsoft Azure混合云的章节中讨论。
- en: Hybrid scenarios and security can be managed with a virtual appliance. Virtual
    appliances are Azure virtual machines with third-party firewall software. Most
    leading industry firewalls are supported and available (such as Barracuda, CheckPoint,
    Cisco, and PaloAlto). Virtual machine images for virtual appliances are available
    through Azure marketplace, and you can easily configure and set up a virtual appliance
    and use it to manage and secure your Azure network.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 混合场景和安全性可以通过虚拟设备进行管理。虚拟设备是带有第三方防火墙软件的Azure虚拟机。大多数领先的行业防火墙都受支持并可用（例如Barracuda、CheckPoint、Cisco和PaloAlto）。虚拟设备的虚拟机镜像可以通过Azure市场获得，你可以轻松配置并设置虚拟设备，使用它来管理和保护你的Azure网络。
- en: However, Microsoft Azure is evolving daily and more services are becoming available.
    It would be impossible to cover all services and features. Each chapter in this
    book is potentially a standalone book.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，Microsoft Azure正在不断发展，越来越多的服务正在推出。涵盖所有服务和功能是不可能的。本书的每一章都可能成为一本独立的书。
- en: ARM templates
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ARM模板
- en: We already talked about ARM templates and how they can help us automate things.
    For this chapter, I created a virtual network and joined one virtual machine to
    that network.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经讨论了ARM模板以及它们如何帮助我们实现自动化。在本章中，我创建了一个虚拟网络，并将一台虚拟机加入到该网络中。
- en: 'If you move to automation, you can find an ARM template in JSON format that
    you can use to redeploy my resources. The ARM template will contain all the resources
    and all the settings: a virtual network and parameters, a virtual machine with
    information about the image and size, NSG rules, and so on. It will contain information
    on all dependencies and information on what needs to be created first. For example,
    in order to create a VM, a subnet needs to be created in order to join the VM
    to that subnet, and a subnet can''t be created until a VNet is created.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您转向自动化，您可以找到一个JSON格式的ARM模板，您可以使用它重新部署我的资源。该ARM模板将包含所有资源和所有设置：虚拟网络及其参数、包含有关镜像和大小的虚拟机、NSG规则等。它将包含所有依赖项的信息，以及需要首先创建的内容。例如，为了创建虚拟机，需要先创建一个子网，将虚拟机加入到该子网，而子网无法在虚拟网络创建之前创建。
- en: 'Note that some `parameters`, such as passwords, are not provided as a password
    isn''t allowed to be shown in clear text, but only as a secure string, so you
    need to provide these `parameters` manually:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，某些`参数`（例如密码）没有提供，因为密码不能以明文显示，只能作为安全字符串提供，因此您需要手动提供这些`参数`：
- en: '[PRE0]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This can be particularly helpful once we have multiple resources deployed in
    our resource  group. Using these templates, we can provision identical environments automatically,
    quickly, and with precision. Redeploying a resource group to recreate an environment
    by hand can lead to inconsistencies and missing steps. Using ARM templates produces
    the same result each and every time.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们在资源组中部署了多个资源，这将特别有帮助。使用这些模板，我们可以自动、快速且精准地配置相同的环境。手动重新部署资源组以重新创建环境可能会导致不一致和漏掉步骤。而使用ARM模板，每次都会产生相同的结果。
- en: Summary
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: We covered the basic features of Azure networking with virtual networks, IP
    address types, and NSGs. This basic knowledge of Azure networking will be the foundation
    for chapters to come.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经覆盖了Azure网络的基本功能，包括虚拟网络、IP地址类型和NSG。这些关于Azure网络的基本知识将成为后续章节的基础。
- en: It's also very important to understand ARM templates, as they will be very helpful
    once our infrastructure becomes more complex.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 理解ARM模板也非常重要，因为一旦我们的基础设施变得更复杂，它们将非常有帮助。
- en: From here, we'll advance to Azure IaaS, which will use Azure networking as the backbone
    and the service that holds everything together. We'll see how to create advanced
    VM scenarios that will use Azure networking, private for communication between
    VMs and public for external access. We'll explain in more detail options for creating
    new Azure virtual machines, availability groups, and high-availability for IaaS
    in Azure.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里开始，我们将深入探讨Azure IaaS，它将使用Azure网络作为支撑，并且是将一切整合在一起的服务。我们将展示如何创建高级VM场景，这些场景将使用Azure网络，私有网络用于VM之间的通信，公共网络用于外部访问。我们将更详细地解释如何创建新的Azure虚拟机、可用性组以及在Azure中为IaaS提供高可用性的选项。
- en: Questions
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Which services are depended on the Azure network in Microsoft Azure?
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 哪些服务依赖于Microsoft Azure中的Azure网络？
- en: IaaS
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: IaaS
- en: PaaS
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: PaaS
- en: Both
  id: totrans-129
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: What defines the IP address range in Azure?
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么定义了Azure中的IP地址范围？
- en: Subnet mask
  id: totrans-131
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 子网掩码
- en: CIDR
  id: totrans-132
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: CIDR
- en: RIP
  id: totrans-133
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: RIP
- en: Service endpoints are used to connect which services to your virtual network?
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务端点用于将哪些服务连接到您的虚拟网络？
- en: Virtual machines
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 虚拟机
- en: PaaS
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: PaaS
- en: SaaS
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: SaaS
- en: The default DNS service in Microsoft Azure is...?
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Microsoft Azure中的默认DNS服务是...?
- en: Azure DNS
  id: totrans-139
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure DNS
- en: Public DNS
  id: totrans-140
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 公共DNS
- en: Custom DNS
  id: totrans-141
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 自定义DNS
- en: When can service endpoints be added?
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么时候可以添加服务端点？
- en: When creating a virtual network
  id: totrans-143
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建虚拟网络时
- en: After a virtual network is created
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建虚拟网络后
- en: At any time
  id: totrans-145
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 任何时候
- en: Private IP addresses in Azure can be...?
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure中的私有IP地址可以是...?
- en: Dynamic
  id: totrans-147
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 动态
- en: Static
  id: totrans-148
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 静态
- en: Both
  id: totrans-149
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: Public IP addresses in Azure can be...?
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure中的公共IP地址可以是...?
- en: Dynamic
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 动态
- en: Static
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 静态
- en: Both
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: NSGs are...?
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: NSG是什么？
- en: Security rules that define traffic flow
  id: totrans-155
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义流量流向的安全规则
- en: Rules on IP address reservations
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关于IP地址预留的规则
- en: Both
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两者
- en: What does an NSG define?
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: NSG定义了什么？
- en: Outbound traffic rules
  id: totrans-159
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '出站流量规则  '
- en: Inbound traffic rules
  id: totrans-160
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 入站流量规则
- en: Both
  id: totrans-161
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '两者  '
- en: To what can an NSG not be assigned to?
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'NSG不能分配给什么？  '
- en: Virtual network
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '虚拟网络  '
- en: NIC
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '网络接口卡（NIC）  '
- en: Subnet
  id: totrans-165
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '子网  '
