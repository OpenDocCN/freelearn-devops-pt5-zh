- en: Designing Web Applications
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计 Web 应用程序
- en: In the previous chapter, we covered the compute-intensive application objectives.
    We covered how to design high-performance computing and other compute-intensive
    applications.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们涵盖了计算密集型应用程序的目标。我们讨论了如何设计高性能计算和其他计算密集型应用程序。
- en: This chapter introduces the web application's objectives. It will cover information
    about Azure Web Apps, the different App Service plans that are available, and
    what the characteristics are for the different App Service plans. You will learn
    more about designing Web Apps for Containers using Azure Container Services and
    Docker, how to design Web Apps for high availability, scalability, and performance
    using Redis Cache, auto-scaling, App Service environments, and more. You will
    also learn how to design a custom Web API and what Azure offers in terms of securing
    custom APIs.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了 Web 应用程序的目标。它将涵盖有关 Azure Web 应用、不同可用的应用服务计划以及不同应用服务计划的特征的信息。您将了解如何使用 Azure
    容器服务和 Docker 设计 Web 应用程序以用于容器，如何使用 Redis 缓存、自动扩展、应用服务环境等设计具有高可用性、可扩展性和性能的 Web
    应用程序，以及如何设计自定义 Web API 及 Azure 在保护自定义 API 方面提供的功能。
- en: 'The following topics will be covered:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 将涵盖以下主题：
- en: Azure Web Apps
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Web 应用
- en: App Service plans
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用服务计划
- en: Designing Web Apps for Containers
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为容器设计 Web 应用
- en: Designing Web Apps for high availability, scalability, and performance
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为高可用性、可扩展性和性能设计 Web 应用
- en: Designing and securing custom Web APIs
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计和保护自定义 Web API
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter uses the following tools for the examples:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章示例中使用以下工具：
- en: Visual Studio 2017: [https://www.visualstudio.com/downloads/](https://www.visualstudio.com/downloads/)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Visual Studio 2017：[https://www.visualstudio.com/downloads/](https://www.visualstudio.com/downloads/)
- en: 'The source code for this chapter can be downloaded here:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的源代码可以在此处下载：
- en: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%203/](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%203)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%203/](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%203)'
- en: Azure Web Apps
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Web 应用
- en: Azure Web Apps is a part of Azure App Services and it is where you can host
    your websites and applications in Azure. Using Web Apps, you only pay for the
    compute resources you use, not for the actual hosting of your site or application.
    Besides websites and applications, you can also host your Web APIs and your mobile
    backends inside Azure Web Apps.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Web 应用是 Azure 应用服务的一部分，您可以在其中托管您的网站和应用程序。使用 Web 应用，您只需支付您使用的计算资源费用，而不是您的站点或应用程序的实际托管费用。除了网站和应用程序外，您还可以在
    Azure Web 应用中托管您的 Web API 和移动后端。
- en: You can use a programming language of your choice for developing applications.
    At the time of writing, Azure Web Apps supports .NET, .NET Core, Java, Ruby, Node.js,
    PHP, and Python. Those applications are hosted on Windows or Linux virtual machines
    that are fully managed by Microsoft and can easily be scaled using out-of-the-box
    features. Besides scaling, you can leverage other Azure features, such as security,
    load balancing, and insights and analytics. You can also use the DevOps capabilities,
    such as Continuous Integration and deployment from VSTS, GitHub, Docker Hub, and
    other resources, SSL certificates, package management, staging environments, and
    custom domains.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以选择任意编程语言开发应用程序。在撰写本文时，Azure Web 应用支持 .NET、.NET Core、Java、Ruby、Node.js、PHP
    和 Python。这些应用程序托管在由 Microsoft 完全管理的 Windows 或 Linux 虚拟机上，并可以使用现成的功能轻松进行扩展。除了扩展之外，您还可以利用其他
    Azure 功能，例如安全性、负载均衡、洞察和分析。您还可以使用 DevOps 功能，例如从 VSTS、GitHub、Docker Hub 和其他资源进行持续集成和部署、SSL
    证书、包管理、暂存环境和自定义域。
- en: App Service plans
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用服务计划
- en: Azure Web Apps are hosted inside App Service plans. Inside the App Service plan,
    you can configure all the required settings, such as the costs, the compute resources,
    and in which region you want to deploy your apps. There are different types of
    App Service plans available in Azure, from free plans where you share all the
    resources with other customers and that are most suitable for development applications,
    to paid plans, where you can choose to host your apps on Windows VMs or Linux
    VMs and can set the available CPU, and more.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Web 应用托管在应用服务计划中。在应用服务计划中，您可以配置所有必需的设置，例如成本、计算资源以及您希望部署应用程序的区域。Azure 提供不同类型的应用服务计划，从与其他客户共享所有资源的免费计划（最适合开发应用程序）到付费计划，您可以选择在
    Windows VM 或 Linux VM 上托管您的应用程序，并可以设置可用的 CPU 等。
- en: 'Azure offers the following service plan SKUs:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供以下服务计划 SKU：
- en: '**Free and Shared**: Your app runs on the same VM as other apps in a shared
    environment. This environment can also include apps from other customers. Each
    app has a CPU quota and there is no ability to scale up or out. These App Service
    plans are most suited for development and test apps or apps with less traffic.
    There is no SLA support for those two plans. The Shared service plan offers the
    ability to add custom domains.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**免费和共享：**您的应用程序与其他应用程序在共享环境中的同一虚拟机上运行。该环境还可能包括来自其他客户的应用程序。每个应用程序都有一个 CPU 配额，且无法进行纵向或横向扩展。这些应用服务计划最适合用于开发和测试应用程序，或者流量较少的应用程序。这两种计划不提供
    SLA 支持。共享服务计划提供添加自定义域的能力。'
- en: '![](img/1cde9366-7505-4c0a-957f-1d888e183733.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1cde9366-7505-4c0a-957f-1d888e183733.jpg)'
- en: Free and Shared App Service plan in the Azure Portal
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户中的免费和共享应用服务计划
- en: '**Basic**: The Basic tier is the first tier, where you can choose between different
    pricing ranges. It offers three tiers and the available cores and RAM will double
    for every tier. Apps run on dedicated Linux or Windows VMs and the compute resources
    are only shared between apps that are deployed inside the same App Service plan.
    All apps inside the same App Service plan reside in an isolated environment, which
    supports SSL and custom domains. The Basic tier offers scaling to three instances,
    but you need to do this manually. This tier is most suitable for development and
    test environments and applications with less traffic.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基础：**基础层级是第一个层级，您可以在不同的定价范围之间进行选择。它提供三个层级，每个层级的可用核心和内存都会翻倍。应用程序运行在专用的 Linux
    或 Windows 虚拟机上，计算资源仅在同一应用服务计划内部署的应用程序之间共享。所有位于同一应用服务计划中的应用程序都驻留在一个隔离的环境中，支持 SSL
    和自定义域。基础层级支持扩展到三个实例，但需要手动进行。这一层级最适合开发和测试环境以及流量较少的应用程序。'
- en: '![](img/4aefd80f-faac-4c0c-89d5-126282710250.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4aefd80f-faac-4c0c-89d5-126282710250.jpg)'
- en: Basic App Service plan in the Azure Portal
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户中的基础应用服务计划
- en: '**Standard: **The Standard tier also has three tiers to choose from. It offers
    custom domains and SSL support, offers autoscale up to ten instances, and offers
    five deployment slots, which can be used for testing, staging, and production
    apps. It also provides daily backups and Azure Traffic Manager.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准：**标准层级也有三个层级可供选择。它提供自定义域和 SSL 支持，支持自动扩展最多 10 个实例，并提供五个部署插槽，可用于测试、暂存和生产应用程序。它还提供每日备份和
    Azure 流量管理器。'
- en: '![](img/b4a6d0a6-48c7-464f-8956-7957f6c4387a.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b4a6d0a6-48c7-464f-8956-7957f6c4387a.jpg)'
- en: Standard App Service plan in the Azure Portal
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户中的标准应用服务计划
- en: '**Premium: **Premium offers two types of tiers, Premium and PremiumV2\. They
    both offer all the features of the Standard tier, but the Premium tier offers
    extra scale instances and deployment slots. The Premium V2 runs on Dv2-series
    virtual machines, which offer faster processors and SSD drives and drastically increase
    the performance of your application.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高级：**高级提供两种层级，Premium 和 PremiumV2。它们都提供标准层级的所有功能，但高级层级提供额外的扩展实例和部署插槽。Premium
    V2 运行在 Dv2 系列虚拟机上，具有更快的处理器和 SSD 驱动器，极大提高了应用程序的性能。'
- en: '![](img/11b47420-ec8c-4e6a-870d-beede9f9db57.jpg)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/11b47420-ec8c-4e6a-870d-beede9f9db57.jpg)'
- en: Premium App Service plan in the Azure Portal
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户中的高级应用服务计划
- en: '**Isolated**: The Isolated tier offers full isolation for your applications
    by providing a private environment with dedicated virtual machines and virtual
    networks. You can also scale up to 100 instances. To create a private environment,
    App Services uses an **App Service Environment** (**ASE**), which will be covered
    in the next section. All apps run on Dv2-series virtual machines, so it offers
    high-performance capabilities. The Isolated App Service plan is most suitable
    for apps that need complete isolation, because of high security demands for instance,
    but that want to leverage all the capabilities that Azure Web Apps offer, such
    as auto-scale and deployment slots.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**隔离：**隔离层级通过提供具有专用虚拟机和虚拟网络的私有环境，为您的应用程序提供完全隔离。您还可以扩展到 100 个实例。为了创建私有环境，应用服务使用
    **应用服务环境**（**ASE**），将在下一部分中介绍。所有应用程序都运行在 Dv2 系列虚拟机上，因此提供高性能能力。隔离应用服务计划最适合需要完全隔离的应用程序，例如由于安全需求较高的情况，但又希望利用
    Azure Web Apps 提供的所有功能，如自动扩展和部署插槽。'
- en: '![](img/d2a7074e-9704-45d5-be06-bd02fb055efc.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d2a7074e-9704-45d5-be06-bd02fb055efc.jpg)'
- en: Isolated App Service plan in the Azure Portal
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户中的隔离应用服务计划
- en: The App Service Environment (ASE)
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用服务环境（ASE）
- en: The ASE is a feature of Azure App Service that provides a fully isolated environment
    for your Web Apps, mobile apps, API apps, and Azure Functions. An ASE is deployed
    inside a subnet of the VNet, so this provides full isolation and secure network
    access. ASEs are most suitable for apps that require high-scale workloads because
    they can be spread across a single or multiple Azure regions. Because of the network
    isolation, ASEs are also very suitable for apps with high security requirements.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ASE 是 Azure 应用服务的一个功能，它为你的 Web 应用、移动应用、API 应用和 Azure 函数提供了一个完全隔离的环境。ASE 部署在
    VNet 的子网内，因此提供完全的隔离和安全的网络访问。ASE 最适合需要高规模工作负载的应用，因为它们可以分布在一个或多个 Azure 区域中。由于网络隔离，ASE
    也非常适合有高安全要求的应用。
- en: There can only be one ASE created per Azure subscription and it can host up
    to 100 instances; from 100 app instances in a single App Service plan to 100 App
    Service plans with one app instance.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 Azure 订阅只能创建一个 ASE，它最多可以托管 100 个实例；从一个 App Service 计划中的 100 个应用实例，到 100 个
    App Service 计划，每个计划中有一个应用实例。
- en: ASEs use frontends and workers where the former are suitable for automatic load
    balancing of the requests inside the ASE and the latter host the actual Web Apps
    inside the ASE. They are added automatically by Azure.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ASE 使用前端和工作者，其中前端适用于自动负载均衡 ASE 内的请求，而工作者则托管实际的 Web 应用。它们由 Azure 自动添加。
- en: At the time of writing, there are two different versions of ASE, v1 and v2\.
    The difference between the two versions is that v2 automatically adds frontends
    and workers to the ASE depending on the scale of the App Service plans. In v1,
    you had to add those roles manually before you could scale out your App Service
    plan.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在写作时，ASE 有两个不同的版本，v1 和 v2。两个版本的区别在于，v2 会根据应用服务计划的规模自动添加前端和工作者到 ASE 中。而在 v1 中，你必须手动添加这些角色，才能扩展你的应用服务计划。
- en: Creating an ASE
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建 ASE
- en: 'You can create an Azure ASE from the Azure Portal by taking the following steps:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过以下步骤从 Azure 门户创建 Azure ASE：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 进入 Azure 门户。
- en: Click on New and  type `App Service Environment` in the search bar. Click the
    Create button.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“新建”，然后在搜索栏中输入 `App Service Environment`。点击“创建”按钮。
- en: 'A new blade opens up, where you can fill in the basic settings of the VM. Add
    the following:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 会打开一个新的面板，在这里你可以填写虚拟机的基本设置。请添加以下内容：
- en: 'Name: `PacktASE`'
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：`PacktASE`
- en: 'Subscription: Select a subscription here'
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 订阅：在此选择一个订阅
- en: Resource Group: `` `PacktPubASE` ``
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源组：`` `PacktPubASE` ``
- en: 'Virtual Network/Location: Azure will automatically create a new virtual network
    for you. If you want to pick an existing one, you can change the settings by clicking
    the link.'
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟网络/位置：Azure 将为你自动创建一个新的虚拟网络。如果你想选择现有的虚拟网络，可以通过点击链接更改设置。
- en: '![](img/f5ae86e8-2538-4e29-97f2-a4464ba06bb5.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f5ae86e8-2538-4e29-97f2-a4464ba06bb5.jpg)'
- en: Creating ASE in the Azure Portal
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中创建 ASE
- en: Click on Create. Azure will create an ASE, a virtual network, a route table,
    and a NSG for you.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建”。Azure 将为你创建一个 ASE、一个虚拟网络、一个路由表和一个 NSG。
- en: 'You can now choose this ASE when you create a new Azure App Service plan:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你现在可以在创建新的 Azure 应用服务计划时选择这个 ASE：
- en: '![](img/f844a419-97b5-4089-805a-01ad97363076.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f844a419-97b5-4089-805a-01ad97363076.jpg)'
- en: Creating an ASE in the Azure Portal
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中创建 ASE
- en: Please note that the creation of an ASE can be quite expensive, so I strongly
    advise you to remove this when you are finished with your test.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，创建 ASE 可能会非常昂贵，因此我强烈建议在完成测试后将其删除。
- en: For more information about Azure ASE, you can refer to the following Microsoft
    documentation: [https://docs.microsoft.com/en-us/azure/app-service/environment/intro](https://docs.microsoft.com/en-us/azure/app-service/environment/intro).
    [](https://docs.microsoft.com/en-us/azure/app-service/environment/intro)
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 Azure ASE 的更多信息，你可以参考以下微软文档：[https://docs.microsoft.com/en-us/azure/app-service/environment/intro](https://docs.microsoft.com/en-us/azure/app-service/environment/intro)。
    [](https://docs.microsoft.com/en-us/azure/app-service/environment/intro)
- en: Web Apps for Containers
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 容器化 Web 应用
- en: Web Apps for Containers is part of the Azure App Service on Linux. It lets you
    easily deploy and scale your own Docker-formatted images on Azure. Docker is based
    on open standards, which means it can run on all major Linux distributions and
    Windows Server 2016.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 容器化 Web 应用是 Azure 上的一个服务，它让你能够轻松地在 Azure 上部署和扩展你自己的 Docker 格式镜像。Docker 基于开放标准，这意味着它可以在所有主流的
    Linux 发行版和 Windows Server 2016 上运行。
- en: Docker containers are lightweight sandboxes on top of your OS. When your application
    is deployed inside a Docker container, the app cannot see or access all other
    applications or processes that are running on the same OS. You can compare this
    to creating different VMs to host different types of workloads or applications,
    but without the overhead of the virtualization itself. Docker containers also
    share the same OS and infrastructure, whereas VMs need to have their own OS installed
    inside their own infrastructure.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 容器是轻量级的沙箱，运行在操作系统之上。当你的应用部署在 Docker 容器内时，应用无法看到或访问同一操作系统上运行的其他应用或进程。你可以将其与为托管不同类型工作负载或应用而创建的虚拟机进行比较，但没有虚拟化本身带来的开销。Docker
    容器还共享相同的操作系统和基础设施，而虚拟机需要在自己的基础设施中安装独立的操作系统。
- en: With containers, you share the underlying resources of the Docker host and you
    build a Docker image that includes everything you need to run the application.
    You can start with a basic image and then add everything you need.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 使用容器时，你可以共享 Docker 主机的底层资源，并构建一个包含运行应用所需一切的 Docker 镜像。你可以从一个基础镜像开始，然后添加所需的所有内容。
- en: Docker containers are also extremely portable. You can deploy a Docker container
    including all the settings, such as configuration settings, a specific runtime,
    framework, and tooling on a VM with Docker installed. You can then easily move
    that same container to the Azure App Service on Linux, and the application will
    still run as expected. This solves the *it works on my machine* problem that (mostly)
    all developers face. This makes Docker not a virtualization technology, but an
    application delivery technology.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 容器也具有极强的可移植性。你可以将包含所有设置（如配置设置、特定运行时、框架和工具）的 Docker 容器部署到安装了 Docker 的虚拟机上。然后，你可以轻松地将同一个容器移至
    Azure Linux 上的 App 服务，应用仍然可以按预期运行。这解决了 *它在我的机器上能工作* 的问题，这是几乎所有开发人员都会遇到的。这使得 Docker
    不仅仅是虚拟化技术，而是一种应用交付技术。
- en: Docker containers are very suitable for building applications that leverage
    the microservices architecture, where parts of an application are loosely coupled,
    and divided into separate services that all collaborate with each other. Each
    service can then be deployed into a separate container, written in their own programming
    language, using their own configuration settings. A service can consist of a database,
    or a Web API, or a mobile backend for instance. You can easily deploy multiple
    copies of a single application, or database. The only thing to be aware of is
    that they all share the same OS. If your application needs to run on a different
    OS, you still have to use a VM.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 容器非常适合构建利用微服务架构的应用，其中应用的各个部分松散耦合，并被分为各自独立的服务，它们之间相互协作。每个服务可以部署到单独的容器中，使用自己编写的编程语言和配置设置。例如，一个服务可以是数据库、Web
    API 或移动后端。你可以轻松地部署同一个应用或数据库的多个副本。唯一需要注意的是，它们共享同一个操作系统。如果你的应用需要在不同的操作系统上运行，你仍然需要使用虚拟机。
- en: For more information on Azure App Service on Linux, you can refer to the following
    website: [https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro](https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro).
    [](https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro)
    Microsoft released a sample project, called **Developer Finder**, which is available
    on GitHub. This will give you an great overview of the possibilities of Docker
    containers and is a good starting point for developing your own applications using
    Docker. You can refer to the following site: [https://github.com/azure-app-service/demoapp](https://github.com/azure-app-service/demoapp).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 Azure Linux 上的 App 服务的更多信息，可以参考以下网站：[https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro](https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro)。Microsoft
    发布了一个名为 **Developer Finder** 的示例项目，可以在 GitHub 上找到。它将为你提供 Docker 容器的可能性概览，是使用 Docker
    开发自己应用的一个良好起点。你可以参考以下网站：[https://github.com/azure-app-service/demoapp](https://github.com/azure-app-service/demoapp)。
- en: Getting started with Web App for Containers
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开始使用 Web 应用容器
- en: 'Web App for Containers can be created from the Azure Portal. Follow these steps
    to create a project:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 可以从 Azure 门户创建 Web 应用容器。请按照以下步骤创建项目：
- en: In this example, I'm using the Docker Hub as a repository for images. You can
    create an account using the following link: [https://hub.docker.com/](https://hub.docker.com/).
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我使用 Docker Hub 作为镜像仓库。你可以通过以下链接创建账户：[https://hub.docker.com/](https://hub.docker.com/)。
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 访问 Azure 门户。
- en: 'Click on Newand in the search bar type `Web App for Containers`. Click on the Create button,
    as shown in the following screenshot:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **New**，在搜索框中输入 `Web App for Containers`。点击 **Create** 按钮，如下图所示：
- en: '![](img/0f0c5594-1d5a-49b2-ad70-24c813617e4f.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0f0c5594-1d5a-49b2-ad70-24c813617e4f.jpg)'
- en: Creating a Web App for Containers project in the Azure Portal
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中创建 Web 应用容器项目
- en: 'A new blade opens up. Add the following values:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 会打开一个新的面板，添加以下值：
- en: App name: `PacktContainers`.
  id: totrans-72
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用名称：`PacktContainers`。
- en: 'Subscription: Select a subscription here.'
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 订阅：在这里选择一个订阅。
- en: 'Resource Group: This one is automatically filled in when you enter the app
    name. Leave it as default.'
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资源组：输入应用名称时，资源组会自动填充。保持默认即可。
- en: 'App Service plan/Location: A new App Service plan will automatically be created.
    If you want to pick an existing one, or change the default settings, you can click
    on it.'
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用服务计划/位置：会自动创建一个新的应用服务计划。如果你想选择现有的，或者更改默认设置，可以点击它。
- en: '![](img/1b52c7bc-fd3e-4237-8c5c-14d7cdac7b3c.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1b52c7bc-fd3e-4237-8c5c-14d7cdac7b3c.jpg)'
- en: Web App for Containers settings in the Azure Portal
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中为容器配置 Web 应用设置
- en: 'Configure container: This will take you to the actual Docker settings. Here,
    pick Docker Hub as an image source.'
  id: totrans-78
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置容器：这将带你进入实际的 Docker 设置。在这里，选择 Docker Hub 作为镜像源。
- en: 'Image and optional tag: `mysql`.'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 镜像和可选标签：`mysql`。
- en: '![](img/f1f872a3-2b75-48a1-9483-18f394dc3abe.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f1f872a3-2b75-48a1-9483-18f394dc3abe.jpg)'
- en: Configuring a container in the Azure Portal
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中配置容器
- en: Designing Web Apps for high availability, scalability, and performance
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计 Web 应用的高可用性、可扩展性与性能
- en: Performance is an important issue to keep in mind when designing Web Apps. Web
    Apps that are unresponsive or that perform badly will eventually lose all their
    visitors. They will simply hop on to another site. Azure provides multiple options
    to make your Web App highly available and scalable, which will result in a better
    performance to keep your visitors on board.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 性能是设计 Web 应用时需要牢记的重要问题。那些反应迟钝或者性能差的 Web 应用最终会失去所有访客，他们会直接跳转到其他网站。Azure 提供了多种选项来使你的
    Web 应用高可用和可扩展，从而提高性能，保持访客的留存。
- en: Beside the features that Azure offers to design for high availability, scaling,
    and performance, you can keep certain architecture patterns in mind when architecting
    your Web App. You can refer to the following article from the Azure Architecture
    Center for these patterns: [https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability](https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 Azure 提供的设计高可用性、扩展性和性能的功能外，在设计 Web 应用时，你还可以考虑一些架构模式。你可以参考 Azure 架构中心的以下文章来获取这些模式：[https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability](https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability)。
- en: High availability and performance
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高可用性与性能
- en: Azure provides several ways to make your Web App perform better and to become
    highly available. You can use a **Content Delivery Network** (**CDN**), a cache,
    or you can copy your Web App over to multiple regions.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了几种方法来提升 Web 应用的性能并实现高可用性。你可以使用 **内容分发网络**（**CDN**）、缓存，或者将 Web 应用复制到多个区域。
- en: Using a CDN
  id: totrans-87
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 CDN
- en: You can use a CDN to scale your websites globally. By using a CDN, your static
    content, such as HTML pages, style sheets, client-side scripts, images, documents,
    and files, are cached in different regions. This way, it takes less time to download
    the content, because the static content is physically closer to the user, which
    increases the performance of your Web App.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 CDN 实现全球网站的扩展。通过使用 CDN，你的静态内容，如 HTML 页面、样式表、客户端脚本、图片、文档和文件，将会在不同区域进行缓存。这样，下载内容的时间会更短，因为静态内容离用户物理上更近，这提升了
    Web 应用的性能。
- en: Azure CDN allows you to use custom domain names to access your content. This
    can be configured inside the Azure Portal. You can refer to the following article
    to add a custom domain: [https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain](https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain).
    You can also enable HTTPS for your CDN: [https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl](https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl).
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Azure CDN 允许你使用自定义域名访问你的内容。可以在 Azure 门户内进行配置。你可以参考以下文章来添加自定义域名：[https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain](https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain)。你还可以为你的
    CDN 启用 HTTPS：[https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl](https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl)。
- en: Using Redis Cache
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Redis 缓存
- en: Redis Cache in Azure is based on the popular open-source implementation, Redis
    Cache. It provides a secure cache from where you can access your data and that
    runs in an Azure data center. It can be used by different types of applications,
    including Web Apps, applications inside a virtual machine, or other cloud services.
    Caches can be shared by all applications that have the appropriate access key.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: Redis 缓存在 Azure 上基于流行的开源实现 Redis Cache。它提供一个安全的缓存，数据可以从中访问，且运行在 Azure 数据中心。它可以被不同类型的应用程序使用，包括
    Web 应用、虚拟机内的应用程序或其他云服务。缓存可以被所有拥有适当访问密钥的应用程序共享。
- en: 'Azure Redis Cache comes in the following tiers:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Redis 缓存有以下几种层级：
- en: '**Basic**: This is a single node cache, ideal for development, test environments,
    and non-critical workloads. This tier has no SLA.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基础：**这是单节点缓存，适用于开发、测试环境和非关键工作负载。此层级没有 SLA 服务水平协议。'
- en: '**Standard**: Provides a replicated cache. The data is automatically replicated
    between the two nodes. This tier offers an SLA.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准：**提供复制缓存。数据在两个节点之间自动复制。此层级提供 SLA 服务水平协议。'
- en: '**Premium: **The Premium tier has all the standard features and, in addition,
    it provides bigger workloads, better performance, disaster recovery, and enhanced
    security. It also offers Redis Persistence, which persists data that is stored
    inside the cache. Snapshots and backups can be created and restored in case of
    failures. It also offers Redis Cluster, which automatically shares data across
    multiple Redis nodes, so you can create workloads of bigger memory sizes (greater
    than 53 GB) and get better performance. It also offers support for Azure Virtual
    Networks, which gives the ability to isolate your cache by using subnets, access
    control policies, and more. You can provision an Azure Redis Cache from the Azure
    Portal using an ARM template.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高级：**高级层具有所有标准功能，此外还提供更大的工作负载、更好的性能、灾难恢复和增强的安全性。它还提供 Redis 持久性，将存储在缓存中的数据进行持久化。可以在发生故障时创建和恢复快照和备份。它还提供
    Redis 集群，自动将数据分配到多个 Redis 节点上，因此可以创建更大内存（超过 53 GB）的工作负载并获得更好的性能。它还支持 Azure 虚拟网络，允许使用子网、访问控制策略等功能来隔离缓存。你可以通过
    Azure 门户使用 ARM 模板来配置 Azure Redis 缓存。'
- en: '![](img/707b9395-a817-47b7-9408-2e3327762bea.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](img/707b9395-a817-47b7-9408-2e3327762bea.jpg)'
- en: Provisioning Redis Cache from the Azure Portal
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Azure 门户配置 Redis 缓存
- en: You can refer to the following article to download some sample ARM templates
    for deploying Azure Redis Cache with different types of configuration settings: [https://docs.microsoft.com/en-us/azure/redis-cache/cache-redis-cache-arm-provision](https://docs.microsoft.com/en-us/azure/redis-cache/cache-redis-cache-arm-provision).
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以参考以下文章下载一些示例 ARM 模板，用于部署具有不同配置设置的 Azure Redis 缓存：[https://docs.microsoft.com/en-us/azure/redis-cache/cache-redis-cache-arm-provision](https://docs.microsoft.com/en-us/azure/redis-cache/cache-redis-cache-arm-provision)。
- en: Using Azure Traffic Manager
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Azure Traffic Manager
- en: Another way of designing for availability and scalability is copying your Web
    App over to multiple regions or data centers. Azure uses Azure Traffic Manager
    to spread the workload. Your Web App can be reached by using a single URL, where
    Azure Traffic Manager will handle the load and locate the closest geographical
    region or most suitable region for you at the DNS level.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种设计高可用性和可扩展性的方法是将你的 Web 应用程序复制到多个地区或数据中心。Azure 使用 Azure Traffic Manager 来分配工作负载。你可以通过一个单一的
    URL 访问你的 Web 应用程序，Azure Traffic Manager 会在 DNS 层面处理负载并找到最接近的地理位置或最合适的区域。
- en: '![](img/eb2a0eb3-f484-4052-a3a7-d8a6a7ec7062.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/eb2a0eb3-f484-4052-a3a7-d8a6a7ec7062.jpg)'
- en: Azure Trafic Manager
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Traffic Manager
- en: 'When creating an Azure Traffic Manager profile from the Azure Portal, you can
    choose between four different routing methods:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在从 Azure 门户创建 Azure Traffic Manager 配置文件时，你可以选择四种不同的路由方法：
- en: '**Performance**: Select this method when you have endpoints in different geographical locations
    and you want end users to use the closestendpoint in terms of the lowest network
    latency.'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**性能**：当您的终端位于不同的地理位置，且您希望终端用户使用网络延迟最低的最近端点时，请选择此方法。'
- en: '**Weighted**:This method is best suitable for when you want your application
    to be distributed evenly or according to certain weights, which you define.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**加权**：当您希望您的应用程序按某些权重（由您定义）均匀或有条件地分配时，此方法最为适用。'
- en: '**Priority**: Use this method when you want one endpoint to be the primary
    endpoint for all traffic, and provide backups in case the primary or the backup
    endpoints are unavailable.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优先级**：当您希望某个端点作为所有流量的主端点，并在主端点或备用端点不可用时提供备份时，请使用此方法。'
- en: '**Geographic**: This method is best suitable for scenarios where knowing a
    user’s geographical region and routing them based on that is important. Localization
    of content can be a reason for choosing this method, for instance. Users are then
    directed to specific endpoints based on the geographical location where their
    DNS query comes from.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**地理位置**：此方法最适用于需要根据用户的地理区域进行路由的场景。例如，内容的本地化可能是选择此方法的原因。然后，用户将根据其DNS查询的来源地理位置被引导到特定的端点。'
- en: Azure Traffic Manager is also discussed in [Chapter 5](1d5ef29a-96fb-452c-a0d6-718d6d2d1c84.xhtml),
    *Robust Networking Implementations*. For more information, you can refer to that
    chapter.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 流量管理器也在[第5章](1d5ef29a-96fb-452c-a0d6-718d6d2d1c84.xhtml)，*强大的网络实现*中进行了讨论。有关更多信息，您可以参考该章节。
- en: Scalability
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可扩展性
- en: Azure provides the ability to scale your Web Apps. One of the possibilities
    is to scale out, where you can scale your Web Apps globally. Scaling out means
    adding nodes to, or removing nodes from, a Web App. This way, the load time is
    decreased when the Web App is accessed from different locations. The other option
    is to scale up. Scaling up means adding resources to, or removing resources from,
    a Web App, such as CPUs or memory. When scaling up, you switch to another pricing
    tier inside your App Service plan, or pick a different App Service plan.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了扩展 Web 应用的能力。扩展的一个可能性是扩展出，您可以在全球范围内扩展 Web 应用。扩展出意味着向 Web 应用添加或移除节点。这样，当从不同位置访问
    Web 应用时，加载时间会减少。另一个选项是扩展上。扩展上意味着向 Web 应用添加或移除资源，例如 CPU 或内存。扩展上时，您会在应用服务计划内切换到另一个定价层，或选择不同的应用服务计划。
- en: For more information about Azure App Service plans, you can refer to the beginning
    of this chapter.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 Azure 应用服务计划的更多信息，您可以参考本章开头部分。
- en: Scaling out
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扩展
- en: 'There are multiple ways to scale out your Web App. You can scale out manually
    or automatically by using **Azure Autoscale**. To use Autoscale, take the following
    steps:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法可以扩展您的 Web 应用。您可以手动扩展或使用 **Azure 自动扩展** 自动扩展。要使用自动扩展，请按照以下步骤操作：
- en: Under Settings, click on Scale Out (App Service plan).
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“设置”下，点击“扩展（应用服务计划）”。
- en: 'In the right-hand side of the screen, you can increase or decrease the Instance
    count. The maximum instance count depends on the App Service plan:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在屏幕的右侧，您可以增加或减少实例数量。最大实例数量取决于应用服务计划：
- en: '![](img/4374d757-d6fb-4832-af70-acf542307ee2.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4374d757-d6fb-4832-af70-acf542307ee2.jpg)'
- en: Azure App Service plan scaling
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 应用服务计划扩展
- en: 'Here, you can also turn on autoscale (only for the Standard, Premium, and Isolated
    App Service plans). You have to name the autoscale set, and add at least one scaling
    condition. You can choose between scaling based on a metric or a specific instance
    count. When using scale based on a metric, you need to add a scale rule:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里，您还可以启用自动扩展（仅适用于标准、预备和隔离的应用服务计划）。您需要命名自动扩展集，并至少添加一个扩展条件。您可以选择基于某个度量或特定实例数量进行扩展。当使用基于度量进行扩展时，您需要添加一个扩展规则：
- en: '![](img/e58415d7-badc-4416-8a59-478cf12a2c62.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e58415d7-badc-4416-8a59-478cf12a2c62.jpg)'
- en: Azure App Service plan auto scaling
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 应用服务计划自动扩展
- en: Azure Autoscale lets you configure a lot of settings that are beyond the scope
    of this book. You can refer to the following URL for more information on Azure
    Autoscale and the available settings: [https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings.](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings)
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Autoscale 允许你配置许多超出本书范围的设置。你可以参考以下网址，了解有关 Azure Autoscale 和可用设置的更多信息：[https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings.](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings)
- en: Scaling up
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扩展
- en: You can choose a different pricing tier or App Service plan to scale up your
    website. This can be done from the App Service plan settings inside the Azure
    Portal as well, such as when scaling out your Web App.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以选择不同的定价层或应用服务计划来扩展你的网站。你也可以通过 Azure 门户中的应用服务计划设置来实现这一点，例如扩展你的 Web 应用。
- en: 'Navigate to the Azure App Service settings in the Azure Portal and, under Settings,
    click on Scale Up (App Service plan). You can then select a different App Service
    plan, as shown in the following screenshot:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中导航到 Azure 应用服务设置，并在设置下点击扩展（应用服务计划）。然后你可以选择一个不同的应用服务计划，如下图所示：
- en: '![](img/bd303684-05c8-42c4-8b39-20ffcba6477b.jpg)Azure App Service plan scaling
    up'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/bd303684-05c8-42c4-8b39-20ffcba6477b.jpg)Azure 应用服务计划扩展'
- en: Designing and securing custom Web APIs
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计并保护自定义 Web API
- en: 'Custom Web APIs can be created using Visual Studio code or Visual Studio 2017\.
    For creating Web APIs, the following programming languages are available:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用 Visual Studio Code 或 Visual Studio 2017 创建自定义 Web API。创建 Web API 时，可以使用以下编程语言：
- en: ASP.NET
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ASP.NET
- en: ASP.NET Core
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ASP.NET Core
- en: Angular
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Angular
- en: React.js
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: React.js
- en: Designing your Web API
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计你的 Web API
- en: 'This demo will be created using .NET Core Framework 2.0 and Visual Studio 2017. Begin
    by opening up Visual Studio 2017:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 本示例将使用 .NET Core 2.0 框架和 Visual Studio 2017 创建。首先，打开 Visual Studio 2017：
- en: 'Click on File | New | Project and, in the new Project window, select ASP.NET
    Core Web Application. Name the project and click on OK:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击文件 | 新建 | 项目，在新建项目窗口中选择 ASP.NET Core Web 应用。命名项目并点击确定：
- en: 'A pop-up window opens up where you can select the Web API template, select
    ASP.NET Core 2.0, and click on OK:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 弹出窗口将打开，你可以选择 Web API 模板，选择 ASP.NET Core 2.0，然后点击确定：
- en: '![](img/29eb1675-e2c1-4f3a-8c99-7834b30b2d53.jpg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/29eb1675-e2c1-4f3a-8c99-7834b30b2d53.jpg)'
- en: Creating a custom Web API from Visual Studio 2017
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Visual Studio 2017 创建自定义 Web API
- en: Add a `Models` folder in the Solution Explorer. Right-click your project name
    and select Add | New Folder.Add a `TodoItem` class by right-clicking the `Models`
    folder and click Add | Class.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在解决方案资源管理器中添加一个 `Models` 文件夹。右键点击你的项目名称并选择添加 | 新建文件夹。右键点击 `Models` 文件夹，选择添加
    | 类，添加一个 `TodoItem` 类。
- en: 'Update the `TodoItem` class with the following code:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下代码更新 `TodoItem` 类：
- en: '[PRE0]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The next step is to add the database context class that coordinates entity
    framework functionality. Add a `TodoContext` class inside the `Models` folder
    and replace it with the following code:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是添加数据库上下文类，该类协调实体框架功能。将一个 `TodoContext` 类添加到 `Models` 文件夹，并用以下代码替换：
- en: '[PRE1]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The next step is to register the database context with the dependency injection
    container. You can do this by replacing the code in the `StartUp.cs` with the
    following:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是将数据库上下文与依赖注入容器进行注册。你可以通过将`StartUp.cs`中的代码替换为以下内容来实现：
- en: '[PRE2]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In the Solution Explorer, right-click the `Controllers` folder and add a controller
    named `TodoController`. Replace the controller with the following code:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在解决方案资源管理器中，右键点击 `Controllers` 文件夹并添加一个名为 `TodoController` 的控制器。用以下代码替换控制器：
- en: '[PRE3]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This code uses dependency injection in the constructor to inject the `TodoContext`
    inside the controller. This context is used for the **create**, **read**, **update**,
    **delete** (**CRUD**) methods on the data. The constructor adds an item to the
    in-memory database if it is empty.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这段代码在构造函数中使用依赖注入，将`TodoContext`注入到控制器内部。该上下文用于对数据进行**创建**、**读取**、**更新**、**删除**（**CRUD**）操作。如果内存数据库为空，构造函数会添加一项数据。
- en: 'The next step is to implement the CRUD methods. Add the following code to the
    constructor for the `Get` requests:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是实现 CRUD 方法。将以下代码添加到构造函数中，处理 `Get` 请求：
- en: '[PRE4]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Add the following underneath for `Post` requests:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `Post` 请求下方添加以下内容：
- en: '[PRE5]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Finally, add the `Delete` request underneath the `Post` requests:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，在 `Post` 请求下方添加 `Delete` 请求：
- en: '[PRE6]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You can now deploy this Web API to Azure using the Publish function in Visual
    Studio 2017\. Right-click the Solution Explorer and click on Publish.The publishing
    wizard now opens. In there, select Microsoft Azure App Service, choose Select
    Existing, and click on Publish:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您可以使用Visual Studio 2017中的 发布 功能将此Web API部署到Azure。右键点击解决方案资源管理器，并点击 发布。发布向导将会打开。在其中，选择 Microsoft
    Azure App Service，选择 选择现有，点击 发布：
- en: '![](img/8661a48c-d38b-4893-a81d-ce20bf5fa336.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8661a48c-d38b-4893-a81d-ce20bf5fa336.jpg)'
- en: Publishing the Web API to Azure from Visual Studio 2017
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 从Visual Studio 2017发布Web API到Azure
- en: 'In the next screen, select the Azure Web App that is already there from the
    previous sections in this chapter and click on the OK button:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕中，从本章前面的部分中选择已存在的Azure Web App，然后点击 OK按钮：
- en: '![](img/9064bcd9-3126-4041-b490-8fd5a63c849e.jpg)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9064bcd9-3126-4041-b490-8fd5a63c849e.jpg)'
- en: Selecting the Azure Subscription from Visual Studio 2017
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 从Visual Studio 2017选择Azure订阅
- en: The Web API is now published to Azure.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Web API现已发布到Azure。
- en: This sample application is based on a sample from the Microsoft site. When you
    need any further instructions or information about the sample app, please refer
    to the following Microsoft site: [https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api](https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api).
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 该示例应用程序基于Microsoft网站上的一个示例。当您需要关于示例应用程序的更多说明或信息时，请参考以下Microsoft网站：[https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api](https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api)。
- en: Securing your Web API
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保护您的Web API
- en: To secure your Web API, you can use several options. You can use options provided
    by Azure or you can use your own authentication providers. A best practice is,
    however, to use the standard authentication options that are available for Azure
    App Services.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保护您的Web API，您可以使用多种选项。您可以使用Azure提供的选项，也可以使用您自己的身份验证提供程序。然而，最佳实践是使用Azure App
    Services中提供的标准身份验证选项。
- en: 'You can use the following services in Azure to secure your Web API:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用Azure中的以下服务来保护您的Web API：
- en: '**Azure Active Directory (Azure AD)**: Azure AD offers traditional username
    and password identity management, roles, and permissions management from the cloud. In
    addition, it offers more enterprise solutions, such as multi-factor authentication,
    applications monitoring, solution monitoring, and alerting.'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory (Azure AD)**：Azure AD提供传统的用户名和密码身份管理、角色和权限管理等功能。除此之外，它还提供更多企业解决方案，如多因素身份验证、应用程序监控、解决方案监控和告警。'
- en: '**Azure Active Directory Business to Consumer**: Azure Active Directory Business
    to Consumer (B2C) is a cloud identity-management solution for mobile and web applications.
    It offers out-of-the-box authentication providers that can be leveraged from your
    apps and custom APIs. Examples of out-of-the-box authentication providers are Facebook,
    and Google.'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory 商业对消费者**：Azure Active Directory 商业对消费者（B2C）是一个面向移动和Web应用程序的云身份管理解决方案。它提供了现成的身份验证提供程序，您可以在您的应用程序和自定义API中使用这些提供程序。现成的身份验证提供程序示例包括Facebook和Google。'
- en: '**Active Directory Federation Services**: You can use Active Directory Federation
    Services (ADFS) to secure your web API using the on-premises identities that are
    present in your organization. ADFS can be configured in conjunction with Azure
    AD in a hybrid mode. You can then use the same APIs, such as the Microsoft Graph,
    to connect to your on-premises identities when you are using only Azure AD.'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Active Directory联合服务**：您可以使用Active Directory联合服务（ADFS）来使用您组织中的本地身份保护Web API。ADFS可以与Azure
    AD在混合模式下配置。然后，您可以使用相同的API，例如Microsoft Graph，在仅使用Azure AD时连接到您的本地身份。'
- en: '**API Management**: You can use API Management to secure your Web API as well.
    You can use advanced security policies, API keys, throttling for preventing DDOS
    attacks, and more, to add an additional layer of security on top of your Web API.'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**API管理**：您也可以使用API管理来保护您的Web API。您可以使用高级安全策略、API密钥、流量限制来防止DDoS攻击等，为您的Web API增加一层额外的安全性。'
- en: In the *Design, security, and identity* section of [Chapter 9](f44f0ed4-c642-44ef-b574-b475bdd616da.xhtml),
    *Securing Your Resources*, we will cover the available authentication providers
    in more detail. This section gives a quick overview of the providers that are
    leveraged inside your Web APIs.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第9章](f44f0ed4-c642-44ef-b574-b475bdd616da.xhtml)的*设计、安全性与身份识别*部分，*保护您的资源*，我们将更详细地介绍可用的身份验证提供程序。本节简要概述了在您的Web
    API中使用的提供程序。
- en: API Management is covered in more detail in [Chapter 4](8975f78d-84e0-4378-8318-75bc7cf35db3.xhtml),
    *Implementing Serverless and Microservices*.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: API 管理在 [第4章](8975f78d-84e0-4378-8318-75bc7cf35db3.xhtml)中有更详细的介绍，*实施无服务器和微服务*。
- en: Summary
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have covered the design web applications objectives. We've
    covered Azure Web Apps, App Service plans, how to design Web Apps for Containers,
    how to design Web Apps for high availability, scalability, and performance, and
    how you can design and secure custom Web APIs.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们已经介绍了设计 Web 应用程序的目标。我们讨论了 Azure Web 应用程序、App Service 计划、如何为容器设计 Web 应用程序、如何为高可用性、可扩展性和性能设计
    Web 应用程序，以及如何设计和保护自定义 Web API。
- en: In the next chapter, we will proceed with the serverless and microservice objectives.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将继续进行无服务器和微服务目标的学习。
- en: Questions
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assess**ments* section at the end
    of this book:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 请回答以下问题以测试你对本章内容的掌握情况。你可以在本书最后的*评估*部分找到答案：
- en: Is Redis Cache a memory key value datastore?
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Redis Cache 是一种内存键值数据存储吗？
- en: 'Yes'
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是
- en: 'No'
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否
- en: Is the Basic tier of Redis Cache well suited for production environments?
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Redis Cache 的基础层是否适合生产环境？
- en: 'Yes'
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是
- en: 'No'
  id: totrans-181
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否
- en: Can you use Azure B2B as an authentication provider for your applications?
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能将 Azure B2B 用作应用程序的身份验证提供者吗？
- en: 'Yes'
  id: totrans-183
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是
- en: 'No'
  id: totrans-184
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否
- en: Further reading
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'You can check out the following links for more information on the topics that
    are covered in this chapter:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查看以下链接，获取更多关于本章所涵盖主题的信息：
- en: '**Web Apps Documentation**: [https://docs.microsoft.com/en-us/azure/app-service/](https://docs.microsoft.com/en-us/azure/app-service/)'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Web 应用程序文档**: [https://docs.microsoft.com/en-us/azure/app-service/](https://docs.microsoft.com/en-us/azure/app-service/)'
- en: '**Azure App Service plan overview**: [https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview](https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview)'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure App Service 计划概述**: [https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview](https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview)'
- en: '**Announcing App Service Isolated, more power, scale and ease of use**: [https://azure.microsoft.com/nl-nl/blog/announcing-app-service-isolated-more-power-scale-and-ease-of-use/](https://azure.microsoft.com/nl-nl/blog/announcing-app-service-isolated-more-power-scale-and-ease-of-use/)'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**宣布 App Service Isolated，更多的能力、扩展性和易用性**: [https://azure.microsoft.com/nl-nl/blog/announcing-app-service-isolated-more-power-scale-and-ease-of-use/](https://azure.microsoft.com/nl-nl/blog/announcing-app-service-isolated-more-power-scale-and-ease-of-use/)'
- en: '**App Service on Linux Documentation**: [https://docs.microsoft.com/en-us/azure/app-service/containers/](https://docs.microsoft.com/en-us/azure/app-service/containers/)'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Linux 上的 App Service 文档**: [https://docs.microsoft.com/en-us/azure/app-service/containers/](https://docs.microsoft.com/en-us/azure/app-service/containers/)'
- en: '**CDN Documentation**: [https://docs.microsoft.com/en-us/azure/cdn/](https://docs.microsoft.com/en-us/azure/cdn/)'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CDN 文档**: [https://docs.microsoft.com/en-us/azure/cdn/](https://docs.microsoft.com/en-us/azure/cdn/)'
- en: '**Redis Cache Documentation**: [https://docs.microsoft.com/en-us/azure/redis-cache/](https://docs.microsoft.com/en-us/azure/redis-cache/)'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Redis Cache 文档**: [https://docs.microsoft.com/en-us/azure/redis-cache/](https://docs.microsoft.com/en-us/azure/redis-cache/)'
- en: '**Integrating applications with Azure Active Directory**: [https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-integrating-applications](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-integrating-applications)'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**将应用程序与 Azure Active Directory 集成**: [https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-integrating-applications](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-integrating-applications)'
- en: '**Active Directory B2C Documentation**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/](https://docs.microsoft.com/en-us/azure/active-directory-b2c/)'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Active Directory B2C 文档**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/](https://docs.microsoft.com/en-us/azure/active-directory-b2c/)'
