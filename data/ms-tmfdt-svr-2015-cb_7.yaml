- en: Chapter 7. Managing Team Foundation Server
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章：管理 Team Foundation Server
- en: '|   | *"It''s hardware that makes a machine fast… It''s software that makes
    a fast machine slow."* |   |'
  id: totrans-1
  prefs: []
  type: TYPE_TB
  zh: '|   | *“是硬件让机器变快……是软件让快机器变慢。”* |   |'
- en: '|   | --*Craig Bruce* |'
  id: totrans-2
  prefs: []
  type: TYPE_TB
  zh: '|   | --*Craig Bruce* |'
- en: 'In this chapter, we will cover the following:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下内容：
- en: Diagnosing builds in TFS
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 诊断 TFS 中的构建
- en: Analyzing the TFS database and configuring test retention policies
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析 TFS 数据库并配置测试保留策略
- en: Using Activity and Job Monitoring logs to diagnose TFS issues
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用活动和作业监视日志诊断 TFS 问题
- en: Changing update frequency and forcing a rebuild of the TFS Warehouse
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改更新频率并强制重新构建 TFS 仓库
- en: Configuring TFS Cache settings
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 TFS 缓存设置
- en: Managing CodeLens in TFS
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理 TFS 中的 CodeLens
- en: Continuous synchronization with TFS Proxy server
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与 TFS 代理服务器的持续同步
- en: Creating a TFS database back up schedule
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建 TFS 数据库备份计划
- en: Cleaning up dead workspaces and shelvesets in TFS
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 清理 TFS 中的死工作区和暂存集
- en: Introduction
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: We are entering the era of self-driven cars; you may ask, "why can't products
    just maintain themselves?" The Product Teams deliver high-quality software yet
    the real-world usage of a feature can significantly differ from its anticipated
    usage. The building blocks the product operates on and the ecosystem of frameworks
    that rely on the product keep evolving too. TFS does not have a very high administration
    over head. The administration needs are somewhat proportional to the level of
    usage. Smaller Teams may be able to administer TFS within the day-to-day activities
    of individuals on the Team, while larger Teams may need a dedicated TFS administrator.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们正进入自动驾驶汽车的时代；你可能会问：“为什么产品不能自行维护？”产品团队交付高质量的软件，但功能的实际使用与预期使用可能有很大差异。产品所依赖的基础构建块以及依赖于产品的框架生态系统也在不断发展。TFS
    的管理负担并不高。管理需求与使用程度成正比。较小的团队可能能够在团队成员的日常活动中管理 TFS，而较大的团队则可能需要一名专职的 TFS 管理员。
- en: 'The key tasks that need to be performed by a TFS administrator can broadly
    be divided into three categories: **Update**, **Maintain**, and **Optimize**:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: TFS 管理员需要执行的关键任务可以大致分为三类：**更新**、**维护**和**优化**：
- en: '![Introduction](img/image00804.jpeg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![介绍](img/image00804.jpeg)'
- en: 'Let''s explain each of these tasks in detail:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细解释这些任务：
- en: '**Update**: It is very important to keep the environment secure, and for this
    reason, all security updates that the MBSA tool identifies as "Critical" should
    be applied within 48 hours. The product updates are roughly rolled out every quarter.
    Each product update contains bug fixes, performance enhancements, and new features.
    Quarterly updates rarely have breaking changes; this also reduces the effort in
    testing the upgrade. The product updates should also be applied as soon as possible.
    It is also recommended to keep the underlying OS and SQL Server updated to the
    latest available service packs.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**更新**：保持环境的安全性非常重要，因此，MBSA 工具标识为“关键”的所有安全更新应在48小时内应用。产品更新大约每季度发布一次。每个产品更新包含
    bug 修复、性能增强和新功能。季度更新很少有重大变化，这也减少了测试升级的工作量。产品更新也应尽快应用。还建议将底层操作系统和 SQL Server 更新到最新的可用服务包。'
- en: '**Maintain**: There needs to be a clear strategy for disaster recovery and
    backup restore. The TFS database usage should be closely monitored to find any
    unexpected growth patterns. It is recommended that the TFS Perfmon counters be
    used to benchmark the performance of the server and reevaluated overtime regularly,
    especially during upgrades. More information on TFS Perfmon counters is available
    at [http://bit.ly/1SijysU](http://bit.ly/1SijysU). Maintaining TFS also involves
    day-to-day cleanup activities such as managing permissions, build drop locations,
    test attachments, workspaces, shelvesets, and so on.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '**维护**：需要有一个清晰的灾难恢复和备份恢复策略。应密切监控 TFS 数据库的使用情况，以发现任何意外的增长模式。建议使用 TFS Perfmon
    计数器来基准测试服务器性能，并定期重新评估，特别是在升级时。有关 TFS Perfmon 计数器的更多信息，请访问 [http://bit.ly/1SijysU](http://bit.ly/1SijysU)。维护
    TFS 还包括日常清理活动，如管理权限、构建投放位置、测试附件、工作区、暂存集等。'
- en: '**Optimize**: By monitoring the TFS usage using the Activity logs, you can
    identity requirements for scalability. Load balancing the TFS application tier
    is usually the first step to provide resilience and scale to the TFS setup. If
    Teams are working in a low bandwidth location, installing a TFS proxy server can
    significantly improve the experience. By closely monitoring the build and release
    agent utilization, you can supplement the build queues with additional agents.
    This can help bring down the queue times for builds and releases.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**优化**：通过使用活动日志监控TFS的使用情况，你可以识别扩展性的需求。负载均衡TFS应用层通常是提供弹性和扩展TFS设置的第一步。如果团队在低带宽环境中工作，安装TFS代理服务器可以显著改善体验。通过密切监控构建和发布代理的使用情况，你可以通过增加额外的代理来补充构建队列。这有助于减少构建和发布的排队时间。'
- en: If your organization has systems center setup, there is now a management pack
    available for Visual Studio Team Foundation Server 2015 that can be downloaded
    from [http://bit.ly/1lgcEJN](http://bit.ly/1lgcEJN). If you have recently upgraded
    from TFS 2013 or any of the earlier versions, then it's worth reading up about
    enabling TFS 2015-specific features on existing Team Projects ([http://bit.ly/1P6IbLu](http://bit.ly/1P6IbLu)).
    There is a wealth of documentation available on MSDN ([http://bit.ly/1R4Uh79](http://bit.ly/1R4Uh79))
    covering key administration concepts with samples and walkthroughs. In addition
    to that, this article ([http://bit.ly/1QGxVcQ](http://bit.ly/1QGxVcQ)) talks at
    length about all things TFS administrators should focus on. TFS administration
    and management is a fairly big topic. In this chapter, we'll focus on some of
    the key administration and management activities that every TFS administrator
    should perform.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的组织已设置了系统中心，现在可以下载Visual Studio Team Foundation Server 2015的管理包，下载地址为[http://bit.ly/1lgcEJN](http://bit.ly/1lgcEJN)。如果你最近从TFS
    2013或任何较早版本升级，建议阅读有关在现有团队项目中启用TFS 2015特性的信息([http://bit.ly/1P6IbLu](http://bit.ly/1P6IbLu))。MSDN提供了大量文档([http://bit.ly/1R4Uh79](http://bit.ly/1R4Uh79))，涵盖了关键的管理概念，并附有示例和操作指南。此外，本文([http://bit.ly/1QGxVcQ](http://bit.ly/1QGxVcQ))详细讨论了所有TFS管理员应关注的内容。TFS管理和运维是一个相当庞大的话题。在本章中，我们将重点介绍每个TFS管理员应执行的一些关键管理活动。
- en: Diagnosing builds in TFS
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在TFS中诊断构建问题
- en: Development Teams use TFBuild for validating code changes and inspecting code
    quality and running tests. Builds are a critical part of any software development
    life cycle. As a TFS administrator, you may need to inspect issues with a build
    agent or diagnose a specific build definition. In this recipe, we'll learn how
    to diagnose build agents and build definitions.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 开发团队使用TFBuild来验证代码变更、检查代码质量和运行测试。构建是任何软件开发生命周期中至关重要的一部分。作为TFS管理员，你可能需要检查构建代理的问题或诊断特定的构建定义。在本篇教程中，我们将学习如何诊断构建代理和构建定义。
- en: Getting ready
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Download TFBuild Agent from the TFS Administration Console. For more information
    on how to download the TFBuild Agent, refer to the *Configuring TFBuild Agent,
    Pool*, *and Queues* recipe in [Chapter 4](part0050.xhtml#aid-1FLS42 "Chapter 4. Building
    Your Application"), *Building Your Application*. You need to have collection administration
    permissions to configure a TFBuild Agent. To create or edit a build definition,
    you need to be a member of the Build Administrators Group.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 从TFS管理控制台下载TFBuild Agent。有关如何下载TFBuild Agent的更多信息，请参考[第4章](part0050.xhtml#aid-1FLS42
    "第4章。构建您的应用")中的*配置TFBuild Agent、池*和*队列*教程，*构建您的应用*。你需要拥有集合管理权限才能配置TFBuild Agent。要创建或编辑构建定义，你需要是构建管理员组的成员。
- en: How to do it…
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: The best place to start when diagnosing agent issues is to look at the agent
    trace logs. The agent trace logs are stored in the `_diag` folder in the agent
    working directory.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在诊断代理问题时，最好的起点是查看代理追踪日志。代理追踪日志存储在代理工作目录中的`_diag`文件夹内。
- en: If there is nothing obvious in the agent trace logs, as a next step you should
    run an HTTP Trace against the agent. This can be done using an HTTP Proxy tool.
    If you are on Windows, you can use Fiddler; for other platforms, you can use Charles
    Proxy. Refer to [http://bit.ly/1P6dqGt](http://bit.ly/1P6dqGt) on how to set up
    and capture an HTTP Trace.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果在代理追踪日志中没有明显的异常，作为下一步，你应该对代理运行HTTP追踪。这可以通过使用HTTP代理工具来完成。如果你使用Windows系统，可以使用Fiddler；其他平台可以使用Charles
    Proxy。关于如何设置和捕获HTTP追踪，请参考[http://bit.ly/1P6dqGt](http://bit.ly/1P6dqGt)。
- en: When capturing an HTTP Trace, the agent needs to be run in interactive mode.
    Browse to the location where the TFBuild Agent has been downloaded. Unzip the
    TFBuild Agent. Open a command prompt in administrator mode and set the working
    directory to the unzipped location of the TFBuild Agent. As illustrated here,
    run the `ConfigureAgent` command:![How to do it…](img/image00805.jpeg)
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在捕获 HTTP 跟踪时，代理需要以交互模式运行。浏览到已下载 TFBuild Agent 的位置。解压 TFBuild Agent。在管理员模式下打开命令提示符，并将工作目录设置为解压后的
    TFBuild Agent 位置。如图所示，运行 `ConfigureAgent` 命令：![如何操作…](img/image00805.jpeg)
- en: 'The `ConfigureAgent` command will prompt to configure the agent for a few details.
    When prompted for `Would you like to install the agent as a Windows Service` key
    in *N*, this will run the agent as an interactive process rather than installing
    the agent as a service:'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`ConfigureAgent` 命令将提示配置代理的一些细节。当系统提示是否要将代理安装为 Windows 服务时，输入 *N*，这将使代理以交互过程运行，而不是将其安装为服务：'
- en: '![How to do it…](img/image00806.jpeg)'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作…](img/image00806.jpeg)'
- en: All agent activity will show up in verbose in the command prompt. This will
    likely provide clues to diagnose problems with the agent.
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 所有代理活动将在命令提示符中以详细模式显示。这可能提供诊断代理问题的线索。
- en: When troubleshooting problems with the build definition, its best to run the
    build definition in verbose mode. In verbose mode, the agent produces very detailed
    logs; investigating the logs is usually the best way to identify problems causing
    the unexpected behavior. To run the build definition in verbose mode, create a
    new variable `System.Debug` and set the value of this variable to `true`:![How
    to do it…](img/image00807.jpeg)
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在排查构建定义问题时，最好以详细模式运行构建定义。在详细模式下，代理会生成非常详细的日志；调查日志通常是识别导致意外行为问题的最佳方法。要以详细模式运行构建定义，请创建一个新的变量
    `System.Debug`，并将该变量的值设置为 `true`：![如何操作…](img/image00807.jpeg)
- en: How it works…
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: An HTTP Trace can contain credentials, so avoid sharing HTTP Traces publically.
    TFS currently does not support personal access tokens, so as a work-around, you
    can create a temporary account for the purposes of capturing the trace; alternatively,
    sanitize the trace logs before sharing with other Teams for investigation.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP 跟踪可能包含凭据，因此请避免公开分享 HTTP 跟踪。目前，TFS 不支持个人访问令牌，因此作为替代方法，您可以创建一个临时帐户用于捕获跟踪；或者在与其他团队共享日志以供调查之前，先清理跟踪日志。
- en: Analyzing the TFS database and configuring test retention policies
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分析 TFS 数据库并配置测试保留策略
- en: As the TFS usage increases over time, the TFS instances can build up very large
    volumes of data files, builds, releases, Work Items, and so on. For the most part,
    this is a very good thing – a big part of the value of many **Application Lifecycle
    Management** (**ALM**) features, after all, is maintaining a reliable history
    of the various artifacts involved in a producing software. At some point, however,
    there are implicit and explicit costs involved in maintaining older data, such
    as performance impacts and increased time spent on upgrades, in addition to the
    increased disk space requirements. In this recipe, you'll learn how to analyze
    the TFS database size and set up test retention policies for a Team Project.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 随着 TFS 使用量的增加，TFS 实例可能会积累大量的数据文件、构建、发布、工作项等。在大多数情况下，这是非常好的——毕竟，许多 **应用生命周期管理**
    (**ALM**) 特性的重要价值之一就是维护与生产软件相关的各种工件的可靠历史记录。然而，随着时间的推移，维护旧数据会带来隐性和显性成本，比如性能影响、增加的升级时间以及更高的磁盘空间需求。在本食谱中，您将学习如何分析
    TFS 数据库的大小并为团队项目设置测试保留策略。
- en: Getting ready
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: 'It is not recommended to query the live instance of TFS transactional database
    directly. Restore a backup of the TFS transactional database on an alternate instance
    of SQL and execute the queries in this recipe on that instance instead of the
    live instance.     To administer the test retention policies for a Team Project, you need to be a
    member of the Team Project Administrator Group.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '不建议直接查询 TFS 事务性数据库的实时实例。请在 SQL 的另一个实例上还原 TFS 事务性数据库的备份，并在该实例上执行本食谱中的查询，而不是在实时实例上执行。     要管理团队项目的测试保留策略，您需要是团队项目管理员组的成员。'
- en: How to do it...
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Let''s first analyze the TFS databases to understand the storage distribution:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先分析 TFS 数据库，了解存储分布：
- en: 'Open SQL Server Management Studio. Connect to the SQL instance the TFS transactional
    database has been restored to, open a new query window and run the following T-SQL
    code to get the database size for TFS databases:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开SQL Server Management Studio，连接到TFS事务数据库所在的SQL实例，打开一个新查询窗口并运行以下T-SQL代码来获取TFS数据库的数据库大小：
- en: '[PRE0]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You will get the following output after executing the preceding code:'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行上述代码后，你将获得以下输出：
- en: '![How to do it...](img/image00808.jpeg)'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![操作步骤...](img/image00808.jpeg)'
- en: 'Scope the connected database in the SQL Server Management Studio to the `TFS_DefaultCollection`
    column. Execute the following T-SQL to identify the distribution of storage within
    this collection:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在SQL Server Management Studio中，将连接的数据库范围限定为`TFS_DefaultCollection`列。执行以下T-SQL代码以识别此集合中存储的分布：
- en: '[PRE1]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The storage is categorized into the areas of ownership. This should help identity
    the hot spots at a high level.
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 存储被分类为各个所有权区域。这应该有助于在高层次上识别热点区域。
- en: 'The following query will show you the next level of details on the individual
    areas of ownership:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下查询将展示关于各个所有权区域的更多详细信息：
- en: '[PRE2]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: From the analysis so far, we narrowed down that `TeamTest` is the biggest occupier
    in the database. The breakdown shows that this is because of the large volume
    of test runs, results, and attachments from manual and automated tests. To configure
    test retention policies for the FabrikamTFVC project, navigate to the FabrikamTFVC
    Administration Console in Team Web Portal and browse to the **Test** tab. As illustrated
    in the following screenshot, set the manual and automated test retention policies:![How
    to do it...](img/image00809.jpeg)
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从目前的分析来看，我们已经缩小了范围，`TeamTest`是数据库中占用最多资源的部分。细节显示，这主要是由于手动和自动测试产生的大量测试运行、结果和附件。要为FabrikamTFVC项目配置测试保留策略，请导航到Team
    Web Portal中的FabrikamTFVC管理控制台并切换到**测试**选项卡。如以下截图所示，设置手动和自动测试的保留策略：![操作步骤...](img/image00809.jpeg)
- en: How it works…
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: Test retention policies is a new addition to TFS 2015\. Test retention policies
    allow you to individually manage the retention policies for automated and manual
    tests. The default configuration is set to retain indefinitely. In this recipe,
    we've configured the automated test execution runs, results, and attachments to
    be deleted in 30 days and the manual test execution runs, results, and attachments
    to be deleted in 365 days. The retention policies are automatically processed
    by a job in TFS.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 测试保留策略是TFS 2015中的新功能。测试保留策略允许你分别管理自动化和手动测试的保留策略。默认配置是保留无限期。根据本示例，我们已将自动化测试执行、结果和附件的保留期限设置为30天，而手动测试执行、结果和附件的保留期限设置为365天。这些保留策略会通过TFS中的作业自动处理。
- en: Tip
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Warning**'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**警告**'
- en: Removing any files should be done with caution and *never directly from the
    database*. As always, before you modify, update, or delete, take a full backup
    of the databases.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 删除任何文件时应谨慎操作，并*绝不直接从数据库中删除*。和往常一样，在修改、更新或删除之前，务必对数据库进行完整备份。
- en: There is no provision to configure the test retention policies centrally. For
    this reason, the test reason policies need to be configured for each Team Project
    individually.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 没有办法在中心位置配置测试保留策略。因此，测试保留策略需要为每个团队项目单独配置。
- en: The test retention policies are just one of the ways to control the size of
    your TFS database. TFS also supports build retention policies; this has been discussed
    at length in the *Using the build retention policy to automate build deletion*
    recipe in [Chapter 4](part0050.xhtml#aid-1FLS42 "Chapter 4. Building Your Application"),
    *Building Your Application*. In addition to this, you can free up more space by
    destroying deleted version control branches, Team Projects, files, and XAML builds.
    Refer to [http://bit.ly/1PMhuvB](http://bit.ly/1PMhuvB) to know how this can be
    accomplished.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 测试保留策略只是控制TFS数据库大小的方式之一。TFS还支持构建保留策略；这一点在[第4章](part0050.xhtml#aid-1FLS42 "第4章.
    构建您的应用程序")的*使用构建保留策略自动删除构建*一节中有详细讨论。此外，您还可以通过销毁已删除的版本控制分支、团队项目、文件和XAML构建来释放更多空间。请参考[http://bit.ly/1PMhuvB](http://bit.ly/1PMhuvB)了解如何实现这一点。
- en: Using Activity and Job Monitoring logs to diagnose TFS issues
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用活动和作业监视日志来诊断TFS问题
- en: TFS logs both the activity and the job execution data in the backend database.
    TFS has a built-in job agent that runs on the application tier and logs diagnostic
    information about jobs and processes. Having visibility of poor performing and
    failed jobs, along with diagnostic information, helps narrow down potential problems
    faster. The diagnostics page in TFS comprises of Activity logs and Job Monitoring
    logs. In this recipe, you'll learn how to use the diagnostics page in TFS.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: TFS将活动和作业执行数据同时记录在后端数据库中。TFS具有内置作业代理，在应用程序层上运行并记录有关作业和进程的诊断信息。通过查看性能不佳和失败作业，以及诊断信息，可以更快地缩小潜在问题的范围。TFS的诊断页面包括活动日志和作业监控日志。在本示例中，您将学习如何使用TFS的诊断页面。
- en: Getting ready
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'To use the diagnostics page, you need to be a member of the TFS Administrators
    Group. Validate access by browsing `http://tfs2015:8080/tfs/_oi/`:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用诊断页面，您需要成为TFS管理员组的成员。通过浏览 `http://tfs2015:8080/tfs/_oi/` 来验证访问权限：
- en: '![Getting ready](img/image00810.jpeg)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![准备就绪](img/image00810.jpeg)'
- en: How to do it...
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到……
- en: To access Activity log navigate to `http://tfs2015:8080/tfs/_oi/_diagnostics/activityLog`.
    The page can take a little longer to load if you are accessing it for the first
    time.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要访问活动日志，请导航至 `http://tfs2015:8080/tfs/_oi/_diagnostics/activityLog`。如果您首次访问该页面，加载可能需要一些时间。
- en: This page basically presents the data in the `tbl_Command` table. As illustrated
    in the following screenshot among other things, the page contains a list of commands,
    applications, status, start time, time taken for execution, execution status,
    identity, IP address, unique identifier, user agent, command identifier, execution
    count, authentication, and response code:![How to do it...](img/image00811.jpeg)
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该页面基本上展示了`tbl_Command`表中的数据。正如下图所示，页面包含命令、应用程序、状态、开始时间、执行时间、执行状态、身份、IP地址、唯一标识符、用户代理、命令标识符、执行计数、认证和响应代码等列表项：![如何做到……](img/image00811.jpeg)
- en: Double-click on an item in the list to see more details. As illustrated in the
    following image, the details for the reconcile workspace command shows you the
    rich next level of details of the operation:![How to do it...](img/image00812.jpeg)
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击列表中的项目以查看更多详细信息。如下图所示，对于协调工作空间命令的详细信息显示了操作的详细下一层级：![如何做到……](img/image00812.jpeg)
- en: The **Activity Log** page also allows filter and export operations. Since the
    data in the `tbl_command` table is only retained for 14 days, you can export the
    data in the Activity log incrementally to a separate repository to keep this valuable
    information for historic trend analysis.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**活动日志**页面还允许进行筛选和导出操作。由于`tbl_command`表中的数据仅保留14天，您可以将活动日志中的数据逐步导出到单独的存储库中，以保留这些有价值的信息用于历史趋势分析。'
- en: 'Click on the **Job Monitoring** tab to navigate to the **Job Monitoring** view.
    Alternatively, you can directly browse `http://tfs2015:8080/tfs/_oi/_jobMonitoring`.
    The **Job Monitoring** view has three more submenus: **Job Summary**, **Job Queue**,
    and **Job History**:![How to do it...](img/image00813.jpeg)'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**作业监控**选项卡以导航到**作业监控**视图。或者，您可以直接浏览 `http://tfs2015:8080/tfs/_oi/_jobMonitoring`。**作业监控**视图还包括三个子菜单：**作业摘要**、**作业队列**和**作业历史**：![如何做到……](img/image00813.jpeg)
- en: Let's first look at the **Job Summary** view. The summary view shows a graphical
    representation of the total runtime for each job. Being able to visualize job
    execution time relative to other jobs helps identify potential problems. As you
    can see in the following screenshot, the TFS Periodic Identity Synchronization
    and Incremental Analysis Database sync job takes longer to process as compared
    to optimize databases job:![How to do it...](img/image00814.jpeg)
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，让我们看看**作业摘要**视图。摘要视图显示了每个作业的总运行时间的图形表示。能够将作业执行时间与其他作业相对比有助于识别潜在问题。正如您在以下截图中所看到的，TFS周期性身份同步和增量分析数据库同步作业处理时间较长，相比之下，优化数据库作业的处理时间较短：![如何做到……](img/image00814.jpeg)
- en: To get more details on Incremental Analysis Database sync job, click on the
    blue bar next to the job name. This will navigate you to the **Job History** tab.
    The **Job History** tab has two graphs, one showing the job execution time for
    all jobs and the other showing the details for Incremental Analysis Database sync
    job. Seeing the two charts together helps you compare the contribution one has
    on the other. The following figure illustrates the graph for the execution of
    Incremental Analysis Database sync job. Looking at the chart, you can work out
    that the job on the 07/25 is out of pattern and has taken significantly longer
    than usual. However, the queue time metric on the chart shows that the delay is
    contributed by the prolonged average queue time:![How to do it...](img/image00815.jpeg)
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要获取有关增量分析数据库同步作业的更多信息，请点击作业名称旁边的蓝色条形图。这将导航到 **作业历史**标签。**作业历史**标签有两个图表，一个显示所有作业的执行时间，另一个显示增量分析数据库同步作业的详细信息。查看这两个图表可以帮助你比较它们之间的影响。下图展示了增量分析数据库同步作业的执行图。通过查看图表，你可以发现
    07/25 号的作业明显超出了正常模式，花费的时间比平时要长得多。然而，图表中的队列时间指标显示，延迟是由于平均队列时间延长所导致的：![如何操作...](img/image00815.jpeg)
- en: Navigate back to the **Job Summary** view; this view also has a pie chart that
    shows the split between **Succeeded**, **Blocked**, and **Disabled** jobs. Clicking
    on any will navigate you to the **Job History** view and provide job-level details
    on each type:![How to do it...](img/image00816.jpeg)
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到 **作业摘要**视图；该视图还有一个饼图，显示了 **成功**、**阻塞** 和 **禁用** 作业的分布。点击任何一项将导航到 **作业历史**视图，并提供每种类型作业的详细信息：![如何操作...](img/image00816.jpeg)
- en: Last but not least, the **Job Summary** page has a chart for number of job runs.
    The chart displays the number of times a job has run combined with the result
    types for that particular job. Click on any of the bars in the chart to display
    details on those jobs. Hovering over the chart provides further information:![How
    to do it...](img/image00817.jpeg)
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后但同样重要的是，**作业摘要**页面有一个作业运行次数的图表。该图表显示了某个特定作业的运行次数以及该作业的结果类型。点击图表中的任意条形图，查看该作业的详细信息。将鼠标悬停在图表上可以获取更多信息：![如何操作...](img/image00817.jpeg)
- en: Next, navigate to the **Job Queue** tab. The chart in this tab describes the
    job queue; it provides the counts for each queue type. Click on the bar to see
    the job details associated to each queue type:![How to do it...](img/image00818.jpeg)
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，导航到 **作业队列**标签。此标签中的图表描述了作业队列；它提供了每种队列类型的计数。点击条形图可以查看与每个队列类型相关的作业详情：![如何操作...](img/image00818.jpeg)
- en: How it works...
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: It is recommended that you do not directly query the TFS Transactional database.
    Any changes made to the database can significantly impact the functioning of TFS.
    While some changes may not show the impact immediately, the changes can cause
    disruption during upgrades. Prior to the introduction of the diagnostics page,
    there was no alternate but to query the database directly to retrieve and analyze
    the data from the `command` and `actions` table. The diagnostics page makes it
    easier to access this valuable dataset.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 建议不要直接查询 TFS 事务数据库。对数据库的任何更改都可能对 TFS 的功能产生重大影响。尽管某些更改可能不会立即显示影响，但这些更改可能会在升级时造成干扰。在诊断页面引入之前，唯一的办法就是直接查询数据库，获取并分析
    `command` 和 `actions` 表中的数据。诊断页面使得访问这个宝贵的数据集变得更加容易。
- en: All built-in TFS jobs track their activity in the `command` table. The logging
    is internally handled by the framework in TFS. There is a very interesting article
    that talks about the built-in jobs and the execution interval; you can read more
    about this at [http://bit.ly/1kPSbfg](http://bit.ly/1kPSbfg).
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 所有内置的 TFS 作业都会在 `command` 表中跟踪其活动。日志记录由 TFS 框架内部处理。有一篇非常有趣的文章讲述了内置作业及其执行间隔；你可以在[http://bit.ly/1kPSbfg](http://bit.ly/1kPSbfg)上了解更多内容。
- en: Changing update frequency and forcing a rebuild of TFS Warehouse
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更改更新频率并强制重建 TFS 仓库
- en: The reporting warehouse in TFS is a traditional data warehouse that consists
    of a relational database and an analysis services database. The data warehouse
    aggregates all the operational data, such as version control, Work Item tracking,
    build, and test. The warehouse corresponds to the `Tfs_Warehouse` relational database.
    The cube corresponds to the SQL Server Analysis Services database `Tfs_Analysis`.
    The default rebuild frequency for the TFS Warehouse is 2 hours. In this recipe,
    you'll learn how to manually change the TFS Warehouse refresh frequency from 2
    hours to 1 hour. You'll also learn how to force a rebuild of the TFS Warehouse
    cube.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: TFS中的报告仓库是一个传统的数据仓库，由关系数据库和分析服务数据库组成。数据仓库聚合了所有操作数据，如版本控制、工作项跟踪、构建和测试。该仓库对应于`Tfs_Warehouse`关系数据库，数据立方体对应于SQL
    Server分析服务数据库`Tfs_Analysis`。TFS仓库的默认重建频率为2小时。在本教程中，您将学习如何将TFS仓库的刷新频率从2小时手动更改为1小时。您还将学习如何强制重建TFS仓库的立方体。
- en: Note
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: TFS Warehouse refresh is default to 2 hours; if you reduce the interval to less
    than the default of 2 hours, processing of the data warehouse will consume server
    resources frequently. If your TFS Server has large volumes of data, reducing the
    refresh frequency may adversely affect the performance of the server.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: TFS仓库的刷新频率默认是2小时；如果您将间隔缩短到低于默认的2小时，数据仓库的处理将频繁消耗服务器资源。如果您的TFS服务器有大量数据，减少刷新频率可能会对服务器性能产生不利影响。
- en: Getting ready
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'To work through this recipe, you''ll need to ensure the following:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 若要完成此教程，您需要确保以下事项：
- en: The TFS deployment you are working with a TFS Warehouse configured. You can
    validate this by checking the **Reporting** tab of TFS Administration Console:![Getting
    ready](img/image00819.jpeg)
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您正在使用的TFS部署配置了TFS仓库。您可以通过检查TFS管理控制台中的**Reporting**标签来验证：![准备就绪](img/image00819.jpeg)
- en: You must be a member of the Team Foundation Administrators security group or
    you must have the server-level administer warehouse permission set to **Allow**.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您必须是Team Foundation Administrators安全组的成员，或必须将服务器级别的仓库管理权限设置为**允许**。
- en: The Microsoft Team Foundation Server Application Pool must be running for the
    Warehouse Control Web Service:![Getting ready](img/image00820.jpeg)
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必须启动Microsoft Team Foundation Server应用池，以便使用仓库控制Web服务：![准备就绪](img/image00820.jpeg)
- en: How to do it…
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: Log into Team Foundation Server Application Tier and validate that the Warehouse
    Control Service is available by browsing `http://localhost:8080/tfs/TeamFoundation/Administration/v3.0/WarehouseControlService.asmx`.
    Revisit the *Getting ready* section if you don't see the Warehouse Control Web
    Service as illustrated in the following screenshot:![How to do it…](img/image00821.jpeg)
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录Team Foundation Server应用层，并通过浏览`http://localhost:8080/tfs/TeamFoundation/Administration/v3.0/WarehouseControlService.asmx`验证仓库控制服务是否可用。如果未看到如以下截图所示的仓库控制Web服务，请重新访问*准备就绪*部分：![如何操作…](img/image00821.jpeg)
- en: In the `WarehouseControlWebService` page, look for the `changesetting` web method.
    Click on this to navigate to the definition of this function. This method has
    two input parameters, namely, `settingId` and `newValue`. In the `settingId` textbox,
    type `RunIntervalSeconds`. This property holds the warehouse rebuild frequency.
    In the `newValue` textbox type `3600`, `3600` here represents 3600 seconds (1
    hour), that is, the new value for the property `RunIntervalSeconds`:![How to do
    it…](img/image00822.jpeg)
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`WarehouseControlWebService`页面中，寻找`changesetting`网络方法。点击此方法以跳转到该函数的定义。这方法有两个输入参数，分别是`settingId`和`newValue`。在`settingId`文本框中输入`RunIntervalSeconds`。此属性表示仓库重建的频率。在`newValue`文本框中输入`3600`，其中`3600`代表3600秒（1小时），即属性`RunIntervalSeconds`的新值：![如何操作…](img/image00822.jpeg)
- en: Click on **Invoke**. This will redirect you to the response page. The response
    page will list the result of the action. In this case, the message confirms that
    the run interval value has been successfully updated to 3600 seconds:![How to
    do it…](img/image00823.jpeg)
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Invoke**。这将把您重定向到响应页面。响应页面将列出该操作的结果。在这种情况下，消息确认运行间隔值已成功更新为3600秒：![如何操作…](img/image00823.jpeg)
- en: In this step, we'll see how to force the rebuild of the warehouse. Navigate
    back to the Warehouse Control Web Service and select the **ProcessWarehouse**
    web method. This method has two input parameters, namely, **collectionName** and
    **jobName**. In the **collectionName** textbox, enter **defaultcollection**. This
    is the TFS collection you want to force the rebuild for. Don't pass any values
    in the **jobName** textbox:![How to do it…](img/image00824.jpeg)
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这一步，我们将演示如何强制重建仓库。返回到仓库控制 Web 服务并选择 **ProcessWarehouse** Web 方法。该方法有两个输入参数，分别是
    **collectionName** 和 **jobName**。在 **collectionName** 文本框中输入 **defaultcollection**，这是你想要强制重建的
    TFS 集合。不要在 **jobName** 文本框中输入任何值：![如何操作...](img/image00824.jpeg)
- en: Tip
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You can optionally leave the **collectionName** textbox empty. This will force
    the rebuild of all Team Project Collections.
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以选择将 **collectionName** 文本框留空。这将强制重建所有团队项目集合。
- en: Clicking on **Invoke** will redirect you to the response page. The response
    page will list the result of the action. The service returns `True` when it successfully
    starts the processing of the warehouse and `False` if it is not successful. A
    value of `False` indicates that the warehouse is currently being processed:![How
    to do it…](img/image00825.jpeg)
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Invoke** 会将你重定向到响应页面。响应页面将列出操作的结果。服务返回 `True` 时，表示它成功启动了仓库的处理，`False` 则表示处理失败。`False`
    的值意味着仓库当前正在处理：![如何操作...](img/image00825.jpeg)
- en: How it works…
  id: totrans-95
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: Forcing a TFS Warehouse rebuild isn't something you need to do on a regular
    basis. However, a TFS Warehouse and cube rebuild is required if you move, restore,
    rename, and fail over the data tier of TFS. The warehouse rebuild is required
    to see refreshed reports if you move, attach, detach, or delete a Team Project
    Collection.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 强制重建 TFS 仓库并不是你需要定期做的事情。然而，如果你移动、恢复、重命名或故障转移 TFS 的数据层，则需要进行 TFS 仓库和数据立方体的重建。如果你移动、附加、分离或删除了团队项目集合，则需要重建仓库以查看更新后的报告。
- en: There is more
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多
- en: The `RebuildWarehouse` command is available via command-line utility as well.
    More details on how to use the `RebuildWarehouse` command can be found at [http://bit.ly/1HjaQdp](http://bit.ly/1HjaQdp).
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '`RebuildWarehouse` 命令也可以通过命令行工具使用。有关如何使用 `RebuildWarehouse` 命令的更多细节，可以参考 [http://bit.ly/1HjaQdp](http://bit.ly/1HjaQdp)。'
- en: Configuring TFS Cache settings
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 TFS 缓存设置
- en: The TFS application tier maintains a file cache in order to speed up the file
    download process to the end user by serving the files from the cache, rather than
    getting them afresh from the database each time. The cache grows over time and
    can start to dent the available storage space on the application tier. The cache
    uses a good percentage of the available space; in case your main drive does not
    have a lot of available space, you will ignorantly not benefit from the caching
    facility. Moving the TFS Cache to a separate directory enables you to free up
    the storage on the main drive and plan a more relaxed backup or recovery procedure
    for the new drive. It is possible that you may see some performance gains by changing
    the cache directory to its own directory. In this recipe, you'll learn how to
    change the TFS Cache directory to a different directory.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: TFS 应用程序层维护一个文件缓存，以通过从缓存中提供文件，而不是每次从数据库中重新获取文件，来加速文件下载过程。缓存随着时间的推移而增长，可能会开始占用应用程序层的存储空间。缓存使用了相当一部分可用空间；如果你的主驱动器没有足够的可用空间，你将无法有效利用缓存功能。将
    TFS 缓存移动到单独的目录中，可以释放主驱动器的存储空间，并为新驱动器规划更轻松的备份或恢复过程。将缓存目录更改为独立目录后，你可能会看到一定的性能提升。在本食谱中，你将学习如何将
    TFS 缓存目录更改为不同的目录。
- en: Getting ready
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You need permission to log into the TFS application tier.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要有权限登录到 TFS 应用程序层。
- en: How to do it...
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Log into the TFS application tier. Navigate to the installation folder for TFS.
    The default install location is `C:\Program Files\Microsoft Team Foundation Server
    14.0`.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 TFS 应用程序层。导航到 TFS 的安装文件夹，默认安装位置是 `C:\Program Files\Microsoft Team Foundation
    Server 14.0`。
- en: The TFS's `web.config` is available in the folder location `C:\Program Files\Microsoft
    Team Foundation Server 14.0\Application Tier\Web Services`. Take a backup of the
    `web.config` file before making any changes. Open the `web.config` file and search
    for the key `dataDirectory`:![How to do it...](img/image00826.jpeg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: TFS 的 `web.config` 文件位于 `C:\Program Files\Microsoft Team Foundation Server 14.0\Application
    Tier\Web Services` 文件夹中。在进行任何更改之前，请先备份 `web.config` 文件。打开 `web.config` 文件并搜索键
    `dataDirectory`：![如何操作...](img/image00826.jpeg)
- en: Change the value of the data directory from the default to the new location.
    For this recipe, a new drive `W` has been set up for TFS Cache. Repoint the cache
    to `W:\TfsData\ApplicationTier\_fileCache` and save the changes in the config
    file:![How to do it...](img/image00827.jpeg)
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将数据目录的值从默认值更改为新位置。在这个示例中，已为TFS缓存设置了一个新的驱动器`W`。重新指向缓存到`W:\TfsData\ApplicationTier\_fileCache`并保存配置文件中的更改：![操作步骤...](img/image00827.jpeg)
- en: In addition to this, you can optionally add a `PercentageBasedPolicy` key, which
    would dictate what percentage of the free space can be consumed by the cache.
    This key only accepts whole number values:![How to do it...](img/image00828.jpeg)
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除此之外，你还可以选择添加`PercentageBasedPolicy`键，该键决定可以由缓存消耗的剩余空间的百分比。该键仅接受整数值：![操作步骤...](img/image00828.jpeg)
- en: Alternatively, the `FixedSizeBasedPolicy` key can be used. The value for this
    key is the total allowed space to the cache. For example, setting this to `500`
    would mean the cache only has 500 MB of available space for storage. If both `FixedSizeBasedPolicy`
    and `PercentageBasedPolicy` keys are specified, the value of `FixedSizeBasedPolicy`
    takes precedence.
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 或者，可以使用`FixedSizeBasedPolicy`键。该键的值是缓存允许的总空间。例如，将其设置为`500`意味着缓存仅有500 MB可用空间用于存储。如果同时指定了`FixedSizeBasedPolicy`和`PercentageBasedPolicy`键，则`FixedSizeBasedPolicy`的值优先。
- en: How it works…
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Saving `web.config` will restart the application pool and the changes will be
    effective immediately. Carry out a `get` operation on version control and TFS
    will cache a copy of the files served back to the client as a result of the get
    operation in the new location.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 保存`web.config`将重新启动应用程序池，并立即生效更改。在版本控制上进行`get`操作，TFS将缓存文件的副本作为结果返回给客户端，保存在新位置。
- en: Managing CodeLens in TFS
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在TFS中管理CodeLens
- en: CodeLens is a Microsoft Visual Studio feature that shows you information about
    your code directly in the code editor. Before CodeLens, one had to dig through
    several different windows for information such as method references, tests linked
    to a method, the last change to a line of code, or the code churn to a class.
    Since all of this information is in TFS, you would just expect it to be available
    in one place. CodeLens just does that by putting this information literally at
    your fingertips within the code editor. CodeLens supports both TFVC and Git repositories.
    CodeLens now supports C#, VB, C++, SQL, and JavaScript files. You can learn more
    about CodeLens and other quality and diagnostic tools available in Visual Studio
    at [http://bit.ly/1NNbtJ6](http://bit.ly/1NNbtJ6).
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: CodeLens是Microsoft Visual Studio的一个功能，直接在代码编辑器中显示有关代码的信息。在有了CodeLens之前，人们不得不在多个不同的窗口中查找诸如方法引用、与方法关联的测试、代码行的最后更改或类的代码变动等信息。由于所有这些信息都在TFS中，你只需期望它们能够在一个地方找到。CodeLens通过将这些信息直接放在代码编辑器中使其可用，正是这么做的。CodeLens支持TFVC和Git仓库。CodeLens现在支持C#、VB、C++、SQL和JavaScript文件。你可以在Visual
    Studio中了解更多关于CodeLens和其他质量和诊断工具的信息：[http://bit.ly/1NNbtJ6](http://bit.ly/1NNbtJ6)。
- en: This book focuses on TFS, you are probably wondering why Visual Studio-specific
    features are being discussed. TFS is responsible for preparing the information
    served by CodeLens in Visual Studio. TFS has specific jobs for code indexing,
    and the information produced off that is stored in the TFS database. In this recipe,
    you'll learn how to manage the `TfsConfig CodeIndex` command to check the indexing
    status of a Team Project Collection, enable/disable indexing, find large files,
    and ignore them from indexing, review ignore list, and destroy code index.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 本书侧重于TFS，你可能想知道为什么会讨论与Visual Studio特定功能相关的内容。TFS负责准备由CodeLens在Visual Studio中提供的信息。TFS具有专门的作业用于代码索引，并且生成的信息存储在TFS数据库中。在这个示例中，你将学习如何管理`TfsConfig
    CodeIndex`命令来检查Team Project Collection的索引状态，启用/禁用索引，查找大文件并忽略它们的索引，审查忽略列表并销毁代码索引。
- en: Getting ready
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In order to use the `CodeIndex` command, you need to be a member of the Team
    Foundation Administrators Security Group. This command can only be invoked from
    the TFS Application tier; for this reason, you need to have login permissions
    to the TFS Application tier.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用`CodeIndex`命令，你需要是Team Foundation Administrators安全组的成员。此命令只能从TFS应用程序层调用；因此，你需要具有登录权限到TFS应用程序层。
- en: How to do it...
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Log on to TFS Application tier and open a command prompt in the elevated mode.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到TFS应用程序层并以提升的模式打开命令提示符。
- en: 'Run the following command to see the indexing status for the default collection:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令查看默认集合的索引状态：
- en: '[PRE3]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Start indexing all changesets:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开始索引所有变更集：
- en: '[PRE4]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Stop indexing previously created changesets and start indexing new changesets
    only:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 停止索引之前创建的变更集，仅索引新的变更集：
- en: '[PRE5]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Run the following command to list the top 50 files that have a size greater
    than 10 KB in the default collection:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令，列出默认集合中大小大于 10 KB 的前 50 个文件：
- en: '[PRE6]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Run the following command to exclude a specific file from indexing and add
    it to the ignored file list:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令将特定文件排除在索引之外，并将其添加到忽略文件列表：
- en: '[PRE7]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Run the following command to see all the files that aren''t indexed:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令查看所有未被索引的文件：
- en: '[PRE8]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Run the following command to clear previously indexed data and restart indexing:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令清除先前索引的数据并重新启动索引：
- en: '[PRE9]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Run the following command to delete the code index with confirmation:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令删除代码索引并进行确认：
- en: '[PRE10]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: How it works...
  id: totrans-134
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The `TfsConfig` command gives you the ability to manage the `CodeIndex` functions.
    Refer to [http://bit.ly/1NNcwZi](http://bit.ly/1NNcwZi) for more details on the
    individual commands.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '`TfsConfig` 命令使您能够管理 `CodeIndex` 功能。有关各个命令的更多详情，请参考 [http://bit.ly/1NNcwZi](http://bit.ly/1NNcwZi)。'
- en: Continuous synchronization with the TFS Proxy server
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 与 TFS 代理服务器的持续同步
- en: It is not uncommon today to have geographically distributed Teams accessing
    TFS from remote locations. Remote users may suffer from latency of the connection
    between their location and the location where TFS is hosted. The Team Foundation
    Proxy Server comes to the rescue here. There is a common misconception about TFS
    Proxy caching all requests. However, the proxy server only caches the `Get` operation
    for TFVC-based version control. The proxy server does not carry out a continuous
    synchronization or replication operation, instead it caches the item on first
    request. While the first caller from the remote location will still face the latency
    in their `get` operation, all future requests will get the data as if it was being
    accessed locally. Today, developers are encouraged to check in code frequently.
    This means geographically distributed Teams operating in low network bandwidth
    regions will notice a lag when performing a get operation on source control. In
    this recipe, you'll learn how to precache the data in TFS Proxy to improve the
    overall performance of the proxy.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如今，地理上分布的团队远程访问 TFS 已经很常见。远程用户可能会受到其所在位置与 TFS 托管位置之间连接延迟的影响。此时，团队基础代理服务器（Team
    Foundation Proxy Server）提供了解决方案。关于 TFS 代理缓存所有请求的说法是一个常见误解。事实上，代理服务器只缓存基于 TFVC
    的版本控制中的`Get`操作。代理服务器并不会执行持续的同步或复制操作，而是仅在第一次请求时缓存该项内容。虽然来自远程位置的首次调用者仍然会面临`get`操作的延迟，但所有后续请求将像本地访问一样快速地获取数据。如今，鼓励开发人员频繁提交代码。这意味着在低网络带宽区域操作的地理分布式团队，在执行源代码控制的获取操作时会感到延迟。在本节中，您将学习如何预缓存数据到
    TFS 代理，以提高代理的整体性能。
- en: Getting ready
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires that you have a TFS Proxy Server setup. Follow the steps
    at [http://bit.ly/1lfGDS7](http://bit.ly/1lfGDS7) to configure a TFS Proxy Server
    if you don't already have one. Supplement your proxy server with an additional
    drive. In this recipe, we'll be using `D:\TFS\Workspace` as the additional directory.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 本节需要您已设置 TFS 代理服务器。如果您还没有，可以按照 [http://bit.ly/1lfGDS7](http://bit.ly/1lfGDS7)
    的步骤配置 TFS 代理服务器。为代理服务器添加额外的驱动器。在本节中，我们将使用 `D:\TFS\Workspace` 作为附加目录。
- en: 'Scenario: A part of the distributed Team that is working in a remote location
    does not have great network bandwidth. Operations that require code download from
    the TFS server are generally slow. The Team has installed the TFS Proxy Server
    in their remote location; however, they still face a lag when downloading the
    incremental changes in the source code. The Team would like a proactive solution
    that downloads the incremental code changes to the proxy server, so when the Team
    performs a `Get` operation on TFS, the proxy server can serve the content from
    the local cache rather than needing to make a round trip to TFS.'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 场景：在一个远程地点工作的部分分布式团队网络带宽较差，需要从 TFS 服务器下载代码的操作通常较慢。团队已在其远程地点安装了 TFS 代理服务器；然而，在下载源代码的增量更改时，仍然会遇到延迟。团队希望能采取主动的解决方案，将增量的代码更改下载到代理服务器中，这样当团队执行
    `Get` 操作时，代理服务器可以直接从本地缓存中提供内容，而不必重新向 TFS 发起请求。
- en: How to do it...
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Log into the TFS Proxy Server machine. Browse to the `D:\TFS\Command` directory
    and create a new file called `PreGetTfsProxy.bat`.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 TFS 代理服务器的计算机，浏览到 `D:\TFS\Command` 目录，并创建一个名为 `PreGetTfsProxy.bat` 的新文件。
- en: 'Copy the following code into to the `PreGetTfsProxy.bat` file and save the
    changes:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下代码复制到`PreGetTfsProxy.bat`文件中并保存更改：
- en: '[PRE11]'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Test the script by double-clicking on `PreGetTfsProxy.bat` to run the script.
    If the script is set up correctly, the `D:\TFS\Workspace` location should now
    be populated with the source code from TFS.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击`PreGetTfsProxy.bat`来运行脚本测试脚本。如果脚本设置正确，`D:\TFS\Workspace`位置现在应该包含从TFS获取的源代码。
- en: Set up a Windows scheduled task to run the `PreGetTfsProxy.bat` file once every
    10 minutes. You can tune the frequency of execution of this job to best suit the
    landscape of your organization.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置一个Windows定期任务，每10分钟运行一次`PreGetTfsProxy.bat`文件。您可以调整此作业的执行频率，以最适合您组织的情况。
- en: How it works...
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Installing Team Foundation Server Proxy Server installs the Team Foundation
    Server command-line tools. The core function of the TFS Proxy Server is to locally
    cache any files requested from TFS, so any subsequent calls for that file can
    be served directly by the proxy server. By saving a round trip out to the TFS
    Server, the proxy server can significantly reduce the lag noticed when performing
    the `Get` operation. TFS Proxy Server does not perform a workspace synchronization
    operation, instead it only caches the files requested from the TFS Server. In
    this recipe, we created a temporary workspace on the proxy server and scheduled
    the execution of `Get` operation through a Windows-scheduled task to proactively
    fetch the incremental code changes. This will, in turn cause the proxy server
    to cache the changes on the proxy server proactively. While the approach is simple,
    it is effective in synchronizing the changes from source control locally on the
    proxy server.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 安装Team Foundation Server Proxy Server会安装Team Foundation Server命令行工具。TFS代理服务器的核心功能是在本地缓存从TFS请求的任何文件，因此对于那些文件的任何后续调用可以直接由代理服务器提供。通过节省到TFS服务器的往返时间，代理服务器可以显著减少执行`Get`操作时注意到的延迟。TFS代理服务器不执行工作区同步操作，而是仅缓存从TFS服务器请求的文件。在这个示例中，我们在代理服务器上创建了一个临时工作区，并通过Windows定期任务安排了`Get`操作的执行，以主动获取增量代码更改。这将导致代理服务器在代理服务器上主动缓存更改。虽然这种方法简单，但在同步源代码的同时非常有效。
- en: The TFS Proxy Server can significantly reduce the time taken to perform a `Get`
    operation. Perfmon is a very useful tool to measure the system performance using
    performance counters. Follow the walkthrough in [http://bit.ly/1SZEN2T](http://bit.ly/1SZEN2T)
    to measure the times for the `Get` operation with and without the proxy server.
    It is generally recommended to baseline the performance gained by the proxy server.
    This should be revalidated after TFS upgrades.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: TFS代理服务器可以显著缩短执行`Get`操作所需的时间。Perfmon是使用性能计数器测量系统性能的非常有用的工具。按照[http://bit.ly/1SZEN2T](http://bit.ly/1SZEN2T)中的步骤测量带有和不带代理服务器的`Get`操作的时间是一般推荐的，基准性能提升了代理服务器之后应该重新验证。
- en: Creating a TFS database back up schedule
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建TFS数据库备份计划
- en: '|   | *"If you fail to plan, you are planning to fail!"* |   |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '|   | *"如果你没有计划，你就是在计划失败！"* |   |'
- en: '|   | --*Benjamin Franklin* |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '|   | --*本杰明·富兰克林* |'
- en: No one wants to be the administrator of a server that goes down without a complete
    set of backups in place. TFS Database sits at the core of the product; the database
    is the repository of the data you interact with using Web Portal, Visual Studio,
    and Microsoft Test Manager. In this recipe, you'll learn about the database backup
    capability available with in TFS.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 没有人愿意成为一个没有完整备份的服务器管理员。TFS数据库是产品的核心；数据库是使用Web Portal、Visual Studio和Microsoft
    Test Manager交互的数据存储库。在这个示例中，您将了解到TFS提供的数据库备份功能。
- en: Getting ready
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To configure the backup schedule, you will need to be a member of the TFS Administrator
    Group, a member of SQL Server Administrator Group, and (if your deployment uses
    SharePoint Products) a member of the Farm Administrators Group.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置备份计划，您需要是TFS管理员组的成员、SQL Server管理员组的成员，以及（如果您的部署使用SharePoint产品）农场管理员组的成员。
- en: The TFS Service Account must have a SQL Server perform backup and create maintenance
    plan permissions set to allow on each instance of the SQL Server that hosts the
    databases that you want to back up. You need a network share to store the database
    backup. The service account needs full control permission on the network share,
    folder, or storage device where the backups will be kept.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: TFS服务帐户必须在每个托管您要备份的数据库的SQL Server实例上，设置允许SQL Server执行备份和创建维护计划的权限。您需要一个网络共享来存储数据库备份。服务帐户需要对存储备份的网络共享、文件夹或存储设备具有完全控制权限。
- en: How to do it...
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Log into the Team Foundation Server Application tier and open the Team Foundation
    Server Administration Console. Navigate to the **Scheduled Backups** screen by
    clicking on **Scheduled Backups** from the navigation panel on the left:![How
    to do it...](img/image00829.jpeg)
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到Team Foundation Server应用层并打开Team Foundation Server管理控制台。通过点击左侧导航面板中的**计划备份**进入**计划备份**屏幕：![如何操作...](img/image00829.jpeg)
- en: As illustrated here, specify the network backup path and duration to 30 days:![How
    to do it...](img/image00830.jpeg)
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如图所示，指定网络备份路径并将持续时间设置为30天：![如何操作...](img/image00830.jpeg)
- en: 'The **Advanced** section allows you specify the file extension for the backup
    and the transactional backup file:'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**高级**部分允许您指定备份的文件扩展名以及事务备份文件：'
- en: '![How to do it...](img/image00831.jpeg)'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image00831.jpeg)'
- en: You can optionally choose a unique extension name and configure that to be exempted
    from the antivirus scan. The general industry wide accepted extension for backups
    are `bak` for the full backups, `diff` for differential backups, and `trn` for
    transactional backups.
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您还可以选择一个唯一的扩展名，并将其配置为排除在病毒扫描之外。业界普遍接受的备份扩展名是：`bak`用于完整备份，`diff`用于差异备份，`trn`用于事务备份。
- en: The next screen allows you to specify the reporting databases. Check the option
    to include the reporting database in the backup schedule. This will allow you
    to back up the reporting databases along with the TFS Database backups.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏幕允许您指定报告数据库。勾选该选项将报告数据库包含在备份计划中。这样您就可以将报告数据库与TFS数据库一起备份。
- en: Reporting services needs an encryption key for accessing reports after the database
    restore, set an encryption key password in the reporting key page and click on
    **Next**.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 报告服务需要一个加密密钥以在数据库恢复后访问报告，请在报告密钥页面设置加密密钥密码并点击**下一步**。
- en: You can optionally choose to backup SharePoint databases as well by checking
    the **Include SharePoint databases in the backup schedule** option.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以选择性地勾选**在备份计划中包含SharePoint数据库**选项来备份SharePoint数据库。
- en: Click on next to go to the **Alerts** screen. The **Alert** screen can be used
    to specify the backup scheduled alert settings. You can choose to alert the user
    on the success or failure of the backup job:![How to do it...](img/image00832.jpeg)
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“下一步”进入**警报**屏幕。**警报**屏幕可用于指定备份计划的警报设置。您可以选择在备份任务成功或失败时提醒用户：![如何操作...](img/image00832.jpeg)
- en: The schedule backup page allows you to choose from **Nightly**, **Manual**,
    and **Custom** schedule. The **Custom** schedule gives you more control to set
    a schedule for the full backup, a differential backup schedule, and the interval
    for the transactional backup.![How to do it...](img/image00833.jpeg)
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 调度备份页面允许您选择**每日**、**手动**和**自定义**调度。**自定义**调度让您可以更灵活地设置完整备份的调度、差异备份调度以及事务备份的间隔时间。![如何操作...](img/image00833.jpeg)
- en: Confirm the settings on the review page and click on **Next** to trigger the
    validation checks. Now that the validation has successfully passed, you can click
    on the **Configure** button to configure the backup per the settings:![How to
    do it...](img/image00834.jpeg)
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在审核页面确认设置并点击**下一步**以触发验证检查。验证成功通过后，您可以点击**配置**按钮，根据设置配置备份：![如何操作...](img/image00834.jpeg)
- en: Navigate to `\\tfs2015\backup` and you'll find the `BackupSets.xml`, `BackupSettings.xml`,
    and strong key for the reporting server. Make a copy and store these in a safe
    location.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到`\\tfs2015\backup`，您将找到`BackupSets.xml`、`BackupSettings.xml`和报告服务器的密钥。请复制并将其保存在安全的位置。
- en: You can trigger an ad hoc backup by clicking on the **Take Full Backup Now**
    link from the Team Foundation Server Administration Console:![How to do it...](img/image00835.jpeg)
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以通过在Team Foundation Server管理控制台中点击**立即进行完整备份**链接来触发临时备份：![如何操作...](img/image00835.jpeg)
- en: Updates on the backup processing are displayed in a pop-up window. Once the
    backup completes, you can find the full set available in the network share.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 备份处理的更新会显示在弹出窗口中。备份完成后，您可以在网络共享中找到完整的备份集。
- en: How it works...
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: Knowing the classification and criticality of the data as well as the recover
    goals of the organization are really useful in working out a backup and recovery
    strategy for the organization. Certain organizations may have very specific backup
    needs, which may not be possible to configure via the built-in "schedule backup".
    The website [http://bit.ly/1IbxBLd](http://bit.ly/1IbxBLd) discusses these use
    cases in length.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 了解数据的分类和关键性以及组织的恢复目标，对于制定组织的备份和恢复策略非常有帮助。某些组织可能有非常具体的备份需求，这些需求可能无法通过内置的“计划备份”进行配置。网站[http://bit.ly/1IbxBLd](http://bit.ly/1IbxBLd)详细讨论了这些使用案例。
- en: Visual Studio ALM Rangers have some great guidance on disaster recovery planning
    for TFS. You can read more about it at [http://bit.ly/1Lwgx2y](http://bit.ly/1Lwgx2y).
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: Visual Studio ALM Rangers提供了关于TFS灾难恢复规划的很好的指导。您可以在[http://bit.ly/1Lwgx2y](http://bit.ly/1Lwgx2y)阅读更多内容。
- en: Cleaning up unused workspaces and shelvesets in TFS – in progress
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 清理TFS中未使用的工作区和shelvesets - 进行中
- en: It is common for TFVC users to create workspaces to temporarily download files
    or simply forget to delete unused shelvesets. As a Team Foundation Server Administrator,
    you will benefit from reducing this clutter. The `tf.exe` command-line utility
    has commands for administrating workspaces and shelvesets. In this recipe, you'll
    learn how to use the `tf.exe` utility to delete unused workspaces and shelvesets.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 对于TFVC用户来说，创建工作区以临时下载文件或简单地忘记删除未使用的shelvesets是很常见的。作为团队基础服务器管理员，减少这些杂乱无章的文件会对你有所帮助。`tf.exe`命令行工具提供了用于管理工作区和shelvesets的命令。在本实例中，您将学习如何使用`tf.exe`工具删除未使用的工作区和shelvesets。
- en: Getting ready
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To modify or delete an existing workspace or shelveset, you must have the global
    administer workspaces permission set to **Allow**.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 要修改或删除现有的工作区或shelveset，必须将全局管理工作区权限设置为**允许**。
- en: How to do it…
  id: totrans-179
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: Launch the developer command prompt in the elevated mode.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以提升模式启动开发者命令提示符。
- en: 'The following command will delete the `Win2k12R2_John` workspace, which belongs
    to default collection in TFS. Refer to [http://bit.ly/1P6mo6t](http://bit.ly/1P6mo6t)
    for more examples on how to use the workspace switch with the `tf.exe` command:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下命令将删除属于TFS默认集合的`Win2k12R2_John`工作区。有关如何使用`tf.exe`命令切换工作区的更多示例，请参阅[http://bit.ly/1P6mo6t](http://bit.ly/1P6mo6t)：
- en: '[PRE12]'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Similar to the workspace delete, the shelveset delete follows a similar command
    pattern. The following command will delete the `Fabrikam_Delta` workspace from
    the default collection in TFS. Refer to [http://bit.ly/1lHChUk](http://bit.ly/1lHChUk)
    for more examples
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 类似于工作区删除，shelveset删除也遵循类似的命令模式。以下命令将从TFS的默认集合中删除`Fabrikam_Delta`工作区。有关更多示例，请参阅[http://bit.ly/1lHChUk](http://bit.ly/1lHChUk)。
- en: '[PRE13]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: How it works…
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: The TFS command-line utility (`tf.exe`) is installed along with the installation
    of the Visual Studio. The TFS command-line utility includes switches for various
    TFS operations that empower TFS Administrators to script these routine operations.
    You can read more about these operations at [http://bit.ly/1P6mo6t](http://bit.ly/1P6mo6t).
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: TFS命令行工具（`tf.exe`）随着Visual Studio的安装一起安装。TFS命令行工具包含用于各种TFS操作的开关，使TFS管理员能够编写这些常规操作的脚本。您可以在[http://bit.ly/1P6mo6t](http://bit.ly/1P6mo6t)阅读更多有关这些操作的信息。
- en: The build server is the biggest consumer of workspaces. Build definitions that
    have not been used for a while will retain the workspace and consume large amounts
    of storage in doing so. Identifying and manually deleting these dead workspaces
    is a painstaking task. TFS Workspace cleaner is an open source utility hosted
    on CodePlex that helps you free up storage by deleting workspaces unused in a
    number of days. You can learn more about this utility at [http://bit.ly/1LxFDhv](http://bit.ly/1LxFDhv).
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 构建服务器是工作区的最大消耗者。长时间未使用的构建定义会保留工作区，并因此消耗大量存储。识别并手动删除这些死工作区是一项艰巨的任务。TFS工作区清理工具是一个开源工具，托管在CodePlex上，可以通过删除若干天未使用的工作区来帮助您释放存储空间。您可以在[http://bit.ly/1LxFDhv](http://bit.ly/1LxFDhv)了解更多关于此工具的信息。
