<html><head></head><body>
        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Continuous Delivery</h1>
            

            <article>
                
<div class="packtquote1">Technology is nothing. What's important is that you have a faith in people, that they're basically good and smart, and if you give them tools, they'll do wonderful things with them                                                                                                                              - Steve Jobs</div>
<p class="calibre2">We have looked at different DevOps practices such as continuous integration, containers, and configuration management. Now we will look at how to deploy a package file in to a web container or web server. We will use Apache Tomcat as a web server in cloud virtual machines to deploy our Java-based application.</p>
<p class="calibre2">The main objective of this chapter is to make you the reader aware of different ways to deploy an application package into a web server. These ways can be utilized based on the access available to the team and, once we achieve this automated delivery into the web server, then we can utilize this operation in the overall build orchestration.</p>
<p class="calibre2">So, we can create a build pipeline and this orchestration will help us to achieve continuous delivery and continuous deployment.</p>
<p class="calibre2">In this chapter, we are going to cover the following topics:</p>
<ul class="calibre10">
<li class="calibre11">Continuous delivery in Docker container using Jenkins plugin</li>
<li class="calibre11">Continuous delivery in AWS EC2 and Microsoft Azure VM using script</li>
<li class="calibre11">Continuous delivery in AWS Elastic Beanstalk using a Jenkins plugin</li>
<li class="calibre11">Continuous delivery in Microsoft Azure App Services using FTP</li>
<li class="calibre11">Continuous delivery in Microsoft Azure App Services using VSTS</li>
</ul>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Continuous delivery in Docker container using Jenkins Plugin</h1>
            

            <article>
                
<p class="calibre2">Let's understand how we can deploy a web application in Tomcat using the Jenkins plugin.</p>
<p class="calibre2">We can follow a few steps for that:</p>
<ul class="calibre10">
<li class="calibre11">Run Apache Tomcat</li>
<li class="calibre11">Use the proper IP address and port number combination to navigate to the Tomcat home page:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00028.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Go to the <kbd class="calibre15">conf</kbd> directory and then open <kbd class="calibre15">tomcat-users.xml</kbd> in your Tomcat installation directory and un-comment the role and user lines or rewrite them. Set <span>manager-script</span> as the <span>rolename</span> for testing purposes. We need <span>manager-script</span> for deployment via the <kbd class="calibre15">Deploy to Container</kbd> plugin.</li>
<li class="calibre11">For the Jenkins deploy plugin, change the <span>rolename</span> to <span>manager-script</span> as follows:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border44" src="../images/00058.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on the manager application link on the Tomcat home page and enter the username and password you set in <kbd class="calibre15">tomcat-users.xml</kbd>. Now we can access the management application. For a local Tomcat, we can use localhost to access the Tomcat page or we can use the IP address as well. For a remote web server, we can utilize an IP address or domain name to access Tomcat.</li>
<li class="calibre11">Restart Tomcat and visit <kbd class="calibre15"><span>https://&lt;IP Address&gt;:8080/manager/text/list</span></kbd>. You should see this output:</li>
</ul>
<pre class="calibre26">
        OK - Listed applications for virtual host localhost <br class="title-page-name"/>        /:running:0:ROOT <br class="title-page-name"/>        /petclinic:running:1:petclinic <br class="title-page-name"/>        /examples:running:0:examples <br class="title-page-name"/>        /host-manager:running:0:host-manager <br class="title-page-name"/>        /manager:running:0:manager <br class="title-page-name"/>        /docs:running:0:docs 
</pre>
<ul class="calibre10">
<li class="calibre11">Go to the <span>Jenkins</span> job build page and click on <span>Configure</span>. Select the proper <span>JDK</span> configuration for the Jenkins agent:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone3" src="../images/00060.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Under <span>Post-build Actions</span>, select <span>Deploy war/ear to a container</span>. Provide the location of the WAR file in the Jenkins workspace, the Tomcat manager credentials, and the <span>Tomcat URL</span> with the port:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone4" src="../images/00063.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on <span>Apply</span> and <span>Save</span>. Click on <span>Build now</span> on the <span>Jenkins</span> build's page. Verify that the console output is showing a fresh deployment:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone5" src="../images/00066.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Once the build is successful, visit the URL from your browser and notice the context. It is similar to the name of the application:</li>
</ul>
<div class="title-page-name">
<div class="CDPAlignCenter"><img class="image-border45" src="../images/00068.jpeg"/></div>
</div>
<p class="calibre2">We already know the basic operations available in Docker, as we covered them in <a href="part0059.html#1O8H60-651ea628c0544d18a4415dfef8fe6271" target="_blank" class="calibre4"><span>Chapter 3</span></a>, <em class="calibre12">Containers</em>. We have created a customized Tomcat image with <kbd class="calibre15">tomcat-users.xml</kbd>.</p>
<p class="calibre2">Once Docker is up and running, we are ready to create a Docker container. Note the IP address of the default Docker machine in the following image:</p>
<div class="CDPAlignCenter"><img class="alignnone6" src="../images/00070.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">To change the name of the container, use :</li>
</ul>
<pre class="calibre26">
        <strong class="calibre1">docker run -it -p 9999:8080 --name bootcamp_tomcat     devops_tomcat_sc</strong>  
</pre>
<ul class="calibre10">
<li class="calibre11">Verify the name using :</li>
</ul>
<pre class="calibre26">
        <strong class="calibre1">dockerps -a</strong>  
</pre>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00073.gif"/></div>
<ul class="calibre10">
<li class="calibre11">Use the virtual machine IP address and use <span>9999</span> as a port number to access Tomcat running in the container:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border46" src="../images/00076.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Verify the manager access with the <kbd class="calibre15">manager-script</kbd> role using the following URL:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone7" src="../images/00077.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Let's just try to deploy an application using the <kbd class="calibre15">Deploy to Container</kbd> plugin in Tomcat. If one build job generates a WAR file, then copy it from that build using the <strong class="calibre1">copy artifact</strong> plugin:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone8" src="../images/00080.jpeg"/><br class="title-page-name"/></div>
<ul class="calibre10">
<li class="calibre11">In <span>Post-build actions</span>, select <span>Deploy war/ear</span> <span>to a container</span>. Give the user name and password provided in <kbd class="calibre15">tomcat-users.xml</kbd>. We will then provide the <span>Tomcat URL</span>,<span> </span>shown as follows. After filling in the details , click on <span>Apply/Save</span>:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00081.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on <span>Build Now</span>.</li>
</ul>
<ul class="calibre10">
<li class="calibre11">Go to console output and verify the deployment process:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00083.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Verify the application URL using the Tomcat URL and application context.</li>
</ul>
<p class="calibre2">Awesome!! We have successfully created an image and a container, and deployed the application in the Tomcat container.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Continuous Delivery in AWS EC2 and Microsoft Azure VM using Script</h1>
            

            <article>
                
<p class="calibre2">We have already created VMs in AWS and Microsoft Azure in <a href="part0067.html#1VSLM0-651ea628c0544d18a4415dfef8fe6271" target="_blank" class="calibre4">Chapter 4</a>, <em class="calibre12">Cloud Computing and Configuration Management</em>. To deploy an application in AWS and Microsoft Azure VM, we need a WAR package file. Once it is created by the Jenkins build job, we need to perform the following steps:</p>
<div class="CDPAlignCenter"><img class="image-border47" src="../images/00085.gif"/></div>
<p class="calibre2">Let's configure the build job to execute the deployment of the <span>WAR</span> file in the AWS instance by executing the commands shown as follows:</p>
<ul class="calibre10">
<li class="calibre11">Give rights to <kbd class="calibre15">ec2-user</kbd> in the <kbd class="calibre15">webapps</kbd> directory of Tomcat so we can copy the WAR file:</li>
</ul>
<pre class="calibre26">
        <strong class="calibre1">ssh  -i /home/mitesh/book.pem -o StrictHostKeyChecking=no -t -t<br class="title-page-name"/>        ec2-user@ec2-52-90-116-36.compute-1.amazonaws.com "sudousermod -a<br class="title-page-name"/>        -G tomcat ec2-user;<br class="title-page-name"/>        sudochmod -R g+w /var/lib/tomcat6/webapps; sudo service tomcat6<br class="title-page-name"/>        stop;"</strong>  
</pre>
<ul class="calibre10">
<li class="calibre11">Copy the WAR file into the remote directory:</li>
</ul>
<pre class="calibre26">
        <strong class="calibre1">scp  -i /home/mitesh/book.pem /home/mitesh/target/*.war ec2-<br class="title-page-name"/>        user@ec2-52-90-116-36.compute-<br class="title-page-name"/>        1.amazonaws.com:/var/lib/tomcat6/webapps</strong>  
</pre>
<ul class="calibre10">
<li class="calibre11">Start/restart the Tomcat service:</li>
</ul>
<pre class="calibre26">
        <strong class="calibre1">ssh  -i /home/mitesh/book.pem -o StrictHostKeyChecking=no -t -t<br class="title-page-name"/>        ec2-user@ec2-52-90-116-36.compute-1.amazonaws.com "sudo service<br class="title-page-name"/>        tomcat6 start"</strong>
</pre>
<p class="calibre2">Use the <kbd class="calibre15">Copy Artifact</kbd> plugin to copy the <strong class="calibre1">WAR</strong> file from another build job and then execute the preceding commands in <span>Execute Shell Build Actions</span>:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00087.jpeg"/></div>
<p class="calibre2">Click on <span>Save</span> and then execute the build job. For application deployment in Microsoft Azure VM, utilize Jenkins plugin (<span>Deploy to Container</span>) or script utilized for AWS with required modification as self exercise.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Continuous delivery in AWS Elastic Beanstalk using Jenkins Plugin</h1>
            

            <article>
                
<p class="calibre2">AWS Elastic Beanstalk is a <strong class="calibre1">Platform as a Service</strong>(<strong class="calibre1">PaaS</strong>) offering from Amazon. We will use it to deploy the PetClinic application on the AWS platform. The good part is we don't need to manage the infrastructure or even the platform, as it is a PaaS offering. We can configure scaling and other details. These are the steps to deploy an application on AWS Elastic Beanstalk:</p>
<div class="CDPAlignCenter"><img class="image-border48" src="../images/00088.jpeg"/></div>
<p class="calibre2">Let's create a sample application to understand how Elastic Beanstalk works and then use the <kbd class="calibre15">Jenkins</kbd> plugin to deploy an application.</p>
<ul class="calibre10">
<li class="calibre11">Go to the AWS management console and verify whether we have a default <strong class="calibre1">Virtual Private Cloud</strong> (<strong class="calibre1">VPC</strong>). If you've deleted the default VPC and subnet by accident, send a request to AWS customer support to recreate it:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border49" src="../images/00090.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on <span>Services</span> in the AWS management console and select AWS <span>Elastic Beanstalk</span>. Create a new application named <span>petclinic</span>. Select <span>Tomcat</span> as a <span>Platform</span> and select the <span>Sample application</span> radio button:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border50" src="../images/00091.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Verify the sequence of events for the creation of a sample application:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00172.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">It will take a while, and once the environment has been created, it will be highlighted in green, as shown here:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone9" src="../images/00185.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on the <span>petclinic</span> environment and verify <span>Health</span> and <span>Running Version</span> in the dashboard:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border51" src="../images/00201.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Verify the environment ID and URL. Click on the <span>URL</span> and verify the default page:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border52" src="../images/00193.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Install the AWS Elastic Beanstalk <kbd class="calibre15">Publisher</kbd> plugin.</li>
</ul>
<div class="packtinfobox">For more details, visit <a href="https://wiki.jenkins-ci.org/display/JENKINS/AWS+Beanstalk+Publisher+Plugin" class="calibre22">https://wiki.jenkins-ci.org/display/JENKINS/AWS+Beanstalk+Publisher+Plugin</a>.</div>
<ul class="calibre10">
<li class="calibre11">Open the Jenkins dashboard and go to <span>Build</span> job. Click on <span>Post-build Actions</span> and select <span>Deploy into AWS Elastic Beanstalk</span>:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00195.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">A new section will come up in <span>Post-build Actions</span> for <span>Elastic Beanstalk</span>.</li>
<li class="calibre11">Click on the <span>Jenkins</span> dashboard and select <span>Credentials</span>; add your AWS credentials.</li>
<li class="calibre11">Go to your Jenkins build and select <span>AWS Credential</span>, which is set in the global configuration.</li>
<li class="calibre11">Select <span>AWS Region</span> from the list and click on <span>Get Available Applications</span>. As we have created a sample application, it will show up like this.</li>
<li class="calibre11">In <span>EnvironmentLookup</span>, provide an environment ID in the <span>Get Environments By Name</span> box and click on <span>Get Available Environments</span>:<span><br class="title-page-name"/></span></li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone10" src="../images/00199.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Save the configuration and click on <span>Build now</span>.</li>
</ul>
<p class="calibre2">Now let's verify the AWS management console to check whether the <strong class="calibre1">WAR</strong> file is being copied in Amazon S3 or not:</p>
<ul class="calibre10">
<li class="calibre11">Go to S3 Services and check the available buckets:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border53" src="../images/00202.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Since the WAR file is large, it will take a while to upload to Amazon S3. Once it is uploaded, it will be available in the Amazon S3 bucket.</li>
<li class="calibre11">Verify the build job's execution status in Jenkins. Some sections of the expected output are that:
<ul class="calibre24">
<li class="calibre11">The test case execution and WAR file creation are successful</li>
<li class="calibre11">The build is successful</li>
</ul>
</li>
<li class="calibre11">Now check the AWS management console:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00105.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Go to <span>Services</span>, click on AWS <span>Elastic Beanstalk</span>, and verify the environment. The previous version was Sample Application. Now, the version is updated as given in <strong class="calibre1">Version Label Format</strong> in the Jenkins build job configuration:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border54" src="../images/00107.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Go to the dashboard and verify <span>Health</span> and <span>Running Version</span> again.</li>
<li class="calibre11">Once everything has been verified, click on the URL for the environment, and our PetClinic application is live:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border55" src="../images/00109.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Once the application deployment is successful, terminate the environment:</li>
</ul>
<p class="calibre2">We have thus successfully deployed our application on Elastic Beanstalk.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Continuous delivery in Microsoft Azure App Services Using FTP</h1>
            

            <article>
                
<p class="calibre2">Microsoft Azure app services is a PaaS. In this section, we will look at the Azure Web App and how we can deploy our PetClinic application.</p>
<p class="calibre2">Let's install the <kbd class="calibre15">Publish Over FTP</kbd> plugin in Jenkins. We will use the Azure Web App's FTP details to publish the PetClinic WAR file:</p>
<ul class="calibre10">
<li class="calibre11">Go to the Microsoft Azure portal at <a href="https://portal.azure.com" class="calibre4"><span>https://portal.azure.com</span></a>. Click on <span>App Services</span> and then on <span>Add</span>. Provide values for <span>App Name</span>, <span>Subscription</span>, <span>Resource Group</span>, and <span>App Service plan/Location</span>. Click on <span>Create</span>:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border56" src="../images/00111.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Once the Azure Web App is created, see whether it shows up in the Azure portal.</li>
<li class="calibre11">Click on <span>DevOpsPetClinic</span> in details related to the <span>URL</span>, <span>Status</span>, <span>Location</span>, and so on:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone11" src="../images/00212.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on <span>All Settings</span>, go to the <span>GENERAL</span> section and click on <span>Application settings</span> to configure the Azure Web App for Java web application hosting. Select the <span>Java version</span>, <span>Java Minor version</span>, <span>Web container</span>, and <span>Platform</span>, and click on <span>Always On</span>:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone12" src="../images/00226.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Visit the URL of an Azure Web App from your browser and verify that it is ready for hosting our sample spring application, PetClinic:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border57" src="../images/00118.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Let's go to the <span>Jenkins</span> dashboard. Click on <span>New Item</span> and select <span>Freestyle project</span>.</li>
<li class="calibre11">Click on <span>All Setting</span>s, and go to <span>Deployment credentials</span> in the <span>PUBLISHING</span> section. Provide a username and password, and save your changes:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00252.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">In Jenkins, go to <span>Manage Jenkins</span> and click on <span>Configure</span> | <span>Configure FTP</span> settings. Provide a <span>Hostname</span>, <span>Username</span>, and <span>Password</span>, available in the Azure portal.</li>
<li class="calibre11">Go to <kbd class="calibre15">devopspetclinic.scm.azurewebsites.net</kbd> and download the Kudu console. Navigate to the different options and find the <kbd class="calibre15">site directory</kbd> and <kbd class="calibre15">webapps</kbd> directory.</li>
<li class="calibre11">Click on <span>Test Configuration</span> and, once you get a <span>Success</span> message, you are ready to deploy the PetClinic application:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border58" src="../images/00266.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">In the build job we created, go to the <span>Build</span> section and configure <span>Copy artifacts from another project</span>. We will copy the WAR file to a specific location on a virtual machine:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border59" src="../images/00280.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">In <span>Post-build Actions</span>, click on <span>Send build artifacts over FTP</span>. Select the <span>FTP Server Name</span> configured in Jenkins. Configure <span>Source files</span> and the <span>Remove prefix</span> accordingly for deployment of an Azure Web App:</li>
<li class="calibre11">Tick <span>Verbose output in console</span><span>:</span></li>
</ul>
<div class="CDPAlignCenter"><img class="image-border60" src="../images/00293.jpeg"/></div>
<ul class="calibre10">
<li class="calibre11">Click on <span>Build now</span> and see what happens behind the scenes:</li>
<li class="calibre11">Go to the <span>Kudu</span> console, click on <span>DebugConsole</span>, and go to <span>Powershell</span>. Go to <span>site</span> | <span>wwwroot</span> | <span>webapps</span>. Check whether the WAR file has been copied:</li>
<li class="calibre11">Visit the Azure Web App URL in the browser with the context of an application:</li>
</ul>
<div class="title-page-name"><img class="image-border61" src="../images/00129.jpeg"/></div>
<p class="calibre2">Now we have an application deployed on Azure Web Apps.</p>
<p class="calibre2">It is important to note that the FTP username has to be with the domain. In our case, it can be <kbd class="calibre15">Sample9888\m1253966</kbd>. Using the username without the web app name won't work.</p>
<p class="calibre2">All these different ways of deploying to AWS IaaS, AWS PaaS, Microsoft Azure PaaS, and Docker container can be used in the final end-to-end automation.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Continuous delivery in Microsoft Azure App Services Using VSTS</h1>
            

            <article>
                
<p class="calibre2">Visual Studio Team Services provides a way to configure continuous integration and continuous delivery. We will first go to our VSTS account. Here, we need the following things to be accomplished:</p>
<ul class="calibre10">
<li class="calibre11">Configure Microsoft Azure Subscription so we can connect to Azure Web Apps from VSTS</li>
<li class="calibre11">Create a release definition that achieves the task of application deployment in Azure Web Apps</li>
</ul>
<p class="calibre2">In the <span>Recent projects &amp; team</span><span>s</span>, click on <span>PetClinic</span>:</p>
<p class="calibre2">It will open a <span>Home</span> page for the project created in VSTS:</p>
<p class="calibre2">In the top menu bar, click on <span>Build &amp; Release</span>, which will open a menu. Click on the <span>Releases</span> menu item from it:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00131.jpeg"/></div>
<p class="calibre2">Click on the <span>Releases</span> link on the page.</p>
<p class="calibre2">As this is the new account, there is no Release definition created that has been created yet, so this section is empty. We can create a <span>New Release</span> definition so we can automate application deployment into Azure App Services or the App Service Environment.</p>
<p class="calibre2">In the same way that we have built definition for continuous integration, we have release definition for continuous release or continuous delivery or continuous deployment. Release definition contains different tasks that can be used for application deployment in the target environment. Each release definition contains one or more environments, and each environment contains one or more tasks to deploy the application.</p>
<p class="calibre2">So, let's create a new release definition. Each release definition can contain one or more environment and each environment can contain one or more tasks to deploy an application.</p>
<p class="calibre2">Click on <span>New definition</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone13" src="../images/00302.jpeg"/></div>
<p class="calibre2">Once we click on the new release definition, it will open a dialog box with deployment templates that can be used for deployment automation.</p>
<p class="calibre2">We are going to deploy the WAR file into Azure App Service / Azure Web Apps, so select <span>Azure App Service Deployment</span>.</p>
<p class="calibre2">Click on <span>Next</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone14" src="../images/00135.jpeg"/></div>
<p class="calibre2">Let's review a few things from earlier chapters before explaining this deployment automation.</p>
<p class="calibre2">We created a build definition <span>PetClinic-Maven</span> that compiles the source code, executes unit test cases and creates a WAR file. WAR file is our artifact. This artifact is the result of the build definition execution.</p>
<p class="calibre2">Now, in the release definition, we need to select where the artifact will come from, and that is from <span>Build</span>.</p>
<p class="calibre2">Select the <span>PetClinic</span> project.</p>
<p class="calibre2">In <span>Source (Build definition)</span>, all build definitions related to the <span>PetClinic</span> project will be available. We will select <span>PetClinic-Maven</span>.</p>
<p class="calibre2">In a nutshell, we want to achieve continuous integration and continuous delivery here. It means that, when a developer checks any new code or bug fix in the repository, it will automatically trigger a build definition. Build definition will compile source files, execute unit tests, if any, conduct a static code analysis if sonar is configured, and create a WAR/package file. That is an artifact. Once build definition has completed successfully, it will trigger a release definition to deploy an artifact or a <strong class="calibre1">WAR</strong> file into Azure Web Apps that is hosted in an ASE or a non-ASE environment.</p>
<p class="calibre2">Click on the <span>Continuous deployment (create release and deploy whenever a build completes)</span> checkbox.</p>
<p class="calibre2">Click on <span>Create</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone14" src="../images/00137.jpeg"/></div>
<p class="calibre2">This will open a release definition in the edit mode. We selected <span>Deploy Azure App Service</span>. The first thing that is required is to configure an Azure subscription with VSTS.</p>
<p class="calibre2">Click on the <span>task</span> and see there are two fields named <span>AzureRM Subscription</span> and <span>App Service Name</span>. We need to configure Azure subscription here and <span>App Service Name</span> will come in the list automatically.</p>
<p class="calibre2">Click on <span>Manage</span> link next to the <span>AzureRM Subscription</span> field:</p>
<div class="CDPAlignCenter"><img class="alignnone15" src="../images/00139.jpeg"/></div>
<p class="calibre2">It will open a <span>Services</span> page in the VSTS portal. As of now, there is no service configured, so the list is empty:</p>
<p class="calibre2">Click on the <span>New Service Endpoint</span>.</p>
<p class="calibre2">It will open a menu; select the <span>Azure Resource Manager</span> menu item from the menu to configure Azure subscription:</p>
<div class="CDPAlignCenter"><img class="alignnone16" src="../images/00003.jpeg"/></div>
<p class="calibre2">As we are already logged into VSTS and our Azure account, it will show the subscription name in the list. In <span>Connection name</span>, give the name that we will use in the release definition task to connect to our Azure Account.</p>
<p class="calibre2">Click on <span>OK</span>.</p>
<p class="calibre2">The purpose of adding the Azure subscription here is to get a list of resources available in that subscription to VSTS so that we can configure them for deployment. In our example, we need a list of Azure Web Apps that are hosted in ASE or non-ASE so we can deploy the PetClinic application to Azure Web Apps.</p>
<p class="calibre2">Once we close the box to add an <span>Azure RM Endpoint</span>, we can see a list of endpoints in services. Hence, we have Azure RM subscription configured successfully:</p>
<div class="CDPAlignCenter"><img class="alignnone17" src="../images/00006.jpeg"/></div>
<p class="calibre2">Click on the <span>Roles</span> link to verify the available roles of the Azure subscription:</p>
<p class="calibre2">Now go to <span>Release Definitions</span> and click on the list box of <span>AzureRM Subscription</span>, and now our newly added <span>Endpoint</span> is available in the list.</p>
<p class="calibre2">Select <span>Endpoint</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone18" src="../images/00146.jpeg"/></div>
<p class="calibre2">So far, we have configured Azure Subscription Endpoint in VSTS so we can use it in <span>Release Definition</span>s to deploy the artifact in Azure App Services hosted in ASE and non-ASE environments. We have already configured AzureRM Subscription. Once it has completed successfully, we can select <span>App Service Name</span>. Click on the down arrow and the <span>Azure Web Apps</span> available in the configured <span>AzureRM subscription</span> will show in the list:</p>
<p class="calibre2">Go to <span>Select File Or Folder</span> and click on the three dots (<span>...</span>); go to the <span>PetClinic-Maven</span> and select the <strong class="calibre1">WAR</strong> file created after successful execution of build definition.</p>
<p class="calibre2">Our <span>Release Definitions</span> will pick this WAR file and deploy it in Azure Web Apps.</p>
<p class="calibre2">Click on <span>OK</span>.</p>
<p class="calibre2">Now, we are all set to execute the <span>Release Definitions</span>, but before that, we need to save the <span>Release Definitions</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone19" src="../images/00011.jpeg"/></div>
<p class="calibre2">Click on the <span>Save</span> button and it will open a new dialog box. Provide a <span>Comment</span> and click on <span>OK</span> to save the release definition in VSTS:</p>
<div class="CDPAlignCenter"><img class="alignnone20" src="../images/00149.jpeg"/></div>
<p class="calibre2">Verify that you have saved the release definition.</p>
<p class="calibre2">The <span>Triggers</span> section allows us to schedule when the new release should be created. We can set it when a new artifact version is available, or in other words, when a build definition execution has successfully completed:</p>
<div class="CDPAlignCenter"><img class="alignnone21" src="../images/00017.jpeg"/></div>
<p class="calibre2"/>
<p class="calibre2">To check end-to-end automation, we will start build definition execution. So, once it is successful, it will trigger a release definition. Save the release definition and click on <span><span>Queue new build...</span></span>.</p>
<p class="calibre2"><span>Queue build for PetClinic-Maven</span> build definition will trigger release definition if it is completed successfully. Click on <span>OK</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone22" src="../images/00154.jpeg"/></div>
<p class="calibre2">Once the build definition has successfully completed, the <span>PetClinic-Release</span> release definition will be triggered. Its job is to deploy the <kbd class="calibre15">.war</kbd> artifact into Azure App Services.</p>
<p class="calibre2">Deployment <span>Failed</span>! Let's find out why this deployment has failed.</p>
<p class="calibre2">Release definition execution has failed. Let's try to troubleshoot the issue:</p>
<div class="CDPAlignCenter"><img class="alignnone19" src="../images/00198.jpeg"/></div>
<p class="calibre2">Verify the <span>History</span> first: we can see that release definition was triggered but deployment has failed:</p>
<p class="calibre2">Let's find out the likely cause of this failure from the logs.</p>
<p class="calibre2">Go to the <span>Logs</span> section and verify the release definition execution steps. It clearly indicates that it is the final deployment operation that has failed:</p>
<p class="calibre2">Click on the failed step, that is <span>Deploy Azure App Service</span>:</p>
<div class="CDPAlignCenter"><img class="alignnone23" src="../images/00158.jpeg"/></div>
<p class="calibre2">After closely examining the logs, we can see that it is mentioned that <kbd class="calibre15">.war</kbd> does not have a <kbd class="calibre15">.zip</kbd> file extension.</p>
<p class="calibre2">Remember, we selected <kbd class="calibre15">petclinic.war</kbd> and not <kbd class="calibre15">petclinic.zip</kbd>, so it is deploying the <kbd class="calibre15">.war</kbd> with this task; we need to have a <kbd class="calibre15">.zip</kbd> file and not a WAR file.</p>
<p class="calibre2">How to solve this?</p>
<p class="calibre2">If we can convert the WAR file into a <span>.zip</span> file, then it can be done and it should happen automatically:</p>
<div class="CDPAlignCenter"><img class="alignnone24" src="../images/00160.jpeg"/></div>
<p class="calibre2">The best way is to use any task that can convert <kbd class="calibre15">.war</kbd> in to a <kbd class="calibre15">.zip</kbd> file. So let's do it.</p>
<ol class="calibre17">
<li value="1" class="calibre11">Click on <span>Add Task</span> and click on the <span>Marketplace</span> link:</li>
</ol>
<div class="CDPAlignCenter"><img class="alignnone25" src="../images/00162.jpeg"/></div>
<p class="calibre29">It will open a new Marketplace window.</p>
<ol start="2" class="calibre17">
<li value="2" class="calibre11">Find <span>Trackyon</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="alignnone25" src="../images/00165.jpeg"/></div>
<p class="calibre29">Before deployment, we will convert the WAR file into a ZIP file using <span>Trackyon</span>. Once that is done, our deployment on Azure Web Apps should work.</p>
<ol start="3" class="calibre17">
<li value="3" class="calibre11">Click on <span>Install:</span></li>
<li value="4" class="calibre11">Select the VSTS account where we want to install <span>Trackyon</span>.</li>
<li value="5" class="calibre11">Click on <span>Continue</span>:</li>
<li value="6" class="calibre11">Click on <span>Proceed to the account</span>.</li>
<li value="7" class="calibre11">Click on <span>Close:</span></li>
</ol>
<div class="CDPAlignCenter"><img class="alignnone19" src="../images/00092.jpeg"/></div>
<p class="calibre29"/>
<p class="calibre29">After installation, our next task is to add that task in the release definition so that, before deployment into Azure Web Apps, the WAR file is converted into a ZIP file.</p>
<ol start="8" class="calibre17">
<li value="8" class="calibre11">Select the <span>Trackyon</span> <span>WAR converter</span> task.</li>
<li value="9" class="calibre11">Click on <span>Close</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="alignnone26" src="../images/00181.jpeg"/></div>
<ol start="10" class="calibre17">
<li value="10" class="calibre11">Select the folder where the WAR file is located:</li>
<li value="11" class="calibre11">Select the folder where the ZIP file should be created:</li>
<li value="12" class="calibre11">Now our release definition has two tasks to perform:</li>
</ol>
<ul class="calibre10">
<li class="calibre11">Convert <kbd class="calibre15">.war</kbd> in to a <kbd class="calibre15">.zip</kbd> file.</li>
<li class="calibre11">Deploy the <kbd class="calibre15">.zip</kbd> file into <span>Azure Web Apps</span>:</li>
</ul>
<div class="CDPAlignCenter"><img class="alignnone11" src="../images/00184.jpeg"/></div>
<ol start="13" class="calibre17">
<li value="13" class="calibre11">Go to the <span>PetClinic-Maven</span> build definition and click on <span>Queue new build...</span></li>
<li value="14" class="calibre11"><span>Build</span> will start when the hosted agent is available.</li>
</ol>
<p class="calibre2">Wait till build execution has completed successfully.</p>
<p class="calibre2">As we have configured our release definition for continuous delivery, the successful build definition execution will trigger our release definition to achieve end-to-end automation.</p>
<p class="calibre2">Note the <span>Build</span> number <span>Build <span>20161230.2</span></span>:</p>
<div class="CDPAlignCenter"><img class="alignnone15" src="../images/00186.jpeg"/></div>
<p class="calibre2">This build will trigger the release definition if completed successfully.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
            

            <article>
                
<p class="calibre2">In this chapter, we have looked at different ways to deploy an application package into a local Tomcat server using Jenkins plugins, into a Docker container, into AWS Elastic Beanstalk, into Microsoft Azure App Services using FTP, and into Microsoft Azure App Services using Visual Studio Team Services.</p>
<p class="calibre2">If we observe the previous automation, it is one of the ways to deploy an application in a web server that is available locally or in the cloud using different ways, such as script, plugin, and VSTS.</p>
<p class="calibre2">Build definition was all about continuous integration, while release definition is all about continuous delivery. Hence, we have covered CI and CD till now, using different tools that are open source and commercial.</p>
<p class="calibre2">In the next chapter, we will cover automated testing (functional and load testing), so that we can consider it as a part of continuous testing.</p>
<p class="calibre2">We will use Selenium and Apache JMeter for functional testing and load testing respectively in a local and a cloud environment.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    </body></html>