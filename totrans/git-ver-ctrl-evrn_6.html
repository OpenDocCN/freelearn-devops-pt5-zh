<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Unleash the Beast – Git on Text-based Files</h1></div></div></div><p>
<em>We have seen two different modes of working with our content managed by Git in earlier chapters, with a gaming analogy calling it the single/solo player mode and multiplayer mode.</em>
</p><p>
<em>Hold on to your seats. This chapter is an answer to your long awaited question: What about the real multiplayer mode with several people playing in parallel? In other words, having multiple people work on the same stuff at the same time.</em>
</p><p>The concepts that we are going to learn about in this chapter are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Merging and</li><li class="listitem" style="list-style-type: disc">Resolving conflicts, making your way through the content in the way you or your team want to</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Git for text-based files – an introduction</h1></div></div></div><p>Git arms itself with <a id="id412" class="indexterm"/> several functionalities when it comes to handling text files. On a higher level let's understand the different file types and what they really mean using the following stack:</p><div><img src="img/7522_06_01.jpg" alt="Git for text-based files – an introduction"/></div><p>Going from the <a id="id413" class="indexterm"/> top to the bottom, it is a layered approach starting with how a user sees a file, how a computer sees it, until its storage at the bottommost layer.</p><div><div><h3 class="title"><a id="note20"/>Note</h3><p>
<strong>Binary data</strong>: Any <a id="id414" class="indexterm"/> file whose contents can be read only through specific programs, such as Microsoft Word for documents and picture viewer for images, is called binary data/values.</p><p>
<strong>Text data</strong>: Any <a id="id415" class="indexterm"/> file, irrespective of its extension or nature, whose content is pure text and can be opened with a normal text editor like notepad or WordPad is considered to contain text data.</p></div></div><p>To quote an example for giving more clarity, open up your <code class="literal">.git</code> directory inside your project, and you will see a file structure as shown in the following screenshot:</p><div><img src="img/7522_06_02.jpg" alt="Git for text-based files – an introduction"/></div><p>Here the file called <a id="id416" class="indexterm"/> 
<strong>index</strong> is considered to contain binary data whereas the files <strong>COMMIT_EDITMSG</strong>, <strong>config</strong>, <strong>description</strong>, and <strong>HEAD</strong> are considered to have textual data. Open them with your text editor and you'll understand why.</p><div><div><h3 class="title"><a id="note21"/>Note</h3><p>Make sure you don't alter anything in those files or else you might end up with a screwed up version of your repository, which might need a few maneuvers to fix, which we are not interested in at the moment.</p></div></div><p>As another example, you can also try opening an image file with a text editor to view its raw content.</p><p>This is the basic difference that we were talking about. Let's talk more about it once we have understood the concept of <strong>branching</strong>
 <a id="id417" class="indexterm"/> and <a id="id418" class="indexterm"/> 
<strong>merging</strong>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Multiplayer mode – multiple players at a time</h1></div></div></div><p>Let's continue our gaming <a id="id419" class="indexterm"/> analogy from earlier chapters to relate to the multiplayer mode concept we have learned so far.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec65"/>Multiple players – one at a time </h2></div></div></div><p>Think of your favorite adventure game that has multiple levels. Consider a scenario where you are stuck in a level without knowing how to proceed forward. After desperate attempts, which ended in vain, you suddenly realize that your friend is an expert on that level, and you want to use your friend's help. So you quickly share the last saved state of the game file with him with which he can finish that level for you, save the state, and push the file back to you, which will enable you to continue the game.</p><p>The same situation can apply to you when you are working with data files, especially when you are working as a team where different people take care of different parts of a bigger task to produce a single result. Another possibility might be that you want the domain experts to handle specific portions of the work, and so on.</p><p>This also means <a id="id420" class="indexterm"/> that having multiple people working on the same document one topic at a time, where one passes the file to another to get the work done in a sequence, might go smoothly, but having multiple people working on the same file on the same topic might end up in chaos when it comes to files containing binary data.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec66"/>Multiple players – all hands on deck (many at a time)</h2></div></div></div><p>I'm a big fan of <a id="id421" class="indexterm"/> <strong>first person shooter</strong> (<strong>FPS</strong>) games. <em>Counter-Strike</em> stays at the top of my list even today. Let's take <em>Counter-Strike</em> or any other team game for comparison here. Each team member will be a specialist in not only one but two or three weapons to adapt to situations. And when required, they pitch in to take out the opponent together and complete the objective.</p><p>Similarly, when you deal with textual data in files, you can have multiple people collaboratively working on the same file, topic, and line, and manage to produce a unified output with Git. Let's learn how to put this feature to better use.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec09"/>Sharing your repository</h3></div></div></div><p>There are two <a id="id422" class="indexterm"/> commonly <a id="id423" class="indexterm"/> used modes to share your repository with others.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Intranet</li><li class="listitem" style="list-style-type: disc">Internet</li></ul></div><p>Having got used to the way of sharing over the Internet using Bitbucket, this time let's emulate sharing over the intranet using the bare repository concepts we learned in <a class="link" href="ch04.html" title="Chapter 4. Split the Load – Distributed Working with Git">Chapter 4</a>, <em>Split the Load – Distributed Working with Git</em>.</p><div><div><h3 class="title"><a id="note22"/>Note</h3><p>If you are not able to recall, I suggest you go through the <em>Staying local – share over intranet</em> topic in <a class="link" href="ch04.html" title="Chapter 4. Split the Load – Distributed Working with Git">Chapter 4</a>, <em>Split the Load – Distributed Working with Git</em> to understand what the bare repository is, why we need one, and how it operates.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Time for action – getting ready to share</h1></div></div></div><p>To keep things clear and simple we shall start with a fresh instance with minimal data, so that the changes are evident.</p><div><ol class="orderedlist arabic"><li class="listitem">Let's create a <a id="id424" class="indexterm"/> new <a id="id425" class="indexterm"/> directory and call it <code class="literal">collab_source</code>.</li><li class="listitem">Within the directory create a new text file called <code class="literal">mycontent.txt</code>.</li><li class="listitem">Open up the text file that you just created, and enter the following:<div><pre class="programlisting">
<strong>Unchanged first line from source</strong>
<strong>Second line</strong>
<strong>Third line</strong>
</pre></div></li><li class="listitem">Save and close the file.</li><li class="listitem">Now make the <code class="literal">collab_source</code> directory a Git repository; then add the file <code class="literal">mycontent.txt</code> and make a commit with a commit message saying "Base commit from source".</li><li class="listitem">Now this copy will reside in your machine for your own manipulation. Let's create a bare repository from your copy to put it in a common place from where your team members can clone it to have their own copy of the files.</li><li class="listitem">For creating a bare clone of your existing repository, use the following command:<div><pre class="programlisting">
<strong>git clone --bare /your/path/to/collab_source /your/path/to/bare_collab</strong>
</pre></div></li></ol></div><div><div><h3 class="title"><a id="note23"/>Note</h3><p>For this example, to convey the concept I have cloned the <code class="literal">bare_collab</code> repository in my local system itself instead of a common network share directory. But the procedures are one and the same.</p><p>The main aim of this topic is to convey the multiuser concept so I have chosen only one mode (CLI) of execution. Mostly the GUI equivalent of these commands is already known to you. In case of an exception a quick note on the GUI options is provided.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec67"/>
<em>What just happened?</em>
</h2></div></div></div><p>We have created a source repository with our content and then cloned a bare repository out of our source repository, which in turn has opened up the clone option for our team members. If you have followed the preceding steps, you should see a structure like the one shown in the following figure:</p><div><img src="img/7522_06_03.jpg" alt="What just happened?"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Time for action – distributed work force</h1></div></div></div><p>Now to get their own <a id="id426" class="indexterm"/> 
 <a id="id427" class="indexterm"/> copy of the files, Bob and Lisa, our fictitious team members, can execute the usual <code class="literal">git clone</code> command <a id="id428" class="indexterm"/> with the source as the <code class="literal">bare_collab</code> repository and the destination as their preferred location.</p><div><pre class="programlisting">
<strong>git clone /path/to/repository/bare_collab /path/of/local/copy/Bob_collab</strong>
<strong>git clone /path/to/repository/bare_collab /path/of/local/copy/Lisa_collab</strong>
</pre></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec68"/>
<em>What just happened?</em>
</h2></div></div></div><p>Unless Git reported an error, <a id="id429" class="indexterm"/> 
 <a id="id430" class="indexterm"/> Bob and Lisa have cloned the files from our bare repository named <code class="literal">bare_collab</code>. Now, the structure of how these repositories evolved is shown in the following figure:</p><div><img src="img/7522OS_06_04.jpg" alt="What just happened?"/></div><p>And how the commit tree looks like is shown in the following figure:</p><div><img src="img/7522OS_06_05.jpg" alt="What just happened?"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec65"/>Time for action – Bob's changes</h1></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Now Bob <a id="id431" class="indexterm"/> feels that he needs to change the content of the file. So he opens and changes the first line's text to "First line from source - Changed by Bob" so that the content of the file looks like the following lines:<div><pre class="programlisting">
<strong>First line from source - Changed by Bob</strong>
<strong>Second line</strong>
<strong>Third line</strong>
</pre></div></li><li class="listitem">Then he adds the change and commits the same as shown in the following screenshot:<div><img src="img/7522_06_06.jpg" alt="Time for action – Bob's changes"/></div></li><li class="listitem">In the interest <a id="id432" class="indexterm"/> of sharing the change with team members, he wants to push his changes to the common bare repository but as a rule of thumb, when working with multiple people on Git, pull before pushing so as to incorporate the changes first in case somebody has already pushed before you. Bob does a <code class="literal">git pull</code> <em>first</em> and <em>then</em> a <code class="literal">git push</code> as shown in the following screenshot:<div><img src="img/7522_06_07.jpg" alt="Time for action – Bob's changes"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec69"/>
<em>What just happened?</em>
</h2></div></div></div><p>Because of this push <a id="id433" class="indexterm"/> operation, the bare repository has progressed its level along with Bob's changes whereas the repository at our machine (<code class="literal">collab_source</code>) and Lisa's are still behind. Now the commit tree looks like the following:</p><div><img src="img/7522OS_06_08.jpg" alt="What just happened?"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec66"/>Time for action – Lisa's changes</h1></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">While Bob was <a id="id434" class="indexterm"/> doing all these operations, Lisa made her own changes. She also happened to change the first line of the file and appended one more line to it, which made the content of the file look like the following:<div><pre class="programlisting">
<strong>Unchanged first line from source = Not any more ;)  - Lisa</strong>
<strong>Second line</strong>
<strong>Third line</strong>
<strong>Fourth line by Lisa</strong>
</pre></div></li><li class="listitem">Then she adds the change and commits the same as shown in the following screenshot:<div><img src="img/7522_06_09.jpg" alt="Time for action – Lisa's changes"/></div></li><li class="listitem">In the interest of <a id="id435" class="indexterm"/> sharing the change with team members, Lisa wants to push her changes to the common bare repository, but as the rule of the thumb, when working with multiple people, do a pull before pushing so as to incorporate the changes first in case somebody has already pushed before you. She does a <code class="literal">git pull</code> <em>first</em>, which gives her the following error message:<div><img src="img/7522_06_10.jpg" alt="Time for action – Lisa's changes"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec70"/>
<em>What just happened?</em>
</h2></div></div></div><p>Lisa made changes, added, <a id="id436" class="indexterm"/> committed, and when she tried to pull from the central <code class="literal">bare_collab</code> repository, got bumped into a merge conflict.</p><p>If you focus on the last three lines, it would be evident why the pull got stopped. Git automatically tried to merge the changes Lisa made with the changes already pushed by Bob in the file <code class="literal">mycontent.txt</code>. Because both have changed the first line, Git smartly stops the merging and asks us to fix the conflicts.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec67"/>Time for action – Lisa examines the merge conflict</h1></div></div></div><p>Lisa opens up the file to see the <a id="id437" class="indexterm"/> conflict that is stopping her and finds a pattern as follows:</p><div><pre class="programlisting">
<strong>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</strong>
<strong>Unchanged first line from source = Not any more ;)  - Lisa</strong>
<strong>=======</strong>
<strong>First line from source - Changed by Bob</strong>
<strong>&gt;&gt;&gt;&gt;&gt;&gt;&gt; 9bab0336e6c9ab984b538f1f7724bf8a9703f55e</strong>
<strong>Second line</strong>
<strong>Third line</strong>
<strong>Fourth line by Lisa</strong>
</pre></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec71"/>
<em>What just happened?</em>
</h2></div></div></div><p>The first line, which has continuous left arrows with the word <code class="literal">HEAD</code> is nothing but Lisa's current position in the repository. The next line shows the changes made by her to the file.</p><p>This is followed by continuous <code class="literal">=</code> signs, which marks the end of Lisa's content and beginning of Bob's content. It's a separator, which is immediately followed by Bob's content in the next line, which is <a id="id438" class="indexterm"/> then followed by the commit ID generated when Bob made that change.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec68"/>Time for action – Lisa resolves the merge conflict</h1></div></div></div><p>Perform the following <a id="id439" class="indexterm"/> steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Resolving the conflict is a very simple procedure. You are given four choices.<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Specify an order and have both the changes (which in our case are Lisa's and Bob's changes)</li><li class="listitem" style="list-style-type: disc">Delete the existing change and impose yours</li><li class="listitem" style="list-style-type: disc">Delete your change and apply the change fetched</li><li class="listitem" style="list-style-type: disc">Delete both</li></ul></div><p>However, the fourth option is very unlikely to happen.</p><div><div><h3 class="title"><a id="note24"/>Note</h3><p>To perform any of these operations on the content, one can use a common text editor or an interactive merge tool, which will give you three views (local, base, and remote) using which you need to solve your commits.</p><p>
<strong>Local view</strong> <a id="id440" class="indexterm"/> is the current modified version, <strong>base</strong>
 <a id="id441" class="indexterm"/> is our earlier version before modification, which gets decided by Git automatically, and <strong>remote</strong>
 <a id="id442" class="indexterm"/> is the modified remote version, which we are trying to fetch and merge. You need to move and order your changes along with the remote version using the arrows and indicators available. A screenshot of how an interactive merge tool (I have showcased<strong> meld</strong>, which is a python based utility) looks as follows:</p></div></div><div><img src="img/7522_06_11.jpg" alt="Time for action – Lisa resolves the merge conflict"/></div><div><div><h3 class="title"><a id="note25"/>Note</h3><p>We will use a normal text editor to solve this situation now, so as to understand the underlying concept.</p></div></div><p>Lisa is <a id="id443" class="indexterm"/> going to go with the first option of ordering and incorporating both the changes; let's see how she does it.</p></li><li class="listitem">Lisa feels that having Bob's changes up the order is better followed by hers. After deciding the order, she opens the file using an ordinary text editor and changes the content as follows:<div><pre class="programlisting">
<strong>First line from source - Changed by Bob</strong>
<strong>Unchanged first line from source = Not any more ;)  - Lisa</strong>
<strong>Second line</strong>
<strong>Third line</strong>
<strong>Fourth line by Lisa</strong>
</pre></div><p>After making the previously mentioned changes, she <em>adds</em> the change and <em>commits</em> it with the message "Merge - Posted Bob's change to the top followed by mine" as shown in the following screenshot:</p><div><img src="img/7522_06_12.jpg" alt="Time for action – Lisa resolves the merge conflict"/></div></li><li class="listitem">Following this, Lisa <a id="id444" class="indexterm"/> pushes her commits to our central bare repository (<code class="literal">bare_collab</code>) with the usual <code class="literal">push</code> command, as shown in the following screenshot:<div><img src="img/7522_06_13.jpg" alt="Time for action – Lisa resolves the merge conflict"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec72"/>
<em>What just happened?</em>
</h2></div></div></div><p>Lisa has successfully <a id="id445" class="indexterm"/> resolved the conflicts and made her changes available to other members of the team by pushing the changes to the central bare repository.</p><p>This should give a commit tree structure as shown in the following flow diagram:</p><div><img src="img/7522OS_06_14.jpg" alt="What just happened?"/></div><p>As you can see from the diagram, C3 (the local commit made by Lisa) and C2 (the commit made and shared by Bob) are being merged to form a new commit called merge commit C4.</p><p>At any given point <a id="id446" class="indexterm"/> of time you can get such graphical representations both from the GUI as well as CLI mode.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec10"/>GUI mode – get the repository's history graph</h3></div></div></div><p>Select <strong>Visualize all branch history</strong> form the <strong>Repository</strong> menu of Git Gui. Once Gitk opens, at the top left you have your <a id="id447" class="indexterm"/> repository's history visualization. Lisa's visualization is as shown in the following screenshot:</p><div><img src="img/7522_06_15.jpg" alt="GUI mode – get the repository's history graph"/></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec11"/>CLI mode – get the repository's history graph</h3></div></div></div><p>In your terminal/console, switch to the <a id="id448" class="indexterm"/> Git repository's location and then use the following command to get a tree representation of its history:</p><div><pre class="programlisting">
<strong>git log --graph</strong>
</pre></div><p>You will see a representation as shown in the following screenshot:</p><div><img src="img/7522_06_16.jpg" alt="CLI mode – get the repository's history graph"/></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec69"/>Time for action – team members get sync with the central bare repo</h1></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Bob feels it's been a <a id="id449" class="indexterm"/> while since he received updates from the bare repos so he pulls to get the latest changes, with the results being as follows:<div><img src="img/7522_06_17.jpg" alt="Time for action – team members get sync with the central bare repo"/></div></li><li class="listitem">Well, finally <a id="id450" class="indexterm"/> let's not forget the source repository, mother of all these repositories, for the update. Before doing a <code class="literal">git pull</code> <a id="id451" class="indexterm"/> from there we should point to the origin as the bare repository, and then perform a pull operation. The commands are as follows:<div><pre class="programlisting">
<strong>git remote add origin /path/to/bare_collab</strong>
<strong>git pull –u origin master</strong>
</pre></div><p>This gives us an output as shown in the following screenshot:</p><div><img src="img/7522_06_18.jpg" alt="Time for action – team members get sync with the central bare repo"/></div></li></ol></div><p>As we have learned in <em>Time for action – adding a remote origin</em> in <a class="link" href="ch04.html" title="Chapter 4. Split the Load – Distributed Working with Git">Chapter 4</a>, <em>Split the Load – Distributed Working with GIT</em>, adding a remote would be a one time operation.</p><p>We can manually open the file or do a <code class="literal">git log</code> to see the changes taking effect across repositories.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec73"/>
<em>What just happened?</em>
</h2></div></div></div><p>We have <a id="id452" class="indexterm"/> successfully synced the changes across different repositories made by different people on the same file, and the same line at the same time thereby achieving the promised collaborative work environment.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec70"/>Summary</h1></div></div></div><p>We have learned:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The difference between files' content</li><li class="listitem" style="list-style-type: disc">How powerful Git can be on textual files</li></ul></div><p>Additionally, we have also learned how to merge and manage conflicts occurring while merging.</p><p>Not only that, we did a role play and practically learned how to set up a collaborative work environment with multiple people working on the same file, topic, and even the same line. We also learned how to integrate work from different people together to form one output.</p></div></body></html>