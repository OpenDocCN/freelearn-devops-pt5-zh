<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Writing Your First Android Application with Xamarin</h1>
                </header>
            
            <article>
                
<p>Now that Visual Studio is installed on your Windows machine to start development, and the <strong>Android Virtual Device</strong> (<strong>AVD</strong>) is ready, we can get started with our first Android application.</p>
<p>In this chapter, we are going to build our first Android application using Xamarin in Visual Studio, while learning some fundamentals of Android application development.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Create your first Android project</h1>
                </header>
            
            <article>
                
<p>To create a new Android project in Visual Studio, follow these steps:</p>
<ol>
<li>Click on <span class="packt_screen">File</span> | <span class="packt_screen">New</span> | <span class="packt_screen">Project</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c3540c2c-8a09-4416-a758-4e13256dfd54.png"/></div>
<ol start="2">
<li>From the left pane, click on <span class="packt_screen">Android</span> and then select <span class="packt_screen">Blank App (Android)</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/fa3f306f-bacf-4960-9230-53d1ee62706b.png"/></div>
<ol start="3">
<li>In the <span class="packt_screen">Name</span> section, give a name to the project, select a preferred location for your project, and click on the <span class="packt_screen">OK</span> button. You'll get the screen shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/22796db1-aabe-46ca-87d3-8443eb399fef.png"/></div>
<p>Congratulations, you've created your first Android project in Visual Studio.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Xamarin solution structure</h1>
                </header>
            
            <article>
                
<p>Once the project is created, you'll see the solution structure shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/90bb4fbe-52fe-47ae-8f68-32437fd509b2.png" style=""/></div>
<p>The main parts of the solution that we need to understand for now are as follows:</p>
<ul>
<li><strong>References</strong>: This section lists all the required libraries for the project. As we can see in the preceding screenshot, it references <kbd>Mono.Android</kbd>, which is the library for <kbd>Xamarin.Android</kbd>.</li>
<li><strong>Resources</strong>: It contains all the resources, for example, images, layouts, and much more.</li>
<li>The <kbd>MainActivity.cs</kbd> file has our C# code for handling events and other things in our main screen.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the UI for the application</h1>
                </header>
            
            <article>
                
<ol>
<li>Let's expand the <kbd>Resources</kbd> folder we saw in the previous screenshot, and then the <kbd>layout</kbd> folder in <span class="packt_screen">Solution Explorer</span>. Double-click on <kbd>Main.axml</kbd> to open it. This is the layout file for the app's screen. By default, it gets opened in Android Designer; you can also click on the <span class="packt_screen">Source</span> tab at the bottom to see the XML code for it. This layout file is the main UI file that we'll add our UI controls to, and what we'll see when we run our app once it is finished:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/5211f296-5d3d-4f29-8993-819ca85cea24.png" style=""/></div>
<p style="padding-left: 60px">Let's add an input field to enter a phone number. Drag the <span class="packt_screen">Phone</span> field from the <span class="packt_screen">Toolbox</span> (left pane) into the <span class="packt_screen">Designer</span> view of the <kbd>Main.axml</kbd> file:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/396daaba-43c0-49b8-9b2a-aacc9621437b.png"/></div>
<p style="padding-left: 60px">Having the phone text field gives us the advantage of restricting the user to entering a phone number. Also, when the user taps on the input box, they'll only get a number pad instead of a full text keyboard.</p>
<p style="padding-left: 60px">Now we have added an input for the user to add a phone number in order to make a call.</p>
<p style="padding-left: 60px">In order to recognize this field from the C# code and get a value inserted, we need to give it a unique ID.</p>
<ol start="2">
<li>With the phone text field selected on the design surface, use the <span class="packt_screen">Properties</span> pane on the right side to change the <span class="packt_screen">id</span> property of the <span class="packt_screen">Phone</span> input field to <span class="packt_screen">@+id/PhoneNumber</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0ce4d81c-d39d-41ca-b55a-09f3b5084af9.png" style=""/></div>
<p style="padding-left: 60px">Now that we have added the input field so the user can enter their phone number, we need a button to take the action to make a call.</p>
<ol start="3">
<li>Drag a <span class="packt_screen">Button</span> from <span class="packt_screen">Form Widgets</span> in the left pane of the <span class="packt_screen">Toolbox</span> to the <span class="packt_screen">Designer</span> view of <kbd>Main.axml</kbd>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/636422bb-e839-4703-a813-c61972e670d8.png" style=""/></div>
<p style="padding-left: 60px">Similar to the input field, we need to give a unique ID to the button so that our C# code can recognize when the button is clicked and we can take the appropriate action; that is, make a call to the number inserted by the user.</p>
<p style="padding-left: 60px">Also, the text on the button should say <kbd>Do you want to call</kbd>, right? So, let's make that change as well in the next step.</p>
<ol start="4">
<li>Select <span class="packt_screen">Button</span> in the <span class="packt_screen">Designer</span>, go to the <span class="packt_screen">Properties</span> window on the right, scroll down, and change the ID to <span class="packt_screen">@+id/CallButton</span> and the text to <span class="packt_screen">CALL</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/230814f4-911a-44c3-936b-2672d8973b46.png"/></div>
<p style="padding-left: 60px">Now, a basic UI is ready for our app with a proper ID assigned to the respective fields and button.</p>
<p style="padding-left: 60px">It is now time to move to our C# code and connect our UI with some backend code to perform some actions.</p>
<p>When a user opens the application, <kbd>MainActivity</kbd> is opened and the <kbd>Main.axml</kbd> file is associated with it.</p>
<p>We will learn more about Activities later; for now, let's write code to handle interactions in <kbd>MainActivity</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Handling user interactions</h1>
                </header>
            
            <article>
                
<p>User interaction is the most important aspect of developing a mobile application. A mobile app should be interactive and easy to use.</p>
<p>In this basic application, we will be writing our user interaction code in C# and it will be part of the <kbd>MainActivity.cs</kbd> file:</p>
<ol>
<li>Let's click on the <kbd>MainActivity.cs</kbd> file from the <span class="packt_screen">Solution Explorer</span> on the left and open it:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8257be22-e764-4664-8408-13eead70d835.png" style=""/></div>
<p style="padding-left: 60px">It has some autogenerated code that we are going to modify in order to make our application work.</p>
<ol start="2">
<li>We need to write our code inside the <kbd>OnCreate()</kbd> method of the <kbd>MainActivity.cs</kbd> file:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0e972491-63ba-4274-a873-d5bc82e2f989.png"/></div>
<p style="padding-left: 60px">Before we start writing user interaction code, let's understand the autogenerated code first:</p>
<pre class="mce-root" style="padding-left: 60px"><span>base.OnCreate(savedInstanceState); </span></pre>
<p style="padding-left: 60px">This piece of code calls the <kbd>OnCreate()</kbd> method of the parent/base class of <kbd>MainActivity.cs</kbd>, which is <kbd>Activity.cs</kbd>.</p>
<pre style="padding-left: 60px">SetContentView(Resource.Layout.Main); </pre>
<p style="padding-left: 60px">As the comments already say, it sets the view from our layout resource file, <kbd>Main.axml</kbd>.</p>
<p style="padding-left: 60px">We need to write our <kbd>SetContentView(Resource.Layout.Mai)</kbd> code.</p>
<ol start="3">
<li>First, get a reference to the controls that were created in the <kbd>layout</kbd> file via Android Designer, that is, the input box for the phone number and the button to make a call.</li>
</ol>
<p style="padding-left: 60px">Add the following code inside the <kbd>OnCreate()</kbd> method:</p>
<pre style="padding-left: 60px">EditText phoneNumberInput = FindViewById&lt;EditText&gt;(Resource.Id.PhoneNumber);         Button callButton = FindViewById&lt;Button&gt;(Resource.Id.CallButton); </pre>
<ol start="4">
<li>Now that we have a reference to the controls, we can write events to perform an action on the <span class="packt_screen">CALL</span> button click. Let's write an event for the <span class="packt_screen">CALL</span> button click:
<ol>
<li>Type <kbd>callButton.Click +=</kbd> (IntelliSense will give you a suggestion to hit <em>Tab</em>).</li>
<li>Hit the <em>Tab</em> key to autocomplete.</li>
<li>This will create a method named <kbd>CallButton_Click</kbd>.</li>
<li>We'll be using this newly created method to write our code for the button click as follows:</li>
</ol>
</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/45df2f40-2c27-46d7-a5fd-0f5cbd86c921.png"/></div>
<ol start="5">
<li>Because we are writing our <kbd>Click</kbd> event in a separate method, let's declare the button and input the field variables that we used earlier in a global scope, where all the methods of the class can have access to their reference. Declare the following variables on the class level:
<ul>
<li><kbd>EditText phoneNumberInput;</kbd></li>
<li><kbd>Button callButton;</kbd></li>
</ul>
</li>
</ol>
<ol start="6">
<li>The <kbd>OnCreate()</kbd> method should now look as shown in following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/155645d4-85f3-4ef3-955d-d08704f69f9a.png"/></div>
<ol>
<li style="list-style-type: none">
<ol>
<li>In the <kbd>CallButton_Click</kbd>, we get the value inserted in the input field by the user:</li>
</ol>
</li>
</ol>
<pre style="padding-left: 150px">var phoneNumber = phoneNumberInput.Text; </pre>
<ol>
<li style="list-style-type: none">
<ol start="2">
<li>Next, we create an alert dialog box to ask for the user's confirmation before making the actual call. To make that dialog box, write the following code:</li>
</ol>
</li>
</ol>
<pre style="padding-left: 150px">var callDialog = new AlertDialog.Builder(this); </pre>
<ol>
<li style="list-style-type: none">
<ol start="3">
<li>We need to set two things in this dialog box:
<ol>
<li>Message to show the user:</li>
</ol>
</li>
</ol>
</li>
</ol>
<pre style="padding-left: 210px">callDialog.SetMessage("Do you want to call " + phoneNumber + "?");</pre>
<ol>
<li style="list-style-type: none">
<ol>
<li style="list-style-type: none">
<ol start="2">
<li>Events for the <span class="packt_screen">OK</span> and <span class="packt_screen">Cancel</span> buttons of the dialog box:</li>
</ol>
</li>
</ol>
</li>
</ol>
<pre style="padding-left: 210px">callDialog.SetMessage("Do you want to call " + phoneNumber + "?"); callDialog.SetNeutralButton("Call", delegate {<br/>var callIntent = new Intent(Intent.ActionCall);<br/>callIntent.SetData(Android.Net.Uri.Parse("tel:" + phoneNumber));<br/>StartActivity(callIntent);<br/>});<br/>callDialog.SetNegativeButton("Cancel", delegate { });</pre>
<ol>
<li style="list-style-type: none">
<ol start="4">
<li>Make some more changes to make the code look like the following screenshot:</li>
</ol>
</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/1edddd6f-4bc7-449d-9a3f-0362c7c7a605.png"/></div>
<ol start="7">
<li>The code to handle user interaction is now complete; let's select the emulator from the top and run the application:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7df4aa5a-98ce-4d2a-a4f5-5a70dc3b6d88.png"/></div>
<p style="padding-left: 60px">Running the project and deploying it on the emulator for the first time might take some time; be patient and let it complete the deployment.</p>
<ol start="8">
<li>Once the application is deployed, you should be able to see the application running on the emulator:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/49c7989b-2e32-4fed-99a8-dc28f069e367.png" style=""/></div>
<p style="padding-left: 60px">As we can see in the preceding screenshot, the UI is what we created in the <kbd>Main.axml</kbd> layout file.</p>
<p style="padding-left: 60px">Let's test the code we wrote to handle user interactions.</p>
<ol start="9">
<li>Click on the <span class="packt_screen">CALL</span> button without giving any number as input:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/ac0c0da2-f3f9-4127-8185-4eeb692152f9.png" style=""/></div>
<p style="padding-left: 60px">We'll get a <kbd>toast</kbd>, as shown in the preceding screenshot, because we wrote a condition to check for empty or whitespace input in the input number field.</p>
<p style="padding-left: 60px">And for no input is provided, we wrote the following code to show a <kbd>toast</kbd>:</p>
<pre style="padding-left: 60px">var toast = Toast.MakeText(this, "Please provide number", new ToastLength());<br/>toast.Show();</pre>
<ol start="10">
<li>Let's enter a phone number in the text input field and then press <span class="packt_screen">CALL</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/07f316b9-fa09-43b8-b277-0bc11f8c64a0.png" style=""/></div>
<p style="padding-left: 60px">As per our code, we should get a dialog box with a message saying <span class="packt_screen">Do you want to call 9980020860?</span>.</p>
<ol start="11">
<li>Clicking on <span class="packt_screen">Cancel</span> should just close the dialog box. Let's click on <span class="packt_screen">CALL</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/977ed25d-1343-4ebb-a2f7-7d59ee282689.png" style=""/></div>
<p style="padding-left: 60px">If everything goes fine, a call should be made to the preceding number. But that's not what'll happen once we click on the <span class="packt_screen">CALL</span> button.</p>
<ol start="12">
<li>A <kbd>java.Lang.SecurityException</kbd> will be thrown:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/09e08dba-01bf-4d17-b51d-85a7a2ce125b.png"/></div>
<p>The reason why we got this exception is that the Android application requires permissions to do certain operations and tasks.</p>
<p>These permissions should be listed in the Android application code so that the system knows all the permissions the application requires before installing it.</p>
<p>These permissions are listed for the user while installing; if the user allows such permissions for the application, then only the app can perform these operations. So, the next thing we need to do is add permissions to our Android application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding permissions to Android Manifest</h1>
                </header>
            
            <article>
                
<p>Our application needs only one permission as of now, and that is to place a call. To modify or add permissions for the application, we need to edit <span class="packt_screen">Android Manifest</span>.</p>
<ol>
<li>To edit <span class="packt_screen">Android Manifest</span> and give the permission, follow these steps:
<ol>
<li>Open <span class="packt_screen">Solution Explorer</span>.</li>
<li>Double-click on <span class="packt_screen">Properties</span> under the project.</li>
<li>This should open a UI to edit project properties.</li>
<li>Now, from the left-hand menu, click on <span class="packt_screen">Android Manifest</span> to open it:</li>
</ol>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2f5b6f98-ada8-4e93-bb17-d58760f1ef20.png"/></div>
<ol start="2">
<li>In the <span class="packt_screen">Required</span> <span class="packt_screen">permissions</span> section, scroll down, find the <span class="packt_screen">CALL_PHONE</span> permissions, and select this option:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/e6a9b1f3-4ded-4cdb-9176-b92852e71e4b.png"/></div>
<ol start="2">
<li style="list-style-type: none">
<ol>
<li>Press <em>Ctrl</em> + <em>Shift</em> + <em>S</em> to save all the changes to the project.</li>
<li>Close the <span class="packt_screen">Properties</span> window.</li>
<li>We are done adding permissions to the application.</li>
<li>We need to build the solution now, so the resulting installation file has all the changes we made.</li>
</ol>
</li>
</ol>
<ol start="3">
<li>Rebuild the project; right-click on <span class="packt_screen">Solution</span> | <span class="packt_screen">Rebuild Solution</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cdce0481-7150-4e28-aad5-a062ea62d158.png" style=""/></div>
<ol start="4">
<li>If everything is fine, we should be able to see in the output window that the rebuild succeeded; if you get errors, go back to the previous steps, compare the code, and rebuild:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/12dcf056-ffd6-43ec-a3da-5a298074871b.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding an icon for the Android app</h1>
                </header>
            
            <article>
                
<p>App permissions are set and it's ready to run, so let's add an icon for our app:</p>
<ol>
<li>Download an icon file that you like and that best suits your phone call app.</li>
<li>Go to <span class="packt_screen">Solution Explorer</span> and add the downloaded file to the <kbd>drawable</kbd> folder under <kbd>Resources</kbd>.</li>
</ol>
<ol start="3">
<li>Right-click on <kbd>drawable</kbd> | <span class="packt_screen">Add</span> | <span class="packt_screen">Existing Item</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f59dfea4-f3e8-44f4-ad7f-14c1ef34d3ef.png" style=""/></div>
<ol start="4">
<li>A File Explorer window will open. Navigate to the icon file location, select the icon file, and click <span class="packt_screen">Add</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/5d4770d0-ed59-4784-a98d-4267ac7b284a.png"/></div>
<ol start="5">
<li>The icon should now be added to the <kbd>drawable</kbd> folder of the project:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/bba4682a-e2d7-4401-bc52-b402ee87921c.png"/></div>
<ol start="6">
<li>Rename the icon file to <kbd>icon.png</kbd> by right-clicking on the file and then clicking <span class="packt_screen">Rename</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/2bec0c66-ee1d-477c-a10d-3777160bf423.png" style=""/></div>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/982611e4-4bc7-4c06-82c7-f048e4714a4e.png" style=""/></div>
<ol start="7">
<li>After renaming the file, rebuild the project like we did in the previous steps.</li>
<li>Once the rebuild is done successfully, let's add the icon to the application's Manifest file.</li>
<li>Double-click on <span class="packt_screen">Properties</span> from <span class="packt_screen">Solution Explorer</span> and open <span class="packt_screen">Android Manifest</span>.</li>
<li>Choose <span class="packt_screen">@drawable/icon</span> from the <span class="packt_screen">Application Icon</span> drop-down menu:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/0030ef87-6499-4756-8fda-e0aaf065f6ad.png" style=""/></div>
<ol start="11">
<li>Do <em>Ctrl</em> + <em>Shift</em> + <em>S</em> to save all and rebuild the solution to make sure everything works fine.</li>
<li>Now, let's run the application in the emulator.</li>
<li>If we go to the app drawer and scroll down to the app name, we can see the app icon we just added now showing there:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/ac4ddc9f-e22a-449c-8025-07d3ea0450eb.png" style=""/></div>
<ol start="14">
<li>Congratulations, you've successfully added an icon for the new Android application.</li>
<li>Now that we have added the permissions and icon to the Manifest, it is time to test the main functionality of our app, <em>making a call</em>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Testing user interaction</h1>
                </header>
            
            <article>
                
<p>Click on the app on <span class="packt_screen">Android Emulator</span> and run it. Repeat the previous steps of testing the application and at the end press the <span class="packt_screen">CALL</span> button to make a call:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/ceb7dd82-575a-48af-9a0f-c06073eb7b20.png" style=""/></div>
<p>This time, the application has the required permission, we have written the code to handle CALL button interaction, and we are creating a <kbd>callIntent</kbd> in <kbd>MainActivity.cs</kbd> to make a call.</p>
<p>So, the call should be placed by clicking the <span class="packt_screen">CALL</span> button, and we should get a screen as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/db810003-faa4-4bbe-bb43-b0e84a9c6ba5.png" style=""/></div>
<p>Awesome! You just created your first working Android application using Xamarin and C# in Visual Studio.</p>
<p>Now that we have done the difficult part, let's understand some fundamentals of the Android application we just developed and see how it all comes together.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Application fundamentals</h1>
                </header>
            
            <article>
                
<p>There are many topics that can be covered while explaining Android application fundamentals. But for the scope of this book we'll try to understand the most important ones that we used in the development of our <strong>PhoneCallApp</strong>:</p>
<ul>
<li><strong>Android APIs</strong>: Android has different API levels for different versions of Android. These API levels basically state which version of Android libraries our code uses and which versions of the Android OS our app is compatible with.</li>
</ul>
<p style="padding-left: 60px">There are different configurations to be specified while developing an Android application. These configurations include:</p>
<ul>
<li style="list-style-type: none">
<ul>
<li>Target framework</li>
<li>Minimum Android version</li>
<li>Target Android version</li>
</ul>
</li>
</ul>
<p style="padding-left: 60px">You'll read about these configurations in more detail.</p>
<ul>
<li style="color: black;font-size: 1em"><strong>Resources</strong>: Resources encapsulate many features used in Android to make a better Android application. An Android application uses many resources, such as:
<ul>
<li style="color: black;font-size: 1em">The icon we used</li>
<li style="color: black;font-size: 1em">The layout file that makes the UI for the user</li>
<li style="color: black;font-size: 1em">String files to store strings for application localization/internationalization, and much more</li>
</ul>
</li>
<li style="color: black;font-size: 1em"><strong>Activities</strong>: Activities are the main building block of applications in Android. Every UI element and its interactions are connected to an activity. Whenever we click on a button and open a new page, a new activity is called and control gets transferred.</li>
</ul>
<p style="padding-left: 60px">An activity in Android can have different states, based on the current operation being performed. We'll learn more about Activities in detail in future topics.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Android APIs</h1>
                </header>
            
            <article>
                
<p>Android APIs are known by an API level, for example, API level 23.</p>
<p>An API level represents a specific Android release. If you open Android SDK Manager in Visual Studio, you will see the following screen:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/9b0bf0bb-4b86-4ebc-a2d9-db10694acd52.png" style=""/></div>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/07517709-8871-44ef-b86c-83959cf6a136.png" style=""/></div>
<p>Each API level is specific to an Android release. An Android release is known by multiple names:</p>
<ul>
<li>The API level, such as API level 23</li>
<li>The Android version, such as Android 6.0</li>
<li>A code name, such as Marshmallow</li>
</ul>
<p>So, we can say that APIs have an integer value, a number to identify the release, because with each release this API level changes, and users upgrade their Android versions as they get released.</p>
<p>An Android app should be able to run on different APIs and should be compatible with previous versions of releases, so that old devices can run applications as well, and when a user updates their OS version to a new one, existing apps don't break on their phones.</p>
<p>To support multiple API levels, the Android project property has configurations to define:</p>
<ul>
<li><strong>Target Framework</strong>: This setting can be found in the <span class="packt_screen">Application</span> menu inside <span class="packt_screen">Properties</span>. This tells <kbd>Xamarin.Android</kbd> to compile the project using specific API-level libraries. While compiling/building the application, <kbd>Xamarin.Android</kbd> uses the API level specified in this setting to load the libraries and build the application:</li>
</ul>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/64ff8484-d613-488a-9400-4dbc0b47d409.png"/></div>
<ul>
<li><strong>Minimum Android version/API level</strong>: This is the minimum Android version that the application can run on; this tells the Android system if the app is supported on the specific OS version. Specifying a lower minimum version means your application can be installed on all the versions between the minimum and target specified. But be careful, because even if the application compiles and gets installed on a lower version of Android, it does not necessarily mean it will run successfully as well.</li>
</ul>
<p style="padding-left: 60px">There might be some higher-level APIs that your application is using which cannot be run on an older version. This setting can be found under <span class="packt_screen">Android Manifest</span> inside <span class="packt_screen">Properties</span>:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/da5187c8-d4ba-4758-a87c-56b506e887b4.png" style=""/></div>
<ul>
<li><strong>Target Android version/API level</strong>: This is the OS version the app is developed to run on. Android uses this configuration to check whether it needs to enable any compatibility behaviors while running the application. This configuration can also be found in <span class="packt_screen">Android Manifest</span> inside the project's properties:</li>
</ul>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/b091e4fe-dbcc-4d86-8fe6-4d56d87fba78.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Resources</h1>
                </header>
            
            <article>
                
<p>When we created a new <kbd>Xamarin.Android</kbd> application project, a folder named <kbd>Resources</kbd> was created in <span class="packt_screen">Solution Explorer</span>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/d97039f9-371a-453a-8357-75ee70f21314.png" style=""/></div>
<p>Let's analyze the structure of our <kbd>Resources</kbd> folder in detail.</p>
<p>For an Android application structure, almost everything other than the actual code is a resource.</p>
<p><strong>A resource can be any of the following, but are not limited to the following:</strong></p>
<ul>
<li>Images
<ul>
<li>Any image or icon used in the application</li>
<li>They go in the <kbd>drawable</kbd> folder</li>
</ul>
</li>
<li>Application View
<ul>
<li>View files for the application, that is, the <kbd>Main.axml</kbd> file that we created</li>
<li>Goes in the <kbd>layout</kbd> folder</li>
</ul>
</li>
<li>Strings
<ul>
<li>These are text strings that are used across the application</li>
<li>For instance, the <span class="packt_screen">CALL</span> text on the text button</li>
<li>It helps keep consistency throughout the application</li>
<li>Goes in the <kbd>values</kbd> folder</li>
</ul>
</li>
</ul>
<p><strong>Resources we used in the application</strong></p>
<p>The main files that we used in our application in the <kbd>Resources</kbd> folder are as follows:</p>
<ul>
<li><kbd>Icon.png</kbd>: The icon for the application we downloaded and added.</li>
<li><kbd>Main.axml</kbd>: The default user interface layout file for our application. We only edited this file in the <span class="packt_screen">Designer</span>, but you can also go ahead and open the file in XML view and try to understand the XML tags used for UI elements.</li>
<li><kbd>Resource.designer.cs</kbd>: This file is automatically generated and maintained by <kbd>Xamarin.Android</kbd> and holds the unique IDs assigned to each resource. It is automatically created by <kbd>Xamarin.Android</kbd> tools and will be regenerated from time to time.</li>
</ul>
<p style="padding-left: 60px">This is why, to access certain resources in our C# code, we used the following code:</p>
<pre style="padding-left: 60px">phoneNumberInput = FindViewById&lt;EditText&gt;(Resource.Id.PhoneNumber); </pre>
<div class="packt_infobox">Notice <kbd>Resource.Id.PhoneNumber</kbd>; this information is basically stored in the <kbd>Resource.designer.cs</kbd> file, and all unique IDs assigned to resources are stored here.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding Activities</h1>
                </header>
            
            <article>
                
<p>Activities are something very specific to Android application development. Usually, in other applications, we have an entry point or a main method as an entry point to start the application.</p>
<p>But in Android, the same purpose is fulfilled by Activities. Android applications can be started from any activity that is specified as a starting activity for the application using <kbd>MainLauncher</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/48cf445d-15ac-4cf0-a21d-89de444c476f.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Activity class</h1>
                </header>
            
            <article>
                
<p>The <kbd>Activity</kbd> class contains the code that controls the user interface. The <kbd>Activity</kbd> class is basically responsible for creating the UI and handling user interactions such as button clicks or touches.</p>
<p>Now, let's take an example of our <strong>PhoneCallApp</strong> application. We have only one <kbd>Activity</kbd> in our project, and that is the <kbd>MainActivity.cs</kbd> class. It is the main entry point for the OS into this application, since we have set it as <kbd>MainLauncher</kbd>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/8cfd1fc2-da31-4081-a239-b57ec5975c05.png" style=""/></div>
<p>If we look closely, the <kbd>MainActivity</kbd> class inherits the <kbd>Activity</kbd> class, that is, it is a child of the <kbd>Activity</kbd> class. That means now <kbd>MainActivity</kbd> is also an <kbd>Activity</kbd>.</p>
<p>Also, it is important to note that we have an <kbd>Activity</kbd> attribute defined above the <kbd>MainActivity</kbd> class, which specifies the <kbd>Label</kbd> and the <kbd>MainLaucher</kbd> property as well. This attribute tells Android that the <kbd>MainActivity</kbd> class is part of the application and is managed by its Manifest.</p>
<p>By inheriting the <kbd>Activity</kbd> class, <kbd>MainActivity</kbd> gets access to the methods of the <kbd>Activity</kbd> class that provide developers with the ability to perform certain actions on different states of <kbd>MainActivity</kbd>, such as:</p>
<ul>
<li>When an activity is created</li>
<li>When an activity is paused</li>
<li>When an activity is resumed</li>
</ul>
<p>When developing an application and writing code for an <kbd>Activity</kbd> as discussed earlier, some methods are provided by the <kbd>Activity</kbd> class and we can use these to perform operations based on the different states of an <kbd>Activity</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Methods in the Activity class</h1>
                </header>
            
            <article>
                
<ul>
<li><kbd>OnCreate()</kbd>: When a user clicks on the app icon to start the application, this method is called. This method is used to perform some initial setup that might be required for the activity, for example, creating views, initializing variables, and much more:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c4592b03-fd00-48ac-b6f9-e04e31a4583b.png" style=""/></div>
<p style="padding-left: 60px">Let's have a look at our application code where we used the <kbd>OnCreate()</kbd> method to do some initialization and setup:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/fce7c919-9156-4483-81f4-c5064f9bdcbe.png" style=""/></div>
<p style="padding-left: 60px">The things we are doing in our <kbd>OnCreate()</kbd> method are:</p>
<ul>
<li style="list-style-type: none">
<ul>
<li>Setting up a layout for the view</li>
<li>Initializing variables to get references to <kbd>TextInput</kbd> and <kbd>CallButton</kbd></li>
<li>Binding the <kbd>Click</kbd> event to <kbd>CallButton</kbd></li>
</ul>
</li>
<li><kbd>OnStart()</kbd>: This method is always called by the system right after the <kbd>OnCreate()</kbd> method.</li>
<li><kbd>OnResume()</kbd>: This method is called by the system when the application is up again and ready to interact with the user. <kbd>OnResume()</kbd> is important because any operation that is done in <kbd>OnPause()</kbd> should be undone in <kbd>OnResume()</kbd>, since it's the only life cycle method that is guaranteed to execute after <kbd>OnPause()</kbd> when bringing the activity back.</li>
<li><kbd>OnPause()</kbd>: This method is called when the system is about to put the activity into the background. It is also an important method, because an activity should perform certain tasks, such as:
<ul>
<li>Saving unsaved changes</li>
<li>Freeing up resources, such as the camera or other resources</li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a16931fd-9017-4409-b1bf-5fdeb47408dc.png" style=""/></div>
<ul>
<li><kbd>OnStop()</kbd>: This method is called when the activity is no longer visible to the user. This happens when one of the following happens:
<ul>
<li>The Back button is pressed</li>
<li>An existing activity is being opened and brought to the foreground</li>
<li>A new activity is being started and covers up the current activity</li>
</ul>
</li>
</ul>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/efc4621a-8092-4b97-bced-3844fa26385d.png" style=""/></div>
<ul>
<li><kbd>OnRestart()</kbd>: If an activity was stopped and then it is started again, this method gets called.</li>
<li><kbd>OnDestroy()</kbd>: This is the final method that is called on an <kbd>Activity</kbd> before it's destroyed and completely removed from memory. It is used to clean up resources that might cause memory misuse.</li>
</ul>
<p>To understand more about the different Activity states, let's delve into the Activity life cycle.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Activity life cycle</h1>
                </header>
            
            <article>
                
<p>The Activity life cycle is usually defined by a list of methods inside the <kbd>Activity</kbd> class that provide us with ways to control the state of an activity. This allows developers to handle activities within an Android application.</p>
<p>Let's have a look at the different states of an Activity:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/6a3be964-31e8-49b6-b9a7-360cd65cd1a7.png" style=""/></div>
<p>These states can be broken into four main groups as follows:</p>
<ul>
<li><strong>Running</strong>: Activities are called active or running if they are in the foreground, also known as the top of the activity stack. This is known to be the highest priority activity in Android and will only be killed by the OS in extreme situations, such as if the activity tries to use more memory than is available on the device, since this could cause the application UI to become unresponsive.</li>
<li><strong>Paused</strong>: When a partial activity is called on top of a currently running activity, it is considered paused. Paused activities are still alive, that is, they maintain all state and member information, and remain in the activity stack. This is considered to be the second highest priority activity in Android and will only be killed by the OS if killing this activity will satisfy the resource requirements needed to keep the active/running activity stable and responsive.</li>
<li><strong>Stopped/backgrounded</strong>: If an activity is completely stopped or taken over by another activity, then it is considered as stopped or in the background. Stopped activities still try to retain their state and member information for as long as possible, but stopped activities have the lowest priority of the three states.</li>
<li><strong>Restarted/Resumed</strong>: If the user navigates back to the activity from another activity, or by tapping the App Switcher icon, it must be resumed if paused or restarted, or restored to its previously saved state, if stopped, and then displayed to the user.</li>
</ul>
<p>These categories are basic explanations of the different states of an activity in the activity life cycle.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying an application on a mobile device</h1>
                </header>
            
            <article>
                
<p>So far, we have tested our application on Android Virtual Device (Android Emulator). But it's always a good practice to test the application on a physical device. So, let's learn how to set up an actual Android device for testing an application.</p>
<p>Screenshots shown in this topic were taken using an Android device running Lollipop; your device settings may differ depending on your device version.</p>
<p>Here are the steps to set up a device for debugging:</p>
<ul>
<li><strong>Enable debugging on the device</strong>: We will need to enable debugging on the device. By default, it will not be possible to debug applications on an Android device.</li>
<li><strong>Install USB drivers</strong>: On our Windows computers, we will need to install USB drivers for our device.</li>
<li><strong>Connect the device to the computer</strong>: The final step involves connecting the device to the computer with a USB cable.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enable debugging on the device</h1>
                </header>
            
            <article>
                
<p>To enable debugging on the device, we need to perform the following steps:</p>
<ol>
<li>Click on the Settings icon from the notification bar:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/bc31ed31-2d9f-4cbe-8f93-e6223639aff8.png" style=""/></div>
<ol start="2">
<li>Open <span class="packt_screen">Settings</span>.</li>
<li>Scroll down to the end and click on <span class="packt_screen">About phone</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/eaa3e3e7-3905-41af-8f23-85b3da3ecf9a.png" style=""/></div>
<ol start="4">
<li>Scroll down to <span class="packt_screen">Build number</span>.</li>
<li>Tap on <span class="packt_screen">Build number</span> seven times until it says <span class="packt_screen">You are now a developer!</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/fcc6f6a3-48ed-45c8-9f69-e59950039ef7.png" style=""/></div>
<ol start="6">
<li>Go back to the <span class="packt_screen">Settings</span> menu and scroll down till the end:</li>
<li>You should be able to see a new menu entry now for <span class="packt_screen">Developer options</span> just before <span class="packt_screen">About phone</span>:</li>
<li>Click on <span class="packt_screen">Developer options</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/62abc930-848b-4527-91f5-8b2c35956ed9.png" style=""/></div>
<ol start="9">
<li>Find the option to enable <span class="packt_screen">USB debugging</span> and enable it:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/a75f8b3e-6e09-4ce3-89aa-8a0910a413b4.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Install USB drivers</h1>
                </header>
            
            <article>
                
<p>For different devices, different drivers might need to be installed for the computer to recognize the device. Please make sure all the device drivers are properly installed and the computer can recognize your device properly.</p>
<p>If you are downloading the device driver and want to install it manually on the computer, perform the following steps for Windows 7:</p>
<ol>
<li>Connect your device to the computer with a USB cable.</li>
<li>Right-click on the <span class="packt_screen">Computer</span> from your desktop or Windows Explorer and select <span class="packt_screen">Manage</span>.</li>
<li>Select <span class="packt_screen">Devices</span> in the left pane.</li>
<li>Locate and expand other devices in the right pane.</li>
<li>Right-click the device name and select <span class="packt_screen">Update Driver Software</span>.</li>
<li>This will launch the <span class="packt_screen">Hardware Update Wizard</span>.</li>
<li>Select <span class="packt_screen">Browse my computer for driver software</span> and click <span class="packt_screen">Next</span>.</li>
<li>Click <span class="packt_screen">Browse</span> and locate the USB driver folder.</li>
<li>Click <span class="packt_screen">Next</span> to install the driver.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Connect the device to a computer</h1>
                </header>
            
            <article>
                
<p>If you connect the device with a USB cable to a computer, <strong>android debug bridge</strong> (<strong>adb</strong>) should be able to communicate with the device and you should see a notification on the device saying <span class="packt_screen">USB debugging connected</span>, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/56a202ab-6444-4141-a073-a0caf71d36a5.png" style=""/></div>
<p>Now, you can go to Visual Studio, select your device listed in the running device list, and run the application. This will install the application on your device and run it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pushing code to a Git repository</h1>
                </header>
            
            <article>
                
<p>The application development is done. Let's save our code to our Git repository so we can access the code from anywhere:</p>
<ol>
<li>In Visual Studio, in the bottom-right corner, click on <span class="packt_screen">Add to Source Control</span> and then select <span class="packt_screen">Git</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2f3f9025-da16-4ead-a6be-14908d9818d4.png" style=""/></div>
<ol start="2">
<li>Click on <span class="packt_screen">Connect</span> | <span class="packt_screen">Settings</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d5d5c3f9-0329-4b17-928b-a9b5c9e73fe4.png" style=""/></div>
<ol start="3">
<li>Click on <span class="packt_screen">Global Settings</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/07ff20ec-8e77-4cc4-84c0-695682c4da15.png" style=""/></div>
<ol start="4">
<li>Enter your GitHub account username and email and click <span class="packt_screen">Update</span>:</li>
<li>Click on the up arrow icon (push icon) at the bottom of the Team Explorer.</li>
<li>Then, click on <span class="packt_screen">Publish Git Repo</span> under <span class="packt_screen">Push to Remote Repository</span>.</li>
<li>Notice that it says there is no remote repository configured for this local repository. That is because we haven't connected our remote GitHub repository to our local project:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/61da07d6-2ebc-43c1-b5f2-5ea6a5450880.png" style=""/></div>
<p style="padding-left: 60px">Log in to your GitHub account and create an empty Git repository for your project, as we learned in <a href="1cdfeed6-6ce1-4f1c-b1f5-d307c611987a.xhtml" target="_blank">Chapter 2</a>, <em>Working with Code Repository Systems</em>, and copy that URL to the textbox shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/e19a6297-f0b5-4279-aea6-dedd33238d48.png" style=""/></div>
<ol start="8">
<li>After clicking on <span class="packt_screen">Publish</span>, a new window will open asking for your GitHub credentials:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/fa4725be-a616-4815-aa95-08c3a1197760.png" style=""/></div>
<ol start="9">
<li>Enter your GitHub credentials to authenticate and click <span class="packt_screen">Login</span>:</li>
<li>After successfully logging in, the code will be pushed to the remote Git repository and you should see a success message as follows:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/8ad42c95-5d59-4a53-8e6c-2329d1cc9f94.png" style=""/></div>
<p>Congratulations, the code has now been pushed to the remote repository, and can be checked by logging in to GitHub and going to the repository URL.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned to develop an Android application using Xamarin and Visual Studio. We also learned some detailed fundamentals of an Android application, Activities, and their life cycle. We ran the application on Emulator as well as set up an actual physical device to run the application; finally we pushed our code to a Git repository.</p>
<p>In the next chapter, we'll learn about implementing continuous testing using Xamarin Test Cloud.</p>


            </article>

            
        </section>
    </body></html>