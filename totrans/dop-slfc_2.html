<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Applying DevOps to Salesforce Applications</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we learned some basics about the Salesforce development process, what a sandbox is, the different types of sandbox, and how to choose a sandbox according to our needs. We developed our own recruiting application using Salesforce, followed by learning the traditional ways used for Salesforce deployment. We also had a look at the issues we face during traditional deployments of Salesforce applications. We learned Salesforce development setup with Eclipse. We discussed applying DevOps to Salesforce applications.</p>
<p>In this chapter, we will discuss why there is a need for DevOps in Salesforce applications. We will also discuss the problems we face while working on big projects that involve large numbers of developers, testers, and so on. We will try to get a clear idea about how applying DevOps for Salesforce is different from other tech stacks such as simple Java application stacks. We will differentiate between the development process involved in Salesforce applications and that of other tech stacks such as Java, PHP, Ruby, and so on. We will also see in detail the DevOps process in Java applications to get a clearer idea about the DevOps continuous integration and delivery process using DevOps tools. We will go through a step-by-step process to set up a simple continuous integration  pipeline with Jenkins and Git. We will also learn how to install required plugins, configure the Maven plugin in Jenkins, and how to add a Jenkins webhook URL in a GitHub project; we'll also implement continuous deployment using the Jenkins plugin. Finally, we will see how we can deploy our code whenever any changes are pushed to GitHub. </p>
<p><span>In this chapter, we will learn about the following topics:</span></p>
<ul>
<li>The need for a DevOps process in Salesforce development.</li>
<li>The differences between DevOps for Salesforce and DevOps for other tech stacks. For example, the typical DevOps process for a Java development stack</li>
</ul>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The need for a DevOps process in Salesforce development</h1>
                </header>
            
            <article>
                
<p>As discussed in the previous chapter, we can apply DevOps practices in Salesforce projects to achieve faster delivery of applications. The question arises, <em>Why do we need DevOps?</em></p>
<p>Let's discuss some normal development practices in Salesforce projects. In Salesforce, everything is on the cloud, you just need a browser and internet connection to start developing your application. But as the development team grows, the complexities of building different features and deploying them in a production environment also become difficult. Although we can use different types of sandbox according to our need, managing the deployment process is still a time-consuming task.</p>
<p>Given that multiple developers are working on different features in different sandbox environments, we need to cherry-pick some features from those environments and deploy them to  a <strong>user acceptance testing</strong> (<span><strong>UAT</strong></span>)<span> </span><span>environment. This process is error-prone as it involves human interaction at various phases. Also we don't have any system for version control to manage changes done by developers.</span></p>
<p>Let's assume that somehow we managed to work with multiple developers with multiple sandbox environments and without managing the source code (that is just a hypothetical case but consider it is possible). What about testing new features in your application, and more importantly ensuring that nothing breaks in the previous application? Achieving this with manual testing would require a large number of testers and still we can't ensure that we have tested each and every feature right from login to some complex feature we just introduced in our application.</p>
<p>Why make such a mess when we can achieve more a streamlined delivery with the help of DevOps? DevOps reduces the time of delivery and makes the process less prone to errors; tracking applications becomes easier with a different set of open-source tools. We can improve the Salesforce application development process by integrating it with a DevOps toolset such as Git to maintain our source code version. We can integrate Jenkins for the deployment of Salesforce applications. We will see how to do this in more detail in <a href="c18c24e5-b3e1-467c-8e33-cc278016e0a6.xhtml">Chapter 6</a><em>, Continuous Integration</em>.</p>
<p>DevOps helps applications in other stacks to get more productive and follow a faster delivery process. We can achieve fast delivery in Salesforce projects with some modifications to the development and delivery processes. DevOps will impact everyone who is involved in Salesforce application development, testing, and deployment directly or indirectly, along with other end users.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The differences between DevOps for Salesforce and other tech stacks</h1>
                </header>
            
            <article>
                
<p>Applying DevOps in Salesforce is different from other environments; let's look at this step by step.</p>
<p>First, we will talk about the development process. Salesforce development is easy to start with because you don't need any installations and extra setup on your development machines. All you need is an internet connection and a browser supported by Salesforce platforms, such as Internet Explorer, Google Chrome, Safari, and so on. As we demonstrated in the previous chapter, a sample application in Salesforce is easy to develop with some clicks as Salesforce provides some existing applications and tabs for you to reuse. We can create some custom tabs in our application according to our requirements. When it comes to other tech stacks such as Java, to get started with development we need to install Java on our machines and set up some environment variables.</p>
<p>In tech stacks such as Java, JavaScript, PHP, and Ruby, the most common thing is using version control systems such as Git, CVS, SVN, and so on, which help to keep track of application changes done by each developer. Version control systems make it possible for multiple developers to work on a single project or module without overwriting each other's changes. In some situations, such as when something goes wrong and unfortunately we need to roll back updates, version control is very useful.</p>
<p>When we have a small team of one or two developers working on a Salesforce application, we may not need to use version control. But when it comes to teams with multiple developers working on different sandboxes, developing different features releasing at different timelines or sprints, it becomes necessary to have version control for a streamlined development and delivery process.</p>
<p>There are some ways to deploy changes to Salesforce production organizations, such as using Change Set, Eclipse, and Ant. For deployment using Change Set, you need to connect <span>organizations</span> using Deployment Connection. Eclipse uses metadata for deployment and it is mostly used by developers. Using Ant for deployment, we can perform file-based deployment to production organizations. </p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example – the typical DevOps process for a Java development stack</h1>
                </header>
            
            <article>
                
<p>The prerequisites are as follows:</p>
<ul>
<li class="MsoNormalCxSpFirst">Java version 1.6 or above</li>
<li class="MsoNormalCxSpMiddle">Apache Maven 3.5.2</li>
<li class="MsoNormalCxSpLast">Jenkins server</li>
</ul>
<div class="packt_infobox">Note: Use latest version of software available. In future, the previous versions may not be compatible.</div>
<p>If you haven't already installed Java, you can download it from the official website: <a href="https://java.com/en/download/">https://java.com/en/download/</a>.</p>
<p>Use the following commands for this sample CI/CD application. I will be using an Ubuntu 16.04 instance for setup. So let's start by installing Java.</p>
<p>Log in to your Ubuntu server machine as a normal user. We need a user with <kbd>sudo</kbd> access for installing packages on the machine. I will be using the Ubuntu username for this example:</p>
<pre><strong># sudo apt-get update 
# sudo apt-get install default-jdk</strong> </pre>
<p>The previous commands will install Java version 8 on the machine. Verify this with the following command:</p>
<div class="packt_infobox">Note: The same setup should work if the Java version is incremented to a stable version.</div>
<pre><strong>$java -version</strong><br/><strong>openjdk version "1.8.0_151"<br/>OpenJDK Runtime Environment (build 1.8.0_151-8u151-b12-0ubuntu0.16.04.2-b12)</strong><br/><strong>OpenJDK 64-Bit Server VM (build 25.151-b12, mixed mode)</strong></pre>
<p class="mce-root"/>
<p>Now, we have Java in place, so we will move on to the installation of Maven. The installation steps are as follows:</p>
<ol>
<li>Download Maven from the official website:</li>
</ol>
<pre style="padding-left: 60px"><strong>$wget http://www-eu.apache.org/dist/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz</strong></pre>
<ol start="2">
<li>Extract the package using the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>$tar -xvf apache-maven-3.5.2-bin.tar.gz</strong></pre>
<ol start="3">
<li>We need to set up environment variables. Add a path to <kbd>.bashrc</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>$export M2_HOME=/home/ubuntu/apache-maven-3.5.2</strong><br/><strong>$export PATH=${M2_HOME}/bin:${PATH}</strong><br/><strong>$source ~/.bashrc</strong></pre>
<ol start="4">
<li>Verify whether Maven was installed on your machine:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ mvn -v</strong><br/><strong>Apache Maven 3.5.2 (138edd61fd100ec658bfa2d307c43b76940a5d7d; 2017-10-18T07:58:13Z)<br/>Maven home: /home/ubuntu/apache-maven-3.5.2</strong><br/><strong>Java version: 1.8.0_151, vendor: Oracle Corporation</strong><br/><strong>Java home: /usr/lib/jvm/java-8-openjdk-amd64/jre</strong><br/><strong>Default locale: en_US, platform encoding: ANSI_X3.4-1968</strong><br/><strong>OS name: "linux", version: "4.4.0-1049-aws", arch: "amd64", family: "unix"</strong></pre>
<p>We will create a project in Maven. Here we will be using the official Maven example <em>Maven in 5 Minutes</em>. You will find a link in the <span class="packt_screen">References</span> section.</p>
<p>Let's move on to creating a sample project in Maven:</p>
<pre><strong>$mvn archetype:generate -DgroupId=com.mycompany.app -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</strong></pre>
<p>It will take some time to download dependencies. After completing execution of command, it will create a directory with value passed to <kbd>DartifactId</kbd> that is <kbd>my-app</kbd>.</p>
<p>In this example, <kbd>src/main/java</kbd> contains source code, <kbd>src/test/java</kbd> has test code, and <kbd>pom.xml</kbd> contains all information required to build the project.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The following is the source code we have from the sample app:</p>
<pre><strong>cat src/main/java/com/mycompany/app/App.java</strong><br/><strong>package com.mycompany.app;</strong><br/><strong>/**</strong><br/><strong> * Hello world!</strong><br/><strong> *</strong><br/><strong> */</strong><br/><strong>public class App</strong><br/><strong>{</strong><br/><strong>    public static void main( String[] args )</strong><br/><strong>    {</strong><br/><strong>        System.out.println( "Hello World!" );</strong><br/><strong>    }</strong><br/><strong>}</strong></pre>
<p>Now we will build our sample project:</p>
<pre><strong>#mvn package</strong></pre>
<p>This will compile the project and create a JAR in the target folder as <kbd>my-app-1.0-SNAPSHOT.jar</kbd>.</p>
<p>Test the JAR with the following command:</p>
<pre><strong>#java -cp target/my-app-1.0-SNAPSHOT.jar com.mycompany.app.App</strong></pre>
<p>We get the following output:</p>
<pre><strong>Hello World!</strong></pre>
<p>So, we got our sample application running but what if we have many developers working on the project? We need a version control tool and some standard procedure for deploying this project to the server environment. For this, we will follow our sample DevOps pipeline with Git and Jenkins.</p>
<p>Git is a version control tool that helps us to track changes in our source code and coordinate our work with different developments. It is the most commonly used version control tool nowadays. We will have a look at Git in depth in <a href="45e26817-986f-4fa4-a9c3-3044e7aad5da.xhtml">Chapter 5</a><em>, Version Control</em>. For this sample pipeline, we can use a GitHub account.</p>
<p>Create a repository on GitHub and push sample code to this repository:</p>
<pre><strong>$cd my-app</strong><br/><strong>$Git init</strong><br/><strong>$Git add .</strong><br/><strong>$Git commit -m "first commit"</strong><br/><strong>$Git remote add origin https://Github.com/priyankadive/devops-sample.Git</strong><br/><strong>$Git push -u origin master</strong></pre>
<p>Now that we have our version control ready, we will move on to the next step in using a continuous integration and continuous delivery process using Jenkins.</p>
<p>Jenkins is an open-source tool written in the Java programming language. It is used to automate continuous integration and continuous delivery jobs. We will see Jenkins in detail in <a href="c18c24e5-b3e1-467c-8e33-cc278016e0a6.xhtml">Chapter 6</a><em>, Continuous Integration</em>.</p>
<p>Let's get started with Jenkins:</p>
<ol>
<li>Install Jenkins. I have<span> installed</span> Jenkins on an Ubuntu server.</li>
<li>Log in to the Jenkins server.</li>
<li>Install the required Jenkins plugins on the Jenkins server using the following process.</li>
<li>Go to <span class="packt_screen">Manage Jenkins | GitHub Plugin</span> and search for <kbd>maven plugin</kbd>.</li>
<li>Install the Maven plugin in Jenkins if it was not installed while setting up Jenkins. You need to configure Maven in Jenkins <span class="packt_screen">Global Tool Configuration</span> as we have already installed it. </li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring Maven in the Jenkins server</h1>
                </header>
            
            <article>
                
<p>Go to <span class="packt_screen">Manage Jenkins | Global Tool Configuration</span>.</p>
<p>We have already installed Maven on our machine. So enter a name for the Maven installation and the <kbd>M2_HOME</kbd> path as follows:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/d034ba5d-5b79-45ca-8f81-085a9f0f5308.png"/></div>
<p class="mce-root"/>
<p>Let's configure our Jenkins job to build our sample project:</p>
<ol>
<li>Click on <span class="packt_screen">create new jobs</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/962d2573-4502-4aa8-9d2c-55ea6ee683f8.png"/></div>
<ol start="2">
<li>Create a Jenkins job with the Maven plugin. Provide the job name <kbd>devops-ci-cd</kbd> (you can choose another project name, if you want):</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e1f74887-1063-4104-bcae-dd8aa070247f.png"/></div>
<ol start="3">
<li>In the <span class="packt_screen">Source Code Management</span> section, provide the Git URL of your project. Provide credentials to clone the repository in Jenkins:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/8afea5b2-d6a7-4e9c-ad22-67da35dfe815.png"/></div>
<ol start="4">
<li>Choose <span class="packt_screen">GitHub hook trigger for GitScm polling</span> in <span class="packt_screen">Build Triggers</span>. If Jenkins receives a PUSH GitHub webhook from the preceding repository, it will trigger this job:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6f811618-8cc0-47ed-a6d8-aadf156c40f5.png" style="width:42.75em;height:17.75em;"/></div>
<ol start="5">
<li>Provide a path to root <kbd>pom.xml</kbd>. It will be a relative path to the module root. In <span class="packt_screen">Build</span>, add <span class="packt_screen">Root POM</span> as <kbd>pom.xml</kbd> and <span class="packt_screen">Goals and options</span> as <kbd>package</kbd>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/d3723517-d5a3-4bb0-8812-bfe4c94f3e13.png" style="width:42.00em;height:11.67em;"/></div>
<ol start="6">
<li>Save your work and click on <span class="packt_screen">Build now</span>.</li>
</ol>
<p>This will create <kbd>my-app-1.0-SNAPSHOT.jar</kbd> in the <kbd>/var/lib/Jenkins/workspace/target</kbd> folder. You can check the console logs while the project build is in progress.</p>
<p>Once the JAR is successfully built, you can see the console logs as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/cffe2dea-3a82-4be4-9031-9d07405853c0.png"/></div>
<p>We have completed a continuous integration job successfully. Now, we need to add the Jenkins webhook URL in the GitHub settings to trigger a Jenkins build whenever someone pushes code to our GitHub project.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a Jenkins webhook URL in a GitHub project</h1>
                </header>
            
            <article>
                
<p>To add a Jenkins webhook URL, you need to perform the following steps:</p>
<ol>
<li>Grab your GitHub webhook URL from <span class="packt_screen">Manage Jenkins | Configure System | GitHub Web Hook Section</span>.</li>
</ol>
<p style="padding-left: 90px">Example URL: <kbd>https://&lt;your-domain-name or IP address&gt;/web-hook/</kbd></p>
<ol start="2">
<li>Go to <span class="packt_screen">GitHub | Choose your project</span>. Go to <span class="packt_screen">Settings</span><span> and select</span> <span class="packt_screen">Integrations and Services</span><span>. Click on</span> <span class="packt_screen">Add service</span><span> and search for <kbd>Jenkins</kbd>. As a result, you will see two service: Jenkins (Git plugin) and Jenkins (GitHub plugin). </span>Choose one according to your project. We are going for <span class="packt_screen">Jenkins (GitHub plugin)</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/cdc4bc33-6755-49e4-9dbd-5b9b4d6e053f.png"/></div>
<ol start="3">
<li>Add your Jenkins webhook URL and click on <span class="packt_screen">Add service</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/5257dcbf-324d-432f-a2f7-77d944f1bd3c.png"/></div>
<ol start="4">
<li>Verify that the hook is working by clicking on <span class="packt_screen">Test service</span>. It will send our test payload to the Jenkins server. If everything is working fine, then we will see a green check mark before the Jenkins webhook:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/44cb59a8-aed2-4325-9bcf-88f06bd84c67.png"/></div>
<p style="padding-left: 60px">To test your continuous integration pipeline, add some changes in the <kbd>README</kbd> file we created. Push changes to GitHub.</p>
<p class="mce-root"/>
<ol start="5">
<li>In Jenkins, you can see the "devops-ci-cd"  build is automatically started as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/264a1a2c-b0be-4ca8-b036-a7ff2cb42c02.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Continuous deployment</h1>
                </header>
            
            <article>
                
<p>We have completed the continuous integration step. When source code is updated in a GitHub project, our Jenkins server will build a <kbd>.jar</kbd> file. We need to deploy the updated code to a remote server. SSH is secure shell protocol widely used to securely log in to remote systems. In this sample application, we will be using the Publish Over SSH plugin. It is used to send build artifacts and execute commands on<span> remote server</span> using the SSH protocol.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Publish Over SSH plugin in a Jenkins server</h1>
                </header>
            
            <article>
                
<p>Now, we will edit the Jenkins job which we created earlier. As the output of the continuous integration step, we get <kbd>my-app-1.0-SNAPSHOT.jar</kbd> created in our Jenkins workspace. To deploy this JAR on our test server, we are going to use a simple Jenkins plugin called Publish Over SSH. This plugin allows us to transfer files to a remote server and run commands as well. First we need to set up an SSH private key on the <span class="packt_screen">Manage Jenkins</span> page. Go to <span class="packt_screen">Manage Jenkins | Configure System</span> and provide the following information:</p>
<ul>
<li><span class="packt_screen">Passphrase</span>: Provide a passphrase for the key (leave it blank if not encrypted)</li>
<li><span class="packt_screen">Path to key</span>: The path to the key can be absolute, or relative to <kbd>$JENKINS_HOME</kbd></li>
<li><span class="packt_screen">Key</span>: If the key is not present on Jenkins server then you can copy and paste it in this field</li>
<li>Add <span class="packt_screen">SSH Server</span> details such as <span class="packt_screen">Username</span>, <span class="packt_screen">Hostname</span>, and <span class="packt_screen">Remote Directory</span>:</li>
</ul>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/43fe2682-c084-4bc5-90f7-28da81433645.png" style="width:42.25em;height:31.00em;"/></div>
<p class="mce-root"/>
<p>Now go to our previous Jenkins job and choose the <span class="packt_screen">Run only if build succeeds</span> option from <span class="packt_screen">Post Steps</span> so that if the build is successful then only the post steps will be executed.</p>
<p>From the <span class="packt_screen">Add post-build step</span> drop-down list, select the <span class="packt_screen">Send files or execute commands over SSH</span> option:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/92f87f3b-d41d-4e79-bd40-7cce0b1f6c1b.png"/></div>
<p>Add the following configuration to copy the JAR to the test server and run the command to start it:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c9e1c025-55a2-40c6-9ffc-c7ce6bc31f93.png"/></div>
<p>The command to deploy <kbd>Hello world!</kbd> is as follows:</p>
<pre><strong>#java -cp target/my-app-1.0-SNAPSHOT.jar com.mycompany.app.App</strong></pre>
<p>We have completed the continuous integration and Continuous Deployment process for our sample Java application using Maven and Jenkins. So, whenever any developer commits code to Git, the Jenkins job will be triggered, which will execute the build step to create a JAR and deploy it to the test server, if the build is successful. We can add one more step where we can execute automated test cases on the deployed application and get the results of our new changes.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed why there is a need for DevOps in Salesforce projects, and what challenges we might face while handling large Salesforce project developments and deployments. Also, we looked at why DevOps for Salesforce is not like any other tech stacks and what the differences between them are from the point of view of development, setting up environments, and deploying changes to the production environment in Salesforce and other stacks.</p>
<p>We went through the typical DevOps process for a Java development stack, where we created a sample Java application and used Git version-control and track changes done while developing the application. We worked on how to add a Jenkins webhook URL in a GitHub project. We set up a sample Jenkins job where we added a Maven build step to create a JAR whenever anyone pushes code to the Git master branch using a Jenkins webhook. After completing the continuous integration step for our sample Java application, we added a step in the Jenkins job for continuous deployment using the Publish Over SSH plugin.</p>
<p>In the next chapter, we will discuss how deployment is done in Salesforce in traditional ways. We will learn what deployment methods in Salesforce are, and discuss why there is a need for automation in the deployment process and how Salesforce deployments can be automated using Ant scripts.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">References</h1>
                </header>
            
            <article>
                
<p><span><strong>Maven in 5 Minutes</strong></span>:<span> </span><a href="https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html">https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html</a></p>


            </article>

            
        </section>
    </body></html>