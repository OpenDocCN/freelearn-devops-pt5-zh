<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Advanced Confluence</h1></div></div></div><p>So far we have been using Confluence out of the box, making use of all the features, templates, and macros that are bundled with the installation. Confluence also comes with the possibility to add your own features, templates, and macros to the product. This way you can tailor your Confluence installation to your company's needs.</p><p>In this chapter, we will learn about the more advanced features in Confluence, such as how to create and apply templates to give your content more structure. We will also take a look at creating our own macros, which can be used while creating content.</p><p>By the end of the chapter, you will have learned about:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating and managing content templates</li><li class="listitem" style="list-style-type: disc">Writing user macros</li><li class="listitem" style="list-style-type: disc">Using the page properties macro</li><li class="listitem" style="list-style-type: disc">Creating shortcut links</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec50"/>Templates</h1></div></div></div><p>We have been adding a lot of pages by now and every time we started from scratch; but we don't have to. When you find yourself creating the same page structure over again, or you want your users to use the same structure for reasons of consistency, templates are the answer.</p><p>Templates<a id="id672" class="indexterm"/> are predefined pages that can be used as a scaffold when you are creating pages. Only new pages can be created from a template, and when a template is used the new page will contain the same content as the template. Templates are very useful when you want a uniform style or format for your pages.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec104"/>Using templates</h2></div></div></div><p>When there <a id="id673" class="indexterm"/>are templates available, you can start using them to create new pages. When you create a page based on a template, Confluence will copy the following content and information to the new page:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Labels</li><li class="listitem" style="list-style-type: disc">Text and styles</li><li class="listitem" style="list-style-type: disc">Layouts and other formatting</li><li class="listitem" style="list-style-type: disc">Macros</li><li class="listitem" style="list-style-type: disc">Displayed media such as images or videos</li></ul></div><p>The newly created page is not connected in any way to the original template; changes made to the template will not reflect on the created page. It is not possible to apply a template to an existing page; templates can only be used when creating a new page. The newly created page can be edited in any way a blank page can; content can be added, updated, and removed.</p><p>To create a page based on a template, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on <strong>Create</strong> in the header.</li><li class="listitem">Select a space to create the new page in.</li><li class="listitem">Choose a template from the available templates.</li><li class="listitem">If the template contains variables, you will see a form. Type the relevant information into the fields and click on <strong>Next</strong>.</li><li class="listitem">You will see a new page based upon the template.</li><li class="listitem">Give the page a title and add, update, or delete the content.</li><li class="listitem">Click on <strong>Save</strong>.</li></ol></div><p>The following screenshot displays the available templates that can be used to create a new page:</p><div><img src="img/9526EN_08_06.jpg" alt="Using templates"/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec105"/>Creating templates</h2></div></div></div><p>In Confluence, templates can be <a id="id674" class="indexterm"/>created on two levels of the Confluence hierarchy:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Space templates</strong>: These<a id="id675" class="indexterm"/> templates are only available in the space you created them in. Space Administrators can define space templates via the space admin screen.</li><li class="listitem" style="list-style-type: disc"><strong>Global templates</strong>: These<a id="id676" class="indexterm"/> templates are available in every space in Confluence. Confluence Administrators can define global templates via the Administration Console.</li></ul></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec94"/>Space templates</h3></div></div></div><p>Space templates <a id="id677" class="indexterm"/>can be created by Space Administrators and are only available in the space you create them in.</p><p>To add a template <a id="id678" class="indexterm"/>for a space, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to any page in the space.</li><li class="listitem">Click on <strong>Space Tools</strong> from the sidebar.</li><li class="listitem">Select <strong>Content Tools</strong>, followed by <strong>Templates</strong> from the space admin menu.</li><li class="listitem">Click on the <strong>Create new Template</strong> button.</li></ol></div><p>If your space uses the documentation theme:</p><div><ol class="orderedlist arabic"><li class="listitem">Select <strong>Browse</strong> | <strong>Space Admin</strong>.</li><li class="listitem">Click on <strong>Templates</strong> from the left-hand navigation.</li><li class="listitem">Click on the <strong>Create new Template</strong> button.</li></ol></div><p>You will be <a id="id679" class="indexterm"/>redirected to the <strong>Create Template</strong> screen. How you can add content and create your template is explained in the <em>Adding content to your template</em> section.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec95"/>Global templates</h3></div></div></div><p>Global templates<a id="id680" class="indexterm"/> can be created by Confluence Administrators and are available in all spaces within Confluence.</p><p>To add a <a id="id681" class="indexterm"/>global template, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Choose <strong>Global Templates</strong> in the left-hand side menu.</li><li class="listitem">Click on the <strong>Add New Global Template</strong> button.</li></ol></div><p>You will be redirected to the <strong>Create Template</strong> screen. How you can add content and create your template is explained in the <em>Adding content to your template</em> section.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec96"/>Adding content to your template</h3></div></div></div><p>The <a id="id682" class="indexterm"/>
<strong>Create Template</strong> <a id="id683" class="indexterm"/>view is very similar to the regular editor in Confluence:</p><div><img src="img/9526EN_08_01.jpg" alt="Adding content to your template"/></div><p>What normally is the page title will now be the template name. The template name will be displayed when you create a new page, so choose a descriptive name for your template.</p><p>The content<a id="id684" class="indexterm"/> of the <a id="id685" class="indexterm"/>template is just like a regular page; you can use styles, layouts, and other formatting. You can also add links and macros. In addition to the normal features, the template editor also allows you to add variables and instruction texts. Using variables in your template will create a form for collection of data when someone adds a page based on the template.</p><p>Some points to take into account <a id="id686" class="indexterm"/>when creating a template are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Labels</strong>: Select <strong>Labels</strong> from the bottom-left to add labels to the template. These labels will be included in all the pages created using this template.</li><li class="listitem" style="list-style-type: disc"><strong>Images and other attachments</strong>: It is not possible to add any file or image to a template. If you want to use an image or attachment in your template, you need to attach this file to another page in Confluence.<p>Then insert the image by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select <strong>Insert</strong> | <strong>Image</strong>.</li><li class="listitem">Use the media browser to find your image.</li><li class="listitem">Click on <strong>Insert</strong> to insert your image.</li></ol></div></li><li class="listitem" style="list-style-type: disc"><strong>Instructional text</strong>: Instructional text<a id="id687" class="indexterm"/> allows you to add placeholder content to a template. This placeholder is only visible in the editor and disappears when the author of the page begins typing in that placeholder.<p>These texts can provide instructions for users on how to use the template and which data is expected at certain locations.</p><p>To insert an instructional text, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Place your cursor on the template where you want the instructional text to appear.</li><li class="listitem">Click on <strong>Template</strong> on the editor toolbar.</li><li class="listitem">Select <strong>Instructional Text</strong>.</li><li class="listitem">Start typing; the instructional text appears in italics with a shaded background to distinguish it from the normal paragraph text.</li></ol></div><p>The type of the <a id="id688" class="indexterm"/>placeholder can be changed from "text" to a "user mention", which starts the mention's autocomplete when the author starts typing. To change the placeholder type, click on the placeholder and select <strong>User Mention</strong>.</p></li><li class="listitem" style="list-style-type: disc"><strong>Variables</strong>: With variables<a id="id689" class="indexterm"/> you can introduce data entry to your template, making sure not only the layout is organized but the content as well. Variables added to a template act as form fields. When somebody creates a page based on your template, Confluence will display an entry box for each variable as shown in the following screenshot. Users can enter data into each field and the data is then inserted onto the new page:<div><img src="img/9526EN_08_02.jpg" alt="Adding content to your template"/></div><p>Each <a id="id690" class="indexterm"/>variable must have a unique name. If you add the same variable more than once in the same template, Confluence will provide both placeholders with the same value. This is useful when you need the same information in more than one position.</p><p>To insert a <a id="id691" class="indexterm"/>variable into a template, perform <a id="id692" class="indexterm"/>the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Place your cursor at the location you want to insert a variable</li><li class="listitem">Select <strong>Template</strong> from the editor toolbar.</li><li class="listitem">Select an existing variable or click on <strong>New Variable</strong>.</li><li class="listitem">Enter the variable name.</li><li class="listitem">Press <em>Enter</em>. This will create a single-line text input field.</li><li class="listitem">To change the variable type, click on the placeholder. The property panel will appear where you can choose different types. See the next table for a description of those types.</li></ol></div></li></ul></div><p>Speed up variable entry by using the keyboard shortcut <em>$</em> (<em>Shift</em> + <em>4</em>) for autocomplete.</p><p>These are the types of variables available:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Variable type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Text<a id="id693" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Creates a single-line text input field as shown:</p>
<div><img src="img/9526EN_08_03.jpg" alt="Adding content to your template"/></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Multi-line text<a id="id694" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Creates a textbox that allows more than one line of text.</p>
<p>By default, this textbox is of <strong>5</strong> rows with <strong>100</strong> characters wide. You can change the size in the property panel:</p>
<div><img src="img/9526EN_08_04.jpg" alt="Adding content to your template"/></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>List<a id="id695" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Creates a drop-down list. You must specify the values for the drop-down list. These values:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Must be separated by commas</li><li class="listitem" style="list-style-type: disc">Can include any letter, number, spaces, and other special characters except a comma, as these are used as separators</li></ul></div>
<div><img src="img/9526EN_08_05.jpg" alt="Adding content to your template"/></div>
</td></tr></tbody></table></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec106"/>Importing templates</h2></div></div></div><p>In addition to <a id="id696" class="indexterm"/>creating your own templates, you can download predefined templates from the Atlassian Marketplace in the form of a template bundle or Blueprints. Each bundle contains one or more templates, created by Atlassian or other parties.</p><p>An example <a id="id697" class="indexterm"/>of one of those bundles is available here:</p><p>
<a class="ulink" href="https://marketplace.atlassian.com/20489">https://marketplace.atlassian.com/20489</a>
</p><p>Downloading and installing add-ons, like template bundles, is described in more detail in <a class="link" href="ch09.html" title="Chapter 9. General Administration">Chapter 9</a>, <em>General Administration</em>.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec97"/>Checking installed template bundles</h3></div></div></div><p>To check which <a id="id698" class="indexterm"/>bundles are available and can be imported, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Select <strong>Import Templates</strong> from the left-hand side menu.</li><li class="listitem">You will see a list of template bundles installed and all the templates included in each bundle:<div><img src="img/9526EN_08_07.jpg" alt="Checking installed template bundles"/><div><p>Display of template bundles available for import</p></div></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec98"/>Making templates available for usage</h3></div></div></div><p>If you have one or <a id="id699" class="indexterm"/>more template bundles installed, you can import them to make those templates available for your users.</p><p>To import a template, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Select <strong>Import Templates</strong> from the left-hand side menu.</li><li class="listitem">You will see a list of template bundles installed and all the templates included in each bundle. If you click on the template name, a preview is shown.</li><li class="listitem">Select the templates you want to import by checking the boxes next to the template names.</li><li class="listitem">Choose the destination for the templates in the <strong>Import To:</strong> dropdown. If you want to import the templates to a specific space, select that space; otherwise select <strong>Global Templates</strong> to make the templates available for all spaces.</li></ol></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec51"/>User Macros</h1></div></div></div><p>Throughout the book, <a id="id700" class="indexterm"/>we have learned what macros are and how we can use them to make our content more engaging and alive. Most macros we have used so far are either bundled with Confluence, or part of an add-on we have installed. But there is another possibility to add macros: via user macros.</p><p>User macros are short pieces of code that make it easier to perform often-used functions or add custom formatting to your page. This could, for example, be a preconfigured panel macro with different styling than the defaults. We will create this example ourselves later in this chapter.</p><p>System Administrators can add user macros via the Confluence Administration Console.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec107"/>Managing user macros</h2></div></div></div><p>To manage user<a id="id701" class="indexterm"/> macros, you need to have System Administrator permissions. Be careful when installing user macros from an unknown source; macros could potentially affect the stability and security of your Confluence installation.</p><p>Perform the following steps for adding a user macro:</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Select <strong>User Macros</strong> from the left-hand side menu.</li><li class="listitem">Click on <strong>Create a User Macro</strong> at the bottom of the list of macros.</li><li class="listitem">Enter the macro details as explained in the <em>Writing user macros</em> section.</li><li class="listitem">Click on <strong>Save</strong>.</li></ol></div><p>Perform the<a id="id702" class="indexterm"/> following steps for editing a user macro:</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the <a id="id703" class="indexterm"/>Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Select <strong>User Macros</strong> from the left-hand side menu.</li><li class="listitem">Click on <strong>Edit</strong> next to the relevant macro.</li><li class="listitem">Change the macro details as explained in the <em>Writing user macros</em> section.</li><li class="listitem">Click on <strong>Save</strong>.</li></ol></div><p>Perform the following steps<a id="id704" class="indexterm"/> for removing a user macro:</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Select <strong>User Macros</strong> from the left-hand side menu.</li><li class="listitem">Click on <strong>Remove</strong> next to the relevant macro.</li></ol></div><p>If you remove a user macro that is being used on a Confluence page, you will need to remove the macro from the page manually.</p><div><div><h3 class="title"><a id="tip16"/>Tip</h3><p>You can use the Confluence search to find pages that are using a user macro. More information on searching for macros can be found in the <em>Searching labels</em> section in <a class="link" href="ch04.html" title="Chapter 4. Managing Content">Chapter 4</a>, <em>Managing Content</em>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec108"/>Writing user macros</h2></div></div></div><p>Writing a user <a id="id705" class="indexterm"/>macro is done via a form in the Administration Console. We'll go over the input fields to help you create your first user macro:</p><div><img src="img/9526EN_08_10.jpg" alt="Writing user macros"/><div><p>Input form for creating a new user macro</p></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Macro Name</strong>: This <a id="id706" class="indexterm"/>is the name of the macro and can only contain letters, numbers, and hyphens (-); for example: teaser-panel.</li><li class="listitem" style="list-style-type: disc"><strong>Visibility</strong>: Here you can set the visibility in the macro browser; this can be all users or only system administrators. Hiding the macro for all users will still allow them to use the macro, but it avoids cluttering the Macro Browser and autocomplete.<p>Choosing <strong>Visible only to system administrators in the Macro Browser</strong> means that:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Only system administrators will see this macro in the Macro Browser or autocomplete. For other users, the macro will not show up, even while searching the macro.</li><li class="listitem" style="list-style-type: disc">The macro output will be visible to all users who have permissions to see the page.</li><li class="listitem" style="list-style-type: disc">Any user with edit permissions will see the macro on the page if it is already on it. Your users are also allowed to edit or remove the macro.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><strong>Macro Title</strong>: The macro title is the name that will appear in the Macro Browser and autocomplete. Choose a descriptive title to make it easier for your users to find the macro.</li><li class="listitem" style="list-style-type: disc"><strong>Description</strong>: The description text shows next to the macro in the Macro Browser. The search in the Macro Browser will also use the description text to search in.</li><li class="listitem" style="list-style-type: disc"><strong>Categories</strong>: Select one or more categories to place your user macro in. These categories relate to the categories a user sees in the Macro Browser. To select multiple categories, hold down the <em>Ctrl</em> key while selecting.</li><li class="listitem" style="list-style-type: disc"><strong>Icon URL</strong>: The Macro Browser can display an icon for your macro if you provide a URL. This can either be an absolute URL, or a path relative to the Confluence's base URL; for example: <code class="literal">http://example.com/images/no-print-icon.png</code> or <code class="literal">/images/icons/macrobrowser/no-print-icon.png</code>.</li><li class="listitem" style="list-style-type: disc"><strong>Documentation URL</strong>: If <a id="id707" class="indexterm"/>you have online documentation, enter the URL of this documentation here. The link will appear in the macro properties dialog. In some cases, a Confluence page documenting your user macro is very useful for your users.</li><li class="listitem" style="list-style-type: disc"><strong>Macro Body Processing</strong>: You can specify that your macro can have a body, allowing your users to enter content in your macro. An example of a macro with a body is the panel macro.<p>If your macro has a body, this body will be available in your macro template with the <code class="literal">$body</code> variable. The content of your body depends on how the processing is done.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="top">
<p>Processing option</p>
</th><th style="text-align: left" valign="top">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><strong>No macro body</strong></p>
</td><td style="text-align: left" valign="top">
<p>Select this option if your macro doesn't need a body.</p>
</td></tr><tr><td style="text-align: left" valign="top"><p><strong>Escaped</strong></p>
</td><td style="text-align: left" valign="top">
<p>If your macro has a body and you make use of the body in your template, Confluence will escape any HTML in the body.</p>
<p>So, if the body is: <code class="literal">&lt;b&gt;Example HTML&lt;/b&gt;</code></p>
<p>Then the value of $body is: <code class="literal">&amp;lt;b&amp;gt;ExampleHTML&amp;lt;/b&amp;gt;</code></p>
<p>This will be rendered as: <code class="literal">&lt;b&gt;Example HTML&lt;/b&gt;</code></p>
</td></tr><tr><td style="text-align: left" valign="top"><p><strong>Unrendered</strong></p>
</td><td style="text-align: left" valign="top">
<p>Use this option if you want the <code class="literal">$body</code> variable to be exactly like the user entered it. You should process the body within the template to make sure HTML is outputted by the template.</p>
</td></tr><tr><td style="text-align: left" valign="top"><p><strong>Rendered</strong></p>
</td><td style="text-align: left" valign="top">
<p>The body will be rendered, so most HTML will be passed to the template unmodified; but Confluencespecific markup, such as macro definitions, will be processed and rendered.</p>
<p>So, if the body is: <code class="literal">&lt;b&gt;Example HTML&lt;/b&gt;</code></p>
<p>Then the value of <code class="literal">$body</code>: is <code class="literal">&lt;b&gt;Example HTML&lt;/b&gt;</code></p>
<p>This will be rendered as: <strong>Example HTML</strong></p>
</td></tr></tbody></table></div></li><li class="listitem" style="list-style-type: disc"><strong>Template</strong>: This is <a id="id708" class="indexterm"/>where the magic happens: the macro template. Here you should write the code that specifies what your macro will do. We will go into detail on how to write a user macro template soon, but here is a quick guide up front:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use HTML and Confluence-specific XML elements in your macro template. Use the Storage Format tool to find the specific XML.</li><li class="listitem" style="list-style-type: disc">It is possible to use Apache Velocity in the template.</li><li class="listitem" style="list-style-type: disc">If your macro has a body, the content is available in the <code class="literal">$body</code> variable.</li><li class="listitem" style="list-style-type: disc">Each parameter for your macro should have matching metadata definitions. Use <code class="literal">@param</code> to define that metadata.</li><li class="listitem" style="list-style-type: disc">Use <code class="literal">@noparams</code> if your macro does not access any parameters.</li></ul></div><div><div><h3 class="title"><a id="note38"/>Note</h3><p>Apache Velocity is a template engine that provides a template language to reference objects defined in the backend of Confluence. Velocity is the main template engine in Confluence and is used for displaying almost every page. Velocity can be used in your macro to add some logic (if-else) or to get information from the backend, that is, the current page title and other page properties.</p></div></div></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec109"/>Writing a user macro template</h2></div></div></div><p>A user macro <a id="id709" class="indexterm"/>template is a piece of code that specifies what your macro does. It is written in a combination of HTML, XML, and Velocity. We will<a id="id710" class="indexterm"/> build a user macro together to give you some insight into what the possibilities are.</p><p>I assume you have filled in the other text fields of the macro based on the previous paragraph. Make sure that the <strong>Macro Body Processing</strong> option is set to <strong>Rendered</strong>.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec99"/>A descriptive header</h3></div></div></div><p>It is a good practice to <a id="id711" class="indexterm"/>have a descriptive header at the top of every <a id="id712" class="indexterm"/>template. The header tells what the macro does and what kind of parameters it expects.</p><p>Our header would look something like this:</p><div><pre class="programlisting">## Macro title: Teaser Panel
## Macro has a body: Y
## Body processing: Rendered
## 
## Developed by: Stefan Kohler
## Date created: 04/02/2013

## The Teaser panel is a predefined panel used as teaser</pre></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec100"/>Parameters</h3></div></div></div><p>It is possible to use <a id="id713" class="indexterm"/>parameters in your user macro, so that users can pass extra information for you to render. If you define your parameters, Confluence will display the corresponding fields in the <strong>Macro properties</strong> dialog and browser.</p><p>A parameter definition in the template consists of three parts:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">@param</code> – to let Confluence know we are defining a parameter</li><li class="listitem" style="list-style-type: disc">Name – to access the parameter's value in your template</li><li class="listitem" style="list-style-type: disc">Extra attributes – to further describe your parameter</li></ul></div><p>Parameters are generally defined at the top of the template, just below the header. The order in which you specify the parameters is also the order in which they are displayed in the parameter section (the right-hand side) in the Macro Browser.</p><div><pre class="programlisting">## @paramTitle:title=Title|type=string|desc=What is the title for the Teaser</pre></div><p>As you may have noticed, there are quite a few extra attributes you can use to describe your parameter. The more you specify, the better Confluence can help your users with the Macro Browser and properties editor. Let's go over the available attributes:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Attribute name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th><th style="text-align: left" valign="bottom">
<p>Required?</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>[unnamed first attribute]</p>
</td><td style="text-align: left" valign="top">
<p>The parameter name is the first attribute, and doesn't require a name.</p>
<p>
</p><div><pre class="programlisting">## @param example</pre></div><p>
</p>
<p>Will define the parameter <code class="literal">example</code>.</p>
</td><td style="text-align: left" valign="top">
<p>Required</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">title</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The parameter title that will appear in the Macro Browser. If no title is specified, the parameter name is used.</p>
</td><td style="text-align: left" valign="top">
<p>Recommended</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The field type of the parameters. Learn about types in the next pages.</p>
</td><td style="text-align: left" valign="top">
<p>Recommended</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">desc</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The description of the parameter shown in the Macro Browser.</p>
</td><td style="text-align: left" valign="top">
<p>Optional</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>required</p>
</td><td style="text-align: left" valign="top">
<p>Specify if the parameter is required; default is <strong>false</strong>.</p>
</td><td style="text-align: left" valign="top">
<p>Optional</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>multiple</p>
</td><td style="text-align: left" valign="top">
<p>Specify if the parameters allows multiple values; default is <strong>false</strong>.</p>
</td><td style="text-align: left" valign="top">
<p>Optional</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>default</p>
</td><td style="text-align: left" valign="top">
<p>The default value of the parameter.</p>
</td><td style="text-align: left" valign="top">
<p>Optional</p>
</td></tr></tbody></table></div><p>If you don't specify <a id="id714" class="indexterm"/>the type of the parameter, it will default to a string. But there are many more types available from which you can choose. Confluence will render the input field of your parameter based on the type you specify.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">boolean</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Displays a checkbox to the user and passes the value <strong>true</strong> or <strong>false</strong> to the macro as a string.</p>
<p>
</p><div><pre class="programlisting">## @param hide:title=Should hide?|type=boolean</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">enum</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Offers a list of values for selection. You can specify the values to appear in the dropdown yourself. The variable will be passed on the to macro as it is, including capitalization.</p>
<p>
</p><div><pre class="programlisting">## @param color:title=Color|type=enum|enumValues=Grey,Red,Green</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">string</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows a text field; this is the default if no other type is specified.</p>
<p>
</p><div><pre class="programlisting">## @param title:title=Title|type=string</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">confluence-content</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows a quick search where the user can search for a page or blog post in Confluence.</p>
<p>
</p><div><pre class="programlisting">## @param page:title=Page|type=confluence-content|required=true</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">username</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows a quick search for users.</p>
<p>
</p><div><pre class="programlisting">## @param user:title=Username|type=username</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">spacekey</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows a list of spaces for selection; the space key is passed on to the macro.</p>
<p>
</p><div><pre class="programlisting">## @param space:title=Space|type=spacekey</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">date</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Currently threated as a normal string. Users can type a date in any format; be sure to check the date in your template.</p>
<p>
</p><div><pre class="programlisting">## @paramfromDate:title=From Date|type=date</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">int</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Type is accepted, but currently treated as a normal string.</p>
<p>
</p><div><pre class="programlisting">## @param numItems:title=Number of items|type=int</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">percentage</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Type is accepted, but currently treated as a normal string.</p>
<p>
</p><div><pre class="programlisting">## @param pcent:title=Percentage|type=percentage</pre></div><p>
</p>
</td></tr></tbody></table></div><p>The parameters are available in your template as, for example, <code class="literal">$paramtitle</code> and <code class="literal">$paramcolor</code> for parameters called title and color respectively.</p><p>Normally, if a <a id="id715" class="indexterm"/>parameter like <code class="literal">$paramtitle</code> is missing, it will appear as <code class="literal">$paramtitle</code> in the output. To output nothing when a parameter is not set, use an exclamation mark after the dollar sign: <code class="literal">$!paramtitle</code>.</p><p>When your macro doesn't have any parameters, you should use <code class="literal">@noparams</code> in your template. This will let Confluence know that it doesn't need to display a parameter input field. If your macro doesn't contain parameters and does not specify <code class="literal">@noparams</code>, the macro browser will display a free-format textbox allowing users to enter undefined parameters. You should use <code class="literal">@noparams</code> in your template as follows:</p><div><pre class="programlisting">## @noparams</pre></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec101"/>Template code</h3></div></div></div><p>Now that we have a good <a id="id716" class="indexterm"/>descriptive header and parameter declarations<a id="id717" class="indexterm"/> for our macro, it is time to write to the macro template code.</p><p>When writing your macro, the following objects are available to you to use:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Variable</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$body</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The body of the macro, if your macro has one.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$param&lt;name&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Named parameters as described in your macro template.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$renderContext</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The <code class="literal">PageContext</code> object, useful for (among other things) checking <code class="literal">$renderContext.baseUrl</code> or <code class="literal">$renderContext.spaceKey</code>. More information on the <code class="literal">PageContext</code> object is located at <a class="ulink" href="http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/renderer/PageContext.html">http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/renderer/PageContext.html</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$space</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The space object where this page or blog post is located. This object can be used to retrieve information as the space name, description, and URL. More information is available at <a class="ulink" href="http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/spaces/Space.html">http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/spaces/Space.html</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$content</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The current <code class="literal">ContentEntity</code> object in which this macro is included. This can for example be used to retrieve attachments, labels, or comments. More information is available at <a class="ulink" href="http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/core/ContentEntityObject.html">http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/core/ContentEntityObject.html</a>.</p>
</td></tr></tbody></table></div><p>Using these objects <a id="id718" class="indexterm"/>it is possible to get access to certain extra<a id="id719" class="indexterm"/> information that is otherwise not available on a Confluence page; this makes user macros really powerful.</p><div><div><div><div><h4 class="title"><a id="ch08lvl4sec13"/>Including another macro</h4></div></div></div><p>For our user macro we want to include a predefined version of the panel macro, bundled with Confluence. This means we need to find out what the Confluence-specific XML is that defines the panel.</p><p>The easiest way to do this is consulting the Storage Format tool<a id="id720" class="indexterm"/>. To get the <a id="id721" class="indexterm"/>storage format<a id="id722" class="indexterm"/> for the panel macro:</p><div><ol class="orderedlist arabic"><li class="listitem">Create and save a new page containing the panel macro, including all the parameters we want to have predefined.</li><li class="listitem">Select <strong>Tools</strong> | <strong>View Storage format</strong>. This option is only available for Confluence Administrators, and shows the XML source for the page, exactly what we need.<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A Confluence macro starts with <code class="literal">&lt;ac:macroac:name…</code>.</li><li class="listitem" style="list-style-type: disc">A macro parameter starts with <code class="literal">&lt;ac parameter ac:name…</code>.</li></ul></div></li></ol></div><p>For our panel, the XML we want to use in our template looks like this:</p><div><pre class="programlisting">&lt;ac:macro ac:name="panel"&gt;
&lt;ac:parameter ac:name="titleBGColor"&gt;#00a8e1&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="title"&gt;$!paramTitle&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="borderStyle"&gt;dashed&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="borderColor"&gt;#00a8e1&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="titleColor"&gt;#ffffff&lt;/ac:parameter&gt;
&lt;ac:rich-text-body&gt;$body&lt;/ac:rich-text-body&gt;
&lt;/ac:macro&gt;</pre></div><p>As you might have noticed, I have already included the <code class="literal">title</code> parameter and <code class="literal">@body</code> in the XML. I did this by using the value in the <code class="literal">panel</code> attribute I created on the page, so that I know I put the variables on the right spot.</p><p>If we <a id="id723" class="indexterm"/>put<a id="id724" class="indexterm"/> all the pieces of code together, we have our own teaser macro.</p><div><pre class="programlisting">## Macro title: Teaser Panel
## Macro has a body: Y
## Body processing: Rendered
## 
## Developed by: Stefan Kohler
## Date created: 04/02/2013

## The Teaser panel is a predefined panel used as teaser

## @param Title:title=Title|type=string|desc=What is the title for the Teaser

&lt;ac:macro ac:name="panel"&gt;
&lt;ac:parameter ac:name="titleBGColor"&gt;#00a8e1&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="title"&gt;$!paramTitle&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="borderStyle"&gt;dashed&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="borderColor"&gt;#00a8e1&lt;/ac:parameter&gt;
&lt;ac:parameter ac:name="titleColor"&gt;#ffffff&lt;/ac:parameter&gt;
&lt;ac:rich-text-body&gt;$body&lt;/ac:rich-text-body&gt;
&lt;/ac:macro&gt;</pre></div><p>If you want to read more about writing user macros, take a look at some online examples at <a class="ulink" href="https://confluence.atlassian.com/x/V4lYDQ">https://confluence.atlassian.com/x/V4lYDQ</a>.</p><p>The end result of our user macro looks like this:</p><div><img src="img/9526EN_08_11.jpg" alt="Including another macro"/></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec52"/>The Page Properties macro</h1></div></div></div><p>There is one macro I want to emphasize a bit more. The <a id="id725" class="indexterm"/>
<strong>Page Properties macro</strong>, also known as the <strong>metadata details macro</strong>, is a little beauty.</p><p>The Page Properties macro enables you to embed data on a page and then display that information in a tabular form on another page. The Page Properties macro can be placed upon as many pages as you like, and you can use the Page Properties Report macro to display all the data.</p><p>An example, which we will implement, is customer contact information where every customer has a page with contact details, using the Page Properties macro. Then on an overview page, we will display all the customers contact information in a table.</p><p>To create customer details pages<a id="id726" class="indexterm"/>, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a <code class="literal">Sales &amp; Marketing</code> space for this exercise, or use a test/sandbox space if you have one available.</li><li class="listitem">In the new space, create a page called <code class="literal">Customers Overview</code>.<div><ol class="orderedlist arabic"><li class="listitem">In the body, add the macro Page Properties Report.</li><li class="listitem">In the macro properties, use the label <code class="literal">customer-contact-details</code>.</li><li class="listitem">Click on <strong>Save</strong> to save the page.</li></ol></div></li><li class="listitem">Create a new page as the child of the Customers Overview page.<div><ol class="orderedlist arabic"><li class="listitem">Use your customer name as title.</li><li class="listitem">Insert the Page Properties macro.</li><li class="listitem">In the body of the macro, create a table with two columns and four rows.</li><li class="listitem">Enter some contact details in the table:<p>
<strong>Name</strong> – <code class="literal">Ford Prefect</code>.</p><p>
<strong>Position</strong> – <code class="literal">Managing Directory</code>.</p><p>
<strong>Email</strong> – <code class="literal">ford.prefect@example.com</code>.</p><p>
<strong>Phone</strong> – <code class="literal">317-822-2752</code>.</p></li><li class="listitem">Give the page a label <code class="literal">customer-contact-details</code>.</li><li class="listitem">Click on <strong>Save</strong> to save the page.</li></ol></div></li><li class="listitem">Repeat this <a id="id727" class="indexterm"/>step for a couple of customers. (This is a great example on where to use a template.)</li></ol></div><p>So now we <a id="id728" class="indexterm"/>have a couple of pages with customer information, looking similar to the following screenshot:</p><div><img src="img/9526EN_08_08.jpg" alt="The Page Properties macro"/></div><p>If we now browse back to our <strong>Customer Overview</strong> page we created earlier, we should see a table with <a id="id729" class="indexterm"/>our customers. As with all tables in Confluence, you can sort the table by the columns.</p><div><div><h3 class="title"><a id="note39"/>Note</h3><p>The columns are ordered alphabetically and not as you specified in the Page Properties macro. If you want to reorder the columns, adding a number to them is a good trick.</p></div></div><div><img src="img/9526EN_08_09.jpg" alt="The Page Properties macro"/></div><div><div><h3 class="title"><a id="note40"/>Note</h3><p>The table generated by the Page Properties Report macro can also be used as input for other macros like the Charting macro.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec53"/>Shortcut links</h1></div></div></div><p>Shortcut links <a id="id730" class="indexterm"/>provide a quick way of linking to resources that you use often, for example, a link to a Google search. Shortcut links need to be configured by a Confluence Administrator before users can use them.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec110"/>Creating a shortcut link</h2></div></div></div><p>If you search<a id="id731" class="indexterm"/> for a book on the Packt Publishing website, the URL will look like <a class="ulink" href="http://www.packtpub.com/books?keys=">http://www.packtpub.com/books?keys=</a>. If you create a shortcut for this search with the key <code class="literal">packt</code>, every time a user needs to visit the website they can just type <code class="literal">[terms@packt]</code> and Confluence will link to <a class="ulink" href="http://www.packtpub.com/books?keys=terms">http://www.packtpub.com/books?keys=terms</a>.</p><div><ol class="orderedlist arabic"><li class="listitem">Browse to the Administration Console (<strong>Administration</strong> | <strong>Confluence Admin</strong>).</li><li class="listitem">Select <strong>Shortcut Link</strong> from the left-hand side menu.</li><li class="listitem">Enter a key for you shortcut value. In our case, we will use <code class="literal">packt</code>.</li><li class="listitem">Enter the <strong>Expanded Value</strong>: <code class="literal">http://www.packtpub.com/books?keys=</code>. You can use <code class="literal">%s</code> in the URL to specify where the term needs to be inserted. If there is no <code class="literal">%s</code> in the URL, the term is put at the end.</li><li class="listitem">Enter a <strong>Default Alias</strong>. This is the text of the link that will be displayed in Confluence. <code class="literal">%s</code> can also be used within the text. If no value is entered, Confluence will use <code class="literal">term@key</code> as the link text.</li><li class="listitem">Click on<a id="id732" class="indexterm"/> <strong>Submit</strong>.<div><img src="img/9526EN_08_12.jpg" alt="Creating a shortcut link"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec111"/>Using shortcut links</h2></div></div></div><p>Your users can use<a id="id733" class="indexterm"/> the shortcut links you created earlier just like any other link.</p><div><ol class="orderedlist arabic"><li class="listitem">Open a page in the edit mode and place your cursor at the location where you want to add the link.</li><li class="listitem">Click on <strong>Link</strong> in the toolbar, or press <em>Ctrl</em> + <em>K</em>.</li><li class="listitem">Click on <strong>Advanced</strong> and enter the shortcut link <code class="literal">confluence@packt</code> into the link textbox.</li><li class="listitem">Enter a link text that will be displayed.</li><li class="listitem">Click on <strong>Insert</strong>.</li></ol></div><p>You can also use the <em>[</em> keyboard shortcut and type the link, enclosed with <code class="literal">'</code> <code class="literal">'</code>; for example <code class="literal">'[confluence@packt]'</code>.</p><div><div><h3 class="title"><a id="note41"/>Note</h3><p>Users need to be told which shortcuts are available. The best way of doing this is to create a separate page listing the shortcuts. Confluence doesn't provide a way to list them automatically.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec54"/>Summary</h1></div></div></div><p>If you want to create uniformity or just want to give your users a head start creating content, templates are there for you. Templates are preformatted pages that can be used when you add a new page. We have learned how to create those templates and that templates can be added on a space or global level.</p><p>Another mechanism to automate things you find yourself doing often is user macros. User macros allow you to code some functionality or formatting, which your users can reuse. User macros can easily be added via the Confluence user interface, but they do require a bit of knowledge about HTML and XML. With the example in this chapter, you should have a solid base to start building your own macros.</p><p>That macros can be really powerful is demonstrated by the Page Properties macro that you can use to get metadata from pages and show this in an overview table.</p><p>There are many add-ons available that add templates, macros, and other functionalities to Confluence. These add-ons can be installed via the Atlassian Marketplace, which we will learn about in the next chapter.</p></div></body></html>