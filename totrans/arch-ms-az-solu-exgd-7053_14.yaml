- en: Application Monitoring and Alerting Strategies
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we covered how to design effective messaging solutions,
    by covering the Azure Service Bus and Azure Queue Storage and combining different
    Azure resources in an effective messaging architecture.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we are introducing the Design for Operations objective by covering
    application and platform monitoring and alerting strategies by giving an overview
    of the available solutions that Azure has to offer. By the end of this chapter,
    you should know when to use the different types of solutions when issues occur
    on the Azure platform in general and inside your custom solutions and configurations.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered:'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Log Analytics
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Monitor
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Application Insights
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Service Health
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Advisor
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Network Watcher
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Log Analytics
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Log Analytics is a service that collects and analyzes log files from various
    Azure resources and on-premises resources. It can collect all the data into a
    single workspace and offers a query language to query the data.
  prefs: []
  type: TYPE_NORMAL
- en: You can integrate various resources in Log Analytics, such as data from VMs,
    by installing an agent on Windows and Linux VMs, or you can connect to System
    Center Operations Manager to collect telemetry from existing agents. Most Azure
    resources are already integrated in Log Analytics. You only need to create a workspace
    from the Azure Portal to collect the data from them. You can then query the data
    from the workspace directly using the query language, or you can use analysis
    tools that can analyze the data. Some examples of analysis tools are Operations
    Management Suite, Azure Security Center, and Application Insights. You can import
    the data in Power BI as well to create data visualizations.
  prefs: []
  type: TYPE_NORMAL
- en: 'When the data is collected, it is organized in data tables separated by the
    data type. It can collect data from the following resources:'
  prefs: []
  type: TYPE_NORMAL
- en: Data from Azure Monitor can be collected in Log Analytics and searched using
    the query language
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Agents can be installed on Windows and Linux machines to send data to Log Analytics
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A System Center Operations Manager management group can be connected to Log
    Analytics to collect data from agents
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Application Insights and Azure Security Center use Log Analytics by default
    to store data
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Log Analytics offers cmdlets that can be used from PowerShell and can be used
    in Azure Automation Runbooks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It offers a HTTP Data Collector API that can be leveraged in custom applications
    to send log data to Log Analytics
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a Log Analytics Workspace
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To create a Log Analytics Workspace, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure Portal by opening: [https://portal.azure.com/](https://portal.azure.com/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on New and type in `Log Analytics` in the search bar. Create a new workspace.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter the following settings and click on OK:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/bb0fca00-56d9-42b7-8900-c4401b143cf5.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Creating a Log Analytics Workspace
  prefs: []
  type: TYPE_NORMAL
- en: The workspace has now been created.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You can now connect the Azure resources to the workspace. For example, pick
    the PacktPub resource group, which was created in the first chapter, and open
    the settings in the Azure Portal. Click on Activity log in the left menu:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/aabb2921-72d9-4a9e-9f3e-fdfced5de687.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Azure resource Group Overview blade
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on Log Analytics in the top menu, click on the Add button, and select
    the workspace that was created in the previous steps and click on OK:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0f2a6fca-20f8-4c3f-8d89-cc4da29a5ccd.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Selecting workspace
  prefs: []
  type: TYPE_NORMAL
- en: Logging for this Resource Group is now sent to the Log Analytics Workspace.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'When you navigate back to the Log Analytics Overview blade and click on View
    Designer, a blade opens where you can create views for your data:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/154db2c1-12e5-48a4-96a4-9aa2248f0bf3.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Log Analytics Designer
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also click on the Analytics button in the top menu, which will open
    the Log Analytics portal. Here, you can use predefined and create custom queries.
    In there, you can open a new tab and create a new query. You can add the following
    query to create a bar chart with the alert count by severity, per day (for the
    past 7 days):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '![](img/f897036b-100b-450e-8e0f-46cfa69c7101.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Query result in the Log Analytics Portal
  prefs: []
  type: TYPE_NORMAL
- en: 'When you navigate back to the Log Analytics Overview blade in the Azure Portal
    and click on OMS Portal, Microsoft Operations Management Suite should be open,
    where you can check all the logs and other activities as well:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/75084f7d-3fdc-4218-94ad-886397acd417.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Microsoft Operations Management Suite
  prefs: []
  type: TYPE_NORMAL
- en: Azure Monitor
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Monitor is a monitoring solution in the Azure Portal, which provides infrastructure metrics
    and logs for mostly all services in Microsoft Azure. Not all Azure resources have
    been added to Azure Monitor by the time of writing this book, but in the future,
    more will be added.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure Monitor offers the following capabilities:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Activity Log**: The activity log provides information about all types of
    events that are occurring inside an Azure Subscription. This can be activities
    such as stopping or starting VMs and maintenance activities. It offers different
    event categories, such as administrative, security, service health, autoscale,
    alerts, recommendations, policies, and resource health events. The events are
    stored for a retention period of 90 days. Queries can be saved and pinned to the
    Azure Dashboard, and they can be exported to a storage account for storing them
    for a larger period of time. They can also be exported to an Event Hub for real-time
    streaming or sent to Log Analytics as well.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Diagnostic Settings**: This provides information about events that happen
    inside a particular resource inside an Azure Subscription, for instance, an event
    for retrieving a secret from the Azure Key Vault. These events are not collected
    by default; they need to be enabled for the resources manually inside the Azure
    Portal, inside an ARM template when the resources are created, or using PowerShell
    or calling the REST API. These events can be stored inside a storage account or
    Event Hub or sent to Log Analytics as well, just like the events in the Activity
    log.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Metrics**: Metrics offers time-based metric points for your resources, just
    as performance counters in Windows Server. Metrics are available by default, and
    they have a retention period of 93 days. You can check the performance of an Azure
    resource and track the used and available credits, for instance. They can be sent
    to Event Hubs, Azure Stream Analytics, and you can retrieve and query data using
    the REST API and PowerShell.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Alerts:** The Alerts section offers a single place to view and manage all
    Azure alerts. It displays alerts coming from the Activity Log, Metrics, Application
    Insights, and Log Analytics. You can create Alert Rules, which can send out an
    email or SMS, Webhook, send data to a third-party IT Service Management application,
    or call an Automation Runbook.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/9672b0db-f5fe-4815-b4e6-3ec73b12c672.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Azure Monitor Metrics
  prefs: []
  type: TYPE_NORMAL
- en: Application Insights
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Application Insights offers a monitoring solution for cross-platform Apps that
    are hosted in Azure and for on-premises apps. It is aimed at developers and can
    be used in order to monitor the performance and detect issues, and it helps improve
    usability of your apps. It can be integrated in DevOps processes and development
    tools, such as Visual Studio.
  prefs: []
  type: TYPE_NORMAL
- en: Developers can set up an Application Insights Resource inside Azure and install
    a package inside their application. This can be an Azure application or an on-premises
    application; they can both connect to the resource in Azure. This package is responsible
    for sending telemetry data to Azure. You can add performance counters, Docker
    logs, and diagnostic logs as well.
  prefs: []
  type: TYPE_NORMAL
- en: 'It collects the following types of application events:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Rate data**: Different types of rate data can be sent to Application Insights,
    such as request and dependency rates and response times and user session counts.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Exceptions**: Exceptions that occur inside an application can be sent to
    Application Insights.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Page views and performance**: It can give information about page views and
    load performance of the application.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Diagnostic Logs**: This sends Docker Host diagnostic information to Application
    Insights and trace logging from applications.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**AJAX calls**: This is the performance of AJAX calls and failed requests and
    response time.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Custom Events**: You can create custom events in your applications as well.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Integration**: It can integrate with Visual Studio App Center and HockeyApp
    to analyze telemetry data from mobile applications as well.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Once the data is sent to Azure, it can be viewed in the Azure Portal. The Azure
    Portal offers different capabilities to display and analyze the data. It offers
    an Application map blade, a Live Metrics Stream, Metrics Explorer blades, a Performance
    blade, and more:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/0f0495d9-7d4f-4718-8c76-7c559ed73d0c.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Application Insights in the Azure Portal
  prefs: []
  type: TYPE_NORMAL
- en: Azure Service Health
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Service Health offers a dashboard in the Azure Portal where issues regarding
    the different Azure resources are displayed. This can give you insights about
    maintenance schedules, which are platform issues that can effect the availability
    of the resources in Azure.
  prefs: []
  type: TYPE_NORMAL
- en: 'It offers the following views from the Azure Portal:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Service Issues**: This provides an overview of all the global issues on Azure
    that currently occur in all the different Azure Regions. It also offers a health
    history where you can review or download summaries of historical events.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Planned Maintenance**: This provides an overview of all the maintenance events
    that are scheduled.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Resource Health**: An overview of the current and historical health of the
    different resources inside the Azure Subscription. When you are having issues,
    you can run a troubleshoot tool from there as well.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Health Alerts**: You can create Health Alerts from there as well so that
    you are notified when maintenance activities are scheduled and service issues
    occur.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/91103956-2fef-4626-80f1-febd52981499.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Azure Service Health in the Azure Portal
  prefs: []
  type: TYPE_NORMAL
- en: Azure Advisor
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Advisor is a tool that helps you follow best practices for deployments
    in Azure. It analyzes the current configuration of all the Azure resources, and
    based on that, it can make recommendations about them. For most recommendations,
    you can address them from inside the Azure Advisor portal directly.
  prefs: []
  type: TYPE_NORMAL
- en: 'It offers the following categories:'
  prefs: []
  type: TYPE_NORMAL
- en: '**High Availability**: This provides several recommendations to improve the
    continuity of your applications and other Azure resources, such as enabling backups
    and creating Availability Sets.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Security**: This provides recommendations to improve security of Azure resources.
    It integrates with Azure Security Center.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Performance**: This provides recommendations for the overall performance
    of the different Azure resources, such as database performance and App Service
    performance.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Costs**: This section provides recommendations for being more cost-effective,
    such as resizing or shutting down virtual machines, or reducing costs by eliminating
    unprovisioned ExpressRoute circuits.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Address Recommendation from Azure Advisor
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To address a recommendation from Azure Advisor directly, take the following
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure Portal by opening: [https://portal.azure.com/](https://portal.azure.com/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select Azure Advisor from the left menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You get an overview of all the different recommendations, categorized into
    four sections:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a32c2f02-7d08-449e-a3fb-eb229a4158e9.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure Advisor overview
  prefs: []
  type: TYPE_NORMAL
- en: 'These recommendations are based on all the different services that we''ve created
    for this book. So, if you have followed along, your recommendations will be the
    same. For this example, we select the Security section and then Follow Security
    Center Recommendations. Pick a high severity recommendation:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/78ba0198-b7a2-4f87-a507-a93ad1a8dde9.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Security recommendations
  prefs: []
  type: TYPE_NORMAL
- en: A new blade opens where you can select the database. Here, you can enable Auditing
    & Thread Detection for the selected database directly.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8105acec-bced-432f-835e-415bb7f792b0.png)'
  prefs: []
  type: TYPE_IMG
- en: Auditing & Thread Detection settings
  prefs: []
  type: TYPE_NORMAL
- en: Azure Network Watcher
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Network Watcher offers a network monitoring solution on the Azure resources
    level for all network communication. This includes VNets, ExpressRoute circuits,
    Application Gateway traffic, Load Balancers, and more. It can be accessed from
    the Azure Portal and offers monitoring tools, diagnostic tools, and logs from
    the network level.
  prefs: []
  type: TYPE_NORMAL
- en: 'It offers the following capabilities:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Topology**: This provides an overview of all the network resources in a VNet
    by offering a Graph. From the Azure Portal, it provides a subset of all the network
    parts. To view a full list of the resources, you can use PowerShell or the REST
    API.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**IP flow verify**: This offers an overview of allowed or denied packages for
    a network interface of a virtual machine. This helps administrators to solve connectivity
    issues quickly.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Next Hop**: This provides an overview of the destination routes of packages.
    This is useful for determining connectivity issues and checking whether packages
    arrive at the destination, such as to on-premises virtual machines.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Security Group View**: This provides an overview of all the configured NSGs
    and rules that are associated with it from two different levels, the network interface
    level, and the subnet level.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VPN Diagnostics:** This offers a troubleshooting solution for VPN gateways
    and connections. Connections and gateways can be called and return the result
    from the Azure Portal, PowerShell, Azure CLI, or REST API.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Packet Capture: **You can capture network traffic packets to diagnose network
    anomalies. It requires an extension that needs to be installed on virtual machines
    to capture the data packages. Packages can be stored locally on the virtual machines
    or on Azure Blob Storage for further analysis.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Connection Troubleshoot**: This offers a troubleshooting solution that checks
    TCP connections from VMs to VMs, IPv4 addresses, URIs, and fully qualified domain
    names (FQDNs). This helps with detecting connectivity issues by collecting all
    the configurations. It uses the same extension as the Packet Capture feature and
    connectivity can be checked from PowerShell, CLI, and the REST API as well.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](img/4ed8d16f-1601-4392-ae64-68b9c67ef37f.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Network Watcher Overview
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we've covered the different monitoring solutions Azure provides
    from a platform and application's perspective, such as Application Insights, Network
    Watcher, and Azure Log Analytics.
  prefs: []
  type: TYPE_NORMAL
- en: The next chapter will be the last chapter of this objective and the final chapter
    of this book, [Chapter 15](a2aa1d0a-4f06-46f9-9718-5b150e447326.xhtml), *Exploring
    Operations Automation Strategies*.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  prefs: []
  type: TYPE_NORMAL
- en: You are designing an IoT Solution and want to provide a real-time monitoring
    tool for your administrators. Should you use Azure Log Analytics for this?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Is Azure Network Watcher a separate application that needs to be installed on
    your computer?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: You want to get an overview of all the maintenance events that are scheduled
    for the Azure platform. Can you retrieve this information from Azure Service Health?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can check the following links for more information about the topics that
    were covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '**What is Azure Log Analytics?**: [https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-overview](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-overview)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Create custom views using View Designer in Log Analytics**: [https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-view-designer](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-view-designer)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Monitor Documentation**: [https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Overview of Azure Monitor**: [https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-azure-monitor](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-azure-monitor)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Application Insights Documentation**: [https://docs.microsoft.com/en-us/azure/application-insights/](https://docs.microsoft.com/en-us/azure/application-insights/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Service Health Documentation**: [https://docs.microsoft.com/en-us/azure/service-health/](https://docs.microsoft.com/en-us/azure/service-health/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Introduction to Azure Advisor**: [https://docs.microsoft.com/en-us/azure/advisor/advisor-overview](https://docs.microsoft.com/en-us/azure/advisor/advisor-overview)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Network Watcher Documentation**: [https://docs.microsoft.com/en-us/azure/network-watcher/](https://docs.microsoft.com/en-us/azure/network-watcher/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
