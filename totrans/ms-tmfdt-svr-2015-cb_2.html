<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Setting Up and Managing Code Repositories"><div class="titlepage" id="aid-PNV62"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Setting Up and Managing Code Repositories</h1></div></div></div><div class="blockquote"><table border="0" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"Quality is never an accident; it is always the result of intelligent effort".</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution"><span class="emphasis"><em>John Ruskin</em></span></span></td></tr></table></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Creating a Git repository in an existing TFVC Team Project</li><li class="listitem">Enabling code analysis check-in policy</li><li class="listitem">Performing a baseless merge between sibling branches in TFVC</li><li class="listitem">Reparenting a branch in TFVC</li><li class="listitem">Unlocking files checked out by someone else</li><li class="listitem">Unshelving a shelveset created in one branch to another branch</li><li class="listitem">Ignoring file types from check-in using .tfignore and .gitignore</li><li class="listitem">Conducting code reviews in TFS</li><li class="listitem">Setting up policies for branches in Git</li><li class="listitem">Conducting Pull requests in TFS</li><li class="listitem">Analyzing code churn with TFS analysis services cube</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Introduction</h1></div></div></div><p>Code repositories<a id="id135" class="indexterm"/> enable developers to write code more confidently. More developers are using source control than ever before. The most obvious benefits of a code repository can be seen when multiple developers are collaborating on code. Many hands in the pot means there is a greater need to manage and understand revisions. If you ever have to make an argument to support source control, then the questions to ask would be the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Have you ever made a change to code, realized it was a mistake and wanted to revert back?</li><li class="listitem">Have you ever lost code or had a backup that was too old?</li><li class="listitem">Have you ever had to maintain multiple versions of a product?</li><li class="listitem">Have you ever wanted to see the difference between two (or more) versions of your code?</li><li class="listitem">Have you ever wanted to prove that a particular change broke or fixed a piece of code?</li><li class="listitem">Have you ever wanted to review the history of some code?</li><li class="listitem">Have you ever wanted to submit a change to someone else's code?</li><li class="listitem">Have you ever wanted to share your code or let other people work on your code?</li><li class="listitem">Have you ever wanted to see how much work is being done, and where, when, and by whom?</li><li class="listitem">Have you ever wanted to experiment with a new feature without interfering with working code?</li></ul></div><p>Managing code is an essential part of<a id="id136" class="indexterm"/> <span class="strong"><strong>Application Lifecycle Management</strong></span>, which spans indiscriminately across programming languages and frameworks. Source control systems can broadly be distinguished as centralized or distributed:</p><div class="mediaobject"><img src="../Images/image00351.jpeg" alt="Introduction"/></div><p style="clear:both; height: 1em;"> </p><p><span class="strong"><strong>Centralized Version Control Systems</strong></span> (<span class="strong"><strong>CVCS</strong></span>)<a id="id137" class="indexterm"/> maintain a single "central" copy of your source code on a server repository. When working with a centralized version control system, developers download the code from the repository to a local workspace. Once changes to the code have been made locally, they are committed to the centralized copy. Additional functions against the repository (branching, merging, shelving, and so on) also take place on the server and require a connection to the server.</p><p>TFVC<a id="id138" class="indexterm"/> is a Centralized Version Control System. When working with TFVC using Visual Studio or Eclipse, the IDE is in frequent communication with the server. Most common operations cannot be performed in the absence of an active connection to the server.</p><p><span class="strong"><strong>Distributed Version Control Systems</strong></span> (<span class="strong"><strong>DVCS</strong></span>) <a id="id139" class="indexterm"/>does not necessarily rely on a central server to store all the versions of a project's files. Instead, developers "clone" a copy of a repository and have the full history of the project on their own hard drive. This copy (clone) contains all of the data in the repository – all of the branches and the commit history.</p><p>Git<a id="id140" class="indexterm"/> is a Distributed Version Control System. Most operations (except pushing and pulling) can be performed without an active connection to the server.</p><p>TFS is the only platform to support both centralized (TFVC) and distributed (Git) source control systems. The following table should help you decide when centralized is a better option than distributed. More details on the differences between the two can be found at <a class="ulink" href="https://msdn.microsoft.com/en-us/Library/vs/alm/code/overview">https://msdn.microsoft.com/en-us/Library/vs/alm/code/overview</a>.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th rowspan="2" valign="bottom"> </th><th colspan="2" valign="bottom" style="text-align: center">
<p>Centralized Version Control</p>
</th><th rowspan="2" valign="bottom">
<p>Distributed</p>
<p>Version Control</p>
</th></tr><tr><th valign="bottom">
<p>Check-in</p>
<p>Check-out</p>
</th><th valign="bottom">
<p>Edit</p>
<p>Commit</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Strengths</p>
</td><td valign="top">
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Scales to very large codebases</li><li class="listitem">Fine level permission control</li><li class="listitem">Allows usage monitoring</li></ul></div>
</td><td valign="top">
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Offline editing support</li><li class="listitem">Easy to edit files outside Visual Studio or Eclipse</li></ul></div>
</td><td valign="top">
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Full offline experience</li><li class="listitem">Complete repository with portable history</li><li class="listitem">Simplified branching model</li></ul></div>
</td></tr><tr><td valign="top">
<p>Best for</p>
</td><td valign="top">
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Large Integrated codebase</li><li class="listitem">Control and auditability over source code down to the file level</li></ul></div>
</td><td valign="top">
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Medium-sized integrated codebase</li><li class="listitem">A balance of fine-grained control with reduced fiction</li></ul></div>
</td><td valign="top">
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Modular codebases</li><li class="listitem">Integrated with open source</li><li class="listitem">Highly distributed Teams</li></ul></div>
</td></tr></tbody></table></div><p>Until TFS 2015, the selection for source control type needed to be made at the time of Team Project creation. In Update 1, a new capability was introduced that allows Teams to create Git repositories within TFVC Team Projects. This is great for Teams that have large investments in TFVC projects but would like to try out Git. This capability and its advantages are discussed at length in the <span class="emphasis"><em>Creating a Git repository in an existing TFVC Team Project</em></span> recipe. The Git for TFVC users<a id="id141" class="indexterm"/> is a very useful guide (<a class="ulink" href="http://bit.ly/1RgboRk">http://bit.ly/1RgboRk</a>) for anyone coming from a TFVC background interested in learning Git.</p><p>Today, the marketplace and business demands are changing more than ever before. Development Teams are constantly under pressure to deliver better quality software faster. This is not sustainable unless the underlying codebase is of good quality and backed by unit tests. A good source control repository can significantly contribute to the quality of the software, but it requires much more than just a good source control repository to drive quality.</p><p>Talking of quality, no code reviews, poor DevOps practices, lack of unit tests, too many tactical implementations, and not addressing underlying issues are major contributors to technical debt. Technical debt doesn't hit you overnight, it's a slow and gradual process. Unlike financial debt, technical debt is very hard to recognize. Technical debt will slow your ability to deliver value. Are you seeing any of these signs?</p><div class="mediaobject"><img src="../Images/image00352.jpeg" alt="Introduction"/></div><p style="clear:both; height: 1em;"> </p><p>The goal of this chapter is to introduce you to various source control operations in Web Portal and Team Explorer, learn about features that help build quality into the code, and last but not least, understand the code metrics available in the TFS Warehouse. In this chapter, we'll be using the Fabrikam Fiber codebase <a id="id142" class="indexterm"/>available on CodePlex (<a class="ulink" href="https://fabrikam.codeplex.com">https://fabrikam.codeplex.com</a>). Follow the following instructions to set up the code in the FabrikamTFVC and FabrikamGit Team Project.</p><div class="section" title="Setting up the Fabrikam solution in FabrikamTFVC Team Project"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Setting up the Fabrikam solution in FabrikamTFVC Team Project</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <a id="id143" class="indexterm"/>Visual <a id="id144" class="indexterm"/>Studio, and in Team Explorer connect to FabrikamTFVC project. Click on the hyperlink to configure your workspace. Accept the default name and location, and click on <span class="strong"><strong>Map &amp; Get</strong></span>. A success notification is shown when the operation is completed:<div class="mediaobject"><img src="../Images/image00353.jpeg" alt="Setting up the Fabrikam solution in FabrikamTFVC Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open the workspace location, in this case, <code class="literal">C:\Users\Tarun\Source\Workspaces\FabrikamTFVC</code>. Create a new folder <code class="literal">Main</code>; in <code class="literal">Main</code>, create a folder <code class="literal">Source</code> and copy the content of Fabrikam codebase downloaded from CodePlex:<div class="mediaobject"><img src="../Images/image00354.jpeg" alt="Setting up the Fabrikam solution in FabrikamTFVC Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open Source Control Explorer in Visual Studio and from the menu bar, select <span class="strong"><strong>Add items to folder</strong></span> icon. In the <span class="strong"><strong>Add to Source Control</strong></span> window, click on the <code class="literal">Main</code> folder and then click on <span class="strong"><strong>Next</strong></span>. Following this, click on <span class="strong"><strong>Excluded items</strong></span>, select all the items, and then click on the <span class="strong"><strong>include item(s)</strong></span> icon. There should be no excluded items now. Click on <span class="strong"><strong>Finish</strong></span>, and then click on the <span class="strong"><strong>FabrikamTFVC</strong></span> project and choose <span class="strong"><strong>Check in pending changes</strong></span> from the context menu:<div class="mediaobject"><img src="../Images/image00355.jpeg" alt="Setting up the Fabrikam solution in FabrikamTFVC Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In Source<a id="id145" class="indexterm"/> Control<a id="id146" class="indexterm"/> Explorer, right-click on the <code class="literal">Main</code> folder and select <span class="strong"><strong>Convert to Branch...</strong></span> from under the branching and merging submenu in the context menu:<div class="mediaobject"><img src="../Images/image00356.jpeg" alt="Setting up the Fabrikam solution in FabrikamTFVC Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open <code class="literal">FabrikamFiber.CallCenter.sln</code> from <code class="literal">$/FabrikamTFVC/Main/Source/FabrikamFiber.CallCenter</code>. Right-click on the <span class="strong"><strong>Solution</strong></span> in Solution Explorer and select <span class="strong"><strong>Add Solution to Source Control...</strong></span> from the context menu:<div class="mediaobject"><img src="../Images/image00357.jpeg" alt="Setting up the Fabrikam solution in FabrikamTFVC Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Accept warnings and check in the changes from the pending page in Team Explorer. The Fabrikam solution is now successfully set up in the main branch in the FabrikamTFVC Team Project.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Setting up the Fabrikam solution in FabrikamGit Team Project"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>Setting up the Fabrikam solution in FabrikamGit Team Project</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <a id="id147" class="indexterm"/>Visual<a id="id148" class="indexterm"/> Studio and in Team Explorer, connect to the FabrikamTFVC project. Click on the hyperlink to clone this repository. Accept the default name and location and clone. A success notification is shown when the operation is complete:<div class="mediaobject"><img src="../Images/image00358.jpeg" alt="Setting up the Fabrikam solution in FabrikamGit Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open the <a id="id149" class="indexterm"/>local <a id="id150" class="indexterm"/>working directory, in this case, <code class="literal">C:\Users\Tarun\Source\Repos\FabrikamGit</code>. Create a new folder <code class="literal">src</code> and copy the content of the Fabrikam codebase downloaded from CodePlex:<div class="mediaobject"><img src="../Images/image00359.jpeg" alt="Setting up the Fabrikam solution in FabrikamGit Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In Team Explorer, navigate to the changes page. From the untracked files section, click on the <span class="strong"><strong>Add All</strong></span> hyperlink to include all files recently copied into the working folder. Click on the <span class="strong"><strong>Commit</strong></span> button to commit these changes to the repo:<div class="mediaobject"><img src="../Images/image00360.jpeg" alt="Setting up the Fabrikam solution in FabrikamGit Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">A prompt <a id="id151" class="indexterm"/>to sync the <a id="id152" class="indexterm"/>changes is raised when the commit operation has been successfully completed. Click on <span class="strong"><strong>Sync</strong></span> and then on <span class="strong"><strong>Push</strong></span> from the <span class="strong"><strong>Outgoing Commits (1)</strong></span> section to push the changes to the remote server:<div class="mediaobject"><img src="../Images/image00361.jpeg" alt="Setting up the Fabrikam solution in FabrikamGit Team Project"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to the branches page in Team Explorer. The <span class="strong"><strong>master</strong></span> branch shows up as well as the <span class="strong"><strong>remotes/origin</strong></span> branch:<div class="mediaobject"><img src="../Images/image00362.jpeg" alt="Setting up the Fabrikam solution in FabrikamGit Team Project"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>The<a id="id153" class="indexterm"/> Fabrikam solution is <a id="id154" class="indexterm"/>now successfully set up in the <span class="strong"><strong>Master</strong></span> branch in the FabrikamGit Team Project.</p></div></div></div>
<div class="section" title="Creating a Git repository in an existing TFVC Team Project"><div class="titlepage" id="aid-QMFO2"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Creating a Git repository in an existing TFVC Team Project</h1></div></div></div><p>Traditionally, it has only <a id="id155" class="indexterm"/>been possible to have <a id="id156" class="indexterm"/>TFVC as a source control repository. TFS started supporting Git as a source control from TFS 2013 onwards. Git offers many benefits for<a id="id157" class="indexterm"/> distributed Teams collaborating across the same codebase; you can read more about the benefits here at <a class="ulink" href="https://git-scm.com/about">https://git-scm.com/about</a>. TFVC Teams that are keen to try out Git, but cannot because of the rework involved in migrating their existing investments now have a solution. TFS now supports hybrid Team Projects. In this recipe, you'll learn how to set up a Git repository within an existing TFVC-based Team Project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>Getting ready</h2></div></div></div><p>In Team Foundation Server 2015 Update 1, you need to be a member of the project administrator group to make an existing TFVC or Git project into a hybrid project, a project that hosts both a TFVC repository and multiple Git repositories. Users will need Visual Studio 2015 Update 1 to work with the hybrid project. Older versions of Visual Studio, including 2015 RTM, will see the project as the type it was originally created as.</p><p>If your TFVC project was created prior to TFS 2015 Update 1, a project administrator will need to apply some project-level permissions once the first repository has been created. Go to the version control administration page and select the <span class="strong"><strong>Git repositories</strong></span> node in the tree. To set up the same group permissions as any of the default process templates (Agile, Scrum, and CMMI), add the following TFS groups and grant the following permissions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">[ProjectName]\Readers<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>- Allow</strong></span>: Read</li><li class="listitem"><span class="strong"><strong>- Not set</strong></span>: All others</li></ul></div></li><li class="listitem">[ProjectName]\Contributors<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>- Allow</strong></span>: Branch creation, Contribute, Note management, Read, and Tag creation</li><li class="listitem"><span class="strong"><strong>- Not set</strong></span>: All others</li></ul></div></li><li class="listitem">[ProjectName]\Build Administrators<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>- Allow</strong></span>: Branch creation, Contribute, Note management, Read, and Tag creation</li><li class="listitem"><span class="strong"><strong>- Not set</strong></span>: All others</li></ul></div></li></ul></div><p>Similarly, when <a id="id158" class="indexterm"/>creating a TFVC repository <a id="id159" class="indexterm"/>with in a Git Team Project that was created before TFS 2015 Update 1, the following folder level permissions need to be amended.</p><p>Go to the version control administration page and select the <code class="literal">$/_ProjectName_</code> node in the tree. To set up the same groups as any of the default process templates (Agile, Scrum, and CMMI), add the following TFS groups and grant the following permissions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">[ProjectName]\Readers<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>- Allow</strong></span>: Read</li><li class="listitem"><span class="strong"><strong>- Not set</strong></span>: All others</li></ul></div></li><li class="listitem">[ProjectName]\Contributors<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>- Allow</strong></span>: Check in, Check out, Label, Lock, Merge, and Read</li><li class="listitem"><span class="strong"><strong>- Not set</strong></span>: All others</li></ul></div></li><li class="listitem">[ProjectName]\Build Administrators<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>- Allow</strong></span>: Check in, Check out, Label, Lock, Merge, and Read</li><li class="listitem"><span class="strong"><strong>- Not set</strong></span>: All others</li></ul></div></li></ul></div><p>If your Team Project was created after TFS 2015 Update 1, these permissions will have already been applied for you, and no action is necessary except creating the repository.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the code hub in FabrikamTFVC Web Portal by browsing to <code class="literal">http://TFS2015:8080/DefaultCollection/FabrikamTFVC/_versionControl</code>.</li><li class="listitem">As illustrated in the following screenshot, click on <span class="strong"><strong>FabrikamTFVC</strong></span> to pull down the <span class="strong"><strong>Options</strong></span> menu. To create a new Git repository, click on <span class="strong"><strong>New repository...</strong></span> from the <span class="strong"><strong>Options</strong></span> menu. Name the repository <code class="literal">FabrikamFeature1</code> and click on <span class="strong"><strong>Create</strong></span>:<div class="mediaobject"><img src="../Images/image00363.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note20"/>Note</h3><p>Note that there is no support for creating multiple TFVC repositories within the same Team Project. There is support for creating multiple Git repositories.</p></div></li><li class="listitem">The<a id="id160" class="indexterm"/> create operation <a id="id161" class="indexterm"/>will redirect you to a Git getting started page. The getting started page allows you to generate a clone of the repository and command-line credentials, create a README file to describe your repository and provide commands to set up the Git repository to work with Xcode, Eclipse, and Visual Studio. Click on <span class="strong"><strong>Clone in Visual Studio</strong></span> to start working on the new repository in Visual Studio:<div class="mediaobject"><img src="../Images/image00364.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">As a result of this action, the repository is cloned in Visual Studio:<div class="mediaobject"><img src="../Images/image00365.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How it works...</h2></div></div></div><p>Many <a id="id162" class="indexterm"/>customers are actively using<a id="id163" class="indexterm"/> TFVC repositories and have a rich Work Item history and customization in their Team Project. To make it easy for these Teams to start using Git, the Team Project model in TFS has been modified to support multiple source control repositories. Hybrid projects allow creating as many Git repositories as you need in your TFVC project. This model now also supports creating a TFVC repository in a Git project.</p><p>Team Explorer has been enhanced in TFS Update 1 to provide support for operating the hybrid Team Project. As illustrated in the following image, the manage connections page in Team Explorer lists all source control repositories in the Team Project. The workflows in Team Explorer are adjusted based on the repository type you are connected to.</p><div class="mediaobject"><img src="../Images/image00366.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>The Web Portal also allows context switching between the TFVC and Git source control in the code hub. The workflows associated to the source control are made available based on the selection. For example, on selecting Git, you can see the option for Pull requests, while in the context of TFVC, you see the option for shelvesets.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>There's more...</h2></div></div></div><p>A recent roadmap of investments in Git experiences for Team Foundation Server and Visual Studio Online talks about support for Pull requests within Team Explorer and support for Git Large File Storage and GitFlow; you can read more about this at <a class="ulink" href="http://bit.ly/1RXQRS1">http://bit.ly/1RXQRS1</a>.</p></div></div>
<div class="section" title="Enabling code analysis check-in policy"><div class="titlepage" id="aid-RL0A2"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Enabling code analysis check-in policy</h1></div></div></div><p>Many<a id="id164" class="indexterm"/> organizations recommend certain checks be done before committing code into source control. The cost of fixing bad code increases overtime. There is incentive in identifying and fixing issues in code early. We discussed the definition of done in the previous chapter; think of this as the definition of check-in. In TFS, a check-in policy is a rule that is executed during the check-in operation to ensure that the selected change set is okay to commit. The check-in policies are stored on the server and executed on the client machines at the time of check-in. Check-in policies are only supported in TFVC projects. While TFS has some preconfigured check-in policies, several other check-in policies are added by TFS Power Tools. In this recipe, you'll learn how to configure the code analysis check-in policy. The code analysis check-in policy requires that code analysis is run before check-in.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>Getting ready</h2></div></div></div><p>To complete this recipe, you'll need:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">A TFVC Team Project called FabrikamTFVC. Refer to the <span class="emphasis"><em>Creating a Team Project using the Scrum Template</em></span> recipe in <a class="link" title="Chapter 1. Team Project Setup" href="part0016.xhtml#aid-F8901">Chapter 1</a>, <span class="emphasis"><em>Team Project Setup</em></span>, for instructions on how to create a TFVC Team Project.</li><li class="listitem">In order to configure check-in policies, you need to have the edit project-level information permission set to <span class="strong"><strong>Allow</strong></span> for your account. Add yourself. If you are part of the Project Administrators or Project Collection Administrators group, you'll already have this permission.<div class="note" title="Note"><h3 class="title"><a id="note21"/>Note</h3><p>Check-in policies that are defined using Team Explorer everywhere only apply when you check in using the Team Foundation Server plugin for Eclipse or the cross-platform command-line client for Team Foundation Server. If another client such as Team Portal or Team Explorer in Visual Studio is used, these policies do not apply. Similarly, policies that are defined using Team Portal or Team Explorer in Visual Studio are not applied when you check in using the Team Foundation Server plugin for Eclipse or the cross-platform command-line client for Team Foundation Server.</p></div></li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In <a id="id165" class="indexterm"/>Visual Studio, open Team Explorer and click on <span class="strong"><strong>Settings</strong></span>. Once navigated into the <span class="strong"><strong>Settings</strong></span> view, click on the <span class="strong"><strong>Source Control</strong></span> hyperlink. From the <span class="strong"><strong>Source Control Settings</strong></span> window, select the <span class="strong"><strong>Check-in Policy</strong></span> Tab. Click on the <span class="strong"><strong>Add</strong></span> button and select <span class="strong"><strong>Code Analysis</strong></span>, then click on <span class="strong"><strong>OK</strong></span>.<div class="mediaobject"><img src="../Images/image00367.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In the <span class="strong"><strong>Code Analysis Policy Editor</strong></span> window, from the rule set dropdown, select <span class="strong"><strong>Microsoft Managed Recommended Rules</strong></span> and click on <span class="strong"><strong>OK</strong></span>:<div class="mediaobject"><img src="../Images/image00368.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Check<a id="id166" class="indexterm"/> <span class="strong"><strong>Enforce check-in to only contain files that are part of current solution</strong></span>. This option allows you to stop the check-in of any file that is not part of the current solution. This is a good option to enable as developers can accidently check in files into the source control without linking the file to the solution. This can possibly result in build issues.<div class="mediaobject"><img src="../Images/image00369.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note22"/>Note</h3><p>The code analysis ruleset definitions are stored in the <code class="literal">C:\Program Files (x86)\Microsoft Visual Studio 14.0\Team Tools\Static Analysis Tools\Rule Sets</code> folder.</p></div></li><li class="listitem">From the FarbikamTFVC project, open <code class="literal">FabrikamFiber.CallCenter.sln</code>:<div class="mediaobject"><img src="../Images/image00370.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In <span class="strong"><strong>FabrikamFiber.Web</strong></span> from <code class="literal">Controllers</code>, open <code class="literal">HomeController.cs</code>:<div class="mediaobject"><img src="../Images/image00371.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Copy<a id="id167" class="indexterm"/> the following code in the <code class="literal">Index()</code> function of <code class="literal">HomeController.cs</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>try</strong></span>
<span class="strong"><strong>{}</strong></span>
<span class="strong"><strong>catch(Exception ex)</strong></span>
<span class="strong"><strong>{}</strong></span>
</pre></div></li><li class="listitem">From Team Explorer, navigate to the pending changes window and check in the code changes into TFS. A policy warning is issued since the static code analysis hasn't been run:<div class="mediaobject"><img src="../Images/image00372.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Double-click on the warning message to see the details:<div class="mediaobject"><img src="../Images/image00373.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Trigger<a id="id168" class="indexterm"/> code analysis by selecting <span class="strong"><strong>Run Code Analysis on Solution</strong></span> from the <span class="strong"><strong>Analyze</strong></span> menu in Visual Studio:<div class="mediaobject"><img src="../Images/image00374.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Code analysis finds the issue with the newly added code. The developer would have missed this if the code analysis wasn't run. The code analysis policy ensures that code analysis is run before the code can be checked in:<div class="mediaobject"><img src="../Images/image00375.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Since code analysis has now been run, checking in the code will not issue a check-in policy violation warning message.<div class="mediaobject"><img src="../Images/image00376.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>How it works...</h2></div></div></div><p>Check-in policies are used to enforce mandatory software development practices. Policy is enforced during the check-in process. Since TFVC check-ins are processed on the server, the check-in request is intercepted to force an execution of the check-in policy on the client side. If a user attempts to perform a check-in, in violation of a policy, the check-in is blocked.</p><p>There <a id="id169" class="indexterm"/>are four Team Project check-in policies<a id="id170" class="indexterm"/> that can be specified (in order to use check-in policies, you need to be connected to Team Foundation Server):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Builds</strong></span>: This requires <a id="id171" class="indexterm"/>that any build breaking issues that were created during a build must be fixed before a new check-in.</li><li class="listitem"><span class="strong"><strong>Code analysis</strong></span>: This <a id="id172" class="indexterm"/>requires that the code analysis is run before check-in.</li><li class="listitem"><span class="strong"><strong>Testing policy</strong></span>: This <a id="id173" class="indexterm"/>requires that check-in tests are completed before check-in.</li><li class="listitem"><span class="strong"><strong>Work Items</strong></span>: This<a id="id174" class="indexterm"/> requires that one or more Work Items be associated with the check-in.</li></ul></div><p>The check-in policy can be overridden by clicking on the <span class="strong"><strong>Override Warnings</strong></span> hyperlink; you can continue to check in the code after providing a reason for the override:</p><div class="mediaobject"><img src="../Images/image00377.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note23"/>Note</h3><p>You can turn off the policy override option in Team Explorer using a <a id="id175" class="indexterm"/>no policy override server side plugin. Read the following blog post for more details <a class="ulink" href="http://bit.ly/1jUhZ9y">http://bit.ly/1jUhZ9y</a>.</p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>There's more...</h2></div></div></div><p>So far, we have <a id="id176" class="indexterm"/>talked about check-in policies for TFVC projects. Using the TFS API, it is possible to create a custom check-in policy for Git projects. The server-side plugin listens for the <code class="literal">PushNotification</code> that is raised at the time of Git push event. Refer to <a class="ulink" href="http://bit.ly/1OabagX">http://bit.ly/1OabagX</a> on how to create a server-side check-in policy<a id="id177" class="indexterm"/> for Git repositories to validate that a commit message has been associated with the push.</p></div></div>
<div class="section" title="Performing a baseless merge between sibling branches in TFVC"><div class="titlepage" id="aid-SJGS2"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Performing a baseless merge between sibling branches in TFVC</h1></div></div></div><p>Managing <a id="id178" class="indexterm"/>source code can get <a id="id179" class="indexterm"/>challenging when multiple <a id="id180" class="indexterm"/>Teams are contributing to the same repository. Are you already familiar with the branching and merging tools available in TFS? If not, I would encourage you to go through the ALM Rangers Version Control Guidance<a id="id181" class="indexterm"/> <a class="ulink" href="http://bit.ly/1He8pmL">http://bit.ly/1He8pmL</a>. The guidance talks in detail about the various branching strategy and its pros and cons.</p><div class="mediaobject"><img src="../Images/image00378.jpeg" alt="Performing a baseless merge between sibling branches in TFVC"/><div class="caption"><p>An extract from the ALM Rangers Version Control Guide showing different branching strategies</p></div></div><p style="clear:both; height: 1em;"> </p><p>Branching in TFVC can get complicated over time; branching in Git is lightweight and path independent. In Git, many developers create a branch for each new feature they are coding, sometimes on a daily basis. Git allows you to quickly switch from one branch to another to pivot among different variations of your codebase. When using Git, you can create branches that exist only on your Dev machine and share them if and when you're ready. Consider evaluating your source control requirements against the workflow at <a class="ulink" href="http://bit.ly/1P7UMvO">http://bit.ly/1P7UMvO</a>; you may find Git a better fit.</p><p>In this recipe, you will learn how to carry out a merge operation between two unrelated TFVC branches often referred to as sibling branches.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>Getting ready</h2></div></div></div><p>In your <a id="id182" class="indexterm"/>TFVC-based Team <a id="id183" class="indexterm"/>Project, create a branching <a id="id184" class="indexterm"/>structure as illustrated in the following diagram. You can use the TFS Community Branch Tool extension<a id="id185" class="indexterm"/> to automate the creation of the branch, as illustrated in the following diagram (<a class="ulink" href="http://bit.ly/1LZR2bx">http://bit.ly/1LZR2bx</a>):</p><div class="mediaobject"><img src="../Images/image00379.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>We'll be working through the following scenario in this recipe. The developer working on <span class="strong"><strong>Dev</strong></span> branch has found a critical issue that he has resolved with a code check-in. The QA branch is already being used by another developer to carry out some unrelated work. To get the fix from <span class="strong"><strong>Dev</strong></span> branch into production, the developer decides to perform a baseless merge between the <span class="strong"><strong>Dev</strong></span> and <span class="strong"><strong>Prod</strong></span> branch.</p><p>In order to perform a merge operation, your user account needs to have the merge permission. The project administrator group already grants this permission; however, this permission can be set to Allow directly on individual users and groups:</p><div class="mediaobject"><img src="../Images/image00380.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec55"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In <a id="id186" class="indexterm"/>Visual <a id="id187" class="indexterm"/>Studio, open<a id="id188" class="indexterm"/> Team Explorer, and navigate to the Source Control Explore. Perform a <span class="strong"><strong>Get Latest Version</strong></span> operation on the FabrikamTFVC Team Project:<div class="mediaobject"><img src="../Images/image00381.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">To simulate a fix being made in the <span class="strong"><strong>Dev</strong></span> branch, open the <code class="literal">$\Dev\FabrikamFiber.CallCenter\FabrikamFiber.Web\Controllers\HomeController.cs</code> file and copy the following comment in the <code class="literal">Index</code> method:<div class="mediaobject"><img src="../Images/image00382.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Check in the code changes to this file from the pending changes view in Team Explorer:</p><div class="mediaobject"><img src="../Images/image00383.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now <a id="id189" class="indexterm"/>that the<a id="id190" class="indexterm"/> critical <a id="id191" class="indexterm"/>change is in the Dev branch, let's look at the steps required to carry out the baseless merge of this change from the Dev branch to the Prod branch. From the source control explorer, right-click on the <span class="strong"><strong>Dev</strong></span> branch and choose <span class="strong"><strong>Merge...</strong></span> from under the <span class="strong"><strong>Branching and Merging</strong></span> submenu:<div class="mediaobject"><img src="../Images/image00384.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The <span class="strong"><strong>Merge</strong></span> wizard will not show the <span class="strong"><strong>Prod</strong></span> branch in the <span class="strong"><strong>Target branch</strong></span> dropdown. Unrelated branches can only be selected using the <span class="strong"><strong>Browse...</strong></span> button. Click on <span class="strong"><strong>Browse...</strong></span> and select <span class="strong"><strong>Prod</strong></span> branch. Then, click on <span class="strong"><strong>OK</strong></span>:<div class="mediaobject"><img src="../Images/image00385.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">A<a id="id192" class="indexterm"/> warning <a id="id193" class="indexterm"/>sign shows up <a id="id194" class="indexterm"/>next to <span class="strong"><strong>Target branch</strong></span> indicating that the chosen branch is unrelated and will cause a baseless merge:<div class="mediaobject"><img src="../Images/image00386.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> to navigate to the next screen:<div class="mediaobject"><img src="../Images/image00387.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note24"/>Note</h3><p>If the selection is changed from <span class="strong"><strong>All changes</strong></span> to <span class="strong"><strong>Selected changesets</strong></span> then a merge relationship between the two branches has not been established. While you would still be able to merge the change, you won't be able to visualize it.</p></div></li><li class="listitem">Keep the <span class="strong"><strong>Latest Version</strong></span> selected in the dropdown and click on <span class="strong"><strong>Next</strong></span>:<div class="mediaobject"><img src="../Images/image00388.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Once the merge operation has completed, you'll be navigated to the <span class="strong"><strong>Resolve Conflicts</strong></span> window. Click on <span class="strong"><strong>Merge Changes In Merge Tool</strong></span>, then check and click on <span class="strong"><strong>Accept Merge</strong></span>:<div class="mediaobject"><img src="../Images/image00389.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The <a id="id195" class="indexterm"/><span class="strong"><strong>Resolve Conflicts</strong></span> window<a id="id196" class="indexterm"/> will clear<a id="id197" class="indexterm"/> of any conflicts once the merge has completed. From the pending changes viewed in Team Explorer, check in the pending changes:<div class="mediaobject"><img src="../Images/image00390.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">From the Source Control Explorer, right-click on the <span class="strong"><strong>Prod</strong></span> branch and choose <span class="strong"><strong>View History</strong></span>. Check all the branches and click on <span class="strong"><strong>Visualize</strong></span>. The dashed line from Dev to Prod represents the baseless merge.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec56"/>How it works…</h2></div></div></div><p>When a <a id="id198" class="indexterm"/>baseless merge is carried <a id="id199" class="indexterm"/>out, a relationship is <a id="id200" class="indexterm"/>established between the two sibling branches. The baseless merge is represented by the dashed line:</p><div class="mediaobject"><img src="../Images/image00391.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>To get a view of the timeline of the change, hit the <span class="strong"><strong>Timeline Tracking</strong></span> view at the top of the screen:</p><div class="mediaobject"><img src="../Images/image00392.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p></div></div>
<div class="section" title="Reparenting a branch in TFVC"><div class="titlepage" id="aid-TI1E2"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Reparenting a branch in TFVC</h1></div></div></div><p>Team Foundation Version Control provides you with an <a id="id201" class="indexterm"/>option to<a id="id202" class="indexterm"/> prune a branch from somewhere in a given hierarchy and graft it on elsewhere in the same hierarchy. Consider using this approach if the branch structure you put in place is incorrectly set up or has stopped working as you have scaled up. In this recipe, you'll learn how to reparent a branch in TFVC.</p><div class="note" title="Note"><h3 class="title"><a id="note25"/>Note</h3><p>The movement of the reparented branch is logical not physical and can be done without stopping developers from working. However, it's a good idea to get developers to shelve changes. You should also endeavor to make the new parent as close in content to the old parent to avoid merge conflicts.</p></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec57"/>Getting ready</h2></div></div></div><p>In order to reparent a branch, your user account needs to have the <span class="strong"><strong>Manage branch</strong></span> permission. The project administrator group and project collection administrator group already grant this permission; however, this permission can be set to allow directly on individual users and groups:</p><div class="mediaobject"><img src="../Images/image00393.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>The <span class="strong"><strong>Manage branch</strong></span><a id="id203" class="indexterm"/> permission allows you to perform the<a id="id204" class="indexterm"/> following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Convert a folder into a branch</li><li class="listitem">Execute the following actions<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Edit the branch properties</li><li class="listitem">Reparent the branch</li><li class="listitem">Convert the branch into a folder</li></ul></div></li></ul></div><p>In your TFVC project, create a branching structure as illustrated in the figure on the left:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td valign="top">
<div class="mediaobject"><img src="../Images/image00394.jpeg" alt="Getting ready"/><div class="caption"><p>Current branching structure</p></div></div><p style="clear:both; height: 1em;"> </p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00395.jpeg" alt="Getting ready"/><div class="caption"><p>Desired branching structure</p></div></div><p style="clear:both; height: 1em;"> </p>
</td></tr></tbody></table></div><p>The scenario we'll be working through in this recipe, as illustrated in the figure on the left, is the Development Team releases from the <span class="strong"><strong>Main</strong></span> branch; <span class="strong"><strong>Release 1.1</strong></span> was branched from <span class="strong"><strong>Release 1</strong></span>. As illustrated in the figure on the right, the Team wants to move <span class="strong"><strong>Release 1.1</strong></span> directly under the <span class="strong"><strong>Main</strong></span> branch, so changes don't need to go through <span class="strong"><strong>Release 1</strong></span> to be merged to <span class="strong"><strong>Release 1.1</strong></span>.</p><p>To reparent <a id="id205" class="indexterm"/>the branch <span class="strong"><strong>Release 1.1</strong></span> from <span class="strong"><strong>Release 1</strong></span> to <span class="strong"><strong>Main</strong></span>, a <a id="id206" class="indexterm"/>relationship needs to be established between the two branches. This can only be done by performing a baseless merge between the two branches. Refer to the <span class="emphasis"><em>Performing a baseless merge between sibling branches in TFVC</em></span> recipe to learn how to perform a baseless merge.</p><div class="mediaobject"><img src="../Images/image00396.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>This recipe assumes that a merge relationship has been established between the <span class="strong"><strong>Main</strong></span> and <span class="strong"><strong>Release 1.1</strong></span> branch. In the preceding figure, the dashed line represents a relationship between the two branches.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec58"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to Source Control Explorer, right-click on the branch <span class="strong"><strong>Release 1.1</strong></span> and choose <span class="strong"><strong>Reparent...</strong></span> from the <span class="strong"><strong>Branching and Merging</strong></span> submenu:<div class="mediaobject"><img src="../Images/image00397.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In the <span class="strong"><strong>Reparent</strong></span> window, you'll see a list of all branches that have a direct or indirect relationship with <span class="strong"><strong>Release 1.1</strong></span>. Select <span class="strong"><strong>Main</strong></span> and click on <span class="strong"><strong>Reparent</strong></span>. Selecting <span class="strong"><strong>No parent</strong></span> will make <span class="strong"><strong>Release 1.1</strong></span> an independent branch:<div class="mediaobject"><img src="../Images/image00398.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The <a id="id207" class="indexterm"/>reparent operation takes place on the<a id="id208" class="indexterm"/> server. You will not see any pending changes as a result of the reparent operation. The branch hierarchy after the reparent operation is as follows:<div class="mediaobject"><img src="../Images/image00399.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec59"/>How it works…</h2></div></div></div><p>Once the reparent operation has been completed, you can view the updated branch hierarchy by right-clicking on the <span class="strong"><strong>Release1.1</strong></span> branch and choosing <span class="strong"><strong>Properties</strong></span> from under the <span class="strong"><strong>Advanced</strong></span> submenu:</p><div class="mediaobject"><img src="../Images/image00400.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>Click on the <span class="strong"><strong>Relationships</strong></span> tab from the left menu to see the branch relationships.</p></div></div>
<div class="section" title="Unlocking files checked out by someone else" id="aid-UGI01"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Unlocking files checked out by someone else</h1></div></div></div><p>In distributed <a id="id209" class="indexterm"/>Teams, developers often have pending changes that overlap shared code files. Don't you hate it when a developer takes a day off with files exclusively checked out to them or when a developer leaves an organization with files still checked out? When a file is exclusively locked, no check-in can be performed on the file until the lock is removed. In this recipe, you'll learn how to unlock files checked out by other users.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec60"/>Getting ready</h2></div></div></div><p>To undo the pending changes in another user's workspace, you must have the <span class="strong"><strong>Administer workspaces</strong></span> permission set to <span class="strong"><strong>Allow</strong></span>:</p><div class="mediaobject"><img src="../Images/image00401.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec61"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Developer <span class="emphasis"><em>A</em></span> has checked out <code class="literal">$/FabrikamTFVC/Main/Source/FabrikamFiber.CallCenter/FabrikamFiber.Web/Web.config</code> in the FabrikamTFVC project with a check-in lock type. So while other users can check out the <code class="literal">Web.config</code> file, no one can check in <code class="literal">Web.config</code> until developer <span class="emphasis"><em>A</em></span> has lifted this lock:<div class="mediaobject"><img src="../Images/image00402.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><p>In the following image, <code class="literal">Web.config</code> is checked out with the check-in lock. This is represented by <span class="strong"><strong>lock</strong></span> in the <span class="strong"><strong>Pending Change</strong></span> column:</p><div class="mediaobject"><img src="../Images/image00403.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now <a id="id210" class="indexterm"/>developer <span class="emphasis"><em>B</em></span> checks out <code class="literal">Web.config</code> and adds a new section to the config file. To commit changes into version control, developer <span class="emphasis"><em>B</em></span> tries to check in the file. The check-in fails with the following message.<div class="mediaobject"><img src="../Images/image00404.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note26"/>Note</h3><p>The following issues were encountered during check-in:</p><p><code class="literal">Unable to perform operation on $/Fabrikam/Main/…/Web.config. The item $/Fabrikam/Main/ …/Web.config is locked in workspace TFS2015;DeveloperA</code>.</p></div></li><li class="listitem">Developer <span class="emphasis"><em>B</em></span> opens the "Developer Command Prompt for Visual Studio 2015" and runs the following command to undo the changes of developer <span class="emphasis"><em>A</em></span>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>tf undo /workspace:TFS2015;"Developer A" /recursive $/FabrikamTFVC/Main/Source/FabrikamFiber.CallCenter/FabrikamFiber.Web/Web.config" /collection:"http://tfs2015:8080/tfs"</strong></span>
</pre></div><p>Key in <span class="emphasis"><em>Y</em></span> when prompted for confirmation of undo. Optionally, use the <code class="literal">/silent</code> switch in the preceding command for no prompt:</p><div class="mediaobject"><img src="../Images/image00405.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><p>Developer <span class="emphasis"><em>B</em></span> can now successfully check-in the file through the Visual Studio pending changes window.</p><div class="note" title="Note"><h3 class="title"><a id="note27"/>Note</h3><p>While the lock developer <span class="emphasis"><em>A</em></span> had on the <code class="literal">app.config</code> has been removed, any pending changes that developer <span class="emphasis"><em>A</em></span> might have had in the config file on his machine aren't. So, developer <span class="emphasis"><em>A</em></span> can perform a <code class="literal">get</code> operation to pull down developer <span class="emphasis"><em>B</em></span>'s changes and merge and continue as appropriate without any information loss.</p></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec62"/>There's more...</h2></div></div></div><p>TFS Power Tools provides<a id="id211" class="indexterm"/> an option to undo pending changes for other users right from within Visual Studio. If you don't have TFS Power Tools installed, refer to the <span class="emphasis"><em>Creating a new Team Project through the command line</em></span> recipe in <a class="link" title="Chapter 1. Team Project Setup" href="part0016.xhtml#aid-F8901">Chapter 1</a>, <span class="emphasis"><em>Team Project Setup</em></span>.</p><p>Right-click on the file or folder you want to undo. From the context menu, choose <span class="strong"><strong>Find by Status...</strong></span> from under the <span class="strong"><strong>Find</strong></span> in Source Control submenu. You can narrow the search by specifying wildcard and username. The results are presented in <span class="strong"><strong>Find</strong></span> in the Source Control window:</p><div class="mediaobject"><img src="../Images/image00406.jpeg" alt="There's more..."/></div><p style="clear:both; height: 1em;"> </p><p>Simply select the file and choose <span class="strong"><strong>Undo...</strong></span> from the context menu to undo the pending changes.</p></div></div>
<div class="section" title="Unshelving a shelveset created in one branch to another branch" id="aid-VF2I1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Unshelving a shelveset created in one branch to another branch</h1></div></div></div><p>When using <a id="id212" class="indexterm"/>TFVC, you'll find shelvesets very useful. Shelvesets allow you to effectively back up your local copy of the changes on to the server. Developers are multitasking almost all the time; you may start coding a change in one branch and then realize that the change actually needs to be applied in another branch. In this recipe, you'll learn how to shelve changes in one code branch and then migrate the changes over to another branch without checking in the changes into source control.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec63"/>Getting ready</h2></div></div></div><p>The FabrikamTFVC project has three branches, <span class="strong"><strong>Dev</strong></span>, <span class="strong"><strong>Main</strong></span>, and <span class="strong"><strong>Prod</strong></span>, as illustrated in the following diagram. In this recipe, we'll create a shelveset <code class="literal">shelvesetDev1</code> from the pending changes in the <span class="strong"><strong>Dev</strong></span> branch and unshelve the pending changes over to the <span class="strong"><strong>Prod</strong></span> branch without checking in the pending changes:</p><div class="mediaobject"><img src="../Images/image00407.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>This recipe requires the use of the <code class="literal">tfpt</code> command-line utility. This utility is installed with TFS Power Tools. If you don't have TFS Power Tools installed, refer to the <span class="emphasis"><em>Creating a new Team Project through the command line</em></span> recipe in <a class="link" title="Chapter 1. Team Project Setup" href="part0016.xhtml#aid-F8901">Chapter 1</a>, <span class="emphasis"><em>Team Project Setup</em></span>.</p><p>Perform a <code class="literal">get latest</code> operation on both the <span class="strong"><strong>Dev</strong></span> and <span class="strong"><strong>Prod</strong></span> branch to ensure that they are up to date. Ensure that there are no pending changes in the <span class="strong"><strong>Prod</strong></span> branch. If the branches are not up to date, the following error message may be issued during the unshelve operation: <code class="literal">Unable to determine the workspace</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec64"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In Team Explorer, open Source Control Explorer and check out the <code class="literal">$\Dev\FabrikamFiber.CallCenter\FabrikamFiber.Web\Controllers\HomeController.cs</code> file and copy the following comment in the <code class="literal">Index</code> method:<p>// Assume this is a critical fix to this method:</p><div class="mediaobject"><img src="../Images/image00382.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate<a id="id213" class="indexterm"/> to the <span class="strong"><strong>Pending Changes</strong></span> view in Team Explorer and click on the <span class="strong"><strong>Shelve</strong></span> hyperlink. Enter the shelveset name as <code class="literal">shelvesetDev1</code> and click on the <span class="strong"><strong>Shelve</strong></span> button:<div class="mediaobject"><img src="../Images/image00408.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open up the Visual Studio Developer Command Prompt and change the working directory to the target branch workspace directory. The target branch in this case is <code class="literal">Prod</code>:<div class="mediaobject"><img src="../Images/image00409.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Run the following command to migrate the shelveset from <span class="strong"><strong>Dev</strong></span> to <span class="strong"><strong>Prod</strong></span> branch:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>tfpt unshelve /migrate /source:"$/FabrikamTFVC/Dev" /target:"$/FabrikamTFVC/Prod" "shelvesetDev1"</strong></span>
</pre></div></li><li class="listitem">In the <span class="strong"><strong>Shelveset Details</strong></span> window, click on the <span class="strong"><strong>Unshelve</strong></span> button to continue:<div class="mediaobject"><img src="../Images/image00410.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The <a id="id214" class="indexterm"/>merge button is enabled if TFS recons it can resolve the merge conflict. The <span class="strong"><strong>Resolve</strong></span> button is enabled if TFS requires the conflict to be manually resolved. Click on the <span class="strong"><strong>Auto-merge All</strong></span> button to continue:<div class="mediaobject"><img src="../Images/image00411.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Once the auto merge operation has been completed, confirmation message is published in the command prompt:<div class="mediaobject"><img src="../Images/image00412.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In Source Control Explorer, navigate across to the <span class="strong"><strong>Prod</strong></span> branch. Open <code class="literal">HomeController.cs</code> from <code class="literal">$\Prod\FabrikamFiber.CallCenter\FabrikamFiber.Web\Controllers</code>. The changes made in the <span class="strong"><strong>Dev</strong></span> version of the <code class="literal">HomeController.cs</code> file will reflect in the <span class="strong"><strong>Prod</strong></span> branch version of <code class="literal">HomeController.cs</code>:<div class="mediaobject"><img src="../Images/image00413.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Ignoring file types from check-in using .tfignore and .gitignore"><div class="titlepage" id="aid-10DJ42"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Ignoring file types from check-in using .tfignore and .gitignore</h1></div></div></div><p>Traditionally, TFS <a id="id215" class="indexterm"/>only supported server workspaces. Local <a id="id216" class="indexterm"/>workspaces were rolled out in TFS 2012. A local <a id="id217" class="indexterm"/>workspace allows you to work <a id="id218" class="indexterm"/>disconnected from the server. All core version control operations can be performed without any server connectivity. Local workspaces listen for changes on the filesystem to infer the operations being performed. For example, a new file created in the workspace directly from the filesystem will show up as a pending change. Users who used Subversion source control will be familiar with local workspaces. Read more about the workings of local workspaces<a id="id219" class="indexterm"/> at <a class="ulink" href="https://msdn.microsoft.com/en-us/library/bb892960.aspx">https://msdn.microsoft.com/en-us/library/bb892960.aspx</a>.</p><p>Many tools and extensions that work in concert with Visual Studio generate temporary files within the local workspace directories. For example, ReSharper, a developer productivity extension for Visual Studio, generates <code class="literal">_Resharper.[SolutionName]</code> files that are (by default) included in pending changes. These temporary files serve no benefit in version control and should be ignored; <code class="literal">.tfignore</code> and <code class="literal">.gitignore</code> allow you to do just that. File types to be ignored can be specified in <code class="literal">.tfignore</code> and <code class="literal">.gitignore</code>; these rules are used to automatically exclude specified file types from pending changes. In this recipe, you'll learn how to create <code class="literal">.tfignore</code> and <code class="literal">.gitignore</code> files to automatically exclude certain file types.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec65"/>Getting ready</h2></div></div></div><p>To work through the recipe, you'll need to create a local workspace. Follow the instructions to create a local workspace in the FabrikamTFVC project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the local drive, create a folder, <code class="literal">Wks</code>. This recipe assumes the folder to be <code class="literal">C:\Wks</code>.</li><li class="listitem">Open Team Explorer in Visual Studio and connect to the FabrikamTFVC Team Project.</li><li class="listitem">From the Visual Studio menu, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Source Control</strong></span> | <span class="strong"><strong>Advanced</strong></span> | <span class="strong"><strong>Workspaces</strong></span>:<div class="mediaobject"><img src="../Images/image00414.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In the <a id="id220" class="indexterm"/><span class="strong"><strong>Manage workspace</strong></span> window, click<a id="id221" class="indexterm"/> on <span class="strong"><strong>Add</strong></span>. In <span class="strong"><strong>Add workspace</strong></span>, create <a id="id222" class="indexterm"/>the workspace <code class="literal">TFS2015_99</code> mapped<a id="id223" class="indexterm"/> from <code class="literal">$/FabrikamTFVC/Main</code> to <code class="literal">C:\Wks</code>. Click on the <span class="strong"><strong>Advanced&gt;&gt;</strong></span> button and confirm if the workspace location is set to <span class="strong"><strong>Local</strong></span>. Then, click on <span class="strong"><strong>OK</strong></span>:<div class="mediaobject"><img src="../Images/image00415.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">After clicking on <span class="strong"><strong>OK</strong></span>, accept the prompt to perform a get latest operation to download the source code into the new local workspace.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec66"/>How to do it...</h2></div></div></div><p>Perform the following steps to set up the <code class="literal">.tfignore</code> files for TFVC-based source controls:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\Wks</code> and create a new file <code class="literal">ThisIsAFakeClass.txt</code>.</li><li class="listitem">In Team Explorer, navigate to the <span class="strong"><strong>Pending Changes</strong></span> view for FabrikamTFVC project. In the <span class="strong"><strong>Excluded Changes</strong></span> section, the count of detected shows up as 1.<div class="mediaobject"><img src="../Images/image00416.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the<a id="id224" class="indexterm"/> <span class="strong"><strong>Detected items</strong></span> hyperlink. From <a id="id225" class="indexterm"/>the <span class="strong"><strong>Promote Candidate Changes</strong></span><a id="id226" class="indexterm"/> window, right-click<a id="id227" class="indexterm"/> on <code class="literal">ThisIsAFakeFile.txt</code> and choose <span class="strong"><strong>Ignore by extension (*.txt)</strong></span>:<div class="mediaobject"><img src="../Images/image00417.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><p>The <code class="literal">.tfignore</code> file is automatically created for you and shows up in the <span class="strong"><strong>Pending Changes</strong></span> view. Open <code class="literal">.tfignore</code>; the extension <code class="literal">*.txt</code> has been added as an item to be ignored. Copy the following text into the <code class="literal">.tfignore</code> file to ignore all ReSharper generated files:</p><div class="informalexample"><pre class="programlisting">######################################
*.txt
# Ignore Reshaprer files
*_ReSharper.*
*.DotSettings</pre></div></li><li class="listitem">Check in the <code class="literal">.tfignore</code> file into the version control; this ruleset will be evaluated on all developer workstations to ignore all files specified in this <code class="literal">.tfignore</code> file.<div class="note" title="Note"><h3 class="title"><a id="note028"/>Note</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">TFVC honors multiple <code class="literal">.tfignore</code> files, where a <code class="literal">.tfignore</code> file in the scope of the project can override the ignore specification in the <code class="literal">.tfignore</code> file at the solution level.</li><li class="listitem">TFVC accepts exclusion rules, for example, to ignore all TXT files except <code class="literal">help.txt</code> use <code class="literal">!help.txt</code>.</li></ul></div></div></li></ol><div style="height:10px; width: 1px"/></div><p>Perform the following steps to set up the <code class="literal">.gitignore</code> files for Git-based source controls:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In Team Explorer, open the FabrikamGit project and navigate to the <span class="strong"><strong>Settings</strong></span> view. Click on the <span class="strong"><strong>Repository Settings</strong></span> hyperlink. Then, click on <span class="strong"><strong>Add</strong></span> to create a <code class="literal">.gitIgnore</code> file:<div class="mediaobject"><img src="../Images/image00418.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click <a id="id228" class="indexterm"/>on the <span class="strong"><strong>Edit</strong></span> hyperlink to edit the <code class="literal">.gitignore</code> file. Copy<a id="id229" class="indexterm"/> the following<a id="id230" class="indexterm"/> items<a id="id231" class="indexterm"/> in the <code class="literal">.gitIgnore</code> file:<div class="informalexample"><pre class="programlisting"># User-specific files
*.suo
*.user
*.sln.docstates
# Specific files 
*.txt
# Build results
[Dd]ebug/
[Rr]elease/</pre></div></li><li class="listitem">In Team Explorer, navigate to the <span class="strong"><strong>Changes</strong></span> view and commit the <code class="literal">.gitIgnore</code> file. Click on the <span class="strong"><strong>Sync</strong></span> hyperlink to push the updated <code class="literal">.gitIgnore</code> to the repository. All developer workspaces will now ignore the file extensions specified in this <code class="literal">.gitignore</code> file.</li></ol><div style="height:10px; width: 1px"/></div><div class="note" title="Note"><h3 class="title"><a id="note28"/>Note</h3><p>Git honors multiple <code class="literal">.gitIgnore</code> files, where a <code class="literal">.gitIgnore</code> file in the scope of the project can override the ignore specification file at the solution level.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec67"/>There's more…</h2></div></div></div><p>The <code class="literal">tfpt</code> command-line utility installed with TFS Power Tools among other things provides you with two very useful switches: <code class="literal">scortch</code> and <code class="literal">treeclean</code>. <code class="literal">scortch</code> and <code class="literal">treeclean</code> allow you to mirror the workspace as on the server and remove any unwanted clutter from the workspace. Learn more <a id="id232" class="indexterm"/>about <code class="literal">scortch</code> and <code class="literal">treeclean</code> <a id="id233" class="indexterm"/>at <a class="ulink" href="http://adamprescott.net/2011/09/12/clean-tfs-workspaces-with-scorch-treeclean">http://adamprescott.net/2011/09/12/clean-tfs-workspaces-with-scorch-treeclean</a>.</p></div></div>
<div class="section" title="Conducting code reviews in TFS"><div class="titlepage" id="aid-11C3M2"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Conducting code reviews in TFS</h1></div></div></div><p>In the <a id="id234" class="indexterm"/>introduction to this chapter, we briefly talked<a id="id235" class="indexterm"/> about technical debt and how it can impact the productivity of a Team. The use of good engineering practices helps tackle issues that are potential contributors to technical debt. There is a consensus across the industry that code review is an effective and practical way to collar code inconsistency and possible defects early in the software development life cycle.</p><p>A study on the value and importance of code reviews conducted by Forrester Consulting highlighted the following as perceived benefits of code review:</p><div class="mediaobject"><img src="../Images/image00419.jpeg" alt="Conducting code reviews in TFS"/><div class="caption"><p>Source - <a class="ulink" href="http://www.klocwork.com/getattachment/08c47c41-053c-4fe8-bbf7-91b95734747c/The-Value-and-Importance-of-Code-Review-Forrester?sitename=Klocwork">http://www.klocwork.com/getattachment/08c47c41-053c-4fe8-bbf7-91b95734747c/The-Value-and-Importance-of-Code-Review-Forrester?sitename=Klocwork</a></p></div></div><p style="clear:both; height: 1em;"> </p><p>TFS offers two code review solutions, one through Team Explorer and the other through Team Web Access. The code review solution in Team Explorer, first introduced in TFS 2012, receives criticism for not supporting iterative reviews. On the other hand, the solution in Team Web Access called lightweight code commenting supports iterative reviews, but does not support an integrated Visual Studio IDE experience. You can learn more about the code review solution available in Team Explorer<a id="id236" class="indexterm"/> at <a class="ulink" href="https://www.visualstudio.com/en-us/get-started/code/get-code-reviewed-vs">https://www.visualstudio.com/en-us/get-started/code/get-code-reviewed-vs</a>. In this recipe, you'll learn how to use the lightweight code commenting in Team Web Access to conduct code reviews.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec68"/>Getting ready</h2></div></div></div><p>In this recipe, <a id="id237" class="indexterm"/>we'll be working through the following <a id="id238" class="indexterm"/>scenario – Aaron is a developer on the FabrikamTFVC Team. He is working on a new feature in the <code class="literal">FabrikamFiber.CallCenter.sln</code> Dev codebase to show the <code class="literal">CreatedBy</code> column on the service ticket dashboard. Aaron has checked in his changes (this has created <span class="strong"><strong>Changeset 27</strong></span>) and he now wants Tarun to perform a code review on the changes. Aaron sends Tarun the changeset by clicking on the share changeset icon in Team Web Access:</p><div class="mediaobject"><img src="../Images/image00420.jpeg" alt="Getting ready"/><div class="caption"><p>Initiate a code review by clicking the e-mail icon from the Changeset view</p></div></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="tip04"/>Tip</h3><p><span class="strong"><strong>Downloading the example code</strong></span></p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec69"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Tarun receives an e-mail for a feedback request. Clicking on hyperlink <span class="strong"><strong>Changeset 27</strong></span> opens the changeset in review mode, highlighting the code changes in a comparison mode. The changes can also be viewed in side-by-side comparison by clicking on the file name hyperlink:<div class="mediaobject"><img src="../Images/image00421.jpeg" alt="How to do it…"/><div class="caption"><p>Code comparison window is launched by clicking on the Changeset hyperlink, in this case Changeset 27</p></div></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Looking<a id="id239" class="indexterm"/> through the <code class="literal">Index.cshtml</code>, Tarun<a id="id240" class="indexterm"/> find a few issues. He selects the code with the issue and adds an inline comment:<div class="mediaobject"><img src="../Images/image00422.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Tarun adds an overall comment to the changeset using the <span class="strong"><strong>Add Comment</strong></span> button at the top of the changeset:<div class="mediaobject"><img src="../Images/image00423.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Tarun submits his feedback by clicking on the <span class="strong"><strong>Sharechangeset</strong></span> button. The e-mail contains a list of all the comments.<div class="mediaobject"><img src="../Images/image00424.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Aaron <a id="id241" class="indexterm"/>goes through and fixes the issues <a id="id242" class="indexterm"/>highlighted by Tarun. Aaron thinks Tarun's comment on pagination and filter should be build out as a common capability. Aaron creates a product backlog item from the code comment and adds it to the Team's backlog:<div class="mediaobject"><img src="../Images/image00425.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec70"/>How it works…</h2></div></div></div><p>Lightweight code commenting is a browser-based code commenting solution in Team Web Access. It provides a nice inline experience for commenting either on whole files or on individual changes. Code commenting enables interactive or time shifted conversations about code. Code commenting is done in a browser so, among other things, it will work wherever you are – including on your mobile phone.</p><p>The comments are stored in Team Foundation Server in context to the code. If the code or the underlying code file is removed, the code comment associated to it is automatically removed. Work items created from comments include a reference back to the comment; this helps maintain traceability:</p><div class="mediaobject"><img src="../Images/image00426.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec71"/>There's more...</h2></div></div></div><p>While there is a consensus that code reviews are important, the industry is heavily divided whether code reviews should be done before or after check-in. Refer to the following blog post that talks about the pros and cons of both approaches:</p><p><a class="ulink" href="http://geekswithblogs.net/TarunArora/archive/2012/09/18/vs-2012-code-review-ndash-before-check-in-or-after.aspx">http://geekswithblogs.net/TarunArora/archive/2012/09/18/vs-2012-code-review-ndash-before-check-in-or-after.aspx</a></p></div></div>
<div class="section" title="Setting up policies for branches in Git" id="aid-12AK81"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Setting up policies for branches in Git</h1></div></div></div><p>Building <a id="id243" class="indexterm"/>on the theme of code quality and how it helps prevent <a id="id244" class="indexterm"/>technical debt, branch policies is a great new feature in<a id="id245" class="indexterm"/> TFS that lends itself to improving the quality of the code that goes into the Git repo. In this recipe, you'll learn how to configure code review and Gated check-in policy on the master branch.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec72"/>Getting ready</h2></div></div></div><p>To configure branch policies on a branch, the user needs to have administration permission for that branch. To apply branch policy for the entire repo, the user needs admin rights for the repo.</p><div class="mediaobject"><img src="../Images/image00427.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>Create a continuous integration build for the FabrikamGit Team; follow the instructions in the Creating a continuous integration build definition in TFBuild recipe in <a class="link" title="Chapter 4. Building Your Application" href="part0050.xhtml#aid-1FLS42">Chapter 4</a>, <span class="emphasis"><em>Building Your Application</em></span>.</p><p>Scenario: The <a id="id246" class="indexterm"/>FabrikamGit Team wants to protect the master <a id="id247" class="indexterm"/>branch by only allowing commits that pass the <a id="id248" class="indexterm"/>Fabrikam CI build and have been code reviewed by at least two people in the Team. If the code being changed falls under the <code class="literal">/src/FabrikamFiber.CallCenter/FabrikamFiber.Web</code> area, then it must be reviewed by Brian Miller.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec73"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the FabrikamGit Team Administration page at <code class="literal">http://tfs2015:8080/tfs/DefaultCollection/FabrikamGit/FabrikamGit%20Team/_admin/</code>. Navigate into the <span class="strong"><strong>Version Control</strong></span> tab and select the <span class="strong"><strong>master</strong></span> branch. To access branch policies, click on the <span class="strong"><strong>Branch Policies</strong></span> tab:<div class="mediaobject"><img src="../Images/image00428.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The branch policies page allows you to configure policies for gated check-ins and code reviews.</li><li class="listitem">In the <span class="strong"><strong>Automatically build pull requests</strong></span> section, check both options and select the <span class="strong"><strong>FabrikamGit CI</strong></span> build definition from the dropdown:<div class="mediaobject"><img src="../Images/image00429.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In the <span class="strong"><strong>Code review requirements</strong></span> section, check require code reviews and specify the minimum number of reviewers as <code class="literal">2</code>:<div class="mediaobject"><img src="../Images/image00430.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click<a id="id249" class="indexterm"/> on the <span class="strong"><strong>Add a new path</strong></span> hyperlink. Add<a id="id250" class="indexterm"/> the<a id="id251" class="indexterm"/> path as <code class="literal">/src/FabrikamFiber.CallCenter/FabrikamFiber.Web/*</code> and reviewer as <code class="literal">Brian Miller</code>:<div class="mediaobject"><img src="../Images/image00431.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Save Changes</strong></span> button to save and apply the gated check-in and code review policies.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec74"/>How it works...</h2></div></div></div><p>Branch policies are evaluated on the server at the time of commit. With the branch policies enabled for the master, no code can be committed directly into the master. On directly committing code into the master, the following error message is issued.</p><p>The following errors were reported during push:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>refs/heads/master, TF402455: Pushes to this branch are not permitted; you must use pull requests to commit changes.</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec75"/>There's more...</h2></div></div></div><p>There may be justifications at times for bypassing the policies. There is provision for this in TFS. By setting the <span class="strong"><strong>Exempt from policy enforcement</strong></span> permission to <span class="strong"><strong>Allow</strong></span>, the user or group is allowed to bypass the policy:</p><div class="mediaobject"><img src="../Images/image00432.jpeg" alt="There's more..."/></div><p style="clear:both; height: 1em;"> </p><p>This permission can be <a id="id252" class="indexterm"/>scoped to an entire project, a repo, or a single<a id="id253" class="indexterm"/> branch. If you are granted exempt from policy<a id="id254" class="indexterm"/> enforcement, you will not be warned nor blocked from pushing or merging directly to a branch. So, as they rightly say… with great power, comes great responsibility.</p></div></div>
<div class="section" title="Conducting Pull requests in TFS"><div class="titlepage" id="aid-1394Q2"><div><div><h1 class="title"><a id="ch02lvl1sec30"/>Conducting Pull requests in TFS</h1></div></div></div><p>Earlier in the <a id="id255" class="indexterm"/>chapter, you<a id="id256" class="indexterm"/> learned how to restrict unreviewed code from making its way into the master branch. Pull requests are the means to promote code from topic branches (also referred to as feature branch) into the master branch. Pull requests enable developers working in topic branches to get feedback on their changes from other developers prior to submitting the code into the master branch. In this recipe, you'll learn how to conduct a Pull request to accept changes from a topic branch into the master branch.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec76"/>Getting ready</h2></div></div></div><p>The scenario we'll be working through in this recipe – Brian is a developer on the FabrikamGit Team. He is working on feature to add a dropdown called <code class="literal">problem type</code> on the service Dashboard. Brian has created an enum with the list of problem types and he wants to get feedback on this list and merge his changes to the master branch.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open Visual Studio and connect it to the FabrikamGit Team Project. From Team Explorer hub, click on <span class="strong"><strong>Branches</strong></span>. In the <span class="strong"><strong>Branches</strong></span> view, right-click on <span class="strong"><strong>master</strong></span> and select <span class="strong"><strong>New local branch From…</strong></span> in the context menu. Enter the new branch name as <code class="literal">Brian/Feature1</code> and click on the <span class="strong"><strong>Create branch</strong></span> button:<div class="mediaobject"><img src="../Images/image00433.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">From the<a id="id257" class="indexterm"/> topic branch, open <code class="literal">FabrikamFiber.CallCenter.sln</code>. In the <span class="strong"><strong>FabrikamFiber.Web</strong></span> project, add a new<a id="id258" class="indexterm"/> folder and call it <code class="literal">Common</code>. Add a new class and call it <code class="literal">ProblemTypeEnum.cs</code>. Edit the class and create an enum, as shown in the screenshot:<div class="mediaobject"><img src="../Images/image00434.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">From Team Explorer, navigate to the <span class="strong"><strong>Changes</strong></span> view. Commit the pending changes by entering a commit message and clicking on the <span class="strong"><strong>Commit</strong></span> button. Sync and publish the branch:<div class="mediaobject"><img src="../Images/image00435.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to the branches view page in Team Web Access by browsing to <code class="literal">http://tfs2015:8080/tfs/DefaultCollection/_git/FabrikamGit/branches</code>. The topic branch shows up here highlighting that it is one change a head of the master branch:<div class="mediaobject"><img src="../Images/image00436.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Validate <a id="id259" class="indexterm"/>that the master branch has gated check <a id="id260" class="indexterm"/>in and code review policy setup. If not, follow the steps in the <span class="emphasis"><em>Setting up policies for branches in Git</em></span> recipe.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec77"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the Pull request page in the Web Portal by browsing to <code class="literal">http://tfs2015:8080/tfs/DefaultCollection/_git/FabrikamGit/pullrequests</code>. You will see a prompt to create a Pull request from the earlier published branch. Alternatively, click on the <span class="strong"><strong>New Pull Request</strong></span> button in the left panel:<div class="mediaobject"><img src="../Images/image00437.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The <span class="strong"><strong>Create Pull Request</strong></span> page shows the list of changes a long with file-level comparison of the changes. The destination branch is selected as master, since its set up as the default. Optionally, click on the <span class="strong"><strong>more options</strong></span> hyperlink to add a description and an additional group of reviews:<div class="mediaobject"><img src="../Images/image00438.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The master<a id="id261" class="indexterm"/> branch policies are evaluated, the <a id="id262" class="indexterm"/>FabrikamGit CI build is automatically kicked off, and code review requests are issued. The engine evaluates the changes and determines that there will be no merge conflicts as part of the merge operation. Since the code changes are under <code class="literal">/src/FabrikamFiber.CallCenter/FabrikamFiber.Web/</code>,' a code review request is issued to Tom Hacker, too.<div class="mediaobject"><img src="../Images/image00439.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now, Tom Hacker logs into Web Portal and, looks up the Pull requests assigned to him. He conducts a code review for this Pull request. Tom suggests a few changes to the enum and marks the Pull request as approved with suggestions:<div class="mediaobject"><img src="../Images/image00440.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Brian makes the suggested changes and commits the changes into the topic branch. Click on <span class="strong"><strong>Refresh</strong></span> to update the changes into the Pull request:<div class="mediaobject"><img src="../Images/image00441.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The branch<a id="id263" class="indexterm"/> policies are reevaluated – the <a id="id264" class="indexterm"/>gated check-in build is run and merge is evaluated. Once the required number of reviewers have approved the Pull request, the request is ready to be merged. Clicking on the <span class="strong"><strong>Complete Pull Request</strong></span> button merges the changes into the master and creates a new changeset:<div class="mediaobject"><img src="../Images/image00442.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now, click on the <span class="strong"><strong>Delete Source Branch</strong></span> button to delete the <code class="literal">feature1</code> branch. This is a good practice as leaving unwanted branches causes clutter.<div class="mediaobject"><img src="../Images/image00443.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><p>The Pull request has been completed; the updated status reflects in the Team Portal.</p><div class="mediaobject"><img src="../Images/image00444.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec78"/>How it works...</h2></div></div></div><p>From the Team <a id="id265" class="indexterm"/>Explorer hub, click on <span class="strong"><strong>Sync</strong></span> page, fetch, and pull<a id="id266" class="indexterm"/> the incoming changes. From the <span class="strong"><strong>Branches</strong></span> view, click on the <span class="strong"><strong>master</strong></span> branch and choose <span class="strong"><strong>View history</strong></span> from the context menu. The merge into the main branch has completed as part of the Pull request; this now reflects in the branch history:</p><div class="mediaobject"><img src="../Images/image00445.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p></div></div>
<div class="section" title="Analyzing code churn with TFS analysis services cube" id="aid-147LC1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec31"/>Analyzing code churn with TFS analysis services cube</h1></div></div></div><p>The <a id="id267" class="indexterm"/>TFS analysis services<a id="id268" class="indexterm"/> cube computes large datasets that enable users to answer questions about their software project. The TFS data warehouse empowers user to join up various datasets and understand trends in code churn, code coverage, builds, bugs, and so on. In this recipe, you'll learn how to connect Excel with TFS analysis services cube and analyze the code churn in the FabrikamTFVC project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec79"/>Getting ready</h2></div></div></div><p>In order to connect TFS analysis services as a data source using Excel, you need your Windows account permissioned on the TFS data warehouse. Alternatively, use a Windows user name and password that already has access.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec80"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open Excel, in the <span class="strong"><strong>DATA</strong></span> tab click on <span class="strong"><strong>From Other Sources</strong></span> and choose <span class="strong"><strong>From Analysis Services</strong></span>. In the data connection wizard, enter the TFS analysis server connection details and click on the <span class="strong"><strong>Next</strong></span> button:<div class="mediaobject"><img src="../Images/image00446.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note29"/>Note</h3><p>If you are unsure about the warehouse connectivity details, you can check and verify them through the <span class="strong"><strong>Reporting</strong></span> tab in the TFS Administration Console.</p></div></li><li class="listitem">Select <span class="strong"><strong>Tfs_Analysis</strong></span> in the database dropdown, select <span class="strong"><strong>Code Churn</strong></span>, and click on the <span class="strong"><strong>Next</strong></span> button. The <span class="strong"><strong>Modified</strong></span> column indicates the last processed data time of<a id="id269" class="indexterm"/> each cube and<a id="id270" class="indexterm"/> perspective. In the next screen, click on <span class="strong"><strong>Finish</strong></span>:<div class="mediaobject"><img src="../Images/image00447.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Set up the pivot report as indicated in the following screenshot:<div class="mediaobject"><img src="../Images/image00448.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec81"/>How it works...</h2></div></div></div><p>The selection of these fields produces the following output. The data is grouped by year, month, and week, showing the total lines in the codebase along with a breakdown of lines modified, lines deleted, lines added, and the total churn:</p><div class="mediaobject"><img src="../Images/image00449.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="note30"/>Note</h3><p>In case you are interested in the build quality indicators report, TFS already offers this report out of the box. The report shows test coverage, code churn, and bug counts for a specified build definition. You can refer to <a class="ulink" href="https://msdn.microsoft.com/en-us/library/dd380683(v=vs.120).aspx">https://msdn.microsoft.com/en-us/library/dd380683(v=vs.120).aspx</a>, the tutorial, to learn more about this report.</p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec82"/>There's more...</h2></div></div></div><p>Change the<a id="id271" class="indexterm"/> fields in the pivot to what <a id="id272" class="indexterm"/>is illustrated in the following figure. Now, let's bring the version control hierarchy and build details in to the equation and update the fields in the pivot as in the screenshot here:</p><div class="mediaobject"><img src="../Images/image00450.jpeg" alt="There's more..."/><div class="caption"><p>In the values section add Total Lines, Lines Modified, Lined Added, and Total Churn.</p></div></div><p style="clear:both; height: 1em;"> </p><p>This will result in the results pivoted by year, week, and date and the version control hierarchy. As you can see in the screenshot here, the output shows the changes to the branch. You can drill down further to the specific project and class:</p><div class="mediaobject"><img src="../Images/image00451.jpeg" alt="There's more..."/></div><p style="clear:both; height: 1em;"> </p><p>Now, change<a id="id273" class="indexterm"/> the file hierarchy to be the<a id="id274" class="indexterm"/> filter and add the file extension to be presented as a row. In the file extension filter on <code class="literal">.asax</code>, <code class="literal">.config</code>, and <code class="literal">.cshtml</code>, the output will show you the code churn in these file types overtime.</p><div class="mediaobject"><img src="../Images/image00452.jpeg" alt="There's more..."/></div><p style="clear:both; height: 1em;"> </p><p>The possibilities are <a id="id275" class="indexterm"/>limitless. Once you<a id="id276" class="indexterm"/> have the basics of analysis reports nailed down, you can begin spelunking into the other dimensions available to you in the data warehouse to correlate the data to drive more interesting trends about your software project.</p></div></div></body></html>