<html><head></head><body><div><div><div><div><h1 class="title"><a id="pref07"/>Setting Up the Learning Environment</h1></div></div></div><p>To use this book most effectively and to examine, run, and write code that is part of exercises supplied in this book, it's essential to set up a learning environment. Even though Ansible can work with any type of nodes, virtual machines, cloud servers, or bare metal hosts with an operating system installed and SSH service running, the preferred mode is to use virtual machines.</p><p>In this session, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding the learning environment</li><li class="listitem" style="list-style-type: disc">Understanding the pre requisites</li><li class="listitem" style="list-style-type: disc">Installing and configuring virtualbox and vagrant</li><li class="listitem" style="list-style-type: disc">Creating virtual machines</li><li class="listitem" style="list-style-type: disc">Installing Ansible</li><li class="listitem" style="list-style-type: disc">Using the sample code</li></ul></div><div><div><div><div><h1 class="title"><a id="ch00lvl1sec08"/>Understanding the learning environment</h1></div></div></div><p>We assume that most of our learners would like to set up the environment locally, and thus recommend using the open source and freely available software VirtualBox and Vagrant, which have support for most of the desktop operating systems, including Windows, OSX, and Linux.</p><p>The ideal setup includes five virtual machines, the purpose of which is explained as follows. You can also consolidate some of the services, for example, the load balancer and web server can be the same host:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Controller</strong>: This is the only host that needs to have Ansible installed, and works as a controller. This is used to launch the <code class="literal">ansible-playbook</code> commands from the controller.</li><li class="listitem" style="list-style-type: disc"><strong>Database (Ubuntu)</strong>: This host is configured with Ansible to run the MySQL database service and runs the Ubuntu distribution of Linux.</li><li class="listitem" style="list-style-type: disc"><strong>Database (CentOS)</strong>: This host is configured with Ansible to run the MySQL database service, however, it runs the CentOS distribution of Linux. This is added to test multiplatform support while writing the MySQL role for Ansible.</li><li class="listitem" style="list-style-type: disc"><strong>Web Server</strong>: This host is configured with Ansible to run the Apache web server application.</li><li class="listitem" style="list-style-type: disc"><strong>Load balancer</strong>: This host gets configured with the haproxy application, which is an open source HTTP proxy service. This host acts as a load balancer, which accepts HTTP requests and spreads the load across available web servers.</li></ul></div><div><div><div><div><h2 class="title"><a id="ch00lvl2sec07"/>Prerequisites</h2></div></div></div><p>For most up-to-date instructions on prerequisites, software and hardware requirements, as well as setup instructions, refer to the following GitHub repository:</p><p>
<a class="ulink" href="https://github.com/schoolofdevops/ansible-playbook-essentials">https://github.com/schoolofdevops/ansible-playbook-essentials</a>.</p><div><div><div><div><h3 class="title"><a id="ch00lvl3sec01"/>Systems prerequisites</h3></div></div></div><p>A moderately configured desktop or a laptop system should be sufficient to set up the learning environment. The following are the recommended prerequisites in the context of of software and hardware:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<strong>Processor</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>2 cores</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Memory</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>2.5 GB RAM available</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Disk Space</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>20 GB of free space</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Operating System</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>Windows, OS X (Mac), Linux</p>
</td></tr></tbody></table></div></div></div><div><div><div><div><h2 class="title"><a id="ch00lvl2sec08"/>The base software</h2></div></div></div><p>For the purpose of setting up the learning environment, we recommend using the following software:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>VirtualBox</strong>: Oracle's virtualbox is a desktop virtualization software, which is freely available. It works on a variety of operating systems, including Windows, OS X, Linux, FreeBSD, Solaris, and so on. It provides a layer of hypervisor and allows one to create and run virtual machines on top of an existing base OS. The code provided along with this book has been tested on 4.3x versions of virtualbox. However, any version of virtualbox, which is compatible with the vagrant version can be used.</li><li class="listitem" style="list-style-type: disc"><strong>Vagrant</strong>: This is a tool that allows one to easily create and share virtual environments on most hypervisors and cloud platforms, including but not limited to virtualbox. It can automate tasks such as importing an image, specifying resources, such as memory and CPUs assigned to VMs, and setting up network interfaces, hostnames, user credentials, and so on. Since it provides a text configuration in the form of a Vagrant file, virtual machines can be provisioned programmatically, making them easy to use it with other tools such as <strong>Jenkins</strong> to automate build and test pipelines.</li><li class="listitem" style="list-style-type: disc"><strong>Git for Windows</strong>: Even though we do not intend to use Git, which is a version control software, we use this software to install the SSH utility on the Windows system. Vagrant needs an SSH binary available in the path. Windows is not packaged with the SSH utility, and Git for Windows is the easiest way to install it on Windows. Alternative options such as <strong>Cygwin</strong> exist.</li></ul></div><p>The following table lists the version OS the software used to develop the code provided with the book, with download links:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Software</p>
</th><th style="text-align: left" valign="bottom">
<p>Version</p>
</th><th style="text-align: left" valign="bottom">
<p>Download URI</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>VirtualBox</p>
</td><td style="text-align: left" valign="top">
<p>4.3.30</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Vagrant</p>
</td><td style="text-align: left" valign="top">
<p>1.7.3</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Git for Windows</p>
</td><td style="text-align: left" valign="top">
<p>1.9.5</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="https://git-scm.com/download/win">https://git-scm.com/download/win</a>
</p>
</td></tr></tbody></table></div><p>Learners are advised to download, install, and refer to the respective documentation pages to get familiar with these tools before proceeding.</p></div><div><div><div><div><h2 class="title"><a id="ch00lvl2sec09"/>Creating virtual machines</h2></div></div></div><p>Once you have installed the base software, you can use vagrant to bring up the virtual machines required. Vagrant uses a specification file by the name <code class="literal">Vagrantfile</code>, a sample of which is as follows:</p><div><pre class="programlisting"># -*- mode: ruby -*-
# vi: set ft=ruby :
# Sample Vagranfile to setup Learning Environment
# for Ansible Playbook Essentials

VAGRANTFILE_API_VERSION = "2"
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  config.vm.box = "ansible-ubuntu-1204-i386"
  config.vm.box_url = "https://cloud-images.ubuntu.com/vagrant/precise/current/precise-server-cloudimg-i386-vagrant-disk1.box"
  config.vm.define "control" do |control|
    control.vm.network :private_network, ip: "192.168.61.10"
  end
  config.vm.define "db" do |db|
    db.vm.network :private_network, ip: "192.168.61.11"
  end
  config.vm.define "dbel" do |db|
    db.vm.network :private_network, ip: "192.168.61.14"
    db.vm.box = "opscode_centos-6.5-i386"
    db.vm.box = "http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_centos-6.5_chef-provisionerless.box"
  end
  config.vm.define "www" do |www|
    www.vm.network :private_network, ip: "192.168.61.12"
  end
  config.vm.define "lb" do |lb|
    lb.vm.network :private_network, ip: "192.168.61.13"
  end
end</pre></div><p>The preceding Vagrant file contains specifications to set up five virtual machines, as described in the beginning of this chapter, which are, <code class="literal">control</code>, <code class="literal">db</code>, <code class="literal">dbel</code>, <code class="literal">www</code>, and <code class="literal">lb</code>.</p><p>Learners are advised to use following instructions to create and start the virtual machines required to set up the learning environment:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a directory structure for the learning environment setup, for example, <code class="literal">learn/ansible</code>, anywhere on the system.</li><li class="listitem">Copy the <code class="literal">Vagrantfile</code> file provided previously to the <code class="literal">learn/ansible</code> directory. The tree should now look as follows:<div><pre class="programlisting">                     learn
                        \_ ansible
                              \_ Vagrantfile</pre></div><div><div><h3 class="title"><a id="note02"/>Note</h3><p>The <code class="literal">Vagrantfile</code> file contains specifications for the virtual machines described in the earlier section.</p></div></div></li><li class="listitem">Open a terminal and go to <code class="literal">learn/ansible</code>.</li><li class="listitem">Bring up the control node and log in to it, as follows:<div><pre class="programlisting">
<strong>$ vagrant up control </strong>
<strong>$ vagrant ssh control</strong>
</pre></div></li><li class="listitem">From a separate terminal window, from the <code class="literal">learn/ansible</code> directory, bring up the remaining virtual machine, one at a time, as follows:<div><pre class="programlisting">
<strong>$ vagrant up db</strong>
<strong>$ vagrant up www</strong>
<strong>$ vagrant up lb</strong>
<strong>optionally (for centos based mysql configurations)</strong>
<strong>$ vagrant up dbel </strong>
<strong>Optionally, to login to to the virtual machines as</strong>
<strong>$ vagrant ssh db</strong>
<strong>$ vagrant ssh www</strong>
<strong>$ vagrant ssh lb</strong>
<strong>optionally (for centos based mysql configurations)</strong>
<strong>$ vagrant ssh dbel </strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch00lvl2sec10"/>Installing Ansible on the controller</h2></div></div></div><p>Once the virtual machines are created and brought up, Ansible needs to be installed on the controller. Since Ansible is agentless and manages nodes using SSH transport, no additional setup is needed on the nodes except for ensuring that the SSH service is running. To install Ansible on the controller, refer to the following steps. These instructions are specific to the Ubuntu distribution of Linux, as that's what we use on our controller. For generic installation instructions, please refer to the following page:</p><p>
<a class="ulink" href="http://docs.ansible.com/intro_installation.html">http://docs.ansible.com/intro_installation.html</a>.</p><p>The steps are as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to the controller using the following command:<div><pre class="programlisting">
<strong># from inside learn/ansible directory   </strong>
<strong>$ vagrant ssh control </strong>
</pre></div></li><li class="listitem"> Update the repository cache using the following command:<div><pre class="programlisting">
<strong>$ sudo apt-get update</strong>
</pre></div></li><li class="listitem">Install the prerequisite software and repositories:<div><pre class="programlisting">
<strong># On Ubuntu 14.04 and above </strong>
<strong>$ sudo apt-get install -y software-properties-common</strong>
<strong>$ sudo apt-get install -y python-software-properties</strong>
<strong>$ sudo apt-add-repository ppa:ansible/ansible</strong>
</pre></div></li><li class="listitem">Update the repository cache after adding a new repository, such as follows:<div><pre class="programlisting">
<strong>$ sudo apt-get update </strong>
</pre></div></li><li class="listitem">Install Ansible using the following command:<div><pre class="programlisting">
<strong>$ sudo apt-get install -y ansible </strong>
</pre></div></li><li class="listitem"> Validate Ansible using the following command:<div><pre class="programlisting">
<strong>$ ansible --version</strong>
<strong>[sample output]</strong>
<strong>vagrant@vagrant:~$ ansible --version</strong>
<strong>ansible 1.9.2</strong>
<strong>  configured module search path = None</strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch00lvl2sec11"/>Using sample code</h2></div></div></div><p>The sample code provided with this book is divided as per the chapter numbers. A directory named after the chapter number contains the snapshot of the state of the code at the end of the respective chapter. Learners are advised to independently create their own code and use the sample code as a reference. Moreover, if the readers skip one or more chapters, they can use the sample code from the previous chapter as a base.</p><p>For example, while using <a class="link" href="ch06.html" title="Chapter 6. Iterative Control Structures – Loops">Chapter 6</a>, <em>Iterative Control Structures – Loops</em>, you can use the sample code from <a class="link" href="ch05.html" title="Chapter 5. Controlling Execution Flow – Conditionals">Chapter 5</a>, <em>Controlling Execution Flow – Conditionals</em>, as a base.</p><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>
<strong>Downloading the example code</strong>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div></div></div></body></html>