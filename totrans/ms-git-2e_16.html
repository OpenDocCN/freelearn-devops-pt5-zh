<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-291"><a id="_idTextAnchor320" class="pcalibre1 pcalibre calibre6"/>13</h1>
<h1 id="_idParaDest-292" class="calibre5"><a id="_idTextAnchor321" class="pcalibre1 pcalibre calibre6"/>Customizing and Extending Git</h1>
<p class="calibre3">Earlier chapters were designed to help you understand how Git works and master Git as a version control system. The following two chapters will help you set up and configure Git, so that you can use it more effectively for yourself (this chapter) and help other developers use it (the next chapter).</p>
<p class="calibre3">This chapter will cover configuring and extending Git to fit one’s needs. First, it will show how to set up a Git command line to make it easier to use. For some tasks, though it is easier to use visual tools; the short introduction to graphical interfaces in this chapter should help you in choosing one. Next, there will be an explanation of how to change and configure Git behavior, from configuration files (with the selected configuration options described) to a per-file configuration with the <code>.</code><code>gitattributes</code> file.</p>
<p class="calibre3">Then this chapter will cover how to automate Git with hooks, describing for example how to make Git check whether the commit being created passes coding guidelines for a project. This part will focus on the client-side hook, and will only touch upon the server-side hooks— those are left for <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a>,<em class="italic"> Git Administration</em>. The last part of the chapter will describe how to extend Git, from the Git command aliases, through integrating new user-visible commands, to helpers and drivers (new backend abilities).</p>
<p class="calibre3">Many issues, such as gitattributes, remote and credential helpers, and the basics of the Git configuration should be known from the previous chapters. This chapter will gather this information in a single place, and expand it a bit.</p>
<p class="calibre3">In this chapter, we will cover the following topics:</p>
<ul class="calibre16">
<li class="calibre15">Setting up the shell prompt and Tab completion for a command line</li>
<li class="calibre15">Types and examples of graphical user interfaces</li>
<li class="calibre15">Configuration files and basic configuration options</li>
<li class="calibre15">Installing and using various types of hooks</li>
<li class="calibre15">Simple and complex aliases</li>
<li class="calibre15">Extending Git with new commands and helpers</li>
</ul>
<h1 id="_idParaDest-293" class="calibre5"><a id="_idTextAnchor322" class="pcalibre1 pcalibre calibre6"/>Git on the command line</h1>
<p class="calibre3">There are a lot of different ways to use the Git version control system. There are many <strong class="bold">graphical user interfaces</strong> (<strong class="bold">GUIs</strong>) of varying <a id="_idIndexMarker1121" class="pcalibre1 pcalibre calibre6"/>use cases and capabilities, and there exist tools and plugins that allow integration with an <strong class="bold">integrated development environment</strong> (<strong class="bold">IDE</strong>) or a <a id="_idIndexMarker1122" class="pcalibre1 pcalibre calibre6"/>file manager.</p>
<p class="calibre3">However, the command line is the only place you can run all of the Git commands and which provides support for all their options. New features, which you might want to use, are developed for the command line first. Also, most of the GUIs implement only some subsets of the Git functionality. Mastering<a id="_idIndexMarker1123" class="pcalibre1 pcalibre calibre6"/> the command line always guarantees a deep understanding of tools, mechanisms, and their abilities. Just knowing how to use a GUI is probably not enough to get a founded knowledge.</p>
<p class="calibre3">Whether you use Git on a command line from choice, as a preferred environment, or you need it because it is the only way to access the required functionality, there are a few shell features that Git can tap into to make your experience a lot friendlier.</p>
<h2 id="_idParaDest-294" class="calibre7"><a id="_idTextAnchor323" class="pcalibre1 pcalibre calibre6"/>Git-aware command prompt</h2>
<p class="calibre3">It’s useful to customize your <strong class="bold">shell prompt</strong> to show <a id="_idIndexMarker1124" class="pcalibre1 pcalibre calibre6"/>information about the state of the Git repository we are in.</p>
<p class="callout-heading">Definition</p>
<p class="callout">The<strong class="bold"> shell prompt</strong> is a short text <a id="_idIndexMarker1125" class="pcalibre1 pcalibre calibre6"/>message that is written to the terminal or the console output to notify the user of the interactive shell that some typed input is expected (usually a shell command).</p>
<p class="calibre3">This information can be as simple or as complex as you want. Git’s prompt might be similar to the ordinary command-line prompt (to reduce dissonance), or visibly different (to be able to easily distinguish that we are inside the Git repository).</p>
<p class="calibre3">There is an example implementation for <code>bash</code> and <code>zsh</code> shells in the <code>contrib/</code> area. If you install Git from the sources, just copy the <code>contrib/completion/git-prompt.sh</code> file to your home directory; if you have installed Git on Linux via a package manager, you will probably have it at <code>/etc/bash_completion.d/git-prompt.sh</code>. This file provides the <code>__git_ps1</code> shell function to generate a Git-aware prompt in the Git repositories, but <a id="_idIndexMarker1126" class="pcalibre1 pcalibre calibre6"/>first, you need to source this file in your <code>.bashrc</code> or <code>.zshrc</code> shell configuration file:</p>
<pre class="console">
if [ -f /etc/bash_completion.d/git-prompt.sh ]; then
    source /etc/bash_completion.d/git-prompt.sh
fi</pre>
<p class="calibre3">The shell prompt is configured using environment variables. To set up a prompt, you must change, directly or indirectly, the <code>PS1</code> (prompt string one, the default interaction prompt) environment variable. Thus, one solution to create a Git-aware command prompt is to include a call to the <code>__git_ps1</code> shell function in the <code>PS1</code> environment variable, by using command substitution:</p>
<pre class="console">
export PS1='\u@\h:\w$( git_ps1 " (%s)")\$ '</pre>
<p class="calibre3">Note that, for <code>zsh</code>, you would also need to turn on the command substitution in the shell prompt with the <code>setopt </code><code>PROMPT_SUBST</code> command.</p>
<p class="calibre3">Alternatively, for a slightly faster prompt and the possibility of color, you can use <code>__git_ps1</code> to set <code>PS1</code>. This is done with the <code>PROMPT_COMMAND</code> environment variable in <code>bash</code> and with the <code>precmd()</code> function in <code>zsh</code>. You can find more information about this option in the comments in the <code>git-prompt.sh</code> file; for <code>bash</code>, it could be the following:</p>
<pre class="console">
PROMPT_COMMAND='__git_ps1 "\\u@\\h:\\w" "\\\$ "'</pre>
<p class="calibre3">With this configuration (either solution), the prompt will look as follows:</p>
<pre class="console">
bob@host.company.org:~/random/src<strong class="bold1"> (master)</strong>$</pre>
<p class="calibre3">The Git Bash command from Git for Windows comes out of the box with a similar prompt configured (though the Git Bash default prompt takes two lines, not one).</p>
<p class="calibre3">The <code>bash</code> and <code>zsh</code> shell prompts can be customized with the use of special characters that get expanded by a shell. In the example used here (you can find more for example in the <em class="italic">Bash Reference Manual</em>), we have the following:</p>
<ul class="calibre16">
<li class="calibre15"> <strong class="source-inline1">\u</strong> means the current user (<strong class="bold">bob</strong>)</li>
<li class="calibre15"><strong class="source-inline1">\h</strong> is the current hostname (<strong class="bold">host.company.org</strong>)</li>
<li class="calibre15"><strong class="source-inline1">\w</strong> means the current working directory (<strong class="bold">~/random/src</strong>)</li>
<li class="calibre15"><strong class="source-inline1">\$</strong> prints the <strong class="bold">$</strong> part of the prompt (<strong class="bold">#</strong> if you are logged in as the root user)</li>
</ul>
<p class="calibre3"><code>$(...)</code> in the <code>PS1</code> setup is used to call external commands and shell functions. <code>__git_ps1 " (%s)"</code> here calls the <code>git_ps1</code> shell function provided by <code>git-prompt.sh</code> with a formatting argument: the <code>%s</code> token is the placeholder for the presented Git status. Note that you need to either use single quotes while setting the <code>PS1</code> variable from the command line, as in the example shown here, or escape shell substitution, so it is expanded<a id="_idIndexMarker1127" class="pcalibre1 pcalibre calibre6"/> while showing the prompt and not while defining the variable.</p>
<p class="calibre3">If you are using the <code>__git_ps1</code> function, Git will also display information about the current ongoing multistep operation: merging, rebasing, bisecting, and so on. For example, during an interactive rebase (<code>-i</code>) on the branch <code>master</code>, the relevant part of the prompt would be <strong class="bold">master|REBASE-i</strong>. It is very useful to have this information right here in the command prompt, especially if you get interrupted in the middle of the operation.</p>
<p class="calibre3">It is also possible to indicate in the command prompt the state of the working tree, the index, and so on. We can enable these features by exporting the selected subset of these environment variables (for some features you can additionally turn it off on a per-repository basis with provided boolean-valued configuration variables):</p>
<ul class="calibre16">
<li class="calibre15"><strong class="source-inline1">GIT_PS1_SHOWDIRTYSTATE</strong> (with <strong class="source-inline1">bash.showDirtyState</strong> for per-repository settings) shows “<strong class="bold">*</strong>” for unstaged changes and “<strong class="bold">+</strong>” for staged changes, if set to a non-empty value.</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_SHOWSTASHSTATE</strong> shows “<strong class="bold">$</strong>” if something is stashed.</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_SHOWUNTRACKEDFILES</strong> and <strong class="source-inline1">bash.showUntrackedFiles</strong> show “<strong class="bold">%</strong>” if there are untracked files in the working directory.</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_SHOWUPSTREAM</strong> and <strong class="source-inline1">bash.showUpstream</strong> can be used to configure the ahead-behind state of the upstream repository, with a value of <strong class="source-inline1">auto</strong> in a space-separated list of values makes the prompt show whether you are behind “<strong class="bold">&lt;</strong>”, up to date “<strong class="bold">=</strong>”, or ahead “<strong class="bold">&gt;</strong>” of the upstream, <strong class="source-inline1">name</strong> shows the upstream name, and <strong class="source-inline1">verbose</strong> details the number of commits you are ahead/behind (with sign; for example "+1" for being 1 commit ahead). <strong class="source-inline1">git</strong> compares HEAD to <strong class="source-inline1">@{upstream}</strong> and <strong class="source-inline1">svn</strong> to the SVN upstream.</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_DESCRIBE_STYLE</strong> can be set to configure how to show information about a<a id="_idIndexMarker1128" class="pcalibre1 pcalibre calibre6"/> detached HEAD situation; it can be set to one of the following values: <strong class="source-inline1">contains</strong> uses newer annotated tags (v1.6.3.2~35), <strong class="source-inline1">branch</strong> uses newer tag or branch (main~4), <strong class="source-inline1">describe</strong> uses the older annotated tag (v1.6.3.1-13-gdd42c2f), <strong class="source-inline1">tag</strong> uses any tag, <strong class="source-inline1">default</strong> shows tag only if it is exactly matching the current commit.</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_SHOWCONFLICTSTATE</strong> set to “<strong class="source-inline1">yes</strong>” will notify the user if there are unresolved conflicts with <strong class="bold">|CONFLICT</strong>.</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_SHOWCOLORHINTS</strong> can be used to configure colored hints about the current dirty state, that is about whether there are uncommitted changes (like <strong class="source-inline1">git status -</strong><strong class="source-inline1">sb</strong> does).</li>
<li class="calibre15"><strong class="source-inline1">GIT_PS1_HIDE_IF_PWD_IGNORED</strong> or <strong class="source-inline1">bash.hideIfPwdIgnored</strong> are used to not show a Git-aware prompt if the current directory is set to be ignored by Git, even if we are inside a repository.</li>
</ul>
<p class="calibre3">If you are using the <code>zsh</code> shell, you can take a look at the <code>zsh-git</code> set of scripts, the <code>zshkit</code> configuration scripts, or the <code>oh-my-zsh</code> framework available for <code>zsh</code>, instead of using <code>bash</code>—first complete the prompt setup from the Git contrib/. Alternatively, you can use the <code>vcs_info</code> subsystem built in to <code>zsh</code>.</p>
<p class="calibre3">There are also alternative prompt solutions for <code>bash</code> (usually for multiple different shells), for example, <code>git-radar</code> or <code>powerline-shell</code>.</p>
<p class="callout-heading">Tip</p>
<p class="callout">You can, of course, generate your own Git-aware prompt. For example, you might want to split the current directory into the repository path part and the project subdirectory path part with the help of the <strong class="source-inline1">git </strong><strong class="source-inline1">rev-parse</strong> command.</p>
<h2 id="_idParaDest-295" class="calibre7"><a id="_idTextAnchor324" class="pcalibre1 pcalibre calibre6"/>Command-line completion for Git</h2>
<p class="calibre3">Another shell feature that makes it easier to work with the Git command line is the programmable <strong class="bold">command-line completion</strong>. This feature <a id="_idIndexMarker1129" class="pcalibre1 pcalibre calibre6"/>can dramatically speed up typing Git commands. Command-line <a id="_idIndexMarker1130" class="pcalibre1 pcalibre calibre6"/>completion allows you to type the first few characters of a command, or a filename, and press the completion key (usually <em class="italic">Tab</em>) to fill the rest of the item. With the Git-aware completion, you can also fill in subcommands, command-line parameters, remotes, branches, and tags (ref names), each only where appropriate (for example, remote names are completed only if the command expects the remote name at a given position).</p>
<p class="calibre3">Git comes with built-in (but not always installed) support for the auto-completion of Git commands for the <code>bash</code> and <code>zsh</code> shells.</p>
<p class="calibre3">For <code>bash</code>, if the completion functionality is not installed with Git (at <code>/etc/bash_completion.d/git.sh</code> in Linux by default), you need to get a copy of the <code>contrib/completion/git-completion.bash</code> file out of the Git source code. Copy it somewhere accessible, such as your home directory, and source it from your <code>.bashrc</code> or <code>.bash_profile</code>:</p>
<pre class="console">
. ~/git-completion.bash</pre>
<p class="calibre3">Once the completion for Git is enabled, to test it, you can start to type a Git command, then press the <em class="italic">Tab</em> key. For example, you can type <code>git check</code> and then press <em class="italic">Tab</em>:</p>
<pre class="console">
$ git check&lt;<strong class="source-inline2">TAB</strong>&gt;</pre>
<p class="calibre3">With Git completion enabled, the <code>bash</code> (or <code>zsh</code>) shell would autocomplete what you entered so far to <code>git checkout</code>.</p>
<p class="calibre3">Similarly, in an ambiguous case, a double <em class="italic">Tab</em> press shows all the possible completions (though this is not true for all shells; some instead cycle through different completions):</p>
<pre class="console">
$ git che&lt;<strong class="source-inline2">TAB</strong>&gt;&lt;<strong class="source-inline2">TAB</strong>&gt;
checkout      cherry        cherry-pick</pre>
<p class="calibre3">The completion feature also works with options; this is quite useful if you don’t remember the exact option but<a id="_idIndexMarker1131" class="pcalibre1 pcalibre calibre6"/> only the prefix:</p>
<pre class="console">
$ git config --&lt;<strong class="source-inline2">TAB</strong>&gt;&lt;<strong class="source-inline2">TAB</strong>&gt;
--add              --get-regexp       --remove-section   --unset
[…]</pre>
<p class="callout-heading">Important note</p>
<p class="callout">Instead of the list of possible completions, some shells use (or can be configured to use) rotating completion, where with multiple possible completions, each <em class="italic">Tab</em> shows a different completion for the same prefix (cycling through them).</p>
<p class="calibre3">Note that command-line <a id="_idIndexMarker1132" class="pcalibre1 pcalibre calibre6"/>completion (also called <strong class="bold">tab completion</strong>) generally works only in the<a id="_idIndexMarker1133" class="pcalibre1 pcalibre calibre6"/> interactive mode, and is based on the unambiguous prefix, not on the unambiguous abbreviation.</p>
<h2 id="_idParaDest-296" class="calibre7"><a id="_idTextAnchor325" class="pcalibre1 pcalibre calibre6"/>Autocorrection for Git commands</h2>
<p class="calibre3">An unrelated built-in Git tool, but <a id="_idIndexMarker1134" class="pcalibre1 pcalibre calibre6"/>similar to tab completion, is <strong class="bold">autocorrection</strong>. By default, if you type <a id="_idIndexMarker1135" class="pcalibre1 pcalibre calibre6"/>something that looks like a mistyped command, Git helpfully tries to figure out what you meant. It still refuses to perform the guessed operation, even if there is only one candidate:</p>
<pre class="console">
$ git chekout
git: 'chekout' is not a git command. See 'git --help'.
The most similar command is
        checkout</pre>
<p class="calibre3">However, with the <code>help.autoCorrect</code> configuration variable set to a positive number, Git will automatically correct and execute the mistyped commands after waiting for the given number<a id="_idIndexMarker1136" class="pcalibre1 pcalibre calibre6"/> of deciseconds (0.1 of second). You can use a negative value with this option for immediate execution, or zero to go back to the default:</p>
<pre class="console">
$ git chekout
WARNING: You called a Git command named 'chekout', which does not exist.
Continuing in 0.1 seconds, assuming that you meant 'checkout'.
Your branch is up-to-date with 'origin/master'.</pre>
<p class="calibre3">If there is more than one command that can be deduced from the entered text, nothing will be executed. This mechanism works only for Git commands; you cannot autocorrect subcommands, parameters, and options (as opposed to tab completion).</p>
<h2 id="_idParaDest-297" class="calibre7"><a id="_idTextAnchor326" class="pcalibre1 pcalibre calibre6"/>Making the command line prettier</h2>
<p class="calibre3">Git fully supports a colored terminal output, which greatly aids in visually parsing the command output. A number of <a id="_idIndexMarker1137" class="pcalibre1 pcalibre calibre6"/>options can help you set the coloring to your preference.</p>
<p class="calibre3">First, you can specify when to use colors, such as for the output of certain commands. There is a <code>color.ui</code> master switch to control output coloring to turn off all of Git’s colored terminal outputs and set them to <code>false</code>. The default setting for this configuration variable is <code>auto</code>, which makes Git color the output when it’s going straight to a terminal, but omit the color-control codes when the output is redirected to a file or a pipe.</p>
<p class="calibre3">You can also set <code>color.ui</code> to <code>always</code>, though you’d rarely want this: if you want color codes in your redirected output, simply pass a <code>--color</code> flag to the Git command; conversely, the <code>--no-color</code> option would turn off the colored output.</p>
<p class="calibre3">If you want to be more specific about which commands and which parts of the output are colored, Git provides appropriate coloring settings: <code>color.branch</code>, <code>color.diff</code>, <code>color.interactive</code>, <code>color.status</code>, and so on. Just as with the <code>color.ui</code> master switch, each of these can be set to <code>true</code>, <code>false</code>, <code>auto</code>, and <code>always</code>.</p>
<p class="calibre3">In addition, each of these settings has subsettings that you can use to set specific colors for specific parts of the output. The color value of such configuration variables – for example, <code>color.diff.meta</code> (to configure the coloring of meta information in your diff output) – consists of space-separated <a id="_idIndexMarker1138" class="pcalibre1 pcalibre calibre6"/>names of the foreground color, the background color (if set), and the text attribute.</p>
<p class="calibre3">You can set the color to any of the following values: <code>normal</code>, <code>black</code>, <code>red</code>, <code>green</code>, <code>yellow</code>, <code>blue</code>, <code>magenta</code>, <code>cyan</code>, or <code>white</code>. As for the attributes, you can choose from <code>bold</code>, <code>dim</code>, <code>ul</code> (underline), <code>blink</code>, and <code>reverse</code> (swap the foreground color with the background one).</p>
<p class="calibre3">The pretty formats for <code>git log</code> also include an option to set colors; see the <code>git log</code> documentation for more information.</p>
<p class="callout-heading">External tools</p>
<p class="callout">There are diff syntax highlighters that can be used with Git. They can be set up to work as a pager with the <strong class="source-inline1">core.pager</strong> config variable, or configured via an alias. Examples include <strong class="bold">delta</strong> (<a href="https://dandavison.github.io/delta" class="pcalibre1 pcalibre calibre6">https://dandavison.github.io/delta</a>) and <strong class="bold">diff-highlight</strong> from the contrib area of Git source code.</p>
<h2 id="_idParaDest-298" class="calibre7"><a id="_idTextAnchor327" class="pcalibre1 pcalibre calibre6"/>Alternative command line</h2>
<p class="calibre3">To understand some of the rough edges <a id="_idIndexMarker1139" class="pcalibre1 pcalibre calibre6"/>of the Git user’s interface, you need to remember that Git was developed to a large extent in a bottom-up fashion. Historically, Git began as a tool to write version-control systems (you can see how early Git was used in the <em class="italic">A Git core tutorial for developers</em> documentation that you can view with the <code>git help </code><code>core-tutorial</code> command).</p>
<p class="calibre3">The first alternative “porcelain” (i.e., alternative user interface) for Git was <em class="italic">Cogito</em>. Nowadays, Cogito is no more; all of its features have long been incorporated into Git (or replaced by better solutions). There were some attempts to write wrapper scripts (alternative UIs) designed to make it easy to learn and use, for example, <code>eg</code>) and the newer <code>jj</code>) is a version control system in the early stages of development that can use Git repositories to store project history, and thus can be thought as a layer on top of Git, too.</p>
<p class="calibre3">There are also external Git porcelains that do not intend to replace the whole user interface, but either provide access to some extra features, or wrap Git to provide some restricted feature set. <code>gq</code>)), are created to<a id="_idIndexMarker1140" class="pcalibre1 pcalibre calibre6"/> make it easy to rewrite, manipulate, and clean up selected <a id="_idIndexMarker1141" class="pcalibre1 pcalibre calibre6"/>parts of the unpublished history; these were mentioned as an alternative to an interactive rebase in <a href="B21194_10_split_000.xhtml#_idTextAnchor247" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 10</em></a>,<em class="italic"> Keeping History Clean</em>. Then, there are single-file version control systems, such as <strong class="bold">Zit</strong>, which use Git as a backend.</p>
<p class="callout-heading">Alternative implementations</p>
<p class="callout">Beside alternative user interfaces, there are also different implementations of Git (defined as reading and writing Git repositories). They are at different stages of completeness. Besides the core C<a id="_idIndexMarker1142" class="pcalibre1 pcalibre calibre6"/> implementation, there is <strong class="bold">JGit</strong> in Java, and also the <strong class="bold">libgit2</strong> project—the modern <a id="_idIndexMarker1143" class="pcalibre1 pcalibre calibre6"/>basis of Git bindings for various programming languages.</p>
<h1 id="_idParaDest-299" class="calibre5"><a id="_idTextAnchor328" class="pcalibre1 pcalibre calibre6"/>Graphical interfaces</h1>
<p class="calibre3">You have learned how to<a id="_idIndexMarker1144" class="pcalibre1 pcalibre calibre6"/> use Git on the command line. The previous section told you how to customize and configure it to make it even more effective. But the terminal is not the end. There are other kinds of environments you can use to manage Git repositories. Sometimes, a visual representation is what you need.</p>
<p class="calibre3">Now, we’ll take a short look at the various kinds of user-centered graphical tools for Git; the tour of Git administrative tools is left for the next chapter, <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a>,<em class="italic"> </em><em class="italic">Git Administration</em>.</p>
<h2 id="_idParaDest-300" class="calibre7"><a id="_idTextAnchor329" class="pcalibre1 pcalibre calibre6"/>Types of graphical tools</h2>
<p class="calibre3">Different tools and interfaces are tailored for different workflows. Some tools expose only a selected <a id="_idIndexMarker1145" class="pcalibre1 pcalibre calibre6"/>subset of the Git functionality or encourage a specific way of working with version control.</p>
<p class="calibre3">To be able to make an informed choice when selecting a graphical tool for Git, you need to know what types of operations the different types of tools support. Note that one tool can support more than one type of use.</p>
<p class="calibre3">First, there is the <code>git log</code>. This is the tool to be <a id="_idIndexMarker1146" class="pcalibre1 pcalibre calibre6"/>used when you are trying to find something that happened in the past, or you are visualizing and browsing your project’s history and the layout of branches. Such tools usually accept revision selection command-line options, such as <code>--all</code>. Command-line Git has <code>git log --graph</code> and the less-used <code>git show-branch</code> that uses ASCII art to show the history.</p>
<p class="calibre3">A similar tool is <code>git log -L</code>) and the so-called pickaxe search (<code>git log -S</code>), do not have many GUIs.</p>
<p class="calibre3">Next, there are <code>git add</code>, <code>git reset</code>, and so on, even allow you to stage and unstage individual chunks of changes. A graphical version of an interactive add is described in <a href="B21194_03_split_000.xhtml#_idTextAnchor049" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 3</em></a>,<em class="italic"> Managing Your </em><em class="italic">Worktrees</em>, and mentioned in <a href="B21194_02.xhtml#_idTextAnchor028" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 2</em></a>,<em class="italic"> Developing with Git</em>. There are also tools to craft commit messages following specified criteria.</p>
<p class="calibre3">Then, we have <strong class="bold">file manager integration</strong> (or <strong class="bold">graphical shell integration</strong>). These plugins usually show the status of the file in Git (tracked/untracked/ignored) using icon overlays. They can offer a context menu for a repository, directory, and file, often with accompanying keyboard shortcuts. They may also bring drag and drop support.</p>
<p class="calibre3">Programmer editors and IDE) often offer support for <strong class="bold">IDE integration</strong> with Git (or version control in general). These offer repository management (as a part of team project management), make it possible to perform Git operations directly from the IDE, show the status of the current file and the repository, and perhaps even annotate the view of the file with version control information. They often include the commit tool, remote management, the history viewer, and the diff viewer.</p>
<p class="calibre3">Git repositories’ hosting <a id="_idIndexMarker1149" class="pcalibre1 pcalibre calibre6"/>sites often offer workflow-oriented <strong class="bold">desktop clients</strong>. These mostly focus on a curated set of commonly used features that work well together in the flow. They automate common Git tasks. They are often designed to highlight their service, offering extra features and integration, but they will work with any repository hosted anywhere.</p>
<p class="calibre3">There are even <code>sequence.editor</code> config variable, or a syntax highlighting tool for diffs that can be set up as the default Git pager with <code>core.pager</code>.</p>
<h2 id="_idParaDest-301" class="calibre7"><a id="_idTextAnchor330" class="pcalibre1 pcalibre calibre6"/>Graphical diff and merge tools</h2>
<p class="calibre3">Graphical diff tools <a id="_idIndexMarker1150" class="pcalibre1 pcalibre calibre6"/>and graphical merge tools are somewhat special cases. In these categories, Git includes the commands for integration with third-party graphical tools, namely, <code>git difftool</code> and <code>git mergetool</code>. These tools are then called <a id="_idIndexMarker1151" class="pcalibre1 pcalibre calibre6"/>from the Git repository. Note that this is different from the external diff or diff merge drivers, which replace ordinary <code>git diff</code> or augment it.</p>
<p class="calibre3">Although Git has an internal implementation of diff and a mechanism for merge conflict resolutions (see <a href="B21194_09.xhtml#_idTextAnchor229" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 9</em></a>,<em class="italic"> Merging </em><em class="italic">Changes Together</em>), you can use an external graphical diff tool instead. These are often used to show the differences better (usually, as a side-by-side diff, possibly with refinements), and help resolve a merge (often with a three-pane interface).</p>
<p class="calibre3">Configuring the graphical diff or graphical merge tool requires configuring a number of custom settings. To tell which tool to use for diff and merge, respectively, you can set up <code>diff.tool</code> and <code>merge.tool</code>, respectively. Without setting, for example, the <code>merge.tool</code> configuration variable, the <code>git mergetool</code> command would print the information on how to configure it, and will attempt to run one of predefined tools:</p>
<pre class="console">
$ git mergetool
This message is displayed because 'merge.tool' is not configured.
See 'git mergetool --tool-help' or 'git help config' for more details.
'git mergetool' will now attempt to use one of the following tools:
tortoisemerge emerge vimdiff
No files need merging</pre>
<p class="calibre3">Running <code>git mergetool --tool-help</code> will show all the available tools, including those that are<a id="_idIndexMarker1152" class="pcalibre1 pcalibre calibre6"/> not installed. If the tool you use is not in <code>$PATH</code>, or it has<a id="_idIndexMarker1153" class="pcalibre1 pcalibre calibre6"/> the wrong version of the tool, you can use <code>mergetool.&lt;tool&gt;.path</code> to set or override the path for the given tool:</p>
<pre class="console">
$ git mergetool --tool-help
'git mergetool --tool=&lt;tool&gt;' may be set to one of the following:
           vimdiff          Use Vim with a custom layout
[…]
The following tools are valid, but not currently available:
           araxis           Use Araxis Merge
[…]
Some of the tools listed above only work in a windowed
environment. If run in a terminal-only session, they will fail.</pre>
<p class="calibre3">If there is no built-in support for<a id="_idIndexMarker1154" class="pcalibre1 pcalibre calibre6"/> your tool, you can still use it; you just need to<a id="_idIndexMarker1155" class="pcalibre1 pcalibre calibre6"/> configure it. The <code>mergetool.&lt;tool&gt;.cmd</code> configuration variable specifies how to run the command, while <code>mergetool.&lt;tool&gt;.trustExitCode</code> tells Git whether the exit code of that program indicates a successful merge resolution or not. The relevant fragment of the configuration file (for a graphical mergetool named <code>extMerge</code>) could look as follows:</p>
<pre class="console">
[merge]
    tool = extMerge
[mergetool "extMerge"]
    cmd = extMerge "$BASE" "$LOCAL" "$REMOTE" "$MERGED"</pre>
<p class="calibre3">There are a few config<a id="_idIndexMarker1156" class="pcalibre1 pcalibre calibre6"/> options that control <code>git mergetool</code> behavior, either globally or on a per-tool basis. One of those is <code>mergetool.hideResolved</code> (and its per-tool <code>mergetool.&lt;tool&gt;.hideResolved</code> variant), which makes Git resolve as many conflicts as possible by itself, and <a id="_idIndexMarker1157" class="pcalibre1 pcalibre calibre6"/>presents only unresolved conflicts to the merge tool. Note that some merge tools do this themselves.</p>
<p class="calibre3">Some merge tools, such as vimdiff, are text interface tools that can work without the need for a graphical session. If you want to run one tool in text mode (for example, when using plain SSH access to a remote host), and another one in graphical mode, you can do this by configuring <code>mergetool.tool</code> in one tool, and <code>mergetool.guitool</code> in another – and use <code>git mergetool --gui</code> to invoke the GUI one.</p>
<h2 id="_idParaDest-302" class="calibre7"><a id="_idTextAnchor331" class="pcalibre1 pcalibre calibre6"/>Graphical interface examples</h2>
<p class="calibre3">In this section, you <a id="_idIndexMarker1158" class="pcalibre1 pcalibre calibre6"/>will be presented with a selection of tools around Git that you could use, or that might prompt you to research further. A nice way to help you start this  research is to list some selected GUI clients.</p>
<p class="calibre3">There are two visual tools that are a part of Git and are usually installed with it, namely <code>gitk</code> is a <code>git gui</code> is a <code>git gui blame</code>, a visually <code>git gui</code> opens <code>gitk</code>.</p>
<p class="calibre3">Visual tools do not need to use the <a id="_idIndexMarker1162" class="pcalibre1 pcalibre calibre6"/>graphical environment. There is <strong class="bold">tig</strong> (short for <em class="italic">Text Interface for Git</em>) that uses a nurses-based text-mode interface (TUI) and functions as a repository browser and commit tool and can act as a Git pager.</p>
<p class="calibre3">Another TUI example is <strong class="bold">git interactive-rebase-tool</strong>, which can be set up as an interactive sequence editor for the interactive rebase instruction sheet.</p>
<p class="calibre3">There is <strong class="bold">git cola</strong>, developed in Python and available for all the operating systems, which includes commit tools and remotes management, and also a diff viewer. Then, there is the simple and colorful <strong class="bold">Gitg</strong> tool for GNOME; you will get a graphical history viewer, diff viewer, and file browser.</p>
<p class="calibre3">One of the more popular open source GUI tools for macOS is <strong class="bold">GitX</strong>. There are a lot of forks of this tool; one of the more interesting ones is <strong class="bold">Gitbox</strong>. It features both the history viewer and commit tools.</p>
<p class="calibre3">For MS Windows, there is <strong class="bold">TortoiseGit</strong> and <strong class="bold">git-cheetah</strong>, both of which offer integration into the Windows context menu, so you can perform Git commands inside Windows Explorer (the file manager integration and shell interface).</p>
<p class="calibre3">GitHub Inc. and Atlassian both released a desktop GUI tool that you can easily use with your GitHub or Bitbucket repository, respectively, but neither tool is not limited to only interacting with a single service (GitHub or Bitbucket, respectively). Both <strong class="bold">GitHub Client</strong> and <strong class="bold">SourceTree</strong> feature repository management and offer a range of other common facilities to enhance your development workflow.</p>
<p class="calibre3">Many programming editors and IDEs have support for managing Git repositories, and sometimes also for interacting with Git hosting sites. This can be either built in, or available as IDE plugins or extensions. Examples include <strong class="bold">GitLens</strong> for Visual Studio Code, <strong class="bold">Magit</strong> for GNU Emacs, and <strong class="bold">Fugitive</strong> for ViM. Those tools often show information such as which lines are added or changed, or who authored them, inside the editor pane.</p>
<h1 id="_idParaDest-303" class="calibre5"><a id="_idTextAnchor332" class="pcalibre1 pcalibre calibre6"/>Configuring Git</h1>
<p class="calibre3">So far, while describing how Git works and how to use it, we have introduced a number of ways to change its behavior. In this section, it will be explained in a systematic fashion how to configure Git<a id="_idIndexMarker1163" class="pcalibre1 pcalibre calibre6"/> operations on a temporary and permanent basis. We will also see how you can make Git behave in a customized fashion by introducing and reintroducing several important configuration settings. With these tools, it’s easy to get <a id="_idIndexMarker1164" class="pcalibre1 pcalibre calibre6"/>Git to work the way you want it to.</p>
</div>


<div><h2 id="_idParaDest-304" class="calibre7"><a id="_idTextAnchor333" class="pcalibre1 pcalibre calibre6"/>Command-line options and environment variables</h2>
<p class="calibre3">Git processes the switches that <a id="_idIndexMarker1165" class="pcalibre1 pcalibre calibre6"/>change its behavior in a hierarchical fashion, from the least specific to the most specific one, with the most specific one (and shortest term) taking precedence.</p>
<p class="calibre3">The most specific one, overriding all the others, is the command-line options. They affect, obviously, only the current Git command.</p>
<p class="callout-heading">Important note</p>
<p class="callout">One issue to note is that some command-line options, for example, <strong class="source-inline1">--no-pager</strong> or <strong class="source-inline1">--no-replace-objects</strong>, go to the <strong class="source-inline1">git</strong> wrapper, not to the Git command itself. Examine, for example, the following line to see the distinction:</p>
<p class="callout"><strong class="source-inline1">$ git --no-replace-objects log -5 --oneline --</strong><strong class="source-inline1">graph --decorate</strong></p>
<p class="calibre3">You can find the conventions used through the Git command-line interface on the manpage.</p>
<p class="calibre3">The second way to change how the Git command works is to use environment variables. They are specific to the current shell, and you need to use the <code>export</code> built-in command (or its<a id="_idIndexMarker1166" class="pcalibre1 pcalibre calibre6"/> equivalent) to propagate the variables to the subprocesses if a replacement is used. There are some environment variables that apply to all core Git commands, and some that are specific to a given (sub)command.</p>
<p class="calibre3">Git also makes use of some nonspecific environment variables. These are meant as a last resort; they are overridden by their Git-specific equivalents. Examples include variables such as <code>PAGER</code> and <code>EDITOR</code>.</p>
<h2 id="_idParaDest-305" class="calibre7"><a id="_idTextAnchor334" class="pcalibre1 pcalibre calibre6"/>Git configuration files</h2>
<p class="calibre3">The final way to customize<a id="_idIndexMarker1167" class="pcalibre1 pcalibre calibre6"/> how Git works is with the configuration files. In many cases, there is a command-line option to configure an action, an environment variable for it, and finally a configuration variable, in descending order of preference.</p>
<p class="calibre3">Git uses a series of configuration files to determine non-default behavior that you might want to have. There are four layers of these files that Git looks through for configuration values. Git reads all these files in order from the least specific to the most specific one. The settings in the later ones override those set in the earlier ones. You can access the Git configuration with the <code>git config</code> command: by default, it operates on the union of all the files, but you can specify which one you want to access with the command-line options. You can also access any given file following the configuration file syntax (such as the <code>.gitmodules</code> file mentioned in <a href="B21194_11.xhtml#_idTextAnchor270" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter </em><em class="italic">11</em></a>,<em class="italic"> Managing Subprojects</em>) by using the <code>--file=&lt;pathname&gt;</code> option (or the <code>GIT_CONFIG</code> environment variable).</p>
<p class="callout-heading">Tip</p>
<p class="callout">You can also read the values from any blob with configuration-like contents; for example, you may use <strong class="source-inline1">git config --blob=master:.gitmodules</strong> to read from the <strong class="source-inline1">.gitmodules</strong> file in the <strong class="source-inline1">master</strong> branch.</p>
<p class="calibre3">The first place<a id="_idIndexMarker1168" class="pcalibre1 pcalibre calibre6"/> Git looks for configuration is the <code>/etc/gitconfig</code>. Well, at least, on Linux it is there, as the <code>/etc</code> is the directory for storing the<a id="_idIndexMarker1170" class="pcalibre1 pcalibre calibre6"/> host-specific system-wide configuration files; Git for Windows puts this file in the subdirectory of its <code>Program Files</code> folder. This file contains the values for every user on the system and all their repositories. To make <code>git config</code> read from and write and to this file specifically (and to open it with <code>--edit</code>), pass the <code>--system</code> option to the <code>git </code><code>config</code> command.</p>
<p class="calibre3">You can skip the reading settings from this file with the <code>GIT_CONFIG_NOSYSTEM</code> environment variable. This can be used to set up a predictable environment or to avoid using a buggy configuration you can’t fix.</p>
<p class="calibre3">The next place Git looks is the <code>~/.gitconfig</code>, falling back to <code>~/.config/git/config</code> if it exists (with the default configuration). This file is specific to each user and it affects all of the user’s repositories. If you pass the <code>--global</code> option to <code>git config</code>, it will read and write from this file specifically. Reminder: here, as in the other places, <code>~</code> (the tilde character) denotes the home directory of the current user (<code>$HOME</code>).</p>
<p class="calibre3">Finally, Git looks for the <a id="_idIndexMarker1171" class="pcalibre1 pcalibre calibre6"/>configuration values in the <code>.git/config</code>. Values set there are specific to that local single repository. You can make Git read and write to this file by passing the <code>--</code><code>local</code> option.</p>
<p class="calibre3">With modern Git, if the <code>extensions.worktreeConfig</code> is set to true (the default value is false), there can<a id="_idIndexMarker1172" class="pcalibre1 pcalibre calibre6"/> also be a <code>.git/config.worktree</code> file (see the <code>git </code><code>worktree</code> command).</p>
<p class="calibre3">Each of these levels (system, global, and local) overrides <a id="_idIndexMarker1173" class="pcalibre1 pcalibre calibre6"/>the values from the previous level, so for example, values in <code>.git/config</code> trump those in <code>~/.gitconfig</code>; well, unless the configuration variable is multivalued.</p>
<p class="callout-heading">Tip</p>
<p class="callout">You can use the fact that the local (per-repository) configuration overrides the global (per-user) configuration to have your default identity in the per-user file and to override it if necessary on a per-repository basis with a per-repository configuration file.</p>
<p class="calibre3">Finally, you can set the config variable <a id="_idIndexMarker1174" class="pcalibre1 pcalibre calibre6"/>for an individual command with the <code>-c</code> option to the <code>git</code> wrapper:</p>
<pre class="console">
$ git -c foo.int=1k config --get --type=int foo.int
1024</pre>
<p class="calibre3">See the following sections for a full explanation of this result.</p>
<h3 class="calibre9">The syntax of Git configuration files</h3>
<p class="calibre3">Git’s configuration files are plain text, so you can also customize Git’s behavior by manually editing the chosen file. The syntax is fairly flexible and permissive; whitespaces are mostly ignored (contrary to <code>.gitattributes</code>). The hash <code>#</code> and the semicolon <code>;</code> characters begin comments, which last until the end of the line. Blank lines are ignored.</p>
<p class="calibre3">The file consists <a id="_idIndexMarker1175" class="pcalibre1 pcalibre calibre6"/>of sections and variables, and its syntax is similar to the syntax of INI files. Both the section names and variable names are case-insensitive. A section begins with the name of the section in square brackets <strong class="bold">[section]</strong> and continues until the next section. Each variable must begin at some section, which means that there must be a section header before the first setting of a variable. Sections can repeat and can be empty.</p>
<p class="calibre3">Sections can be further divided into subsections. Subsection names are case-sensitive and can contain any character except newline (double quotes <code>"</code> and backslash <code>\</code> must be escaped as <code>\"</code> and <code>\\</code>, respectively). The beginning of the subsection will look as follows:</p>
<pre class="source-code">
[section "subsection"]</pre>
<p class="calibre3">All the other lines (and the remainder of the line after the section header) are recognized as a setting variable in the <code>name = value</code> form. As a special case, just <code>name</code> is a shorthand for <code>name = true</code> (boolean variables). Such lines can be continued to the next line by ending it with <code>\</code> (the backslash character), that is by escaping the end-of-line character. Leading and trailing whitespaces are discarded; internal whitespaces within the value are retained verbatim. You can use double quotes to preserve leading or trailing whitespaces in values.</p>
<h3 class="calibre9">Includes and conditional includes</h3>
<p class="calibre3">You can include one<a id="_idIndexMarker1176" class="pcalibre1 pcalibre calibre6"/> config file from another by setting the special variable <code>include.path</code> to the path of the file to be included. The included file will be <a id="_idIndexMarker1177" class="pcalibre1 pcalibre calibre6"/>expanded immediately, similar to the mechanism of <code>#include</code> in C and C++. The path is relative to the configuration file with the include directive. You can turn this feature off with the <code>--</code><code>no-includes</code> option.</p>
<p class="calibre3">You can also conditionally include a config file from another similarly by setting an <code>includeIf.&lt;condition&gt;.path</code> variable. The condition starts with a keyword, followed by a colon <code>:</code>, and data relevant to the type of conditional included.</p>
<p class="calibre3">The supported keywords are as follows:</p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold">gitdir</strong>, where the data that follows the keyword is used as a glob pattern to match the location of the <strong class="source-inline1">.git</strong> directory (of the repo itself). For convenience, <strong class="source-inline1">~</strong>and <strong class="source-inline1">~/</strong> at the beginning of the pattern are substituted with the location of the home directory, and <strong class="source-inline1">./</strong> at the beginning of the pattern is replaced with the directory containing the<a id="_idIndexMarker1178" class="pcalibre1 pcalibre calibre6"/>  current config file. There is also <strong class="bold">gitdir/i</strong> variant that <a id="_idIndexMarker1179" class="pcalibre1 pcalibre calibre6"/>does the matching in a case-insensitive way.</li>
<li class="calibre15"><strong class="bold">onbranch</strong>, which can be used to match the currently checked-out branch against the glob pattern.</li>
<li class="calibre15"><strong class="bold">hasconfig:remote.*.url</strong>, which checks whether, in any of the configuration, there exists at least one remote URL that matches the glob pattern.</li>
</ul>
<p class="calibre3">For example, to use a different configuration for repositories inside the <code>work-repos/</code> subdirectory in your home directory, you could use the following:</p>
<pre class="source-code">
[includeIf "gitdir:~/work-repos/"]
    path = ~/work.inc</pre>
<h3 class="calibre9">Accessing the Git configuration</h3>
<p class="calibre3">You can use the <code>git config</code> command to access the Git configuration, starting from listing the configuration entries in a canonical form, through examining individual variables, to editing and adding entries.</p>
<p class="calibre3">You can query the existing configuration with <code>git config --list</code>, adding an appropriate parameter if you want to limit to a single configuration layer. On a Linux box with the default installation, in the fresh empty Git repository just after <code>git init</code>, the local (per-repository) setting would look approximately like the following:</p>
<pre class="console">
$ git config --list --local
core.repositoryformatversion=0
core.filemode=false
core.bare=false
core.logallrefupdates=true</pre>
<p class="calibre3">You can also use <code>git var -l</code> to list all configuration and environment variables affecting Git.</p>
<p class="calibre3">You can also query a single <a id="_idIndexMarker1180" class="pcalibre1 pcalibre calibre6"/>key with <code>git config</code>, limiting (or not) the scope to the specified file, by giving the name of the configuration variable as a parameter (optionally preceded by <code>--get</code>), with the section, optional subsection, and variable name (key) separated by a dot:</p>
<pre class="console">
$ git config user.email</pre>
<p class="calibre3">This would return the last value, that is, the one with the greatest precedence. You can get all the values with <code>--get-all</code>, or specific keys with <code>--get-regexp=&lt;match&gt;</code>. This is quite useful while accessing a multivalued option such as <code>refspecs</code> for a remote.</p>
<p class="callout-heading">Types of configuration variables and type specifiers</p>
<p class="callout">While requesting (or writing) a<a id="_idIndexMarker1181" class="pcalibre1 pcalibre calibre6"/> config variable, you can give a <em class="italic">type specifier</em> with the <strong class="source-inline1">--type=&lt;type&gt;</strong> option. The type can be <strong class="source-inline1">bool</strong>, which ensures that the <a id="_idIndexMarker1182" class="pcalibre1 pcalibre calibre6"/>returned value is <strong class="bold">true</strong> or <strong class="bold">false</strong>; <strong class="source-inline1">int</strong>, which expands the optional value suffix of <strong class="bold">k</strong> (1,024 elements), <strong class="bold">m</strong> (1024k), or <strong class="bold">g</strong> (1024m); <strong class="source-inline1">path</strong>, which expands <strong class="bold">~</strong> for the value of <strong class="source-inline1">$HOME</strong>; and <strong class="bold">~user</strong> for the home directory of the given user, and <strong class="source-inline1">expiry-date</strong> to convert a fixed or relative date string to a timestamp.</p>
<p class="callout">There is also <strong class="source-inline1">bool-or-int</strong>, and a few options related to storing colors and retrieving color escape codes; see the <strong class="source-inline1">git </strong><strong class="source-inline1">config</strong> documentation.</p>
<p class="calibre3">With <code>--get</code>, <code>--get-all</code>, and <code>--get-regexp</code>, you can also limit the listing (and the settings for multiple-valued variables) to only those variables matching the value <code>regexp</code> (which is passed as an optional last parameter). For example, to find all configurations that affect proxying for a given host, you can use the following command:</p>
<pre class="console">
$ git config --get core.gitproxy 'for kernel\.org$'</pre>
<p class="calibre3">You can also use the <code>git config</code> command to set the configuration variable value. The local layer (per-repository file) is the default for writing if nothing else is specified. For example, to set the email address of the user, which is to be common to most of their repositories, you can run the following:</p>
<pre class="console">
$ git config --global user.name "Alice Developer"</pre>
<p class="calibre3">For multivalue configuration<a id="_idIndexMarker1183" class="pcalibre1 pcalibre calibre6"/>  options (multivar), you can add multiple lines to it by <a id="_idIndexMarker1184" class="pcalibre1 pcalibre calibre6"/>using the <code>--add</code> option. To change a single entry of a multivar config variable, you can use something like the following command, where the first value denotes which value to change, and the second denotes the new value:</p>
<pre class="console">
$ git config core.gitproxy '"ssh" for kernel.org' '"ssh" for kernel\.org$'</pre>
<p class="calibre3">It is also very easy to delete configuration entries with <code>git </code><code>config --unset</code>.</p>
<p class="calibre3">Instead of setting all the configuration values on the command line, as shown in the preceding example, it is possible to set or change them just by editing the relevant configuration file directly. Simply open the configuration file in your favorite editor, or run the <code>git config --</code><code>edit</code> command.</p>
<p class="calibre3">The local repository configuration file just after a fresh <code>git init</code> on Linux looks as follows:</p>
<pre class="source-code">
[core]
        repositoryformatversion = 0
        filemode = true
        bare = false
        logallrefupdates = true</pre>
<p class="calibre3">If you want to change a <a id="_idIndexMarker1185" class="pcalibre1 pcalibre calibre6"/> configuration by editing the configuration file, it might <a id="_idIndexMarker1186" class="pcalibre1 pcalibre calibre6"/>be prudent to first find out where the configuration variable you want to change came from.</p>
<h3 class="calibre9">Finding where configuration value came from</h3>
<p class="calibre3">With three (or four) layers <a id="_idIndexMarker1187" class="pcalibre1 pcalibre calibre6"/>of configuration files, it might be difficult to find out where the given configuration variable was set, and whether it was overridden or added to in a more specific configuration file. Then there is the additional complication of taking into account the <code>include</code> and <code>includeIf</code> sections.</p>
<p class="calibre3">That is where the <code>--show-origin</code> and <code>--show-source</code> options passed to the <code>git config</code> command together with the <code>--list</code> or <code>--get/--get-all</code> options can help. The <code>git config --list</code> command will list all variables set in config files, along with their values. The <code>--show-scope</code> option augments the output of all queried config options with the scope of that value (worktree, local, global, system, command), while <code>--show-source</code> shows the origin type (file, standard input, command line, blob) and the actual origin (config file path, or blob ID, if applicable).</p>
<p class="callout-heading">Debugging per-file configuration</p>
<p class="callout">You can use <strong class="source-inline1">git check-ignore</strong> to examine why a file is ignored, and <strong class="source-inline1">git check-attr</strong> to find out the attributes assigned to the file and where they came from.</p>
<p class="calibre3">For example, let’s assume that user identity is defined in a per-user configuration file: <code>~/.gitconfig</code></p>
<pre class="console">
[user]
    name  = Joe Random
    email = joe@company.com</pre>
<p class="calibre3">Let’s also assume<a id="_idIndexMarker1188" class="pcalibre1 pcalibre calibre6"/> that the <code>git config</code> command was used to create the <code>work.inc</code> file in the top directory of the project, and to include it from the per-repository config file:</p>
<pre class="console">
$ git config --file=conf.inc foo.bar val
$ git config --local include.path ./conf.inc</pre>
<p class="calibre3">In that context, we would get the following query results, shown here in shortened form:</p>
<pre class="console">
$ git config --show-scope --show-origin --list
global  file:/home/joe/.gitconfig  user.name=Joe Random
global  file:/home/joe/.gitconfig  user.email=joe@company.com
local   file:.git/config        core.repositoryformatversion=0
local   file:.git/config        core.filemode=false
[…]
local   file:.git/config        include.path=./../conf.inc
local   file:.git/./../conf.inc foo.bar=val</pre>
<p class="calibre3">The first column shows the scope, the second column the origin, and the third the fully qualified config variable and its value.</p>
<h3 class="calibre9">Basic client-side configuration</h3>
<p class="calibre3">You can divide the<a id="_idIndexMarker1189" class="pcalibre1 pcalibre calibre6"/> configuration options recognized by Git into two categories: client side and server side. The majority of the options are about configuring your personal working preferences; they are client side. The server-side configuration will be touched upon in more detail in <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a>,<em class="italic"> Git Administration</em>; in this section, you will find only the basics.</p>
<p class="calibre3">There are many supported configuration options, but only a small fraction of them <em class="italic">needs</em> to be set; a large fraction of them has sensible defaults, and explicitly setting them is only useful in certain edge cases. There are a lot of options available; you can see a list of all the options with <code>git config --help</code>. Here we’ll be covering only the most common and most useful options.</p>
<p class="calibre3">Two variables that really need to be <a id="_idIndexMarker1190" class="pcalibre1 pcalibre calibre6"/>set up are <strong class="bold">user.email</strong> and <strong class="bold">user.name</strong>.Those configuration variables define the user’s identity (though in modern Git, you can set up separate identities for authoring changes and for committing them with <strong class="bold">author.name</strong> and <strong class="bold">committer.name</strong>). Also, if you are signing annotated tags or commits (as discussed in <a href="B21194_06.xhtml#_idTextAnchor140" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 6</em></a>,<em class="italic"> Collaborative Development with Git</em>), you might want to set up your GPG signing key ID. This is done with the <strong class="bold">user.signingKey</strong> configuration setting.</p>
<p class="calibre3">By default, Git uses whatever you’ve set on the system as your default text editor (defined with the <code>VISUAL</code> or <code>EDITOR</code> environment variables; the first only for the graphical desktop environment) to create and edit your commit and tag messages. It also uses whatever you have set as the pager (<code>PAGER</code>) for paginating and browsing the output of the Git commands. To change this default to something else, you can use the <code>vi</code> editor and on the <code>less</code> pager.</p>
<p class="calibre3">With Git, the pager is invoked automatically. The default <code>less</code> pager supports not only pagination, but also incremental search and other features.</p>
<p class="callout-heading">Important note</p>
<p class="callout">With the default configuration (the <strong class="source-inline1">LESS</strong> environment variable is not set), <strong class="source-inline1">less</strong> when invoked by Git works as if it was invoked with <strong class="source-inline1">LESS=FRX</strong>. This means that it would skip pagination if there were less than one page of output, it would pass through ANSI color codes, and it would not clear the screen on exit.</p>
<p class="calibre3">Creating commit messages is also affected by <strong class="bold">commit.template</strong>. If you set this configuration variable, Git will use that file as the default message when you commit. The template is not distributed with the repository in general. Note that Git would add the status information to the commit message template unless it is forbidden to do it by setting <strong class="bold">commit.status</strong> to false.</p>
<p class="calibre3">Such a template is quite convenient if you have a commit-message policy, as it greatly increases the chances of this <a id="_idIndexMarker1191" class="pcalibre1 pcalibre calibre6"/>policy being followed. It can, for example, include the commented-out instructions for filling the commit message. You can augment this solution with an appropriate hook that checks whether the commit message matches the policy (see the <em class="italic">Commit process hooks</em> section later in this chapter).</p>
<p class="calibre3">The status of the files in the working area is affected by the ignore patterns and the file attributes (see <a href="B21194_03_split_000.xhtml#_idTextAnchor049" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 3</em></a>,<em class="italic"> Managing Your </em><em class="italic">Worktrees</em>). You can put ignore patterns in your project’s in-tree <code>.gitignore</code> file (usually, <code>.gitignore</code> is about which files are not to be tracked, and it is tracked itself by Git), or in the <code>.git/info/excludes</code> file for local and private patterns, to define which files are not interesting. These are project-specific; sometimes, you would want to write a kind of global (per-user) <code>.gitignore</code> file. You can use <code>~/.config/git/ignore</code>. There is also a corresponding <code>.gitattributes</code> files, which defaults to <code>~/.config/git/attributes</code>.</p>
<p class="callout-heading">Trivia</p>
<p class="callout">Actually, it is <strong class="source-inline1">$XDG_CONFIG_HOME/git/ignore</strong>; if the <strong class="source-inline1">$XDG_CONFIG_HOME</strong> environment variable is not set or is empty, <strong class="source-inline1">$HOME/.config/git/ignore</strong> is used.</p>
<p class="calibre3">Although Git has an internal implementation of diff, you can set up an external tool to be used instead with the help of <strong class="bold">diff.external</strong>. You would usually want to create a wrapper script that massages the parameters that Git passes to it and passes the ones needed in the order external diff requires. By default, Git passes the following arguments to the diff program:</p>
<pre class="console">
path old-file old-hex old-mode new-file new-hex new-mode</pre>
<p class="calibre3">See also the <em class="italic">Graphical diff and merge tools</em> section for the configuration of <code>git difftool</code> and <code>git mergetool</code>.</p>
<h3 class="calibre9">The rebase and merge setup, configuring pull</h3>
<p class="calibre3">When performing <code>git pull</code> operation, Git needs to know whether you prefer to use the <em class="italic">merge</em> operation to join the local history and the history fetched from the remote, or the <em class="italic">rebase</em> operation to<a id="_idIndexMarker1192" class="pcalibre1 pcalibre calibre6"/> join histories. That is why it requires you to provide a value for the <code>pull.rebase</code> configuration variable. You can find more information on the topic of merge and rebase in <a href="B21194_09.xhtml#_idTextAnchor229" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 9</em></a>, <em class="italic">Merging </em><em class="italic">Changes Together</em>.</p>
<p class="calibre3">There are several configuration settings that can be used to configure the behavior of <code>git pull</code>. There is the <code>pull.rebase</code> configuration option and a branch-specific <code>branch.&lt;name&gt;.rebase</code> option that, when set to <code>true</code>, tells Git to perform a rebase during the pull operation (for the <code>&lt;name&gt;</code> branch only in the latter case). If set to <code>false</code>, then <code>git pull</code> performs a merge. Both can also be set to <code>merges</code> to run rebase with the <code>--rebase-merges</code> option, to have local merge commits not be flattened in the process of rebasing.</p>
<p class="calibre3">You can make Git automatically set up the per-branch “pull to rebase” configuration while creating specific kinds of new branches with <code>branch.autoSetupRebase</code>. You can set it to <code>never</code>, <code>local</code> (for locally tracked branches only), <code>remote</code> (for remote tracked branches only), or <code>always</code> (for local plus remote). There is also <code>branch.autoSetupMerge</code> to set up a branch to track another branch.</p>
<h3 class="calibre9">Preserving undo information – the expiry of objects</h3>
<p class="calibre3">By default, Git will automatically<a id="_idIndexMarker1193" class="pcalibre1 pcalibre calibre6"/> remove unreferenced objects, clean <code>git gc</code> command. You should know about a repository’s object-oriented structure from <a href="B21194_10_split_000.xhtml#_idTextAnchor247" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 10</em></a>,<em class="italic"> Keeping </em><em class="italic">History Clean</em>.</p>
<p class="calibre3">Git will, for safety reasons, use a grace period of two weeks while removing unreferenced objects; this can be changed with the <code>gc.pruneExpire</code> configuration: the setting is usually a relative date (for example, <code>1.month.ago</code>; you can use dots as word separators). To disable the grace period (which is usually done from the command line), the <code>now</code> value can be used.</p>
<p class="calibre3">The branch tip history is kept for 90 days by default (or <code>gc.reflogExpire</code>, if set) for reachable revisions, and for 30 days (or <code>gc.reflogExpireUnreachable</code>) for reflog entries that are not a part of the current history. Both settings can be configured on a per-reframe basis, by supplying a pattern of the ref name to be matched as a subsection name, that is, <code>gc.&lt;pattern&gt;.reflogExpire</code>, and similar for the other setting. This can be<a id="_idIndexMarker1194" class="pcalibre1 pcalibre calibre6"/> used to change the expire settings for <code>HEAD</code> or for <code>refs/stash</code> (see <a href="B21194_03_split_000.xhtml#_idTextAnchor049" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 3</em></a>,<em class="italic"> Managing Your </em><em class="italic">Worktrees</em>), or for remote-tracking branches <code>refs/remotes/*</code> separately. The setting is a length of time (for example, 6 months); to completely turn off reflog expiry, use the value of <code>never</code>. You can use the latter, for example, to switch off the expiring of <code>stash</code> entries.</p>
<h3 class="calibre9">Formatting and whitespace</h3>
<p class="calibre3">Code formatting and whitespace issues are some of the more frustrating and subtle problems you may encounter<a id="_idIndexMarker1195" class="pcalibre1 pcalibre calibre6"/> while collaborating, especially with cross-platform development. It’s very easy for patches and merges to introduce subtle and unnecessary whitespace changes, because editing the code can silently introduce such changes (which are often not visible), and because there are different notions of line endings on different operating systems: MS Windows, Linux, and macOS. Git has a few configuration options to help with these issues.</p>
<p class="calibre3">One important issue for cross-platform work is the notion of <strong class="bold">line-ending</strong>. This is because MS Windows uses a<a id="_idIndexMarker1196" class="pcalibre1 pcalibre calibre6"/> combination of a <strong class="bold">carriage return</strong> (<strong class="bold">CR</strong>) character<a id="_idIndexMarker1197" class="pcalibre1 pcalibre calibre6"/> and a <strong class="bold">linefeed</strong> (<strong class="bold">LF</strong>) character for new lines in text files, whereas macOS and Linux use only a linefeed character. Many editors on MS Windows will silently replace existing LF-style line endings with CRLF or use CRLF for new lines, which leads to subtle but annoying issues.</p>
<p class="calibre3">Git can handle this issue by auto-converting line endings into LF when you add a file to the index. If your editor uses CRLF line endings, Git can also convert line endings to the native form when it checks out code in your filesystem. There are two configuration settings that affect this matter: <code>core.eol</code> and <code>core.autocrlf</code>. The first setting, <code>core.eol</code>, sets the line ending to be used while checking out files into the working directory for files that have the <code>text</code> property set (see the following <em class="italic">Per-file configuration with gitattributes</em> section, which summarizes and recalls information about the file attributes from <a href="B21194_03_split_000.xhtml#_idTextAnchor049" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 3</em></a>,<em class="italic"> Managing </em><em class="italic">Your </em><em class="italic">Worktrees</em>).</p>
<p class="calibre3">The second and older setting, <code>core.autocrlf</code>, can be used to turn on the automatic conversion of line endings to CRLF. Setting it to <code>true</code> converts the LF line endings in the repository into CRLF when you check out files, and vice versa when you stage them; this is the setting you would probably want on a Windows machine. (This is almost the same as setting the <code>text</code> attribute to <code>core.eol</code> to <code>crlf</code>.) You can tell Git to convert CRLF to LF on a commit but not the other way around by setting <code>core.autocrlf</code> to <code>input</code> instead; this is the setting to use if you are on a Linux or Mac system. To turn off this functionality, recording the line-endings in the repository as they are set this configuration value to <code>false</code>.</p>
<p class="calibre3">This handles one part of the<a id="_idIndexMarker1198" class="pcalibre1 pcalibre calibre6"/>  whitespace issues – line-ending variance, and one vector of introducing them – editing files. Git also comes with a way to detect and fix some of the other whitespace issues. It can be configured to look for a set of common whitespace problems. The <code>core.whitespace</code> configuration setting can be used to activate them (for those disabled by default) or turn them off (for those enabled by default). The three that are turned on by default are the following:</p>
<ul class="calibre16">
<li class="calibre15"><strong class="source-inline1">blank-at-eol</strong>: This looks for trailing spaces at the end of a line</li>
<li class="calibre15"><strong class="source-inline1">blank-at-eof</strong>: This notices blank lines at the end of a file</li>
<li class="calibre15"><strong class="source-inline1">space-before-tab</strong>: This looks for spaces immediately before the tabs at the initial (beginning) indent part of the line</li>
</ul>
<p class="calibre3">The <code>trailing-space</code> value in <code>core.whitespace</code> is a shorthand to cover both <code>blank-at-eol</code> and <code>blank-at-eof</code>.</p>
<p class="calibre3">The three that are disabled by default but can be turned on are the following:</p>
<ul class="calibre16">
<li class="calibre15"><strong class="source-inline1">indent-with-non-tab</strong>: This treats the line that is indented with space characters instead of the equivalent tabs as an error (where equivalence is controlled by the <strong class="source-inline1">tabwidth</strong> option). This option enforces <em class="italic">indenting with</em><em class="italic"> </em><em class="italic">Tab characters</em>.</li>
<li class="calibre15"><strong class="source-inline1">tab-in-indent</strong>: This watches for tabs in the initial indentation portion of the line (here, <strong class="source-inline1">tabwidth</strong> is used to fix such whitespace errors). This option enforces <em class="italic">indenting with </em><em class="italic">space characters</em>.</li>
<li class="calibre15"><strong class="source-inline1">cr-at-eol</strong>: This tells Git that carriage returns at the end of the lines are OK (allowing CRLF endings in the repository).</li>
</ul>
<p class="calibre3">You can tell Git which of these you want enabled or disabled by setting <code>core.whitespace</code> to the comma-separated list of values. To disable an option, prepend it with the <code>-</code> prefix in front of the value. For example, if you want all but <code>cr-at-eol</code> and <code>tab-in-indent</code> to be set, and also while setting the <em class="italic">Tab</em> space value to <code>4</code>, you can use:</p>
<pre class="console">
$ git config --local core.whitespace \
    trailing-space,space-before-tab,indent-with-non-tab,tabwidth=4</pre>
<p class="calibre3">You can also set these options on a <a id="_idIndexMarker1199" class="pcalibre1 pcalibre calibre6"/> per-file basis with the <code>whitespace</code> attribute. For example, you can use it to turn off checking for whitespace problems in test cases to handle whitespace issues or ensure that the Python 2 code indents with spaces:</p>
<pre class="source-code">
*.py whitespace=tab-in-indent</pre>
<p class="callout-heading">EditorConfig</p>
<p class="callout">There exists the <a id="_idIndexMarker1200" class="pcalibre1 pcalibre calibre6"/>EditorConfig project (<a href="https://editorconfig.org/" class="pcalibre1 pcalibre calibre6">https://editorconfig.org/</a>) that consists of a file format for defining coding styles, including the type of line endings, and a collection of text editor plugins that make editors adhere to the chosen style. The <strong class="source-inline1">.editorconfig</strong> file should be tracked by Git.</p>
<p class="calibre3">Git will detect these issues when you run a <code>git diff</code> command and inform you about them using the <code>color.diff.whitespace</code> color, so you can notice them and possibly fix them before you create a new commit. While applying patches with <code>git apply</code>, you can ask Git to either warn about the whitespace issues with <code>git apply --whitespace=warn</code>, error out with <code>--whitespace=error</code>, or you can have Git try to automatically fix the issue with <code>--whitespace=fix</code>. The same applies to the <code>git rebase</code> command as well.</p>
<h3 class="calibre9">Server-side configuration</h3>
<p class="calibre3">There are a few configuration options available for the server side of Git. They will be described in more detail in <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a>,<em class="italic"> Git Administration</em>; here you will find a short summary of some <a id="_idIndexMarker1201" class="pcalibre1 pcalibre calibre6"/>of the more interesting parameters.</p>
<p class="calibre3">You can make the Git server check for object consistency, namely, that every object received during a push matches its SHA-1 identifier, and that it is a valid object, with a <code>receive.fsckObjects</code> Boolean-valued configuration variable. It is turned off by default because <code>git fsck</code> is a fairly expensive operation, and it might slow down operations, especially on large pushes (which are common in large repositories). This is a check against faulty or malicious clients.</p>
<p class="calibre3">If you rewrite commits that you have already pushed to a server (which is bad practice, as explained in <a href="B21194_10_split_000.xhtml#_idTextAnchor247" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 10</em></a>,<em class="italic"> Keeping History Clean</em>) and try to push again, you’ll be denied. The client might, however, force-update the remote branch with the <code>--force</code> flag to the <code>git push</code> command. However, the server can be told to refuse force-pushes by setting <code>receive.denyNonFastForward</code> to <code>true</code>.</p>
<p class="calibre3">The <code>receive.denyDeletes</code> setting blocks one of the workarounds to the <code>denyNonFastForward</code> policy, namely, deleting and recreating a branch. This forbids the deletion of branches and tags; you must remove refs from the server manually.</p>
<p class="calibre3">All of these features could also be implemented via the server-side receive-like hooks; this will be covered in the <em class="italic">Installing a Git hook</em> section, and also to some extent in <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a>,<em class="italic"> </em><em class="italic">Git Administration</em>.</p>
<h2 id="_idParaDest-306" class="calibre7"><a id="_idTextAnchor335" class="pcalibre1 pcalibre calibre6"/>Per-file configuration with gitattributes</h2>
<p class="calibre3">Some of the customizations can also be specified for a path (perhaps via glob) so that Git applies these settings <a id="_idIndexMarker1202" class="pcalibre1 pcalibre calibre6"/>only for a subset of files or for a subdirectory. These path-specific settings are called gitattributes.</p>
<p class="calibre3">The order of precedence of applying this type of settings starts with the per-repository local (per-user) per-path settings in the <code>$GIT_DIR/info/attributes</code> file. Then, the <code>.gitattributes</code> files are consulted, starting with the one in the same directory as the path in question, going up through the <code>.gitattributes</code> files in the parent directories, up to the top level of the worktree (the root directory of a project).</p>
<p class="calibre3">Finally, the global per-user attributes file (specified by <code>core.attributesFile</code>, or at <code>~/.config/git/attributes</code> if this is not set) and the system-wide file (in <code>/etc/gitattributes</code> in the default installation) are considered.</p>
<p class="calibre3">Available Git attributes are described in detail in <a href="B21194_03_split_000.xhtml#_idTextAnchor049" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 3</em></a>,<em class="italic"> Managing Your </em><em class="italic">Worktrees</em>. Using attributes, you can, among others, do things such as specify the separate merge strategies via merge drivers for the specific kind of files (for example, <code>ChangeLog</code>), tell Git how to diff non-text files, or have Git filter content during checkout (on writing to the working area, that is, to the filesystem) and commit (on staging contents and committing changes to the repository, that is, creating objects in the repository database).</p>
<h3 class="calibre9">Syntax of the Git attributes file</h3>
<p class="calibre3">A <code>gitattributes</code> file is a simple <a id="_idIndexMarker1203" class="pcalibre1 pcalibre calibre6"/>text file that sets up the local configuration on a per-path basis. Blank lines and lines starting with the hash character (<code>#</code>) are ignored; thus, a line starting with <code>#</code> serves as a comment, while blank lines can serve as separators for readability. To specify a set of attributes for a path, put a pattern  followed by an attributes list, separated by a horizontal whitespace:</p>
<pre class="console">
pattern    attribute1 attribute2</pre>
<p class="calibre3">When more than one pattern matches the path, a later line overrides an earlier line, just like for the <code>.gitignore</code> files (you can also think that the Git attributes files are read from the least specific system-wide file to the most specific local repository file).</p>
<p class="calibre3">Git uses a backslash (<code>\</code>) as an escape character for patterns. Thus, for patterns that begin with a hash, you need to put a backslash in front of the first hash (that is written as <code>\#</code>). Because the attributes information is separated by whitespaces, trailing spaces in the pattern are ignored <a id="_idIndexMarker1204" class="pcalibre1 pcalibre calibre6"/>and inner spaces are treated as the end of the pattern unless they are quoted with a backslash (that is, written as “<strong class="bold">\ </strong>“).</p>
<p class="calibre3">If the pattern does not contain a slash (<code>/</code>), which is a directory separator, Git will treat the pattern as a shell glob pattern and will check for a match against the pathname relative to the location of the <code>.gitattributes</code> file (or the top level for other attribute files). Thus, for example, the <code>*.c</code> patterns match the C files anywhere down from the place the <code>.gitattributes</code> file resides. A leading slash matches the beginning of the pathname. For example, <code>/*.c</code> matches <code>bisect.c</code> but not <code>builtin/bisect--helper.c</code>, while the <code>*.c</code> pattern would match both.</p>
<p class="calibre3">If the pattern includes at least one slash, Git will treat it as a shell glob suitable for consumption by the <code>fnmatch(3)</code> function call with the <code>FNM_PATHNAME</code> flag. This means that the wildcards in the pattern will not match the directory separator, that is, the slash (<code>/</code>) in the pathname; the match is anchored to the beginning of the path. For example, the <code>include/*.h</code> pattern matches <code>include/version.h</code> but not <code>include/linux/asm.h</code> or <code>libxdiff/includes/xdiff.h</code>. The shell glob wildcards are the following:</p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold">*</strong> matching any string (including empty)</li>
<li class="calibre15"><strong class="bold">?</strong> matching any single character</li>
<li class="calibre15"><strong class="bold">[…]</strong> expression matching the character class (inside brackets, asterisks and question marks lose their special meaning); note that unlike in regular expressions, the complementation/negation of the character class is done with <strong class="source-inline1">!</strong> and not <strong class="source-inline1">^</strong>. For example, to match anything but a number, one can use the <strong class="source-inline1">[!0-9]</strong> shell pattern, which is equivalent to <strong class="source-inline1">[^0-9]</strong> in a regexp.</li>
</ul>
<p class="calibre3">Two consecutive asterisks (<code>**</code>) in patterns may have a special meaning, but only between two slashes (<code>/**/</code>), or between a slash and at the beginning or the end of the pattern. Such a wildcard matches zero or more path components. Thus, a leading <code>**</code> followed by a slash (<code>**/</code>) means a match in all directories, while a trailing <code>/**</code> matches every file or directory inside the specified directory.</p>
<p class="calibre3">Each attribute can be in one <a id="_idIndexMarker1205" class="pcalibre1 pcalibre calibre6"/>of four states for a given path:</p>
<ul class="calibre16">
<li class="calibre15">First, it can be <strong class="bold">set</strong> (the attribute has a special value of true). This is specified by simply listing the name of the attribute in the attribute list, for example, <strong class="source-inline1">text</strong>.</li>
<li class="calibre15">Second, it can be <strong class="bold">unset</strong> (the attribute has a special value of false). This is specified by listing the name of the attribute prefixed with minus, for example, <strong class="source-inline1">-text</strong>.</li>
<li class="calibre15">Third, it can be <strong class="bold">set to a specific value</strong>; this is specified by listing the name of the attribute followed by an equal sign and its value, for example, <strong class="source-inline1">text=auto</strong> (note that there cannot be any whitespace around the equal sign as opposed to the configuration file syntax).</li>
<li class="calibre15">If no pattern matches the path, and nothing dictates whether the path has or does not have attributes, the attribute is said to be <strong class="bold">unspecified </strong>(you can override the setting for an attribute, forcing it to be explicitly unspecified with <strong class="source-inline1">!text</strong>).</li>
</ul>
<p class="calibre3">If you find yourself using the same set of attributes over and over for many different patterns, you should consider defining a macro attribute. This can be defined in the local, global, or system-wide attributes file, but (from all possible places for a repository-specific attributes file), macros can be defined only in the top level <code>.gitignore</code> file. The macro is defined using <code>[attr]&lt;macro&gt;</code> in place of the file pattern; the attributes list defines the expansion of the macro. For example, the built-in <code>binary</code> macro attribute is defined as follows:</p>
<pre class="console">
[attr]binary -diff -merge -text</pre>
<p class="calibre3">But command-line options, environment variables, configuration files, gitattributes, and gitignore files are not the only ways to change what Git is doing. There is also the hooks mechanism, which can<a id="_idIndexMarker1206" class="pcalibre1 pcalibre calibre6"/> be used to make Git trigger user-defined actions automatically at specific points in Git’s execution.</p>
<h1 id="_idParaDest-307" class="calibre5"><a id="_idTextAnchor336" class="pcalibre1 pcalibre calibre6"/>Automating Git with hooks</h1>
<p class="calibre3">There are usually certain prerequisites to the <a id="_idIndexMarker1207" class="pcalibre1 pcalibre calibre6"/>code that is produced, either self-induced or enforced externally. The code should always be able to compile and pass at least <a id="_idIndexMarker1208" class="pcalibre1 pcalibre calibre6"/>a fast subset of the tests. With some development workflows, each commit message may need to reference an issue ID (or match the message template), or include a digital certificate of origin in the form of the <strong class="bold">Signed-off-by</strong> line. In many cases, these parts of the development process can be automated by Git.</p>
<p class="calibre3">Like many programming tools, Git includes a way to fire custom functionality contained in the user-provided code (custom scripts), when certain important pre-defined actions occur, that is, when certain events trigger. Such a functionality invoked as an event handler is called a <strong class="bold">hook</strong>. It allows us to<a id="_idIndexMarker1209" class="pcalibre1 pcalibre calibre6"/> take additional action and, at least for some hooks, also to stop the triggered functionality.</p>
<p class="calibre3">Hooks in Git can be divided into client-side and <a id="_idIndexMarker1210" class="pcalibre1 pcalibre calibre6"/>server-side hooks. <strong class="bold">Client-side hooks</strong> are triggered by local operations (on the client) such as committing, applying a patch series, rebasing, and merging. <strong class="bold">Server-side hooks</strong> on the other hand run on the server when network operations occur, such <a id="_idIndexMarker1211" class="pcalibre1 pcalibre calibre6"/>as receiving pushed commits.</p>
<p class="calibre3">You can also divide hooks into prehooks and <a id="_idIndexMarker1212" class="pcalibre1 pcalibre calibre6"/>post hooks. <strong class="bold">Pre hooks</strong> are called before an operation is finished, usually before the next step while performing an operation. If they exit with a nonzero value, they will cancel the current Git operation. <strong class="bold">Post hooks</strong> are invoked after<a id="_idIndexMarker1213" class="pcalibre1 pcalibre calibre6"/> an operation finishes and can be used for notification and logs; they cannot cancel an operation.</p>
</div>


<div><h2 id="_idParaDest-308" class="calibre7"><a id="_idTextAnchor337" class="pcalibre1 pcalibre calibre6"/>Installing a Git hook</h2>
<p class="calibre3">The hooks in Git are <a id="_idIndexMarker1214" class="pcalibre1 pcalibre calibre6"/>executable programs (usually scripts), which are stored in the <code>hooks/</code> subdirectory of the Git repository administrative area, that is, <code>.git/hooks/</code> for non-bare repositories. You can change the location of the directory that Git searches for hooks via <code>core.hooksPath</code> configuration variable.</p>
<p class="calibre3">Hook programs are each named after the event that triggers them. This means that if you want one event to trigger more than one script, you will need to implement multiplexing yourself.</p>
<p class="calibre3">When you initialize a new repository with <code>git init</code> (this is done also while using <code>git clone</code> to create a copy of the other repository; clone calls <code>init</code> internally), Git populates the <code>.git/hooks/</code> directory with a bunch of inactive example scripts. Many of these are useful by themselves, but they also document the hook’s API. All the examples are written as shell or Perl scripts, but any properly named executable would work just fine. If you want to use bundled example hook scripts, you’ll need to rename them, stripping the <code>.sample</code> extension and ensuring that they have the executable permission bit.</p>
<h2 id="_idParaDest-309" class="calibre7"><a id="_idTextAnchor338" class="pcalibre1 pcalibre calibre6"/>A template for repositories</h2>
<p class="calibre3">Sometimes you would want to have<a id="_idIndexMarker1215" class="pcalibre1 pcalibre calibre6"/> the same set of hooks for all your repositories. You can have a global (per-user and system-wide) configuration file, a global attributes file, and a global ignore list. It turns out that it is possible to select hooks to be populated during the creation of the repository. The default sample hooks that get copied to the <code>.git/hooks</code> repository are populated from <code>/usr/share/git-core/templates</code>.</p>
<p class="calibre3">Also, the alternative directory with the repository creation templates can be given as a parameter to the <code>--template</code> command-line option (to <code>git clone</code> and <code>git init</code>), as the <code>GIT_TEMPLATE_DIR</code> environment variable, or as the <code>init.templateDir</code> configuration option (which can be set in a per-user configuration file). This directory must follow the directory structure of <code>.git</code> (of <code>$GIT_DIR</code>), which means that the hooks need to be in the <code>hooks/</code> subdirectory there.</p>
<p class="calibre3">Note, however, that this mechanism has some limitations. As the files from the template directory are only copied to the Git repositories on their initialization, updates to the template directory do not affect the existing repositories. Though you can re-run <code>git init</code> in the existing repository to reinitialize it, just remember to save any modifications made to the hooks.</p>
<p class="callout-heading">Hook management tools</p>
<p class="callout">Maintaining hooks for a team of developers can be tricky. There are many tools and frameworks for Git hook management; examples include <strong class="bold">Husky</strong> and <strong class="bold">pre-commit</strong>. You can find more examples of such<a id="_idIndexMarker1216" class="pcalibre1 pcalibre calibre6"/> tools listed on the <a href="https://githooks.com" class="pcalibre1 pcalibre calibre6">https://githooks.com</a> site. Those tools often allow for easier skipping hooks, running common code for all the hooks, or running multiple scripts for a specific hook.</p>
<h2 id="_idParaDest-310" class="calibre7"><a id="_idTextAnchor339" class="pcalibre1 pcalibre calibre6"/>Client-side hooks</h2>
<p class="calibre3">There are quite a few <a id="_idIndexMarker1217" class="pcalibre1 pcalibre calibre6"/>client-side hooks. They can be divided into the commit-workflow hooks (a set of hooks invoked by the different stages of creating a new commit), apply-email<a id="_idIndexMarker1218" class="pcalibre1 pcalibre calibre6"/> workflow hooks, and everything else (not organized into a multihook workflow).</p>
<p class="callout-heading">Important note</p>
<p class="callout">It is important to note that hooks are <em class="italic">not </em>copied when you clone a repository. This is done partially for security reasons, as hooks run unattended and mostly invisibly. You need to copy (and rename) files themselves, though you can control which hooks get installed when creating or reinitializing a repository (see the previous subsection). This means that you cannot rely on the client-side hooks to enforce a policy; if you need to introduce some hard requirements, you’ll need to do it on the server side.</p>
<h3 class="calibre9">Commit process hooks</h3>
<p class="calibre3">There are four client-side<a id="_idIndexMarker1219" class="pcalibre1 pcalibre calibre6"/> hooks invoked (by default) while committing changes. They are as follows.</p>
<h4 class="calibre19">The pre-commit hook</h4>
<p class="calibre3">The <code>git commit -–no-verifies</code>. This hook takes no parameters.</p>
<p class="calibre3">This hook can, among others, be used to check for the correct code style, run the static code analyzer (linter) to check for problematic constructs, make sure that the code compiles and that it passes all the tests (and that the new code is covered by the tests), or check for the appropriate documentation on some new functionality. The default hook checks for whitespace errors (trailing whitespace by default) with <code>git diff --check</code> (or rather its plumbing equivalent), and optionally for non-ASCII filenames in the changed files. You can, for example, make a hook that asks for a confirmation while committing with a dirty work-arena (for the changes in the worktree that would not be a part of the commit being created); though it is an advanced technique. Or, you can have it check whether there is<a id="_idIndexMarker1222" class="pcalibre1 pcalibre calibre6"/> documentation and unit tests on the new methods.</p>
<p class="calibre3">There is also the <code>git merge</code>. By default the hook, when enabled, runs the <code>pre-commit</code> hook.</p>
<h4 class="calibre19">The prepare-commit-msg hook</h4>
<p class="calibre3">The <code>commit.template</code>, if any), and before the commit message is opened in the editor. It lets you edit the default commit message or create a template programmatically, before the commit author sees it. If the hook fails with a nonzero status, the commit will be aborted. This hook takes as parameters the path to the file that holds the commit message (later passed to the editor) and the information about source of the commit message (the latter is not present for ordinary <code>git commit</code>): <code>-m</code> or <code>-F</code> option was given, <code>-t</code> option was given or <code>commit.template</code> was set, <code>.git/MERGE_MSG</code> file exists, <code>.git/SQUASH_MSG</code> file exists, or <code>-c</code>, <code>-C</code>, or <code>--amend</code> option was given. In the last case, the hook gets additional parameters, namely, a SHA-1 hash of the commit that is the source of the message.</p>
<p class="calibre3">The purpose of this hook is to edit or create the commit message, and this hook is not suppressed by the <code>--no-verify</code> option. This hook is most useful when it is used to affect commits where the default message is autogenerated, such as the templated commit message, merged commits, squashed commits, and amended commits. The sample hook that Git provides comments out the <code>Conflict:</code> part of the merge commit message.</p>
<p class="calibre3">Another example of what this hook can do is to use the description of the current branch given by <code>branch.&lt;branch-name&gt;.description</code>, if it exists, as a base for a branch-dependent dynamic commit template. Or perhaps, it can check whether we are on the topic branch, and then list all the issues assigned to you on a project issue tracker, to make it easy to add the proper artifact ID to the commit message.</p>
<h4 class="calibre19">The commit-msg hook</h4>
<p class="calibre3">The <code>.git/COMMIT_EDITMSG</code>).</p>
<p class="calibre3">If this script exits with a nonzero status, Git aborts the commit process, so you can use it to validate that, for example, the commit message matches the project state, or that the commit message conforms to the required pattern. The sample hook provided by Git can check, sort, and remove duplicated <code>Signed-off-by:</code><strong class="bold"> </strong>lines (which might be not what you want to use, if signoffs are to be a chain of provenance). You could conceivably check in this hook whether the references to the issue numbers are correct (and perhaps expand them, adding the current summary of each mentioned issue).</p>
<p class="calibre3">Gerrit Code Review provides a <code>commit-msg</code> hook (which needs to be installed in the local Git repository) to automatically create, insert, and maintain a unique <code>Change-Id:</code> line above the signoffs during <code>git commit</code>. This line is used to track the iterations of coming up with a commit; if the commit message in the revision pushed to Gerrit lacks such information, the server will provide instructions on how to get and install that hook script.</p>
<h4 class="calibre19">The post-commit hook</h4>
<p class="calibre3">The <code>HEAD</code>. The exit status of this hook is ignored. There is also the <strong class="bold">post-merge hook</strong>.</p>
<p class="calibre3">Generally, this script (like most of the <code>post-*</code> scripts) is most often used for notifications and logging, and it obviously cannot affect the outcome of <code>git commit</code>. You can use it, for example, to trigger a local build in a continuous integration tool such as Jenkins. In most cases, however, you would want to do this with the <code>post-receive</code> hook on the dedicated continuous integration server.</p>
<p class="calibre3">Another use case is to<a id="_idIndexMarker1230" class="pcalibre1 pcalibre calibre6"/> list information about all the <strong class="bold">TODO</strong> and <strong class="bold">FIXME</strong> comments in the code and documentation (for example, the author, version, file path, line number, and message), printing them to the<a id="_idIndexMarker1231" class="pcalibre1 pcalibre calibre6"/> standard output of the hook, so that that they<a id="_idIndexMarker1232" class="pcalibre1 pcalibre calibre6"/> are not forgotten and remain up to date and useful.</p>
<h3 class="calibre9">Hooks for applying patches from emails</h3>
<p class="calibre3">You can set up three client-side<a id="_idIndexMarker1233" class="pcalibre1 pcalibre calibre6"/> hooks for the email-based workflow (where commits are sent by email). They are all invoked by the <code>git am</code> command (the name of which comes from <code>git format-patch</code> and sent with <code>git sent-email</code>) and turn them into a series of commits. We will cover these hooks next.</p>
<h4 class="calibre19">The applypatch-msg hook</h4>
<p class="calibre3">The first hook to run is the <strong class="bold">applypatch-msg hook</strong>. It is run after extracting the commit message <a id="_idIndexMarker1234" class="pcalibre1 pcalibre calibre6"/>from the patch and <a id="_idIndexMarker1235" class="pcalibre1 pcalibre calibre6"/>before applying the patch itself. As usual, for a hook which is not a post-* hook, Git aborts applying the patch if this hook exists with a nonzero status. It takes a single argument: the name of the temporary file with the extracted commit message.</p>
<p class="calibre3">You can use this hook to make sure that the commit message is properly formatted, or to normalize the commit message by having the script alter the file. The example <code>applypatch-msg</code> hook provided by Git simply runs the <code>commit-msg</code> hook if it exists as a hook (the file exists and is executable).</p>
<h4 class="calibre19">The pre-applypatch hook</h4>
<p class="calibre3">The next <a id="_idIndexMarker1236" class="pcalibre1 pcalibre calibre6"/>hook to run is the <code>git am</code> script without committing the patch.</p>
<p class="calibre3">The sample hook provided by<a id="_idIndexMarker1238" class="pcalibre1 pcalibre calibre6"/> Git simply runs the <code>pre-commit</code> hook, if present.</p>
<h4 class="calibre19">The post-applypatch hook</h4>
<p class="calibre3">The last hook<a id="_idIndexMarker1239" class="pcalibre1 pcalibre calibre6"/> to run is the <strong class="bold">post-applypatch hook</strong>, which runs after the commit is made. It can be<a id="_idIndexMarker1240" class="pcalibre1 pcalibre calibre6"/> used for notifying or logging, for example, notifying all the developers or just the author of the patch that you have applied it.</p>
<h3 class="calibre9">Other client-side hooks</h3>
<p class="calibre3">There are a few other client-side hooks that do not fit into a series of steps in a single process.</p>
<h4 class="calibre19">The pre-rebase hook</h4>
<p class="calibre3">The <code>pre-*</code> hooks, it can abort the rebase process<a id="_idIndexMarker1242" class="pcalibre1 pcalibre calibre6"/> with a nonzero exit code. You can use this hook to disallow rebasing (and thus rewriting) any commits that were already published. The hook is called with the name of the base branch (the upstream the series was forked from), and the name of the branch being rebased. The name of the branch being rebased is passed to the hook only if it is not the current branch. The sample <code>pre-rebase</code> hook provided by Git tries to do this, though it makes some assumptions specific to Git’s project development that may not match your workflow (take note that amending commits also rewrites them, and that rebasing may create a copy of a branch instead of rewriting it).</p>
<h4 class="calibre19">The pre-push hook</h4>
<p class="calibre3">The <code>git push</code> operation, after checking the remote status and identifying which revisions are missing on the server, but before any changes are pushed. The hook is called with the reference to the remote (the URL or the remote name) and the actual push URL (the location of remote) as the script parameters. Information about the commits to be pushed is provided on the standard input, one line per ref to be updated. You can use this hook to <a id="_idIndexMarker1244" class="pcalibre1 pcalibre calibre6"/>validate a set of ref updates before a push occurs; a nonzero exit code aborts the push. The example installed simply checks whether there are commits beginning with <strong class="bold">WIP</strong> in a set of revisions to be pushed or marked with the <strong class="bold">nopush</strong> keyword in the commit message, and when either of those is true, it aborts the push. You can even make a hook prompt the user to confirm they are sure. This hook compliments the server-side checks, avoiding data transfer that would fail validation anyway.</p>
<h4 class="calibre19">The post-rewrite hook</h4>
<p class="calibre3">The <code>git commit --amend</code> and <code>git rebase</code>. Note, however, that this hook is not run by large-scale<a id="_idIndexMarker1246" class="pcalibre1 pcalibre calibre6"/> history rewriting, such as <code>git filter-repo</code>. The type of command that triggered the rewrite (<code>post-checkout</code> and <code>post-merge</code> hooks, and it runs after the automatic copying of notes, which is controlled by the <code>notes.rewriteRef</code> configuration variable (you can find more about the notes mechanism in <a href="B21194_10_split_000.xhtml#_idTextAnchor247" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 10</em></a><em class="italic">, Keeping </em><em class="italic">History Clean</em>).</p>
<h4 class="calibre19">The post-checkout and post-merge hooks</h4>
<p class="calibre3">The <code>git checkout</code> (or <code>git checkout &lt;file&gt;</code>) after having updated the worktree. The hook is given three parameters: the SHA-1 hashes of the <a id="_idIndexMarker1248" class="pcalibre1 pcalibre calibre6"/>previous and current <code>HEAD</code> (which may or may not be different) and a flag indicating whether it was a whole project checkout (you were changing branches; the flag parameter is 1) or a file checkout (retrieving files from the index or named commit; the flag parameter is 0). As a special case, during the initial checkout after <code>git clone</code>, this hook passes the all-zero SHA-1 as the first parameter (as a source revision). You can use this hook to set up your working directory properly for your use case. This may mean handling large binary files <a id="_idIndexMarker1249" class="pcalibre1 pcalibre calibre6"/>outside the repository (as an alternative to applying the <code>filter</code> Git attribute on a per-file basis) that you don’t want to have in the repository, or setting the working directory metadata properties such as full permissions, owner, group, times, extended <a id="_idIndexMarker1250" class="pcalibre1 pcalibre calibre6"/>attributes, or ACLs. It can also be used to perform repository validity checks or enhance the <code>git checkout</code> output by auto-displaying the differences (or just the diff statistics) from the previous checked-out revision (if they were different).</p>
<p class="calibre3">The <code>post-checkout</code> to restore data and <a id="_idIndexMarker1252" class="pcalibre1 pcalibre calibre6"/>metadata in the working tree that Git doesn’t track, such as full permissions data (or just make it invoke <code>post-checkout</code> directly). This hook can likewise validate the presence of files external to Git control that you might want copied in when the working tree changes.</p>
<p class="calibre3">For Git, objects in the repository (for example, commit objects representing revisions) are immutable; rewriting history (even amending a commit) is in fact creating a modified copy and switching to it, leaving the pre-rewrite history abandoned.</p>
<h4 class="calibre19">The pre-auto-gc hook</h4>
<p class="calibre3">Deleting a branch also leaves <a id="_idIndexMarker1253" class="pcalibre1 pcalibre calibre6"/>abandoned history. To prevent the<a id="_idIndexMarker1254" class="pcalibre1 pcalibre calibre6"/> repository from growing too much, Git occasionally performs garbage collection by removing old unreferenced objects. In all but the most ancient instances of Git, this is done as a part of normal Git operations by invoking <code>git gc --auto</code>. The <strong class="bold">pre-auto-gc hook</strong> is invoked just<a id="_idIndexMarker1255" class="pcalibre1 pcalibre calibre6"/> before garbage collection takes place and can be used to abort the operation, for example, if you are on battery power. It can also be used to notify you that garbage collection is happening.</p>
<h2 id="_idParaDest-311" class="calibre7"><a id="_idTextAnchor340" class="pcalibre1 pcalibre calibre6"/>Server-side hooks</h2>
<p class="calibre3">In addition to the client-side hooks, which are run in <a id="_idIndexMarker1256" class="pcalibre1 pcalibre calibre6"/>your own repository, there are a couple of important <strong class="bold">server-side hooks</strong> that a system administrator can use to enforce nearly any<a id="_idIndexMarker1257" class="pcalibre1 pcalibre calibre6"/> kind of policy for your project.</p>
<p class="calibre3">These hooks are run before and after you do a push to the server. The pre hooks (as mentioned earlier) can exit nonzero to reject a push or part of it; messages printed by the pre hooks will be sent back to the client (sender). You can use these hooks to set up complex push policies. Git repository management tools, such as <code>gitolite</code> and Git hosting solutions, use these to implement <a id="_idIndexMarker1258" class="pcalibre1 pcalibre calibre6"/>more involved access control for repositories. The post hooks can be used for notification, starting a build process (or just to rebuild and redeploy the documentation), or running a full test suite, for example as a part of a CI solution.</p>
<p class="calibre3">When writing server-side hooks, you need to take into account where in the sequence of operations the hook takes place and what information is available there, in the form of parameters, on the standard input, and in the repository.</p>
<p class="calibre3">Let’s review what happens on the server when it receives a push:</p>
<ol class="calibre14">
<li class="calibre15">Simplifying it a bit, the first step is that all the objects that were present in the client and missing on the server are sent to the server and stored (but are not yet referenced). If the receiving end fails to do this correctly (for example, because of the lack of disk space), the whole push operation will fail.</li>
<li class="calibre15">The <strong class="bold">pre-receive hook</strong> is run. It takes a<a id="_idIndexMarker1259" class="pcalibre1 pcalibre calibre6"/> list describing the references that are being pushed on its standard input. If it exits with a nonzero status, it aborts the whole operation and none of the references that were pushed are accepted.</li>
<li class="calibre15">For each ref being updated, the built-in sanity checks may reject the push to the ref, including the check for an update of a checked-out branch, a non-fast-forward push (unless forced), and so on.</li>
<li class="calibre15">The <strong class="bold">update</strong> hook is run for each ref, passing <a id="_idIndexMarker1260" class="pcalibre1 pcalibre calibre6"/>ref to be pushed in arguments; if this script exits with a nonzero status, only this ref will be rejected.</li>
<li class="calibre15">For each pushed ref, the ref in question is updated (unless it was rejected in an earlier stage).</li>
<li class="calibre15">The <strong class="bold">post-receive hook</strong> is run, taking the <a id="_idIndexMarker1261" class="pcalibre1 pcalibre calibre6"/>same data as the <strong class="source-inline1">pre-receive</strong> one. This one can be used to update other services (for example, to notify CI servers) or notify users (via an email or a mailing list, IRC, or a ticket-tracking system).</li>
</ol>
<p class="calibre3">If the push is atomic, either all the refs are updated (if none were rejected), or none are updated.</p>
<p class="calibre3">For each ref that was updated, the <code>git update-server-info</code> to prepare a repository, saving extra information to be used over <em class="italic">dumb</em> transports, though it would work better if run once as <code>post-receive</code>.</p>
<p class="calibre3">If push tries to update the currently checked-out branch and the <code>receive.denyCurrentBranch</code> configuration <a id="_idIndexMarker1263" class="pcalibre1 pcalibre calibre6"/>variable is set to <code>updateInstead</code>, then the <strong class="bold">push-to-checkout</strong> hook is run.</p>
<p class="callout-heading">Important note</p>
<p class="callout">You need to remember that in pre hooks, you don’t have refs updated yet, and that post hooks cannot affect the result of an operation. You can use pre hooks for access control (permission checking), and post hooks for notification and updating side data and logs.</p>
<p class="calibre3">You will see example hooks (server-side and client-side) for the Git-enforced policy in  <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a>,<em class="italic"> Git Administration</em>. You will also learn how other tools use those hooks, for example, for use in access control and triggering actions on push.</p>
<h1 id="_idParaDest-312" class="calibre5"><a id="_idTextAnchor341" class="pcalibre1 pcalibre calibre6"/>Extending Git</h1>
<p class="calibre3">Git provides a few <a id="_idIndexMarker1264" class="pcalibre1 pcalibre calibre6"/>mechanisms to extend it. You can add shortcuts and create new commands, and add support for new transports; all without requiring you to modify Git sources.</p>
<h2 id="_idParaDest-313" class="calibre7"><a id="_idTextAnchor342" class="pcalibre1 pcalibre calibre6"/>Command aliases for Git</h2>
<p class="calibre3">There is one<a id="_idIndexMarker1265" class="pcalibre1 pcalibre calibre6"/> little tip that can make your Git command-line experience simpler, easier, and more familiar, namely, <code>alias.&lt;command-name&gt;</code> configuration variable; its value is the expansion of the alias.</p>
<p class="calibre3">One of the uses for aliases is defining short abbreviations for commonly used commands and their arguments. Another is creating new commands. Here are a couple of examples you might want to set up:</p>
<pre class="console">
$ git config --global alias.co checkout
$ git config --global alias.ps = '--paginate status'
$ git config --global alias.lg "log --graph --oneline --decorate"
$ git config --global alias.aliases 'config --get-regexp ^alias\.'</pre>
<p class="calibre3">The preceding setup means that typing, for example, <code>git co</code> would be the same as typing <code>git checkout</code>, and <code>git aliases</code> would print all defined aliases. Aliases take arguments just as the<a id="_idIndexMarker1267" class="pcalibre1 pcalibre calibre6"/> regular Git commands do. Git does not provide any default aliases to define shortcuts for common operations, unless you use `git-fc` project, a friendly fork of Git by Felipe Contreras.</p>
<p class="calibre3">Arguments here are split by spaces and the usual shell quoting and escaping is supported. Notably, you can use a quote pair <code>("a b"</code>) or a backslash (<code>a\ b</code>) to include a space in a single argument.</p>
<p class="callout-heading">Important note</p>
<p class="callout">Note, however, that you cannot have an alias with the same name as a Git command. In other words, you cannot use aliases to change the behavior of commands. The reasoning behind this restriction is that it could make existing scripts and hooks fail unexpectedly. Aliases that hide existing Git commands (with the same name as Git commands) are simply ignored.</p>
<p class="calibre3">You might, however, want to run an external command rather than a Git command in an alias. Or, you might want to join together the result of a few separate commands. In this case, you can start the alias definition with the <code>!</code> character:</p>
<pre class="console">
$ git config --global alias.unmerged \
  '!git ls-files --unmerged | cut -f2 | sort -u'</pre>
<p class="calibre3">Because here the first command of the expansion of an alias can be an external tool, you need to specify the <code>git</code> wrapper explicitly, as shown in the preceding example.</p>
<p class="callout-heading">Note</p>
<p class="callout">Note that in many shells, for example, in <strong class="source-inline1">bash</strong>, the exclamation character <strong class="source-inline1">!</strong> is the history expansion character and it needs to be escaped as <strong class="source-inline1">\!</strong> or be within single quotes (<strong class="source-inline1">'</strong>).</p>
<p class="calibre3">Note that such shell <a id="_idIndexMarker1268" class="pcalibre1 pcalibre calibre6"/>commands will be executed from the top-level directory of a repository (after doing <code>cd</code> to a top-level), which may not necessarily be the current directory. Git sets the <code>GIT_PREFIX</code> environment variable to the current directory path relative to the top directory of a repository, that is, <code>git rev-parse --show-prefix</code>. As usual, <code>git rev-parse</code> (and some <code>git</code> wrapper options) may be of use here.</p>
<p class="calibre3">The fact mentioned earlier can be used while creating aliases. The <code>git serve</code> alias, running <code>git daemon</code> to serve (read-only) the current repository at <code>git://127.0.0.1/</code>, makes use of the fact that the shell commands in aliases are executed from the top-level directory of a repo:</p>
<pre class="console">
[alias]
    serve = !git daemon --reuseaddr --verbose --base-path=. --export-all ./.git</pre>
<p class="calibre3">Sometimes, you need to reorder arguments, use an argument twice, or pass an argument to the command early in the pipeline. You would want to refer to subsequent arguments as <code>$1</code>, <code>$2</code>, and so on, or to all arguments as <code>$@</code>, just like in shell scripts. One trick that you can find in older examples is to run a shell with a <code>-c</code> argument, like in the first of the examples mentioned next; the final dash is so that the arguments start with <code>$1</code>, not with <code>$0</code>. A more modern idiom is to define and immediately execute a shell function, like in the second example (it is a preferred solution because it uses one level of quoting less, and lets you use standard shell argument processing):</p>
<pre class="console">
[alias]
    record-1 = !sh -c 'git add -p -- $@ &amp;&amp; git commit' -
    record-2 = !f() {  git add -p -- $@ &amp;&amp; git commit }; f</pre>
<p class="calibre3">Aliases are integrated with command-line completion. While determining which completion to use for an alias, Git searches for a <code>git</code> command, skipping an opening brace or a single quote (thus, supporting both of the idioms mentioned earlier). With modern Git you can use the null command “<code>:</code>” to declare the desired completion style. For example, alias expanding to the following:</p>
<pre class="console">
!f() { : git commit ; ... } f</pre>
<p class="calibre3">would use a command <a id="_idIndexMarker1269" class="pcalibre1 pcalibre calibre6"/>completion for <code>git commit</code>, regardless of the rest of the alias.</p>
<p class="calibre3">Git aliases are also integrated with the help system. If you use the <code>--help</code> option on an alias, Git tells you its expansion (so you can check the relevant man page):</p>
<pre class="console">
$ git co --help
'git co' is aliased to 'checkout'</pre>
<h2 id="_idParaDest-314" class="calibre7"><a id="_idTextAnchor343" class="pcalibre1 pcalibre calibre6"/>Adding new Git commands</h2>
<p class="calibre3">Aliases are best at taking<a id="_idIndexMarker1270" class="pcalibre1 pcalibre calibre6"/> small one-liners and converting them into small useful Git commands. You can write complex aliases, but when it comes to larger scripts, you would probably like to incorporate them into Git directly.</p>
<p class="calibre3">Git subcommands can be standalone executables that live in the Git execution path (which you can find by running <code>git --exec-path</code>); on Linux, this is normally <code>/usr/libexec/git-core</code>. The <code>git</code> executable itself is a thin wrapper that knows where the subcommands live. If <code>git foo</code> is not a built-in command, the wrapper searches for the <code>git-foo</code> command first in the Git exec path, then in the rest of your <code>$PATH</code>. The latter makes it possible to write local Git extensions (local Git commands) without requiring access to the system’s space.</p>
<p class="calibre3">This feature is what it makes possible to have a user interface more or less integrated with the rest of Git in projects such as <code>git imerge</code> (see <a href="B21194_09.xhtml#_idTextAnchor229" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 9</em></a>,<em class="italic"> Merging Changes Together</em>), or <code>git lfs</code> or <code>git annex</code> (see <a href="B21194_12.xhtml#_idTextAnchor302" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 12</em></a>,<em class="italic"> </em><em class="italic">Managing</em><em class="italic"> Large Repositories</em>). It is also how projects such as <strong class="bold">Git Extras</strong>, providing extra Git commands, were made.</p>
<p class="calibre3">Note, however, that if you don’t install the documentation for your command in typical places, or configure the documentation system to find the help page for a command, then <code>git foo --help</code> won’t work correctly.</p>
<p class="calibre3">You can list all external commands installed this way with <code>git --list-cmds=others</code>, or you can use <code>git help --all</code>, and the following list will appear at the end of its command<a id="_idIndexMarker1271" class="pcalibre1 pcalibre calibre6"/> output:</p>
<pre class="console">
$ git --list-cmds=others
   credential-helper-selector
   credential-manager
   lfs</pre>
<h2 id="_idParaDest-315" class="calibre7"><a id="_idTextAnchor344" class="pcalibre1 pcalibre calibre6"/>Credential helpers and remote helpers</h2>
<p class="calibre3">There is another <a id="_idIndexMarker1272" class="pcalibre1 pcalibre calibre6"/>place where simply putting an appropriately named executable enhances and extends Git. <strong class="bold">Remote helper</strong> programs are invoked by<a id="_idIndexMarker1273" class="pcalibre1 pcalibre calibre6"/> Git when it needs to interact with remote repositories and remote transport protocols not supported by Git natively. You can find more about them in <a href="B21194_06.xhtml#_idTextAnchor140" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 6</em></a>,<em class="italic"> Collaborative Development </em><em class="italic">with Git</em>.</p>
<p class="calibre3">When Git encounters a URL of the form <code>&lt;transport&gt;://&lt;address&gt;</code>, where <code>&lt;transport&gt;</code> is a (pseudo)protocol that is not natively supported, it automatically invokes the <code>git remote-&lt;transport&gt;</code> command with a remote and full remote URL as arguments. A URL of the form <code>&lt;transport&gt;::&lt;address&gt;</code> also invokes this remote helper, but with just <code>&lt;address&gt;</code> as a second argument in the place of a URL. Additionally, with <code>remote.&lt;remote-name&gt;.vcs</code> set to <code>&lt;transport&gt;</code>, Git would explicitly invoke <code>git remote-&lt;transport&gt;</code> to access that remote.</p>
<p class="calibre3">The helpers mechanism in Git is about interacting with external scripts using a well-defined format.</p>
<p class="calibre3">Each remote helper is expected to support a subset of commands. You can find more information about the issue of creating new helpers on the <code>gitremote-helpers(1)</code> man page.</p>
<p class="calibre3">There is another type <a id="_idIndexMarker1274" class="pcalibre1 pcalibre calibre6"/>of helpers in Git, namely, <strong class="bold">credentials helpers</strong>. They can be used by Git to get the credentials from the user required, for example, to access a remote repository over HTTP. They are specified by the configuration, though, just like the merge and diff drivers and the clean and smudge filters.</p>
<h1 id="_idParaDest-316" class="calibre5"><a id="_idTextAnchor345" class="pcalibre1 pcalibre calibre6"/>Summary</h1>
<p class="calibre3">This chapter provided all the tools you need to use Git effectively. You got to know how to make the command-line interface easier to use and more effective with the Git-aware dynamic command prompt, command-line completion, autocorrection for Git commands, and using colors. You learned of the existence of alternative interfaces, from alternative porcelains to the various types of graphical clients.</p>
<p class="calibre3">You were reminded of the various ways to change the behavior of Git commands. You discovered how Git accesses its configuration and learned about a selected subset of configuration variables. You have learned how to automate Git with hooks and how to make use of them. Finally, you have learned how to extend Git with new commands and support new URL schemes.</p>
<p class="calibre3">This chapter was mainly about making Git more effective for you; the next chapter, <a href="B21194_14.xhtml#_idTextAnchor349" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 14</em></a><em class="italic">,</em> <em class="italic">Git Administration</em>, explains how to make Git more effective for other developers. You will cover more about server-side hooks and see their usage. You will also learn about repository maintenance.</p>
<h1 id="_idParaDest-317" class="calibre5"><a id="_idTextAnchor346" class="pcalibre1 pcalibre calibre6"/>Questions</h1>
<p class="calibre3">Answer the following questions to test your knowledge of this chapter:</p>
<ol class="calibre14">
<li class="calibre15">How do you save and reuse your favorite combination of options for the Git command?</li>
<li class="calibre15">How can you find all created aliases?</li>
<li class="calibre15">How do you run a graphical tool to display a <strong class="source-inline1">git diff</strong>, or to help with resolving a merge?</li>
<li class="calibre15">How can you find where a given configuration came from?</li>
<li class="calibre15">How can you help ensure that a commit matches the recommended best practices?</li>
</ol>
<h1 id="_idParaDest-318" class="calibre5"><a id="_idTextAnchor347" class="pcalibre1 pcalibre calibre6"/>Answers</h1>
<p class="calibre3">Here are the answers to the questions given above:</p>
<ol class="calibre14">
<li class="calibre15">Use a Git alias, a shell alias, or a shell function.</li>
<li class="calibre15">You can use the <strong class="source-inline1">git config --get-regexp ^</strong><strong class="source-inline1">alias\.</strong> command.</li>
<li class="calibre15">Use <strong class="source-inline1">git difftool</strong> for displaying differences, or <strong class="source-inline1">git mergetool</strong> to help with resolving merge conflicts. There is built-in support for many of the existing graphical tools.</li>
<li class="calibre15">If it is about configuration values, you can use <strong class="source-inline1">git config --show-origin</strong> (or <strong class="source-inline1">--show-scope</strong>). If it is about per-file attributes, use <strong class="source-inline1">git check-attr</strong>. If it is about ignoring files, use <strong class="source-inline1">git check-ignore</strong>.</li>
<li class="calibre15">Use the <strong class="source-inline1">pre-commit</strong> hook (and other similar hooks) to warn if best practices are not being followed. There are many third-party tools that help with hook management and often support various helper tools such as linters and code formatting tools.</li>
</ol>
<h1 id="_idParaDest-319" class="calibre5"><a id="_idTextAnchor348" class="pcalibre1 pcalibre calibre6"/>Further reading</h1>
<p class="calibre3">To learn more about the topics that were covered in this chapter, take a look at the following resources:</p>
<ul class="calibre16">
<li class="calibre15">Scott Chacon, Ben Straub: <em class="italic">Pro Git, 2nd Edition</em> (2014), Apress <a href="https://git-scm.com/book/en/v2" class="pcalibre1 pcalibre calibre6">https://git-scm.com/book/en/v2</a><ul class="calibre18"><li class="calibre15"><a href="B21194_02.xhtml#_idTextAnchor028" class="pcalibre1 pcalibre calibre6"><em class="italic">Chapter 2</em></a><em class="italic"> - Git Basics, Section 2.1 - </em><em class="italic">Git Aliases</em></li><li class="calibre15"><em class="italic">Chapter 8 - </em><em class="italic">Customizing Git</em></li><li class="calibre15"><em class="italic">Appendix A: Git in </em><em class="italic">Other Environments</em></li></ul></li>
<li class="calibre15">Matthew Hudson: <em class="italic">Git Hooks - A Guide for </em><em class="italic">Programmers</em> <a href="https://githooks.com/" class="pcalibre1 pcalibre calibre6">https://githooks.com/</a></li>
<li class="calibre15"><em class="italic">bash/zsh git prompt </em><em class="italic">support</em> <a href="https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh" class="pcalibre1 pcalibre calibre6">https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh</a></li>
<li class="calibre15"><em class="italic">bash/zsh completion support for core </em><em class="italic">Git</em> <a href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash" class="pcalibre1 pcalibre calibre6">https://github.com/git/git/blob/master/contrib/completion/git-completion.bash</a></li>
<li class="calibre15">Seth House: <em class="italic">Conflict resolution in various mergetools</em> (2020) <a href="https://www.eseth.org/2020/mergetools.html" class="pcalibre1 pcalibre calibre6">https://www.eseth.org/2020/mergetools.html</a></li>
<li class="calibre15">Julia Evans: <em class="italic">Popular git config options</em> (2024) <a href="https://jvns.ca/blog/2024/02/16/popular-git-config-options/" class="pcalibre1 pcalibre calibre6">https://jvns.ca/blog/2024/02/16/popular-git-config-options/</a></li>
<li class="calibre15">Ricardo Gerardi: <em class="italic">8 Git aliases that make me more efficient</em> (2020) <a href="https://opensource.com/article/20/11/git-aliases" class="pcalibre1 pcalibre calibre6">https://opensource.com/article/20/11/git-aliases</a></li>
<li class="calibre15"><em class="italic">Git SCM Wiki</em> (archived): <em class="italic">Aliases</em> <a href="https://archive.kernel.org/oldwiki/git.wiki.kernel.org/index.php/Aliases.html" class="pcalibre1 pcalibre calibre6">https://archive.kernel.org/oldwiki/git.wiki.kernel.org/index.php/Aliases.html</a></li>
<li class="calibre15"><em class="italic">Git Homepage - GUI </em><em class="italic">Clients</em> <a href="https://git-scm.com/downloads/guis" class="pcalibre1 pcalibre calibre6">https://git-scm.com/downloads/guis</a></li>
<li class="calibre15"><em class="italic">Git Rev </em><em class="italic">News</em> <a href="https://git.github.io/rev_news/" class="pcalibre1 pcalibre calibre6">https://git.github.io/rev_news/</a></li>
</ul>
</div>
</body></html>