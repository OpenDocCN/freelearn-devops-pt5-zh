<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Understanding Plugin Framework</h1></div></div></div><p>In this chapter, we will see more details on the JIRA Architecture and the plugin framework. We will also see the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Converting plugins from v1 to v2</li><li class="listitem" style="list-style-type: disc">Adding resources into plugins</li><li class="listitem" style="list-style-type: disc">Adding web resources to the plugin</li><li class="listitem" style="list-style-type: disc">Building JIRA from source</li><li class="listitem" style="list-style-type: disc">Adding new webwork actions to JIRA</li><li class="listitem" style="list-style-type: disc">Extending a webwork action in JIRA</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Introduction</h1></div></div></div><p>As we saw in the previous chapter, the JIRA plugin development process is probably an easier task than we expected it to be. With the help of Atlassian Plugin SDK, developers can spend more time worrying about the plugin logic than on the troublesome deployment activities. And yes, after all, it is the plugin logic that is going to make an impact!</p><p>This chapter details how the various components fit into JIRA's architecture and how JIRA exposes the various pluggable points. We will also see an overview of the JIRA's system plugins to find out how JIRA uses the plugin architecture to its own benefit, followed by some useful recipes!</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec30"/>JIRA Architecture</h2></div></div></div><a id="id97" class="indexterm"/><a id="id98" class="indexterm"/><p>We will quickly see how the various components within JIRA fit in to form the JIRA we know. It is best described in a diagram and Atlassian has a neat one along with a detailed explanation at <a class="ulink" href="http://confluence.atlassian.com/display/JIRA/JIRA+Architectural+Overview">http://confluence.atlassian.com/display/JIRA/JIRA+Architectural+Overview</a>. We will re-draw the diagram a little bit to explain it in a brief but useful way.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec13"/>Third-party components</h3></div></div></div><a id="id99" class="indexterm"/><a id="id100" class="indexterm"/><a id="id101" class="indexterm"/><p>Before we dig deeper into the JIRA Architecture, it is probably useful to understand a few key components and familiarize yourself with them. JIRA's major third-party dependencies are outlined next.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>It is not mandatory to know all about these frameworks, but it will be very helpful during plugin development if you have an understanding of these.</p></div></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec03"/>Webwork</h4></div></div></div><p><strong>Webwork</strong><a id="id102" class="indexterm"/>
<a id="id103" class="indexterm"/> is nothing but a Java web application development framework. The following is a quick overview of Webworks as you find it in the OpenSymphony documentation<a id="id104" class="indexterm"/>:</p><div><blockquote class="blockquote"><p><em>"It is built specifically with developer productivity and code simplicity in mind, providing robust support for building reusable UI templates, such as form controls, UI themes, internationalization, dynamic form parameter mapping to JavaBeans, robust client- and server-side validation, and much more."</em></p></blockquote></div><p>Read more about Webwork1<a id="id105" class="indexterm"/> at the archived link: <a class="ulink" href="http://web.archive.org/web/20080328114803/http://www.opensymphony.com/webwork_old/src/docs/manual/">http://web.archive.org/web/20080328114803/http://www.opensymphony.com/webwork_old/src/docs/manual/</a>.</p><p>Note that JIRA uses Webwork1 and not 2. In this book, all instances of webwork refer to the webwork1 version. JIRA itself refers to the technology as webwork, but you will notice that the files, plugin modules, and so on, use webwork1 in it just to emphasize the version.</p></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec04"/>Seraph</h4></div></div></div><a id="id106" class="indexterm"/><p><strong>Seraph</strong><a id="id107" class="indexterm"/> is Atlassian's opensource web authentication framework. It provides a simple, extensible authentication system that JIRA uses for all authentication purposes.</p><a id="id108" class="indexterm"/><p>Read more about Seraph at <a class="ulink" href="http://docs.atlassian.com/atlassian-seraph/latest/">http://docs.atlassian.com/atlassian-seraph/latest/</a>.</p></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec05"/>OSUser</h4></div></div></div><a id="id109" class="indexterm"/><p><strong>OSUser</strong><a id="id110" class="indexterm"/> is OpenSymphony's user and group management framework. It is designed to provide a simple-to-use API for user-management. JIRA uses OSUserframework in versions prior to JIRA 4.3.</p><p>Read more about it at <a class="ulink" href="http://www.opensymphony.com/osuser/">http://www.opensymphony.com/osuser/</a>.</p><a id="id111" class="indexterm"/><p>JIRA 4.3+<a id="id112" class="indexterm"/> uses Crowd as its new User API for which the details can be found at <a class="ulink" href="http://docs.atlassian.com/atlassian-crowd/current/com/atlassian/crowd/embedded/api/CrowdService.html">http://docs.atlassian.com/atlassian-crowd/current/com/atlassian/crowd/embedded/api/CrowdService.html</a>.</p></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec06"/>PropertySet</h4></div></div></div><a id="id113" class="indexterm"/><p><strong>PropertySet</strong><a id="id114" class="indexterm"/>
<a id="id115" class="indexterm"/> is again another open source framework from OpenSymphony that helps you to store a set of properties against any 'entity' with a unique ID. The properties will be key/value pairs and can only be associated with a single entity at a time.</p><a id="id116" class="indexterm"/><p>Read about all that and more at <a class="ulink" href="http://www.opensymphony.com/propertyset/">http://www.opensymphony.com/propertyset/</a>.</p></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec07"/>OSWorkflow</h4></div></div></div><a id="id117" class="indexterm"/><p>OSWorkflow<a id="id118" class="indexterm"/> is yet another open source framework from the OpenSymphony group. It is an extremely flexible workflow implementation that is capable of driving complex conditions, validators, post functions, and so on, along with many other features.</p><p>Read more about OSWorkflow at <a class="ulink" href="http://www.opensymphony.com/osworkflow/">http://www.opensymphony.com/osworkflow/</a>.</p></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec08"/>OfBiz Entity Engine</h4></div></div></div><a id="id119" class="indexterm"/><p>OfBiz<a id="id120" class="indexterm"/> stands for <strong>Open For Business</strong> and the <strong>OfBiz Entity Engine</strong><a id="id121" class="indexterm"/> is a set of tools and patterns used to model and manage entity-specific data.</p><p>As per the definition from the standard Entity-Relation modeling concepts of Relational Database Management Systems, <em>an Entity is a piece of data defined by a set of fields and a set of relations to other entities.</em></p><p>Read more <a id="id122" class="indexterm"/>about the Entity Modeling and concepts at <a class="ulink" href="http://ofbiz.apache.org/docs/entity.html">http://ofbiz.apache.org/docs/entity.html</a>.</p></div><div><div><div><div><h4 class="title"><a id="ch02lvl4sec09"/>Apache Lucene</h4></div></div></div><a id="id123" class="indexterm"/><p>The following is a simple definition of <strong>Apache Lucene</strong><a id="id124" class="indexterm"/> that you can find in its documentation:</p><div><blockquote class="blockquote"><p>"Apache Lucene(TM) is a high-performance, full-featured text search engine library written entirely in Java. It is a technology suitable for nearly any application that requires full-text search, especially cross-platform."</p></blockquote></div><a id="id125" class="indexterm"/><a id="id126" class="indexterm"/><p>More about Lucene and its potential can be found at <a class="ulink" href="http://lucene.apache.org/java/docs/index.html">http://lucene.apache.org/java/docs/index.html</a>.</p></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec14"/>Atlassian Gadget JavaScript Framework</h3></div></div></div><a id="id127" class="indexterm"/><p>JIRA4<a id="id128" class="indexterm"/> introduces a powerful gadget framework. Atlassian has gone <strong>OpenSocial</strong><a id="id129" class="indexterm"/> with gadgets and in order to help developers in creating gadgets, Atlassian has introduced <strong>Gadgets Javascript Framework</strong><a id="id130" class="indexterm"/> that encapsulates a lot of common requirements and functionalities used between gadgets.</p><p>More about gadget development<a id="id131" class="indexterm"/> can be read at <a class="ulink" href="http://confluence.atlassian.com/display/GADGETDEV/Using+the+Atlassian+Gadgets+JavaScript+Framework">http://confluence.atlassian.com/display/GADGETDEV/Using+the+Atlassian+Gadgets+JavaScript+Framework</a>.</p><div><div><div><div><h4 class="title"><a id="ch02lvl4sec10"/>Quartz</h4></div></div></div><a id="id132" class="indexterm"/><p><strong>Quartz</strong><a id="id133" class="indexterm"/> is an open source job scheduling service. It can be used to create jobs that can be<a id="id134" class="indexterm"/> scheduled within any JAVA EE and SE applications. The tasks are defined as standard Java components and scheduler includes many enterprise-class features, such as JTA<a id="id135" class="indexterm"/> transactions and clustering.</p><p>Read more <a id="id136" class="indexterm"/>at <a class="ulink" href="http://www.quartz-scheduler.org/">http://www.quartz-scheduler.org/</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec31"/>Architecture explained…</h2></div></div></div><a id="id137" class="indexterm"/><a id="id138" class="indexterm"/><p>It is best to learn the intricacies of system architecture with the help of a diagram. For the benefit of a brief but meaningful explanation on the JIRA Architecture, let us have a quick look (or a long stare, whichever you are comfortable!) at the following diagram:</p><div><img src="img/1803_02_01.jpg" alt="Architecture explained…"/></div><a id="id139" class="indexterm"/><a id="id140" class="indexterm"/><p>JIRA is a web application built using the MVC Architecture<a id="id141" class="indexterm"/>. It is fully written in JAVA and is deployed as a WAR file into a JAVA Servlet Container such as Tomcat<a id="id142" class="indexterm"/>.</p><p>The majority of the JIRA core functionality revolves around the <strong>JIRA Utility and Manager Classes</strong><a id="id143" class="indexterm"/> which thus becomes the heart of JIRA. But it also interacts with a lot of third-party components, which we saw earlier, to deliver powerful functionalities like Workflows, Permissions, User Management, Searching, and so on.</p><a id="id144" class="indexterm"/><a id="id145" class="indexterm"/><p>As with any other web application, let us start with the incoming requests. Users interact with JIRA using web browsers. But there are other ways to interact with JIRA like using the <strong>Jelly scripts</strong><a id="id146" class="indexterm"/> or by making remote calls using <strong>REST</strong><a id="id147" class="indexterm"/>
<strong>/SOAP</strong><a id="id148" class="indexterm"/>
<strong>/XML-RPC</strong><a id="id149" class="indexterm"/>.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec15"/>Authentication and user management</h3></div></div></div><a id="id150" class="indexterm"/><a id="id151" class="indexterm"/><a id="id152" class="indexterm"/><a id="id153" class="indexterm"/><p>The user authentication, whichever way the request comes, is done in JIRA using Seraph, Atlassian's open source web authentication framework. Seraph is implemented as a servlet filter and it intercepts each and every incoming request and associates them with a specific user. It supports various authentication mechanisms like HTTP Basic Authentication<a id="id154" class="indexterm"/>, form-based authentication<a id="id155" class="indexterm"/>, and so on, and even looking up already stored credentials in a user session when implemented with SSO (Single sign on)<a id="id156" class="indexterm"/>.</p><p>However, Seraph doesn't do any user management itself. It delegates this to the OSUser framework. One additional thing that Seraph does in JIRA is to intercept URLs starting with <code class="literal">/admin/</code> and allow users only if they have the 'Global Admin' permission.</p><p>Coming back to authentication and other user management functions, it is OSUser that does the work for JIRA in versions prior to 4.3. It does the following activities:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">User management—Creates/Updates/Deletes users and stores the details in JIRA database. Stores user preferences.</li><li class="listitem" style="list-style-type: disc">Group management—<a id="id157" class="indexterm"/><a id="id158" class="indexterm"/>Creates/Updates/Deletes groups and stores the details in JIRA database. Manages group memberships.</li><li class="listitem" style="list-style-type: disc">Authentication—Password matching.</li></ul></div><p>From JIRA 4.3, user management in JIRA is done using Crowd. <strong>Crowd</strong><a id="id159" class="indexterm"/> is a single sign-on and identity management system from Atlassian which is now embedded in JIRA 4.3+. Plugin developers can now use <strong>CrowdService</strong><a id="id160" class="indexterm"/> to manage users and groups, for which more information can be found at <a class="ulink" href="http://docs.atlassian.com/atlassian-crowd/current/com/atlassian/crowd/embedded/api/CrowdService.html">http://docs.atlassian.com/atlassian-crowd/current/com/atlassian/crowd/embedded/api/CrowdService.html</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec16"/>Property management</h3></div></div></div><a id="id161" class="indexterm"/><a id="id162" class="indexterm"/><p>JIRA lets you add key/value pairs as properties on any available 'entity' like User, Group, Project, Issue, and so on. It uses OpenSymphony's PropertySet to do this. Three major cases where PropertySet<a id="id163" class="indexterm"/> is used internally in JIRA are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To store user preferences by the OSUser framework like e-mail, full name, and so on</li><li class="listitem" style="list-style-type: disc">To store application properties</li><li class="listitem" style="list-style-type: disc">To store chosen preferences of Portlets/Gadgets on user dashboards</li></ul></div><a id="id164" class="indexterm"/><a id="id165" class="indexterm"/><a id="id166" class="indexterm"/><p>We can also use the PropertySet in our plugins to store custom data as key/value pairs.</p><p>In earlier versions of JIRA, PropertySet was the only technology used to store plugin information and other data-related to plugins. But JIRA now supports a new technology called <strong>ActiveObjects</strong><a id="id167" class="indexterm"/> which can be used to store plugin data. It is explained in detail in the coming chapters.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec17"/>Presentation</h3></div></div></div><p>The presentation layer<a id="id168" class="indexterm"/><a id="id169" class="indexterm"/> in JIRA is built using <strong>JSPs</strong><a id="id170" class="indexterm"/> and <strong>Velocity</strong> template<a id="id171" class="indexterm"/>s. The web requests, coming on to JIRA, are processed by OpenSymphony's Webwork1 framework. The requests are handled by webwork actions which internally use the JIRA Service layer. The service classes expose the core Utility and Manager classes that perform the tasks behind the scenes!</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec18"/>Database</h3></div></div></div><a id="id172" class="indexterm"/><a id="id173" class="indexterm"/><p>JIRA talks to its database using the <strong>Ofbiz Entity Engine</strong><a id="id174" class="indexterm"/> module. Its database schema is defined in the <code class="literal">entitmodel.xml</code> residing at <code class="literal">WEB-INF/classes/entitydefs</code>. The DB connectivity configuration goes in to <code class="literal">entityengine.xml</code> under <code class="literal">WEB-INF/classes</code>.</p><a id="id175" class="indexterm"/><p>JIRA supports a wide variety of database products for which more details can be found at <a class="ulink" href="http://confluence.atlassian.com/display/JIRA/Connecting+JIRA+to+a+Database">http://confluence.atlassian.com/display/JIRA/Connecting+JIRA+to+a+Database</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec19"/>Workflows</h3></div></div></div><a id="id176" class="indexterm"/><p>Workflows<a id="id177" class="indexterm"/> are one of the most important features in JIRA. It provides us with a highly configurable workflow engine, which uses OpenSymphony's OSWorkflow behind the scenes. It lets us customize the workflows by adding new steps and transitions and for each transition we can add conditions, validators, or post functions. We can even write plugins to add more of these, in addition to the ones that ship with JIRA. We will see all that in detail in the <a id="id178" class="indexterm"/>
<a id="id179" class="indexterm"/>coming chapters.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec20"/>Searching</h3></div></div></div><a id="id180" class="indexterm"/><a id="id181" class="indexterm"/><p>JIRA uses Apache Lucene<a id="id182" class="indexterm"/> to perform indexing<a id="id183" class="indexterm"/> in JIRA. Whenever an issue is changed in JIRA, it performs a partial re-indexing to update the related indexes. JIRA also lets us do a full re-index at any time manually from the Administration screen.</p><p>Searching in JIRA is done using these indexes which are stored in the local drive. We can even store search queries as filters whose results gets updated as the indexes changes.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec21"/>Scheduled jobs</h3></div></div></div><a id="id184" class="indexterm"/><a id="id185" class="indexterm"/><p>JIRA uses the Quartz API to schedule jobs within JIRA. The jobs, including the subscriptions to the filters and the custom ones we add, are stored in the JIRA database, and are executed by the Quartz job scheduling service.</p><p>JIRA's built-in scheduled job details can be found at <code class="literal">scheduler-config.xml</code><a id="id186" class="indexterm"/>.</p><p>It is possible to schedule new events in JIRA using the SAL services implementation. As Atlassian puts it:</p><div><blockquote class="blockquote"><p>"The Shared Access Layer, or SAL<a id="id187" class="indexterm"/> inshort, provides a consistent, cohesive API to common plugin tasks, regardless of the Atlassian application into which your plugin is deployed."</p></blockquote></div><p>More information on scheduling events in JIRA using SAL can be found at <a class="ulink" href="https://developer.atlassian.com/display/DOCS/Plugin+Tutorial+-+Scheduling+Events+via+SAL">https://developer.atlassian.com/display/DOCS/Plugin+Tutorial+-+Scheduling+Events+via+SAL</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec22"/>Plugins</h3></div></div></div><a id="id188" class="indexterm"/><p>Last, but not the least, plugins fit into the JIRA Architecture to provide extra functionalities or to alter some of the existing ones. The plugins mostly use the same JIRA core utility classes and manager classes as webwork actions do, but in some cases also add/contribute to the list.</p><p>There are different pluggable points in JIRA which we will see in detail in this chapter.</p><p>This, I hope, gives you a brief introduction to the JIRA architecture and the major components used in it. We will see most of these in detail in the coming chapters and how to customize them by writing plugins. Off you go!</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Types of plugin modules</h2></div></div></div><a id="id189" class="indexterm"/><a id="id190" class="indexterm"/><p>Let us briefly see the different types of plugin modules supported in JIRA 4.x. All these modules are various extension points, using which we can not only add new functionalities in to JIRA, but also extend some of the existing functionalities.</p><p>Let us group them based on functionality instead of seeing them all together!</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec23"/>Reporting</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module type<a id="id191" class="indexterm"/><a id="id192" class="indexterm"/></p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Portlet<a id="id193" class="indexterm"/><a id="id194" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new portlets to the user's dashboard. It is deprecated in JIRA 4.x, but is still supported. Usage of Gadgets is recommended.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Gadget<a id="id195" class="indexterm"/>
<a id="id196" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new Gadgets into the user's dashboard. These gadgets can also be accessed from other applications.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Report<a id="id197" class="indexterm"/>
<a id="id198" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new reports into JIRA.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec24"/>Workflows</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module type<a id="id199" class="indexterm"/></p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>workflow-condition<a id="id200" class="indexterm"/>
<a id="id201" class="indexterm"/>
<a id="id202" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new workflow conditions to the JIRA workflow. It can then be used to limit the workflow actions to users, based on pre-defined conditions.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>workflow-validator<a id="id203" class="indexterm"/>
<a id="id204" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new workflow validations to the JIRA workflow. Validations can be used to prevent certain workflow actions when the criteria are not met.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>workflow-function<a id="id205" class="indexterm"/>
<a id="id206" class="indexterm"/>
<a id="id207" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new workflow post functions to the JIRA workflow. These can be used to perform custom actions after a workflow action is executed</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec25"/>Custom fields</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>customfield-type<a id="id208" class="indexterm"/>
<a id="id209" class="indexterm"/>
<a id="id210" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new custom field types to JIRA. We can customize the look-and-feel of the fields in addition to custom logic. See also <code class="literal">customfield-searcher</code>.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec26"/>Searching</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>customfield-searcher<a id="id211" class="indexterm"/>
<a id="id212" class="indexterm"/>
<a id="id213" class="indexterm"/>
<a id="id214" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new field searchers on to JIRA. The searcher needs to be mapped with the relevant custom fields.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>jqlfunction<a id="id215" class="indexterm"/>
<a id="id216" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new JQL Functions to be used with JIRA's advanced searching.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>search-request-view<a id="id217" class="indexterm"/>
<a id="id218" class="indexterm"/>
<a id="id219" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds a new view in the Issue Navigator. They can be used to show the search results in different ways.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec27"/>Links and tabs</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>issue-operation<a id="id220" class="indexterm"/>
<a id="id221" class="indexterm"/>
<a id="id222" class="indexterm"/>
<a id="id223" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new Issue Operations in the <strong>View</strong> issue screen. This module is unavailable from JIRA 4.1.x. Web Items (see <em>web-item</em> module) are used from 4.1.x instead of issue-operation module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>web-section<a id="id224" class="indexterm"/>
<a id="id225" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new sections in application menus. Each section can contain one or more links under it.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>web-item<a id="id226" class="indexterm"/>
<a id="id227" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new links that will appear at a defined section. The section here can be the new ones we added or the existing JIRA web sections.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>project-tabpanel<a id="id228" class="indexterm"/>
<a id="id229" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new tabs to the Browse <strong>Project</strong> screen. We can define what has to appear in the tab.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>component-tabpanel<a id="id230" class="indexterm"/>
<a id="id231" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new tabs to the Browse <strong>Component</strong> screen. As above, we can define what to appear in the tab.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>version-tabpanel<a id="id232" class="indexterm"/>
<a id="id233" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new tabs to the Browse <strong>Version</strong> screen. Same as above.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>issue-tabpanel<a id="id234" class="indexterm"/>
<a id="id235" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new tabs to the <strong>View Issue</strong> screen. Similar to other tabs, here also we can define what appears in the tab.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>web-panel<a id="id236" class="indexterm"/>
<a id="id237" class="indexterm"/>
<a id="id238" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>It is newly introduced in JIRA 4.4. Defines panels or sections that can be inserted into an HTML page.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec28"/>Remote invocation</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>rest<a id="id239" class="indexterm"/>
<a id="id240" class="indexterm"/>
<a id="id241" class="indexterm"/>
<a id="id242" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Creates new REST APIs for JIRA to expose more services and data entities.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>rpc-soap<a id="id243" class="indexterm"/>
<a id="id244" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Publishes new SOAP end-points for JIRA. It is deployed as a new SOAP service and exposes a new WSDL with the operations we have published in the plugin.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>rpc-xmlrpc<a id="id245" class="indexterm"/>
<a id="id246" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Same as above. Exposes XML-RPC endpoints, instead of SOAP, within JIRA.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec29"/>Actions and components</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module type<a id="id247" class="indexterm"/>
<a id="id248" class="indexterm"/></p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>webwork<a id="id249" class="indexterm"/>
<a id="id250" class="indexterm"/>
<a id="id251" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds new webwork actions along with views into JIRA which can add new functionality or override existing ones.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>component<a id="id252" class="indexterm"/>
<a id="id253" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds components to JIRA's component system. These are then available for use in other plugins and can be injected into them.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>component-import<a id="id254" class="indexterm"/>
<a id="id255" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Imports components shared by other plugins.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec30"/>Other plugin modules</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Module type<a id="id256" class="indexterm"/></p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>resource<a id="id257" class="indexterm"/>
<a id="id258" class="indexterm"/>
<a id="id259" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds downloadable resources into the plugins. A resource is a non-JAVA file such as JavaScript, CSS, image files, and so on.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>web-resource<a id="id260" class="indexterm"/>
<a id="id261" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Similar to the above, adds downloadable resources into the plugins. But these are added to the top of the page with the cache-related headers set to never expire. We can also specify the resources to be used only in specific contexts. Multiple resource modules will appear under a web-resource module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>servlet<a id="id262" class="indexterm"/>
<a id="id263" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Deploys a JAVA servlet onto JIRA.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>servlet-context-listener<a id="id264" class="indexterm"/>
<a id="id265" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Deploys a JAVA Servlet Context Listener.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>servlet-context-param<a id="id266" class="indexterm"/>
<a id="id267" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Sets parameters in the Servlet context shared by the plugin's servlets, filters, and listeners.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>servlet-filter<a id="id268" class="indexterm"/>
<a id="id269" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Deploys a JAVA servlet filter onto JIRA. The order and position in the application's filter chain can be specified.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>user-format<a id="id270" class="indexterm"/>
<a id="id271" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Adds custom behaviors for user details. Used to enhance the user profile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>keyboard-shortcut<a id="id272" class="indexterm"/>
<a id="id273" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Available only from 4.1.x. Defines new keyboard shortcuts for JIRA. You can also override the existing shortcuts from JIRA 4.2.x!</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>module-type<a id="id274" class="indexterm"/>
<a id="id275" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Dynamically adds new plugin module types to the plugin framework. The new module can be used by other plugins.</p>
</td></tr></tbody></table></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec33"/>What goes into atlassian-plugin.xml?</h2></div></div></div><p>Let's look deeper into the plugin descriptor named <code class="literal">atlassian-plugin.xml</code><a id="id276" class="indexterm"/>.</p><p>Following is how the plugin descriptor will look like when the skeleton plugin is created:</p><div><pre class="programlisting">&lt;atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.artifactId}" plugins-version="2"&gt;
  &lt;plugin-info&gt;
    &lt;description&gt;${project.description}&lt;/description&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
    &lt;vendor name="${project.organization.name}"url="${project.organization.url}" /&gt;
  &lt;/plugin-info&gt;
&lt;/atlassian-plugin&gt;</pre></div><p>We need to add more details into it depending on the type of plugin we are going to develop. The plugin descriptor can be divided into three parts:</p><div><ol class="orderedlist arabic"><li class="listitem"><strong>Atlassian-plugin</strong> element<a id="id277" class="indexterm"/><a id="id278" class="indexterm"/>: This forms the root of the descriptor. The following attributes populates the <code class="literal">atlassian-plugin</code> element:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>key</strong>: <a id="id279" class="indexterm"/><a id="id280" class="indexterm"/>This is probably the most important part. It should be a unique key across the JIRA instance and will be used to refer the different modules in the plugin, just like we use the packages in a Java application. If you see <code class="literal">${project.groupId}.${project.artifactId}</code> as the plugin key, it picks up the values from your <code class="literal">pom.xml</code> file. When the plugin is built, the key will be <code class="literal">YOUR_GROUP_ID.YOUR_ARTIFACT_ID</code>.</li><li class="listitem" style="list-style-type: disc"><strong>name</strong>:<a id="id281" class="indexterm"/><a id="id282" class="indexterm"/> Give an appropriate name for your plugin. This will appear in the plugin menu under administration.</li><li class="listitem" style="list-style-type: disc"><strong>plugins-version</strong>:<a id="id283" class="indexterm"/><a id="id284" class="indexterm"/> This is different from the version attribute. <code class="literal">plugins-version</code> defines whether the plugin is version 1 or 2. <code class="literal">plugins-version="2"</code> defines the plugin as a version 2 plugin. Remove the entire attribute to make it a version 1 plugin.</li><li class="listitem" style="list-style-type: disc"><strong>state</strong>:<a id="id285" class="indexterm"/><a id="id286" class="indexterm"/> This is an optional element to define the plugin as disabled, by default. Add <code class="literal">state="disabled"</code> under the <code class="literal">atlassian-plugin</code> element.</li></ul></div></li><li class="listitem"><strong>Plugin-info</strong> element<a id="id287" class="indexterm"/><a id="id288" class="indexterm"/> : This section contains information about a plugin. It not only provides information that is displayed to administrators but also, optionally, provides bundle instructions to the OSGI network:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>description</strong>: <a id="id289" class="indexterm"/><a id="id290" class="indexterm"/>A simple description about your plugin.</li><li class="listitem" style="list-style-type: disc"><strong>version</strong>: <a id="id291" class="indexterm"/><a id="id292" class="indexterm"/>The actual version of you plugin which will be displayed under the plugin menu along with the Name and Description.</li><li class="listitem" style="list-style-type: disc"><strong>application-version</strong><a id="id293" class="indexterm"/><a id="id294" class="indexterm"/>: Here you can define the minimum and maximum version of the JIRA application that is supported by your plugin. <code class="literal">&lt;application-version min="4.0.2" max="4.1"/&gt;</code> will be supported from 4.0.2 to 4.1.But remember, this is only for information's sake. The plugin <a id="id295" class="indexterm"/><a id="id296" class="indexterm"/>might still work fine in JIRA 4.2!</li><li class="listitem" style="list-style-type: disc"><strong>vendor</strong>: <a id="id297" class="indexterm"/><a id="id298" class="indexterm"/>Here you can provide details about the plugin vendor. It supports two attributes: <strong>name</strong> and <strong>url</strong>, which can be populated with the organization's Name and URL respectively.Similar to plugin key, you can populate this from the <code class="literal">pom.xml</code>file,as you would have noticed in the skeleton descriptor.</li><li class="listitem" style="list-style-type: disc"><strong>param</strong>: <a id="id299" class="indexterm"/><a id="id300" class="indexterm"/>This element can be used to define name/value attributes for the plugin. You can pass as many attributes as you want. For example, <code class="literal">&lt;paramname="configure.url"&gt;/secure/JTricksConfigAction.jspa&lt;/param&gt;</code> defines the configuration URL for our demo plugin.</li><li class="listitem" style="list-style-type: disc"><strong>bundle-instructions</strong><a id="id301" class="indexterm"/><a id="id302" class="indexterm"/>: Here we define the OSGI bundle instructions which will be used by the Maven Bundle plugin while generating the OSGI bundle.More about this can be read under aQutebndtool: <a class="ulink" href="http://www.aqute.biz/Code/Bnd">http://www.aqute.biz/Code/Bnd</a>. Following are the two elements<a id="id303" class="indexterm"/> in a snapshot:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Export-Package</strong>: <a id="id304" class="indexterm"/>This element defines the package in this plugin that can be exposed to other plugins. All other packages will remain private.</li><li class="listitem" style="list-style-type: disc"><strong>Import-Package</strong>: <a id="id305" class="indexterm"/>This element defines the packages that are outside this plugin but that are exported in other plugins.</li></ul></div></li></ul></div></li><li class="listitem"><strong>Plugin Modules</strong>: This is the section where the actual plugin modules, which we saw a bit earlier and will see in detail later in this book, will appear.</li></ol></div><p>Hopefully, you now have your plugin descriptor ready with all the necessary attributes!</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Working with the Plugins1 and Plugins2 versions</h2></div></div></div><p>Let us also quickly see how to deal with the Plugins1 and Plugins2 versions.</p><a id="id306" class="indexterm"/><a id="id307" class="indexterm"/><p>Before we go on to the details, it is essential to understand the importance of both the versions. Post 4.x, JIRA used to support only Plugins1 version. So why do we need Plugins2 version?</p><p>The key motive behind version 2 plugins is to keep the plugins as a bundle isolated from the other plugins and the JIRA core classes. It makes use of the OSGI platform<a id="id308" class="indexterm"/> (<a class="ulink" href="http://www.osgi.org">http://www.osgi.org</a>) to achieve this. While it keeps the plugins isolated, it also gives you a way to define dependencies between plugins leaving it to the plugin developer's convenience. It even lets you import or export selected packages within the plugin giving increased flexibility.</p><p>The fact that the version2 plugins are deployed as OSGI bundles also means that the plugins are dynamic in nature. They may be installed, started, updated, stopped, and uninstalled at any time during the running of the framework.</p><p>It is the developer's choice to go for the Plugins1 version or the Plugins2 version, depending on the nature of the plugin.</p><a id="id309" class="indexterm"/><p>Let us see the key differences at various stages of plugin development for both the versions.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec31"/>Development</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
</th><th style="text-align: left" valign="bottom">
<p>Plugins1</p>
</th><th style="text-align: left" valign="bottom">
<p>Plugins2</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><strong>Version</strong></p>
</td><td style="text-align: left" valign="top">
<p>No <code class="literal">plugins-version</code> element in <code class="literal">atlassian-plugin.xml</code>.</p>
</td><td style="text-align: left" valign="top">
<p>Include the <code class="literal">plugins-version</code> element in the <code class="literal">atlassian-plugin.xml</code> as follows:</p>
<p><code class="literal">&lt;atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.artifactId}" plugins-version="2"&gt;</code></p>
</td></tr><tr><td style="text-align: left" valign="bottom">
<p><strong>External Dependencies</strong></p>
</td><td style="text-align: left" valign="top">
<p>Include the dependent libraries with the <strong>provided</strong> scope in your <code class="literal">pom.xml</code>file if the jars are added into <code class="literal">WEB-INF/lib</code> or <strong>compile</strong> scope if the jars should be embedded into the plugin.</p>
</td><td style="text-align: left" valign="top">
<p>Dependent libraries must be included in the plugin as the plugin cannot make use of resources under <code class="literal">WEB-INF/lib</code>. This can be done in two ways.</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Provide the scope in the <code class="literal">pom.xml </code>file as compile. In this case, the jars will be picked up by the Plugin SDK and added into the <code class="literal">META-INF/lib</code> folder of the plugin.</li><li class="listitem" style="list-style-type: disc">Manually add the dependent jar files into the <code class="literal">META-INF/lib</code> directory inside the plugin.</li></ul></div>
<p>You can also make your plugin dependent on other bundles. See <em>Managing Complex Dependencies </em>in this table.</p>

</td></tr><tr><td style="text-align: left" valign="bottom">
<p><strong>Dependency Injection</strong></p>
</td><td style="text-align: left" valign="top">
<p>Done by Pico Container in JIRA. All registered components can be injected directly.</p>
</td><td style="text-align: left" valign="top">
<p>Done by the plugin framework. Not all JIRA's core components are available for injection in the constructor.</p>
<p>Use the <code class="literal">component-import</code> module to access some of the dependencies that are not directly accessible within the plugin framework. Use it also to import public components declared in other plugins.</p>
</td></tr><tr><td style="text-align: left" valign="bottom">
<p><strong>Declaring new Components</strong><a id="id310" class="indexterm"/>
<a id="id311" class="indexterm"/>
<a id="id312" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Use the component module to register new components. Once done, it is available to all the plugins.</p>
</td><td style="text-align: left" valign="top">
<p>Use the component module to register components. To make it available to other plugins, set the public attribute to 'true'. It is 'false' by default, making it available only to the plugin in which it is declared.</p>
</td></tr><tr><td style="text-align: left" valign="bottom">
<p><strong>Managing Complex dependencies</strong></p>
</td><td style="text-align: left" valign="top">
<p>All the classes in version1 plugins are available to all other plugins and JIRA core classes.</p>
</td><td style="text-align: left" valign="top">
<p>Version2 plugins allows us to optionally import/export selected packages using <strong>bundle-instructions</strong> in the plugin descriptor or alternatively by the Import-Packge/Export-Packge options while building the bundle.</p>
<p>The <strong>Bundle Dependency System</strong><a id="id313" class="indexterm"/> <a id="id314" class="indexterm"/>hence allows you to define complex dependencies between plugins, eliminating the class path contradictions and upgradation of plugins.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec33"/>Installation</h3></div></div></div><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Plugins1</p>
</th><th style="text-align: left" valign="bottom">
<p>Plugins2</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Plugin must be on the application classpath.</p>
<p>Hence deploy it under the <code class="literal">WEB-INF/lib</code> folder.</p>
</td><td style="text-align: left" valign="top">
<a id="id315" class="indexterm"/>
<a id="id316" class="indexterm"/>
<p>Plugin must <em>not</em> be on the application classpath. It is loaded using the plugin framework.</p>
<p>Hence the plugin is deployed under <code class="literal">${jira-home}/plugins/installed-plugins/</code>.</p>
<p><code class="literal">Jira-home</code> is declared in the <code class="literal">jira-application.properties</code> file under <code class="literal">WEB-INF/classes</code>.</p>
</td></tr></tbody></table></div><p>Right, we now know how the two plugin versions work. Maybe it is time to see the plugins that JIRA comes with!</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec35"/>JIRA System plugins</h2></div></div></div><a id="id317" class="indexterm"/><a id="id318" class="indexterm"/><a id="id319" class="indexterm"/><p>In this section, we will see a brief overview of the JIRA System plugins.</p><p>A lot of JIRA's functionality is written in the form of plugins. It not only showcases what we can achieve using plugins, but also helps us, as developers, to understand how the various pieces fit together.</p><p>If it is the <code class="literal">atlassian-plugin.xml</code> file that describes the plugin functionalities, JIRA maintains the information in <code class="literal">*.xml</code> files placed under <code class="literal">WEB-INF/classes</code>. You will also find the related classes in the exploded folders under <code class="literal">WEB-INF/classes</code>.</p><p>Let us have a quick look at the various system plugin XMLs that can be found in <code class="literal">WEB-INF/classes</code> and the functionality they support:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>System plugin XML</p>
</th><th style="text-align: left" valign="bottom">
<p>Functionality</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-contentlinkresolvers-plugin.xml</code><a id="id320" class="indexterm"/>
<a id="id321" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System Content Link Resolvers</strong><a id="id322" class="indexterm"/>—Resolves parsed content links into Link objects.</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Attachment Link Resolver</li><li class="listitem" style="list-style-type: disc">Anchor Link Resolver</li><li class="listitem" style="list-style-type: disc">JIRA Issue Link Resolver</li><li class="listitem" style="list-style-type: disc">User Profile Link Resolver</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-customfieldtypes-plugin.xml</code><a id="id323" class="indexterm"/>
<a id="id324" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>JIRA System custom fields</strong><a id="id325" class="indexterm"/>—All the out-of-the-box custom fields in JIRA and the searcher associations.</p>
<p>Examples:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Text Field</li><li class="listitem" style="list-style-type: disc">Text Area</li><li class="listitem" style="list-style-type: disc">...............</li><li class="listitem" style="list-style-type: disc">User Picker</li><li class="listitem" style="list-style-type: disc">Select</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-footer-plugin.xml</code><a id="id326" class="indexterm"/>
<a id="id327" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>This plugin renders the content of the footer in JIRA.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-issueoperations-plugin.xml</code><a id="id328" class="indexterm"/>
<a id="id329" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System Issue Operations</strong><a id="id330" class="indexterm"/>—Renders the issue operations using web-items grouped using web-sections.</p>
<p>Examples:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Edit issue</li><li class="listitem" style="list-style-type: disc">Assign Issue</li><li class="listitem" style="list-style-type: disc">..................</li><li class="listitem" style="list-style-type: disc">Log Work</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-issuetabpanels-plugin.xml</code><a id="id331" class="indexterm"/>
<a id="id332" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System Issue Tab Panels</strong><a id="id333" class="indexterm"/>—Renders the various tabs on the <strong>View Issue</strong> page:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All Tab Panel</li><li class="listitem" style="list-style-type: disc">Comment Tab Panel</li><li class="listitem" style="list-style-type: disc">Work Log Tab Panel</li><li class="listitem" style="list-style-type: disc">Change history Tab Panel</li><li class="listitem" style="list-style-type: disc">CVS Tab Panel</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-issueviews-plugin.xml</code><a id="id334" class="indexterm"/>
<a id="id335" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Renders the <strong>single issue view</strong><a id="id336" class="indexterm"/> and the various <strong>search request views</strong><a id="id337" class="indexterm"/>.</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Single Issue Views : XML, Word, Printable</li><li class="listitem" style="list-style-type: disc">Search Views : XML, RSS, RSS (Comments), Printable, Word, Full Content, Excel (All fields), Excel (Current fields), Charts</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-jql-function-plugin.xml</code><a id="id338" class="indexterm"/>
<a id="id339" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Built-in <strong>JQL Functions</strong><a id="id340" class="indexterm"/>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-keyboard-shortcuts-plugin.xml</code><a id="id341" class="indexterm"/>
<a id="id342" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Built-in <strong>Keyboard Shortcuts</strong>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-macros-plugin.xml</code><a id="id343" class="indexterm"/>
<a id="id344" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>JIRA's base <strong>System Macros</strong><a id="id345" class="indexterm"/>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-portlets-plugin.xml</code><a id="id346" class="indexterm"/>
<a id="id347" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Built-in <strong>portlets</strong><a id="id348" class="indexterm"/>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-project-plugin.xml</code><a id="id349" class="indexterm"/>
<a id="id350" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System Project Panels</strong><a id="id351" class="indexterm"/>—Renders the Browse Project, Browse Version, and Browse Component panels.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-projectroleactors-plugin.xml</code><a id="id352" class="indexterm"/>
<a id="id353" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System Project Role Actors</strong><a id="id354" class="indexterm"/>—built-in project role actors (User Role Actor and Group Role Actor) and the associated webwork actions.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-renderercomponentfactories-plugin.xml</code><a id="id355" class="indexterm"/>
<a id="id356" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>Renderer Component Factories Plugin</strong><a id="id357" class="indexterm"/>—instantiates Renderer Components using the plugin system.</p>
<p>Macro Renderer, Link Renderer, URL Renderer, and so on.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-renderers-plugin.xml</code><a id="id358" class="indexterm"/>
<a id="id359" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Built-in<strong> System Renderers</strong><a id="id360" class="indexterm"/>:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Wiki Style Renderer</li><li class="listitem" style="list-style-type: disc">Default Text Renderer</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-reports-plugin.xml</code><a id="id361" class="indexterm"/>
<a id="id362" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Built-in <strong>System Reports</strong><a id="id363" class="indexterm"/>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-top-navigation-plugin.xml</code><a id="id364" class="indexterm"/>
<a id="id365" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Renders the content of the <strong>top navigation bar</strong> in JIRA.</p>
<p>Has a collection of web-items and web-sections.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-user-format-plugin.xml</code><a id="id366" class="indexterm"/>
<a id="id367" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Renders a user in JIRA differently at different places.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-user-profile-panels.xml</code><a id="id368" class="indexterm"/>
<a id="id369" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Renders the panels on the <strong>User Profile</strong> page.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-webresources-plugin.xml</code><a id="id370" class="indexterm"/>
<a id="id371" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System Web Resources</strong><a id="id372" class="indexterm"/>—Includes static resources like JavaScript files, style sheets, and so on.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-webwork1-plugin.xml</code><a id="id373" class="indexterm"/>
<a id="id374" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p><strong>System webwork Plugin</strong><a id="id375" class="indexterm"/><strong>—</strong>Can be used to add custom webwork actions, which can also be done using plugins.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">system-workflow-plugin.xml</code><a id="id376" class="indexterm"/>
<a id="id377" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>System workflow <strong>conditions</strong>, <strong>functions</strong>, and <strong>validators.</strong></p>
</td></tr></tbody></table></div><p>In addition to use these files as a starting point for JIRA plugin development, we might sometimes end up modifying these files to override the way JIRA works.</p><p>Care must be taken to upgrade the changes during the time of a JIRA upgrade.</p><p>So that was a pretty lengthy introduction to the JIRA Architecture! Let us quickly move on to the recipes in this chapter. Time to code!!</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Converting plugins from v1 to v2</h1></div></div></div><p>If you are moving to JIRA 4.x from <a id="id378" class="indexterm"/>JIRA 3.13.x or earlier versions, one of the important differences is the introduction of v2 plugins. While designing the upgrade to JIRA 4.x, it makes perfect sense to sometimes migrate the plugins from v1 to v2, although it is not a mandatory step. In this recipe, we will see how to convert a version1 plugin to a version2 plugin.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Getting ready</h2></div></div></div><a id="id379" class="indexterm"/><a id="id380" class="indexterm"/><p>There are a couple of questions we need to ask before the plugin is converted:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Are all the packages used by the plugin available to OSGi plugins</strong><a id="id381" class="indexterm"/><strong>?</strong> This is very important because JIRA doesn't expose all the packages to OSGi plugins.<p>The list of packages exported and made available to the plugins2 version can be found in the <code class="literal">com.atlassian.jira.plugin.DefaultPackageScannerConfiguration</code> class.</p></li><li class="listitem" style="list-style-type: disc"><strong>Are all the components used by the plugin available to OSGi plugins? </strong>Similar to the previous question, we need to make sure the components are also exposed to the OSGi plugins.<p>Unfortunately, there is no definite list provided by Atlassian for JIRA. To check if the components are available, use dependency injection. The plugin will fail in the start-up if the component is not available.</p></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec37"/>How to do it...</h2></div></div></div><a id="id382" class="indexterm"/><a id="id383" class="indexterm"/><p>The actual conversion process of v1 plugins to v2 is easier than you think if the packages and the components that you have used in the plugin are available to the OSGi plugins. Here are the steps for conversion.</p><div><ol class="orderedlist arabic"><li class="listitem">Add the <code class="literal">plugins-version="2"</code> attribute in <code class="literal">atlassian-plugin.xml</code>. This is probably the only mandatory step in the conversion process. You will be amazed to see that many of the plugins will work as it is! Once added, the plugin descriptor looks like the following:<div><pre class="programlisting">&lt;atlassian-plugin key="${project.groupId}.${project.artifactId}" name="Demo Plugin" plugins-version="2"&gt;
.....................
&lt;/atlassian-plugin&gt;</pre></div></li><li class="listitem">Modify the source code, if required. This includes migration to the new API if you are moving to a new JIRA version with API changes, working out the changes if some of the packages/components not exported to OSGi are used in the v1 plugin, and so on.</li><li class="listitem">Customize the package imports and exports by defining them in the bundle manifest. You can do this by using the Bundle Instructions we saw while explaining the <code class="literal">atlassian-plugin.xml</code> earlier in this chapter or simply by adding the appropriate entries into the manifest file in your jar.<p>This is an optional step which you need to do only if you want to import packages from another plugin/bundle or you want to export some of your packages to make it available to other plugins.</p></li><li class="listitem">Expose your custom plugin components to other plugins using the <code class="literal">component</code> module. You must set the public attribute to true in the component registered in your <code class="literal">atlassian-plugin.xml</code> file. That is, <code class="literal">public="true"</code><p>You must import the components specifically if you want to use the components declared publicly in other plugins. Use the <code class="literal">component-import</code> module to do this.</p><div><pre class="programlisting">&lt;component-import key="democomponent" interface="com.jtricks.DemoComponent" /&gt;</pre></div></li><li class="listitem">You can also optionally add advanced spring configurations by adding <strong>Spring Dynamic Modules</strong> (<strong>SpringDM</strong>)<a id="id384" class="indexterm"/> configuration files (of the format <code class="literal">*.xml</code>) under the <code class="literal">META-INF/spring/</code> directory. These files will then be loaded by the Spring DM Loader. The details are outside the scope of this book.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How it works...</h2></div></div></div><a id="id385" class="indexterm"/><a id="id386" class="indexterm"/><p>The v2 plugin JAR file created with the Atlassian descriptor containing the required modules, goes through the following journey:</p><div><ol class="orderedlist arabic"><li class="listitem">The plugin is loaded at JIRA start-up and JIRA identifies the new jar.</li><li class="listitem"><code class="literal">DirectoryLoader</code> checks whether the new plugin is version2 or version1.</li><li class="listitem">If version2, it checks for the OSGI manifest entries which you can enter in the <code class="literal">MANIFEST.MF</code> file. If found, the plugin is installed as an OSGI bundle and started.</li><li class="listitem">If the OSGI manifest entries are not present, JIRA uses the BND tool (<a class="ulink" href="http://www.aqute.biz/Code/Bnd">http://www.aqute.biz/Code/Bnd</a>) to generate the manifest entries and insert them into the <code class="literal">MANIFEST.MF</code> file.</li><li class="listitem">It then checks for the presence of an explicit <code class="literal">atlassian-plugin-spring.xml</code>. If the file is present, the plugin is then deployed as an OSGI bundle,as in step 2.</li><li class="listitem">If <code class="literal">atlassian-plugin-spring.xml</code> file is absent, it then scans the <code class="literal">atlassian-plugin.xml</code> file and converts the registered components and others into OSGI references or OSGI services and creates an <code class="literal">atlassian-plugin-spring.xml</code> file.</li><li class="listitem">Once the <code class="literal">atlassian-plugin-spring.xml</code> file is created, the plugin is deployed as an OSGI bundle and installed into the PluginManager.</li></ol></div><p>JIRA thus gives us the flexibility to define our own custom OSGI manifest entries and references or let JIRA do the dirty work by defining them appropriately in the plugin descriptor.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec39"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Deploying your plugin </em>in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a>, <em>Plugin Development Process</em></li><li class="listitem" style="list-style-type: disc"><em>Creating a skeleton plugin</em> in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Adding resources into plugins</h1></div></div></div><a id="id387" class="indexterm"/><a id="id388" class="indexterm"/><a id="id389" class="indexterm"/><p>It is often required to add static resources like JavaScript files, CSS files, and so on in our plugins. To enable JIRA to serve these additional static files, they should be defined as downloadable resources.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Getting ready</h2></div></div></div><p>A resource can be of different types. It is normally defined as a non-Java file that the plugin requires to operate.</p><p>Examples of resources that you will come across during JIRA plugin development include, but are not restricted to, the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Velocity (<code class="literal">*.vm</code>) files required to render a view</li><li class="listitem" style="list-style-type: disc">JavaScript files</li><li class="listitem" style="list-style-type: disc">CSS files</li><li class="listitem" style="list-style-type: disc">Property files for localization</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec41"/>How to do it...</h2></div></div></div><a id="id390" class="indexterm"/><a id="id391" class="indexterm"/><a id="id392" class="indexterm"/><p>To include a resource, add the resource module to the <code class="literal">atlassian-plugin.xml</code> file. The resource module can be added as part of the entire plugin or can be included within another module, restricting it just for that module.</p><p>The following are the attributes and elements available for the resource module<a id="id393" class="indexterm"/>
<a id="id394" class="indexterm"/> and their uses:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">name</code><a id="id395" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Name of the resource. This is used by the plugin or module to locate a resource. You can even define a directory as a resource by adding a trailing <code class="literal">/</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">namePattern</code><a id="id396" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Pattern to use when loading a directory resource.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">type</code><a id="id397" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Type of the resource.</p>
<p>Examples:</p>
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">download</code> for resources like CSS, JavaScript, Images, and so on</li><li class="listitem" style="list-style-type: disc"><code class="literal">velocity</code> for velocity files</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">location</code><a id="id398" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Location of the resource within the plugin jar. The full path to the file without a leading slash is required. When using, <code class="literal">namePattern</code> or pointing to directory resource, a trailing <code class="literal">/</code> is required.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">property</code><a id="id399" class="indexterm"/>
<code class="literal"> (key/value)</code></p>
</td><td style="text-align: left" valign="top">
<p>Used to add properties as key/value pairs to the resource. Added as a child tag to resources.</p>
<p>Example: <code class="literal">&lt;property key="content-type" value="text/css"/&gt;</code></p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">param</code><a id="id400" class="indexterm"/>
<code class="literal"> (name/value</code>
<code class="literal">)</code></p>
</td><td style="text-align: left" valign="top">
<p>Used to add name/value pairs. Added as a child tag to resources.</p>
<p>Example: <code class="literal">&lt;param name="content-type" value="image/gif"/&gt;</code></p>
</td></tr></tbody></table></div><p>All you have to do is to add the resource tag to the <code class="literal">atlassian-plugin.xml</code> file, either at the plugin level or at a module level. The resource will then be available for use.</p><a id="id401" class="indexterm"/><a id="id402" class="indexterm"/><a id="id403" class="indexterm"/><p>The resource definition for an image will look as follows:</p><div><pre class="programlisting">&lt;resource type="download" name="myimage.gif" location="includes/images/ myimage.gif"&gt;
  &lt;param name="content-type" value="image/gif"/&gt;
&lt;/resource&gt;</pre></div><p>A CSS file might looks as follows:</p><div><pre class="programlisting">&lt;resource type="download" name="demostyle.css" location="com/jtricks/ demostyle.css"/&gt;</pre></div><p>Once the resource is defined in the plugin descriptor, you can use it anywhere in the plugin. Following is how you refer to the resource.</p><p>Let us consider that you have a directory referenced as follows:</p><div><pre class="programlisting">&lt;resource type="download" name="images/"location="includes/images/"/&gt;</pre></div><p>A file <code class="literal">demoimage.gif</code> can be a reference in your velocity template as follows:</p><div><pre class="programlisting">$requestContext.baseUrl/download/resources/${your_plugin_key}:${module_key}/images/ demoimage.gif</pre></div><p>A sample piece of code used in your plugin module looks as follows:</p><div><pre class="programlisting">&lt;img id="demo-image" src="img/ demoimage.gif"/&gt;</pre></div><p>Where <code class="literal">com.jtricks.demo</code> is the plugin key and <code class="literal">demomodule</code> is the module key.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Adding web resources into plugins</h1></div></div></div><a id="id404" class="indexterm"/><a id="id405" class="indexterm"/><a id="id406" class="indexterm"/><p>The web resources plugin module, like the resource module we just saw, allows defining downloadable resources. The difference is that the web resources are added at the top of the page in the header with the cache-related headers set to never expire.</p><p>An additional advantage of using web resources module is that we can specify the resources to be included in specific contexts within the application.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How to do it...</h2></div></div></div><a id="id407" class="indexterm"/><p>The root element for the web resource plugin module is <strong>web-resource</strong><a id="id408" class="indexterm"/>. It supports the following attributes:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">Key</code><a id="id409" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>The only mandatory attribute. This should be unique within the plugin.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">Disabled</code><a id="id410" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Indicates whether the plugin module should be disabled by default or not.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">i18n-name-key</code><a id="id411" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>The localization key for the human-readable name of the plugin module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">Name</code><a id="id412" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Human-readable name of the web resource.</p>
</td></tr></tbody></table></div><p>The following are the key elements<a id="id413" class="indexterm"/> supported.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">description</code><a id="id414" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Description of the module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">resource</code><a id="id415" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>All the resources to be added as web resources. See <em>Adding resources into plugins</em>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">dependency</code><a id="id416" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Used to define dependency on the other web-resource modules. The dependency should be defined as <code class="literal">pluginKey:web-resourceModuleKey</code>.</p>
<p>Example: <code class="literal">&lt;dependency&gt;com.jtricks.demoplugin:demoResource&lt;/dependency&gt;</code></p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">context</code><a id="id417" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Define the context where the web resource is available.</p>
</td></tr></tbody></table></div><p>We can define the web-resource module by populating the attributes and elements appropriately.</p><p>An example would look as follows:</p><div><pre class="programlisting">&lt;atlassian-plugin  name="Demo Plugin" key="com.jtricks.demoplugin" plugins-version="2"&gt;
  &lt;plugin-info&gt;
    &lt;description&gt;Demo Plugin for web-resources&lt;/description&gt;
    &lt;vendor name="J Tricks"url="http://www.j-tricks.com"/&gt;
    &lt;version&gt;1.0&lt;/version&gt;
  &lt;/plugin-info&gt;
<strong>
  &lt;web-resource key="demoresource" name="Demo"&gt;
    &lt;resource type="download" name="demoscript.js" location="includes/
      js/demoscript.js" /&gt;
    &lt;resource type="download" name=" demoscript1.js" 
      location="includes/js/demoscript1.js" /&gt;
  &lt;/web-resource&gt;</strong>
&lt;/atlassian-plugin&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How it works...</h2></div></div></div><a id="id418" class="indexterm"/><a id="id419" class="indexterm"/><a id="id420" class="indexterm"/><p>When a webresource is defined, it is available for you in the plugin just like your downloadable plugin resources. As mentioned earlier, the resources are added to the top of the page in the header section.</p><p>In your action class or servlet, you can access these resources with the help of <strong>WebResourceManager</strong><a id="id421" class="indexterm"/><strong>. </strong>Inject the manager class into your constructor and you can then use it to define the resource as follows:</p><div><pre class="programlisting">webResourceManager.requireResource("com.jtricks.demoplugin: demoresource");</pre></div><p>The argument should be <code class="literal">pluginKey:web-resourceModuleKey</code>.</p><p>By default, all the resources under the web-resource module are served in batch mode, that is, in a single request. This reduces the number of HTTP requests from the web browser.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec44"/>There's more...</h2></div></div></div><p>Before we wind up this recipe, it is probably a good idea to identify the available contexts for web resources and also to see how we can turn off the batch mode while loading resources.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec34"/>Web resource contexts</h3></div></div></div><a id="id422" class="indexterm"/><a id="id423" class="indexterm"/><a id="id424" class="indexterm"/><p>Following are the available web resource contexts:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">atl.general</code>: Everywhere except administration screens</li><li class="listitem" style="list-style-type: disc"><code class="literal">atl.admin</code>: Administration screens</li><li class="listitem" style="list-style-type: disc"><code class="literal">atl.userprofile</code>:User profile screens</li></ul></div><p>You can have multiple contexts added like this:</p><div><pre class="programlisting">&lt;web-resource key="demoresource" name="Demo"&gt;
    &lt;resource type="download" name="demoscript.js" location="includes
/js/ demoscript.js" /&gt;
    &lt;context&gt;atl.general&lt;/context&gt;
    &lt;context&gt;atl.admin&lt;/context&gt;
&lt;/web-resource&gt;</pre></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec35"/>Turning off batchmode</h3></div></div></div><a id="id425" class="indexterm"/><a id="id426" class="indexterm"/><p>As mentioned earlier, the resources are loaded in one batch to reduce the number of HTTP requests from the browser. But if you want to switch off the batch mode for some reason, it can be achieved in two ways.</p><div><ol class="orderedlist arabic"><li class="listitem">You can switch of batch mode <code class="literal">system-wide</code> by adding a property <code class="literal">plugin.webresource.batching.off=true</code> into <code class="literal">jira-application.properties</code>.</li><li class="listitem">It can be turned off by individual resources by adding a <code class="literal">param</code> element as follows:<div><pre class="programlisting">&lt;resource type="download"  name="demoscript.js"  location="includes/js/ demoscript.js"&gt;
    &lt;param name="batch" value="false"/&gt;
&lt;/resource&gt;</pre></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec45"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Adding resources into plugins</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Building JIRA from source</h1></div></div></div><p>One of the best things about JIRA, if you have a valid license, is that you get to see the source code. To see it, modify it, break it... err modify it because you have the license to do it!</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec46"/>Getting ready</h2></div></div></div><a id="id427" class="indexterm"/><a id="id428" class="indexterm"/><p>Following are some of the pre-requisites prior to building JIRA from the source.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A valid JIRA license to get access to the source code.</li><li class="listitem" style="list-style-type: disc">An environment with JDK 1.5 or higher for JIRA 4.2 and lower versions. JDK 1.6 or higher for JIRA 4.3+.</li><li class="listitem" style="list-style-type: disc">You will need both Maven1 and Maven2 if you are building versions prior to JIRA 4.3. Download Maven version 1.0.x and 2.1.x from <a class="ulink" href="http://maven.apache.org">http://maven.apache.org</a>. JIRA 4.3+ needs only Maven 2.1.0.</li></ul></div><div><div><h3 class="title"><a id="note07"/>Note</h3><p>You need both Maven1 and Maven2 for versions prior to JIRA 4.3 because Maven1 is required to build the JIRA source and Maven2 is required to build plugins for JIRA. JIRA has bundled plugins thatneed to be built along with JIRA and so Maven2 is also a must.</p><p>Maven 2.1.0+ is required for the plugin development process.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec47"/>How to do it...</h2></div></div></div><p>Let us see the steps to build JIRA WAR from the source for versions prior to JIRA 4.3:</p><div><ol class="orderedlist arabic"><li class="listitem">Configure <strong>Maven 1.0.x</strong><a id="id429" class="indexterm"/><a id="id430" class="indexterm"/>.<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Extract the Maven 1.0.x version downloaded earlier to a directory, which we will now refer to as <code class="literal">MAVEN_INSTALL_DIR</code>.</li><li class="listitem" style="list-style-type: disc">Download an Atlassian patched version of Ant jar from <code class="literal">http://confluence.atlassian.com/download/attachments/185729661/ant-optional-1.5.3-1.jar?version=1&amp;modificationDate=1</code><a class="ulink" href="http://276644963420">276644963420</a> and copy it to <code class="literal">MAVEN_INSTALL_DIR/maven-1.0/lib</code>.</li><li class="listitem" style="list-style-type: disc">Set the <code class="literal">MAVEN_HOME</code> environment variable, which will be <code class="literal">MAVEN_INSTALL_DIR/maven-1.0</code>.</li><li class="listitem" style="list-style-type: disc">Add Maven's bin directory to the path variable.</li></ul></div></li><li class="listitem">Configure <strong>Maven 2.1.x</strong><a id="id431" class="indexterm"/><a id="id432" class="indexterm"/>. If you have already setup your development environment using Atlassian Plugin SDK, you can skip this test as it comes along with a bundled Maven 2.x.<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Install Maven 2.1.x, as per the instructions at <a class="ulink" href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a> .</li><li class="listitem" style="list-style-type: disc">Configure the <code class="literal">settings.xml</code> by following the example <code class="literal">settings.xml </code>provided by Atlassian at <a class="ulink" href="http://confluence.atlassian.com/display/DEVNET/Example+settings.xml">http://confluence.atlassian.com/display/DEVNET/Example+settings.xml</a>.</li></ul></div></li><li class="listitem">Download the JIRA source ZIP file from <a class="ulink" href="http://www.atlassian.com/software/jira/JIRASourceDownloads.jspa">http://www.atlassian.com/software/jira/JIRASourceDownloads.jspa</a>.</li><li class="listitem">Extract the JIRA source to a directory which we call <code class="literal">JIRA_DIR</code>.</li><li class="listitem">Go to the <code class="literal">jira</code> subdirectory, that is, <code class="literal">JIRA_DIR/jira</code>.</li><li class="listitem"><a id="id433" class="indexterm"/><a id="id434" class="indexterm"/>Run the following command to create an open WAR:<div><pre class="programlisting">
<strong>maven war:webapp</strong>
</pre></div><p>If you want to create a closed WAR, execute the following:</p><div><pre class="programlisting">
<strong>maven war:war</strong>
</pre></div></li><li class="listitem">See <a class="ulink" href="http://maven.apache.org/maven-1.x/plugins/war/goals.html">http://maven.apache.org/maven-1.x/plugins/war/goals.html</a> for more Maven WAR goals.</li><li class="listitem">Confirm that the WAR is created properly.</li></ol></div><a id="id435" class="indexterm"/><a id="id436" class="indexterm"/><p>The following are the steps to create the WAR on JIRA 4.3 and higher versions.</p><div><ol class="orderedlist arabic"><li class="listitem">Configure Maven 2.1.0.</li><li class="listitem">Download and install the required third-party libraries, as these libraries are not available in the public Maven repositories:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Download the correct version of the jar files, as mentioned below:<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">activation</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">javax.activation:activation</code></p>
</td><td style="text-align: left" valign="top">
<p>1.0.2</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">jms</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">javax.jms:jms</code></p>
</td><td style="text-align: left" valign="top">
<p>1.1</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">jmxri</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">com.sun.jmx:jmxri</code></p>
</td><td style="text-align: left" valign="top">
<p>1.2.1</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">jmxtools</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">com.sun.jdmk:jmxtools</code></p>
</td><td style="text-align: left" valign="top">
<p>1.2.1</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">jndi</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">jndi:jndi</code></p>
</td><td style="text-align: left" valign="top">
<p>1.2.1</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">jta</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">Jta:jta</code></p>
</td><td style="text-align: left" valign="top">
<p>1.0.1B</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">mail</code></p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">javax.mail:mail</code></p>
</td><td style="text-align: left" valign="top">
<p>1.3.2</p>
</td></tr></tbody></table></div></li><li class="listitem" style="list-style-type: disc">Install them to the local Maven repository using the Maven install command:<div><pre class="programlisting">
<strong>mvninstall:install-file -DgroupId=javax.activation -DartifactId=activation -Dversion=1.0.2 -Dpackaging=jar -Dfile=activation-1.0.2.jar</strong>
<strong>mvninstall:install-file -DgroupId=javax.jms -DartifactId=jms -Dversion=1.1 -Dpackaging=jar -Dfile=jms-1.1.jar</strong>
<strong>mvninstall:install-file -DgroupId=com.sun.jmx -DartifactId=jmxri -Dversion=1.2.1 -Dpackaging=jar -Dfile=jmxri.jar</strong>
<strong>mvninstall:install-file -DgroupId=com.sun.jdmk -DartifactId=jmxtools -Dversion=1.2.1 -Dpackaging=jar -Dfile=jmxtools.jar</strong>
<strong>mvninstall:install-file -DgroupId=jndi -DartifactId=jndi -Dversion=1.2.1 -Dpackaging=jar -Dfile=jndi.jar</strong>
<strong>mvninstall:install-file -DgroupId=jta -DartifactId=jta -Dversion=1.0.1 -Dpackaging=jar -Dfile=jta-1_0_1B-classes.jar</strong>
<strong>mvninstall:install-file -DgroupId=javax.mail -DartifactId=mail -Dversion=1.3.2 -Dpackaging=jar -Dfile=mail.jar</strong>
</pre></div></li></ul></div></li><li class="listitem">Extract the JIRA source archive to a local directory, which we call <code class="literal">JIRA_DIR</code>.</li><li class="listitem">Navigate to the extracted sub directory with the name <code class="literal">atlassian-jira-X.Y-source</code> where X.Y is the version.</li><li class="listitem">Run <code class="literal">build.bat</code> if on Windows, or <code class="literal">build.sh</code> if on Linux or Mac.</li><li class="listitem">Confirm that the WAR file is created properly under <code class="literal">JIRA_DEV/jira-project/jira-distribution/jira-webapp-dist/target subdirectory</code>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How it works...</h2></div></div></div><a id="id437" class="indexterm"/><a id="id438" class="indexterm"/><p>As you have seen, the process is pretty straightforward and the actual build is done by Maven, the magician.</p><p>JIRA ships with the <code class="literal">project.xml</code> or <code class="literal">pom.xml</code> if in 4.3+, called the Project Object Model, which is used by Maven to build the WAR file.</p><p>You will be able to find the JIRA dependencies inside the <code class="literal">project.xml</code> / <code class="literal">pom.xml</code>. Maven will first build the dependencies and then build the JIRA WAR file using them.</p><p>The only key thing here is to setup Maven correctly. There are a couple of issues normally observed while building JIRA WAR, both related to Maven. Maybe it is worth touching upon them before we move ahead.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Error while downloading dependencies due to the<em>java.net.ConnectException: Connection timed out: connect</em> exception.<p>If you encounter this, make sure that the Maven proxy settings are configured properly. If already configured and still you are getting the error, try disabling your antivirus!</p></li><li class="listitem" style="list-style-type: disc"><em>Failed to resolve artifact</em> error. Building JIRA 4.0 fails to download javax jms jar. In such cases, download the jar manually and install them into the local repository using <code class="literal">mvn install</code>.<div><pre class="programlisting">mvninstall:install-file -Dfile=&lt;path-to-file&gt; -DgroupId=&lt;group-id&gt; -DartifactId=&lt;artifact-id&gt; -Dversion=&lt;version&gt; -Dpackaging=&lt;packaging&gt;</pre></div><p>In 4.3+, refer to step 2 in the recipe where the relevant <code class="literal">mvn install</code> commands are given.</p></li></ul></div><p>Once the WAR file is created, deploy it into a supported application server, and enjoy the power of JIRA!</p><div><div><h3 class="title"><a id="tip01"/>Tip</h3><p><strong>Downloading the example code for this book</strong></p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.PacktPub.com">http://www.PacktPub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.PacktPub.com/support">http://www.PacktPub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec49"/>There's more...</h2></div></div></div><p>Along with the JIRA source, we have access to the source code of some of the JIRA dependencies from Atlassian. You might want to build them separately if you ever want to modify their behavior.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec36"/>Building JIRA dependencies</h3></div></div></div><a id="id439" class="indexterm"/><a id="id440" class="indexterm"/><p>Similar to JIRA, the dependent projects also use Maven. But it uses Maven1 in some cases and Maven2 in some others.</p><p>You can determine whether the dependency uses Maven1 or Maven2 by checking its Project Object Model by looking in the root directory. If the file is named <code class="literal">project.xml</code>, it uses Maven1 and if the file is named <code class="literal">pom.xml</code><a id="id441" class="indexterm"/>, it uses Maven2.Simple, right?</p><p>Use the following command to generate the jar file for a dependency if it uses Maven1.</p><div><pre class="programlisting">
<strong>maven jar</strong>
</pre></div><p>For dependencies with Maven2, use:</p><div><pre class="programlisting">
<strong>mvn package</strong>
</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec50"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a id="id442" class="indexterm"/><a id="id443" class="indexterm"/><em>Setting up the development environment </em>in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Adding new webwork actions to JIRA</h1></div></div></div><p>Most of the time plugin developers will find themselves writing new actions in JIRA to introduce new functionality. Usually these actions are invoked from new web-item links configured at different places in the UI. It could also be from customized JSPs or other parts of the JIRA framework.</p><a id="id444" class="indexterm"/><a id="id445" class="indexterm"/><p>New actions can be added to JIRA with the help of the webwork plugin module.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec51"/>Getting ready</h2></div></div></div><p>Before we start, it probably makes sense to have a look at the webwork plugin module. Following are the key attributes supported:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">Key</code><a id="id446" class="indexterm"/>
<a id="id447" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>A unique key within the plugin. It will be used as the identifier for the plugin.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">Class</code><a id="id448" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>This will be <code class="literal">java.lang.Object</code> as the real logic will reside in the action, Class.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">i18n-name-key</code><a id="id449" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>The localization key for the human-readable name of the plugin module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">Name</code><a id="id450" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Human-readable name of the webwork action.</p>
</td></tr></tbody></table></div><p>The following are the key elements<a id="id451" class="indexterm"/> supported:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">description</code><a id="id452" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Description of the webwork module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">actions</code><a id="id453" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>This is where we specify the webwork1 actions.</p>
<p>A webwork module must contain atleast one action element. It can have any number of actions.</p>
</td></tr></tbody></table></div><a id="id454" class="indexterm"/><a id="id455" class="indexterm"/><p>For each webwork1<a id="id456" class="indexterm"/> action, we should have the following attributes populated:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">name</code><a id="id457" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Fully qualified name of the action class. The class must extend <code class="literal">com.atlassian.jira.action.JiraActionSupport</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">alias</code><a id="id458" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>An alias name for the action class. JIRA will use this name to invoke the action.</p>
</td></tr></tbody></table></div><p>The following element is supported for the webwork1 action:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">view</code><a id="id459" class="indexterm"/>
<a id="id460" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Delegates the user to the appropriate view, based on the output of the action. This element has an attribute: name that maps to the return value of the action class.</p>
</td></tr></tbody></table></div><p>Now that you have seen the attributes and elements supported, we can have a look at a sample webwork module before proceeding to create one!</p><div><pre class="programlisting">&lt;webwork1 key="demoaction" name="JTricks Demo Action" class="java.lang.Object"&gt;
  &lt;actions&gt;
    &lt;action name="com.jtricks.DemoAction" alias="DemoAction"&gt;
      &lt;view name="input"&gt;/templates/input.vm&lt;/view&gt;
      &lt;view name="success "&gt;/templates/joy.vm&lt;/view&gt;
      &lt;view name="error"&gt;/templates/tears.vm&lt;/view&gt;
    &lt;/action&gt;
  &lt;/actions&gt;
&lt;/webwork1&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec52"/>How to do it...</h2></div></div></div><p>Let us now aim at creating a sample webwork action. For the example, we can create an action that takes a user input, prints it out in the console, and displays it on the output page after modifying the input.</p><p>Following are the steps to perform:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the new webwork action module into your <code class="literal">atlassian-plugin.xml</code>. Let us say, we add the same aforementioned snippet.</li><li class="listitem">Create the action class <code class="literal">DemoAction</code> under the package <code class="literal">com.jtricks</code>. The class must extend <code class="literal">com.atlassian.jira.action.JiraActionSupport</code>.</li><li class="listitem">Identify the parameters that you need to receive from the user. Create private variables for them with the name exactly similar to that of the related HTML tag.<p>In our example, we need to take a user input. Let us say, it is the name of the user. The HTML code in the input view (in our case,<code class="literal">/templates/input.vm</code>) will be as follows:</p><div><pre class="programlisting">Name:  &lt;input type="text" name="userName"&gt;</pre></div><p>So, we need to create a String variable of the name <code class="literal">userName</code> in our action class.</p></li><li class="listitem">Create setter methods for the variables that are used to get values from the input view.<p>In our example, we retrieve the <code class="literal">userName</code> from the input view and process it in the action class. So we need to create a setter method for that which will look like this.</p><div><pre class="programlisting">public void setUserName(String userName) {
  this.userName = userName;
}</pre></div></li><li class="listitem">Identify the parameter that needs to be printed in the output page. In our case, we will print <code class="literal">modifiedName</code> in the output page.</li><li class="listitem">Create getter methods for the parameters to be printed. Velocity or JSPs will invoke the getter methods to retrieve the value from the <code class="literal">Action</code> class. For our example, we have a getter method for <code class="literal">modifiedName</code>, which looks as follows:<div><pre class="programlisting">public String getModifiedName() {
    return modifiedName;
}</pre></div></li><li class="listitem"><a id="id461" class="indexterm"/><a id="id462" class="indexterm"/>Override the methods of interest. This is where the actual logic will fit it. It is entirely up to the plugin developer to determine which methods to be overridden. It totally depends on the logic of the plugin.<p>The three main methods of interest are the following. But you can completely omit these methods and write your own commands and related methods:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">doValidation</code><a id="id463" class="indexterm"/>: This is the method where the input validation happens. Plugin developers can override this method and add our own bits of custom validations.</li><li class="listitem" style="list-style-type: disc"><code class="literal">doExecute</code>: <a id="id464" class="indexterm"/>This is where the action execution happens. When the input form is submitted, the <code class="literal">doExecute</code> method is called if there are no validation errors. All the business logic is done here and the appropriate 'view' name is returned, based on the execution result.<p>In our example, we use this method to modify the input String:</p><div><pre class="programlisting">this.modifiedName = "Hi,"+userName;
return "success";</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">doDefault</code><a id="id465" class="indexterm"/>: This method is invoked when the 'default' command is used. In our example, <code class="literal">DemoAction!default.jspa</code> will invoke the <code class="literal">doDefault</code> method.<p>In our example, we use this method to redirect the user to the input page:</p><div><pre class="programlisting">return "input";</pre></div></li></ul></div></li><li class="listitem"><a id="id466" class="indexterm"/><a id="id467" class="indexterm"/>Create the Velocity template for the input view. The 'input' view, in our example, uses the template: /<code class="literal">templates/input.vm</code>. Add the HTML code of the input text within a form whose action invokes <code class="literal">DemoAction</code>:<div><pre class="programlisting">&lt;h2&gt;My Input Form&lt;/h2&gt;&lt;br&gt;&lt;br&gt;
&lt;form method="POST" action="/secure/DemoAction.jspa"&gt;
      Name:  &lt;input type="text" name="userName"&gt;&lt;br&gt;
             &lt;input type="submit"&gt;
&lt;/form&gt;</pre></div></li><li class="listitem">Create the success view to print the <code class="literal">modifiedName</code> in <code class="literal">/templates/joy.vm</code>: <code class="literal">The output: $modifiedName</code>.</li><li class="listitem">Create the error view in <code class="literal">/templates/error.vm</code>: <code class="literal">Oh No, Error!</code></li><li class="listitem">Package the plugin and deploy it.</li><li class="listitem">Point your browser to <code class="literal">${jira_base_url}/secure/DemoAction!default.jspa</code>. Enter some name and submit the form to see it in action!<div><div><h3 class="title"><a id="note08"/>Note</h3><p>The example given here is just for the sake of understanding how the webwork action works.</p></div></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec53"/>How it works...</h2></div></div></div><p>It is probably worth utilizing this section to see how the flow works in our example. Let us see it happening as a step-by-step process.</p><div><ol class="orderedlist arabic"><li class="listitem">When <code class="literal">${jira_base_url}/secure/DemoAction!default.jspa</code> is invoked, the plugin framework looks for the action <code class="literal">DemoAction</code> registered in the <code class="literal">atlassian-plugin.xml</code> file and identifies the command and view associated with it.</li><li class="listitem">Here the <code class="literal">default</code> command is invoked and so the <a id="id468" class="indexterm"/><code class="literal">doDefault</code> method in the action class is executed.</li><li class="listitem"><code class="literal">doDefault</code> method returns the view name as <code class="literal">input</code>.</li><li class="listitem">The input view is resolved as <code class="literal">input.vm</code>, which presents the form to the user.</li><li class="listitem">On the form, webwork populates the <code class="literal">userName</code> value in the action class using the setter method.<p>In the execution flow, first the <code class="literal">doValidation</code> method is invoked. If no error is there, which is the case in our example, it invokes the <code class="literal">doExecute</code> method.</p><p>If there is any error in <code class="literal">doValidation</code>, the execution stops and the input view is shown. You can print the error messages appropriately on the input view, if there are any. See webwork1 documentation for details.</p></li><li class="listitem">The input String, <code class="literal">userName</code>, is then modified and assigned to <code class="literal">modifiedName</code> in the action class (the <code class="literal">doExecute</code> method) and <code class="literal">success</code> is returned.</li><li class="listitem">The success view is resolved as <code class="literal">joy.vm</code> where the <code class="literal">modifiedName</code> is printed. <code class="literal">$modifiedName</code> will invoke the <code class="literal">getModifiedName()</code> method to print the modified name.<p>If error is returned, the view is resolved as error.vm and the appropriate error message is shown!</p></li></ol></div><a id="id469" class="indexterm"/><a id="id470" class="indexterm"/><p>Like this, we can write complex actions in JIRA that can be used to customize a lot of aspects of JIRA.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec54"/>There's more...</h2></div></div></div><p>It is also possible to add custom commands to the webwork actions, in addition to the <code class="literal">doExecute</code> and <code class="literal">doDefault</code> methods. This enables the developer to invoke the action using user-friendly commands, say <code class="literal">ExampleAction!hello.jspa</code>.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec37"/>Adding new commands to the action</h3></div></div></div><a id="id471" class="indexterm"/><a id="id472" class="indexterm"/><p>The following is a short example of how to add custom commands in the webwork action module.</p><p>The <code class="literal">atlassian-plugin.xml</code> file should be modified to include the new command under the action:</p><div><pre class="programlisting">&lt;action name="com.jtricks.DemoAction" alias="DemoAction"&gt;
    &lt;view name="input"&gt;/templates/input.vm&lt;/view&gt;
    &lt;view name=" success "&gt;/templates/joy.vm&lt;/view&gt;
    &lt;view name="error"&gt;/templates/tears.vm&lt;/view&gt;
    &lt;command name="hello" alias="DemoHello"&gt;
       &lt;view name="success"&gt;/templates/hello.vm&lt;/view&gt;
       &lt;view name="error"&gt;/templates/tears.vm&lt;/view&gt;
    &lt;/command&gt;
&lt;/action&gt;</pre></div><p>In this case, we need to create a method <code class="literal">doHello()</code> in the action class.</p><p>You can invoke the method by calling <code class="literal">DemoAction!hello.jspa</code>, in which case the method will be executed and the returning "success" message will take the user <code class="literal">to /templates/joy.vm</code>.</p><p>You can have separate views for the command which can be invoked by calling the associated alias name, <code class="literal">DemoHello.jspa</code>. In this case, returning "success" will take the <a id="id473" class="indexterm"/>
<a id="id474" class="indexterm"/>user to <code class="literal">/templates/hello.vm</code>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec55"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Deploying your plugin </em>in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Extending a webwork action in JIRA</h1></div></div></div><a id="id475" class="indexterm"/><a id="id476" class="indexterm"/><p>There are so many user stories for this one! How do you override some of the JIRA built-in actions? How do you do some additional stuff in the JIRA built-in action? (Like doing some crazy things immediately after creation before the page returns to the user, or doing some innovative validations on some of those actions)</p><p>Extending the existing JIRA action is an answer to all these questions. Let us see in detail how to do that.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec56"/>How to do it...</h2></div></div></div><p>Extending a JIRA action is done with the help of the webwork plugin module. Most of it is very similar to writing new webwork actions.</p><p>Let us take the case of the <strong>create issue</strong> action<a id="id477" class="indexterm"/>. What should we do if we need to extend the create action? Say, to do some additional validation and to do some extra things after the actual creation is done?</p><p>The following are the steps, in a nutshell:</p><div><ol class="orderedlist arabic"><li class="listitem">Identify the action to be overridden by looking up the <code class="literal">actions.xml</code> under <code class="literal">WEB-INF/classes</code> in your JIRA installation directory.<p>In our case, <code class="literal">CreateIssueDetails</code> is the action class that does the creation of the issue:</p><div><pre class="programlisting">&lt;action name="issue.CreateIssueDetails" alias="CreateIssueDetails"&gt;
   &lt;view name="error"&gt;/secure/views/createissue-details.jsp&lt;/view&gt;
   &lt;view name="input"&gt;/secure/views/createissue-details.jsp&lt;/view&gt;
&lt;/action&gt;</pre></div><p>This snippet defines the action class and the related views thatare using JSP files.</p></li><li class="listitem">Determine whether we need to override the action or just modify the JSP files. In our example, let us do some extra validation.</li><li class="listitem">Add the webwork plugin module in the <code class="literal">atlassian-plugin.xml</code>:<div><pre class="programlisting">&lt;webwork1 key="jtricks-create-issue-details" name="JTricks Create Issue Details"&gt;
  &lt;actions&gt;
    &lt;action name="com.jtricks.MyCreateIssueDetails" alias="CreateIssueDetails"&gt;
      &lt;view name="error"&gt;/secure/views/createissue-details.jsp&lt;/view&gt;
      &lt;view name="input"&gt;/secure/views/createissue-details.jsp&lt;/view&gt;
    &lt;/action&gt;
  &lt;/actions&gt;
&lt;/webwork1&gt;</pre></div></li><li class="listitem"><a id="id478" class="indexterm"/><a id="id479" class="indexterm"/>Note the change in action class name. We can also change the JSP files if that is needed. But most importantly, the <code class="literal">alias</code> name should be exactly the same as the action alias name in <code class="literal">actions.xml</code>. In this case, the <code class="literal">alias</code> name is <code class="literal">CreateIssueDetails</code></li><li class="listitem">Create the action class <code class="literal">com.jtricks.MyCreateIssueDetails</code></li><li class="listitem">We can do the full action class implementation in <code class="literal">MyCreateIssueDetails</code>. But in most cases, you might just need to override some methods of the existing action class, as in our example. If so, just extend the original action class like this:<div><pre class="programlisting">public class MyCreateIssueDetails extends CreateIssueDetails{</pre></div></li><li class="listitem">Add the appropriate constructor to carry out dependency injection and to call the super class constructor. Eclipse, or the IDE you use, will usually prompt this. If you need any other manager classes to add your extra logic, inject them as well in the constructor.</li><li class="listitem">Override the methods you want. In our example, we need to do extra validation. Let us see how to add a validation to check if the current user is the assignee or not!<div><pre class="programlisting">@Override
protected void doValidation() {
    //Our custom validation here
    String assignee = getSingleValueFromParameters("assignee");
    if (assignee == null || !assignee.equals(getRemoteUser().getName())){
addErrorMessage("Assignee is not the current user, got U!");
    }
super.doValidation();
}</pre></div></li><li class="listitem">Here we check if the current user is the assignee or not, and add an error message if not.</li><li class="listitem">Package the plugin and deploy it.</li><li class="listitem">Create an issue with and without the assignee as yourself and see how JIRA behaves!</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec57"/>How it works...</h2></div></div></div><a id="id480" class="indexterm"/><a id="id481" class="indexterm"/><p>The key aspect of extending an existing action is to use the same <code class="literal">alias</code> name in your webwork plugin module. JIRA registers all the actions in <code class="literal">actions.xml</code> and overwrites them with the actions in plugins, if the same alias name is found.</p><p>In this case, JIRA registers the class <code class="literal">com.jtricks.MyCreateIssueDetails</code> for the <code class="literal">CreateIssueDetails</code> action instead of the original <code class="literal">issue.CreateIssueDetails</code> class.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec58"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Adding new webwork actions to JIRA</em></li><li class="listitem" style="list-style-type: disc"><em>Deploying your plugin </em>in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a></li></ul></div></div></div></body></html>