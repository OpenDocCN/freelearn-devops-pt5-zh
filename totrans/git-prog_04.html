<html><head></head><body>
  <div><h1 class="chapterNumber">4</h1>
    <h1 id="_idParaDest-81" class="chapterTitle">Merging, Pull Requests, and Handling Merge Conflicts</h1>
    <p class="normal">In this chapter, you will see how to merge branches, using different types of merges. You will also see how to handle merge conflicts and tools to make managing conflicts easier. You will learn about pull requests and the difference between a fast-forward merge and a "true" merge.</p>
    <p class="normal">In this chapter, you will learn:</p>
    <ul>
      <li class="bullet">How to push a commit to the server</li>
      <li class="bullet">How to manage your commits with the command line, Visual Studio, and GitHub Desktop</li>
      <li class="bullet">How to merge into the main branch</li>
      <li class="bullet">What a pull request is</li>
      <li class="bullet">What merge conflicts are and how to resolve them</li>
      <li class="bullet">What a fast-forward merge is</li>
      <li class="bullet">What a true merge is </li>
    </ul>
    <p class="normal">Let's start with an overview of merging.</p>
    <h1 id="_idParaDest-82" class="title">Merging overview</h1>
    <p class="normal">If you are on a feature branch, and the feature is sufficiently complete and tested, you will want to merge <a id="_idIndexMarker126"/>your branch back into the main branch. Some <a id="_idIndexMarker127"/>organizations let you simply merge, others (most?) require that you create a <strong class="screenText">Pull Request (PR)</strong>. A <strong class="keyword">PR</strong> says, essentially, "Please examine my code and if you think it is right, merge it into the main branch."</p>
    <p class="normal">Having a second (or third) set of eyes on your code before merging can save a lot of headaches later on (see <em class="chapterRef">Chapter 12</em>, <em class="italic">Fixing Mistakes (Undo)</em>, on fixing mistakes).</p>
    <p class="normal">Often, if you've <a id="_idIndexMarker128"/>been careful (see below) you will merge without a problem. From time to time, however, you will run into the dreaded merge conflict. You'll see below a couple ways to handle that conflict.</p>
    <h2 id="_idParaDest-83" class="title">Book</h2>
    <p class="normal">You will remember from the previous chapter that we have a directory, <code class="Code-In-Text--PACKT-">C:\GitHub\VisualStudio\ProGitForProgrammers</code>, that is the home of the Books application and that we've been editing in Visual Studio. Of course, we don't have to manage it in Visual Studio; we can use any of our tools. For example, I can open the terminal and change directories to the Books app:</p>
    <figure class="mediaobject"><img src="img/B17741_04_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.1: Opening the terminal</p>
    <p class="normal">Notice that it says I have one commit to push (as indicated by the up-pointing arrow followed by the 1). I must have forgotten to do so the last time I was working with this code. I don't want to just push it, however—who knows what's in there? There are a few ways to find out.</p>
    <h1 id="_idParaDest-84" class="title">What's in that push?</h1>
    <p class="normal">From the <a id="_idIndexMarker129"/>command line, we can use the <code class="Code-In-Text--PACKT-">git show</code> command:</p>
    <figure class="mediaobject"><img src="img/B17741_04_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.2: Examining the push</p>
    <p class="normal">There's a lot of information here. First, we see the author and the date. Then we see the message that <a id="_idIndexMarker130"/>was attached to this commit (<code class="Code-In-Text--PACKT-">Add properties</code>). Next, Git does a <code class="Code-In-Text--PACKT-">diff</code> (difference) between <code class="Code-In-Text--PACKT-">Book.cs</code> and <code class="Code-In-Text--PACKT-">Book.cs</code> naming the first one <strong class="screenText">a</strong> and the second <strong class="screenText">b</strong>. The one labeled <strong class="screenText">a</strong> is <code class="Code-In-Text--PACKT-">Book.cs</code> before this commit, the one labeled <strong class="screenText">b</strong> is the new contents in this commit.</p>
    <p class="normal">You may have noticed the line that says <code class="Code-In-Text--PACKT-">/dev/null</code>. This indicates that a file is being compared against nothing, and thus everything is new.</p>
    <p class="normal">The next line shows that <code class="Code-In-Text--PACKT-">/dev/null</code> is being compared against file <strong class="screenText">b</strong> (the new <code class="Code-In-Text--PACKT-">Book.cs</code> file):</p>
    <figure class="mediaobject"><img src="img/B17741_04_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.3: Comparing against dev/null</p>
    <p class="normal">What follows are the changes. Deletions will be marked in red, modifications in green, and new code in yellow. (This display and these colors may depend on which shell you are using.) We see here that three <code class="Code-In-Text--PACKT-">using</code> statements, a namespace, and the class <code class="Code-In-Text--PACKT-">Book</code> were all added in this commit. Before we push it, let's see what we can learn in Visual Studio.</p>
    <h2 id="_idParaDest-85" class="title">Visual Studio</h2>
    <p class="normal">Opening the <a id="_idIndexMarker131"/>same directory in Visual Studio and going to the Git view reveals, as we would expect, that we have one commit to push (outgoing):</p>
    <figure class="mediaobject"><img src="img/B17741_04_04.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.4: Visual Studio showing one file to push</p>
    <p class="normal">Before we push, let's see what's in that push. Clicking on <strong class="screenText">1 outgoing</strong> opens two windows. The <strong class="screenText">Branches</strong> window shows us which branch we are on (<strong class="screenText">Book</strong>):</p>
    <figure class="mediaobject"><img src="img/B17741_04_05.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.5: Visual Studio showing contents of the local repository</p>
    <p class="normal">The middle panel has the really cool info. It tells you the local (as opposed to origin) history of your branches:</p>
    <figure class="mediaobject"><img src="img/B17741_04_06.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.6: Visual Studio showing commit history</p>
    <p class="normal">We can see that <strong class="screenText">main</strong> has five commits (reading newest to oldest) and that preceding the newest commit in <strong class="screenText">main</strong>, we have an outgoing commit on the <strong class="screenText">Book</strong> branch, whose message is <strong class="screenText">Add properties</strong>. This is consistent with what we saw at the command line.</p>
    <p class="normal">We can go <a id="_idIndexMarker132"/>further, and return to <strong class="screenText">Solution Explorer</strong>. Because there is more to see in <code class="Code-In-Text--PACKT-">Program.cs</code> (rather than <code class="Code-In-Text--PACKT-">Book.cs</code>), right-click on <code class="Code-In-Text--PACKT-">Program.cs</code> and choose <strong class="screenText">Git</strong> and then <strong class="screenText">History</strong>. That opens the <strong class="screenText">History</strong> page for <code class="Code-In-Text--PACKT-">Program.cs</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_07.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.7: Visual Studio showing the history of Program.cs</p>
    <div><p class="Information-Box--PACKT-">Note that if we registered a user with an image, that image would be shown on the extreme left.</p>
    </div>
    <p class="normal">Here we see the four commits. We can compare them by right-clicking on, for example, the first one and choosing <strong class="screenText">Compare with previous</strong>. Two windows open. On the left, you have the older commit, on the right the newer. We can see that in the newer commit one line was added, which is shown in Visual Studio with green highlighting:</p>
    <figure class="mediaobject"><img src="img/B17741_04_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.8: Side-by-side comparison</p>
    <p class="normal">You can <a id="_idIndexMarker133"/>see that Visual Studio can give you a graphic representation of the same information you might get from the command line.</p>
    <h2 id="_idParaDest-86" class="title">Details, details</h2>
    <p class="normal">Let's close <a id="_idIndexMarker134"/>all these history windows and go back to the list of outgoing and local history. Under <strong class="screenText">Outgoing</strong>, we see <strong class="screenText">Add properties</strong>. Right-click on that line and a window will open on the right. You'll see the commit ID (ID) along with the name of the committer, the date, and so forth. You'll also see the message and then you'll see a list of which files were changed (in this case, <strong class="screenText">Book.cs</strong>):</p>
    <figure class="mediaobject"><img src="img/B17741_04_09.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.9: Visual Studio showing which files have changed for a commit</p>
    <p class="normal">We want to <a id="_idIndexMarker135"/>know what changed in <code class="Code-In-Text--PACKT-">Book.cs</code>. To do this, right-click on <code class="Code-In-Text--PACKT-">Book.cs</code> and choose <strong class="screenText">View History</strong>. The single commit will come up in the middle window. Double-click on that and you'll see the <code class="Code-In-Text--PACKT-">Book</code> class that is being added by this commit.</p>
    <h1 id="_idParaDest-87" class="title">GitHub Desktop</h1>
    <p class="normal">We can open <a id="_idIndexMarker136"/>GitHub Desktop to the same directory. Click on <strong class="screenText">File</strong> and choose <strong class="screenText">Add local repository...</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.10: Opening GitHub Desktop</p>
    <p class="normal">The next step is to tell GitHub Desktop where that repository is. A dialog opens and you can either enter the local path by hand, or you can click <strong class="screenText">Choose...</strong>, which will bring you to a Windows Explorer window where you can pick the appropriate directory. Once that is all set, click <strong class="screenText">Add repository</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_11.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.11: Adding a local repository</p>
    <p class="normal">You'll now be brought to the main page. Notice that we are still in the repository <strong class="screenText">ProGitForProgrammers</strong>, but on the <strong class="screenText">Book</strong> branch, and that it knows we have one commit to push. It also offers a handy <strong class="screenText">Push origin</strong> button with an explanation that pressing <a id="_idIndexMarker137"/>that button will push the commit to the origin (the server; your repository on GitHub):</p>
    <figure class="mediaobject"><img src="img/B17741_04_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.12: GitHub Desktop information bar</p>
    <p class="normal">Once again, we want to know what we are pushing. No problem, just click <strong class="screenText">History</strong> and you'll see the history of commits and the changes for whichever commit you highlight:</p>
    <figure class="mediaobject"><img src="img/B17741_04_13.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.13: History in GitHub Desktop</p>
    <p class="normal">Now that <a id="_idIndexMarker138"/>we've seen the various ways the command line, Visual Studio, and GitHub Desktop manage the commit, it is time to get the commit to the server.</p>
    <h2 id="_idParaDest-88" class="title">Push it already</h2>
    <p class="normal">Let's return <a id="_idIndexMarker139"/>to the command line and push the commit we've been examining:</p>
    <figure class="mediaobject"><img src="img/B17741_04_14.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.14: Pushing from the command line</p>
    <p class="normal">If you go to Visual Studio now, it should say <strong class="screenText">0 outgoing</strong> as you've pushed the one that was waiting. Similarly, GitHub Desktop will have changed its button from <strong class="screenText">Push Origin</strong> to <strong class="screenText">Create Pull Request</strong> – the likely next thing to do. </p>
    <p class="normal">Now that we have the <code class="Code-In-Text--PACKT-">Book</code> branch sorted, it is (finally!) time to merge it into <strong class="screenText">main</strong>.</p>
    <h2 id="_idParaDest-89" class="title">Visual Studio</h2>
    <p class="normal">Our goal is to merge <code class="Code-In-Text--PACKT-">Book</code> back into <code class="Code-In-Text--PACKT-">main</code>. To do this in Visual Studio, just click on <strong class="screenText">Git</strong> and then <a id="_idIndexMarker140"/>on <strong class="screenText">Manage Branches</strong>. Your <strong class="screenText">Branches</strong> window will open. Right-click on <strong class="screenText">main</strong> and choose <strong class="screenText">Checkout</strong>. You are now ready to merge <code class="Code-In-Text--PACKT-">Book</code> into <code class="Code-In-Text--PACKT-">main</code>, which you'll see in the right-click (context) menu as well:</p>
    <figure class="mediaobject"><img src="img/B17741_04_15.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.15: Merging in Visual Studio</p>
    <p class="normal">The trick is, while main is checked out, right-click on <strong class="screenText">Book</strong> and you'll see the option to make the merge.</p>
    <h1 id="_idParaDest-90" class="title">Merge conflicts</h1>
    <p class="normal">Let's turn to <a id="_idIndexMarker141"/>the command line and do a pull as our branch has diverged from the origin. When we do, we're told that there is a merge conflict in <code class="Code-In-Text--PACKT-">Program.cs</code> and that the merge has failed. Git tells you to fix the conflicts and then commit the result. This is unusual, to get a merge conflict on a pull, but as you can see, it does happen. Let's handle this conflict and then set up a more typical situation:</p>
    <figure class="mediaobject"><img src="img/B17741_04_16.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.16: A merge conflict</p>
    <p class="normal">There are a <a id="_idIndexMarker142"/>few ways to handle any merge, but the easiest is to use a merge tool. I use KDiff3 (<a href="https://sourceforge.net/projects/kdiff3/">https://sourceforge.net/projects/kdiff3/</a>). Since I use this a lot, I have put it into my config file:</p>
    <pre class="programlisting con"><code class="hljs-con">git config --edit --global 
</code></pre>
    <figure class="mediaobject"><img src="img/B17741_04_17.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.17: Reviewing the configuration file</p>
    <p class="normal">This sets up KDiff3 as my merge tool and tells Git where to find it. One of the things I like most about KDiff is that it will often fix the problem for you.</p>
    <p class="normal">To invoke it, all I need to write is:</p>
    <pre class="programlisting con"><code class="hljs-con">git mergetool
</code></pre>
    <p class="normal">and it opens KDiff to the conflict.</p>
    <p class="normal">Here it found two problems and was able to fix one:</p>
    <figure class="mediaobject"><img src="img/B17741_04_18.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.18: KDiff automatically solves one conflict</p>
    <p class="normal">It then brings <a id="_idIndexMarker143"/>us to a window with multiple panes. The panes on top show you the conflict:</p>
    <figure class="mediaobject"><img src="img/B17741_04_19.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.19: Conflicts as shown in KDiff</p>
    <p class="normal">You can see on the left side (<strong class="screenText">Local</strong>) that we have one line whereas on the right side (<strong class="screenText">Remote</strong>) we have two lines. Clearly, someone else has edited this file that we edited and now Git doesn't know what to do.</p>
    <p class="normal">In the bottom pane is code to provide context and then a highlighted line where your choice of which line(s) to place there is shown:</p>
    <figure class="mediaobject"><img src="img/B17741_04_20.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.20: KDiff provides context for your merge</p>
    <p class="normal">When you right-click on that line, you are given a choice to pick the left window (window A), the right window (window B), or both (and you can choose the order they are added in):</p>
    <figure class="mediaobject"><img src="img/B17741_04_21.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.21: KDiff asking which version should be placed</p>
    <p class="normal">Once you <a id="_idIndexMarker144"/>are done, save the file and close KDiff. &lt;poof\&gt; No more conflict. Git now shows you the changes you made that should now be committed:</p>
    <figure class="mediaobject"><img src="img/B17741_04_22.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.22: Console indicating that the conflicts have been resolved</p>
    <p class="normal">You can now add that file and commit it, and then push it up to the origin:</p>
    <figure class="mediaobject"><img src="img/B17741_04_23.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.23: Committing and pushing to origin</p>
    <p class="normal">We've seen <a id="_idIndexMarker145"/>how KDiff and similar programs can greatly reduce the amount of work involved in solving merge conflicts.</p>
    <h2 id="_idParaDest-91" class="title">Merging from the command line</h2>
    <p class="normal">Much more common is for there to be a merge conflict when you specifically merge locally. To do <a id="_idIndexMarker146"/>so is pretty easy. From the command line, check out the branch you want to merge <strong class="screenText">into</strong> (<code class="Code-In-Text--PACKT-">main</code>) and then use the Git command <code class="Code-In-Text--PACKT-">merge</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_24.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.24: The merge command</p>
    <p class="normal">Here Git used the "recursive" strategy; a way to speed up the merge.</p>
    <h2 id="_idParaDest-92" class="title">Fast forward</h2>
    <p class="normal">Often, however, you'll <a id="_idIndexMarker147"/>see Git report that it used a fast forward merge. Fast forward works like this; suppose your starting point is this:</p>
    <figure class="mediaobject"><img src="img/B17741_04_25.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.25: Fast forward</p>
    <p class="normal">You now want to merge <strong class="keyword">Feature1</strong> into <strong class="keyword">Main</strong>. Notice that <strong class="keyword">Feature1</strong> branched from the tip of <strong class="keyword">Main </strong>(the latest commit). In that case, there is a path from the first commit in <strong class="keyword">Main </strong>to the <a id="_idIndexMarker148"/>last commit in <strong class="keyword">Feature1</strong>. In that case, all Git has to do is move <strong class="keyword">Main</strong>'s pointer to the tip of <strong class="keyword">Feature1</strong>, creating a single branch (which it will call <strong class="keyword">Main</strong>):</p>
    <figure class="mediaobject"><img src="img/B17741_04_26.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.26: Moving the pointer</p>
    <p class="normal">Because all that <a id="_idIndexMarker149"/>is required is moving a pointer to the last commit, this is called <strong class="keyword">fast forward</strong>.</p>
    <h2 id="_idParaDest-93" class="title">True merge</h2>
    <p class="normal">In the previous example, <strong class="keyword">Feature1</strong> was branched off of <strong class="keyword">Main</strong> at the point that is still the tip of <strong class="keyword">Main</strong>. But what <a id="_idIndexMarker150"/>if someone else merged a branch into <strong class="keyword">Main</strong>, and now the commit you branched off of is no longer the tip:</p>
    <figure class="mediaobject"><img src="img/B17741_04_27.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.27: Feature 1 does not branch off the tip of Main</p>
    <p class="normal">In this case, you either need a rebase (covered in the next chapter) or a "true" merge:</p>
    <figure class="mediaobject"><img src="img/B17741_04_28.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.28: A true merge is required</p>
    <p class="normal">Because there was no path from <strong class="keyword">Main</strong> to the tip of <strong class="keyword">Feature1</strong> that didn't leave out any other commits (for example, the tip of <strong class="keyword">Main</strong>), we use a new commit to bring the two branches together.</p>
    <p class="normal">Notice that <a id="_idIndexMarker151"/>this approach adds a new commit (<strong class="keyword">A</strong>) that exists only for the merge. Over time you will have a lot of these relatively meaningless commits cluttering up your history. The solution to this is to rebase, as shown in the next chapter.</p>
    <p class="normal">You don't change anything when doing a fast forward or a true merge; you merge and Git takes care of the details</p>
    <h1 id="_idParaDest-94" class="title">Avoiding conflicts</h1>
    <p class="normal">Avoiding conflict is generally a good thing to do, and in the case of Git, it is a very good thing indeed. Rather than having to resolve a whole lot of conflicts all at once, you really want to catch <a id="_idIndexMarker152"/>those conflicts as you go (and thus handle just one or two at a time). If you are on a team, some conflicts cannot be avoided, but there are two good rules of thumb to cut down drastically on the work involved in handling conflicts:</p>
    <ul>
      <li class="bullet">Do not have more than one programmer working on any given file (if possible)</li>
      <li class="bullet">Merge main into your feature branch very frequently</li>
    </ul>
    <p class="normal">Notice #2 does <em class="italic">not</em> say to merge your feature branch into main, but rather the other way around. This will <a id="_idIndexMarker153"/>not endanger the main thread, but will quickly reveal if there are any conflicts so far. If so, you can fix them in your branch and move on.</p>
    <h1 id="_idParaDest-95" class="title">Summary</h1>
    <p class="normal">In this chapter, you saw:</p>
    <ul>
      <li class="bullet">How to merge branches</li>
      <li class="bullet">The different types of merges</li>
      <li class="bullet">How to merge conflicts</li>
      <li class="bullet">How tools like KDiff can make merging easier</li>
      <li class="bullet">What a pull request is</li>
      <li class="bullet">What a fast forward merge is</li>
      <li class="bullet">What a true merge is</li>
    </ul>
    <h1 id="_idParaDest-96" class="title">Challenge</h1>
    <p class="normal">Pretend you are two programmers working on the same project – a utility that contains a calculator and a Fahrenheit to Celsius converter. If you actually have two programmers to do this, even better.</p>
    <p class="normal">Set up a new repository and clone it to two different folders. Have one person populate the main branch with the beginnings of the UtilityKnife project, commit the changes, and push it. Have the other person pull the main branch's changes.</p>
    <p class="normal">OK, you both have a main branch with some code on it. Now have each programmer create their own branch, one to work on the calculator and the other to work on the converter. Along the way, the converter will want to use some of the methods of the calculator. Try to avoid or minimize conflicts, merge frequently, and resolve conflicts that arise.</p>
    <h1 id="_idParaDest-97" class="title">Answer</h1>
    <p class="normal">As always, there is no one single correct way to do this. Here is how I worked through it.</p>
    <h2 id="_idParaDest-98" class="title">Task #1: Set up a new repository and clone it to two different folders</h2>
    <p class="normal">Notice that we are going to use just one repository. We are building a single program, but at least at first John<strong class="screenText"> </strong>is going to create the calculator while Sara is going to create the temperature converter. We'll call the entire program <strong class="keyword">UtilityKnife</strong>. To begin we go to <a href="http://GitHub.com">GitHub.com</a> and create our new repository:</p>
    <figure class="mediaobject"><img src="img/B17741_04_29.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.29: Creating the new repository</p>
    <div><p class="Information-Box--PACKT-">The readme file is written using Markdown. You can learn more about Markdown at <a href="https://www.markdownguide.org/cheat-sheet/">https://www.markdownguide.org/cheat-sheet/</a> among other places on the net.</p>
    </div>
    <p class="normal">We then clone the repo into folders (or separate computers if there are two or more of you). I'll create a directory, <code class="Code-In-Text--PACKT-">John</code>, and clone this repo into that directory.</p>
    <figure class="mediaobject"><img src="img/B17741_04_30.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.30: Cloning from the command line</p>
    <p class="normal">John has chosen to use the command line. Sara, on the other hand, likes to use Visual Studio.</p>
    <p class="normal">Begin by clicking on <strong class="screenText">File</strong> and selecting <strong class="screenText">Clone Repository...</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_31.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.31: Opening the Git menu</p>
    <p class="normal">That will bring up a dialog box where you can paste in the path you took from <a href="http://GitHub.com">GitHub.com</a> and the path to your new repo:</p>
    <figure class="mediaobject"><img src="img/B17741_04_32.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.32: Cloning from Visual Studio</p>
    <p class="normal">Click the <strong class="screenText">Clone</strong> button, and Visual Studio will set up your cloned repository.</p>
    <p class="normal">Solution Explorer validates that you have cloned the repository and brought down the three files from GitHub:</p>
    <figure class="mediaobject"><img src="img/B17741_04_33.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.33: Solution Explorer shows results of the clone</p>
    <h2 id="_idParaDest-99" class="title">Task #2: Have one person populate the main branch with the beginnings of UtilityKnife, commit the changes, and push it</h2>
    <p class="normal">We'll have Sara create a new solution in her directory for the UtilityKnife program:</p>
    <figure class="mediaobject"><img src="img/B17741_04_34.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.34: Creating the program</p>
    <p class="normal">When the project is completed, she adjusts <code class="Code-In-Text--PACKT-">Program.cs</code> to be the skeleton of all that is to come:</p>
    <pre class="programlisting code"><code class="hljs-code">namespace UtilityKnife
{
    public static class Program
    {
        static void Main(string[] args)
        {
            // skeleton program
        }
    }
}
</code></pre>
    <p class="normal">With this in place, she will commit these changes using the <strong class="screenText">Git</strong> menu:</p>
    <figure class="mediaobject"><img src="img/B17741_04_35.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.35: The Git menu in Visual Studio</p>
    <p class="normal">This will open the commit window, where you can fill in the commit message, and then click <strong class="screenText">Commit All</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_36.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.36: The Git Changes menu in Visual Studio</p>
    <p class="normal">Once you do, the view will change to remove the files and commit message and will confirm the commit and show that there is one commit ready to be pushed:</p>
    <figure class="mediaobject"><img src="img/B17741_04_37.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.37: Commit confirmation in Visual Studio</p>
    <p class="normal">That is just what we want, so click on the upload button (the up-pointing arrow) and push the commit to the repo on GitHub.</p>
    <p class="normal">It verifies your success and offers to create a Pull Request for you, which we do not want right now:</p>
    <figure class="mediaobject"><img src="img/B17741_04_37.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.38: After commit Visual Studio indicates there is one file to push</p>
    <p class="normal">Sara now has the starting main branch and is ready to create a feature branch. Before we look at that, let's have John bring down the main branch as well:</p>
    <figure class="mediaobject"><img src="img/B17741_04_39.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.39: Pulling the repository from origin</p>
    <p class="normal">This is a somewhat complex screenshot. We start by seeing that within <code class="Code-In-Text--PACKT-">C:\GitHub\John</code> there is a folder called <code class="Code-In-Text--PACKT-">UtilityKnife</code>. We change to that directory and then do a <code class="Code-In-Text--PACKT-">git pull</code>. The result is the retrieval of the files for the <code class="Code-In-Text--PACKT-">UtilityKnife</code> program.</p>
    <p class="normal">Now both John and Sara have the same starter program for UtilityKnife.</p>
    <h2 id="_idParaDest-100" class="title">Task #3: Each programmer creates a feature branch. Each programmer then puts the beginning of their feature into their branch, committing frequently (more frequently than you would in "real life")</h2>
    <p class="normal">John, who uses the command line, starts his feature branch by using the <code class="Code-In-Text--PACKT-">checkout -b</code> command, which both creates a new branch and checks it out:</p>
    <figure class="mediaobject"><img src="img/B17741_04_40.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.40: Creating a new branch at the command line</p>
    <p class="normal">He is now ready to start coding. Let's create a folder, and then within that folder, the skeleton of our class and its first method:</p>
    <pre class="programlisting code"><code class="hljs-code">namespace UtilityKnife.Converters
{
    public class FahrenheitToCelsius
    {
        public double FahrenheitToCelsiusConverter(double FahrenheitTemp)
        {
            double _fahreneithTemp = 0.0;
            double _celsius = 0.0;
            return _celsius;
        }
    }
}
</code></pre>
    <p class="normal">Let's save and commit this:</p>
    <figure class="mediaobject"><img src="img/B17741_04_41.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.41: Committing from the command line</p>
    <p class="normal">We begin by taking a status that shows us that we have one untracked file. We add that file (remember that <code class="Code-In-Text--PACKT-">add .</code> means add all the untracked and modified files to the index), and then we commit it, adding a message. Uh oh, the commit message is misspelled. Let's fix that with a new command: <code class="Code-In-Text--PACKT-">amend</code>. Since we have not pushed, all we have to do is enter <code class="Code-In-Text--PACKT-">--amend</code> and use <code class="Code-In-Text--PACKT-">-m</code> for the revised message:</p>
    <figure class="mediaobject"><img src="img/B17741_04_42.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.42: Using the amend flag</p>
    <p class="normal">Notice the second line reflects back the change, and if we use <code class="Code-In-Text--PACKT-">log</code> to see the commits, we'll see that the commit now is spelled correctly:</p>
    <figure class="mediaobject"><img src="img/B17741_04_43.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.43: Using log to see the commit</p>
    <p class="normal">John decides to push his commit from his local repository up to the origin (the GitHub repo). When he tries, however, Git tells him that the server doesn't know about his branch, but it helpfully gives him the right command to use:</p>
    <figure class="mediaobject"><img src="img/B17741_04_44.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.44: Trying to push but failing. Git helps.</p>
    <p class="normal">Meanwhile, Sara has begun work on the <code class="Code-In-Text--PACKT-">Calculator</code> class.</p>
    <h3 id="_idParaDest-101" class="title">Sara and the Calculator</h3>
    <p class="normal">Within Visual Studio, she clicks on the <strong class="screenText">Git</strong> menu choice and then <strong class="screenText">new branch</strong>. A dialog opens, and note that it assumes you want to branch off of <strong class="screenText">main</strong> (though if you have multiple branches, you can of course branch off of any of them):</p>
    <figure class="mediaobject"><img src="img/B17741_04_45.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.45: Creating a new branch</p>
    <p class="normal">She is ready now to code, and whatever she writes will not affect John's code (or the code on main). You can verify that she can't even see John's work. They are on different (and thus isolated) feature branches.</p>
    <p class="normal">She will add the skeleton of a <code class="Code-In-Text--PACKT-">Calculator</code> class within its own folder.</p>
    <pre class="programlisting code"><code class="hljs-code">namespace UtilityKnife.Calculator
{
    public class Calculator
    {
        public static int Add (int x, int y)
        {
            return x + y;
        }
    }
}
</code></pre>
    <p class="normal">Sara will now check this in, but unlike John, she will not push it up to the server. Thus, it will be in her local repository only.</p>
    <p class="normal">After selecting <strong class="screenText">Git</strong> | <strong class="screenText">Commit </strong>or<strong class="screenText"> Stash</strong>, she enters her message and clicks <strong class="screenText">Commit All</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_46.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.46: Committing all</p>
    <p class="normal">As noted above, this puts her commit into the local repository.</p>
    <h2 id="_idParaDest-102" class="title">Task #4: Merge the main branch into the feature branch frequently to ensure that if there are conflicts, you catch them early</h2>
    <p class="normal">John wants to merge main into his branch to ensure that he catches bugs early. To do this, he switches to main, updates by issuing a <code class="Code-In-Text--PACKT-">pull</code> request, and then switches back to his feature branch and enters <code class="Code-In-Text--PACKT-">merge main</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_47.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.47: Main already up to date</p>
    <p class="normal">No problem here. Main hasn't changed since we branched off of it, so <code class="Code-In-Text--PACKT-">temperatureConverter</code> is fully up to date. </p>
    <p class="normal">Now, suppose John decides to merge his feature branch into main. Whether or not this is wise, all he has to do is reverse the merge order:</p>
    <figure class="mediaobject"><img src="img/B17741_04_48.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.48: Reversing the merge order</p>
    <p class="normal">The key line here is: </p>
    <pre class="programlisting con"><code class="hljs-con">git merge temperatureConverter
</code></pre>
    <p class="normal">We are on the main branch, and this merges the feature branch into main. You can see that Git is able to fast-forward the merge, as described in a previous chapter.</p>
    <p class="normal">John is now free to continue with his existing feature branch or to create a new one. If, on the other hand, he had to do a Pull Request and then wait for his PR to be approved before it is really merged, he would be wise to make a new branch, possibly off of <code class="Code-In-Text--PACKT-">temperatureConverter</code>.</p>
    <p class="normal">Sara had taken a break but she's ready to go back to work. Being cautious, she wants first to merge main into her feature branch to make sure there are no conflicts. Remember, John and Sara may work well together but they are not telling each other every time they commit or merge.</p>
    <p class="normal">To start, Sara checks out main and does a <code class="Code-In-Text--PACKT-">pull</code> to get the latest files from main. Now she checks out <strong class="screenText">Calculator</strong> and right-clicks on <strong class="screenText">main</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_49.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.49: Merging main into Calculator in Visual Studio</p>
    <p class="normal">She will select <strong class="screenText">Merge 'main' into 'Calculator'</strong>. Once again, doing so will <em class="italic">not</em> merge her changes into main, but simply retrieve the newest version of main and merge that into her feature branch.</p>
    <p class="normal">Since Visual Studio is cautious, it will ask you if you are sure.</p>
    <figure class="mediaobject"><img src="img/B17741_04_50.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.50: Visual Studio checks that what you are about to do is what you want to do</p>
    <p class="normal">Clicking <strong class="screenText">Yes</strong> will begin the merge. Now, remember that John had done some work, and then merged his branch into main. Since there were no conflicts, Visual Studio just tells Sara that the merge was successful:</p>
    <figure class="mediaobject"><img src="img/B17741_04_51.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.51: Visual Studio signals success</p>
    <p class="normal">Of course, merging main into Calculator will change Calculator, bringing in everything in main. The key thing in main is what John merged, and we see that in Calculator now:</p>
    <figure class="mediaobject"><img src="img/B17741_04_52.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.52: Examining the result of the merges in Visual Studio</p>
    <p class="normal">Note that since Sara has not merged her code into main, John has no awareness of, nor way to get to, the <code class="Code-In-Text--PACKT-">Calculator</code> class. If we open Visual Studio in John's branch, we see <strong class="screenText">Converters</strong> but no <strong class="screenText">Calculator</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_53.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.53: John's branch with no Calculator</p>
    <p class="normal">Let's pause a moment and think about what is happening on GitHub. Sara has committed her changes but not pushed them, so GitHub won't know about her branch. John has pushed his changes and also merged them into main. We would anticipate two branches on GitHub, one for main and one for John; what's more, at this point, main and John should be identical, and Sara should have a branch on GitHub:</p>
    <figure class="mediaobject"><img src="img/B17741_04_54.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.54: The branches on origin</p>
    <p class="normal">Main has <strong class="screenText">Converters </strong>(from John's merge) but not Calculator (because Sara has not merged). John's branch (<strong class="screenText">temperatureConverter</strong>) is identical:</p>
    <figure class="mediaobject"><img src="img/B17741_04_55.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.55: Changing branches on origin</p>
    <p class="normal">To drive this home, we can ask GitHub for a list of all the branches it knows about:</p>
    <figure class="mediaobject"><img src="img/B17741_04_56.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.56: Asking GitHub to list all the branches</p>
    <div><p class="Information-Box--PACKT-">These all show as updated by me because Sara and John don't really exist.</p>
    </div>
    <h2 id="_idParaDest-103" class="title">Task #5: John is building the temperature converter. Have him "borrow" code from the calculator. See if there are merge conflicts</h2>
    <p class="normal">In the next four commits, Sara fleshes out the calculator with subtraction, multiplication, integer division, and division. She has not yet pushed her changes:</p>
    <figure class="mediaobject"><img src="img/B17741_04_57.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.57: Fleshing out the calculator</p>
    <p class="normal">The formula for converting Fahrenheit to Celsius is:</p>
    <p class="normal"><em class="italic">(F – 32) * 5/9</em></p>
    <p class="normal">John wants to convert 212° Fahrenheit (the boiling point of water) and expects to get back 100° Celsius as a good test case. To do this, he could use the built-in subtraction and division operators but instead chooses to use Sara's calculator. His first attempt is to merge main into his branch:</p>
    <figure class="mediaobject"><img src="img/B17741_04_58.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.58: Merging main into the working branch</p>
    <p class="normal">Main is up to date and there is no difference between main and <code class="Code-In-Text--PACKT-">temperatureConverter</code>. Yet John doesn't have the functions he needs. This tells John that the calculator functions he needs are not yet pushed to GitHub. He can call Sara and ask her to push them so that he can pull them down, or she can merge them into main and then he can update from main. Sara is not ready to merge into main, but agrees to push her branch's commits.</p>
    <p class="normal">She has four outgoing commits (that is, commits that have not yet been pushed to the origin):</p>
    <figure class="mediaobject"><img src="img/B17741_04_59.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.59: Visual Studio indicates four outgoing commits</p>
    <p class="normal">To push these, she just clicks on the up arrow:</p>
    <figure class="mediaobject"><img src="img/B17741_04_60.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.60: The push button in Visual Studio</p>
    <p class="normal">John tries to bring down the changes but runs into a brick wall.</p>
    <figure class="mediaobject"><img src="img/B17741_04_61.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.61: Unable to see Calculator</p>
    <p class="normal">His local repository has never heard of the branch <strong class="screenText">Calculator</strong>. There are a couple of ways to solve this but the easiest is to ask Sara to merge her work into <strong class="screenText">main</strong>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_62.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.62: Merging Calculator into main</p>
    <div><p class="Information-Box--PACKT-">When Sara merges Calculator into main, she does so <em class="italic">locally</em>. She still has to push these changes to the origin to do John any good. She pushes as she would any commit.</p>
    </div>
    <p class="normal">John is now ready to <code class="Code-In-Text--PACKT-">pull</code> these changes. Once he does, he realizes that Sara has used integers and he needs doubles. He modifies the <code class="Code-In-Text--PACKT-">Calculator</code> class to use doubles, and while he is at it, he makes all the methods (and the class) static. (If you're not familiar with C#, don't worry about what that means; the important thing is that he's made a change)</p>
    <pre class="programlisting code"><code class="hljs-code">namespace UtilityKnife.Calculator
{
    public static class Calculator
    {
        public static double Add(double x, double y)
        {
            return x + y;
        }
        public static double Subtract(double x, double y)
        {
            return x - y;
        }
        public static double Multiply(double x, double y)
        {
            return x * y;
        }
        public static int Division (int x, int y)
        {
            return x / y;
        }
        public static double Division (double x, double y)
        {
            return x / y;
        }
    }
}
</code></pre>
    <figure class="mediaobject"><img src="img/B17741_04_63.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.63: Pull the changes for the branch</p>
    <p class="normal">The second line says that we're starting out with main up to date with <code class="Code-In-Text--PACKT-">origin/main</code>. However, when we do a <code class="Code-In-Text--PACKT-">pull</code>, the local Git finds objects to bring down for main. There are 22 objects. Why 22 when there were only 4 commits? Some of these objects are used internally by Git.</p>
    <p class="normal">Later, we see that the merge was a fast forward, and the next line shows that there were 29 additions and no modifications or deletions (if you count the + marks, you'll find that there are 29). This is followed by the confirmation that 1 file changed with 29 insertions.</p>
    <p class="normal">John is almost there. His local copy of main now has what he needs, but it is on the wrong branch. The solution is to merge main into <code class="Code-In-Text--PACKT-">temperatureConverter</code>.</p>
    <p class="normal">Because the order of which branch is being merged into the other matters, I always look it up on Stack Overflow:</p>
    <figure class="mediaobject"><img src="img/B17741_04_64.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.64: Stack Overflow advice</p>
    <p class="normal">These are exactly the steps John needs to take:</p>
    <figure class="mediaobject"><img src="img/B17741_04_65.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.65: Merging</p>
    <p class="normal">The last two lines indicate that <code class="Code-In-Text--PACKT-">Calculator</code> has been brought over with the merge and that <code class="Code-In-Text--PACKT-">temperatureConverter</code> has two commits to push to its repo.</p>
    <p class="normal">A quick look at the log shows that <code class="Code-In-Text--PACKT-">HEAD</code>, <code class="Code-In-Text--PACKT-">origin/temperatureConverter</code>, <code class="Code-In-Text--PACKT-">origin/main</code>, <code class="Code-In-Text--PACKT-">origin/HEAD</code>, and <code class="Code-In-Text--PACKT-">origin/Calculator</code> are all pointing to the same commit as main! Thus, John's branch now has access to the <code class="Code-In-Text--PACKT-">Calculator</code> class:</p>
    <figure class="mediaobject"><img src="img/B17741_04_66.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.66: Access to the calculator</p>
    <p class="normal">He can now return to his program and use these static methods:</p>
    <pre class="programlisting code"><code class="hljs-code">namespace UtilityKnife.Converters
{
    public class FahrenheitToCelsius
    {
        public double FahrenheitToCelsiusConverter(double fahrenheitTemp)
        {
            double _celsius = 0.0;
            // (F – 32) * 5/9
            var step1 = Calculator.Calculator.Subtract(fahrenheitTemp, 32);
            var step2 = Calculator.Calculator.Multiplication(step1, 5.0);
            _celsius = Calculator.Calculator.Division(step2, 9.0);
            return _celsius;
        }
    }
}
</code></pre>
    <p class="normal">I agree that this is wicked ugly, but it works, and more importantly, it demonstrates that John's <code class="Code-In-Text--PACKT-">temperatureConverter</code> can use code from <code class="Code-In-Text--PACKT-">Calculator</code>. What's more, John can edit <code class="Code-In-Text--PACKT-">Calculator</code>. We'll see what happens when all this is merged.</p>
    <p class="normal">In jumping back and forth between John and Sara, I did the work in Sara's folder. No harm done, however. We'll just have Sara commit the changes. Uh oh, the changes were made on main. Let's clean all this up. First, on Sara's machine, let's merge main into <code class="Code-In-Text--PACKT-">Calculator</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_67.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.67: Merging main into Calculator in Visual Studio</p>
    <p class="normal">This is just like the previous merges except that now <code class="Code-In-Text--PACKT-">Calculator</code> is the checked-out branch and we right-click on main to get the <strong class="screenText">Merge 'main' into 'Calculator'</strong> option. Now, to ensure that all is right with the world, merge Calculator back into main.</p>
    <p class="normal">At this point, Sara's <code class="Code-In-Text--PACKT-">main</code> and <code class="Code-In-Text--PACKT-">Calculator</code> branches are identical, but John still doesn't have what he needs. Sara can now push main to the origin with a simple push.</p>
    <p class="normal">John can now retrieve main, which should have the changes he needs:</p>
    <figure class="mediaobject"><img src="img/B17741_04_68.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.68: Retrieving main with changes</p>
    <p class="normal">Great, main has what John needs, but he needs it on his branch. No problem, we'll merge main into <code class="Code-In-Text--PACKT-">temperatureConverter</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_04_69.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.69: Merging main into temperatureConverter</p>
    <p class="normal">Let's go look at John's Fahrenheit converter and see if it is now up to date.</p>
    <pre class="programlisting code"><code class="hljs-code">namespace UtilityKnife.Converters
{
    public class FahrenheitToCelsius
    {
        public double FahrenheitToCelsiusConverter(double fahrenheitTemp)
        {
            double _celsius = 0.0;
            // (F – 32) * 5/9
            var step1 = Calculator.Calculator.Subtract(fahrenheitTemp, 32);
            var step2 = Calculator.Calculator.Multiplication(step1, 5.0);
            _celsius = Calculator.Calculator.Division(step2, 9.0);
            return _celsius;
        }
    }
}
</code></pre>
    <p class="normal">We can test that this worked by feeding the method 212 and hoping to get back 100. Let's turn to the program for that:</p>
    <pre class="programlisting code"><code class="hljs-code">using System;
using UtilityKnife.Converters;
namespace UtilityKnife
{
    public static class Program
    {
        static void Main(string[] args)
        {
            var converter = new FahrenheitToCelsius();
            var celsius = converter.FahrenheitToCelsiusConverter(212.0);
            Console.WriteLine($"Fahrenheit temp of 212 is {celsius}.");
        }
    }
}
</code></pre>
    <p class="normal">Let's run our program:</p>
    <figure class="mediaobject"><img src="img/B17741_04_70.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.70: Testing the program</p>
    <p class="normal">We have completed the challenge and managed all our branches. More important, the program works!</p>
  </div>
</body></html>