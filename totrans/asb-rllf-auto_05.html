<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-86"><a id="_idTextAnchor086"/>5</h1>
<h1 id="_idParaDest-87"><a id="_idTextAnchor087"/>Expanding Your Automation Landscape</h1>
<p>It is important to find and apply automation at the right place and at the right level. Usually, when searching for automation use cases, people make mistakes by automating the inappropriate tasks and end up wasting money, effort, and time. This is the reason why we need to analyze the environment and day-to-day tasks and find the best tasks as automation candidates. We can use your statistical data such as event tickets, customer change requests, and project tasks to find this information.</p>
<p>In this chapter, you will learn about the following topics: </p>
<ul>
<li>Finding your automation use cases in your day-to-day work</li>
<li>Automation feasibility and usability</li>
<li>Involving teams in the automation journey</li>
<li>The Ansible dynamic inventory</li>
</ul>
<p>We will start with standard methods to analyze the tasks to find the highest number of tasks and check the feasibility of automation. We will explore the integration opportunities between <strong class="bold">IT service management</strong> (<strong class="bold">ITSM</strong>) tools and Ansible Automation Platform. We will also practice the Ansible dynamic inventory with public clouds such as <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>) and explore the importance of Ansible host variables and group variables.</p>
<h1 id="_idParaDest-88"><a id="_idTextAnchor088"/>Technical requirements</h1>
<p>The following are the technical requirements to proceed with this chapter:</p>
<ul>
<li>A Linux machine as an Ansible control node (with internet access)</li>
<li>One or more Linux machines as managed nodes with Red Hat repositories configured (if you are using non-RHEL machines, then make sure you have appropriate repositories configured to get packages and updates)</li>
<li>Basic knowledge of the AWS platform and an AWS account with one or more test machines created</li>
</ul>
<p>All the Ansible artifacts, playbooks, commands, and snippets for this chapter can be found in the GitHub repository at <a href="https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-05">https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-05</a>.  </p>
<h1 id="_idParaDest-89"><a id="_idTextAnchor089"/>Finding your automation use cases in your day-to-day work</h1>
<p>We all know<a id="_idIndexMarker265"/> that every member of staff working in an IT environment is executing some tasks and most of the time, they repeat the same job every day. Looking around, we can see many examples, as follows:</p>
<ul>
<li>A system engineer is building servers and virtual machines, installing packages, patching old systems, and more.</li>
<li>A network engineer is configuring the new network device and firewall devices, configuring ports <a id="_idIndexMarker266"/>and <strong class="bold">virtual local area networks</strong> (<strong class="bold">VLANs</strong>) based on requests, patching the device firmware, and many other things.</li>
<li>A developer is struggling to build his coding environment every time there is a new version of the programming language or software library. They are also spending a lot of time testing the code and waiting for test results.</li>
<li>A storage administrator is spending their valuable time provisioning the disk space and configuring the storage devices.</li>
<li>A database administrator is complaining about the provisioning delay of a new database server and issues with network or system readiness.</li>
<li>A database user is struggling with the delay on a simple database password resetting task.</li>
<li>The operation team is struggling with the flood of events and alerts and spending their time filtering out the false alerts, resulting in unproductive work.</li>
<li>The <a id="_idIndexMarker267"/>security team is working hard to fix the violations and make sure the systems are compliant with the security standards.</li>
</ul>
<p>The list is not comprehensive; you will be able to find many additional tasks and scenarios in your workplace as well. </p>
<h2 id="_idParaDest-90"><a id="_idTextAnchor090"/>Assessing the tasks</h2>
<p>You can take your daily or <a id="_idIndexMarker268"/>weekly task reports or details from your ITSM systems such as ServiceNow, Remedy, and Jira. For this scenario, we will use the very common tasks undertaken by a platform team, but you can use any tasks, team, or methods for this assessment. We have extracted a report for a week, as shown in <em class="italic">Figure 5.1</em>:</p>
<div><div><img alt="Figure 5.1 – Sample task report " height="662" src="img/B18383_05_01.jpg" width="502"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.1 – Sample task report</p>
<p>We can see <a id="_idIndexMarker269"/>on the chart (<em class="italic">Figure 5.2</em>) the most critical tasks that are taking the most time and effort of systems engineers:</p>
<div><div><img alt="Figure 5.2 – Weekly task summary " height="426" src="img/B18383_05_02.jpg" width="689"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.2 – Weekly task summary</p>
<p>Based on this<a id="_idIndexMarker270"/> very small chart, we can almost identify the tasks needed to automate and save time. </p>
<p>If we check some more details, we can see the source of the task requests (<em class="italic">Figure 5.3</em>) and further scope and opportunities for automation:  </p>
<div><div><img alt="Figure 5.3 – Weekly task source summary " height="373" src="img/B18383_05_03.jpg" width="603"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.3 – Weekly task source summary</p>
<p>Most of the<a id="_idIndexMarker271"/> ITSM tools can integrate with automation tools that will help us to automate the execution trigger from the tools themselves. </p>
<h2 id="_idParaDest-91"><a id="_idTextAnchor091"/>Ansible and ITSM</h2>
<p>For example, when a <a id="_idIndexMarker272"/>user requests a package deployment in a Linux server via the ServiceNow portal, you can configure your Ansible Automation Platform to trigger the package installation job based on the input details from ServiceNow. At the end of the automation job, Ansible will return the results to the ServiceNow ticket and the user who created the ticket can see the details without waiting for the engineer to update the ticket manually.  </p>
<p>Please note that you need either Ansible AWX or Red Hat <strong class="bold">Ansible Automation Platform</strong> (<strong class="bold">AAP</strong>) for this <a id="_idIndexMarker273"/>integration, and this is not possible with a simple Ansible control node alone. </p>
<p><em class="italic">Figure 5.4</em> demonstrates a simple integration with ITSM tools and Ansible AWX or Red Hat AAP. You will learn more about Ansible and ITSM tools integration in <a href="B18383_12.xhtml#_idTextAnchor213"><em class="italic">Chapter 12</em></a>, <em class="italic">Integrating Ansible with Your Tools</em>.</p>
<div><div><img alt="Figure 5.4 – Ansible integration with ITSM tools " height="419" src="img/B18383_05_04.jpg" width="824"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.4 – Ansible integration with ITSM tools</p>
<p class="callout-heading">ITSM Software</p>
<p class="callout">ITSM software <a id="_idIndexMarker274"/>will help organizations track and manage their IT infrastructure operations, resources, and other related usages: <a href="https://www.gartner.com/reviews/market/it-service-management-tools">https://www.gartner.com/reviews/market/it-service-management-tools</a>.</p>
<h2 id="_idParaDest-92"><a id="_idTextAnchor092"/>Automation and Information Technology Infrastructure Library compliance</h2>
<p>When we talk about automated operations using ITSM and automation tools, it is normal for the stakeholders to raise concerns about <strong class="bold">Information Technology Infrastructure Library</strong> (<strong class="bold">ITIL</strong>) practices <a id="_idIndexMarker275"/>and compliances. IT automation does not mean that you need to bypass your organization’s best practices or ITIL processes; instead, you are automating the tasks that a human needs to execute manually and repeatedly. For example, you will still follow the standard change approval process in the ITSM system, and the tool will trigger automation only when the request is approved to execute. </p>
<p>In this section, we have learned some simple methods to find automation use cases from your workspaces. You can break complex operations into small tasks and start with simple automation use cases. We will learn how to study those use cases and convert them into automation candidates in the next section.</p>
<h1 id="_idParaDest-93"><a id="_idTextAnchor093"/>Automation feasibility and usability</h1>
<p>We all need to<a id="_idIndexMarker276"/> understand that not all use cases or repeated jobs are suitable for automation. We need to study and confirm the feasibility of implementing the <a id="_idIndexMarker277"/>use case using Ansible automation. </p>
<p>Once you find the use cases, you can ask yourself several questions to understand the feasibility of implementation and usability of your automation use cases.</p>
<h2 id="_idParaDest-94"><a id="_idTextAnchor094"/>How complex is the use case?</h2>
<p>You need to <a id="_idIndexMarker278"/>Consider the complexity of the use case or workflow you are trying to automate. If the use case is too complex, then you can split it into smaller use cases. You need to start with smaller use cases to avoid any possible delay or obstruction. </p>
<p>For example, if you want to automate the Linux <strong class="bold">operating system</strong> (<strong class="bold">OS</strong>) patching task, then split the job into multiple use cases as follows:</p>
<ol>
<li>Take a virtual machine snapshot.</li>
<li>Back up the configuration.</li>
<li>OS patching tasks.</li>
<li>Verification of the OS after patching and reboot.</li>
<li>Restore snapshot in case of any failure.</li>
</ol>
<p>By doing this, you will get more confidence to start the automation journey and also, different people on your team can contribute to their own domain of expertise.</p>
<h2 id="_idParaDest-95"><a id="_idTextAnchor095"/>Can I reduce human error?</h2>
<p>Consider how <a id="_idIndexMarker279"/>many human mistakes we can avoid by implementing automation for a use case. If the task contains multiple steps, there is a high chance that the engineer will miss some steps or execute typos while implementing the job. Such jobs are good candidates for automation, as you will not need to worry about errors and typos when using automated workflows.</p>
<p>For example, imagine you have a task to deploy a database cluster with hundreds of steps, a sample of which is as follows:</p>
<ol>
<li value="1">Configure the IP address for the cluster nodes.</li>
<li>Install multiple packages on the cluster nodes.</li>
<li>Configure multiple files on the nodes.</li>
<li>Configure clustering and heartbeats.</li>
<li>Configure the virtual IP and virtual interface, and so on.</li>
</ol>
<p>In such cases, you can develop Ansible playbooks to cover each and every task and save enormous amounts of time and effort.</p>
<h2 id="_idParaDest-96"><a id="_idTextAnchor096"/>Can I reduce the deployment time and speed up my tasks?</h2>
<p>It is a proven <a id="_idIndexMarker280"/>fact that automation can improve the speed of your tasks, deployment, and deliveries. Automation can significantly reduce the time required for an operation, as a single trigger can complete the entire workflow and the engineer doesn’t need to observe the monitor or console for errors and status updates. </p>
<p>So, you should ask yourself about the use case and whether you can save time or not by automating this task. </p>
<p>For example, if you <a id="_idIndexMarker281"/>are automating the OS patching task using Ansible, you can trigger the patching for hundreds of servers with a single command and just wait for the tasks to be completed. You do not need to log in to different servers, switch between consoles, collect logs, or keep the time of events. You can include each and every task in Ansible playbooks and collect the summary or report for your later auditing purposes. </p>
<h2 id="_idParaDest-97"><a id="_idTextAnchor097"/>How frequently am I doing this task?</h2>
<p>If the tasks <a id="_idIndexMarker282"/>are not executed frequently (for example, once a year), then it will not be much use to spend time developing the automation content for that task. But, if the task is to be executed for several servers, then that automation use case is valid and a good candidate, as during the execution time, you will need fewer resources for that job as the automation will take care of the complex workflows.</p>
<p>Always compare the time required for the manual task with the time required for the development of Ansible playbook content. You also have to bear in mind that the task might currently be executing less frequently due to resource unavailability or task complexity. By automating such tasks, you can increase the frequency of the tasks as you need less effort to execute them using your Ansible playbooks.</p>
<p>For example, assume you have thousands of servers to manage and the patching is possible only once every 6 months due to having a small team, and we all know that engineers need to spend a few hours to complete patching for a single server. Due to the complexity and criticality of OS patching tasks, you can do it only during non-business hours (usually weekends) and you need to rotate your engineers on weekend activities to accomplish this task. If you can automate this task using Ansible, then the engineers need to spend much less time and you can do the OS patching almost every month or whenever necessary. </p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor098"/>How much time can I save by automating this task?</h2>
<p>Consider whether <a id="_idIndexMarker283"/>the automation can help to save some time and help the engineers to focus on improving their workflows. For some tasks, engineers need to sit in front of their workstations until the task reaches a particular stage and they need to interactively complete the task regardless of their work hours.</p>
<p>For example, for a weekly system reboot job, you need to wait for the system to be up and running before focusing on the next machine in the workflow. Ansible can help you to automate this reboot, validation, and system restore process in case of an emergency. You can schedule the jobs in a parallel or serial workflow without waiting for one machine to complete the reboot activity.</p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor099"/>Can I save some money?</h2>
<p>It is not a major <a id="_idIndexMarker284"/>reason from the technical point of view, but reducing cost is one of the most common reasons organizations are looking for automation of their IT and application infrastructure. You can assess the cost savings together with the time saving, as the engineers will be spending more time on improvements and better practices rather than working on the same repeated jobs. Also, the reduction of human errors will help to reduce service outages, which, in turn, reduces the cost to the organization.</p>
<p>You can add more facts and questions in the use case selection criteria and assessment as per your organization’s requirements. </p>
<p>In the next section, we will learn how to organize and store managed node information in the Ansible inventory, and different best practices to follow.</p>
<h1 id="_idParaDest-100"><a id="_idTextAnchor100"/>Involving teams in the automation journey</h1>
<p>It is a<a id="_idIndexMarker285"/> common misunderstanding that the responsibility for finding use cases and implementing automation only falls to the systems<a id="_idIndexMarker286"/> team, platforms team, or infrastructure team. When we explore our work environment and day-to-day tasks, we will find thousands of tasks that we can automate using Ansible. It could be the database team managing database servers and instances, the network team handling network operations, or the application team who wants to deploy their application updates more effectively. Implementing automation in the environment is a collaborative journey, and we need support and guidance from different teams. </p>
<p>For example, typical database provisioning steps can be seen in <em class="italic">Figure 5.5</em>:</p>
<div><div><img alt="Figure 5.5 – Typical database provisioning tasks " height="508" src="img/B18383_05_05.jpg" width="824"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.5 – Typical database provisioning tasks</p>
<p>Many of the<a id="_idIndexMarker287"/> tasks listed in <em class="italic">Figure 5.5</em> can be automated <a id="_idIndexMarker288"/>using Ansible, and the workflow can be completed in minutes instead of days and weeks. The database team needs to share more insight about the database operations and the automation opportunities, as they are<a id="_idIndexMarker289"/> the <strong class="bold">subject matter experts</strong> (<strong class="bold">SMEs</strong>) for database-related topics. </p>
<p>We have detailed sections on learning about database automation using Ansible, which you can find in <a href="B18383_08.xhtml#_idTextAnchor144"><em class="italic">Chapter 8</em></a>, <em class="italic">Helping the Database Team with Automation</em>.</p>
<p>We can take Windows server automation as another example, as there is always a misconception that Ansible is only available for Linux and cannot be used for automation on Windows servers. This is incorrect as Ansible can be used to automate most of your Windows management and administration operations. There are about 100 Ansible modules available in <a id="_idIndexMarker290"/>the Ansible Windows collection, which can be downloaded from Ansible Galaxy as <a id="_idIndexMarker291"/>follows:</p>
<ul>
<li><code>community.windows</code> – <a href="https://galaxy.ansible.com/community/windows">https://galaxy.ansible.com/community/windows</a></li>
<li><code>Ansible.windows</code> – <a href="https://galaxy.ansible.com/ansible/windows%20">https://galaxy.ansible.com/ansible/windows</a></li>
</ul>
<p>Refer to <em class="italic">Figure 5.6</em> for a typical user creation job in Windows:</p>
<div><div><img alt="Figure 5.6 – Windows user creation workflow " height="533" src="img/B18383_05_06.jpg" width="651"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.6 – Windows user creation workflow</p>
<p>The entire workflow<a id="_idIndexMarker292"/> can be automated using a few tasks inside an Ansible playbook and the Windows team can reuse the same automation <a id="_idIndexMarker293"/>artifacts for thousands of servers in the environment. As an Ansible content developer, you can collaborate with the Windows platform team and find more such use cases for implementing automation. You will learn more about Windows automation in <a href="B18383_06.xhtml#_idTextAnchor105"><em class="italic">Chapter 6</em></a>,<em class="italic">Automating Microsoft Windows and Network Devices</em>.</p>
<p>Let’s explore one more use case opportunity and challenge that the cloud platform team faces. When you introduce Ansible automation to the cloud platform team that manages the public or private cloud, they are always faced with a dilemma – how to update the managed node information in the Ansible inventory every time when there are frequent changes in terms of virtual machines, disks, network, and so on. In the next section, we will learn how to handle a large number of dynamically managed nodes in the Ansible inventory using the dynamic inventory plugins.</p>
<h1 id="_idParaDest-101"><a id="_idTextAnchor101"/>Ansible dynamic inventory</h1>
<p>It is easy to<a id="_idIndexMarker294"/> manage your managed node information inside static inventory files when you have a smaller number of nodes or an almost fixed set of assets, such as bare-metal servers or virtual machines that are not frequently recreated. But, if your environment contains many dynamic nodes, such as virtual machines on multiple public or private cloud platforms, Kubernetes, or OpenShift platforms, then keeping your managed node information inside static files will be difficult, as you need to keep track of the changes and update your inventory files with them, including IP addresses, login credentials, and more. In such cases, you can use the <strong class="bold">dynamic inventory</strong> features in Ansible, which are basically some custom scripts and inventory plugins that collect inventory information from these virtualization or container platforms. </p>
<p>When you pass the dynamic inventories to Ansible, the inventory plugins will be executed and will collect the details of managed nodes from your virtualization platforms. This information will be passed to Ansible as regular inventory data and Ansible will execute the automation tasks for those managed nodes based on the node selection. </p>
<p>You can use dynamic inventory plugins for any supported platforms, such as VMware, OpenStack, AWS, Azure, GCP, or from other container platforms such as Kubernetes, OpenShift, and so on, as depicted in <em class="italic">Figure 5.7</em>:</p>
<div><div><img alt="Figure 5.7 – Ansible static and dynamic inventories " height="598" src="img/B18383_05_07.jpg" width="974"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.7 – Ansible static and dynamic inventories</p>
<p>You can list <a id="_idIndexMarker295"/>all the available dynamic plugins as follows:</p>
<pre class="source-code">
[ansible@ansible inventories]$ ansible-doc -t inventory -l </pre>
<p>Please note that you will see additional inventory plugins if you have installed additional Ansible collections, as some of the collections may include inventory plugins as well.</p>
<p class="callout-heading">Ansible Inventory Plugins</p>
<p class="callout">For more details about <a id="_idIndexMarker296"/>Ansible Inventory plugins, you can look them up at <a href="https://docs.ansible.com/ansible/latest/plugins/inventory.xhtml">https://docs.ansible.com/ansible/latest/plugins/inventory.xhtml</a>. Old dynamic inventory scripts are available at <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml">https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml</a> and <a href="https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory">https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory</a>.</p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor102"/>Using the Ansible dynamic inventory with AWS</h2>
<p>In this<a id="_idIndexMarker297"/> practice session, you will learn how to install Ansible collections and how to use the Ansible inventory plugin for AWS Cloud. You will use the default AWS inventory plugin available at the official <code>amazon.aws</code> collection. </p>
<h3>Assumptions</h3>
<p>We assume <a id="_idIndexMarker298"/>the following:</p>
<ul>
<li>You have an AWS account (the Free Tier is enough to proceed with this exercise).</li>
<li>You have basic knowledge of the AWS platform sufficient to create new users and EC2 instances.</li>
</ul>
<h3>Installing AWS collection and libraries</h3>
<p>First of all, we <a id="_idIndexMarker299"/>need to install the required Ansible collection and plugins before using the inventory plugin:</p>
<ol>
<li value="1">Configure <code>ansible.cfg</code> with a collection path. By default, <code>ansible-galaxy</code> will install the Ansible collections (and roles) to a default path, which is under your home directory (for example, <code>/home/ansible/.ansible/collections/ansible_collections</code>). In this case, we will tell Ansible to install the collection to a specific path for better management. Configure the <code>COLLECTIONS_PATHS</code> line in your <code>ansible.cfg</code> file:<pre>[defaults]
inventory = ./hosts 
remote_user = devops
ask_pass = false       
COLLECTIONS_PATHS = ./collections</pre></li>
</ol>
<ol>
<li value="2">Install the <code>amazon.aws</code> collection using the <code>ansible-galaxy</code> command:<pre>[ansible@ansible Chapter-05]$ ansible-galaxy collection install amazon.aws</pre></li>
<li>Verify <a id="_idIndexMarker300"/>the installed collection:</li>
</ol>
<div><div><img alt="Figure 5.8 – Ansible AWS collection installed " height="230" src="img/B18383_05_08.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.8 – Ansible AWS collection installed</p>
<p>You can see that the collection is installed in your <code>PROJECT_DIRECTORY/collections</code> path.</p>
<ol>
<li value="4">Verify the installed inventory plugin for AWS:</li>
</ol>
<div><div><img alt="Figure 5.9 – AWS inventory plugin " height="149" src="img/B18383_05_09.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.9 – AWS inventory plugin</p>
<ol>
<li value="5">Install the <code>python3-boto3</code> package. AWS modules and plugins require the <code>boto3</code> package to be available on the system:<pre>[ansible@ansible Chapter-05]$ sudo dnf install python3-boto3</pre></li>
</ol>
<p>If your Ansible was installed using Python, then install <code>boto3</code> using the <code>pip install </code><code>boto3</code> command.</p>
<p>After installing the Ansible AWS collection, you need to create the AWS user with which Ansible will access the AWS platform.</p>
<p>If you are using the automation execution environments with Ansible Automation Platform, then <a id="_idIndexMarker301"/>all the dependencies and libraries can be packaged inside the execution environment images. Refer to <a href="https://www.ansible.com/products/execution-environments">https://www.ansible.com/products/execution-environments</a> for more details.</p>
<h3>Creating an AWS user and credential</h3>
<p>For the AWS <code>ec2</code> inventory plugin <a id="_idIndexMarker302"/>to access your AWS account, you need to configure your AWS credentials using standard methods, as shown in <em class="italic">Figure 5.10</em>:</p>
<ol>
<li value="1">Go to <strong class="bold">AWS Console</strong> | <strong class="bold">IAM</strong> | <strong class="bold">Users</strong> | <strong class="bold">Add User</strong> and select <strong class="bold">Programmatic access</strong>:</li>
</ol>
<div><div><img alt="Figure 5.10 – Creating an AWS user with programmatic access " height="476" src="img/B18383_05_10.jpg" width="1032"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.10 – Creating an AWS user with programmatic access</p>
<ol>
<li value="2">Add appropriate permissions for the new user (do not give the user <strong class="bold">AdministratorAccess</strong> to your production account), as shown in <em class="italic">Figure 5.11</em>:</li>
</ol>
<div><div><img alt="Figure 5.11 – Applying permissions for the new AWS user " height="651" src="img/B18383_05_11.jpg" width="937"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.11 – Applying permissions for the new AWS user</p>
<ol>
<li value="3">Add <strong class="bold">Tags</strong> if <a id="_idIndexMarker303"/>needed and click <strong class="bold">Create User</strong>. Please remember to copy the <strong class="bold">Access key ID</strong> and <strong class="bold">Secret access key</strong> as shown in <em class="italic">Figure 5.12</em> as we need this information in the next steps.</li>
</ol>
<div><div><img alt="Figure 5.12 – AWS user access key ID and secret access key  " height="478" src="img/B18383_05_12.jpg" width="1093"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.12 – AWS user access key ID and secret access key </p>
<p>Once you <a id="_idIndexMarker304"/>create the user account, you need to configure the access key and secret access key on your Ansible control node.</p>
<h3>Configuring AWS credentials on the Ansible control node</h3>
<p>Now, you need to configure the AWS credential information <a id="_idIndexMarker305"/>on the control node:</p>
<ol>
<li value="1">Add new AWS credentials on your Ansible control node machine. If you have multiple credentials, then add this as a new profile as follows (for example, <code>default</code> and <code>ansible</code> profiles):</li>
</ol>
<div><div><img alt="Figure 5.13 – AWS profile configuration " height="272" src="img/B18383_05_13.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.13 – AWS profile configuration</p>
<ol>
<li value="2">Update the <code>config</code> file as shown:</li>
</ol>
<div><div><img alt="Figure 5.14 – AWS profile config file " height="168" src="img/B18383_05_14.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.14 – AWS profile config file</p>
<p>Remember <a id="_idIndexMarker306"/>to use the correct AWS profile name in your inventory configuration in the next steps (<code>ansible</code>, in our case).</p>
<h3>Using the AWS aws_ec2 inventory plugin</h3>
<p>Once you configure <a id="_idIndexMarker307"/>the AWS credentials, you can start testing the dynamic inventory plugin:</p>
<ol>
<li value="1">Create an inventory file with the <code>ec2</code> plugin information. We will also include the location to filter for the <code>ec2</code> instances:</li>
</ol>
<div><div><img alt="Figure 5.15 – Inventory file for AWS ec2 instances " height="328" src="img/B18383_05_15.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.15 – Inventory file for AWS ec2 instances</p>
<ol>
<li value="2">Verify the dynamic inventory plugin by passing the inventory location (<code>inventories/aws/</code>):</li>
</ol>
<div><div><img alt="Figure 5.16 – Verify AWS dynamic inventory " height="272" src="img/B18383_05_16.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.16 – Verify AWS dynamic inventory</p>
<p>The<a id="_idIndexMarker308"/> inventory plugin will access the AWS platform using the account you have configured in the previous steps and return the result in a format that Ansible can read and use for execution. (We have used the <code>--graph</code> option for a summary view, but you can use other options, such as <code>--list</code>.)</p>
<ol>
<li value="3">You can add more filters with tags and hostnames as shown here:<pre>filters:
  tag:Environment: dev
  tag:Criticality:
    - low</pre></li>
<li>The plugin will return the result based on the filter you have configured in the inventory YAML file:</li>
</ol>
<div><div><img alt="Figure 5.17 – AWS dynamic inventory with additional filters " height="219" src="img/B18383_05_17.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.17 – AWS dynamic inventory with additional filters</p>
<ol>
<li value="5">If you have configured the <code>ec2</code> instances (using the AWS <code>ec2</code> template or other methods), then you can test the <a id="_idIndexMarker309"/>access now:</li>
</ol>
<div><div><img alt="Figure 5.18 – Ansible ping test using the AWS dynamic inventory " height="300" src="img/B18383_05_18.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.18 – Ansible ping test using the AWS dynamic inventory</p>
<p class="callout-heading">Secure Shell (SSH)</p>
<p class="callout">SSH is a cryptographic network protocol that helps users to access the target systems in a secure way. Read <a href="https://www.techtarget.com/searchsecurity/definition/Secure-Shell">https://www.techtarget.com/searchsecurity/definition/Secure-Shell</a> to learn more about SSH.</p>
<p>In the <a id="_idIndexMarker310"/>preceding exercise, you have learned how to use Ansible dynamic inventory plugins and use the inventory without adding your managed node information inside any static files. The procedure is more or less the same for all other cloud and container platforms, as you can generally find and use suitable inventory plugins to implement the dynamic inventory for them.</p>
<p class="callout-heading">Ansible Inventory Plugin Options</p>
<p class="callout">Check the official <a id="_idIndexMarker311"/>documentation for the inventory plugin’s additional options and filters: <a href="https://docs.ansible.com/ansible/latest/plugins/inventory.xhtml">https://docs.ansible.com/ansible/latest/plugins/inventory.xhtml</a> and <a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.xhtml">https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.xhtml</a> and <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.xhtml#understanding-variable-precedence">https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.xhtml#understanding-variable-precedence</a>.</p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor103"/>Summary</h1>
<p>In this chapter, you have learned methods to find automation use cases in your workplace and determine the feasibility and usability of these automation use cases. You have also explored the importance of collaboration between teams to implement better automation use cases. Later in the chapter, you learned how to use the Ansible dynamic inventory and practiced using the Ansible inventory plugin with the AWS <code>ec2</code> inventory plugin.</p>
<p>In the next chapter, we will learn the basics of Windows automation and the remote connection methods available. We will also learn the basics of network automation using Ansible with practice sections.</p>
<h1 id="_idParaDest-104"><a id="_idTextAnchor104"/>Further reading</h1>
<p>To learn more about the topics covered in this chapter, please visit the following links:</p>
<ul>
<li><em class="italic">Ansible ServiceNow collection</em>: <a href="https://github.com/ansible-collections/servicenow.itsm">https://github.com/ansible-collections/servicenow.itsm</a></li>
<li><em class="italic">Automating ServiceNow with Red Hat Ansible Automation Platform</em>: <a href="https://www.ansible.com/blog/certified-collection-servicenow">https://www.ansible.com/blog/certified-collection-servicenow</a></li>
<li><em class="italic">Ansible Use Cases</em>: <a href="https://www.ansible.com/use-cases">https://www.ansible.com/use-cases</a></li>
<li><em class="italic">How to build your inventory</em>: <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.xhtml">https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.xhtml</a></li>
<li><em class="italic">Inventory tips</em>: <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.xhtml#inventory-tips">https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.xhtml#inventory-tips</a></li>
<li><em class="italic">Working with dynamic inventory</em>: <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml">https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml</a></li>
<li><em class="italic">Ansible AWS collection</em>: <a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/index.xhtml">https://docs.ansible.com/ansible/latest/collections/amazon/aws/index.xhtml</a></li>
<li><em class="italic">Ansible and Windows</em>: <a href="https://www.ansible.com/for/windows">https://www.ansible.com/for/windows</a></li>
<li><em class="italic">Ansible Windows Guides</em>: <a href="https://docs.ansible.com/ansible/latest/user_guide/windows.xhtml">https://docs.ansible.com/ansible/latest/user_guide/windows.xhtml</a></li>
</ul>
</div>
</div></body></html>