<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Building Your First AWS CloudFormation Project</h1>
                
            
            <article>
                
<p class="calibre2">We can build various infrastructure models using AWS CloudFormation. We can add, update, and delete AWS resources in our infrastructure design as IaC and then deploy our IaC scripts to AWS CloudFormation. In this section, we will build a simple project to show how to develop IaC using <span class="calibre7">AWS CloudFormation.</span></p>
<p class="calibre2">The following topics will be covered in this chapter:</p>
<ul class="calibre11">
<li class="calibre12">Preparing a project</li>
<li class="calibre12"><span>CloudFormation implementation using the management console</span></li>
<li class="calibre12"><span>CloudFormation implementation using the AWS CLI</span></li>
<li class="calibre12">Managing an AWS <span>CloudFormation project</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">CloudFormation project scenario</h1>
                
            
            <article>
                
<p class="calibre2">In the previous chapter, we learned what AWS CloudFormation is. In this chapter, we continue our exploration of <span class="calibre7">AWS CloudFormation. We will focus on how to build a simple IaC using CloudFormation.</span></p>
<p class="calibre2">To minimize problem complexity, we will use a simple AWS resource such as Amazon S3, and create a bucket in Amazon S3 through CloudFormation. To build a CloudFormation project, we will follow the steps shown in the following diagram:</p>
<p class="cdpaligncenter1"><img class="alignnone6" src="../images/00014.jpeg"/></p>
<div class="packt_figref">Figure 2.1: Project steps for deploying AWS CloudFormation</div>
<p class="calibre2">The preceding diagram shows how to build and deploy a CloudFormation project. In this scenario, we will use a CloudFormation stack to build an IaC design. The steps are explained as follows:</p>
<ol class="calibre14">
<li value="1" class="calibre12">Build IaC scripts in a CloudFormation template to define the AWS resources that are used to build an infrastructure</li>
<li value="2" class="calibre12">Upload the template file to the <span>CloudFormation server</span></li>
<li value="3" class="calibre12">Create a CloudFormation stack</li>
<li value="4" class="calibre12">Configure all options from the <span>CloudFormation stack</span></li>
<li value="5" class="calibre12">Review all settings before deploying to the <span>CloudFormation server</span></li>
<li value="6" class="calibre12">Deploy a <span>CloudFormation stack</span></li>
</ol>
<p class="calibre2">We will apply these steps to our CloudFormation project. Each step will be executed in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Preparation</h1>
                
            
            <article>
                
<p class="calibre2">Technically, we don't need any special preparation. You should have an active AWS account in order to build CloudFormation projects, and you also need an internet connection since we build and manage AWS through the internet network.</p>
<p class="calibre2">Lastly, you should be aware of pricing. Currently, CloudFormation is free, but the AWS resources used in a CloudFormation project are probably chargeable. Some AWS resources are free with certain limitations. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Implementing a CloudFormation project using the management console</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we are going to build our first CloudFormation project graphically through the CloudFormation management console. Follow these steps:</p>
<ol class="calibre14">
<li value="1" class="calibre12">Open a browser and navigate to <a href="https://console.aws.amazon.com/cloudformation" target="_blank" class="calibre10">https://console.aws.amazon.com/cloudformation</a>. </li>
</ol>
<p class="calibre2"> </p>
<p class="calibre2"/>
<ol start="2" class="calibre14">
<li value="2" class="calibre12">Log in with your active AWS account. After successful login, you should get the <span>AWS CloudFormation management console, as shown in the following screenshot:</span></li>
</ol>
<div class="cdpaligncenter"><img class="alignnone7" src="../images/00015.jpeg"/></div>
<div class="packt_figref">Figure 2.2: AWS CloudFormation management console</div>
<ol start="3" class="calibre14">
<li value="3" class="calibre12">To start creating a simple CloudFormation project, first create a stack.</li>
<li value="4" class="calibre12">Click on the <span>Create new stack</span> button, shown in <em class="calibre24">Figure 2.2</em>.</li>
</ol>
<p class="calibre2"> </p>
<ol start="5" class="calibre14">
<li value="5" class="calibre12">You should now see the screen shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img src="../images/00016.jpeg" class="calibre23"/></div>
<div class="packt_figref">Figure 2.3: Selecting a template for CloudFormation</div>
<ol start="6" class="calibre14">
<li value="6" class="calibre12"><span>From the screen</span> shown in the preceding screenshot, upload a CloudFormation template file. You can upload the template file or create a template using the <span>Design template</span> option. If you have a CloudFormation template file that has already been uploaded to Amazon S3, you can specify the file path from Amazon S3.</li>
<li value="7" class="calibre12">For this demo, we uploaded a <span>CloudFormation template file from local to Amazon S3. The template file is in JSON and YAML file formats.</span></li>
<li value="8" class="calibre12">Now, we can create a template file in JSON and YAML. You can select a template file in JSON (<span><kbd class="calibre13">hello-cloudformation.json</kbd>) </span>or YAML (<span><kbd class="calibre13">hello-cloudformation.yaml</kbd>)</span>. </li>
</ol>
<p class="calibre25">The following is the content of the <kbd class="calibre13">hello-cloudformation.json</kbd> file:</p>
<pre class="calibre26">{<br class="title-page-name"/> "Resources" : {<br class="title-page-name"/>    "MySimpleBucket" : {<br class="title-page-name"/>       "Type" : "AWS::S3::Bucket"<br class="title-page-name"/>    }<br class="title-page-name"/> }<br class="title-page-name"/>}</pre>
<p class="calibre25"><span class="calibre7">The following is the content of the <kbd class="calibre13">hello-cloudformation.yaml</kbd> file:</span></p>
<pre class="calibre26">Resources:<br class="title-page-name"/> MySimpleBucket:<br class="title-page-name"/>   Type: AWS::S3::Bucket<br class="title-page-name"/>     Properties:<br class="title-page-name"/>       AccessControl: PublicRead</pre>
<ol start="9" class="calibre14">
<li value="9" class="calibre12">After creating a CloudFormation template file in JSON or YAML, you can upload it to the CloudFormation management console.</li>
<li value="10" class="calibre12">Select the <span>Upload a template to Amazon S3</span> option shown in <em class="calibre24">Figure 2.3</em>.</li>
<li value="11" class="calibre12">Then, click on the <span>Choose File</span> option to select your template file from the local computer.</li>
<li value="12" class="calibre12">Wait until your template file is uploaded to Amazon S3.</li>
<li value="13" class="calibre12">After it is uploaded, click on the <span>Next</span> button to continue the steps of the project.</li>
<li value="14" class="calibre12">You should now see the screen shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone8" src="../images/00017.jpeg"/></div>
<div class="packt_figref">Figure 2.4: Adding a stack name</div>
<ol start="15" class="calibre14">
<li value="15" class="calibre12">Fill in your stack name. This is used for stack identity in CloudFormation.</li>
<li value="16" class="calibre12">After you have filled in the stack name, click on the <span>Next</span> button to continue.</li>
<li value="17" class="calibre12">You will see the following screenshot for configuring stack options such as tags and permissions:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone9" src="../images/00018.jpeg"/></div>
<div class="packt_figref">Figure 2.5: Configuring stack options</div>
<ol start="18" class="calibre14">
<li value="18" class="calibre12">In this demo, we won't configure any options in the CloudFormation stack. We can skip this step. Click on the <span>Next</span> button to continue.</li>
<li value="19" class="calibre12">You can now see the review screen, as shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone10" src="../images/00019.jpeg"/></div>
<div class="packt_figref">Figure 2.6: Confirmation before executing and deploying to Amazon AWS</div>
<ol start="20" class="calibre14">
<li value="20" class="calibre12">Review all the information that you have set. </li>
<li value="21" class="calibre12">Once done, click on the <span>Create</span> button to execute your template and then deploy all the resources from the predefined template to Amazon AWS. Your browser should be redirected to the CloudFormation dashboard. You should now see the <span>status of the stack being created</span>, as shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone11" src="../images/00020.jpeg"/></div>
<div class="packt_figref">Figure 2.7: A stack being created in CloudFormation</div>
<ol start="22" class="calibre14">
<li value="22" class="calibre12">If you want to get an update on the <span>progress of the creation</span>, click on the circle-arrow at the top right.</li>
<li value="23" class="calibre12">Once the process is done, you should see it in the <span>Status</span> column, in the list shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone12" src="../images/00021.jpeg"/></div>
<div class="packt_figref">Figure 2.8: A stack was completely created </div>
<ol start="24" class="calibre14">
<li value="24" class="calibre12">If you want to see the details of your created stack, you can click on your stack name, as shown in the preceding screenshot.</li>
<li value="25" class="calibre12">Then, you will see details from the selected CloudFormation stack. The following screenshot shows an example of a detailed stack:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone13" src="../images/00022.jpeg"/></div>
<div class="packt_figref">Figure 2.9: Getting details from the stack</div>
<ol start="26" class="calibre14">
<li value="26" class="calibre12">AWS CloudFormation creates all the resources that you have already defined in the template file.</li>
<li value="27" class="calibre12">In our demo, we create Amazon S3. We can verify it by opening the Amazon S3 management console at <a href="https://console.aws-amazon.com/s3" target="_blank" class="calibre10">https://console.aws-amazon.com/s3</a>.</li>
<li value="28" class="calibre12">On the <span><span>Amazon S3 management console, you should see a bucket with the name that is defined in your CloudFormation stack, as shown in the following screenshot:</span></span></li>
</ol>
<div class="cdpaligncenter"><img class="alignnone14" src="../images/00023.jpeg"/></div>
<div class="packt_figref">Figure 2.10: A S3 bucket was created in AWS CloudFormation</div>
<p class="calibre2">This is the end of the section on how to build AWS CloudFormation graphically through the CloudFormation management console. </p>
<p class="calibre2">Next, we will work through a similar scenario using the AWS CLI.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Implementing a CloudFormation project using the AWS CLI</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we'll explore how to work with the AWS CLI on CloudFormation. In the previous section, we built and deployed CloudFormation graphically through the CloudFormation management console. We will perform a similar action to build and deploy CloudFormation using the AWS CLI.</p>
<p class="calibre2">Let's explore!</p>
<p class="calibre2"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Setting up the AWS Command Line Interface (CLI)</h1>
                
            
            <article>
                
<p class="calibre2">The AWS CLI is a tool from Amazon for managing Amazon AWS in Terminal mode. We manage all AWS resources from this Terminal. This tool supports Windows, Linux, and macOS. If you work with the Windows platform, you can download this tool from the following website, selecting your Windows version:</p>
<ul class="calibre11">
<li class="calibre12">Windows 64-bit: <a href="https://s3.amazonaws.com/aws-cli/AWSCLI64.msi" class="calibre10">https://s3.amazonaws.com/aws-cli/AWSCLI64.msi</a></li>
<li class="calibre12">Windows 32-bit: <a href="https://s3.amazonaws.com/aws-cli/AWSCLI32.msi" class="calibre10">https://s3.amazonaws.com/aws-cli/AWSCLI32.msi</a></li>
</ul>
<p class="calibre2">For Linux and Mac, you can install the AWS CLI through <kbd class="calibre13">pip</kbd> with the Python runtime. Type the following command:</p>
<pre class="calibre19"><strong class="calibre1">$ pip install awscli</strong></pre>
<p class="calibre2">If you want to upgrade your AWS CLI through <kbd class="calibre13">pip</kbd>, type the following command:</p>
<pre class="calibre19"><strong class="calibre1">$ pip install awscli --upgrade --user</strong></pre>
<p class="calibre2">If you have installed or upgraded the CLI already, you can verify AWS CLI by checking its version. Type the following command in the Terminal:</p>
<pre class="calibre19"><strong class="calibre1">$ aws --version</strong></pre>
<p class="calibre2">You should see the AWS CLI version. For instance, you can see my AWS CLI version in the following screenshot:</p>
<div class="cdpaligncenter"><img class="alignnone15" src="../images/00024.jpeg"/></div>
<div class="packt_figref">Figure 2.11: Checking the AWS CLI version</div>
<p class="calibre2">To configure the AWS CLI with your current AWS account, type the following command:</p>
<pre class="calibre19"><strong class="calibre1">$ aws configure</strong></pre>
<p class="calibre2">You should prepare all the required access and secret keys. I recommend reading the guidelines on this at <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" target="_blank" class="calibre10">https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html</a>.</p>
<p class="calibre2"/>
<p class="calibre2">The next step is to configure security access on the AWS CLI to enable working with CloudFormation.</p>
<p class="calibre2"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Configuring security access for CloudFormation</h1>
                
            
            <article>
                
<p class="calibre2">To work with CloudFormation from the AWS CLI, we need to configure our security access and rights. In this demo, we will build and deploy CloudFormation with Amazon S3, so we need to configure security settings for <span class="calibre7">CloudFormation and Amazon S3 on the AWS CLI.</span></p>
<p class="calibre2">The following are the steps for adding security access to<span class="calibre7"> </span><span class="calibre7">CloudFormation and Amazon S3:</span></p>
<ol class="calibre14">
<li value="1" class="calibre12">Open a browser and navigate to the AWS IAM management console at <a href="https://console.aws.amazon.com/iam" target="_blank" class="calibre10">https://console.aws.amazon.com/iam</a>.</li>
<li value="2" class="calibre12">Once you're at the IAM management console, click on the <span>Policies</span> option in the left-hand menu. You should see the screen shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone16" src="../images/00025.jpeg"/></div>
<div class="packt_figref">Figure 2.12: Add a new policy for CloudFormation</div>
<ol start="3" class="calibre14">
<li value="3" class="calibre12">Now, create a custom policy for CloudFormation.</li>
<li value="4" class="calibre12">Click on <span>Create policy</span>, which is indicated by the arrow in <em class="calibre24">Figure 2.12</em>. Then, you should have a policy form, as shown in <em class="calibre24">Figure 2.13</em>.</li>
</ol>
<p class="calibre2"> </p>
<ol start="5" class="calibre14">
<li value="5" class="calibre12">We will add policy scripts in JSON format, so click on the <span>JSON</span> tab on the creation form, as shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone17" src="../images/00026.jpeg"/></div>
<div class="packt_figref">Figure 2.13: Adding a policy to access CloudFormation resources</div>
<ol start="6" class="calibre14">
<li value="6" class="calibre12">In this scenario, we give full access to CloudFormation. You can write these scripts and paste them to the <span>JSON</span> tab shown in <em class="calibre24">Figure 2.13</em>:</li>
</ol>
<pre class="calibre26">{<br class="title-page-name"/>  "Version": "2012-10-17",<br class="title-page-name"/>  "Statement": [<br class="title-page-name"/>                {<br class="title-page-name"/>                  "Sid": "Stmt1449904348000",<br class="title-page-name"/>                  "Effect": "Allow",<br class="title-page-name"/>                  "Action": [<br class="title-page-name"/>                      "cloudformation:*"<br class="title-page-name"/>                  ],<br class="title-page-name"/>                  "Resource": [<br class="title-page-name"/>                      "*"<br class="title-page-name"/>                  ]<br class="title-page-name"/>               }<br class="title-page-name"/> ]<br class="title-page-name"/>}</pre>
<ol start="7" class="calibre14">
<li value="7" class="calibre12">Once you have pasted the scripts, you can click on the <span>Review policy</span> button and you should see the form shown in <em class="calibre24">Figure 2.14</em>.</li>
<li value="8" class="calibre12">Fill in the name and description of your policy. For instance, the name of the review policy in the following screenshot is <kbd class="calibre13">AWSCloudFormationLRW</kbd>:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone18" src="../images/00027.jpeg"/></div>
<div class="packt_figref">Figure 2.14: Fill in the policy name and description</div>
<ol start="9" class="calibre14">
<li value="9" class="calibre12">Once done, click on <span>Create policy</span> to start creating a policy. Now, we continue by adding that policy to our account.</li>
<li value="10" class="calibre12">Click on the <span>Users</span> section in the menu on the left and select the user account that is used in the AWS CLI.</li>
<li value="11" class="calibre12">In the <span>Summary</span> section of your IAM user, you should have the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone16" src="../images/00028.jpeg"/></div>
<div class="packt_figref">Figure 2.15: Adding a policy to a user</div>
<ol start="12" class="calibre14">
<li value="12" class="calibre12">To add your own policy to your IAM account, click on <span>Add permissions</span> on the <span>Permission</span><span>s</span> tab; see <em class="calibre24">Figure 2.15</em>. You should then see the screen shown in <em class="calibre24">Figure 2.16</em>.</li>
<li value="13" class="calibre12">Select the <span>Attach existing policies directly</span> option in the <span>Grant permissions</span> section and type your policy name, for instance, <kbd class="calibre13">AWSCloudFormationLRW</kbd>.</li>
</ol>
<p class="calibre2"> </p>
<ol start="14" class="calibre14">
<li value="14" class="calibre12">You should see your own policy. Click on it, as shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone19" src="../images/00029.jpeg"/></div>
<div class="packt_figref">Figure 2.16: Adding permissions from your own policy</div>
<ol start="15" class="calibre14">
<li value="15" class="calibre12">After selecting your policy, click on <span>Next:Review</span> at the bottom. Now you should see the form shown in <em class="calibre24">Figure 2.17</em>.</li>
<li value="16" class="calibre12">Once done, click on <span>Add permissions</span> to add that policy to your IAM account:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone20" src="../images/00030.jpeg"/></div>
<div class="packt_figref">Figure 2.17: Confirmation of adding permission</div>
<ol start="17" class="calibre14">
<li value="17" class="calibre12">Now, your IAM user has a CloudFormation policy with full access.</li>
<li value="18" class="calibre12">Using the same approach, we also need to add the <span>AmazonS3FullAccess</span> policy to your IAM account.</li>
<li value="19" class="calibre12">Add an existing policy with <span>AmazonS3FullAccess,</span> <span>as shown in the following screenshot:</span></li>
</ol>
<div class="cdpaligncenter"><img class="alignnone21" src="../images/00031.jpeg"/></div>
<div class="packt_figref">Figure 2.18: Adding the AmazonS3FullAccess policy to a user</div>
<ol start="20" class="calibre14">
<li value="20" class="calibre12">Select the <span>AmazonS3FullAccess</span> <span>policy and then add it to your IAM user.</span></li>
<li value="21" class="calibre12">Once done, your IAM should have CloudFormation and <span>AmazonS3FullAccess</span> <span><span>policies, as shown in the following screenshot:</span></span></li>
</ol>
<div class="cdpaligncenter"><img class="alignnone22" src="../images/00032.jpeg"/></div>
<div class="packt_figref">Figure 2.19: CloudFormation and Amazon S3 policies have been added</div>
<p class="calibre2">Now, your IAM user has CloudFormation <span class="calibre7">and </span><span class="calibre7">AmazonS3FullAccess</span> <span class="calibre7">policies. Now, you can manage CloudFormation from the AWS CLI.</span></p>
<p class="calibre2">The next step is to build CloudFormation and then deploy it to AWS CloudFormation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Building and deploying CloudFormation</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will use the AWS CLI to deploy AWS CloudFormation. To work with CloudFormation in the AWS CLI, we need to know some CloudFormation commands. You can find all the commands for CloudFormation at <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html" target="_blank" class="calibre10">https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html</a>.</p>
<p class="calibre2">We will use the same template as in the first demo, <kbd class="calibre13">hello-cloudformation.json</kbd>. We will upload this template to CloudFormation and then deploy it.</p>
<p class="calibre2">Now open the Terminal and navigate to the directory where <span class="calibre7"><kbd class="calibre13">hello-cloudformation.json</kbd> is located. To create a stack, we can use the </span><kbd class="calibre13">cloudformation create-stack</kbd> command<span class="calibre7">. Type the following command to upload the template and create a stack:</span></p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation create-stack --stack-name mystackcli1 --template-body file://./hello-cloudformation.json --debug</strong></pre>
<p class="calibre2">The preceding command is explained as follows:</p>
<ul class="calibre11">
<li class="calibre12"><kbd class="calibre13">--stack-name mystackcli1</kbd>: This defines the stack name. In this case, the stack name is <kbd class="calibre13">mystackcli1</kbd>.</li>
<li class="calibre12"><kbd class="calibre13">--template-body file://./hello-cloudformation.json</kbd>: This is a template file. You should use <kbd class="calibre13">file://</kbd> with the full template file path. In this demo, Terminal has already been navigated to a directory where the <kbd class="calibre13">./hello-cloudformation.json</kbd> file is located.</li>
<li class="calibre12"><kbd class="calibre13">--debug</kbd>: This is a parameter to enable verbosity so we can see all the verbose messages from the CLI.</li>
</ul>
<div class="packt_infobox">For information about the CloudFormation <kbd class="calibre27">create-stack</kbd> command, I recommend you read the document at: <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html" target="_blank" class="calibre22">https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html</a>.</div>
<p class="calibre2">If this operation is executed successfully, you should get <span class="calibre7">StackId</span> on the Terminal. You can see my program output in the following screenshot:</p>
<p class="calibre2"/>
<div class="cdpaligncenter"><img class="alignnone23" src="../images/00033.jpeg"/></div>
<div class="packt_figref">Figure 2.20: Creating a CloudFormation solution using the AWS CLI</div>
<p class="calibre2">To verify your operation is complete, you can use the <span class="calibre7"><kbd class="calibre13">list-stacks</kbd> command from the CloudFormation CLI. For further information about the <kbd class="calibre13">list-stacks</kbd> command, go to <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stacks.html" target="_blank" class="calibre10">https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stacks.html</a>. Now, type the following command:</span></p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation list-stacks</strong></pre>
<p class="calibre2"/>
<p class="calibre2">You should see a status from the stack operation, as you can see in the following screenshot, for example. A stack status can be found in the <span class="calibre7">StackStatus</span> option, which is indicated by the rectangle:</p>
<div class="cdpaligncenter"><img class="alignnone24" src="../images/00034.jpeg"/></div>
<div class="packt_figref">Figure 2.21: Showing all CloudFormation stacks from the CLI</div>
<p class="calibre2">We can also find out stack details using the <span class="calibre7"><kbd class="calibre13">describe-stacks</kbd> command by passing in the stack name. Information about the <kbd class="calibre13">describe-stacks</kbd> command can be found at <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html" target="_blank" class="calibre10">https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html</a>. For the demo, I want to see the details of the stack with the name </span><kbd class="calibre13">mystackcli1</kbd>:</p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation describe-stacks --stack-name mystackcli1</strong></pre>
<p class="calibre2">After execution, you should see the stack status in the <span class="calibre7">StackStatus</span> option, as shown in the following screenshot:</p>
<p class="calibre2"/>
<div class="cdpaligncenter"><img class="alignnone25" src="../images/00035.jpeg"/></div>
<div class="packt_figref">Figure 2.22: Checking the stack status through the CLI</div>
<p class="calibre2">If the status of the stack is <span class="calibre7">CREATE_COMPLETE</span>, stack creation has succeeded. You can verify this on the CloudFormation management console. Select the region used by your AWS CLI. The following screenshot shows that my stack was created by the AWS CLI:</p>
<div class="cdpaligncenter"><img class="alignnone26" src="../images/00036.jpeg"/></div>
<div class="packt_figref">Figure 2.23: A CloudFormation stack has been created from the AWS CLI</div>
<p class="calibre2">This is the end of the section on how to create a CloudFormation stack using the AWS CLI. Next, we will modify an existing CloudFormation stack.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Editing a CloudFormation project</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will update our CloudFormation project. For a simple update scenario, we will modify a bucket name from Amazon S3. We will modify the CloudFormation template and then apply this template to the CloudFormation server.</p>
<p class="calibre2"/>
<p class="calibre2">We will perform project updates using the CloudFormation management console and the AWS CLI. Each method will be explained in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Editing CloudFormation using the management console</h1>
                
            
            <article>
                
<p class="calibre2">We will modify an existing CloudFormation stack. For a simple scenario, we will change a bucket title on Amazon S3. We will use the modified template file, <kbd class="calibre13">hello-cloudformation-v2.json</kbd>, from the previous demo.</p>
<p class="calibre2">The following are the steps for modifying an existing stack using the CloudFormation management console:</p>
<ol class="calibre14">
<li value="1" class="calibre12">Open a browser and navigate to AWS CloudFormation at <a href="https://console.aws.amazon.com/cloudformation/" target="_blank" class="calibre10">https://console.aws.amazon.com/cloudformation/</a>.</li>
<li value="2" class="calibre12">On the <span>AWS CloudFormation dashboard, select the stack that you want to modify.</span></li>
<li value="3" class="calibre12">Then, click on <span>Actions</span> and select the <span>Update Stack</span> option from the sub-menu. You can see this in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone27" src="../images/00037.jpeg"/></div>
<div class="packt_figref">Figure 2.24: Editing a selected stack in the CloudFormation management console</div>
<ol start="4" class="calibre14">
<li value="4" class="calibre12">After selecting a stack for editing, select the <span>Upload a template to Amazon S3</span> option.</li>
<li value="5" class="calibre12">Click on the <span>Next</span> button to read the CloudFormation template. You should now see the following screen:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone28" src="../images/00038.jpeg"/></div>
<div class="packt_figref">Figure 2.25: Uploading an updated template</div>
<ol start="6" class="calibre14">
<li value="6" class="calibre12">Upload the updated template, for instance, <span><kbd class="calibre13">hello-cloudformation-v2.json</kbd>. </span>When done, click on the <span>Next</span> button.</li>
<li value="7" class="calibre12">CloudFormation will check your template. If the content of the template file is similar, CloudFormation will not perform the next process.</li>
</ol>
<p class="calibre2"> </p>
<ol start="8" class="calibre14">
<li value="8" class="calibre12">If there is a change, CloudFormation will continue the process. You should see the screen shown in <em class="calibre24">Figure 2.26</em>. We can't change the stack name. Now, click on the <span>Next</span> button:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone29" src="../images/00039.jpeg"/></div>
<div class="packt_figref">Figure 2.26: Showing a stack for updating</div>
<ol start="9" class="calibre14">
<li value="9" class="calibre12">You should now see the screen shown in <em class="calibre24">Figure 2.27</em>. Change your stack options and click on the <span>Next</span> button:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone30" src="../images/00040.jpeg"/></div>
<div class="packt_figref">Figure 2.27: Setting options for a stack</div>
<ol start="10" class="calibre14">
<li value="10" class="calibre12">You should now see the review screen, as shown in <em class="calibre24">Figure 2.28</em>. Check all your changes and click on <span>Update</span> to deploy the changes to CloudFormation:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone31" src="../images/00041.jpeg"/></div>
<div class="packt_figref">Figure 2.28: Reviewing all changes before deploying</div>
<ol start="11" class="calibre14">
<li value="11" class="calibre12">CloudFormation will apply all changes to your stack. You can see the progress of the process in the <span>Status</span> column on the <span>Stacks</span> dashboard.</li>
</ol>
<p class="calibre2"> </p>
<ol start="12" class="calibre14">
<li value="12" class="calibre12">Once done, you should see <span>UPDATE_COMPLETE</span> in the <span>Status</span> column, as shown in the following screenshot:</li>
</ol>
<div class="cdpaligncenter"><img class="alignnone32" src="../images/00042.jpeg"/></div>
<div class="packt_figref">Figure 2.29: <span>Stack update is complete</span></div>
<p class="calibre2">This is the end of the section on editing a <span class="calibre7">CloudFormation stack using the management console. </span>Next, we will perform the same process using the AWS CLI.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Editing CloudFormation using the AWS CLI</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will focus on editing an existing CloudFormation stack using the AWS CLI. <span class="calibre7"><span class="calibre7">W</span></span>e have the modified template file, <span class="calibre7"><kbd class="calibre13">hello-cloudformation-v2.json</kbd>. We will update an existing CloudFormation stack by replacing it with the <kbd class="calibre13">hello-cloudformation-v2.json</kbd> file.</span></p>
<p class="calibre2">Now open the Terminal and navigate to the directory where <span class="calibre7"><kbd class="calibre13">hello-cloudformation-v2.json</kbd> is located. To update a stack, we can use <kbd class="calibre13">cloudformation update-stack</kbd>. Type the following command to upload the template and create a stack:</span></p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation update-stack --stack-name mystackcli1 --template-body file://./hello-cloudformation-v2.json --debug</strong></pre>
<p class="calibre2">The preceding command is explained as follows:</p>
<ul class="calibre11">
<li class="calibre12"><kbd class="calibre13">--stack-name mystackcli1</kbd>: This is the stack that will be updated. In this case, the stack name is <kbd class="calibre13">mystackcli1</kbd>.</li>
<li class="calibre12"><kbd class="calibre13">--template-body file://./hello-cloudformation-v2.json</kbd>: This is a changed template file. You should use <kbd class="calibre13">file://</kbd> with the full template file path. In this demo, Terminal has already been navigated to the directory where the <kbd class="calibre13">./hello-cloudformation-v2.json</kbd> file is located.</li>
<li class="calibre12"><kbd class="calibre13">--debug</kbd>: This is a parameter to enable verbosity, so we can see all verbose messages from the CLI.</li>
</ul>
<div class="packt_infobox">For further information about the CloudFormation <kbd class="calibre27">update-stack</kbd> command, I recommend reading the document at <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html" target="_blank" class="calibre22">https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html</a>. </div>
<p class="calibre2">If this operation is executed successfully, you can check the current operation status using the <kbd class="calibre13">describe-stacks</kbd> command. Type the following command:</p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation describe-stacks --stack-name mystackcli1</strong></pre>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2">You should see the status of the <span class="calibre7">StackStatus</span> option, as shown in the following screenshot:</p>
<div class="cdpaligncenter"><img class="alignnone33" src="../images/00043.jpeg"/></div>
<div class="packt_figref">Figure 2.30: Editing a CloudFormation stack from the CLI</div>
<p class="calibre2">If successful, you should see the changes on CloudFormation and the AWS resources that you have modified.</p>
<p class="calibre2">In the next section, we will learn how to delete an existing CloudFormation project.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deleting a CloudFormation project</h1>
                
            
            <article>
                
<p class="calibre2">If you don't use a CloudFormation stack, you can remove it from CloudFormation. Since <span class="calibre7">you are probably charged for all of the AWS resources that you use</span>, I recommend removing all resources related to the <span class="calibre7">CloudFormation stack. We can also remove a CloudFormation stack because of a design error in IaC. Removing a CloudFormation stack will delete all the resources related to that stack.</span></p>
<p class="calibre2"/>
<p class="calibre2">In this section, we will learn how to remove a <span class="calibre7">CloudFormation stack using the management console and the AWS CLI.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deleting CloudFormation using the management console</h1>
                
            
            <article>
                
<p class="calibre2">If you want to delete your CloudFormation stack, you can visit the CloudFormation management console, where you should see your CloudFormation stacks.</p>
<p class="calibre2">To remove a CloudFormation stack, select the stack to be removed. Then, click on <span class="calibre7">Action</span><span class="calibre7">s</span> and you should see the menu shown in the following screenshot. Select the <span class="calibre7">Delete Stack</span> option to delete the selected stack:</p>
<div class="cdpaligncenter"><img class="alignnone34" src="../images/00044.jpeg"/></div>
<div class="packt_figref">Figure 2.31: Deleting a stack</div>
<p class="calibre2">After <span class="calibre7">selecting the <span class="calibre7">Delete Stack</span> option from</span> the menu, you should see a confirmation dialog, as shown in the following screenshot. Click on <span class="calibre7">Yes, Delete</span> to continue the deletion of the stack:</p>
<div class="cdpaligncenter"><img class="alignnone35" src="../images/00045.jpeg"/></div>
<div class="packt_figref">Figure 2.32: Confirmation for deleting a stack</div>
<p class="calibre2">Once done, your CloudFormation stack is deleted, including all the AWS resources that were used in your stack.</p>
<p class="calibre2">Next, we will perform this operation through the AWS CLI.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deleting CloudFormation Stack using the AWS CLI</h1>
                
            
            <article>
                
<p class="calibre2">If you prefer to delete a CloudFormation stack through the AWS CLI, you can use <kbd class="calibre13">delete-stack</kbd> from CloudFormation. You can find this command at <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/delete-stack.html" target="_blank" class="calibre10">https://docs.aws.amazon.com/cli/latest/reference/cloudformation/delete-stack.html</a>.</p>
<p class="calibre2">To delete a CloudFormation stack, you can use the <kbd class="calibre13">delete-stack</kbd> command by passing in your stack name. For instance, to delete the CloudFormation stack named <kbd class="calibre13">mystackcli1</kbd>, type the following command:</p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation delete-stack --stack-name mystackcli1</strong></pre>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2">If you want to get a verbose message, you can add the  <kbd class="calibre13">--debug</kbd> parameter to the command. My program output can be seen in the following screenshot:</p>
<div class="cdpaligncenter"><img class="alignnone36" src="../images/00046.jpeg"/></div>
<div class="packt_figref">Figure 2.33: Deleting a stack from the CLI</div>
<p class="calibre2">To verify your deleted stack, you can use the <kbd class="calibre13">describe-stacks</kbd> command by passing in your stack name. For instance, for the stack name <kbd class="calibre13">mystackcli1</kbd>, type the following command:</p>
<pre class="calibre19"><strong class="calibre1">$ aws cloudformation describe-stacks --stack-name mystackcli1</strong></pre>
<p class="calibre2">A sample of the program output can be seen in the following screenshot:</p>
<div class="cdpaligncenter"><img class="alignnone37" src="../images/00047.jpeg"/></div>
<div class="packt_figref"><span>Figure 2.34: Checking a stack and the deletion process status from the CLI</span></div>
<p class="calibre2">We have now reached the end of this chapter, having learned how to build and <span class="calibre7">deploy a CloudFormation project</span> on Amazon AWS.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">We learned how to build a simple CloudFormation project utilizing Amazon S3. We built a CloudFormation project using the CloudFormation management console and the AWS CLI. The demo operations included creating, editing, and deleting.</p>
<p class="calibre2">In the next chapter, we will learn how to build AWS CloudFormation templates.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Questions</h1>
                
            
            <article>
                
<ol class="calibre14">
<li value="1" class="calibre12">What is a CloudFormation stack?</li>
<li value="2" class="calibre12">What are the benefits of building CloudFormation using the management console?</li>
<li value="3" class="calibre12">What are the advantages of building CloudFormation using the AWS CLI?</li>
</ol>


            </article>

            
        </section>
    </body></html>