<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Deploying Your First Web Application</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we covered a general introduction to the cloud, its benefits, and what having a DevOps philosophy means. AWS offers a number of services that are all easily accessible through the web interface, command-line interface, various SDKs, and APIs. In this chapter, we will take advantage of the web interface and command-line interface to create and configure our account and create a web server to host a simple Hello World application, all in a matter of minutes.</p>
<p>In this chapter, we will go through the following topics:</p>
<ul>
<li>Creating and configuring your account</li>
<li>Spinning up your first web server</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>The technologies and services used in this chapter are as follows:</p>
<ul>
<li>AWS Management Console</li>
<li>AWS compute services</li>
<li>AWS IAM</li>
<li>AWS CLI setup</li>
<li>JavaScript for the web application</li>
<li>GitHub for ready made code</li>
</ul>
<p>The GitHub links for the code are as follows:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.js" target="_blank"><span class="MsoHyperlink">https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.js</span></a></li>
<li><a href="https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.conf" target="_blank"><span class="MsoHyperlink">https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.conf</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and configuring your account</h1>
                </header>
            
            <article>
                
<p>If you haven't signed up for AWS yet, it is time to do so.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Signing up</h1>
                </header>
            
            <article>
                
<p>This step is, of course, fairly simple and self-explanatory. In order to sign up (if you haven't done so yet), open <a href="https://portal.aws.amazon.com" target="_blank"><span class="MsoHyperlink">https://portal.aws.amazon.com</span></a> in your browser, click on the <span class="packt_screen">Create a new AWS account</span> button, and follow the steps. You will need an email address and your credit card information.</p>
<p>The two exceptions to this process are as follows:</p>
<ul>
<li>If you plan to deploy servers in China, then you need to create your account in the AWS China region at <span class="MsoHyperlink"><a href="https://www.amazonaws.cn/" target="_blank">https://www.amazonaws.cn/</a>.</span></li>
<li>AWS has a special facility called <strong>GovCloud</strong> for specific regulatory needs of United States federal, state, and local agencies. To sign up for this, go to the following link at <span class="MsoHyperlink"><a href="https://aws.amazon.com/govcloud-us/contact/">https://aws.amazon.com/govcloud-us/contact/</a>.</span></li>
</ul>
<div class="packt_infobox">In this book, we will use servers located in Northern Virginia so you will need to sign up using the standard registration process.</div>
<p>Amazon runs a free-tier program for new users. This is designed to help you to discover AWS services free of cost. Amazon gives free credit on most services. It is likely that over time the offer will change, so this book isn't going to cover the specifics of this offer, but the details are available at <a href="https://aws.amazon.com/free/" target="_blank"><span class="MsoHyperlink">https://aws.amazon.com/free/</span></a>.</p>
<p>Once you're done with the sign-up process, you will be on the AWS Management Console landing page. This screen can be a bit overwhelming as Amazon now has a lot of services, but you will quickly get used to it. If you are a fan of bookmarks, this page is definitely a prime candidate:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/55489223-a325-4c9b-be97-233e2f7d9d08.png" style="width:33.92em;height:47.25em;"/></p>
<p>The account you just created is called a <strong>root</strong> account. This account will always have full access to all resources. Because of this, make sure that you keep your password in a safe place. The best practice is to use the root account only to create the initial user through the IAM service that we will discover shortly. In addition, it is strongly recommended to switch to <strong>multi-factor authentication</strong> (<strong>MFA</strong>) and use the identity service <strong>IAM</strong><span>—</span>to manage user accounts, so pick a relatively complex password.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enabling MFA on the root account</h1>
                </header>
            
            <article>
                
<p>In order to avoid any kind of issues, the first thing we need to do once we sign up is enable MFA. In case you haven't seen or heard of this before, MFA is a security system that requires more than one method of authentication from independent categories of credentials. These are used to verify the user's identity in order to log in. In practice, once enabled, you will need the password previously set when you signed up in order to login. However, you will also need another code provided from a different source. That second source can be provided through a physical device such as the SafeNet IDProve, which is available at <a href="http://amzn.to/2u4K1rR" target="_blank"><span class="MsoHyperlink">http://amzn.to/2u4K1rR</span></a>, through an SMS on your phone, or through an application installed on your smartphone. We will use the third option—an application installed on your smartphone, which is completely free:</p>
<ol>
<li>Go to your App Store, Google Play Store, or App Marketplace and install an application called <strong>Google Authenticator</strong> (or any other equivalent, such as <strong>Authy</strong>).</li>
<li>In the AWS Management Console, open the <span class="packt_screen">My Security Credentials</span> page in the top-right corner:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/3c115402-abc2-4abe-b9cb-a918dee220b0.png" style="width:22.25em;height:18.00em;"/></div>
<ol start="3">
<li>If prompted to create and use AWS <strong>Identity and Access Management</strong> (<strong>IAM</strong>), users with limited permissions, click on the <span class="packt_screen">Continue to Security Credentials</span> button. We will explore the IAM system in <a href="8a74da7b-0748-4b90-a3bc-58e853e820ec.xhtml">Chapter 3</a>, <em>Treating Your Infrastructure as Code.</em> Expand the <span class="packt_screen">Multi-factor authentication (MFA)</span> section on the page.</li>
<li>Pick virtual MFA and follow the instructions to sync Google authentication with your root account (note that the scan QR code option is the easiest one to pair the device).</li>
</ol>
<p>From this point on, you will need your password and the token displayed on the MFA application in order to log in as root in the AWS console.</p>
<div class="packt_tip">Two general tips for managing your passwords and MFA are as follows:
<ul>
<li>There are a number of good applications to manage passwords, such as <strong>1Password</strong> at <a href="https://agilebits.com/onepassword" target="_blank">https://agilebits.com/onepassword</a> or <strong>Dashlane</strong> at <a href="https://www.dashlane.com/" target="_blank">https://www.dashlane.com</a><a href="https://agilebits.com/onepassword">.</a></li>
<li>For MFA, you can also try using <strong>Authy</strong> at <a href="https://www.authy.com/" target="_blank">https://www.authy.com</a>. This works like Google Authenticator but also has a centralized server allowing it to work across multiple devices (including desktop applications), so if you lose your phone, you won't lose access to AWS.</li>
</ul>
</div>
<p>As we have seen earlier, the root account usage should be limited to a bare minimum. So, in order to create virtual servers, configure services, and so on, we will rely on the IAM service which will let us have granular control over permissions for each user.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new user in IAM</h1>
                </header>
            
            <article>
                
<p>In this section, we will create and configure accounts for different individuals who need access to AWS. For now, we will keep things simple and only create an account for ourselves, as follows:</p>
<ol>
<li>
<p>Navigate to the <span class="packt_screen">IAM</span> menu in the AWS console (<a href="https://console.aws.amazon.com/iam/" target="_blank"><span class="MsoHyperlink">https://console.aws.amazon.com/iam/</span></a>) or go to the <span class="packt_screen">Services</span> drop-down list on the top left corner of the AWS console page and search for <kbd>IAM</kbd>:</p>
</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/cee7de26-a00f-483e-bc71-f348dd82a5bb.png"/></div>
<ol start="2">
<li>Choose the <span class="packt_screen">Users</span> option from the navigation pane.</li>
<li>Create a new user by clicking on the <span class="packt_screen">Add user</span> button, and make sure that you tick the <span class="packt_screen">Programmatic access</span> option to generate an access key ID and a secret access key for the user.</li>
<li>Select the default options for now and create a user. Don't forget to download credentials.</li>
<li>Back in the <span class="packt_screen">Users</span> menu, click on your username to access the details page.</li>
</ol>
<ol start="6">
<li>In the <span class="packt_screen">Permissions</span> tab, click on the <span class="packt_screen">Add permissions</span> button and select the <span class="packt_screen">Attach existing policies directly</span> option. Click on <span class="packt_screen">AdministratorAccess</span> to provide full access to AWS services and resources to our newly created user.</li>
<li>Select the checkbox next to the <span class="packt_screen">AdministratorAccess</span> option to provide full access to AWS services and resource to our newly created user. You will be left with a screen that looks like this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/38edc83d-43d9-4eab-91d6-e97173d81dd8.png"/></p>
<p style="padding-left: 60px">The last thing we need to do is add a password and turn on MFA for this account. This can be done as follows:</p>
<ol start="8">
<li>Click on the <span class="packt_screen">Security credentials</span> tab.</li>
<li>Now click on the <span class="packt_screen">Console password</span> option and enable the password for the newly created user. Set the password of your choice and click on the <span class="packt_screen">Apply</span> button.</li>
<li>Once you're done with adding a password, click on the <span class="packt_screen">Assigned MFA device</span> option.</li>
</ol>
<ol start="11">
<li>Select <span class="packt_screen">A virtual MFA device</span> option and follow the remaining instructions in order to turn on MFA in your newly created account. You will get a message stating that <span class="packt_screen">The MFA device was successfully associated with your account<strong>,</strong></span> as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2711ccdd-92c9-4bd2-ba8f-bbdfdd202ee6.png" style="width:26.08em;height:12.08em;"/></p>
<ol start="12">
<li>At this point, you are ready to start using the newly created user account. The important thing to note here is that signing in with an IAM user account is different from the root account. The main difference is that you sign in using a different URL.</li>
<li>Navigate to <a href="https://console.aws.amazon.com/iam/home#home" target="_blank"><span class="MsoHyperlink">https://console.aws.amazon.com/iam/home#home</span></a> or click on the <span class="packt_screen">Dashboard</span> in the <span class="packt_screen">IAM</span> menu.</li>
<li>You will see your unique sign-in URL under <span class="packt_screen">IAM users sign-in link</span>. Feel free to also customize the link. Save this new URL in your bookmarks, and, from now on, use this link to sign into the AWS console.</li>
<li>Sign out from the root account.</li>
<li>Sign back in, but this time use your IAM user account at <span class="MsoHyperlink"><kbd>https://AWS-account-ID</kbd> or <a href="https://us-east-1.signin.aws.amazon.com/oauth?SignatureVersion=4&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAJMOATPLHVSJ563XQ&amp;X-Amz-Date=2018-08-27T10%3A03%3A52.789Z&amp;X-Amz-Signature=bd1d9ecc1e645513ee09a2133776098ba8a82903c49d994f62fe4cb04a5d92d9&amp;X-Amz-SignedHeaders=host&amp;client_id=arn%3Aaws%3Aiam%3A%3A015428540659%3Auser%2Fhomepage&amp;redirect_uri=https%3A%2F%2Fconsole.aws.amazon.com%2Fconsole%2Fhome%3Fstate%3DhashArgs%2523%26isauthcode%3Dtrue&amp;response_type=code&amp;state=hashArgs%23">alias.signin.aws.amazon.com/console</a></span>.</li>
</ol>
<div class="packt_tip">Do not share your access key and secret key. By going through those steps, we enforced the use of MFA to access the AWS Console with our IAM user. We now need two factors (the password and the MFA token) to access the console. That said, we also created an access key which is far less secure. Anyone in possession of the secret key and access key (both present in the <kbd>credentials.csv</kbd>) will have full administrative access to the AWS account. Make sure to never share these credentials online. In <a href="0eb2bba9-5a84-4031-93d2-72dc4d6d4dd3.xhtml">Chapter 8</a>, <em>Hardening the Security of Your AWS Environment</em>, we will make a few changes to better protect this key and require the use of MFA to gain administrator privileges.</div>
<p>The next step in configuring our account is to configure our computers to interact with AWS using the command-line interface.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing and configuring the command-line interface (CLI)</h1>
                </header>
            
            <article>
                
<p>Using Amazon's web interface is usually a great way to explore new services. The problem is that when you want to go fast, create more repeatable steps, or create good documentation, having simple commands to execute becomes more efficient. Amazon provides a great and easy-to-use CLI. The tool is written in Python and therefore is cross-platform (Windows, Mac, and Linux).</p>
<p>We will install the tool on our laptop/desktop so that we can interact with AWS using bash commands. Linux and macOS X come natively with bash. If you use one of these operating systems, you can skip the next section. On Windows, we first need to install a feature called <strong>Windows Subsystem for Linux</strong> (<strong>WSL</strong>), which will give us the ability to run Bash commands that are very similar to what you get on Ubuntu Linux.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing WSL (Windows only)</h1>
                </header>
            
            <article>
                
<p>Nowadays, Linux and macOS X are among the most predominant OS used by developers. Windows recently released a partnership with Canonical, the company behind one of the most popular Linux distributions, support for Bash, and most of the common Linux packages. By installing this tool on Windows, we will be able to  interact with our servers <span>more efficiently</span><span>, which will also run Linux:</span></p>
<ol>
<li>Click on the Start button and search for <kbd>settings</kbd>, and then open the <span class="packt_screen">Settings</span> application:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/693e26db-782b-4fac-b619-8505f41b5e68.jpg" style="width:22.58em;height:39.67em;"/></p>
<ol start="2">
<li>This will lead you to the following window, where you have to search for <kbd>Windows Update settings</kbd>. Open the <span class="packt_screen">Windows Update settings</span> menu:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f4451a3e-1a0d-4cfa-9bcc-cf68caa4adb4.png" style="width:46.33em;height:36.67em;"/></p>
<ol start="3">
<li>In the left-hand side menu of <span class="packt_screen">Windows Update settings</span>, click on the <span class="packt_screen">For developers</span> sub-menu and turn on the <span class="packt_screen">Developer mode</span> option.</li>
<li>Once your developer mode is turned on, search in the search bar on the left-hand-side menu for the <kbd>Control Panel</kbd> option:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c8b255a1-221b-4987-9dae-b44b30839af8.png" style="width:50.50em;height:40.08em;"/></p>
<ol start="5">
<li>In the <span class="packt_screen">Control Panel</span> dashboard, select the <span class="packt_screen">Category</span> option from the <span class="packt_screen">View by</span> <span>drop-down,</span> and click on the <span class="packt_screen">Programs</span> option. Then, under <span class="packt_screen">Programs and Features</span>, click on the <span class="packt_screen">Turn Windows features on or off</span> option:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2e3f5df9-c6ce-405e-9cca-5faf1d2f95c6.png" style="width:49.58em;height:36.58em;"/></p>
<ol start="6">
<li>In this menu, find the feature called <span class="packt_screen">Windows Subsystem for Linux (Beta)</span>, and click on the <span class="packt_screen">OK</span> button:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0d5ef3e7-cf36-4a98-a6a1-d054b26781e4.png" style="width:26.58em;height:23.58em;"/></p>
<p style="padding-left: 60px">This will install the feature and ask you to restart your computer.</p>
<ol start="7">
<li>Once you are back in Windows, click on the Start button again, search for <kbd>bash</kbd>, and start the Bash on Ubuntu on the Windows application:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9feb5a78-ec22-4f50-9db9-c8ee5e2deb6b.png" style="width:49.08em;height:17.75em;"/></p>
<ol start="8">
<li>After a few initialization steps, you will be able to use Bash on Windows in the same way you would on Linux.</li>
</ol>
<p>From that point on, use the Bash application to run the commands present in the book.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the AWS CLI package</h1>
                </header>
            
            <article>
                
<p>The AWS CLI utility is written in Python. While there are several ways to install it, we will use <strong>PyPA</strong>, the Python package manager, to install this tool.</p>
<p>To install PyPA, depending on your OS, you will need to run the following commands:</p>
<ul>
<li>On Windows:</li>
</ul>
<pre style="padding-left: 90px"><strong>$ sudo apt install python-pip</strong></pre>
<ul>
<li>On macOS X:</li>
</ul>
<pre style="padding-left: 90px"><strong>$ sudo easy_install pip</strong></pre>
<ul>
<li>On Debian-based Linux distributions:</li>
</ul>
<pre style="padding-left: 90px"><strong>$ sudo apt-get install python-pip python-dev build-essential</strong>  </pre>
<ul>
<li>On Red Hat/CentOS-based Linux distributions:</li>
</ul>
<pre style="padding-left: 60px">    <strong>$ sudo yum -y install python-pip</strong>  </pre>
<p>Once PyPA is installed, you will get access to the <kbd>pip</kbd> command.</p>
<p>Lastly, to install the AWS CLI using the <kbd>pip</kbd> command, you simply need to run the following command:</p>
<pre><strong>$ sudo pip install --upgrade --user awscli</strong> </pre>
<p>If you get an output to upgrade your <kbd>pip</kbd> version to the latest available level, execute <kbd>pip install --upgrade pip</kbd>.</p>
<div class="packt_infobox">We have demonstrated all of the outputs from CentOS-based Linux distribution but the process is equally applicable on all of the mentioned supported platforms.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring the AWS CLI</h1>
                </header>
            
            <article>
                
<p>To do this, you will need to extract the AWS access key ID and secret access key from the file downloaded in step 4 of the <em>Creating a new user in IAM</em> section:</p>
<pre><strong>$ more credentials.csv</strong><br/><strong>User Name,Access Key Id,Secret Access Key "yogeshraheja", AKIAII55DTLEV3X4ETAQ, mL2dEC8/ryuZ7fu6UI6kOm7PTlfROCZpai07Gy6T</strong> </pre>
<p>We will run the following command to configure our AWS account:</p>
<pre><strong>$ aws configure</strong><br/>AWS Access Key ID [None]: AKIAII55DTLEV3X4ETAQ<br/>AWS Secret Access Key [None]: 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<br/>Default region name [None]: us-east-1<br/>Default output format [None]: </pre>
<p>At this point, we are ready to start using the CLI. We can quickly verify that everything is working by listing the user accounts, as follows:</p>
<pre><strong>$ aws iam list-users</strong><br/>{<br/>    "Users": [<br/>        {<br/>            "UserName": "yogeshraheja",<br/>            "PasswordLastUsed": "2018-08-07T09:57:53Z",<br/>            "CreateDate": "2018-08-07T04:56:03Z",<br/>            "UserId": "AIDAIN22VCQLK43UVWLMK",<br/>            "Path": "/",<br/>            "Arn": "arn:aws:iam::094507990803:user/yogeshraheja"<br/>        }<br/>    ]<br/>}</pre>
<div class="packt_infobox"><span class="packt_screen">AWS aws-shell</span><br/>
Amazon has a second CLI tool called <kbd>aws-shell</kbd>. This tool is more interactive than the classic <kbd>awscli</kbd> command, as it offers out-of-the-box auto-completion and a split-screen view that lets you access the documentation as you type your commands. If you are a new AWS user, give it a shot (<kbd>pip install aws-shell</kbd>).</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating our first web server</h1>
                </header>
            
            <article>
                
<p>Now that we have our environment set up, we are finally ready to launch our first EC2 instance. There are a couple of ways to do that. Since we just installed and configured <kbd>awscli</kbd> and we want to see effective ways of managing infrastructures, we will demonstrate how to do this using the CLI.</p>
<p>Launching a virtual server requires having a certain amount of information ahead of time. We will use the <kbd>aws ec2 run-instances</kbd> command, but we need to supply it with the following:</p>
<ul>
<li>An AMI ID</li>
<li>An instance type</li>
<li>A security group</li>
<li>An SSH key-pair</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Amazon Machine Images (AMIs)</h1>
                </header>
            
            <article>
                
<p>An AMI is a package that contains, among other things, the root file system with the operating system (for example, Linux, UNIX, or Windows) as well as additional software required to start up the system. To find the proper AMI, we will use the <kbd>aws ec2 describe-images</kbd> command. By default, the <kbd>describe-images</kbd> command will list all available public AMIs, which is way over 3 million by now. To get the best out of that command, it is important to combine it with the filter option to only include the AMI we would like to use. In our case, we want to use the following to filter our AMIs:</p>
<ul>
<li>We want the name to be Amazon Linux AMI, which designates the Linux distribution officially supported by AWS. Amazon Linux is based off Red Hat/CentOS but includes a few extra packages to make the integration with other AWS services easy to do. You can read more about AWS Linux at <span class="MsoHyperlink"><a href="http://amzn.to/2uFT13F" target="_blank">http://amzn.to/2uFT13F</a>.</span></li>
<li>We want to use the <kbd>x84_64</kbd> bits version of Linux to match the architecture we will use.</li>
<li>The virtualization type should be HVM, which stands for hardware virtual machine. This is the newest and best-performing type of virtualization.</li>
<li>We want GP2 support, which will let us use the newest generation of instances that don't come with <em>instance store,</em> meaning that the servers that power our instances will be different from the servers that store our data.</li>
</ul>
<p>In addition, we will sort the output by age and only look at the most recently released AMI:</p>
<pre><strong>$ aws ec2 describe-images --filters "Name=description,Values=Amazon Linux AMI * x86_64 HVM GP2" --query 'Images[*].[CreationDate, Description, ImageId]' --output text | sort -k 1 | tail</strong></pre>
<p>The output of running the preceding command can be shown as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b5850390-3f22-4650-ba95-ec90894f10a7.png" style="width:58.92em;height:15.08em;"/></p>
<p>As you can see, at this time, the most recent AMI ID is <kbd>ami-cfe4b2b0</kbd>. This might differ by the time you execute the same command, as the Amazon vendors included regularly update their OS.</p>
<div class="packt_tip">When using the <kbd>aws cli --query</kbd> option, the output can be very consequential for certain commands. Taking the preceding example, if we only care about a subset of information, we can supplement the commands with the <kbd>--query</kbd> option to filter the information we want only<span>. This option uses the</span> <strong>JMESPath</strong> <span>query language.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Instance types</h1>
                </header>
            
            <article>
                
<p>In this section, we will select the virtual hardware to use for our virtual server. AWS provides a number of options best described in their documentation at <a href="https://aws.amazon.com/ec2/instance-types/" target="_blank"><span class="MsoHyperlink">https://aws.amazon.com/ec2/instance-types/</span></a>. We will talk about instance types in more detail in <a href="c54f64c9-e8a3-4eed-b68d-087ff40f8b1d.xhtml">Chapter 6</a>, <a href="c54f64c9-e8a3-4eed-b68d-087ff40f8b1d.xhtml"/><em>Scaling Your Infrastructure</em>.</p>
<p>For now, we will select the <kbd>t2.micro</kbd> instance type as it is eligible for the AWS free usage tier.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Security groups</h1>
                </header>
            
            <article>
                
<p>Security groups work a bit like firewalls. All EC2 instances have a set of security groups assigned to them, and each security group contains rules to allow traffic to flow inbound (<strong>ingress</strong>) and/or outbound (<strong>egress</strong>).</p>
<p>For this exercise, we will create a small web application running on port <kbd>tcp/3000</kbd>. In addition, we want to be able to SSH into the instance, so we also need to allow inbound traffic to port <kbd>tcp/22</kbd>. We will create a simple security group to allow this, by performing the following steps:</p>
<ol>
<li>First, we need to find out our default <strong>virtual private cloud</strong> (<strong>VPC</strong>) ID. Despite being in a cloud environment, where the physical resources are shared by all AWS customers, there is still a strong emphasis on security. AWS segmented their virtual infrastructure using the concept of VPC. You can imagine this as being a virtual datacenter with its own network. The security groups that protect our EC2 instances are tied with subnets that in turn are tied to the network that the VPC provides:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e89e10dd-525c-4dd0-8d7c-28cf71e18dd4.png" style="width:50.17em;height:27.17em;"/></p>
<p style="padding-left: 60px">To identify our VPC ID, we can run the following command:</p>
<pre>    <strong>$ aws ec2 describe-vpcs<br/></strong>
    {
        "Vpcs": [
            {
                "VpcId": "vpc-4cddce2a",
                "InstanceTenancy": "default",
                "CidrBlockAssociationSet": [
                    {
                        "AssociationId": "vpc-cidr-assoc-3c313154",
                        "CidrBlock": "172.31.0.0/16",
                        "CidrBlockState": {
                            "State": "associated"
                        }
                    }
                ],
                "State": "available",
                "DhcpOptionsId": "dopt-c0be5fa6",
                "CidrBlock": "172.31.0.0/16",
                "IsDefault": true
            }
        ]
    } </pre>
<ol start="2">
<li>Now that we know the VPC ID (yours will be different), we can create our new security group, as follows:</li>
</ol>
<pre style="padding-left: 60px">    <strong>$ aws ec2 create-security-group \</strong>
        <strong>--group-name HelloWorld \</strong>
        <strong>--description "Hello World Demo" \</strong>
        <strong>--vpc-id vpc-4cddce2a<br/></strong>
    {
        "GroupId": "sg-01864b4c"
    }</pre>
<ol start="3">
<li>By default, security groups allow all outbound traffic from the instance. We just need to open up SSH (<kbd>tcp/22</kbd>) and <kbd>tcp/3000</kbd> for inbound traffic. We then need to input the following:</li>
</ol>
<pre style="padding-left: 60px">    <strong>$ aws ec2 authorize-security-group-ingress \</strong>
        <strong>--group-name HelloWorld \</strong>
        <strong>--protocol tcp \</strong>
        <strong>--port 22 \</strong>
        <strong>--cidr 0.0.0.0/0</strong>
    
    <strong>$ aws ec2 authorize-security-group-ingress \</strong>
        <strong>--group-name HelloWorld \</strong>
        <strong>--protocol tcp \</strong>
        <strong>--port 3000 \</strong>
        <strong>--cidr 0.0.0.0/0</strong>  </pre>
<ol start="4">
<li>We can now verify the change made using the following code, as the previous commands aren't verbose:</li>
</ol>
<pre style="padding-left: 60px">    <strong>$ aws ec2 describe-security-groups \</strong>
        <strong>--group-names HelloWorld \</strong>
        <strong>--output text<br/></strong>
    SECURITYGROUPS  Hello World Demo    sg-01864b4c     HelloWorld      <br/>    094507990803    vpc-4cddce2a
    IPPERMISSIONS   22      tcp     22
    IPRANGES        0.0.0.0/0
    IPPERMISSIONS   3000    tcp     3000
    IPRANGES        0.0.0.0/0
    IPPERMISSIONSEGRESS     -1
    IPRANGES        0.0.0.0/0 <strong> </strong></pre>
<p>As expected, we opened up the traffic to the proper ports. If you know how to find your public IP, you can improve the SSH rule by replacing <kbd>0.0.0.0/0</kbd> with your IP/32 so that only you can try to SSH into that EC2 instance.</p>
<div class="CDPAlignLeft CDPAlign packt_tip"><span class="packt_screen">Using the aws cli --output option</span><br/>
By default, most of the commands will return a JSON output. AWS has a a certain number of options globally available. You can see them used a bit in this chapter. The first option is <kbd>--output [json | text | table]</kbd>:</div>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f8f066db-fef2-47a2-a091-1c8768870275.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Generating your SSH keys</h1>
                </header>
            
            <article>
                
<p>By default, Amazon EC2 uses SSH key pairs to give you SSH access to your EC2 instances. You can either generate a key pair in EC2 and download the private key or generate a key yourself using a third-party tool such as OpenSSL, importing the public key in EC2. We will use the first method to create EC2 SSH keys.</p>
<p>Here, ensure that you set read only permissions on your newly generated private (<kbd>.pem</kbd>) key file:</p>
<pre style="padding-left: 30px">    <strong>$ aws ec2 create-key-pair --key-name EffectiveDevOpsAWS --query   <br/>    'KeyMaterial' --output text &gt; ~/.ssh/EffectiveDevOpsAWS.pem</strong>
    
    <strong>$ aws ec2 describe-key-pairs --key-name EffectiveDevOpsAWS</strong>
    <strong>{</strong>
    <strong>    "KeyPairs": [</strong>
    <strong>        {</strong>
    <strong>            "KeyName": "EffectiveDevOpsAWS",</strong>
    <strong>            "KeyFingerprint": <br/>          "27:83:5d:9b:4c:88:f6:15:c7:39:df:23:4f:29:21:3b:3d:49:e6:af"</strong>
    
    <strong>        }</strong>
    <strong>    ]</strong>
    <strong>}</strong>
    
    <strong>$ cat ~/.ssh/EffectiveDevOpsAWS.pem</strong><br/><strong>    -----BEGIN RSA PRIVATE KEY-----<br/>MIIEpAIBAAKCAQEAiZLtUMnO2OKnHvTJOiIP26fThdsU0YRdlKI60in85x9aFZXSrZsKwOhWPpMtnUMJKeGvVQut+gJ1I1PNNjPqS2Dy60jH55hntUhr/ArpaL2ISDX4BgRAP1jcukBqS6+pL+mTp6OUNTToUt7LvAZoeo+10SYbzHF1ZMQLLs96fCMNvnbJdUCa904dJjJs7t/G2ou9RiNMRx8midrWcmmuGKOb1s6FgrxJ5OAMYegeccFVfGOjqPk3f+6QTPOTMNgNQ8ANKOMA9YtcIca/75QGUPifusTqUT4Fqtv3rbUYPvacAnYL9eCthtn1XMG7Oo/mR5MrU60wib2QcPipmrGNbwIDAQABAoIBABSyqkmxUxGGaCZcJbo9Ta16fnRxFZzAEWQ/VCIydv4+1UrSE7RS0zdavT8E3aP/Ze2LKtncu/wVSpJaFVHGVcWpfGKxvIG3iELZ9oUhDyTW/x3+IKanFRNyxyKudk+UyhuPRMu/7JhksV9mbbiILkfiPzSMSzpjB4p1hEkypfbvBnrbB+sRycx+jK5l209rNDukkJVvyFCnqPiH0wmvKRqHTNOMGWmM6CPOU+VpuMX+dIlrSeId7j6hqMjA0rGncnxYi035v2zicvIsEKHZ9MZCnkiRb3kJ9PhueTwwUQmoBYfV5E+1Wu34UmdsmALQEX3xniaR6xf9iWhQ2Nh8LaECgYEAzXHOZDPAUzXitO735KBUaiBp9NMv2gzE862Yf2rmDkFM4Y5RE3DKHrKfeOkrYqlG11On0m44GHBk/g4eqqIEaBjVp6i/Lk74tpQU6Kn1HT3w9lbXEFsCWjYZnev5oHP6PdedtRYNzZsCSNUdlw0kOG5WZZJ4E7mPZyrvK5pq+rMCgYEAq22KT0nD3d59V+LVVZfMzJuUBDeJeD139mmVbzAq9u5Hr4MkurmcIj8Q6jJIQaiC8XC1gBVEl08ZN2oY1+CBE+Gesi7mGOQ2ovDmoTfYRgScKKHv7WwR+N5/N7o26x+ZaoeaBe43Vjp6twaTpKkBOIuT50tvb25v9+UVMpGKcFUC<br/>gYEAoOFjJ3KjREYpT1jnROEM2cKiVrdefJmNTel+RyF2IGmgg+1Hrjqf/OQSH8QwVmWK9SosfIwVX4X8gDqcZzDS1JXGEjIB7IipGYjiysP1D74myTF93u/16qD89H8LD0xjBTSo6lrn2j9tzY0eS+Bdodc9zvKhF4kzNC4Z9wJIjiMCgYAOtqstXP5zt5n4hh6bZxkL4rqUlhO1f0khnDRYQ8EcSp1agh4P7Mhq5BDWmRQ8lnMOuAbMBIdLmV1ntTKGrN1HUJEnaAEV19icqaKR6dIlSFYC4stODH2KZ8ZxiQkXqzGmxBbDNYwIWaKYvPbFJkBVkx1Rt9bLsKXpl/72xSkltQKBgQCYEjUVp4dPzZL1CFryOwV72PMMX3FjOflTgAWr8TJBq/OLujzgwYsTy6cdD3AqnMQ2BlU7Gk4mmDZCVVsMqHFbIHEa5Y4e5qIQhamedl3IgmnMpdyuDYaT/Uh4tw0JxIJabqm+sQZv4s1Otgh00JlGrgFs+0D39Fy8qszqr6J04w==<br/>-----END RSA PRIVATE KEY-----<br/></strong>
    <strong>$ chmod 400 ~/.ssh/EffectiveDevOpsAWS.pem</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Launching an EC2 instance</h1>
                </header>
            
            <article>
                
<p>We now have all the information required to launch our instance. Let's finally launch it as follows:</p>
<pre><strong>$ aws ec2 run-instances \</strong><br/><strong>    --instance-type t2.micro \</strong><br/><strong>    --key-name EffectiveDevOpsAWS \</strong><br/><strong>    --security-group-ids sg-01864b4c \</strong><br/><strong>    --image-id ami-cfe4b2b0</strong><br/>{<br/>    "Instances": [<br/>        {<br/>            "Monitoring": {<br/>                "State": "disabled"<br/>            },<br/>            "PublicDnsName": "",<br/>            "StateReason": {<br/>                "Message": "pending",<br/>                "Code": "pending"<br/>            },<br/>            "State": {<br/>                "Code": 0,<br/>                "Name": "pending"<br/>            },<br/>            "EbsOptimized": false,<br/>            "LaunchTime": "2018-08-08T06:38:43.000Z",<br/>            "PrivateIpAddress": "172.31.22.52",<br/>            "ProductCodes": [],<br/>            "VpcId": "vpc-4cddce2a",<br/>            "CpuOptions": {<br/>                "CoreCount": 1,<br/>                "ThreadsPerCore": 1<br/>            },<br/>            "StateTransitionReason": "",<br/>            "InstanceId": "i-057e8deb1a4c3f35d",<br/>            "ImageId": "ami-cfe4b2b0",<br/>            "PrivateDnsName": "ip-172-31-22-52.ec2.internal",<br/>            "KeyName": "EffectiveDevOpsAWS",<br/>            "SecurityGroups": [<br/>                {<br/>                    "GroupName": "HelloWorld",<br/>                    "GroupId": "sg-01864b4c"<br/>                }<br/>            ],<br/>            "ClientToken": "",<br/>            "SubnetId": "subnet-6fdd7927",<br/>            "InstanceType": "t2.micro",<br/>            "NetworkInterfaces": [<br/>                {<br/>                    "Status": "in-use",<br/>                    "MacAddress": "0a:d0:b9:db:7b:38",<br/>                    "SourceDestCheck": true,<br/>                    "VpcId": "vpc-4cddce2a",<br/>                    "Description": "",<br/>                    "NetworkInterfaceId": "eni-001aaa6b5c7f92b9f",<br/>                    "PrivateIpAddresses": [<br/>                        {<br/>                            "PrivateDnsName": "ip-172-31-22-<br/>                             52.ec2.internal",<br/>                            "Primary": true,<br/>                            "PrivateIpAddress": "172.31.22.52"<br/>                        }<br/>                    ],<br/>                    "PrivateDnsName": "ip-172-31-22-52.ec2.internal",<br/>                    "Attachment": {<br/>                        "Status": "attaching",<br/>                        "DeviceIndex": 0,<br/>                        "DeleteOnTermination": true,<br/>                        "AttachmentId": "eni-attach-0428b549373b9f864",<br/>                        "AttachTime": "2018-08-08T06:38:43.000Z"<br/>                    },<br/>                    "Groups": [<br/>                        {<br/>                            "GroupName": "HelloWorld",<br/>                            "GroupId": "sg-01864b4c"<br/>                        }<br/>                    ],<br/>                    "Ipv6Addresses": [],<br/>                    "OwnerId": "094507990803",<br/>                    "SubnetId": "subnet-6fdd7927",<br/>                    "PrivateIpAddress": "172.31.22.52"<br/>                }<br/>            ],<br/>            "SourceDestCheck": true,<br/>            "Placement": {<br/>                "Tenancy": "default",<br/>                "GroupName": "",<br/>                "AvailabilityZone": "us-east-1c"<br/>            },<br/>            "Hypervisor": "xen",<br/>            "BlockDeviceMappings": [],<br/>            "Architecture": "x86_64",<br/>            "RootDeviceType": "ebs",<br/>            "RootDeviceName": "/dev/xvda",<br/>            "VirtualizationType": "hvm",<br/>            "AmiLaunchIndex": 0<br/>        }<br/>    ],<br/>    "ReservationId": "r-09a637b7a3be11d8b",<br/>    "Groups": [],<br/>    "OwnerId": "094507990803"<br/>}</pre>
<p>You can track the progress of the instance creation. To do that, get the instance ID provided in the output of the <kbd>aws ec2 run-instances</kbd> command and run the following command:</p>
<pre><strong>$ aws ec2 describe-instance-status --instance-ids i-057e8deb1a4c3f35d</strong><br/>{<br/>    "InstanceStatuses": [<br/>        {<br/>            "InstanceId": "i-057e8deb1a4c3f35d",<br/>            "InstanceState": {<br/>                "Code": 16,<br/>                "Name": "running"<br/>            },<br/>            "AvailabilityZone": "us-east-1c",<br/>            "SystemStatus": {<br/>                "Status": "initializing",<br/>                "Details": [<br/>                    {<br/>                        "Status": "initializing",<br/>                        "Name": "reachability"<br/>                    }<br/>                ]<br/>            },<br/>            "InstanceStatus": {<br/>                "Status": "initializing",<br/>                "Details": [<br/>                    {<br/>                        "Status": "initializing",<br/>                        "Name": "reachability"<br/>                    }<br/>                ]<br/>            }<br/>        }<br/>    ]<br/>}</pre>
<p>The instance will be ready once the status under <kbd>SystemStatus</kbd> changes from <kbd>initializing</kbd> to <kbd>ok</kbd>:</p>
<pre><strong>$ aws ec2 describe-instance-status --instance-ids i-057e8deb1a4c3f35d --output text| grep -i SystemStatus</strong><br/><strong><br/></strong>SYSTEMSTATUS ok</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Connecting to the EC2 instance using SSH</h1>
                </header>
            
            <article>
                
<p>The main goal of this chapter is to create a simple <kbd>Hello World</kbd> web application. Since we are starting with a Vanilla OS, we need to connect to the host to make the necessary changes to turn our standard server into a web server. In order to SSH our instance, we need to find the DNS name of our running instance, as follows:</p>
<pre><strong>$ aws ec2 describe-instances \</strong><br/><strong>    --instance-ids i-057e8deb1a4c3f35d \</strong><br/><strong>    --query "Reservations[*].Instances[*].PublicDnsName"</strong><br/><strong><br/></strong>[<br/>    [<br/>        "ec2-34-201-101-26.compute-1.amazonaws.com"<br/>    ]<br/>]      </pre>
<p>We now have the public DNS name of our instance and the private key to SSH into it. The last thing to know is that, for the OS that we selected while choosing our AMI in Amazon Linux, the default user account is called <kbd>ec2-user</kbd>:</p>
<pre><strong>$ ssh -i ~/.ssh/EffectiveDevOpsAWS.pem ec2-user@ ec2-34-201-101-26.compute-1.amazonaws.com</strong><br/><br/>The authenticity of host 'ec2-34-201-101-26.compute-1.amazonaws.com (172.31.22.52)' can't be established.<br/><br/>ECDSA key fingerprint is SHA256:V4kdXmwb5ckyU3hw/E7wkWqbnzX5DQR5zwP1xJXezPU.<br/><br/>ECDSA key fingerprint is MD5:25:49:46:75:85:f1:9d:f5:c0:44:f2:31:cd:e7:55:9f.<br/><br/>Are you sure you want to continue connecting (yes/no)? yes<br/>Warning: Permanently added 'ec2-34-201-101-26.compute-1.amazonaws.com,172.31.22.52' (ECDSA) to the list of known hosts.<br/><br/>       __| __|_ )<br/>       _| ( / Amazon Linux AMI<br/>      ___|\___|___|<br/><br/><br/>https://aws.amazon.com/amazon-linux-ami/2018.03-release-notes/<br/><br/>1 package(s) needed for security, out of 2 available<br/><br/>Run "sudo yum update" to apply all updates.<br/>[ec2-user@ip-172-31-22-52 ~]$</pre>
<p>If you experience any issues, add the <kbd>-vvv</kbd> option in your SSH command to troubleshoot it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a simple Hello World web application</h1>
                </header>
            
            <article>
                
<p>Now that we are connected to our EC2 instance, we are ready to start playing around with it. In this book, we will focus on the most common use case for AWS in tech companies: hosting an application. In terms of languages, we will use JavaScript, which is one of the most popular languages on GitHub. That said, this application is  aimed <span>more </span><span>at giving support in order to demonstrate how to best use AWS using the DevOps principles. Having any kind of knowledge about JavaScript isn't required in order to understand this book:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/74869af1-18ea-46ef-ba9c-fe358d404429.png" style="width:43.33em;height:25.08em;"/></p>
<p>Some of the main advantages that JavaScript offers with regards to this book include the fact that:</p>
<ul>
<li>It is fairly easy to write and read, even for beginners</li>
<li>It doesn't need to be compiled</li>
<li>It can be run server side thanks to Node.js (<a href="https://nodejs.org" target="_blank"><span class="MsoHyperlink">https://nodejs.org</span></a>)</li>
<li>It is officially supported by AWS and therefore the AWS SDK for JavaScript is a <em>first-class citizen</em></li>
</ul>
<p>For the rest of the chapter, all the commands and code are to be run on our instance through SSH.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Node.js</h1>
                </header>
            
            <article>
                
<p>The first thing we need to do is install Node.js. Amazon Linux is based on <strong>Red Hat Enterprise Linux</strong> (<strong>RHEL</strong>) and uses the <kbd>yum</kbd> utility to manage and install packages. The OS comes with <strong>Extra Packages for Enterprise Linux</strong> (<strong>EPEL</strong>) preconfigured in it. As we would expect, Node.js is present in EPEL:</p>
<pre><strong>[ec2-user@ip-172-31-22-52 ~]$ sudo yum install --enablerepo=epel -y nodejs </strong><br/><strong>[ec2-user@ip-172-31-22-52 ~]$ node -v</strong><br/><strong>v0.10.48</strong></pre>
<p>This is definitely an old version of the node but it's going to be good enough for what we need.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running a Node.js Hello World application</h1>
                </header>
            
            <article>
                
<p>Now that the node is installed, we can create a simple Hello World application. Here is the code for creating this:</p>
<pre>var http = require("http") http.createServer(function (request, response) {<br/>// Send the HTTP header<br/>// HTTP Status: 200 : OK<br/>// Content Type: text/plain<br/>response.writeHead(200, {'Content-Type': 'text/plain'})<br/>// Send the response body as "Hello World" response.end('Hello World\n')<br/>}).listen(3000)<br/><br/>// Console will print the message console.log('Server running')    </pre>
<p>Feel free to copy this into a file. Alternatively, if you want to save time, download this from GitHub:</p>
<pre><strong>[ec2-user@ip-172-31-22-52 ~]$ <br/>wget https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.js -O /home/ec2-user/helloworld.js<br/>--2018-08-19 13:06:42-- https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.js<br/>Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.200.133<br/>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.200.133|:443... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 384 [text/plain]<br/>Saving to: ‘/home/ec2-user/helloworld.js’<br/><br/>/home/ec2-user/helloworld.js 100%[=====================================================================================&gt;] 384 --.-KB/s in 0s<br/><br/>2018-08-19 13:06:42 (37.9 MB/s) - ‘/home/ec2-user/helloworld.js’ saved [384/384] <br/><br/><br/>[ec2-user@ip-172-31-22-52 ~]$ </strong> </pre>
<p>In order to run the Hello World application, we are now simply going to run the following code:</p>
<pre><strong>[ec2-user@ip-172-31-22-52 ~]$ node helloworld.js  
Server running</strong> </pre>
<p>If everything goes well, you will now be able to open this in your browser at the following link: <span class="MsoHyperlink"><kbd>http://your-public-dns-name:3000</kbd>. O</span><span class="MsoHyperlink">r in my case, this will be found here: <kbd>http://ec2-34-201-101-26.compute-1.amazonaws.com:3000</kbd></span>. You will then be able to see the result, as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cf05de32-d99b-47e8-ac17-ffaf0d1003e9.png" style="width:50.17em;height:7.17em;"/></p>
<p>We will now stop the execution of the Hello World web application with <em>Ctrl</em> + <em>C</em> in your Terminal window.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Turning our simple code into a service using upstart</h1>
                </header>
            
            <article>
                
<p>Since we started the node application manually in the Terminal, closing the SSH connection or hitting <em>Ctrl</em> + <em>C</em> on the keyboard will stop the node process, and therefore our Hello World application will not work anymore. Amazon Linux, unlike a standard Red Hat-based distribution, comes with a system called <strong>upstart</strong>.</p>
<p>This is fairly easy to use and provides a couple of extra features that traditional <strong>System-V bootup</strong> scripts don't have, such as the ability to respawn a process that died unexpectedly. To add an upstart configuration, you need to create a file inside <kbd>/etc/init</kbd> on the EC2 instance.</p>
<p>Here is the code to insert it in <kbd>/etc/init/helloworld.conf</kbd>:</p>
<pre>description "Hello world Daemon"<br/><br/># Start when the system is ready to do networking. Start on started elastic-network-interfaces<br/><br/># Stop when the system is on its way down. Stop on shutdown<br/><br/>respawn script<br/>exec su --session-command="/usr/bin/node /home/ec2-user/helloworld.js" ec2-user<br/>end script</pre>
<div class="packt_tip"><em>Why start on elastic network interfaces? </em>If you are familiar with upstart outside of AWS, you might have used start on run level [345]. In AWS, t<span>he problem with that is that your network comes from</span> <strong>Elastic Network Interface</strong> <span>(</span><strong>ENI</strong><span>), and if your application starts before this service, it might not be able to connect to the network correctly.</span></div>
<pre><strong>[ec2-user@ip-172-31-22-52 ~]$ </strong><br/><strong>sudo wget https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.conf -O /etc/init/helloworld.conf</strong><br/><strong>--2018-08-19 13:09:39-- https://raw.githubusercontent.com/yogeshraheja/Effective-DevOps-with-AWS/master/Chapter02/helloworld.conf</strong><br/><strong>Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.200.133</strong><br/><strong>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.200.133|:443... connected.</strong><br/><strong>HTTP request sent, awaiting response... 200 OK</strong><br/><strong>Length: 301 [text/plain]</strong><br/><strong>Saving to: ‘/etc/init/helloworld.conf’</strong><br/><br/><strong>/etc/init/helloworld.conf 100%[=====================================================================================&gt;] 301 --.-KB/s in 0s</strong><br/><br/><strong>2018-08-19 13:09:39 (54.0 MB/s) - ‘/etc/init/helloworld.conf’ saved [301/301]</strong><br/><br/><br/><strong>[ec2-user@ip-172-31-22-52 ~]$</strong></pre>
<p>We can now simply start our application, as follows:</p>
<pre><strong>[ec2-user@ip-172-31-22-52 ~]$ sudo start helloworld</strong><br/><strong>helloworld start/running, process 2872</strong><br/><strong>[ec2-user@ip-172-31-22-52 ~]$</strong></pre>
<p>As expected, <kbd>http://your-public-dns-name:3000</kbd> still works, and this time we can safely close our SSH connection.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Terminating our EC2 instance</h1>
                </header>
            
            <article>
                
<p>As with most Hello World exercises, once the <kbd>helloworld</kbd> message is displayed, the goal is reached. It is now time to think about shutting down our server. Since we only pay for what we consume <span>in AWS</span><span>, freeing up unnecessary resources such as this server is a good strategy for making AWS very cost effective.</span></p>
<p>We can do a clean shutdown of the Hello World service using the <kbd>stop</kbd> command. We can then exit the virtual server and terminate our instance, as follows:</p>
<pre><strong>[ec2-user@ip-172-31-22-52 ~]$ sudo stop helloworld 
helloworld stop/waiting 
[ec2-user@ip-172-31-22-52 ~]$ ec2-metadata --instance-id 
instance-id: i-057e8deb1a4c3f35d 
[ec2-user@ip-172-31-22-52 ~]$ exit 
logout 
$ aws ec2 terminate-instances --instance-ids i-057e8deb1a4c3f35d 
{ 
    "TerminatingInstances": [ 
        { 
            "InstanceId": "i-057e8deb1a4c3f35d", 
            "CurrentState": { 
                "Code": 32, 
                "Name": "shutting-down" 
            }, 
            "PreviousState": { 
                "Code": 16, 
                "Name": "running" 
            } 
        } 
    ] 
}</strong> </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>This chapter was a quick and simple introduction to AWS and its most notorious service, EC2. After signing up for AWS, we configured our environment in such a way that we could create a virtual server using the command-line interface. Leading to this, we selected our first AMI, created our first security group, and generated our SSH keys, which we will reuse throughout the book. After launching an EC2 instance, we manually deployed a simple Node.js application to display Hello World.</p>
<p>While the process wasn't very fastidious thanks to the AWS CLI, it still required going through numerous steps, which aren't very repeatable. We also deployed the application without any automation or validation. Furthermore, the only way we can check if the application is running is by manually checking the endpoint. In the remainder of the book, we will revisit the process of creating and managing web applications and infrastructure, but, this time, we will follow the DevOps principles and incorporate their best practices.</p>
<p>In <a href="">Chapter 3</a><em>, Treating Your Infrastructure as Code</em>, we will address one of the first issues we encountered: managing our infrastructure with automation. To do that, we will write code to manage our infrastructure.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p>Please answer the following questions:</p>
<ol>
<li>How do you create a free-tier AWS account?</li>
<li>How do you create your first AWS cloud instance using the AWS Console portal?</li>
<li>How do you create your first AWS cloud instance using the AWS CLI utility?</li>
<li>How do you deploy a simple Hello World web application on your newly created AWS instance?</li>
<li>How do you destroy your created AWS instance to complete this exercise?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>Refer to the following links for for more information on AWS and AWS CLI:</p>
<ul>
<li><strong>AWS Free Tier</strong>: <a href="https://aws.amazon.com/free/">https://aws.amazon.com/free/</a><a href="https://aws.amazon.com/free/"/></li>
<li><strong>AWS Command Line Interface</strong>: <a href="https://aws.amazon.com/cli/" target="_blank">https://aws.amazon.com/cli/</a><a href="https://aws.amazon.com/cli/"/></li>
</ul>


            </article>

            
        </section>
    </body></html>