<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Exploring Operations Automation Strategies</h1>
                </header>
            
            <article>
                
<p><span>In the previous chapter, we introduced the Design for Operations objective by covering Application and platform monitoring and alerting strategies.</span></p>
<p>This chapter covers how to design an operations automation strategy using Azure Automation, Chef, Puppet, PowerShell, Desired State Configuration (DSC), Event Grid, Azure Logic Apps, and how to define an autoscaling strategy.</p>
<p>The following topics will be covered:</p>
<ul>
<li><span>Designing an operations automation strategy </span></li>
<li><span>Designing an autoscaling strategy</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing an Operations Automation Strategy</h1>
                </header>
            
            <article>
                
<p>Automating steps in Azure is a great solution to ensure consistency in your deployments and save time. It reduces errors when applications need to be deployed between different environments in a <span>Development, Testing, Acceptance, and Production (</span>DTAP) architecture. It also saves a lot of time when resources need to be deployed repeatedly, such as multiple development VMs for a team of developers.</p>
<p>Azure offers different solutions and methods in order to design a successful automation strategy, which are described in the following sections. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure PowerShell</h1>
                </header>
            
            <article>
                
<p>Azure PowerShell can be used to create Azure resources, manage and configure your resources, and for automation as well.</p>
<p>Azure PowerShell is used for several examples throughout this book to automate different tasks, such as creating virtual machines and creating network interfaces. It can be used from your local machine, as well as from Azure Cloud Shell. You can use PowerShell for almost everything in Azure that can be done from the Azure Portal and even for some Azure resources, PowerShell offers additional capabilities that can't even be configured from the Azure Portal. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Desired State Configuration</h1>
                </header>
            
            <article>
                
<p><span>DSC is the process of forcing a configuration on a system. It uses configuration files that consist of PowerShell scripts. These scripts are responsible for making the required configurations to the system and for ensuring that these systems stay in sync. So for example, when you have created a DSC file to configure IIS on a Windows Server and this is removed by an administrator, the DSC file will reinstall and configure IIS again.</span></p>
<p><span>DSC uses three key features to configure the machines:</span></p>
<ul>
<li><span><strong>Configurations</strong>: A set of PowerShell scripts that configure the resources. These scripts also ensure that the systems remain configured in the desired state. It uses <strong>Nodes</strong> to define the resources that are being configured. </span></li>
<li><strong>Resources</strong>: These are the different building blocks that need to be configured on the machine. For example, this can be a WindowsFeature Resource or a Environment Resource.</li>
<li><strong>Local Configuration Manager (LCM)</strong>: This is the engine that deploys the scripts to the machines. LCM regularly polls the different machines to ensure that the desired state of the machines is maintained. If systems are out of sync, LCM runs the scripts to reinstall and configure the systems according to the resources in the scripts.</li>
</ul>
<p>See the following example of a DSC  file:</p>
<pre>Configuration PacktDscConfiguration {<br/>    param(<br/>        [string[]]$ComputerName="PacktMachine"<br/>    )<br/>    Node $ComputerName {<br/>        WindowsFeature PacktFeatureInstance {<br/>            Ensure = "Present"<br/>            Name = "RSAT"<br/>        }<br/>        WindowsFeature PacktFeatureInstance2 {<br/>            Ensure = "Present"<br/>            Name = "Bitlocker"<br/>        }<br/>    }<br/>}<br/>PacktDscConfiguration -ComputerName $ComputerName</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Automation</h1>
                </header>
            
            <article>
                
<p>Azure Automation is a service in Azure that offers complete control over the deployment and management operations in <span>on-premises and in </span>Azure environments. It offers support for Windows and Linux machines, and it offers a community gallery with predefined configurations and automation runbooks, which can be used as a starting point.</p>
<p>To manage these types of workloads, <span>Azure Automation offers the following features and capabilities:</span></p>
<ul>
<li><strong>Process Automation</strong>: You can use Process Automation in order to automate management tasks and repeatable configuration tasks in Azure and your on-premises environments. Various Azure services and resources can be integrated when automating processes. It uses <strong>Automation Runbooks</strong>, which automate the different steps. <span>Azure offers a graphical editor in order to create runbooks from the Azure Portal, or you can create them from PowerShell. You can create different types of runbooks, such as G</span>raphical, Graphical PowerShell Workflow, PowerShell, PowerShell Workflow, and Python Runbooks. Those workflows can then be exported from the automation account and imported in other automation accounts. However, automation runbooks in Azure cannot access the on-premises infrastructure and other cloud environments by default. You should install the H<span><span>ybrid Runbook Worker feature of Azure Automation to run the runbooks on these environments.</span></span></li>
<li><strong>Configuration Management</strong>: For configuration management, Azure Automation offers a DSC server for PowerShell DSC scripts. This server can be used to <span>write, manage, and compile PowerShell DSC. It provides a  Desired State Configuration Pull Service to send configurations to nodes automatically. You can get insights about installed applications and other configuration items as well.</span></li>
<li><strong>Update Management</strong>: This provides information and visibility about update compliance across your Azure, on-premises and other cloud environments. It offers capabilities for orchestrating and scheduling update deployments.</li>
<li><strong>Shared Capabilities</strong>: Azure Automation offers various shared resources that can be used for automating and configuring  your environments, such as Role-based Access Control. You can store credentials and certificates for security, create connection strings, schedules, source-control integration, and PowerShell modules.</li>
</ul>
<div class="packt_tip packt_infobox">For more information about Windows PowerShell Desired State Configuration, you can refer to <a href="https://docs.microsoft.com/en-us/powershell/dsc/overview">https://docs.microsoft.com/en-us/powershell/dsc/overview</a>. For more information about the Desired State Configuration Pull Service, you can refer to <a href="https://docs.microsoft.com/en-us/powershell/dsc/pullserver">https://docs.microsoft.com/en-us/powershell/dsc/pullserver</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an Azure Automation Runbook</h1>
                </header>
            
            <article>
                
<p>In this example, we are going to create an Azure Runbook with DSC Configurations. We should first create an Automation Account before the Azure Automation Runbook can be created. </p>
<p>To create an Azure Automation Account, take the following steps:</p>
<ol>
<li>Navigate to the Azure Portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.</li>
<li>Type <kbd>Automation</kbd> <span>in the search bar and create a new account. Add the following properties and click</span><span> on </span><span class="packt_screen">Create</span><span><span>:</span></span></li>
</ol>
<div style="color: black" class="CDPAlignCenter CDPAlign packt_figref"><img src="Images/bcf7ca4e-a8e4-4dd7-b9b2-e6809f5a5a42.jpg" style="width:18.75em;height:50.25em;" width="621" height="1660"/></div>
<div style="color: black" class="CDPAlignCenter CDPAlign packt_figref">Create Azure Automation Account</div>
<ol start="3">
<li>When created, navigate to the Automation Account. From there you can open the Graphical Editor to create an Automation Runbook. This example uses a preconfigured Graphical Runbook, which can be imported. This Runbook can be downloaded from the source code provided for this book on the GitHub page.</li>
<li>To import the runbook file, select <span class="packt_screen">Runbooks</span> <span>from the left menu and <span class="packt_screen">Add a runbook</span>:</span></li>
</ol>
<div style="color: black" class="CDPAlignCenter CDPAlign packt_figref"><img src="Images/a14addf8-7f40-42b6-abcd-58b7742536bf.jpg" style="width:62.83em;height:44.83em;" width="2281" height="1626"/><br/>
<br/>
New Runbook</div>
<ol start="5">
<li>Select <span class="packt_screen">Import</span>, select the Runbook file, and the following properties are automatically added:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1040 image-border" src="Images/02b0737b-3062-475f-abd6-5ee87da0dd33.png" style="width:44.42em;height:38.08em;" width="1247" height="1068"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><span>Import runbook</span></span></div>
<ol start="6">
<li class="mce-root"><span>Click on </span><span class="packt_screen">Create</span><strong>. </strong><span>You can now select the newly added runbook to make changes to it. Select it and click on </span><span class="packt_screen">Edit</span><span> in the top menu. This will open the graphical editor where you can see the different steps in the workflow and make changes to it.</span> You can select the different steps and configure parameters, configure retry behavior, and so on<span>. </span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/3009f4c9-93f9-404a-b250-83ca8b6bb8b5.jpg" style="width:58.58em;height:42.67em;" width="2275" height="1657"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Graphical Runbook Editor</div>
<ol start="7">
<li>When you are done changing the settings according to your own environment, you can publish and schedule the Runbook. </li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chef</h1>
                </header>
            
            <article>
                
<p>Chef is a third-party solution that offers a DevOps automation platform for Linux, Windows, and Mac devices. It can be used for virtual and physical server configurations. It requires an agent to be installed on the virtual machines or servers, which connects to the Chef server to check whether there are available updates and other configurations for the machines. You can use the Chef Automate Platform to package and deploy applications as well.</p>
<p>To connect an Azure VM with the Chef Server, a publish settings file needs to be downloaded from Azure and imported in the Chef Server and an agent needs to be installed on your connected devices to communicate with Chef. You can then create Chef Cookbooks on the server, which consists of scripts and instructions to manage the devices and automate deployments.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Puppet</h1>
                </header>
            
            <article>
                
<p>Puppet is <span>a third-party solution as well, and it has similar capabilities as Chef. You can enable support for Puppet when you create a</span> <span>virtual machine from the Azure Portal automatically. You can add it as an extension when you create a new virtual machine. It will install the Puppet Agent, which connects to the Puppet Master Server.</span></p>
<p><span>You will have to provide the name of the Puppet Master Server, and the VM will be integrated when it is created:<br/></span></p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><img src="Images/f64033a5-3ae0-411a-aa9d-a966eff0d3f5.jpg" style="width:59.00em;height:45.92em;" width="1792" height="1395"/><br/>
<br/>
Install Puppet Agent</span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Event Grid</h1>
                </header>
            
            <article>
                
<p>Azure Event Grid provides support to automate tasks as well. Azure Event Grid offers an Azure Automation Subscriber that can act upon different events that are sent to Azure Event Grid. So when an Azure resource is created, it can call an Automation Runbook to automatically perform a sequence of steps. For instance, when a virtual machine is created in Azure, it can call an Automation runbook via Event Grid to create a schedule for starting and stopping virtual machines at a certain time. </p>
<div class="packt_tip">For an complete walkthrough of integrating Azure Automation with Azure Event Grid and Microsoft Teams, you can refer to  <a href="https://docs.microsoft.com/en-us/azure/event-grid/ensure-tags-exists-on-new-virtual-machines">https://docs.microsoft.com/en-us/azure/event-grid/ensure-tags-exists-on-new-virtual-machines</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Logic Apps</h1>
                </header>
            
            <article>
                
<p>Azure Logic Apps offers support to call Automation Runbooks as well. It offers <strong>Actions</strong> that can be called from your Logic Apps to create automation jobs, collect output or get the status of jobs inside an Logic App. This can be used to create automations from within all types of workflows and can be integrated with various Azure resources.</p>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><img src="Images/ce9affbe-93ed-4901-b8ea-c5828dd0f73b.jpg" style="width:63.33em;height:27.08em;" width="2278" height="973"/><br/></span></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Azure Logic Apps Automation Actions</span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Visual Studio Team Services</h1>
                </header>
            
            <article>
                
<p>Visual Studio Teams Services offers a Continuous Integration and Delivery (CI/CD) solution for your custom applications. It consist of a <span>collection of DevOps services that can be used from Azure, and it can be installed on your on-premises servers as well by installing Team Foundation Server (TFS).</span></p>
<p>VSTS offers the following features and capabilities:</p>
<ul>
<li><strong>Version Control</strong>: The starting point of c<span>ontinuous integration, delivery, and testing is a version control server. </span>VSTS offers two different forms of version control, <span>Git, and Team Foundation Version Control. It offers support for various version control repositories such as Subversion, Bitbucket, and GitHub. </span></li>
<li><span><strong>Continuous Integration</strong>: When CI is configured in VSTS, any code changes that are checked in are automatically built and validated. To configure CI, you have to create a new build definition, which consists of tasks that build and test your source code. It offers support in order to build .NET, Java, Node, Android, Xcode, and C++ applications. You can use continuous testing to automatically validate the code that is checked in, in VSTS. It offers support for various testing frameworks, such as unit tests and Selenium. You can run PowerShell, CLI, and command-line scripts in your automation as well.</span></li>
<li><strong>Continuous<span> Deployment:</span></strong> <span>The next step is to create a release definition. You can use to deploy your application automatically on one or more environments. The release definition also consists of a set of tasks. Both VSTS and TFS supports deploying applications to PaaS Services, such as Web Apps and Azure Functions for instance. You also deploy your code to virtual machines, containers, on-premises and other cloud platforms and publish mobile apps to the store.</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing an autoscaling strategy</h1>
                </header>
            
            <article>
                
<p>Autoscaling offers a solution to match performance requirements and meet SLAs for Azure resources and Applications. It can add additional resources such as  adding VMs and CPUs to VMs and other Azure resources, and when those resources are no longer needed, they can be removed to minimize costs. This process is handled by Azure.</p>
<p>Autoscaling is one of the key benefits of cloud technologies because you add and remove additional resources easily and even automatically without the need to manage those resources. Autoscaling can be done in the following two different ways:</p>
<ul>
<li><strong>Vertical Scaling</strong>: This is also called scaling up and down. You can move applications to a different VM size. By changing the VM size, applications become unavailable for a short period of time, so this type of scaling is normally not executed automatically. </li>
<li><strong>Horizontal Scaling</strong>: This is<strong> </strong><span> also called scaling in and out. You scale horizontally, when you add additional resources, such as adding or removing containers to Azure Container Services for instance. This type of scaling is mostly done automatically because it doesn't require resources to become unavailable.<br/></span></li>
</ul>
<p>To design an effective autoscaling strategy, you can use the following approaches and services:</p>
<ul>
<li><strong>Monitoring and alerting</strong>: Use the monitoring and alerting capabilities that are available from the different monitoring solutions in Azure. These solutions are covered in more detail in the previous chapter. Next to the monitoring solutions, different Azure resources offer autoscaling as well, such as virtual machines, Azure Service Fabric, Azure Functions, Azure App Services, and other cloud services. These resources can be configured from the setting pages in the Azure Portal.</li>
<li><strong>Decision Making Logic</strong>: Make use of decision-making logic that helps deciding whether a resource needs to be scaled. This can be done dynamically inside Azure Logic Apps by calling Automation Runbooks or using predefined schedules at times where the system is heavily used.  </li>
<li><strong>Azure Monitoring Scale</strong>: This is a service integrated in Azure Monitor that offers autoscaling for VMs, <span>VM Scale Sets, Azure App Services, and Azure Cloud Services. You can use this for scheduling instances, scale-out when a certain CPU usage is met and when a certain number of messages are added to a queue.</span></li>
<li><strong>Application Architectures</strong>: Architect custom applications accordingly, so that they can be scaled horizontally. This applies to Azure Service Fabric applications, applications that run inside containers, or batch applications. For this, the Throttling Pattern and the Competing Consumers Pattern can be used.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this final chapter, we covered how to design an operations automation strategy using the different solutions and tools that Azure provides as well as how to design an autoscaling strategy.</p>
<p>With the knowledge gained throughout the, chapters, you should be able to pass the 70-535 exam. Don't forget to look at the <em>Further reading</em> sections because there is a lot of extra information there that could be covered on the exam as well. </p>
<p>I hope you enjoyed reading this book as much I enjoyed writing it and good luck on your exam!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p>Answer the following questions to test your knowledge of the information in this chapter. You can find the answers in the <em>Assessments</em> section at the end of this book.</p>
<ol>
<li><span>Your company uses Windows, Linux, and Mac devices. Is Azure Automation the best solution for your automation strategy?</span>
<ol>
<li>Yes</li>
<li>No</li>
</ol>
</li>
<li>You are designing a <span>standardized deployment solution for your virtual machines. You also have a requirement to configure and keep VMs in sync after deployment. Should you use </span>Azure PowerShell Desired State Configuration (DSC) for this?
<ol>
<li>Yes</li>
<li>No</li>
</ol>
</li>
<li>Can you use Azure Event Grid for automation tasks?
<ol>
<li>Yes</li>
<li>No</li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>You can check the following links for more information about the topics that were covered in this chapter:</span></p>
<ul>
<li><strong>An introduction to Azure Automation</strong>: <a href="https://docs.microsoft.com/en-us/azure/automation/automation-intro">https://docs.microsoft.com/en-us/azure/automation/automation-intro</a></li>
<li><strong>Windows PowerShell Desired State Configuration Overview</strong>: <a href="https://docs.microsoft.com/en-us/powershell/dsc/overview">https://docs.microsoft.com/en-us/powershell/dsc/overview</a></li>
<li><strong>Azure Automation DSC Overview</strong>: <a href="https://docs.microsoft.com/en-us/azure/automation/automation-dsc-overview">https://docs.microsoft.com/en-us/azure/automation/automation-dsc-overview</a></li>
<li><strong>Chef on Azure</strong>: <a href="https://docs.microsoft.com/en-us/azure/chef/">https://docs.microsoft.com/en-us/azure/chef/</a> <a href="https://docs.microsoft.com/en-us/azure/chef/"/></li>
<li><strong>Azure Event Grid Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/event-grid/">https://docs.microsoft.com/en-us/azure/event-grid/</a></li>
<li><strong>Azure Logic Apps Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/logic-apps/">https://docs.microsoft.com/en-us/azure/logic-apps/</a></li>
<li><strong>Visual Studio Team Services: Build and release</strong>: <a href="https://docs.microsoft.com/en-us/vsts/build-release/?view=vsts">https://docs.microsoft.com/en-us/vsts/build-release/?view=vsts</a></li>
<li><strong>Autoscaling Guidance</strong>: <a href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/auto-scaling">https://docs.microsoft.com/en-us/azure/architecture/best-practices/auto-scaling</a></li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>