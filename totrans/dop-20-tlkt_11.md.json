["```\nvagrant up cd prod\nvagrant ssh cd\ngit clone https://github.com/vfarcic/books-ms.git\n\n```", "```\n- hosts: prod\n remote_user: vagrant\n serial: 1\n sudo: yes\n roles:\n - common\n - docker\n - docker-compose\n - consul\n - registrator\n - consul-template\n - nginx\n - service\n\n```", "```\n- include: pre-deployment.yml\n- include: deployment.yml\n- include: post-deployment.yml\n\n```", "```\ndocker pull \\\n -t 10.100.198.200:5000/books-ms-tests\ndocker build \\\n -t 10.100.198.200:5000/books-ms-tests \\\n -f Dockerfile.test \\\n .\n\n```", "```\n- name: Tests container is pulled\n shell: docker pull \\\n {{ registry_url }}{{ service_name }}-tests\n delegate_to: 127.0.0.1\n ignore_errors: yes\n tags: [service, tests]\n- name: Tests container is built\n shell: docker build \\\n -t {{ registry_url }}{{ service_name }}-tests \\\n -f Dockerfile.test \\\n .\n args:\n chdir: \"{{ repo_dir }}\"\n delegate_to: 127.0.0.1\n tags: [service, tests]\n\n```", "```\ndocker-compose -f docker-compose-dev.yml \\\n run --rm tests\ndocker pull 10.100.198.200:5000/books-ms\ndocker build -t 10.100.198.200:5000/books-ms .\ndocker push 10.100.198.200:5000/books-ms\n\n```", "```\n- name: Pre-deployment tests are run\n shell: docker-compose \\\n -f docker-compose-dev.yml \\\n run --rm tests\n args:\n chdir: \"{{ repo_dir }}\"\n delegate_to: 127.0.0.1\n tags: [service, tests]\n- name: Container is built\n shell: docker build \\\n -t {{ registry_url }}{{ service_name }} \\\n .\n args:\n chdir: \"{{ repo_dir }}\"\n delegate_to: 127.0.0.1\n tags: [service]\n- name: Container is pushed\n shell: docker push \\\n {{ registry_url }}{{ service_name }}\n delegate_to: 127.0.0.1\n tags: [service]\n\n```", "```\nmkdir -p /data/books-ms\ncd /data/books-ms\nwget https://raw.githubusercontent.com/vfarcic\\\n/books-ms/master/docker-compose.yml\nwget https://raw.githubusercontent.com/vfarcic\\\n/books-ms/master/nginx-includes.conf \\\n -O /data/nginx/includes/books-ms.conf\nwget https://raw.githubusercontent.com/vfarcic\\\n/books-ms/master/nginx-upstreams.ctmpl \\\n -O /data/nginx/upstreams/books-ms.ctmpl\n\n```", "```\n- name: Directory is created\n file:\n path: /data/{{ service_name }}\n recurse: yes\n state: directory\n tags: [service]\n- name: Files are copied\n copy:\n src: \"{{ item.src }}\"\n dest: \"{{ item.dest }}\"\n with_items: files\n tags: [service]\n\n```", "```\nfiles: [\n {\n src: \"{{ repo_dir }}/docker-compose.yml\",\n dest: \"/data/{{ service_name }}/docker-compose.yml\"\n }, {\n src: \"{{ repo_dir }}/nginx-includes.conf\",\n dest: \"/data/nginx/includes/{{ service_name }}.conf\"\n }, {\n src: \"{{ repo_dir }}/nginx-upstreams.ctmpl\",\n dest: \"/data/nginx/upstreams/{{ service_name }}.ctmpl\"\n }\n]\n\n```", "```\ndocker-compose pull app\ndocker-compose up -d app\nconsul-template \\\n -consul localhost:8500 \\\n -template \"/data/nginx/upstreams/books-ms.ctmpl:\\\n/data/nginx/upstreams/books-ms.conf:\\\ndocker kill -s HUP nginx\" \\\n -once\n\n```", "```\n- name: Containers are pulled\n shell: docker-compose pull app\n args:\n chdir: /data/{{ service_name }}\n tags: [service]\n- name: Containers are running\n shell: docker-compose up -d app\n args:\n chdir: /data/{{ service_name }}\n tags: [service]\n- name: Proxy is configured\n shell: consul-template \\\n -consul localhost:8500 \\\n -template \"{{ ct_src }}:{{ ct_dest }}:{{ ct_cmd }}\" \\\n -once\n tags: [service]\n\n```", "```\nct_src: /data/nginx/upstreams/{{ service_name }}.ctmpl\nct_dest: /data/nginx/upstreams/{{ service_name }}.conf\nct_cmd: docker kill -s HUP nginx\n\n```", "```\ndocker-compose \\\n -f docker-compose-dev.yml \\\n run --rm \\\n -e DOMAIN=http://10.100.198.201 \\\n integ\ndocker push 10.100.198.200:5000/books-ms-tests\n\n```", "```\n- name: Post-deployment tests are run\n shell: docker-compose \\\n -f docker-compose-dev.yml \\\n run --rm \\\n -e DOMAIN={{ proxy_url }} \\\n Integ\n args:\n chdir: \"{{ repo_dir }}\"\n delegate_to: 127.0.0.1\n tags: [service, tests]\n- name: Tests container is pushed\n shell: docker push \\\n {{ registry_url }}{{ service_name }}-tests\n delegate_to: 127.0.0.1\n tags: [service, tests]\n\n```", "```\ncd ~/books-ms\nansible-playbook /vagrant/ansible/service.yml \\\n -i /vagrant/ansible/hosts/prod \\\n --extra-vars \"repo_dir=$PWD service_name=books-ms\"\n\n```", "```\nexit\nvagrant destroy -f\n\n```"]