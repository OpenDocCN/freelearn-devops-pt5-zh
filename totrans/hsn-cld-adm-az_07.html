<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Hybrid Cloud with Azure - Extending Local Workloads to the Cloud</h1>
                </header>
            
            <article>
                
<p>The hybrid cloud is an important part of the cloud journey, helping us to combine Azure (or any other cloud) with on-premises resources. In this chapter, we'll discuss how to configure the environment and the connections between the Azure and local infrastructure in order to take advantage of the best from both worlds—local and cloud infrastructure.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Hybrid clouds</li>
<li>Connecting virtual networks to on-premises</li>
<li>On-premises data gateways</li>
<li>Azure Stack</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>For this chapter, you'll need:</p>
<ul>
<li>An Azure subscription</li>
<li>A local server running Windows Server 2012 R2 or later</li>
<li>A VPN (firewall) device supporting an S2S connection</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Hybrid clouds</h1>
                </header>
            
            <article>
                
<p class="mce-root">Migrating completely to the cloud is not an option for many organizations. Even though the cloud offers multiple benefits, there are many scenarios to consider.</p>
<p>For example, if a company invested in local infrastructure, it would be hard to just abandon all that and move everything to the cloud. When creating a local data center, we need to invest in server rooms, networking, servers, storage, and software licenses. There is no business justification to abandon all investments and start investing in the cloud.</p>
<p>Another scenario is when we are not allowed to move specific services. In this case, compliance with the law can stop us from moving something out of a local data center. For example, some countries don't allow you to keep a user's personal information outside of that country. If an Azure data center is not available in your region, this may be a blocker and you may have to keep data in your local data center.</p>
<p>In both cases, when something is preventing us from using all of the cloud's services, we can benefit from what the cloud offers by setting up a hybrid cloud. This allows us to use cloud services along with local infrastructure, allowing us to create powerful combinations of the best from both wolds. </p>
<p>For example, we can set up database in a local data center (if we're not allowed to migrate a database or we have a brand new database server) and set up cloud services that will use a local database in the background. This especially applies to the Azure data analytics platform, which offers multiple powerful services that can provide you with fast data processing and still retain data locally.</p>
<p>There is a third scenario in which you can use services from multiple cloud providers and benefit from what each of them has to offer. Again, we need to set up a hybrid cloud scenario to secure communication and <span>exchange resources</span> between services you are using in each cloud.</p>
<p>The best way to set up security and keep your data safe in the hybrid cloud is to create a direct connection between Azure and the local infrastructure. </p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Connecting the local network and Azure Virtual Network</h1>
                </header>
            
            <article>
                
<p><span>In order to connect local infrastructure and Azure, we need to create a connection between the local network and Azure Virtual Network. This connection can be either <strong>Point-to-Site</strong> (<strong>P2S</strong>) or <strong>Site-to-Site</strong> (<strong>S2S</strong>). As P2S allows access to Azure Virtual Network from a single computer, it's not ideal for a true hybrid cloud, but more as point of access for remote workers. </span></p>
<p>To set up a true hybrid cloud, we need to create an <span>S2S</span> connection that will allow full communication between our local network and Azure Virtual Network. By doing so, we extend our local network to Azure and can access resources in Azure the same way as we would access resources in a local environment. </p>
<p>Creating an <span>S2S </span>connection can be done in two ways: using a VPN and using ExpressRoute. A VPN will provide communication <span>encryption</span> between two networks. ExpressRoute goes one step further and provides a dedicated connection between a local network and Azure Virtual Network. A dedicated connection provides <span>more reliability, faster speeds, lower latency, and higher security, but it must be purchased as a separate service provided by the ISP.</span></p>
<p>Establishing a connection between a local network and Azure Virtual Network is a two-step process. First, we need to create and configure Azure resources, and in the second step we need to configure our local firewall. In the local environment, we need a VPN (firewall) device that supports creating S2S connections and public IP addresses. Note that all devices, with S2S option, do not support S2S connection with Azure.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating a S2S Connection</h1>
                </header>
            
            <article>
                
<p>To create an S2S connection between Azure Virtual Network and our local network, first we must create two Azure resources: a virtual network gateway and a local network gateway.</p>
<p>Creating a virtual network gateway is done in a single blade. The information we need to provide is the <span class="packt_screen">Name</span>, <span class="packt_screen">Gateway type</span>, <span class="packt_screen">VPN type</span>, <span class="packt_screen">SKU</span>, <span class="packt_screen">Virtual network</span>, <span class="packt_screen">Gateway subnet address range</span>, <span class="packt_screen">Public IP address</span>, <span class="packt_screen">Subscription</span>, and <span class="packt_screen">Location</span>. The <span class="packt_screen">Name</span>, <span class="packt_screen">Subscription</span>, and <span class="packt_screen">Location</span> are the usual parameters.</p>
<p>The first option is to select the <span class="packt_screen">Gateway type</span>. This can be either <span class="packt_screen">VPN</span> or <span class="packt_screen">ExpressRoute</span> (as we explained earlier). If <span class="packt_screen">VPN</span> is selected, we need to choose whether the VPN type is policy- or route-based. (This option will probably depend on the settings of your local network.) The next step is to select an <span class="packt_screen">SKU</span> that will decide the bandwidth and number of connections available. The option for active-active mode can be enabled or disabled. This mode allows you to create a redundant connection that will be observed as a single one from a traffic point of view. In other words, you need to create two S2S connections on your on-premises device, which will route traffic to the same virtual network. Traffic will be routed though both connections unless one becomes unavailable, and then traffic is routed through the S2S connection that is still available.</p>
<p>Active-active mode is not only used for highly available connections, but for better performance as well. You need to select a <span class="packt_screen">Virtual network</span> that is available. Available networks will depend on the subscription and location that are selected. After the virtual network is selected, you need to provide a range for the gateway subnet. If such a subnet doesn't exist, it will be created automatically (unless there is no free address space on the network; then the process will fail). Note that there is no resource group needed. A virtual network gateway will be created in the same resource group in which the virtual network is located.</p>
<p>Next, you need to create or select an existing <span class="packt_screen">Public IP address</span> that will be used for the connection. This IP is needed to establish a connection to your local network and will be used in the configuration for the local firewall in order to accept a connection from Azure. I recommend using a static IP address as you don't want to change the configuration in case the IP address changes.</p>
<p>An example of a virtual network gateway configuration is shown next:</p>
<p class="mce-root"/>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1099 image-border" src="Images/75e580ca-06ac-48d3-a6db-f764c993c2b5.png" style="width:21.92em;height:50.92em;" width="350" height="813"/></p>
<p>Creating a virtual network gateway takes from 30 to 90 minutes. This is one of the resources in Azure that takes the longest time to deploy.</p>
<p class="mce-root"/>
<p>The ARM template for the deployment of an Azure virtual network gateway is provided here:</p>
<pre>{<br/>"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",<br/>"contentVersion": "1.0.0.0",<br/>"parameters": {<br/>"name": {<br/>"type": "string"<br/>},<br/>"location": {<br/>"type": "string"<br/>},<br/>"sku": {<br/>"type": "string"<br/>},<br/>"gatewayType": {<br/>"type": "string",<br/>"defaultValue": "Vpn",<br/>"allowedValues": [<br/>"Vpn",<br/>"ExpressRoute"<br/>]<br/>},<br/>"vpnType": {<br/>"type": "string",<br/>"defaultValue": "RouteBased",<br/>"allowedValues": [<br/>"RouteBased",<br/>"PolicyBased"<br/>]<br/>},<br/>"existingVirtualNetworkName": {<br/>"type": "string"<br/>},<br/>"newSubnetName": {<br/>"type": "string"<br/>},<br/>"subnetAddressPrefix": {<br/>"type": "string"<br/>},<br/>"newPublicIpAddressName": {<br/>"type": "string"<br/>}<br/>},<br/>"resources": [<br/>{<br/>"apiVersion": "2017-06-01",<br/>"name": "[parameters('name')]",<br/>"type": "Microsoft.Network/virtualNetworkGateways",<br/>"location": "[parameters('location')]",<br/>"dependsOn": [<br/>"Microsoft.Network/virtualNetworks/PacktVnet/subnets/GatewaySubnet",<br/>"[concat('Microsoft.Network/publicIPAddresses/', parameters('newPublicIpAddressName'))]"<br/>],<br/>"properties": {<br/>"gatewayType": "[parameters('gatewayType')]",<br/>"ipConfigurations": [<br/>{<br/>"name": "default",<br/>"properties": {<br/>"privateIPAllocationMethod": "Dynamic",<br/>"subnet": {<br/>"id": "[resourceId('PacktIaaS', 'Microsoft.Network/virtualNetworks/subnets', parameters('existingVirtualNetworkName'), parameters('newSubnetName'))]"<br/>},<br/>"publicIpAddress": {<br/>"id": "[resourceId('PacktIaaS', 'Microsoft.Network/publicIPAddresses', parameters('newPublicIpAddressName'))]"<br/>}<br/>}<br/>}<br/>],<br/>"vpnType": "[parameters('vpnType')]",<br/>"sku": {<br/>"name": "[parameters('sku')]",<br/>"tier": "[parameters('sku')]"<br/>}<br/>}<br/>},<br/>{<br/>"apiVersion": "2018-04-01",<br/>"type": "Microsoft.Network/virtualNetworks/subnets",<br/>"name": "[concat(parameters('existingVirtualNetworkName'), '/', parameters('newSubnetName'))]",<br/>"location": "[parameters('location')]",<br/>"properties": {<br/>"addressPrefix": "[parameters('subnetAddressPrefix')]"<br/>}<br/>},<br/>{<br/>"apiVersion": "2017-08-01",<br/>"type": "Microsoft.Network/publicIPAddresses",<br/>"name": "[parameters('newPublicIpAddressName')]",<br/>"location": "[parameters('location')]",<br/>"properties": {<br/>"publicIPAllocationMethod": "Dynamic"<br/>}<br/>}<br/>]<br/>}</pre>
<p>After the deployment of the virtual network gateway is completed, we can proceed and create a local network gateway. A <span>local network gateway</span> is used to input information on your local firewall and network. You need to the provide the public <span class="packt_screen">IP address</span> of your local firewall and the <span class="packt_screen">Address space</span> of the local network (or gateway subnet of your local network, depending on the firewall). You also need to provide a <span class="packt_screen">Subscription</span>, <span class="packt_screen">Location</span>, and <span class="packt_screen">Resource group</span>. The <span class="packt_screen">Location</span> should be the same as the one that is used for the virtual network gateway and virtual network. I recommend placing them in the same resource group for easier management. Example settings for the local network gateway are shown here:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1100 image-border" src="Images/371de212-eaeb-485d-aab0-696b5c891892.png" style="width:16.08em;height:30.75em;" width="350" height="668"/></p>
<p><span>The ARM template for the deployment of a local network gateway is provided here:</span></p>
<pre>{<br/>"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",<br/>"contentVersion": "1.0.0.0",<br/>"parameters": {<br/>"localNetworkGatewayName": {<br/>"type": "string"<br/>},<br/>"location": {<br/>"type": "string"<br/>},<br/>"gatewayIpAddress": {<br/>"type": "string"<br/>},<br/>"addressPrefixes": {<br/>"type": "array"<br/>}<br/>},<br/>"resources": [<br/>{<br/>"name": "[parameters('localNetworkGatewayName')]",<br/>"type": "Microsoft.Network/localNetworkGateways",<br/>"apiVersion": "2017-06-01",<br/>"location": "[parameters('location')]",<br/>"properties": {<br/>"localNetworkAddressSpace": {<br/>"addressPrefixes": "[parameters('addressPrefixes')]"<br/>},<br/>"gatewayIpAddress": "[parameters('gatewayIpAddress')]"<br/>}<br/>}<br/>]<br/>}</pre>
<p>Deploying a <span>local network gateway</span> is relatively fast compared to a virtual network gateway, and deployment should complete in under 5 minutes.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring Azure settings for S2S</h1>
                </header>
            
            <article>
                
<p>After the virtual network gateway and <span>local network gateway</span> are created, we can proceed to configuration. In the virtual network gateway, we select <span class="packt_screen">Connection type</span> options under <span class="packt_screen">Settings</span>. You'll see that <span class="packt_screen">Settings</span> has options for configuration, connections, and point-to-site connections.</p>
<p>As we are going to concentrate on S2S connections, we only use the connections blade and add a new connection. We need to provide a <span class="packt_screen">Name</span> as usual. The options for the <span class="packt_screen">Virtual network gateway</span>, <span class="packt_screen">Subscription</span>, <span class="packt_screen">Resource group</span>, and <span class="packt_screen">Location</span> are locked and can't be changed, as they depend on the <span class="packt_screen">Virtual network gateway</span> that is used to create a connection. Parameters that we need to provide are the <span class="packt_screen">Connection type</span> and <span class="packt_screen">Shared key (PSK)</span>. The <span class="packt_screen">Connection type</span> options are <span class="packt_screen">VNet-to-VNet</span>, <span class="packt_screen">Site-to-Site (IPsec)</span>, and <span class="packt_screen">ExpressRoute</span>. We are going to select the option for <span><span class="packt_screen">Site-to-Site (IPsec)</span></span> as we want to connect to a local network. For the <span class="packt_screen">Shared Key (PSK)</span>, I recommend it be as complex as possible because security can depend on this. Sample settings for a new connection are shown here:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1101 image-border" src="Images/92a3dbd8-7ed9-42cc-b1df-c9d21f713596.png" style="width:16.25em;height:40.58em;" width="296" height="739"/></p>
<p>Creating a connection is only the first step; we also need to configure settings for our local network. After the initial creation, the status of the connection will be unknown, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1102 image-border" src="Images/66aac4a3-8678-47a0-bb41-52c14cefc73b.png" style="width:50.50em;height:6.83em;" width="690" height="93"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring a local firewall for S2S</h1>
                </header>
            
            <article>
                
<p>Configuration of a local firewall depends on the vendor and type of device. Under created connection, there is an option to download configurations for some devices. You can select a few different vendors (for example, <span class="packt_screen">Cisco</span> and <span class="packt_screen">Juniper</span>), and also depending on the <span class="packt_screen">Device vendor</span>, <span class="packt_screen">Device family</span>, and <span class="packt_screen">Firmware version</span> to download specific configuration. Only a few devices are available to download directly from the Azure portal. In Microsoft's documentation you can find more devices, and some vendors have a section on Azure S2S configuration on their websites. A screenshot of the configuration downloading process is shown next:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1103 image-border" src="Images/7b4258a6-5520-4c9e-865b-0012c05b83ee.png" style="width:26.75em;height:23.33em;" width="516" height="451"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>After the connection is configured on both sides, the status will change to <span class="packt_screen">Connected</span>, as shown:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1104 image-border" src="Images/511e64a3-ffe3-4269-8f48-65fba4bced61.png" style="width:59.17em;height:7.75em;" width="710" height="93"/></p>
<p>This will allow you to connect to any resource in the Azure Virtual Network directly from the local network with a secure, private connection. In some cases, you don't want to expose your resources for public access, so this is the only approach to connect to your resources.</p>
<p>In other cases, and this is probably most common practice, services are accessed publicly, but management is done over a private network. For example, access to a website is allowed over HTTP or HTTPS over the internet, but access to databases or an RDP connection to virtual machines is only allowed over a private network.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring services in a hybrid environment </h1>
                </header>
            
            <article>
                
<p>Once we have established a connection between the local network and Azure, we can start using services in both environments, as if these are single site or network. However, there are a few things that we need to keep in mind.</p>
<p>If we have a domain set up in the local environment and want to use the same domain in the cloud, it's a good idea to have one domain controller running in the Azure Virtual Network. Even when we have an S2S connection established, occasional interrupts in connection can be expected. By having one DC running in the cloud, we can ensure that services in Azure can use all features and run independently when interruptions occur. </p>
<p>When running SQL Server and using <span class="packt_screen">Always On Availability Groups</span>, you can use Azure to extend the service and add one replica in the cloud. As we previously mentioned, there are two modes for running Azure: resource manager and classic. The classic model supports adding a replica in Azure through a wizard, and it's relatively easy to set up.</p>
<p class="mce-root"/>
<p>The resource manager requires use of T-SQL commands to add a replica in Azure resource manager mode, but it's a little more complicated. But as the resource manager is a recommended mode, I suggest using the resource manager, as classic is bound to be dropped at some point and you'll have to set up the resource manager eventually anyway.</p>
<p><span>Another thing to consider is Azure Hybrid Benefit, which allows you to use existing on-premises licenses in Azure. With software assurance, you can use licenses for Windows server and SQL Server, and deploy Azure resources with a significant discount.</span></p>
<p>The data center location is very important when establishing a connection between the local network and Azure. If you are located on one continent and the Azure data center (in which the virtual network is deployed)is in another, you will experience network latency and lag. Choosing the closest geographical location is the best possible option.</p>
<p>If you experience network latency and lag or have performance issues, ExpressRoute is the service you need to consider. It does come at a price, but it has an enterprise-grade connection with the best possible reliability, speed, and security.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Connecting virtual networks across Azure </h1>
                </header>
            
            <article>
                
<p>A virtual network gateway can be used to connect different Azure Virtual Networks. But as you pay for a <span>virtual network gateway</span>, I recommend a different approach. To connect Azure Virtual Networks to another Azure Virtual Network, we can use <strong>peering</strong>. Peering, in general, <span>is the interconnection of separate networks</span><span> for the purpose of exchanging traffic networks.</span> Options for peering are available under <span class="packt_screen">Settings</span> in the virtual network blade. If we choose to create a new peering, we need to provide a <span class="packt_screen">Name</span> and select if we are going to connect to a <span class="packt_screen">Resource manager</span> or <span class="packt_screen">Classic</span> virtual network. As <span class="packt_screen">Resource manager</span> is recommended, we'll explain this process. If <span class="packt_screen">Resource manager</span> is selected, we can either provide an ID for a resource or use a drop-down menu to select our Azure <span class="packt_screen">Subscription</span> and the <span class="packt_screen">Virtual network</span> we want to connect to.</p>
<p>Some additional options are available for forwarded traffic and a remote gateway if needed. Example peering settings are shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1105 image-border" src="Images/7d9cd44f-3f00-4fff-8a70-cd033ee24e9c.png" style="width:38.33em;height:43.33em;" width="683" height="772"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">On-premises data gateway</h1>
                </header>
            
            <article>
                
<p>In some cases, all the requirements to create S2S connections to Azure are not met, but we still need to connect to local resources. For example, we need to connect to a local database, but the VPN device we have locally doesn't support a connection to Azure.</p>
<p>In this case, we can use an on-premises data gateway to allow Azure services to use a local database in a secure way.</p>
<p>An on-premises data gateway acts as a bridge and allows us to access local data with Azure services. Services currently supported are <span>Power BI, Microsoft Flow, PowerApps, Azure Analysis Services, and Azure Logic Apps. Logic apps can be used to pass this data to other services as well.</span></p>
<p>Supported connectors are:</p>
<ul>
<li>BizTalk Server 2016</li>
<li><span>Filesystems</span></li>
<li>IBM DB2</li>
<li>IBM Informix</li>
<li>IBM MQ</li>
<li>MySQL</li>
<li>Oracle Database</li>
<li>PostgreSQL</li>
<li>SAP Application Server</li>
<li>SAP Message Server</li>
<li>SharePoint Server</li>
<li>SQL Server</li>
<li>Teradata</li>
</ul>
<p>Setting up an on-premises data gateway is a two-step process; we need to install the agent locally and configure the gateway in Azure next.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Local installation</h1>
                </header>
            
            <article>
                
<p>To start the installation process, we need to sign in with an account that has access to an Azure subscription. Usually, to access an Azure subscription, you use either a Microsoft Live account or a work/school/O365/AAD account. In this case, we cannot use a Microsoft Live account because only a work account is allowed. The sign-in form is shown here:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1106 image-border" src="Images/34688838-c172-4047-a0cf-20cb069ee2e4.png" style="width:25.08em;height:20.42em;" width="660" height="538"/></p>
<p>After the sign-in process is completed, we need to provide a <span class="packt_screen">New on-premises data gateway name</span> and a <span class="packt_screen">Recovery key (8 character minimum)</span>. The recovery key is used if you need to restart the service or change its configuration:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1107 image-border" src="Images/e7331ddd-750c-4631-9406-cee45541342f.png" style="width:32.42em;height:26.00em;" width="923" height="741"/></p>
<p>Once deployment is completed, you will see a <span class="packt_screen">Status</span> page and some additional configuration. You can change the <span class="packt_screen">Service Settings</span>, <span class="packt_screen">Network</span> settings, and <span class="packt_screen">Connectors</span>, or launch <span class="packt_screen">Diagnostics</span> if you're having an issue with the service. In order to access these settings again, you need to use a recovery key:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1108 image-border" src="Images/f3870440-d608-48c1-8bf2-c112853ecba6.png" style="width:35.08em;height:31.17em;" width="967" height="860"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cloud service</h1>
                </header>
            
            <article>
                
<p>After installation on a local server is done, we need to configure a gateway in Azure as well. Parameters we need to provide are the <span class="packt_screen">Resource Name</span>, <span class="packt_screen">Subscription</span>, <span class="packt_screen">Resource group</span>, and <span class="packt_screen">Location</span>. Based on other information, available gateways will be available for selection under <span class="packt_screen">Installation Name</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1109 image-border" src="Images/d58ec446-28d6-4b04-ac1a-d2cbe50f7eb7.png" style="width:21.25em;height:38.50em;" width="358" height="648"/></p>
<p>After deployment is completed, we can use an on-premises data gateway to connect Azure to the local server. The number of services that can use this kind of connection is limited, but we can use logic app to extend the connection to other services as well. Configuring the logic app to use an on-premises data gateway allows us to extend this connection to other services in a single logic app flow and access the same data. The connection is limited, but it can help in certain scenarios in which S2S is not an option.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Stack</h1>
                </header>
            
            <article>
                
<p>Microsoft is probably the only cloud provider that has the option for true hybrid cloud. Most cloud providers include some sort of hybrid cloud, allowing you to combine on-premises and cloud services. In most cases, with IaaS, we have the option of running everything we have on-premises in the cloud with little to no effort. Migrating local resources to the cloud is an option everyone in the cloud business is offering.</p>
<p>Azure Stack is the only option which allows you to have things the other way around and to run cloud services in your local data center. With Azure Stack, you can run <span>IaaS </span>and even PaaS in your own environment. Basically, Azure Stack is an extension of Azure in a local environment, and it uses the same fabric that the public version of Azure is using, but on a much smaller scale. It comes in a pre-configured box that must be bought from one of the authorized vendors and uses the same "real" fabric Azure uses. It supports the same models and deployment tools that the public version of Azure supports. All applications and services deployed in Azure will run in the Azure Stack, and all applications and services deployed in Azure Stack will run in Azure. The model is developed once and deployed anywhere.</p>
<p>There are a few scenarios in which Azure Stack may be considered. The first is one we already mentioned when we discussed hybrid cloud options: when we have regulatory requirements to keep data in our local data center or within our own country. Even with the hybrid cloud, in this scenario we must use SQL Server. With Azure Stack, this is not the case anymore; we can use Azure SQL databases and take advantage of PaaS even when retaining the database locally.</p>
<p>Latency and connectivity can be an issue when handling large datasets. Azure Stack is a solution with which we can p<span>rocess data locally and then aggregate it in Azure for further analytics, sharing common application logic across both.</span></p>
<p>Another example would be systems that are disconnected, or partly disconnected, and have connections to the internet occasionally. With Azure Stack, we can provide cloud applications in environments like airplanes or ships that don't have an internet connection all the time. An airline could create a cloud application for customers, and customers could access such an application when the airplane is offline. Once an internet connection is established, a data sync can be performed and everything updated.</p>
<p>In certain scenarios, a company can have multiple locations, and some of these locations can be required to be offline. Cloud applications were not an option in this scenario before, but with Azure Stack all locations can use the same application even <span>when using the cloud</span>. Some locations may use an application in public Azure and some of them may use Azure Stack, but they have all the same features and capabilities.</p>
<p>Azure Stack may be an interesting option for Microsoft partners that may want to host Azure Stack in their data center and offer Azure services in their country. If companies or government agencies are required to keep data in their country, hosting providers could use Azure Stack to run Azure services in that country for such organizations.</p>
<p>Fabric, model, and deployment tools are not only things that Azure and Azure Stack share. Azure portal is another thing that is very similar in both cases. Azure Stack comes with two versions of portal: user and administration. The former is used for consuming and creating resources, similar to what we have in the public Azure portal, and is later used to configure quotas and limitations for users and tenants. The administration part of the portal is especially interesting for those who decide to use Azure Stack to host Azure services locally and offer them to others, as this will allow them to control limitations and spending for each customer.</p>
<p>You can compare the design of Azure and the Azure Stack portal in the next two screenshots, the first being <strong>public Azure</strong> and the second <strong>Azure Stack</strong>. As you can see, the design is very similar and the difference is the name in the top-left corner:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1110 image-border" src="Images/e1f215d3-1bac-45d5-b97c-7a7dc1353da8.png" style="width:134.17em;height:67.33em;" width="1610" height="808"/></p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1111 image-border" src="Images/221ccd4b-8527-4cb8-bd23-de07ae6d1e07.png" style="width:112.83em;height:48.83em;" width="1354" height="586"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>As explained, the hybrid cloud is a reality for most organizations, whether it's because of regulations or investment in local infrastructure. We already covered how to migrate or extend services to the cloud, and a very important part of this is managing identities in the cloud. Data is important, but managing who can access that data is just as important. In extending local infrastructure to the cloud, we can set up a replica of the domain controller and use the Active Directory to manage identities and delegate access, but this only extends to <span>IaaS</span>. </p>
<p>To manage this with PaaS, we must use Azure Active Directory, which is often called Identity as a Service. In the next chapter, we'll discuss Azure Active Directory, how to use it, and even extend local identities to Azure Active Directory.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>The hybrid cloud is often only an option because of...
<ol>
<li>Regulations</li>
<li>Investment</li>
<li>Both</li>
</ol>
</li>
</ol>
<ol start="2">
<li>We can connect a local network and Azure using...
<ol>
<li>Site-to-Site</li>
<li>ExpressRoute</li>
<li>Both</li>
</ol>
</li>
<li>Azure resources needed for S2S...<br/>
<ol>
<li><span>A virtual network gateway</span></li>
<li>An on-premises data gateway</li>
<li>Both</li>
</ol>
</li>
<li>A <span>local network gateway</span> holds the configuration of a...
<ol>
<li>Virtual network</li>
<li>Local network</li>
<li>Both</li>
</ol>
</li>
<li><span>A VPN device configuration can be downloaded from the Azure portal.</span>
<ol>
<li>True</li>
<li>True, but for a limited number of devices</li>
<li>False</li>
</ol>
</li>
<li>The recommended mode for S2S connection is...
<ol>
<li>Resource manager</li>
<li>Classic</li>
<li>Both</li>
</ol>
</li>
<li><span>To ensure that you can use local identities in the hybrid cloud, you must deploy...</span>
<ol>
<li>Domain controller in disaster recovery</li>
<li>Domain controller in Azure</li>
<li><span>Always on availability group</span></li>
</ol>
</li>
<li>An on-premises data gateway can be used with...
<ol>
<li>All Azure Services</li>
<li>A limited number of Azure Services</li>
<li>A single Azure Service</li>
</ol>
</li>
</ol>
<ol start="9">
<li>Azure Stack is...
<ol>
<li>An extension of Azure in your local data center</li>
<li>An extension of your local data center in Azure</li>
<li>An extension of Azure in another public cloud</li>
</ol>
</li>
<li>Azure Stack offers...
<ol>
<li>IaaS</li>
<li>PaaS</li>
<li>Both</li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    </div>



  </body></html>