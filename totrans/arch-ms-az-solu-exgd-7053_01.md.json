["```\nLogin-AzureRmAccount\n```", "```\nSelect-AzureRmSubscription -SubscriptionId \"********-****-****-****-***********\"\n\n```", "```\nNew-AzureRmResourceGroup -Name PacktPubPS -Location WestEurope\n```", "```\nNew-AzureRmAvailabilitySet -Location WestEurope -Name AvailabilitySet02 -ResourceGroupName PacktPubPS -Sku Aligned -PlatformFaultDomainCount 2 -PlatformUpdateDomainCount 2\n```", "```\n$availabilitySet = Get-AzureRmAvailabilitySet -ResourceGroupName PacktPubPS -Name AvailabilitySet02\n\n$cred = Get-Credential -Message \"Enter a username and password for the virtual machine.\"\n\n$subnetConfig = New-AzureRmVirtualNetworkSubnetConfig -Name PacktSubnet -AddressPrefix 192.168.1.0/24\n$vnet = New-AzureRmVirtualNetwork -ResourceGroupName PacktPubPS -Location WestEurope -Name PacktVnet -AddressPrefix 192.168.0.0/16 -Subnet $subnetConfig\n\n$nsgRuleRDP = New-AzureRmNetworkSecurityRuleConfig -Name PacktNetworkSecurityGroupRuleRDP -Protocol Tcp -Direction Inbound -Priority 1000 -SourceAddressPrefix * -SourcePortRange * -DestinationAddressPrefix * -DestinationPortRange 3389 -Access Allow\n\n$nsg = New-AzureRmNetworkSecurityGroup -Location WestEurope -Name PacktSecurityGroup -ResourceGroupName PacktPubPS -SecurityRules $nsgRuleRDP\n\n# Apply the network security group to a subnet\nSet-AzureRmVirtualNetworkSubnetConfig -VirtualNetwork $vnet -Name PacktSubnet -NetworkSecurityGroup $nsg -AddressPrefix 192.168.1.0/24\n\n# Update the virtual network\nSet-AzureRmVirtualNetwork -VirtualNetwork $vnet \nfor ($i=1; $i -le 2; $i++)\n{\n $pip = New-AzureRmPublicIpAddress -ResourceGroupName PacktPubPS -Location WestEurope -Name \"$(Get-Random)\" -AllocationMethod Static -IdleTimeoutInMinutes 4\n\n $nic = New-AzureRmNetworkInterface -Name PacktNic$i -ResourceGroupName PacktPubPS -Location WestEurope -SubnetId $vnet.Subnets[0].Id -PublicIpAddressId $pip.Id -NetworkSecurityGroupId $nsg.Id\n\n # Specify the availability set\n $vm = New-AzureRmVMConfig -VMName PacktVM$i -VMSize Standard_D2_v3 -AvailabilitySetId $availabilitySet.Id\n\n $vm = Set-AzureRmVMOperatingSystem -ComputerName myVM$i -Credential $cred -VM $vm -Windows -EnableAutoUpdate -ProvisionVMAgent\n $vm = Set-AzureRmVMSourceImage -VM $vm -PublisherName MicrosoftWindowsServer -Offer WindowsServer -Skus 2016-Datacenter -Version latest\n\n $vm = Add-AzureRmVMNetworkInterface -VM $vm -Id $nic.Id\n New-AzureRmVM -ResourceGroupName PacktPubPS -Location WestEurope -VM $vm\n}\n```"]