<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Introduction to the Force.com Migration Tool</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we saw how Salesforce deployment is done in traditional ways. We learned about change set deployment, inbound and outbound changes in Salesforce, how to use Eclipse to deploy code to a sandbox, and Ant scripts as well. Also, we compared deployment methods in Salesforce with their advantages and disadvantages and learned how to choose the appropriate method of deployment according to our use case.</p>
<p>In this chapter, we will study the Force.com Migration Tool<span> </span><span>in detail</span><span>. We will discover how to install and set up the Force.com Migration Tool. Also, we will see how to use the migration tool to retrieve metadata components from a Salesforce sandbox and deploy them in another sandbox. Also, we will explain some important operations such as deploy code and undeploy code. We will discuss about configuration files involved in sandbox operations.</span></p>
<p>We are going to explain the complete process for retrieving metadata from a sandbox and constructing a project manifest. We will learn how to configure sandbox credentials in Force.com Migration Tool to perform operations like deploy or delete metadata files from a sandbox.</p>
<p>In this chapter, we will learn about the following topics:</p>
<ul>
<li>What the Force.com Migration Tool is?</li>
<li>How to set up the Force.com Migration Tool</li>
<li>How the Force.com tool helps developers and DevOps</li>
<li>Using the migration tool to retrieve metadata from a sandbox</li>
<li>Deploying metadata on a sandbox</li>
<li>Deleting files/components from a Salesforce organization using <kbd>destructiveChanges.xml</kbd></li>
<li>Troubleshooting</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What the Force.com Migration Tool is?</h1>
                </header>
            
            <article>
                
<p>The Force.com Migration Tool provides a scripted way to deploy or retrieve metadata to and from a Salesforce sandbox. It is based on Ant/Java.</p>
<p>The Force.com Migration Tool helps us to copy Salesforce components from one organization easily. In normal practice, we have different environments such as development, test, UAT, and production. As developers develop components in a Developer sandbox, they need to move those changes to test or UAT for testers to test and give the green light for a feature/change to production. However, this is not a one-time process. Often, features or changes do not work properly or they introduce some bugs, testers raise an issue/bug, and developers start working on them. Once the bug/issue is fixed in the development environment, we need deployment of the change to test/UAT again. So, this is a repetitive process due to many reasons. Doing this deployment using a change set every time is not a convenient option, hence we need a solution to perform this task that is fast, easy, and less error-prone.</p>
<p>The Ant Migration Tool provides a solution to all of the problems we just discussed. The Ant Migration Tool is easy to set up and use. Once setup is done, only a few more things need to be changed for repetitive use. Ant migration tasks can be scripted, so we can easily automate most of your daily tasks. The Force.com Migration Tool is a Salesforce-supported tool; we don't have to worry much about its compatibility with your application and security.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the Force.com Migration Tool</h1>
                </header>
            
            <article>
                
<p>For setting up the Force.com Migration Tool, you need to install some prerequisites as mentioned in the following section. We can set up the migration tool on Windows, Mac, or Linux operating systems. The following are the steps for setting up the Force.com Migration Tool on a Linux machine.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Prerequisites </h1>
                </header>
            
            <article>
                
<p>The prerequisites for setup are as follows:</p>
<ul>
<li>Java 1.7.x or later</li>
<li>Ant tool</li>
</ul>
<p>Let's install them on our system.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Java</h1>
                </header>
            
            <article>
                
<p>Java version 1.7.x or later is recommended for better security. Check whether Java is already installed on your system using the command line as shown:</p>
<ol>
<li>Open the Terminal.</li>
<li>Type <kbd>java -version</kbd> and press <em>Enter</em>.</li>
</ol>
<p>You will see the following output:</p>
<pre>java version "1.7.0_21" 
Java(TM) SE Runtime Environment (build 1.7.0_21-b11) 
Java HotSpot(TM) 64-Bit Server VM (build 23.21-b01, mixed mode) </pre>
<p>If Java is not installed on the system, use the following instructions to install Java:</p>
<ol>
<li>Visit <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</li>
<li>Download the latest version of the Java JDK. Install the JDK.</li>
<li>Verify by typing <kbd>java -version</kbd> at Command Prompt.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Ant</h1>
                </header>
            
            <article>
                
<p>To check the Ant version installed, you need to perform the following steps:</p>
<ol>
<li>Open the Terminal.</li>
<li>Run the <kbd>ant -version</kbd> <span>command</span> to verify whether Ant is installed on the system.</li>
</ol>
<p>The output will be as follows:</p>
<pre><strong>ant -version 
Apache Ant(TM) version 1.10.1 compiled on February 2 2017</strong> </pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>If Ant is not installed on your system, then use following steps to install Ant:</p>
<div class="packt_tip">The recommended Ant version is 1.5.x or later; you will need to download the latest version of Ant.</div>
<ol>
<li>Download Apache Ant from <a href="http://ant.apache.org/bindownload.cgi">http://ant.apache.org/bindownload.cgi</a>. You need to download an Ant version above 1.6 in <kbd>ANT_HOME</kbd>. <span>Note that, in our case, it is <kbd>/usr/local/</kbd></span>:</li>
</ol>
<pre style="padding-left: 90px"><strong>$wget http://www-eu.apache.org/dist//ant/binaries/apache-ant-</strong><br/><strong>1.9.13-bin.tar.gz</strong></pre>
<ol start="2">
<li>Unzip Apache Ant to <kbd>ANT_HOME</kbd>:</li>
</ol>
<pre style="padding-left: 90px"><strong>$unzip apache-ant-1.9.13-bin.tar.gz</strong></pre>
<ol start="3">
<li>Add the <kbd>bin</kbd> directory to your path .</li>
<li>Add the Ant binary path to the <kbd>.bashrc</kbd> file as shown:</li>
</ol>
<pre style="padding-left: 90px"><strong>export JAVA_HOME=/usr/lib/jvm/java-1.8.0 
export PATH=$PATH:$JAVA_HOME/bin 
export ANT_HOME=/usr/local/apache-ant-1.9.13 
export PATH=$PATH:$ANT_HOME/bin</strong> </pre>
<p>For more information, see <a href="http://ant.apache.org/manual/install.html">http://ant.apache.org/manual/install.html</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Ant Migration Tool on Linux</h1>
                </header>
            
            <article>
                
<p>The installation <span>steps</span><span> </span><span>are as follows:</span></p>
<ol>
<li>Download the Force.com Migration Tool from <a href="https://developer.salesforce.com/page/Force.com_Migration_Tool">https://developer.salesforce.com/page/Force.com_Migration_Tool</a>:</li>
</ol>
<pre style="padding-left: 90px"><strong>#wget https://gs0.Salesforce.com/dwnld/</strong><br/><strong>SfdcAnt/Salesforce_ant_39.0.zip</strong></pre>
<ol start="2">
<li>Save the <kbd>.zip</kbd> file locally and extract the contents to the directory of your choice:</li>
</ol>
<pre style="padding-left: 90px"><strong>#unzip Salesforce_ant_39.0.zip</strong> </pre>
<div class="packt_infobox">Note that, in our case, it is <kbd>/home/devops/Force_com_tool</kbd>.</div>
<ol start="3">
<li>After unzipping <kbd>Salesforce_ant_39.0.zip</kbd>, you will find <kbd>ant-Salesforce.jar</kbd>; this is required to run Ant tasks. Copy <span><kbd>Salesforce_ant_39.0.zip</kbd> to</span> another folder named <kbd>Sample</kbd>, which has examples for deploying and retrieving metadata from a sandbox in <span><kbd>codepkgclasses</kbd>, <kbd>removecodepkg</kbd></span>. Also the <kbd>Sample</kbd> folder contains a <kbd>build.properties</kbd> file where we provide credentials to access Salesforce sandboxes. The <kbd>Build.xml</kbd> file has Ant tasks mentioned, which use credentials from <kbd>build.properties</kbd>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Ant Migration Tool on Windows</h1>
                </header>
            
            <article>
                
<p>To use the Ant Migration Tool on a Windows machine, we need Java and Ant installed on the machine. The steps to install Java and Ant are mentioned in the previous section.</p>
<p>The following steps are needed to set the <kbd>ANT_HOME</kbd> environment variable on Windows:</p>
<ol>
<li>Enter <kbd>environment</kbd> in the search box:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a7bdb520-bf59-4ffb-ab81-269f28dcf717.png"/></p>
<ol start="2">
<li>Select <span class="packt_screen">Edit the system environment variables</span>. Under the <span class="packt_screen">Advanced</span> tab, select <span class="packt_screen">Environment Variables</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e7b2ed2b-6fe9-451d-8cd8-e06e9a7d99c1.png" style="width:28.00em;height:31.25em;"/></p>
<ol start="3">
<li>Under <span class="packt_screen">System Environment Variables</span>, create a new <kbd>ANT_HOME</kbd><span> environment variable. </span>Set the value of <kbd>ANT_HOME</kbd> to the Ant binary path:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/41ccb864-a5cc-45cb-8931-0056a5f33efc.png" style="width:24.42em;height:10.42em;"/></p>
<ol start="4">
<li>Create a new environment variable with the name <kbd>ANT_OPTS</kbd> and value <kbd>-Xms256M</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/16438a32-ea86-4977-80f7-cff32960a247.png" style="width:29.00em;height:12.00em;"/></p>
<ol start="5">
<li>Edit the <kbd>Path</kbd> environment variable and add the <kbd>ANT_HOME</kbd> path as shown in the following screenshot. Click on <span class="packt_screen">OK</span>. Again click on <span class="packt_screen">OK</span> to save the environment variable:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c2410003-1ccc-452a-bd40-9c16ded11913.png" style="width:29.50em;height:12.33em;"/></p>
<ol start="6">
<li>Open Command Prompt and check the Ant version using the <kbd>ant -version</kbd><span> command. </span>You will see the output as follows:</li>
</ol>
<pre style="padding-left: 90px"><strong>Apache Ant(TM) version 1.10.5 compiled on July 10 2018</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Salesforce Ant Migration Tool</h1>
                </header>
            
            <article>
                
<p>The installation <span>steps</span><span> are as follows:</span></p>
<ol>
<li>Download the ZIP file for the Ant Migration Tool from <a href="https://developer.salesforce.com/docs/atlas.en-us.daas.meta/daas/forcemigrationtool_install.htm">https://developer.salesforce.com/docs/atlas.en-us.daas.meta/daas/forcemigrationtool_install.htm</a></li>
<li>Save the ZIP file to any directory you like. In this example, we will be using a <kbd>Demo</kbd> folder at the <kbd>C:\Demo</kbd> path.</li>
<li>Extract <kbd>Salesforce_ant_43.0.zip</kbd> to <kbd>C:\Demo\Salesforce_ant_43.0</kbd>. The contents of the ZIP file have already been explained in the <em>Installing the Ant Migration Tool on Linux</em> section.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Retrieving metadata from a sandbox</h1>
                </header>
            
            <article>
                
<p>To start retrieving metadata from a sandbox, we need to configure <kbd>build.xml</kbd>, <kbd>package.xml</kbd>, and <kbd>build.properties</kbd>. The <kbd>build.properties</kbd> file is used to specify Salesforce credentials to form a connection between your machine and the Salesforce sandbox. The <kbd>build.xml</kbd> file contains Ant tasks that need to be performed in the sandbox. package.xml is project manifest it will contain packages to retrieve or deploy.</p>
<p>We will go through the common procedure to retrieve metadata from a Salesforce organization to a local machine using the Ant Migration Tool:</p>
<ol>
<li>Go to the location where you extracted the Force.com Migration Tool <kbd>.zip</kbd> file. You need to edit the <kbd>build.properties</kbd> file using any editor.</li>
<li>In this case, we will use vim editor. Run the following command:</li>
</ol>
<pre style="padding-left: 90px"><strong>$vim build.properties</strong> </pre>
<ol start="3">
<li>Let's have a look at the sample <kbd>build.properties</kbd> file:</li>
</ol>
<pre style="padding-left: 60px">build.properties 
sf.username = devopsxxx@Salesforce.com.dev 
sf.password = mypassxxxxxxxxxxxxxxxxxxxxxxxxx 
sf.token = &lt;Security Token Generated&gt; 
#sf.sessionId = &lt;Insert your Salesforce session id here. Use this or username/password above. Cannot use both&gt; 
#sf.pkgName = &lt;Insert comma separated package names to be retrieved&gt; 
#sf.zipFile = &lt;Insert path of the zipfile to be retrieved&gt; 
#sf.metadataType = &lt;Insert metadata type name for which listMetadata or bulkRetrieve operations are to be performed&gt; 
# Use 'https://login.Salesforce.com' for production or developer edition (the default if not specified). 
# Use 'https://test.Salesforce.com for sandbox. 
sf.serverurl = <a href="https://test.salesforce.com">https://test.Salesforce.com</a> &lt;ForSandbox&gt;
sf.maxPoll = 20 
# If your network requires an HTTP proxy, see http://ant.apache.org/manual/proxy.html for configuration. 
Load properties from file </pre>
<ol start="4">
<li>Add the required login credentials for the desired Salesforce organization, such as the following:</li>
</ol>
<ul style="padding-left: 120px">
<li><kbd>Sf.username</kbd>: This field specifies the Salesforce username for your sandbox/production. The username provided should have permission to <span class="packt_screen">Modify All Data</span>. If you are connecting to your sandbox instance, then you need to append your sandbox name to your username.</li>
<li style="list-style-type: none">For example, if y<span>ou can specify username as per you wish but it is good practice to have meaningful names , it will help us to identify sandbox. If your username is</span> <kbd>xxx@Salesforce.com</kbd> <span>and you want to connect with sandbox</span> <kbd>dev</kbd> <span>then the</span> <kbd>sf.username</kbd> <span>value can be</span> <kbd>xxx@Salesforce.com.dev</kbd><span>.</span></li>
</ul>
<ul style="padding-left: 120px">
<li><kbd>Sf.password</kbd>: This field specifies the password for your Salesforce username. You need to append a Salesforce security token to the password. A security token is 25-digit case-sensitive code that is used for authenticating an API login. A security token is required when you are logging in using an API.</li>
<li style="list-style-type: none">For example, if your password is <kbd>mypass</kbd> and the security token is <kbd>xxxxxxxxxxxxxxxxxxxxxxxxx</kbd> then the value of the <kbd>sf.password</kbd> field should be <kbd>mypassxxxxxxxxxxxxxxxxxxxxxxxxx</kbd>.</li>
<li style="list-style-type: none">If you don't have a security token, you can reset it. The steps to reset your security token are as follows:</li>
</ul>
<ol style="padding-left: 180px">
<li>Log in to your organization, and navigate to the top navigation bar. Go to &lt;your name&gt; | <span class="packt_screen">My Settings</span> | <span class="packt_screen">Personal</span> | <span class="packt_screen">Reset My Security Token</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cf4e2d7e-7761-4eae-bb5e-a8d9c70c2140.png" style="width:63.75em;height:20.83em;"/></p>
<ol>
<li style="list-style-type: none">
<ul>
<li style="list-style-type: none">
<ol start="2">
<li>Click on <span class="packt_screen">Reset Security Token</span>. This invalidates your existing token.</li>
<li>You will get your security token on your user's mail ID. For security reasons, the security token is not shown in the reset settings.</li>
</ol>
</li>
</ul>
</li>
</ol>
<div class="packt_infobox">Note: If you still face issues at login, you need to check whether you have set a <span class="packt_screen">Login IP Range</span> such as 53.14.120.10 to 53.14.120.255. Then you need to delete the login IP range if you are not in the same IP range.</div>
<ul style="padding-left: 120px">
<li><kbd>Sf.serverurl</kbd>: This field specifies the server URL for Salesforce. If you want to connect to a production organization or Developer Edition organization then the value of this field will be <kbd>https://login.Salesforce.com</kbd>. If you want to work with a sandbox then the value of field will be <kbd>https://test.Salesforce.com</kbd>.If you use custom domain then you can set value as <kbd>https://custom-domain.my.salesforce.com</kbd>.</li>
</ul>
<ol start="5">
<li>Now we need to list out all components we want to retrieve from the sandbox.</li>
<li style="list-style-type: none">The <kbd>package.xml</kbd> <span>file is a project manifest where we list all the components we want to retrieve or deploy. In our</span> <kbd>package.xml</kbd> <span>file, we have mentioned all Apex class components in the project. If you want to take a backup of your sandbox metadata, then you can mention all components in</span> <kbd>package.xml</kbd><span>. For e</span>xample, <kbd>package.xml</kbd> is <span>for</span> Apex classes<span> only:</span></li>
</ol>
<pre style="padding-left: 60px">&lt;?xml version="1.0" encoding="UTF-8"?&gt; 
&lt;Package &gt; 
    &lt;types&gt; 
    &lt;members&gt;*&lt;/members&gt; 
    &lt;name&gt;ApexClass&lt;/name&gt; 
    &lt;/types&gt; 
    &lt;version&gt;36.0&lt;/version&gt; 
&lt;/Package&gt; </pre>
<ol start="6">
<li>The next file we need to configure is <kbd>build.xml</kbd>. This file specifies a target to retrieve and deploy metadata. Ant tasks are mentioned in the <kbd>build.xml</kbd> file. The configuration steps are as follows:
<ol>
<li>Go to the directory where <kbd>build.xml</kbd> is situated</li>
<li>Run the <kbd>ant</kbd> <span>command </span>to verify whether you have installed Apache Ant properly</li>
<li>The <kbd>build.xml</kbd> file loads the <kbd>build.properties</kbd> file to get access to the sandbox</li>
<li>To retrieve metadata from your sandbox, user parameters can be set for each <kbd>&lt;sf:retrieve&gt;</kbd> target</li>
<li>As our retrieve target is <kbd>DevOps/src</kbd>, all metadata will be stored in this directory</li>
</ol>
</li>
<li style="list-style-type: none">For example, take a look at the following <kbd>build.xml</kbd> file:</li>
</ol>
<pre style="padding-left: 90px">&lt;project name="Force.com Migration Tool" default="retrieveUnpackaged" basedir="." &gt; 
&lt;taskdef uri="antlib:com.Salesforce" 
        resource="com/Salesforce/antlib.xml" 
        classpath="lib/ant-Salesforce.jar" 
    /&gt; 
    &lt;!-- Load properties from file --&gt; 
    &lt;property file="build.properties"/&gt; 
    &lt;!-- Load properites from environment --&gt; 
    &lt;!-- These will override properties from the file --&gt; 
        &lt;property environment="env"/&gt; 
        &lt;property name="sf.username" value="${env.SF_USERNAME}"/&gt; 
        &lt;property name="sf.password" value="${env.SF_PASSWORD}"/&gt; 
        &lt;property name="sf.token" value="${env.SF_TOKEN}"/&gt; 
        &lt;property name="sf.serverurl" value="${env.SF_SERVERURL}"/&gt; 
 
        &lt;!-- Retrieve an unpackaged set of metadata from your org --&gt; 
        &lt;!-- The attribute 'unpackaged' is where metadata will be stored --&gt; 
        &lt;target name="retrieveUnpackaged"&gt; 
        &lt;!-- Retrieve the contents into another directory --&gt; 
                &lt;sf:retrieve 
                        username="${sf.username}" 
                        password="${sf.password}${sf.token}" 
                        serverurl="${sf.serverurl}" 
                        retrieveTarget="DevOps/src" 
                        unpackaged="${basedir}/package.xml" 
                /&gt; 
        &lt;/target&gt; 
    &lt;!-- Retrieve the information on all supported metadata types --&gt; 
&lt;/project&gt; </pre>
<ol start="7">
<li>Retrieve metadata using the <kbd>ant</kbd> command. Run the following command to retrieve Apex class metadata in the retrieve target, that is, <kbd>DevOps/src</kbd>:</li>
</ol>
<pre style="padding-left: 90px"><strong>$ ant -file build.xml</strong></pre>
<ol start="8">
<li>The console log is shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/8a20c3de-fe57-4e16-aa98-4d83e52255a3.png" style="width:41.67em;height:10.67em;"/></div>
<p>If the build is successful, then it will show a <kbd>BUILD SUCCESSFUL</kbd> message.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p class="mceNonEditable"/>
<p class="mceNonEditable"/>
<p class="mceNonEditable"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying metadata on a sandbox</h1>
                </header>
            
            <article>
                
<p>We saw in the previous example how we can retrieve metadata from a sandbox and deploy to a local environment. We can use Eclipse to edit and make changes in code or add new feature code. Developers can use the Force.com migration plugin to sync metadata with a workspace in Eclipse. After making changes in code, developers can deploy changes on a test/UAT sandbox. We can use the Force.com Migration Tool to deploy changes to the sandbox.</p>
<p>We will go through the common procedure to deploy metadata to a Salesforce organization from a local machine using the Ant Migration Tool. To provide access to the sandbox, we need to add sandbox credentials in the <kbd>build.properties</kbd> file as we provided credentials in <em>Step 3</em> in the <em>Retrieve metadata from sandbox</em> section previously. The value of the <kbd>Sf.serverurl</kbd> field will depend on where you want to deploy your changes. If you want to deploy on test, UAT sandbox, or any other development sandbox, then it will be <kbd>https://test.Salesforce.com</kbd>. If you are deploying your changes to the production environment, then use <kbd>https://login.Salesforce.com</kbd>. But until all test cases are successfully passed, we should not deploy any changes to the production environment directly; this can introduce failure in existing features and break the application.</p>
<p>Once we are done with changes in <kbd>build.properties</kbd>, we need to add all the components we want to deploy to the sandbox in <kbd>package.xml</kbd>:</p>
<pre>&lt;project name="Force.com Migration Tool" default="retrieveUnpackaged" basedir="." &gt; 
&lt;taskdef uri="antlib:com.Salesforce" 
        resource="com/Salesforce/antlib.xml" 
        classpath="lib/ant-Salesforce.jar" 
    /&gt; 
        &lt;property environment="env"/&gt; 
        &lt;property name="sf.username" value="${env.SF_USERNAME}"/&gt; 
        &lt;property name="sf.password" value="${env.SF_PASSWORD}"/&gt; 
        &lt;property name="sf.token" value="${env.SF_TOKEN}"/&gt; 
        &lt;property name="sf.serverurl" value="${env.SF_SERVERURL}"/&gt; 
 
                      &lt;sf:deploy 
                        username="${sf.username}" 
                        password="${sf.password}${sf.token}" 
                        serverurl="${sf.serverurl}" 
                        deployRoot="DevOps/src" 
                        maxPoll="1000"  
                                                  testLevel="NoTestRun" 
                                                  pollWaitMillis="10000"  
                                                  rollbackOnError="true" 
                /&gt; 
        &lt;/target&gt; 
    &lt;/project&gt; </pre>
<p>In the preceding file, there are some new parameters, such as the following:</p>
<ul>
<li><kbd>deployRoot</kbd>: This is a mandatory parameter. All files to deploy will be there in this directory.</li>
<li><kbd>maxPoll</kbd>: This is an optional parameter. This parameter defines the number of times to poll the server for the results of the deploy request. It has 200 as the default value.</li>
<li><kbd>testLevel</kbd>: This is an optional parameter that specifies which tests to run while deployment is done on a specific sandbox. The value of this parameter can be different depending on the type of sandbox and where deployment is going on. For a development sandbox, this is set to <kbd>NoTestRun</kbd> as default where no tests will run. You can specify other options where you can choose which test cases to run or run all tests on organization that we will see in more detail in <a href=""/><a href="95062e49-8aff-4b6f-a02d-d81ca0f7cc41.xhtml">Chapter 7</a>, <em>Continuous Testing.</em></li>
<li><kbd>pollWaitMillis</kbd>: This is an optional parameter that defines the number of milliseconds to wait while polling for results of the deployment. The default value of this parameter is 10,000, so we can set this accordingly.</li>
</ul>


            </article>

            
        </section>
    

        <section>&#13;
&#13;
                            <header>&#13;
                    <h1 class="header-title">Deleting files/components from a Salesforce organization using destructiveChanges.xml</h1>&#13;
                </header>&#13;
            &#13;
            <article>&#13;
                &#13;
<p>We have seen we can retrieve metadata from a sandbox, and we can deploy changes to a sandbox using the Ant Migration Tool. But sometimes we don't need some features and we want to delete some components or files such as objects, fields, and so on from our Salesforce organization. We need to create one more file along with <kbd>package.xml</kbd> that is <kbd>destructiveChanges.xml</kbd>. The format of the <kbd>destructiveChanges.xml</kbd> <span>delete manifest </span>will be the same as <kbd>package.xml</kbd>, only wildcard characters are not accepted in a delete manifest.</p>&#13;
<p>Delete component is same process as deploying components with delete manifest file. We need to add a list of the components to delete in <kbd>destructiveChanges.xml</kbd><em>.</em> A sample file to delete a custom object is as follows:</p>&#13;
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt; &#13;
    &lt;Package http://soap.sforce.com/2006/04/metadata"&gt;http://soap.sforce.com/2006/04/metadata"&gt; &#13;
    &lt;types&gt; &#13;
        &lt;members&gt;MyTestObject__c&lt;/members&gt; &#13;
        &lt;name&gt;CustomObject&lt;/name&gt; &#13;
    &lt;/types&gt; &#13;
&lt;/Package&gt; </pre>&#13;
<p>To deploy destructive changes, we need <kbd>package.xml</kbd> that contains only an API version. It should not contain any list of components. The <kbd>destructiveChanges.xml</kbd> and <kbd>package.xml</kbd> files should be in same directory.</p>&#13;
&#13;
&#13;
            </article>&#13;
&#13;
            &#13;
        </section>&#13;
    

        <section>

                            <header>
                    <h1 class="header-title">How the Force.com tool helps developers and DevOps</h1>
                </header>
            
            <article>
                
<p>The Force.com Migration Tool provides developers with a way to easily perform operations on their sandbox, such as retrieving, deploying, and deleting metadata. Using the Force.com Migration Tool, developers can deploy code to different sandboxes and switch between workspaces on Eclipse. The Migration Tool is easy to set up on developers' machines, and it provides a secure way to communicate with your Salesforce organization.</p>
<p>We can face issues if something goes wrong with deployments; having automated daily backup is very important in such scenarios. The Force.com Migration Tool provides a command-line way to retrieve the code and configuration from a Salesforce sandbox, so DevOps or admins can automate the task of taking a backup for your Salesforce organization code and configuration. Also, we can make use of open source continuous integration tools such as Jenkins to automate the process to take a backup of a Salesforce organization and save it to Git. In <a href="c18c24e5-b3e1-467c-8e33-cc278016e0a6.xhtml">Chapter 6</a><em>, Continuous Integration</em>, we will cover using Jenkins to automate the Salesforce organization backup process step by step.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Troubleshooting</h1>
                </header>
            
            <article>
                
<p>In this section, we will have a look at troubleshooting scenarios:</p>
<ul>
<li><strong>Connection issues</strong>: The most common issue we face during retrieval or deploying metadata is a connection issue. We use asynchronous types of requests during retrieval or deployment of metadata so we do not get a response immediately. The call for deploy operation is asynchronous sometimes Ant Migration Tool time outs during deployment. So if the Ant Migration Tool fails due to timeout and the deployment has any errors, we will not be able to see the error logs. In that case, we need to configure the <kbd>pollWaitMillis</kbd> and <kbd>maxPoll</kbd> parameters.</li>
<li><strong>Invalid credentials or user locked out</strong>: If you are getting this error, then there is an issue with your <kbd>build.properties</kbd> file. You need to verify the username, password, security token, and server URL are correct. Also, if you have <span>several failed login attempts</span>, then there is chance that your user is locked out. So, the number of failed attempts that are allowed depends on your organization's settings. Sometimes, verifying proxy settings will also help to resolve issues with credentials.</li>
<li><strong>Failed test cases</strong>: If you are deploying changes to production, then as per Salesforce standards you need 75% code to be covered by test cases, and all test cases should pass to deploy code to a production environment successfully.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned about the Force.com Migration Tool and how to set up the tool in your environment. We have seen the step-by-step process to retrieve metadata from a sandbox using Ant scripts, and we learned about configuring our sandbox credentials in <kbd>build.properties</kbd> to provide access to a sandbox environment, listing components to retrieve in the <kbd>package.xml</kbd> project manifest, and retrieving the contents into the directory mentioned in the <kbd>build.xml</kbd> file.</p>
<p>After successfully retrieving metadata from a sandbox to a local machine, we moved to the next step, which is deploying changes to a sandbox. We have seen sample deployment of metadata using the Ant Migration Tool to a developer sandbox or test sandbox. Sometimes, we might need to delete components or files from a sandbox. We have seen how we can delete components from a Salesforce organization using <kbd>destructiveChanges.xml</kbd>.</p>
<p>In the next chapter, we will see what source control versioning <span>is. W</span><span>e will also learn the advantages of using Git, branching strategy in Git, and how to set up a Git repository for your Salesforce project. We will also go through the developer flow of using Git with a code editor such as Eclipse.</span></p>


            </article>

            
        </section>
    </body></html>