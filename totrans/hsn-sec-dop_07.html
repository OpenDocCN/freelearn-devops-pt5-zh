<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Threat Modeling Practices and Secure Design</h1>
                
            
            <article>
                
<p class="calibre2">After discussing security architecture and design principles, we will now introduce threat modeling security practices and tools. The a<span class="calibre6">doption of threat modeling practices can help to reduce major security risks in the design phase. In addition, once the risks are identified, we will introduce how to apply OWASP secure design best practices to mitigate security risks.</span></p>
<p class="calibre2"><span class="calibre6">The topics to be covered in this chapter are the following:</span></p>
<ul class="calibre10">
<li class="calibre11"><span>Threat modeling practices</span></li>
<li class="calibre11">Threat modeling with STRIDE</li>
<li class="calibre11">Diagram designer tool</li>
<li class="calibre11">Card game</li>
<li class="calibre11"><span>Threat library references</span></li>
<li class="calibre11"><span>Case study: formal documents or not?</span></li>
<li class="calibre11"><span>Secure design</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Threat modeling practices</h1>
                
            
            <article>
                
<p class="calibre2">Threat modeling is a security practice for the team to identify threats, attacks, and risks based on the existing architecture design, and also to mitigate these potential security risks. There are a few key points to clarify in threat modeling before we discuss them further:</p>
<ul class="calibre10">
<li class="calibre11">It's a team activity. It's not just the developer's job. It will be more effective with QA, operation, architect, and security team involvement.</li>
<li class="calibre11">Threat modeling may be the only security practice that is not recommended to be done by automation. It's a team exercise.</li>
<li class="calibre11">The purpose of threat modeling is not to offer a comprehensive threat list, but to identify high-risk threats with key modules such as authentication, authorization, purchases, or customer info handling.</li>
<li class="calibre11">It's suggested to do threat modeling when the architecture design is done or before the detailed design and coding stages, although it's also common to apply threat modeling to existing applications.</li>
</ul>
<p class="calibre2">A typical threat modeling process includes a DFD diagram or architecture review, threat analysis, risk impact assessment, mitigations, and product implementation action review. A Threat modeling normally begins with an analysis of the architecture. DFD diagrams may commonly be used in threat modeling activity. However, as long as the team can understand the whole architecture design and information flow, UML or other existing architecture designs may also do the job. The objective of threat modeling is to discuss the most relevant and high-priority security risks with mitigations. Don't let the process or tools limit the team's learning and innovation.</p>
<p class="calibre2">Depending on the complexity of the applications, we may do threat modeling with architecture or high-level design. If it's a very large project, and most of the modules serve similar functions, it's suggested you perform the threat modeling with high-risk parts or the one which can mostly represent the business functions. Here are the recommended modules for threat modeling. These also apply to coding review:</p>
<ul class="calibre10">
<li class="calibre11">Modules with security controls such as authentication, authorization, session management, encryption, data validation, error handling, or logging, administration, and database handlers.</li>
<li class="calibre11">Legacy modules with vulnerable CVE.</li>
<li class="calibre11">Modules that may externally interact with unknown users or third-party APIs.</li>
<li class="calibre11">Modules that handle sensitive information.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Threat modeling with STRIDE</h1>
                
            
            <article>
                
<p class="calibre2">The STRIDE threat model defines threats in six categories, which are spoofing, tampering, repudiation, information disclosure, denial of service, and elevation of privilege. It's normally used to assess the architecture design.</p>
<p class="calibre2"/>
<p class="calibre2">The threat STRIDE model and general security mitigation are summarized in the following table. In addition to STRIDE, it's also suggested to include privacy in the analysis:</p>
<table border="1" class="calibre75">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">STRIDE threats</strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Mitigation</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Spoofing</p>
</td>
<td class="calibre28">
<p class="calibre2">Authentication such as credentials, certificates, and SSH</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Tampering</p>
</td>
<td class="calibre28">
<p class="calibre2">Integrity (HASH256, digital signature)</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Repudiation</p>
</td>
<td class="calibre28">
<p class="calibre2">Authentication, logging</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Information Disclosure</p>
</td>
<td class="calibre28">
<p class="calibre2">Confidentiality (encryption, ACL)</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Denial of Service</p>
</td>
<td class="calibre28">
<p class="calibre2">Availability (load balance, buffer, message queue)</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Elevation of Privilege</p>
</td>
<td class="calibre28">
<p class="calibre2">Authorization (ACL)</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Privacy (additionally included)</p>
</td>
<td class="calibre28">
<p class="calibre2">Data masking, access control, user consent, removal</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"> </p>
<p class="calibre2">The analysis of STRIDE analysis normally involves the entity (user, admin, external application), the process (web server, FTP, service), the data store (database or file), the dataflow (parameters or information between modules, processes, systems, or users), and the trust boundary. Here are some examples of STRIDE analysis mapping:</p>
<table border="1" class="calibre75">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">STRIDE and privacy threats</strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Examples</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Spoofing</p>
</td>
<td class="calibre28">
<p class="calibre2">The entity (user or client side) may spoof its identity.</p>
<p class="calibre2">The process may spoof its source.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Tampering</p>
</td>
<td class="calibre28">
<p class="calibre2">The process may be tampered with, such as in a DLL injection attack.</p>
<p class="calibre2">The data store can be tampered with.</p>
<p class="calibre2">The information flow may be tampered with, such as MITM.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Repudiation</p>
</td>
<td class="calibre28">
<p class="calibre2">The entity (client side) may deny what has been done.</p>
<p class="calibre2">The process may tamper with logs to deny what has been done.</p>
<p class="calibre2">The data store of audit logs can be tampered with.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Information disclosure</p>
</td>
<td class="calibre28">
<p class="calibre2">The process itself may include an encryption key and can be reversed.</p>
<p class="calibre2">The data store keeps clear-text copies of passwords.</p>
<p class="calibre2">The data flow transmits the password without an encryption channel.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Denial of service</p>
</td>
<td class="calibre28">
<p class="calibre2">The process may be connected to too many clients, and be overloaded.</p>
<p class="calibre2">The data store is damaged or full.</p>
<p class="calibre2">The data flow is disconnected and can't reach the destination.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Elevation of Privilege</p>
</td>
<td class="calibre28">
<p class="calibre2">The process should be in user-mode but can execute a kernel-mode command.</p>
<p class="calibre2">The process is running with additional permissions.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Privacy</p>
</td>
<td class="calibre28">
<p class="calibre2">The external entity (client app) may collect PII but doesn’t inform the user.</p>
<p class="calibre2">The data store keeps PII in logs without anonymization.</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"> </p>
<p class="calibre2">Refer to OWASP <em class="calibre16">Application Threat Modeling</em> for more examples based on the DFD diagram: <a href="https://www.owasp.org/index.php/Application_Threat_Modeling" class="calibre9">https://www.owasp.org/index.php/Application_Threat_Modeling</a>.</p>
<p class="calibre2">In practice, STRIDE may still be too general for the team to proceed with the threat discussion. It's highly suggested to use a checklist or threat library lists, such as a CWE list (<a href="https://cwe.mitre.org/data/index.html" class="calibre9">https://cwe.mitre.org/data/index.html</a>), <strong class="calibre4"><span class="calibre6">Common Attack Pattern Enumeration and Classification</span></strong> (<strong class="calibre4"><span class="calibre6">CAPEC</span></strong>), or <strong class="calibre4"><span class="calibre6">Adversarial Tactics, Techniques and Common Knowledge</span></strong> (<strong class="calibre4"><span class="calibre6">ATT&amp;CK</span></strong>), which we will discuss in the next section.</p>
<p class="calibre2">Tools and templates are there to help the team to do threat modeling more efficiently. On the other hand, the use of tools may introduce a learning curve or overhead to the team. We will introduce some tools to apply to threat modeling practices.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Diagram designer tool</h1>
                
            
            <article>
                
<p class="calibre2">These kinds of tool help you to draw the application diagrams (DFD), to mark the trust boundaries, and to label the threat attributes. The tools also include a threat library for users to select a threat from the library. It's an ideal tool to document the threat modeling analysis report. Normally, the application architecture and system diagram DFD were presented followed by the threat identification.</p>
<p class="calibre2">If your team is geographically distributed across several regions, or the threat modeling requires offline feedback with several roles across different time zones, using of the tool to produce the threat modeling analysis report is highly recommended.</p>
<p class="calibre2">The Microsoft Threat Modeling tool, OWASP Threat Dragon, and Mozilla SeaSponge are the tools in this category that allow you to draw DFD diagrams with threat analysis:</p>
<ul class="calibre10">
<li class="calibre11">Microsoft Threat Modeling Tool: <a href="https://www.microsoft.com/en-us/download/details.aspx?id=49168" class="calibre9">https://www.microsoft.com/en-us/download/details.aspx?id=49168</a></li>
<li class="calibre11">OWASP Threat Dragon: <a href="https://www.owasp.org/index.php/OWASP_Threat_Dragon" class="calibre9">https://www.owasp.org/index.php/OWASP_Threat_Dragon</a></li>
<li class="calibre11">Mozilla SeaSponge: <a href="http://mozilla.github.io/seasponge/" class="calibre9">http://mozilla.github.io/seasponge/</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Card games</h1>
                
            
            <article>
                
<p class="calibre2">Card games makes threat modeling a team-building game. All team members are gathered together with a deck of cards and the data flow diagram of the application. Each card represents one common threat. Take OWASP Cornucopia as an example. The threats are also mapped to industry practices such as OWASP SCP, OWASP ASVS, CAPEC, and SAFECode.</p>
<p class="calibre2">The OWASP Cornucopia defines six suits for the key security areas:</p>
<ul class="calibre10">
<li class="calibre11"><span><strong class="calibre1">Data validation and encoding</strong> (<strong class="calibre1">VE</strong>)</span></li>
<li class="calibre11"><strong class="calibre1">Authentication</strong> (<strong class="calibre1">AT</strong>)</li>
<li class="calibre11"><strong class="calibre1">Session management</strong> (<strong class="calibre1">SM</strong>)</li>
<li class="calibre11"><strong class="calibre1">Authorization</strong> (<strong class="calibre1">AZ</strong>)</li>
<li class="calibre11"><strong class="calibre1">Cryptography</strong> (<strong class="calibre1">CR</strong>)</li>
<li class="calibre11"><strong class="calibre1">Cornucopia</strong> (<strong class="calibre1">C</strong>)</li>
</ul>
<p class="calibre2">Refer to this link for a DOC or PDF version of the cards: <a href="https://www.owasp.org/images/6/6b/Owasplondon-colinwatson-cornucopia.pdf" class="calibre9">https://www.owasp.org/index.php/OWASP_Cornucopia#tab=Get_the_Cards</a>.</p>
<p class="calibre2">For example, in the <strong class="calibre4">Data Validation &amp; Encoding</strong> suit card 2, which follows, shows the attack scenario, and the mapping security best practices with OWASP SCP, ASVS, AppSensor, CAPEC, and SAFECode:</p>
<table border="1" class="calibre76">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre77">
<p class="cdpaligncenter1"><strong class="calibre4">2</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre77">
<p class="mce-root">Brian can gather information about the underlying configurations, schemas, logic, code, software, services, and infrastructure due to the content of error messages, poor configuration, or the presence of default installation files or old, test, backup, or copies of resources, or exposure of source code</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre77">
<table border="1" class="calibre18">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre78">
<p class="mce-root">OWASP SCP</p>
<p class="calibre2">69, 107-109, 136, 137, 153, 156, 158, 162</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre78">
<p class="calibre2">OWASP ASVS</p>
<p class="calibre2">1.10, 4.5, 8.1, 11.5, 19.1, 19.5</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre78">
<p class="calibre2">OWASP AppSensor</p>
<p class="calibre2">HT1-3</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre78">
<p class="calibre2">CAPEC</p>
<p class="calibre2">54, 541</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre78">
<p class="calibre2">SAFECode</p>
<p class="calibre2">4, 23</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre78">
<p class="mce-root">OWASP Cornucopia Ecommerce Website Edition v1.20-EN</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"> </p>
<p class="calibre2">This card game can also be an effective tool even <span class="calibre6">with just one developer. A developer or tester can draw a card randomly to reflect the security issue of the existing application.  Use the cards to think about whether the existing design will be vulnerable to threats or any missing security considerations.</span> <span class="calibre6">This card game can make threat modeling a lot of fun. There is no doubt that F2F discussion is always the most effective method of communication.</span></p>
<p class="calibre2"><span class="calibre6">There are two issues we need to be aware of. First, for a team to be able to play the card game together, the F2F team must be sitting together. Secondly, a project team that is distributed across several regions may not be able to play the card game together. To address these two issues, an official documentation of discussion results is still needed. The documentation, which includes identified risks and mitigation actions, is not only for the team that can't join the card game for review but also for the purposes of tracking. </span></p>
<p class="calibre2">References of the card games are as follows:</p>
<ul class="calibre10">
<li class="calibre11">Microsft EOP card game: <a href="https://www.microsoft.com/en-us/sdl/adopt/eop.aspx" class="calibre9">https://www.microsoft.com/en-us/sdl/adopt/eop.aspx</a></li>
<li class="calibre11">OWASP Cornucopia card game: <a href="https://www.owasp.org/index.php/OWASP_Cornucopia" class="calibre9">https://www.owasp.org/index.php/OWASP_Cornucopia</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Threat library references</h1>
                
            
            <article>
                
<p class="calibre2">Sometimes, it's just difficult to brainstorm threats during threat modeling analysis. It will be easier to pick up and select threats from the threat list library that fit the existing application design. Card games do help, but they may only present the most common threats. If you find the threats do not fit your projects or you need additional threat libraries to refer to, here are some suggested industry threat libraries:</p>
<table border="1" class="calibre75">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Threat library</strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Characteristics</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">CAPEC</p>
</td>
<td class="calibre28">
<p class="calibre2">It lists 508 attack patterns in a tree view. The attack patterns are also available in CSV and XML format. Each attack pattern is labeled with a CAPEC-ID number. </p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">ATT&amp;CK</p>
</td>
<td class="calibre28">
<p class="calibre2">The threats are categorized by platform (Linux, Windows, Mac, mobile) with specific attack techniques. Each threat is also discussed with technical mitigation and detection approaches. It includes lots of practical hacker and malware attack techniques. </p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">CWE</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE is a list of software weaknesses. Each CWE is categorized into a threat tree view and presented with both insecure and secure source code implementations. It's also a very good reference for secure coding. </p>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>
<p class="calibre2"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Case study – formal documents or not?</h1>
                
            
            <article>
                
<p class="calibre2">Let's look at a case study to discuss the different approaches of threat modeling practices. Peter and Linda, who are security leads, plan to do threat modeling with a project team. Peter is in a very large organization. The project team is distributed across the Globe. The security process requires a formal threat modeling analysis report as parts of the criteria to move on to the next step. On the other hand, Linda is working with a small software company. Team members are all in the same location. Linda thinks using a whiteboard and card game discussion will be more interactive and efficient instead of detailed documents. As a result, Peter and Linda decided on different approaches to run the threat modeling as summarized in the following table:</p>
<table border="1" class="calibre75">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4"> </strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Formal process (Peter)</strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Group discussion (Linda)</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Characteristics</strong></p>
</td>
<td class="calibre28">
<p class="calibre2">Required formal document delivery</p>
<p class="calibre2">Follow templates and tools to generate the required output</p>
<p class="calibre2">Documents may accumulate knowledge</p>
</td>
<td class="calibre28">
<p class="calibre2">No formal document delivery</p>
<p class="calibre2">Apply card games that focus on the process of team interaction and discussion.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Tools</strong></p>
</td>
<td class="calibre28">
<p class="calibre2">Checklist and templates</p>
<p class="calibre2">Threat modeling and diagram designer</p>
</td>
<td class="calibre28">
<p class="calibre2">Card games</p>
<p class="calibre2">White board</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Disadvantages</strong></p>
</td>
<td class="calibre28">
<p class="calibre2">Documents may be an overhead for the team</p>
</td>
<td class="calibre28">
<p class="calibre2">Lack of documents during the discussion</p>
<p class="calibre2">It may only fit a team whose members are geographically located together</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"> </p>
<p class="calibre2">There is no perfect process. It's just a case of which approach works best for the team. There is no constraint that Peter should not use card games or Linda should not apply the formal process. The most important part of any process's adoption is to understand the objective and the rationale of the process. For example, Linda may consider documenting the final card game discussion results for stakeholders' reference. Peter may consider using card games for a small module/team to reduce the documentation overhead. Considering a mixed approach may be a good idea. Just don’t let the process limit the team's creativity and innovation.   </p>
<p class="calibre2"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Secure design</h1>
                
            
            <article>
                
<p class="calibre2">Secure design can be a very broad topic to discuss. In this section, we are going to focus on the discussion with seven key security controls: authentication, authorization, session management, data validation, error handling, logging, and encryption. Refer to the following diagram:</p>
<p class="cdpaligncenter1"><img class="alignnone18" src="../images/00032.jpeg"/></p>
<p class="calibre2">A secure design may be related to several factors including security requirements, the adoption of the security framework, the logic flow, and the right implementation. Take authentication as an example—market security requirements may add two-factor authentication or <strong class="calibre4"><span class="calibre6">one-time password</span></strong> (<strong class="calibre4"><span class="calibre6">OTP</span></strong>). A security framework, such as Spring Security or Shiro itself, provides authentication, authorization, and session management security controls. However, the wrong logic flow and incorrect implementation may result in its authentication bypassing security issues. Although an organization can define secure design policies and guidelines, it's still the most effective by showing the security framework, CWE case studies, and implementation samples.</p>
<p class="calibre2">Secure design training or newsletters can include the industry-common CWE and also in-house projects' common issues followed by secure design suggestions. It's also suggested to introduce a security framework with the common incorrect implementations that result in security risks. Here, we only list a sample for Java implementation. In addition, the following links are suggested for further reading:</p>
<ul class="calibre10">
<li class="calibre11">OWASP Cheat Sheet: <a href="https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series" class="calibre9">https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series</a> </li>
<li class="calibre11">OWASP Secure Coding Practices: <a href="https://www.owasp.org/index.php/OWASP_Secure_Coding_Practices_-_Quick_Reference_Guide" class="calibre9">https://www.owasp.org/index.php/OWASP_Secure_Coding_Practices_-_Quick_Reference_Guide</a></li>
<li class="calibre11">SAFECode Security in Agile: <a href="http://safecode.org/publication/SAFECode_Agile_Dev_Security0712.pdf" class="calibre9">http://safecode.org/publication/SAFECode_Agile_Dev_Security0712.pdf</a></li>
<li class="calibre11">OWASP Top 10 Proactive Control: <a href="https://www.owasp.org/images/b/bc/OWASP_Top_10_Proactive_Controls_V3.pdf" class="calibre9">https://www.owasp.org/images/b/bc/OWASP_Top_10_Proactive_Controls_V3.pdf</a></li>
</ul>
<p class="calibre2">Just remember that the adoption of a security framework doesn't mean the application will be secured. It still requires the right implementation of the framework:</p>
<table border="1" class="calibre75">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2"><strong class="calibre4"> </strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Common CWE</strong></p>
</td>
<td class="calibre28">
<p class="calibre2"><strong class="calibre4">Open-source framework</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Authentication</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-294: Authentication Bypass by Capture-replay<br class="calibre5"/>
CWE-306: Missing Authentication for Critical Function<br class="calibre5"/>
CWE-307: Improper Restriction of Excessive Authentication Attempts<br class="calibre5"/>
CWE-640 Weak Password Recovery Mechanism for Forgotten Password</p>
<p class="calibre2"> </p>
</td>
<td class="calibre28">
<p class="calibre2">Spring Security</p>
<p class="calibre2">Shiro</p>
<p class="calibre2">KeyCloak</p>
<p class="calibre2">VisualCaptcha</p>
<p class="calibre2">privacyIDEA</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Authorization</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-639: Authorization Bypass Through User-Controlled Key</p>
<p class="calibre2">CWE-647: Use of Non-Canonical URL Paths for Authorization Decisions</p>
<p class="calibre2">CWE-425: Direct Request ('Forced Browsing')</p>
<p class="calibre2"> </p>
</td>
<td class="calibre28">
<p class="calibre2">Spring Security</p>
<p class="calibre2">Shiro</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Session Management</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-384: Session Fixation</p>
<p class="calibre2">CWE-613: Insufficient Session Expiration</p>
<p class="calibre2">CWE-6: J2EE Misconfiguration: Insufficient Session-ID Length</p>
<p class="calibre2">CWE-488: Exposure of Data Element to the Wrong Session</p>
</td>
<td class="calibre28">
<p class="calibre2">Spring Security</p>
<p class="calibre2">Shiro</p>
<p class="calibre2">Jetty</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Data validation</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-89 Improper Neutralization of Special Elements used in an SQL Command</p>
<p class="calibre2">CWE-77: Improper Neutralization of Special Elements used in a Command</p>
<p class="calibre2">CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')</p>
</td>
<td class="calibre28">
<p class="calibre2">Java Commons Validator</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Error handling</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-200: Information Exposure</p>
<p class="calibre2">CWE-460: Improper Cleanup on Thrown Exception</p>
</td>
<td class="calibre28">
<p class="calibre2">N/A. It normally requires secure coding practices and proper configurations.</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Logging</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-532: Information Exposure Through Log Files</p>
<p class="calibre2">CWE-117: Improper Output Neutralization for Logs</p>
<p class="calibre2">CWE-779: Logging of Excessive Data</p>
</td>
<td class="calibre28">
<p class="calibre2">SLF4F (Simple Logging Façade for Java)</p>
<p class="calibre2">OWASP Security Logging</p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre28">
<p class="calibre2">Encryption</p>
</td>
<td class="calibre28">
<p class="calibre2">CWE-759: Use of a One-Way Hash without a Salt CWE-523: Unprotected Transport of Credentials</p>
<p class="calibre2">CWE-330: Use of Insufficiently Random Values</p>
</td>
<td class="calibre28">
<p class="calibre2">OpenSSL</p>
<p class="calibre2">BouncyCastle</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"> </p>
<p class="calibre2">Here are other practical secure software implementation frameworks suggested by OWASP Proactive Controls:</p>
<table border="1" class="calibre18">
<tbody class="calibre19">
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2"><strong class="calibre4">OWASP top 10 proactive controls</strong></p>
</td>
<td class="calibre80">
<p class="calibre2"><strong class="calibre4">Open source tools and frameworks</strong></p>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C1: Define Security Requirements</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">OWASP <strong class="calibre1">Application Security Verification Standard</strong> (<strong class="calibre1">ASVS</strong>)</li>
<li class="calibre11">OWASP <strong class="calibre1">Mobile Application Security Verification Standard</strong> (<strong class="calibre1">MASVS</strong>)</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C2: Leverage Security Frameworks and Libraries</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">OWASP Dependency Check</li>
<li class="calibre11">OWASP Dependency Track</li>
<li class="calibre11">Retire.JS</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C3: Secure Database Access</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">CIS Database Hardening Standards</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C4: Encode and Escape Data</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">OWASP Java Encoder Project Examples</li>
<li class="calibre11">OWASP Java Encoder Project</li>
<li class="calibre11">AntiXSSEncoder</li>
<li class="calibre11">Zend/Escaper</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C5: Validate All Inputs</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">OWASP Java HTML Sanitizer Project</li>
<li class="calibre11">Java JSR-303/JSR-349 Bean Validation</li>
<li class="calibre11">Java Hibernate Validator</li>
<li class="calibre11">JEP-290 Filter Incoming Serialization Data</li>
<li class="calibre11">Apache Commons Validator</li>
<li class="calibre11">PHP’s filter functions</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C6: Implement Digital Identity</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11"><span>LinOTP OTP Authentication: </span><a href="https://www.linotp.org/" class="calibre9">https://www.linotp.org/</a></li>
<li class="calibre11">Gluu Server: <a href="https://www.gluu.org/gluu-server/overview/" class="calibre9">https://www.gluu.org/gluu-server/overview/</a></li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C7: Enforce Access Controls</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">OWASP ZAP with the optional access control testing add-on</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C8: Protect Data Everywhere</p>
<p class="calibre2"> </p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">SSLyze</strong>: SSL configuration scanning library and CLI tool</li>
<li class="calibre11"><strong class="calibre1">SSLLabs</strong>: free service for scanning and checking TLS/SSL configuration</li>
<li class="calibre11"><strong class="calibre1">OWASP O-Saft TLS Tool</strong>: TLS connection testing tool</li>
<li class="calibre11"><strong class="calibre1">TLS Observatory</strong></li>
<li class="calibre11"><strong class="calibre1">SSL Config generator</strong></li>
<li class="calibre11"><strong class="calibre1">GitRob</strong>: Command-line tool to find sensitive information in publicly available files on GitHub</li>
<li class="calibre11"><strong class="calibre1">TruffleHog</strong>: Searches for secrets accidentally committed</li>
<li class="calibre11"><strong class="calibre1">KeyWhiz</strong>: Secrets manager</li>
<li class="calibre11"><strong class="calibre1">Hashicorp Vault</strong>: Secrets manager</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C9: Implement Security Logging and Monitoring</p>
<p class="calibre2"> </p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">OWASP Security Logging Project</li>
<li class="calibre11">Apache Logging Services</li>
</ul>
</td>
</tr>
<tr class="calibre20">
<td class="calibre79">
<p class="calibre2">C10: Handle All Errors and Exceptions</p>
</td>
<td class="calibre80">
<ul class="calibre10">
<li class="calibre11">Error Prone</li>
<li class="calibre11">Chaos Monkey</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="calibre2"> </p>
<p class="calibre2">When it comes to the root/cause analysis of a security issue, sometimes it's very difficult to identify if the issue was caused by insecure design or insecure coding. Whenever it's possible, it's suggested to document the secure design as a detailed specific implementation. For example, the security design document may define the uses of a secure random number to do encryption. However, without the specific definition of a secure random number, the development team is still unable to achieve a secure implementation. Please also refer to the OWASP Cryptographic Storage Cheat Sheet for advice on strong random numbers.</p>
<p class="calibre2">An organization may consider building an internal secure design knowledge portal, which includes the following resources:</p>
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">Secure design case studies</strong>: Every case study includes the scenario, the security issue, and the design to mitigate risks.</li>
<li class="calibre11"><strong class="calibre1">Suggested implementation framework</strong>: Adoption of a mature security framework to solve common security issues.</li>
<li class="calibre11"><strong class="calibre1">Security Assistant as part of the IDE plugin</strong>: All secure coding rules can still be an overhead for developers. It's suggested to provide developers with an IDE plugin to do a secure coding check and to complement other secure coding scanning tools.</li>
</ul>
<p class="calibre40">Implementation review toolkit such as code review and dependency review tools. We will discuss this in the next chapter. </p>
<p class="calibre2">If you still find difficulties in building a secure design knowledge portal, the following are good reference sources. The objective of the knowledge portal is to provide a developer with all the knowledge, tools, tutorials, and best practices to achieve a secure design:</p>
<ul class="calibre10">
<li class="calibre11">OWASP Security Knowledge Framework: <a href="https://www.securityknowledgeframework.org/demo.php" class="calibre9">https://www.securityknowledgeframework.org/demo.php</a></li>
<li class="calibre11">Open Reference Architecture for Security and Privacy:  <a href="http://security-and-privacy-reference-architecture.readthedocs.io/en/latest/index.html" class="calibre9">http://security-and-privacy-reference-architecture.readthedocs.io/en/latest/index.html</a></li>
<li class="calibre11">Mobile Threat Catalogue: <a href="https://pages.nist.gov/mobile-threat-catalogue/" class="calibre9">https://pages.nist.gov/mobile-threat-catalogue/</a></li>
<li class="calibre11">OWASP Cheat Sheet Series: <a href="https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series" class="calibre9">https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series</a></li>
</ul>
<p class="calibre2">In practice, the adoption of a secure framework can help you to achieve secure architecture, design, and implementation since those security frameworks are built with security by default. In addition, the adoption of a secure framework still requires the secure coding and implementation. In the next chapter, we will explore more secure coding and <span class="calibre6">implementation in more detail.</span> </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">We discussed the importance of the whole team's involvement with threat modeling practices and the STRIDE examples (spoofing, tampering, repudiation, information disclosure, denial of service, and elevation of privilege).</p>
<p class="calibre2">There are several tools and methodologies to do threat modeling. If you would like to have a DFD/threat diagram designer, you can use the Microsoft threat modeling tool, OWASP Threat Dragon, or Mozilla SeaSponge. If you have a small team and would like to do threat modeling via a card game team activity, the Microsoft EOP card game and OWASP Cornucopia are recommended.</p>
<p class="calibre2">We also introduced some threat libraries such as CAPEC, ATT&amp;CK, and CWE, which can also support threat identification during threat modeling. We also discussed a threat modeling case study, and we understood the pros and cons of using threat modeling designers and card games.</p>
<p class="calibre2">On the topic of secure design, we discussed the major key security controls, authentication, authorization, session management, data validation, error handling, logging, and encryption. We suggested some references on CWE and open source security frameworks in each security control category. Furthermore, building a secure design knowledge portal is recommended. OWASP SKF and Open Reference Architecture for security and privacy are good reference sources.</p>
<p class="calibre2">In the coming chapters, we will discuss secure implementation and coding in detail. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Questions</h1>
                
            
            <article>
                
<ol class="calibre13">
<li value="1" class="calibre11">Threat modeling is only related to developers. QAs, architects, or operation teams don't need to get involved. True or false?</li>
<li class="calibre11" value="2">Which of the following modules should apply threat modeling?
<ol class="calibre14">
<li class="calibre11" value="1">Legacy modules</li>
<li class="calibre11" value="2">Modules with external interaction with third-party vendors</li>
<li class="calibre11" value="3">Modules that handle personal information</li>
<li class="calibre11" value="4">All of the above</li>
</ol>
</li>
</ol>
<ol start="3" class="calibre13">
<li class="calibre11" value="3">Which of the following is a security mitigation for Repudiation?
<ol class="calibre14">
<li class="calibre11" value="1">Hash</li>
<li class="calibre11" value="2">Authentication logging</li>
<li class="calibre11" value="3">Load balance</li>
<li class="calibre11" value="4">Encryption</li>
</ol>
</li>
<li class="calibre11" value="4">Which one of the following is not mainly used for threat library references?
<ol class="calibre14">
<li class="calibre11" value="1">CAPE</li>
<li class="calibre11" value="2">ATTCK</li>
<li class="calibre11" value="3">SeaSponge</li>
<li class="calibre11" value="4">CWE</li>
</ol>
</li>
<li class="calibre11" value="5">Which one of the following is not related to the authentication security framework?
<ol class="calibre14">
<li class="calibre11" value="1">Shiro</li>
<li class="calibre11" value="2">Spring Security</li>
<li class="calibre11" value="3">VisualCaptcha</li>
<li class="calibre11" value="4">Java Commons Validator</li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Further reading</h1>
                
            
            <article>
                
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">ETSI TS 102 165-1 V4.2.1 (2006-12): Method and proforma for Threat, Risk, Vulnerability Analysis</strong>: <a href="http://www.etsi.org/deliver/etsi_ts/102100_102199/10216501/04.02.03_60/ts_10216501v040203p.pdf" class="calibre9">http://www.etsi.org/deliver/etsi_ts/102100_102199/10216501/04.02.03_60/ts_10216501v040203p.pdf</a></li>
<li class="calibre11"><strong class="calibre1">NIST 800-18 Guide for Developing Security Plans for Federal Information Systems: </strong><a href="https://csrc.nist.gov/publications/detail/sp/800-18/rev-1/final" class="calibre9">https://csrc.nist.gov/publications/detail/sp/800-18/rev-1/final</a></li>
<li class="calibre11"><strong class="calibre1">ITU-T X.805 (10/2003) Security architecture for systems providing end-to-end communications:</strong> <a href="https://www.itu.int/rec/T-REC-X.805-200310-I/en" class="calibre9">https://www.itu.int/rec/T-REC-X.805-200310-I/en</a></li>
<li class="calibre11"><strong class="calibre1">Oauth2.0 Threat Model and Security Considerations:</strong> <a href="https://tools.ietf.org/html/rfc6819" class="calibre9">https://tools.ietf.org/html/rfc6819</a></li>
<li class="calibre11"><strong class="calibre1">SafeCode Tactical Threat Modeling:</strong> <a href="https://safecode.org/safecodepublications/tactical-threat-modeling/" class="calibre9">https://safecode.org/safecodepublications/tactical-threat-modeling/</a></li>
<li class="calibre11"><strong class="calibre1">OWASP Threat Risk Modeling:</strong> <a href="https://www.owasp.org/index.php/Threat_Risk_Modeling" class="calibre9">https://www.owasp.org/index.php/Threat_Risk_Modeling</a> </li>
<li class="calibre11"><strong class="calibre1">OCTAVE Allegro: Improving the Information Security Risk Assessment Process:</strong> <a href="https://resources.sei.cmu.edu/library/asset-view.cfm?assetid=8419" class="calibre9">https://resources.sei.cmu.edu/library/asset-view.cfm?assetid=8419</a></li>
<li class="calibre11"><strong class="calibre1">NIST 800-30 Guide for Conducting Risk Assessments:</strong> <a href="https://csrc.nist.gov/publications/detail/sp/800-30/rev-1/final" class="calibre9">https://csrc.nist.gov/publications/detail/sp/800-30/rev-1/final</a></li>
<li class="calibre11"><strong class="calibre1">SAFECode Fundamental Practices for Secure Software Development:</strong> <a href="https://www.safecode.org/publication/SAFECode_Dev_Practices0211.pdf" class="calibre9">https://www.safecode.org/publication/SAFECode_Dev_Practices0211.pdf</a></li>
<li class="calibre11"><strong class="calibre1">MSDN Threat Modeling</strong>: <a href="https://msdn.microsoft.com/en-us/library/ff648644.aspx" class="calibre9">Https://msdn.microsoft.com/en-us/library/ff648644.aspx</a></li>
<li class="calibre11"><strong class="calibre1">Threat Assessment &amp; Remediation Analysis (TARA):</strong> <a href="https://www.mitre.org/sites/default/files/pdf/11_4982.pdf" class="calibre9">https://www.mitre.org/sites/default/files/pdf/11_4982.pdf</a></li>
<li class="calibre11"><strong class="calibre1">SAFECode Practical Security Stories and Security Tasks for Agile Development Environments:</strong> <a href="http://safecode.org/publication/SAFECode_Agile_Dev_Security0712.pdf" class="calibre9">http://safecode.org/publication/SAFECode_Agile_Dev_Security0712.pdf</a></li>
<li class="calibre11"><strong class="calibre1">SAFECode Fundamental Practices for Secure Software Development:</strong> <a href="https://safecode.org/wp-content/uploads/2018/03/SAFECode_Fundamental_Practices_for_Secure_Software_Development_March_2018.pdf" class="calibre9">https://safecode.org/wp-content/uploads/2018/03/SAFECode_Fundamental_Practices_for_Secure_Software_Development_March_2018.pdf</a></li>
<li class="calibre11"><strong class="calibre1">SAFECode Managing Security Risks Inherent in the Use of Third-party</strong>: <a href="https://www.safecode.org/wp-content/uploads/2017/05/SAFECode_TPC_Whitepaper.pdf" class="calibre9">https://www.safecode.org/wp-content/uploads/2017/05/SAFECode_TPC_Whitepaper.pdf</a></li>
<li class="calibre11"><strong class="calibre1">SEI Secure Design Patterns:</strong> <a href="https://resources.sei.cmu.edu/asset_files/TechnicalReport/2009_005_001_15110.pdf" class="calibre9">https://resources.sei.cmu.edu/asset_files/TechnicalReport/2009_005_001_15110.pdf</a></li>
<li class="calibre11"><strong class="calibre1">Secure Design Patterns, Carnegie Mellon University:</strong> <a href="https://resources.sei.cmu.edu/library/asset-view.cfm?assetid=9115" class="calibre9">https://resources.sei.cmu.edu/library/asset-view.cfm?assetid=9115</a></li>
<li class="calibre11"><strong class="calibre1">MITRE Attack Matrix</strong>: <a href="https://attack.mitre.org/wiki/ATT%26CK_Matrix" class="calibre9">https://attack.mitre.org/wiki/ATT%26CK_Matrix</a></li>
<li class="calibre11"><strong class="calibre1">SAFECode practical security stories and tasks in Agile</strong><span>: </span><a href="http://safecode.org/publication/SAFECode_Agile_Dev_Security0712.pdf" class="calibre9">http://safecode.org/publication/SAFECode_Agile_Dev_Security0712.pdf</a></li>
<li class="calibre11"><strong class="calibre1">NIST 800-63 Digital Identity Guidelines</strong><span>: </span><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf" class="calibre9">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf</a></li>
<li class="calibre11"><strong class="calibre1">The Java Exception Handling Tutorials:</strong> <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/index.html" class="calibre9">https://docs.oracle.com/javase/tutorial/essential/exceptions/index.html</a>
<p class="calibre2"/>
<p class="calibre2"/>
</li>
</ul>


            </article>

            
        </section>
    </body></html>