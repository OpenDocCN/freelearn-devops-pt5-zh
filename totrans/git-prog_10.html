<html><head></head><body>
  <div><h1 class="chapterNumber">10</h1>
    <h1 id="_idParaDest-166" class="chapterTitle">Important Git Commands and Metadata</h1>
    <p class="normal">There are hundreds of Git commands and flags. In this chapter, we'll endeavor to review a few of the most important that we have not looked at so far. These include:</p>
    <ul>
      <li class="bullet">Creating the stash</li>
      <li class="bullet">Listing what's in the stash</li>
      <li class="bullet">Retrieving from the stash</li>
      <li class="bullet">The clean command for getting rid of unwanted untracked files</li>
      <li class="bullet">How to see metadata and choose which data you want to see</li>
    </ul>
    <p class="normal">Let's start by digging into the stash.</p>
    <div><p class="Information-Box--PACKT-">You can find the complete list at <a href="http://git-scm.com/docs">http://git-scm.com/docs</a>.</p>
    </div>
    <h1 id="_idParaDest-167" class="title">Stash</h1>
    <p class="normal">When we reviewed the five areas of Git, we included an area called the stash, but we did not delve into what the stash<a id="_idIndexMarker256"/> is. In short, the stash is a place where you can hold (stash) files you've modified but not yet committed:</p>
    <figure class="mediaobject"><img src="img/B17741_10_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.1: The five areas of Git</p>
    <p class="normal">The stash <a id="_idIndexMarker257"/>can be pretty important. Let's say you <a id="_idIndexMarker258"/>are working on a feature and suddenly you are asked to work on a very important bug. You are not ready to commit the code you have, but you can't switch branches with uncommitted files in the work area. </p>
    <p class="normal">To solve this, you <em class="italic">could</em> just make a backup of your directory, and then delete the uncommitted files, but that is very slow and error-prone. Instead, you want to stash them away somewhere that you can get them back when you are ready, which of course is the purpose of the stash.</p>
    <p class="normal">To see this at work, we need a repository with some commits. Let's quickly make a mirror of the <code class="Code-In-Text--PACKT-">RockyHorror2</code> repo. To do so, we'll start by making sure we have the <code class="Code-In-Text--PACKT-">RockyHorror2</code> repository on disk, or else we'll pull it from the server.</p>
    <p class="normal">Let's go to GitHub and create a repo called <code class="Code-In-Text--PACKT-">RockyHorrorStash</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_10_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.2: Creating the repository</p>
    <p class="normal">Notice <a id="_idIndexMarker259"/>that I did not bother creating a readme, .gitignore, nor a license since these will all be overwritten when I do the mirror.</p>
    <p class="normal">Click <strong class="screenText">Create Repository</strong> and once created, grab its address.</p>
    <p class="normal">We are now ready to mirror <code class="Code-In-Text--PACKT-">RockyHorror2</code> over <code class="Code-In-Text--PACKT-">RockyHorrorStash</code>. Be sure to change directory to <code class="Code-In-Text--PACKT-">RockyHorror2</code> and enter this command:</p>
    <figure class="mediaobject"><img src="img/B17741_10_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.3: Push the mirrored repo to the remote</p>
    <p class="normal">We now have the <a id="_idIndexMarker260"/>mirrored repo on the server but not locally, so let's clone it:</p>
    <figure class="mediaobject"><img src="img/B17741_10_04.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.4: Pull the mirrored repo back to the local repo</p>
    <p class="normal">Great, we have a repo <a id="_idIndexMarker261"/>we can work with. Let's see what's in it with a quick call to log:</p>
    <figure class="mediaobject"><img src="img/B17741_10_05.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.5: Examining the local repo with log</p>
    <p class="normal">Suppose we<a id="_idIndexMarker262"/> are working on this project and we modify two files. First, we modify the <code class="Code-In-Text--PACKT-">Showing</code> class to keep count of how many boxes of popcorn are sold:</p>
    <figure class="mediaobject"><img src="img/B17741_10_06.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.6: Adding the Showing class</p>
    <p class="normal">Next, we modify <code class="Code-In-Text--PACKT-">Program.cs</code> to say that the Brattle theater has 500 seats. If we take a status, we see the two modified files in the work area:</p>
    <figure class="mediaobject"><img src="img/B17741_10_07.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.7: git status shows two modified files</p>
    <p class="normal">We have two uncommitted modified files. We have more work to do but our boss calls and she tells us that there is an urgent bug in another project. This is where stash comes in. We <em class="italic">could</em> commit what we have, but we're not ready to, so let's put it in the stash:</p>
    <figure class="mediaobject"><img src="img/B17741_10_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.8: Adding to the stash</p>
    <p class="normal">You tell it <code class="Code-In-Text--PACKT-">git stash</code>, and it takes everything in the work area and in the index and puts it in the stash without committing it. At that point, the work area is reset to the state it was in before you started modifying files—that is the previous position of <code class="Code-In-Text--PACKT-">HEAD</code>.</p>
    <p class="normal">You can see what is in your<a id="_idIndexMarker263"/> stash with the <code class="Code-In-Text--PACKT-">stash list</code> command:</p>
    <figure class="mediaobject"><img src="img/B17741_10_09.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.9: Listing what is in the stash</p>
    <p class="normal">The stash has added the designation <code class="Code-In-Text--PACKT-">WIP on main</code>. WIP means Work In Progress.</p>
    <p class="normal">At the moment, you only have one thing in the stash. You might find, however, that while fixing that "very important bug," your boss calls back and says to stop work on that and fix a fatal bug. Once again, you may need to stash your work. Rather than setting all that up, we'll make a small change in the main program and then stash it. Let's change the name of the theater:</p>
    <figure class="mediaobject"><img src="img/B17741_10_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.10: Stashing more work</p>
    <p class="normal">Hey! What happened to the number of seats being increased to 500? Remember, we never committed that, we stashed it away and the working area was reset. Let's take a look at the status:</p>
    <figure class="mediaobject"><img src="img/B17741_10_11.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.11: Examining the status</p>
    <p class="normal">As we expect, we see the one modification we've made. Let's stash that away using <code class="Code-In-Text--PACKT-">git stash</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_10_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.12: Stashing the modification</p>
    <p class="normal">We now have two<a id="_idIndexMarker264"/> items in the stash. If we ask for a list, we should see both:</p>
    <figure class="mediaobject"><img src="img/B17741_10_13.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.13: Listing the items in the stash</p>
    <p class="normal">Sure enough, both stashed items are there. Normally they would have different ID and messages, but since we stashed from the same place, we ended up with this anomalous situation. You can see what is in the stash by using <code class="Code-In-Text--PACKT-">stash show</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_10_14.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.14: Showing the contents of the stash</p>
    <p class="normal">You can drop items from the stash and you can clear the entire stash with <code class="Code-In-Text--PACKT-">stash clear</code>.</p>
    <h1 id="_idParaDest-168" class="title">Clean</h1>
    <p class="normal">From time to time, you'll<a id="_idIndexMarker265"/> find that there are untracked files listed in your status. 99% of the time these will be files you created and you'll want them to be tracked, which you do by adding them to the index (as shown previously). There are times, however, when you may find untracked files that you don't want:</p>
    <figure class="mediaobject"><img src="img/B17741_10_15.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.15: Untracked files</p>
    <p class="normal">In this case, we have a couple choices. We can add <code class="Code-In-Text--PACKT-">Untracked.cs</code> to the index or we can get rid of it. To do so, we try <code class="Code-In-Text--PACKT-">git clean</code>:</p>
    <figure class="mediaobject"><img src="img/B17741_10_16.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.16: Using clean to remove untracked files (fails)</p>
    <p class="normal">Because <code class="Code-In-Text--PACKT-">git clean</code> is one of the few truly destructive commands—once called, the untracked files are gone, never to be seen again—Git comes back with the snarky reply that it is "refusing to clean." To actually clean, Git requires that you tell it you really mean it by using the <code class="Code-In-Text--PACKT-">-f</code> (force) flag:</p>
    <figure class="mediaobject"><img src="img/B17741_10_17.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.17: Using clean as above, but with the force flag (succeeds)</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">-f</code> flag essentially says "I know what I'm doing"—so make sure you do.</p>
    <h1 id="_idParaDest-169" class="title">Metadata</h1>
    <p class="normal">Every commit, merge, and <a id="_idIndexMarker266"/>so on, is accompanied by metadata. You<a id="_idIndexMarker267"/> can get at a lot of the metadata by using the log, but sometimes you just want to extract a few pieces of important metadata. For that you can use the <code class="Code-In-Text--PACKT-">show</code> command:</p>
    <figure class="mediaobject"><img src="img/B17741_10_18.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.18: Using show to see metadata</p>
    <p class="normal">In this example, we use <code class="Code-In-Text--PACKT-">show</code> to find the name and email of the author, along with the ID and the metadata telling us where the tip of main is. Let's break it down:</p>
    <ul>
      <li class="bullet"><code class="Code-In-Text--PACKT-">git</code> <code class="Code-In-Text--PACKT-">show</code>—the <code class="Code-In-Text--PACKT-">show</code> command.</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">-s</code>—silent (or quiet), which suppresses the difference output (try the command without it to see).</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">HEAD </code>tells show which commit you are interested in.</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">%an</code> is the author's name.</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">%ae</code> is the author's email address.</li>
    </ul>
    <p class="normal">We put this code into a string and assign it to the format flag.</p>
    <p class="normal">Let's look at the log and see what else we can do with showing metadata:</p>
    <figure class="mediaobject"><img src="img/B17741_10_19.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.19: Looking at the log</p>
    <p class="normal">Let's zero in on the metadata associated with one of these entries. To do so, we use the ID:</p>
    <figure class="mediaobject"><img src="img/B17741_10_20.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.20: Using show -s to see metadata</p>
    <p class="normal">You can also specify a range of entries: </p>
    <figure class="mediaobject"><img src="img/B17741_10_21.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.21: Specifying a range of entries</p>
    <p class="normal">We are able to zero in on what <a id="_idIndexMarker268"/>we want in the stash. To retrieve the stashed files, use <code class="Code-In-Text--PACKT-">git stash apply</code>. This will apply everything in the stash to the current working directory. Once you are sure you have what you need, you can then call <code class="Code-In-Text--PACKT-">git stash pop</code>, which will apply the changes again and remove them from the stash.</p>
    <h1 id="_idParaDest-170" class="title">Summary</h1>
    <p class="normal">In this chapter, we reviewed some of the most important commands that we had not yet looked at. These include:</p>
    <ul>
      <li class="bullet">Creating the stash</li>
      <li class="bullet">Listing what's in the stash</li>
      <li class="bullet">Retrieving from the stash</li>
      <li class="bullet">The <code class="Code-In-Text--PACKT-">clean</code> command for getting rid of unwanted untracked files</li>
      <li class="bullet">How to see metadata and choose which data you want to see</li>
    </ul>
    <h1 id="_idParaDest-171" class="title">Challenge</h1>
    <p class="normal">Mirror a repo, or use one you already have if you don't mind changing it. Examine the list of commits. Start work on some changes but don't commit your changes. Switch to working on a different repo. Create or modify some files in the second repo but don't commit them. Start work on a third repo. Abandon that work and go back to the first repository. Examine the stash and retrieve the stash you need to keep working.</p>
    <h1 id="_idParaDest-172" class="title">Answer</h1>
    <p class="normal">Once again, there are many ways to answer this. I'll start by mirroring the <code class="Code-In-Text--PACKT-">RockyHorrorStash</code> repo to <code class="Code-In-Text--PACKT-">RockyHorrorStash2</code>, and then I will immediately clone it to my local repo.</p>
    <p class="normal">I'll do the same thing with <code class="Code-In-Text--PACKT-">Panofy</code> (to <code class="Code-In-Text--PACKT-">PanofyStash</code>) and <code class="Code-In-Text--PACKT-">musicHandler2</code> (creating <code class="Code-In-Text--PACKT-">musicHandler2Stash</code>). Now we have three repos we can work on:</p>
    <ul>
      <li class="bullet"><code class="Code-In-Text--PACKT-">musicHandler2Stash</code></li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">PanofyStash</code></li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">RockyHorrorStash</code></li>
    </ul>
    <p class="normal">Let's begin with <code class="Code-In-Text--PACKT-">musicHandler2Stash</code> by changing directory and getting a log of what is already there. Then let's open it in Visual Studio and do some work:</p>
    <figure class="mediaobject"><img src="img/B17741_10_22.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.22: Log of MusicHandler2Stash</p>
    <p class="normal">Let's make two changes by opening Visual Studio in that directory. We need changes in a couple of files, so let's just add comments. When we take a status, we see that there are two modified files:</p>
    <figure class="mediaobject"><img src="img/B17741_10_23.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.23: Status of MusicHandler files after changes and before commit</p>
    <p class="normal">Right in the middle of our work, we're asked to work on a bug. We're not ready to check in these files so we add them to the stash:</p>
    <figure class="mediaobject"><img src="img/B17741_10_24.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.24: Call stash, which puts the modified files into the stash, then call status to see the working directory is empty</p>
    <p class="normal">We are now free to change to the <code class="Code-In-Text--PACKT-">RockyHorrorStash</code> directory. Here we will start fixing the bug (which we will do by adding comments to represent the real work). Uh oh, we have to work on a bigger bug. Let's stash the work we did in <code class="Code-In-Text--PACKT-">RockyHorrorStash</code>.</p>
    <p class="normal">We'll switch to <code class="Code-In-Text--PACKT-">PanofyStash</code> and make some changes and commit them. We are now ready to return to the bug we were working on in <code class="Code-In-Text--PACKT-">musicHandler2stash</code> as that has now become the priority. The first thing to do is to list what we have in the stash for this repository (remember, stashes are per repository):</p>
    <figure class="mediaobject"><img src="img/B17741_10_25.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.25: stash list in musicHandler2stash</p>
    <p class="normal">Let's restore that. There are two ways to do so:</p>
    <ul>
      <li class="bullet"><code class="Code-In-Text--PACKT-">apply</code> applies the stashed files but leaves them in the stash.</li>
      <li class="bullet"><code class="Code-In-Text--PACKT-">pop</code> applies the stashed files but removes them from the stash.</li>
    </ul>
    <p class="normal">I recommend using <code class="Code-In-Text--PACKT-">apply</code> because it leaves a copy of the stashed items in the:</p>
    <figure class="mediaobject"><img src="img/B17741_10_26.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.26: stash apply</p>
    <p class="normal">In <em class="italic">Figure 10.26</em> we first call <code class="Code-In-Text--PACKT-">git stash apply</code>. Be very careful with this—there is a different command, <code class="Code-In-Text--PACKT-">git apply</code>, which is not what you want here.</p>
    <p class="normal">Once applied you can see that the two files that were modified are back. We take a status to make sure everything is as we expect. Now that we know it is safe, we can clean out the stash:</p>
    <figure class="mediaobject"><img src="img/B17741_10_27.png" alt=""/></figure>
    <p class="packt_figref">Figure 10.27: Dropping the cache</p>
    <p class="normal">In <em class="italic">Figure 10.27</em> we list what's in the stash, then we drop the stash, and then list again to make sure it is gone.</p>
    <p class="normal">In this challenge, we mirrored three repos so that we could work on them without changing their original state. We then looked at what commits were there and added new files without committing them. In order to be able to switch repositories, we stashed the uncommitted files. When we returned to the original project, we were able to retrieve the stashed items.</p>
  </div>
</body></html>