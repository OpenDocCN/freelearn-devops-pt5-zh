<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing Web Applications</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we covered the c<span>ompute-intensive application</span> objectives. We covered <span>how to design h</span>igh-performance computing<span> and other compute-intensive applications.</span> </p>
<p class="mce-root">This chapter introduces the web application's objectives. It will cover information about Azure Web Apps, the different App Service plans that are available, and what the characteristics are for the different App Service plans. You will learn more about designing Web Apps for Containers using Azure Container Services and Docker, how to design Web Apps for <span>high availability, scalability, and performance using Redis Cache, auto-scaling, App Service environments, and more. You will also learn how to design a custom Web API and what Azure offers in terms of securing custom APIs.</span></p>
<p>The following topics will be covered:</p>
<ul>
<li><span>Azure Web Apps</span></li>
<li>App Service plans</li>
<li><span>Designing Web Apps for Containers</span></li>
<li>Designing Web App<span>s for high availability, scalability, and performance</span></li>
<li><span>Designing and securing custom Web APIs</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>This chapter uses the following tools for the examples:</p>
<ul>
<li>Visual Studio 2017: <a href="https://www.visualstudio.com/downloads/">https://www.visualstudio.com/downloads/</a></li>
</ul>
<p>The source code for this chapter can be downloaded here:</p>
<ul>
<li class="mce-root"><a href="https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%203">https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%203/</a></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Web Apps</h1>
                </header>
            
            <article>
                
<p>Azure Web Apps is a part of Azure App Services and it is where you can host your websites and applications in Azure. Using Web Apps, you only pay for the compute resources you use, not for the actual hosting of your site or application. Besides websites and applications, you can also host your Web APIs and your mobile backends inside Azure Web Apps.</p>
<p>You can use a programming language of your choice for developing applications. At the time of writing, Azure Web Apps supports <span>.NET, .NET Core, Java, Ruby, Node.js, PHP, and Python. Those applications are hosted on Windows or Linux virtual machines that are fully managed by Microsoft and can easily be scaled using out-of-the-box features. Besides scaling, you can leverage other Azure features, such as security, load balancing, and insights and analytics. You can also use the DevOps capabilities, such as Continuous Integration and deployment from VSTS, GitHub, Docker Hub, and other resources, SSL certificates, package management, staging environments, and custom domains.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">App Service plans</h1>
                </header>
            
            <article>
                
<p>Azure Web Apps are hosted inside App Service plans. Inside the App Service plan, you can configure all the required settings, such as the costs, the compute resources, and in which region you want to deploy your apps. There are different types of App Service plans available in Azure, from free plans where you share all the resources with other customers and that are most suitable for development applications, to paid plans, where you can choose to host your apps on Windows VMs or Linux VMs and can set the available CPU, and more.</p>
<p>Azure offers the following service plan SKUs:<strong><br/></strong></p>
<ul>
<li><strong>Free<span> and </span>Shared</strong>: Your app runs on the same VM as other apps in a shared environment. This environment can also include apps from other customers. Each app has a CPU quota and there is no ability to scale up or out. These App Service plans are most suited for development and test apps or apps with less traffic. There is no SLA support for those two plans. The Shared service plan offers the ability to add custom domains.</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/1cde9366-7505-4c0a-957f-1d888e183733.jpg" style="width:26.92em;height:20.92em;" width="711" height="553"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Free and Shared App Service plan in the Azure Portal</div>
<ul>
<li><strong>Basic</strong>: The Basic tier is the first tier, where you can choose between different pricing ranges. It offers three tiers and the available cores and RAM will double for every tier. Apps run on dedicated Linux or Windows VMs and the compute resources are only shared between apps that are deployed inside the same App Service plan. All apps inside the same App Service plan reside in an isolated environment, which supports SSL and custom domains. The Basic tier offers scaling to three instances, but you need to do this manually. This tier is most suitable for development and test environments and applications with less traffic.</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/4aefd80f-faac-4c0c-89d5-126282710250.jpg" style="width:41.75em;height:21.33em;" width="1071" height="547"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span><span>Basic App Service plan in the Azure Portal</span></span></div>
<ul>
<li><strong>Standard: </strong><span>The Standard tier also has three tiers to choose from. It offers custom domains and SSL support, offers autoscale up to ten instances, and offers five deployment slots, which can be used for testing, staging, and production apps. It also provides daily backups and Azure Traffic Manager.</span></li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/b4a6d0a6-48c7-464f-8956-7957f6c4387a.jpg" style="width:41.75em;height:21.67em;" width="1066" height="553"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><span>Standard App Service plan in the Azure Portal</span></span></div>
<ul>
<li><strong>Premium: </strong>Premium offers two types of tiers, Premium and PremiumV2. They both offer all the features of the Standard tier, but the Premium tier offers extra scale instances and deployment slots. The Premium V2 runs on Dv2-series virtual machines, which offer faster processors and SSD drives and <span>drastically </span>increase the performance of your application.</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/11b47420-ec8c-4e6a-870d-beede9f9db57.jpg" style="width:41.67em;height:42.83em;" width="1072" height="1102"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span><span>Premium App Service plan in the Azure Portal</span></span></div>
<ul>
<li><strong>Isolated</strong>: The Isolated tier offers full isolation for your applications by providing a private environment with dedicated virtual machines and virtual networks. You can also scale up to 100 instances. To create a private environment, App Services uses an <strong>App Service Environment</strong> (<strong>ASE</strong>), which will be covered in the next section. All apps run on Dv2-series virtual machines, so it offers high-performance capabilities. The Isolated App Service plan is most suitable for apps that need complete isolation, because of high security demands for instance, but that want to leverage all the capabilities that Azure Web Apps offer, such as auto-scale and deployment slots.</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/d2a7074e-9704-45d5-be06-bd02fb055efc.jpg" style="width:40.83em;height:21.17em;" width="1069" height="554"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Isolated App Service plan in the Azure Portal</span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">The App Service Environment (ASE)</h1>
                </header>
            
            <article>
                
<p><span>The ASE is a feature of Azure App Service that provides a fully isolated environment for your Web Apps, mobile apps, API apps, and Azure Functions. An ASE is deployed inside a subnet of the VNet, so this provides full isolation and secure network access. ASEs are most suitable for apps that require high-scale workloads because they can be spread across a single or multiple Azure regions. Because of the network isolation, ASEs are also very suitable for apps with high security requirements.</span></p>
<p>There can only be one ASE created per Azure subscription and it can host up to 100 instances; from 100 app instances in a single App Service plan to 100 App Service plans with one app instance.</p>
<p>ASEs use frontends and workers where the former are suitable for automatic load balancing of the requests inside the ASE and the latter host the actual Web Apps inside the ASE. They are added automatically by Azure.</p>
<div class="packt_infobox">At the time of writing, there are two different versions of ASE, v1 and v2. The difference between the two versions is that v2 automatically adds frontends and workers to the ASE depending on the scale of the App Service plans. In v1, you had to add those roles manually before you could scale out your App Service plan.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an ASE</h1>
                </header>
            
            <article>
                
<p>You can create an Azure ASE from the Azure Portal by taking the following steps:</p>
<ol>
<li>Navigate to the Azure Portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.</li>
<li>Click on <span class="packt_screen">New</span><span> </span>and  type <kbd>App Service Environment</kbd> in the search bar. Click the <span class="packt_screen">Create</span> button.</li>
<li><span>A new blade opens up, where you can fill in the basic settings of the VM. Add the following:</span>
<ul>
<li><span class="packt_screen">Name</span>: <kbd>PacktASE</kbd></li>
<li><span class="packt_screen">Subscription</span>: Select a subscription here</li>
<li><span class="packt_screen">Resource Group</span>: <kbd><kbd>PacktPubASE</kbd></kbd></li>
<li class="mce-root"><span><span class="packt_screen">Virtual Network/Location</span>: Azure will automatically create a new virtual network for you. If you want to pick an existing one, you can change the settings by clicking the link.</span></li>
</ul>
</li>
</ol>
<div style="color: black" class="CDPAlignCenter CDPAlign packt_figref"><img src="Images/f5ae86e8-2538-4e29-97f2-a4464ba06bb5.jpg" style="width:19.83em;height:45.42em;" width="628" height="1443"/><br/>
<br/>
Creating ASE in the Azure Portal</div>
<ol start="4">
<li><span>Click on </span><span class="packt_screen">Create</span>. Azure will create an ASE, a virtual network, a route table, and a NSG for you. </li>
<li>You can now choose this ASE when you create a new Azure App Service plan:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><span class="packt_screen"><img src="Images/f844a419-97b5-4089-805a-01ad97363076.jpg" style="width:20.50em;height:46.33em;" width="625" height="1414"/></span></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span><span>Creating an ASE in the Azure Portal</span></span></div>
<div class="packt_tip">Please note that the creation of an ASE can be quite expensive, so I strongly advise you to remove this when you are finished with your test.<br/>
<br/>
For more information about Azure ASE, you can refer to the following Microsoft documentation: <a href="https://docs.microsoft.com/en-us/azure/app-service/environment/intro">https://docs.microsoft.com/en-us/azure/app-service/environment/intro</a>.<a href="https://docs.microsoft.com/en-us/azure/app-service/environment/intro"><br/></a></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Web Apps for Containers</h1>
                </header>
            
            <article>
                
<p>Web Apps for Containers is part of the Azure App Service on Linux. It lets you easily deploy and scale your own Docker-formatted images on Azure. Docker is based on open standards, which means it can run on all major Linux distributions and Windows Server 2016. </p>
<p>Docker containers are lightweight sandboxes on top of your OS. When your application is deployed inside a Docker container, the app cannot see or access all other applications or processes that are running on the same OS. You can compare this to creating different VMs to host different types of workloads or applications, but without the overhead of the virtualization itself. Docker containers also share the same OS and infrastructure, whereas VMs need to have their own OS installed inside their own infrastructure.</p>
<p>With containers, you share the underlying resources of the Docker host <span>and you build a Docker image that includes everything you need to run the application. You can start with a basic image and then add everything you need. </span></p>
<p>Docker containers are also extremely portable. You can deploy a Docker container including all the settings, such as configuration settings, a specific runtime, framework, and tooling on a VM with Docker installed. You can then easily move that same container to the Azure App Service on Linux, and the application will still run as expected. <span>This solves the <em>it works on my machine</em> problem that (mostly) all developers face. This makes </span><span>Docker not a virtualization technology, but an application delivery technology. </span></p>
<p>Docker containers are very suitable for building applications that leverage the microservices architecture, where parts of an application are loosely coupled, and divided into separate services that all collaborate with each other. Each service can then be deployed into a separate container, written in their own programming language, using their own configuration settings. A service can consist of a database, or a Web API, or a mobile backend for instance. You can easily deploy multiple copies of a single application, or database. The only thing to be aware of is that they all share the same OS. If your application needs to run on a different OS, you still have to use a VM.</p>
<div class="packt_infobox"><span>For more information on Azure App Service on Linux, you can refer to the following website: </span><a href="https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro">https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro</a>.<a href="https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro"><br/></a>Microsoft released a sample project, called <strong>Developer Finder</strong>, which is available on GitHub. This will give you an great overview of the possibilities of Docker containers and is a good starting point for developing your own applications using Docker. You can refer to the following site: <a href="https://github.com/azure-app-service/demoapp">https://github.com/azure-app-service/demoapp</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting started with Web App for Containers</h1>
                </header>
            
            <article>
                
<p>Web App for Containers can be created <span>from</span> the Azure Portal. Follow <span>these</span> steps to create a project:</p>
<div class="packt_infobox">In this example, I'm using the Docker Hub as a repository for images. You can create an account using the following link: <a href="https://hub.docker.com/">https://hub.docker.com/</a>.</div>
<ol>
<li>Navigate to the Azure Portal by opening <a href="https://portal.azure.com/">https://portal.azure.com/</a>.</li>
<li class="mce-root"><span>Click on </span><span class="packt_screen">New</span><strong> </strong><span>and in the search bar type</span> <kbd>Web App for Containers</kbd><span>. Click on the </span><span class="packt_screen">Create</span><span><span> button, as shown in the following screenshot:</span></span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/0f0c5594-1d5a-49b2-ad70-24c813617e4f.jpg" style="width:37.92em;height:46.17em;" width="857" height="1046"/></div>
<div style="color: black" class="CDPAlignCenter CDPAlign packt_figref">Creating a Web App for Containers project in the Azure Portal</div>
<ol start="3">
<li>A new blade opens up. Add the following values:
<ul>
<li><span class="packt_screen">App name</span>: <kbd>PacktContainers</kbd>.</li>
<li><span class="packt_screen">Subscription</span>: Select a subscription here.</li>
<li><span class="packt_screen">Resource Group</span>: This one is automatically filled in when you enter the app name. Leave it as default.</li>
<li class="mce-root"><span><span class="packt_screen">App Service plan/Location</span>: A new App Service plan will automatically be created. If you want to pick an existing one, or change the default settings, you can click on it.</span></li>
</ul>
</li>
</ol>
<div style="color: black" class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/1b52c7bc-fd3e-4237-8c5c-14d7cdac7b3c.jpg" style="width:47.75em;height:38.17em;" width="1788" height="1427"/></div>
<div style="color: black" class="packt_figref CDPAlignCenter CDPAlign">Web App for Containers settings in the Azure Portal</div>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Configure container</span>: This will take you to the actual Docker settings. Here, pick <span class="packt_screen">Docker Hub</span> as an image source.</li>
<li><span class="packt_screen">Image and optional tag</span>: <kbd>mysql</kbd>.</li>
</ul>
</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="Images/f1f872a3-2b75-48a1-9483-18f394dc3abe.jpg" style="width:55.83em;height:44.50em;" width="1794" height="1430"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span><span>Configuring a container in the Azure Portal</span></span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing Web Apps for high availability, scalability, and performance</h1>
                </header>
            
            <article>
                
<p>Performance is an important issue to keep in mind when designing Web Apps. Web Apps that are <span>unresponsive or that </span>perform badly will <span>eventually </span>lose all their visitors. They will simply hop on to another site. Azure provides multiple options to make your Web App highly available and scalable, which will result in a better performance to keep your visitors on board. </p>
<div class="packt_tip">Beside the features that Azure offers to design for high availability, scaling, and performance, you can keep certain architecture patterns in mind when architecting your Web App. You can refer to the following article from the Azure Architecture Center for these patterns: <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">High availability and performance</h1>
                </header>
            
            <article>
                
<div>
<p>Azure provides several ways to make your Web App perform better and to become highly available. You can use a <strong>Content Delivery Network</strong> (<strong>CDN</strong>), a cache, or you can copy your Web App over to multiple regions.</p>
<span><br/></span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using a CDN</h1>
                </header>
            
            <article>
                
<p>You can use a CDN to scale your websites globally. By using a CDN, your static content, such as HTML pages, style sheets, client-side scripts, images, documents, and files, are cached in different regions. This way, it takes less time to download the content, because the static content is physically closer to the user, which increases the performance of your Web App.</p>
<p>Azure CDN allows you to use custom domain names to access your content. This can be configured inside the Azure Portal. You can refer to the following article to add a custom domain: <a href="https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain">https://docs.microsoft.com/en-us/azure/cdn/cdn-map-content-to-custom-domain</a>. You can also enable HTTPS for your CDN: <a href="https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl">https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl</a>. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using Redis Cache</h1>
                </header>
            
            <article>
                
<p><span>Redis Cache in Azure is based on the</span><span> </span><span>popular open-source implementation, Redis Cache. It provides a secure cache from where you can access your data and that runs in an Azure data center. It can be used by different types of applications, including Web Apps, applications inside a virtual machine, or other cloud services. Caches can be shared by all applications that have the appropriate access key.</span></p>
<p>Azure Redis Cache comes in the following tiers:</p>
<ul>
<li><strong>Basic</strong>: This is a single node cache, ideal for development, test environments, and non-critical workloads. This tier has no SLA.</li>
<li><strong>Standard</strong>: Provides a replicated cache. The data is automatically replicated between the two nodes. This tier offers an SLA.</li>
<li><strong>Premium: </strong>The Premium tier has all the standard features and, in addition, it provides bigger workloads, better performance, disaster recovery, and enhanced security. It also offers Redis Persistence, which persists data that is stored inside the cache. Snapshots and backups can be created and restored in case of failures. It also offers Redis Cluster, which automatically shares data across multiple Redis nodes, so you can create workloads of bigger memory sizes (greater than 53 GB) and get better performance. It also offers support for Azure Virtual Networks, which gives the ability to isolate your cache by using subnets, access control policies, and more. <span><span>You can provision an Azure Redis Cache from the Azure Portal using an ARM template.</span></span></li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/707b9395-a817-47b7-9408-2e3327762bea.jpg" style="width:31.58em;height:45.17em;" width="687" height="981"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><span>Provisioning Redis Cache from the Azure Portal</span></span></div>
<div class="packt_tip">You can refer to the following article to download some sample ARM templates for deploying Azure Redis Cache with different types of configuration settings: <a href="https://docs.microsoft.com/en-us/azure/redis-cache/cache-redis-cache-arm-provision">https://docs.microsoft.com/en-us/azure/redis-cache/cache-redis-cache-arm-provision</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using Azure Traffic Manager</h1>
                </header>
            
            <article>
                
<p>Another way of designing for availability and scalability is copying your Web App over to multiple regions or data centers. Azure uses Azure Traffic Manager to spread the workload. Your Web App can be reached by using a single URL, where Azure Traffic Manager will handle the load and locate the closest geographical region or most suitable region for you at the DNS level.</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/eb2a0eb3-f484-4052-a3a7-d8a6a7ec7062.jpg" style="width:34.08em;height:40.92em;" width="1163" height="1395"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Azure Trafic Manager</span></div>
<p>When creating an Azure Traffic Manager profile from the Azure Portal, you can choose between four different routing methods:</p>
<ul>
<li><strong>Performance</strong>: Select this method when you have endpoints in different geographical <span>locations and you want end users to use the closest<em> </em>endpoint in terms of the lowest network latency.</span></li>
<li><strong>Weighted</strong>:<strong> </strong>This method is best suitable for when you want your application to be distributed <span>evenly or according to certain weights, which you define.</span></li>
<li><strong>Priority</strong>: Use this method when you want one endpoint to be the primary endpoint for all traffic, <span>and provide backups in case the primary or the backup endpoints are unavailable.</span></li>
<li><strong>Geographic</strong>: This method is best suitable for scenarios where <span>knowing a user’s geographical region and routing them based on that is important. Localization of content can be a reason for choosing this method, for instance. Users are then directed to specific endpoints based on the geographical location where their DNS query comes from.</span></li>
</ul>
<div class="packt_infobox"><span>Azure Traffic Manager is also discussed in <a href="1d5ef29a-96fb-452c-a0d6-718d6d2d1c84.xhtml" target="_blank">Chapter 5</a>, <em>Robust Networking Implementations</em>. </span><span>For more information, you can refer to that chapter.</span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Scalability</h1>
                </header>
            
            <article>
                
<p>Azure provides the ability to scale your Web Apps. One of the possibilities is to scale out, where you can scale your Web Apps globally. <span>Scaling out means adding nodes to, or removing nodes from, a Web App. </span>This way, the load time is decreased when the Web App is accessed from different locations. The other option is to scale up. <span>Scaling up means adding resources to, or removing resources from, a Web App, such as </span><span>CPUs or memory. </span>When scaling up, you switch to another pricing tier inside your App Service plan, or pick a different App Service plan. </p>
<div class="packt_infobox">For more information about Azure App Service plans, you can refer to the beginning of this chapter.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Scaling out</h1>
                </header>
            
            <article>
                
<p>There are multiple ways to scale out your Web App. You can scale out manually or automatically by using <strong>Azure Autoscale</strong>. To use Autoscale, take the following steps:</p>
<ol>
<li>Under <span class="packt_screen">Settings</span>, click on <span class="packt_screen">Scale Out (App Service plan)</span>.</li>
<li>In the right-hand side of the screen, you can increase or decrease the <span class="packt_screen">Instance count</span>. The maximum instance count depends on the App Service plan:</li>
</ol>
<div style="color: black" class="mce-root CDPAlignCenter CDPAlign packt_figref"><img src="Images/4374d757-d6fb-4832-af70-acf542307ee2.jpg" style="width:53.67em;height:44.75em;" width="1695" height="1410"/></div>
<div style="color: black" class="mce-root CDPAlignCenter CDPAlign packt_figref">Azure App Service plan scaling</div>
<ol start="3">
<li>Here, you can also turn on autoscale (<span>only for the Standard, Premium, and Isolated App Service plans). You have to name the autoscale set, and add at least one scaling condition. You can choose between scaling based on a metric or a specific instance count. When using scale based on a metric, you need to add a scale rule:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="Images/e58415d7-badc-4416-8a59-478cf12a2c62.jpg" style="width:38.08em;height:34.67em;" width="1447" height="1315"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><span>Azure App Service plan auto scaling</span></span></div>
<div class="packt_tip packt_infobox">Azure Autoscale lets you configure a lot of settings that are beyond the scope of this book. You can refer to the following URL for more information on Azure Autoscale and the available settings: <a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings">https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings.</a></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Scaling up</h1>
                </header>
            
            <article>
                
<p>You can choose a different pricing tier or App Service plan to scale up your website. This can be done from the App Service plan settings inside the Azure Portal as well, such as when scaling out your Web App.</p>
<p>Navigate to the Azure App Service settings in the Azure Portal and, under <span class="packt_screen">Settings</span>, click on <span class="packt_screen">Scale Up (App Service plan)</span>. You can then select a different App Service plan, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign packt_figref"><img src="Images/bd303684-05c8-42c4-8b39-20ffcba6477b.jpg" style="width:13.42em;height:40.17em;" width="482" height="1438"/><strong><br/>
<br/></strong> Azure App Service plan scaling up</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing and securing custom Web APIs</h1>
                </header>
            
            <article>
                
<p>Custom Web APIs can be created using Visual Studio code or Visual Studio 2017. For creating Web APIs, the following programming languages are available:</p>
<ul>
<li>ASP.NET</li>
<li>ASP.NET Core</li>
<li>Angular</li>
<li>React.js</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Designing your Web API</h1>
                </header>
            
            <article>
                
<p>This demo will be created using .NET Core Framework 2.0 and <span>Visual Studio 2017. </span>Begin by opening up Visual Studio 2017:</p>
<ol>
<li>Click on <span class="packt_screen">File</span> | <span class="packt_screen">New</span> | <span class="packt_screen">Project</span> and, in the new <span class="packt_screen">Project</span> window, select <span class="packt_screen">ASP.NET Core Web Application</span>. Name the project and click on <span class="packt_screen">OK</span>:</li>
<li>A pop-up window opens up where you can select the <span class="packt_screen">Web API</span> <span>template, select</span> <span class="packt_screen">ASP.NET Core 2.0</span>, <span>and click on </span><span class="packt_screen">OK</span><span>:</span></li>
</ol>
<div style="color: black" class="CDPAlignCenter CDPAlign packt_figref"><img src="Images/29eb1675-e2c1-4f3a-8c99-7834b30b2d53.jpg" style="width:36.92em;height:24.17em;" width="1578" height="1029"/><br/>
<br/>
Creating a custom Web API from Visual Studio 2017</div>
<ol start="3">
<li>Add a <kbd>Models</kbd> folder in the <span class="packt_screen">Solution Explorer</span>. Right-click your project name and select <span class="packt_screen">Add</span> | <span class="packt_screen">New Folder</span>.<strong> </strong>Add a <span><kbd>TodoItem</kbd> class by right-clicking the <kbd>Models</kbd> folder and click <span class="packt_screen">Add</span> | <span class="packt_screen">Class</span>.</span></li>
<li>Update the <kbd>TodoItem</kbd> class with the following code:</li>
</ol>
<pre style="padding-left: 60px">namespace PacktPubToDoAPI.Models<br/>{<br/>    public class TodoItem<br/>    {<br/>        public long Id { get; set; }<br/>        public string Name { get; set; }<br/>        public bool IsComplete { get; set; }<br/>    }<br/>}</pre>
<ol start="5">
<li>The next step is to add the database context class that coordinates entity framework functionality. Add a <kbd>TodoContext</kbd> <span>class inside the </span><kbd>Models</kbd> <span>folder and replace it with the following code:</span></li>
</ol>
<pre style="padding-left: 60px">using Microsoft.EntityFrameworkCore;<br/>using PacktPubToDoAPI.Models;<br/><br/>namespace PacktPubToDoAPI.Models<br/>{<br/>    public class TodoContext : DbContext<br/>    {<br/>        public TodoContext(DbContextOptions&lt;TodoContext&gt; options)<br/>            : base(options)<br/>        {<br/>        }<br/><br/>        public DbSet&lt;TodoItem&gt; TodoItems { get; set; }<br/><br/>    }<br/>}</pre>
<ol start="6">
<li>The next step is to register the database context with the dependency injection container. You can do this by replacing the code in the <kbd>StartUp.cs</kbd> with the following:</li>
</ol>
<pre style="padding-left: 60px">using Microsoft.AspNetCore.Builder;<br/>using Microsoft.EntityFrameworkCore;<br/>using Microsoft.Extensions.DependencyInjection;<br/>using PacktPubToDoAPI.Models;<br/><br/>namespace PacktPubToDoAPI<br/>{<br/>    public class Startup<br/>    {<br/>        public void ConfigureServices(IServiceCollection services)<br/>        {<br/>            services.AddDbContext&lt;TodoContext&gt;(opt =&gt; opt.UseInMemoryDatabase("TodoList"));<br/>            services.AddMvc();<br/>        }<br/><br/>        public void Configure(IApplicationBuilder app)<br/>        {<br/>            app.UseMvc();<br/>        }<br/>    }<br/>}</pre>
<ol start="7">
<li>In the <span class="packt_screen">Solution Explorer</span>, right-click the <kbd>Controllers</kbd> folder and add a controller named <kbd>TodoController</kbd>. Replace the controller with the following code:</li>
</ol>
<pre style="padding-left: 60px">using System.Collections.Generic;<br/>using Microsoft.AspNetCore.Mvc;<br/>using PacktPubToDoAPI.Models;<br/>using System.Linq;<br/><br/>namespace PacktPubToDoAPI.Controllers<br/>{<br/>    [Route("api/[controller]")]<br/>    public class TodoController : Controller<br/>    {<br/>        private readonly TodoContext _context;<br/><br/>        public TodoController(TodoContext context)<br/>        {<br/>            _context = context;<br/><br/>            if (_context.TodoItems.Count() == 0)<br/>            {<br/>                _context.TodoItems.Add(new TodoItem { Name = "Item1" });<br/>                _context.SaveChanges();<br/>            }<br/>        }<br/>    }<br/>}</pre>
<ol start="8">
<li>This code uses dependency injection in the constructor to inject the <kbd>TodoContext</kbd> inside the controller. This context is used for the <strong>create</strong>, <strong>read</strong>, <strong>update</strong>, <strong>delete</strong> (<strong>CRUD</strong>) methods on the data. The constructor adds an item to the in-memory database if it is empty.</li>
<li>The next step is to implement the CRUD methods. Add the following code to the constructor for the <kbd>Get</kbd> requests:</li>
</ol>
<pre style="padding-left: 60px">[HttpGet]<br/>public IEnumerable&lt;TodoItem&gt; GetAll()<br/>{<br/>    return _context.TodoItems.ToList();<br/>}<br/><br/>[HttpGet("{id}", Name = "GetTodo")]<br/>public IActionResult GetById(long id)<br/>{<br/>    var item = _context.TodoItems.FirstOrDefault(t =&gt; t.Id == id);<br/>    if (item == null)<br/>    {<br/>       return NotFound();<br/>     }<br/>       return new ObjectResult(item);<br/> }</pre>
<ol start="10">
<li>Add the following underneath for <kbd>Post</kbd> requests:</li>
</ol>
<pre style="padding-left: 60px">[HttpPost]<br/>public IActionResult Create([FromBody] TodoItem item)<br/>{<br/>   if (item == null)<br/>   {<br/>        return BadRequest();<br/>   }<br/><br/>    _context.TodoItems.Add(item);<br/>    _context.SaveChanges();<br/><br/>    return CreatedAtRoute("GetTodo", new { id = item.Id }, item);<br/>   }<br/>  [HttpPut("{id}")]<br/>  public IActionResult Update(long id, [FromBody] TodoItem item)<br/>  {<br/>      if (item == null || item.Id != id)<br/>      {<br/>          return BadRequest();<br/>      }<br/><br/>      var todo = _context.TodoItems.FirstOrDefault(t =&gt; t.Id == id);<br/>      if (todo == null)<br/>      {<br/>          return NotFound();<br/>      }<br/>      <br/>      todo.IsComplete = item.IsComplete;<br/>      todo.Name = item.Name;<br/><br/>       _context.TodoItems.Update(todo);<br/>       _context.SaveChanges();<br/>       return new NoContentResult();<br/>  }       </pre>
<ol start="11">
<li>Finally, add the <kbd>Delete</kbd> request underneath the <kbd>Post</kbd> requests:</li>
</ol>
<pre style="color: black;padding-left: 60px">[HttpDelete("{id}")]<br/>     public IActionResult Delete(long id)<br/>     {<br/>        var todo = _context.TodoItems.FirstOrDefault(t =&gt; t.Id == id);<br/>         if (todo == null)<br/>         {<br/>              return NotFound();<br/>          }<br/><br/>          _context.TodoItems.Remove(todo);<br/>          _context.SaveChanges();<br/>          return new NoContentResult();<br/>      }</pre>
<ol start="12">
<li>You can now deploy this Web API to Azure using the <span class="packt_screen">Publish</span> function in Visual Studio 2017. Right-click the <span class="packt_screen">Solution Explorer</span> and click on <span class="packt_screen">Publish</span>.<strong> </strong>The publishing wizard now opens. In there, select <span class="packt_screen">Microsoft Azure App Service</span>, choose <span class="packt_screen">Select Existing</span>, and click on <span class="packt_screen">Publish</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><img src="Images/8661a48c-d38b-4893-a81d-ce20bf5fa336.jpg" style="width:38.83em;height:20.08em;" width="1645" height="852"/><br/></span></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span>Publishing the Web API to Azure from Visual Studio 2017</span></div>
<ol start="13">
<li>In the next screen, select the Azure Web App that is already there from the previous sections in this chapter and click on the <span class="packt_screen">OK</span> button:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><img src="Images/9064bcd9-3126-4041-b490-8fd5a63c849e.jpg" style="width:35.67em;height:26.83em;" width="1600" height="1200"/><br/></span></div>
<div class="CDPAlignCenter CDPAlign packt_figref"><span><span>Selecting the Azure Subscription from Visual Studio 2017</span></span></div>
<ol start="14">
<li>The Web API is now published to Azure.</li>
</ol>
<div class="packt_infobox">This sample application is based on a sample from the Microsoft site. When you need any further instructions or information about the sample app, please refer to the following Microsoft site: <a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api">https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api</a>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Securing your Web API</h1>
                </header>
            
            <article>
                
<p>To secure your Web API, you can use several options. You can use options provided by Azure or you can use your own authentication providers. A best practice is, however, to use the standard authentication options that are available for Azure App Services.</p>
<p>You can use the following services in Azure to secure your Web API:</p>
<ul>
<li><strong>Azure Active Directory (Azure AD)</strong>: Azure AD offers traditional username and password identity management, roles, and permissions management from the cloud. <span>In addition, it offers more enterprise solutions, such as multi-factor authentication, applications monitoring, solution monitoring, and alerting. </span></li>
<li><strong>Azure Active Directory Business to Consumer</strong>: <span>Azure Active Directory Business to Consumer (B2C) is a cloud identity-management solution for mobile and web applications. It offers out-of-the-box authentication providers that can be leveraged from your apps and custom APIs. Examples of out-of-the-box authentication providers are Facebook, and Google.</span></li>
<li><strong>Active Directory Federation Services</strong>: <span>You can use Active Directory Federation Services (ADFS) to secure your web API using the on-premises identities that are present in your organization. ADFS can be configured in conjunction with Azure AD in a hybrid mode. You can then use the same APIs, such as the Microsoft Graph, to connect to your on-premises identities when you are using only Azure AD.</span></li>
<li><strong>API Management</strong>: You can use API Management to secure your Web API as well. You can use advanced security policies, API keys, throttling for preventing DDOS attacks, and more, to add an additional layer of security on top of your Web API.</li>
</ul>
<div class="packt_infobox">In the <em>Design, security, and identity</em> section of <a href="f44f0ed4-c642-44ef-b574-b475bdd616da.xhtml" target="_blank">Chapter 9</a>, <em>Securing Your Resources</em>, we will cover the available authentication providers in more detail. This section gives a quick overview of the providers that are leveraged inside your Web APIs.<br/>
API Management is covered in more detail in <a href="8975f78d-84e0-4378-8318-75bc7cf35db3.xhtml" target="_blank">Chapter 4</a>, <em>Implementing Serverless and Microservices</em>.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we have covered the design web applications objectives. We've covered Azure Web Apps, App Service plans, how to design Web Apps for Containers, how to design Web App<span>s for high availability, scalability, and performance, and how you can design and secure custom Web APIs.</span></p>
<p>In the next chapter, we will proceed with the s<span>erverless and microservice objectives.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p><span>Answer the following questions to test your knowledge of the information in this chapter. You can find the answers in the <em>Assess</em></span><span><em>ments</em> section at the end of this book:</span></p>
<ol>
<li><span>Is Redis Cache a memory key value datastore?</span>
<ol>
<li>Yes</li>
<li>No</li>
</ol>
</li>
<li>Is the Basic tier of Redis Cache well suited for production environments?
<ol>
<li>Yes</li>
<li>No</li>
</ol>
</li>
<li>Can you use Azure B2B as an authentication provider for your applications?
<ol>
<li>Yes</li>
<li>No</li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>You can check out the following links for more information on the topics that are covered in this chapter:</span></p>
<ul>
<li><strong>Web Apps Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/app-service/">https://docs.microsoft.com/en-us/azure/app-service/</a></li>
<li><strong>Azure App Service plan overview</strong>: <a href="https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview">https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview</a></li>
<li><strong>Announcing App Service Isolated, more power, scale and ease of use</strong>: <a href="https://azure.microsoft.com/nl-nl/blog/announcing-app-service-isolated-more-power-scale-and-ease-of-use/">https://azure.microsoft.com/nl-nl/blog/announcing-app-service-isolated-more-power-scale-and-ease-of-use/</a></li>
<li><strong>App Service on Linux Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/app-service/containers/">https://docs.microsoft.com/en-us/azure/app-service/containers/</a></li>
<li><strong>CDN Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/cdn/">https://docs.microsoft.com/en-us/azure/cdn/</a></li>
<li><strong>Redis Cache Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/redis-cache/">https://docs.microsoft.com/en-us/azure/redis-cache/</a></li>
<li><strong>Integrating applications with Azure Active Directory</strong>: <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-integrating-applications">https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-integrating-applications</a></li>
<li><strong>Active Directory B2C Documentation</strong>: <a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/">https://docs.microsoft.com/en-us/azure/active-directory-b2c/</a></li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>