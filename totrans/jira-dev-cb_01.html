<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Plugin Development Process</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Setting up the development environment</li><li class="listitem" style="list-style-type: disc">Creating a Skeleton plugin</li><li class="listitem" style="list-style-type: disc">Deploying a JIRA plugin</li><li class="listitem" style="list-style-type: disc">Testing and debugging</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Introduction</h1></div></div></div><p>Atlassian JIRA<a id="id0" class="indexterm"/>, as we all know, is primarily an <strong>Issue Tracking</strong><a id="id1" class="indexterm"/> and <strong>Project Tracking System</strong><a id="id2" class="indexterm"/>. What many people do not know, though, is the power of its numerous customization capabilities, using which we can turn it into a different system altogether! Maybe a helpdesk system, a user story management system, an online approval process, and a lot more. This is in addition to the issue tracking and project tracking capabilities for which JIRA, arguably, is the best player in the market.</p><p>So what are these customizations? How can we convert the JIRA we know into a product we want? Or maybe just add extra functionalities that are specific to our organization?</p><p>The answer to these questions probably can be summarized in a single word—<strong>plugins</strong><a id="id3" class="indexterm"/>. JIRA has given the power to its users to write plugins and customize the functionality in a way they find suitable.</p><p>But is that the only way? Definitely not! JIRA<a id="id4" class="indexterm"/> itself provides a lot of customization options through its user interface, and in more demanding cases, using property files like <strong>jira-application.properties</strong><a id="id5" class="indexterm"/>. In some cases, you will also find yourself modifying some of the JIRA core files to tweak functionality or to work around a problem. We will see more of that in the chapters to come but the best entry point to JIRA customizations are plugins. And that is where we start our cookbook, before we move on to the in-depth details.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>What is a JIRA plugin?</h2></div></div></div><p>So, what is a JIRA plugin? JIRA<a id="id6" class="indexterm"/> itself is a web application written in Java<a id="id7" class="indexterm"/>. But that doesn't mean you need to know JAVA to write a plugin, though in most cases you will need to. You might end up writing a simple descriptor file to add few links here and there. If that makes the non-Java developer in you happy, watch out for the different plugin modules JIRA supports.</p><p>A <a id="id8" class="indexterm"/>JIRA plugin is a JAR file that has a mandatory plugin <strong>descriptor</strong><a id="id9" class="indexterm"/> and some optional Java classes and velocity templates. The velocity templates<a id="id10" class="indexterm"/> are used to render the HTML pages associated with your plugin, but in some cases, you might also want to introduce JSPs to make use of some pre-existing templates in JIRA. JSPs<a id="id11" class="indexterm"/>, as opposed to velocity templates, cannot be embedded in the plugin, but instead they should be dropped into the appropriate folders in the JIRA web application.</p><p>The plugin descriptor, the only mandatory part of a plugin, is an XML file which must be named <code class="literal">atlassian-plugin.xml</code>. This file is located at the root of the plugin. The <code class="literal">atlassian-plugin.xml</code> file<a id="id12" class="indexterm"/> defines the various modules in a plugin. The different types of available plugin modules include reports, custom field types, and so on, and these are discussed in detail in the next chapter.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>The plugin development process</h3></div></div></div><a id="id13" class="indexterm"/><a id="id14" class="indexterm"/><p>The process of developing a JIRA plugin can be of varying complexity depending on the functionality we are trying to achieve. The plugin development process essentially is a four step process:</p><div><ol class="orderedlist arabic"><li class="listitem">Develop the plugin.</li><li class="listitem">Deploy it into our local JIRA.</li><li class="listitem">Test the plugin functionality.</li><li class="listitem">Make changes and re-deploy the plugin, if required.</li></ol></div><p>Each of these is explained in detail through the various recipes in this book!</p><p>JIRA, on start-up, identifies all the plugins that are deployed in the current installation. You can deploy multiple plugins, but there are some things you need to keep an eye on!</p><p>The <code class="literal">atlassian-plugin.xml</code> file has a plugin <strong>key</strong><a id="id15" class="indexterm"/> which should be unique across all the plugins. It is much similar to a Java package. Each module in the plugin also has a key that is unique within the plugin. The plugin key combined with the module key, separated by a colon, forms the complete key of a plugin module.</p><p>Following is a sample <code class="literal">atlassian-plugin.xml</code> file without any plugin modules in it:</p><div><pre class="programlisting">&lt;!-- the unique plugin key --&gt;
&lt;atlassian-plugin key="com.jtricks.demo" name="Demo Plugin" plugins-version="2"&gt;
    &lt;!-- Plugin Info --&gt;
    &lt;plugin-info&gt;
        &lt;description&gt;This is a Demo Description&lt;/description&gt;
        &lt;version&gt;1.0&lt;/version&gt;
        &lt;!-- optional  vendor details --&gt;
        &lt;vendor name="J-Tricks" url="http://www.j-tricks.com"/&gt;
    &lt;/plugin-info&gt; 
    . . . 1 or more plugin modules . . .
&lt;/atlassian-plugin&gt;</pre></div><a id="id16" class="indexterm"/><p>The plugin, as you can see, has details such as description, version, vendor-details, and so on.</p><p>When a plugin is loaded, all the unique modules in it are also loaded. The plugin classes override the system classes and so if there is an action that has the same <strong>alias</strong> name as that of a JIRA action, it is the plugin action class that will be loaded. We will see more about extending actions in the coming chapters.</p><a id="id17" class="indexterm"/><a id="id18" class="indexterm"/><p>Suppose you have a report module in your plugin, it will look as follows:</p><div><pre class="programlisting">&lt;report key="demo-report" name="My Demo Report" ....&gt;
...
&lt;/report&gt;</pre></div><p>The plugin key<a id="id19" class="indexterm"/>, in this case, will be <code class="literal">com.jtricks.demo</code> and the module key will be <code class="literal">com.jtricks.demo:demo-report</code>.</p><p>Hang on, before you start writing your little plugin for a much wanted feature, have a look at the Atlassian plugin exchange to see if someone else has already done the dirty work for you!</p><div><div><div><div><h4 class="title"><a id="ch01lvl4sec01"/>Atlassian plugin exchange</h4></div></div></div><a id="id20" class="indexterm"/><p>Atlassian plugin exchange is a one stop shop where you can find the entire list of commercial and open source plugins people around the world have written. See <a class="ulink" href="https://plugins.atlassian.com/search/by/jira">https://plugins.atlassian.com/search/by/jira</a> for more details.</p></div><div><div><div><div><h4 class="title"><a id="ch01lvl4sec02"/>Troubleshooting</h4></div></div></div><p>A common scenario that people encounter while deploying their plugin is when the plugin fails to load even though everything looks fine. Make sure your plugin's key is unique and is not duplicated in one of yours or another third-party's plugin!</p><p>The same applies to individual plugin modules.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Setting up the development environment</h1></div></div></div><p>Now that we know what a plugin is, let 's aim at writing one! The first step in writing a JIRA plugin is to set up your environment, if you haven't done that already. In this recipe, we will see how to set up a local environment.</p><p>To make plugin development easier, Atlassian provides the <strong>Atlassian Plugin Software Development Kit</strong> (<strong>SDK</strong>). It comes along with Maven and a pre-configured <code class="literal">settings.xml</code> to make things easier.</p><p>Atlassian Plugin SDK<a id="id21" class="indexterm"/> can be used to develop plugins for other Atlassian products, including  Confluence<a id="id22" class="indexterm"/>, Crowd<a id="id23" class="indexterm"/>, and so on, but we are concentrating only on JIRA.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Getting ready</h2></div></div></div><a id="id24" class="indexterm"/><a id="id25" class="indexterm"/><p>The following are the pre-requisites for running the Atlassian plugin SDK:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The default port for the SDK: 2990 should be available. This is important because different ports are reserved for different Atlassian products.</li><li class="listitem" style="list-style-type: disc">JDK Java version 1.5 - 6 must be installed.</li><li class="listitem" style="list-style-type: disc">Make sure <code class="literal">JAVA_HOME</code> is set properly and the command <code class="literal">java –version</code> outputs the correct Java version details.</li><li class="listitem" style="list-style-type: disc">And of course, JIRA 4.x+ should be installed in your development environment.<div><div><h3 class="title"><a id="note03"/>Note</h3><p>Make sure you use a context path for your JIRA because there are known issues with the SDK not working when the context path is empty. See <a class="ulink" href="https://studio.atlassian.com/browse/AMPS-122">https://studio.atlassian.com/browse/AMPS-122</a> for more details.</p></div></div></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem"><a id="id26" class="indexterm"/><a id="id27" class="indexterm"/>Once we have Java installed and the port ready, we can download the latest version of Atlassian Plugin SDK from <a class="ulink" href="https://maven.atlassian.com/content/repositories/atlassian-public/com/atlassian/amps/atlassian-plugin-sdk/">https://maven.atlassian.com/content/repositories/atlassian-public/com/atlassian/amps/atlassian-plugin-sdk/</a>.</li><li class="listitem">Unzip the version into a directory of your choice. Let's call this directory <code class="literal">SDK_HOME</code> going forward.</li><li class="listitem">Add the SDK's bin directory into the environment <code class="literal">PATH</code> variable.</li><li class="listitem">Create a new environment variable <code class="literal">M2_HOME</code> pointing to the Apache-Maven directory in your SDK Home.</li><li class="listitem">A lot of commonly used dependencies are already available in the repository folder embedded in the SDK. To use this, edit the <code class="literal">settings.xml</code> under <code class="literal">M2_HOME/conf/</code> and modify the <code class="literal">localRepository</code> attribute to point to the embedded repository folder. By default, it will use the <code class="literal">USER_HOME/.m2/repository</code>.</li><li class="listitem"><a id="id28" class="indexterm"/><a id="id29" class="indexterm"/>Install the IDE of your choice. Atlassian recommends Eclipse<a id="id30" class="indexterm"/>, IntelliJ IDEA<a id="id31" class="indexterm"/>, or NetBeans<a id="id32" class="indexterm"/>, as they all support Maven.</li><li class="listitem">Ready, Set, Go…</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>How it works...</h2></div></div></div><p>With these steps executed properly, we have a development environment for JIRA plugins.</p><p>The next step is to create a <a id="id33" class="indexterm"/>Skeleton plugin, import it into your IDE, and start writing some code! Creating the Skeleton plugin, deploying it, and so on, is explained in detail in the following recipes.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>There's more...</h2></div></div></div><p>Even though the aforementioned steps will work in most cases, we will come across scenarios where the setting up of the development environment is not that straightforward. For example, there are extra settings needed for Maven if the machine is behind a firewall. You might even have a local Maven version already installed. In this section, we will see some useful tips on similar cases.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Proxy settings for Maven</h3></div></div></div><a id="id34" class="indexterm"/><a id="id35" class="indexterm"/><p>If you are behind a firewall, make sure you configure the proxy in the Maven <code class="literal">settings.xml</code> file. The proxy can be configured as follows:</p><div><pre class="programlisting">&lt;settings&gt;
  .
  &lt;proxies&gt;
   &lt;proxy&gt;
      &lt;active&gt;true&lt;/active&gt;
      &lt;protocol&gt;http&lt;/protocol&gt;
      &lt;host&gt;proxy.demo.com&lt;/host&gt;
      &lt;port&gt;8080&lt;/port&gt;
      &lt;username&gt;demouser&lt;/username&gt;
      &lt;password&gt;demopassword&lt;/password&gt;
      &lt;nonProxyHosts&gt;localhost|*.demosite.com&lt;/nonProxyHosts&gt;
    &lt;/proxy&gt;
  &lt;/proxies&gt;
  .
&lt;/settings&gt;</pre></div><a id="id36" class="indexterm"/><a id="id37" class="indexterm"/><a id="id38" class="indexterm"/><p>Find out more about that and other aspects of Maven at <a class="ulink" href="http://maven.apache.org/index.html">http://maven.apache.org/index.html</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Using local Maven</h3></div></div></div><a id="id39" class="indexterm"/><a id="id40" class="indexterm"/><p>If you are a developer, in many cases you will have Maven already installed in your local machine. In that case, point <code class="literal">M2_HOME</code> to your local Maven and update the respective <code class="literal">settings.xml</code> with the repository details in the default <code class="literal">settings.xml</code> that ships with Atlassian plugin SDK.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Configuring IDEs to use SDK</h3></div></div></div><a id="id41" class="indexterm"/><a id="id42" class="indexterm"/><p>If you are using IntelliJ IDEA<a id="id43" class="indexterm"/>, it is an easy job because IDEA integrated Maven out-of-the-box. Just load the project by selecting the <code class="literal">pom.xml</code>!</p><p>If you are using Eclipse, make sure you have M2Eclipse installed. This is because Eclipse integrates Maven through the Sonatype M2Eclipse plugin<a id="id44" class="indexterm"/>. You can find more details on configuring this at <a class="ulink" href="http://confluence.atlassian.com/display/DEVNET/Configuring+Eclipse+to+use+the+SDK">http://confluence.atlassian.com/display/DEVNET/Configuring+Eclipse+to+use+the+SDK</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Troubleshooting</h3></div></div></div><a id="id45" class="indexterm"/><p>If you see Maven download errors like <em>Could not resolve artifact</em>, make sure you verify the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Entry in Maven <code class="literal">settings.xml</code> is correct. That is, it points to the correct repositories</li><li class="listitem" style="list-style-type: disc">Proxy configuration is done if required</li><li class="listitem" style="list-style-type: disc">Antivirus in the local machine is disabled if none of the above works! Seriously, it makes a difference.</li></ul></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Creating a skeleton plugin </em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Creating a skeleton plugin</h1></div></div></div><p>In this recipe, we will look at creating a skeleton plugin. We will use the Atlassian Plugin SDK to create the skeleton!</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Getting ready</h2></div></div></div><p>Make sure you have the Atlassian Plugin SDK installed and a version of JIRA 4.x<a id="id46" class="indexterm"/> running on your local machine.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open a command window and go to the folder where you want to create the plugin.<div><div><h3 class="title"><a id="note04"/>Note</h3><p>Make sure you use a directory without any spaces because there are known issues with the SDK not working in directories with spaces in it. See <a class="ulink" href="https://studio.atlassian.com/browse/AMPS-126">https://studio.atlassian.com/browse/AMPS-126</a> for details.</p></div></div></li><li class="listitem"><a id="id47" class="indexterm"/><a id="id48" class="indexterm"/><a id="id49" class="indexterm"/><a id="id50" class="indexterm"/>Type <code class="literal">atlas-create-jira-plugin</code> and press <em>Enter</em>.</li><li class="listitem">Enter the <code class="literal">groupID</code> when prompted. GroupID would normally be coming from your organization name and mostly resembles the Java package. Of course, you can enter a different package name as we move forward if you want to keep it separate. GroupID will be used to identify your plugin along with <code class="literal">artifactId</code>.<p>For example: <code class="literal">com.jtricks.demo</code>.</p></li><li class="listitem">Enter the <code class="literal">artifactId</code>—the identifier for this artifact. Do not use spaces here.<p>For example: <code class="literal">demoplugin</code>.</p></li><li class="listitem"><code class="literal">Version</code>—the default version is <code class="literal">1.0-SNAPSHOT</code>. Enter a new version if you want to change it or press <em>Enter</em> to keep the default.<p>For example: <code class="literal">1.0</code></p></li><li class="listitem"><code class="literal">Package</code>—press <em>Enter</em> if the package value is same as the <code class="literal">groupID</code>. If not, enter the new value here and press <em>Enter</em>.<p>For example, <code class="literal">com.jtricks.mypackage</code></p></li><li class="listitem">Confirm the selection when prompted. If you want to change any of the entered values, type <code class="literal">N</code> and press <em>Enter</em>.</li><li class="listitem">Wait for the <code class="literal">BUILD SUCCESSFUL</code> message. You might see a few warnings which can be ignored.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>How it works...</h2></div></div></div><a id="id51" class="indexterm"/><a id="id52" class="indexterm"/><p>A skeleton plugin is nothing but a set of directories and sub directories along with a <code class="literal">pom.xml</code><a id="id53" class="indexterm"/> (Maven Project Object Model) file and some sample Java and XML files in the appropriate folders.</p><a id="id54" class="indexterm"/><a id="id55" class="indexterm"/><a id="id56" class="indexterm"/><p>Here is a snapshot of how the project will look like in Eclipse. It also shows the design view of the default <code class="literal">atlassian-plugin.xml</code> file:</p><div><img src="img/1803-01-01.jpg" alt="How it works..."/></div><p>As you can see, there is a <code class="literal">pom.xml</code> at the root level and a <code class="literal">src</code> folder. A sample <code class="literal">LICENSE</code> file and a <code class="literal">README</code> file are also created for you at the root level.</p><p>Under the <code class="literal">src</code> folder, you will find out two folders, <code class="literal">main</code> and <code class="literal">test</code>, with identical folder structure. All your main Java code goes under the <code class="literal">main</code> folder. Any JUnit tests you write will go into the same location under the <code class="literal">test</code> folder. There is an additional folder, <code class="literal">it</code>, under the test folder where all the integration tests will go!</p><p>You will find the plugin descriptor under <code class="literal">src/main/resources</code> with sample values already populated in it. The values in the preceding screenshot are populated from the <code class="literal">pom.xml</code>. In our case, the plugin key will be populated as <code class="literal">com.jtricks.demo:demoplugin</code> when the plugin is built.</p><a id="id57" class="indexterm"/><a id="id58" class="indexterm"/><a id="id59" class="indexterm"/><a id="id60" class="indexterm"/><p>There are two more folders under the <code class="literal">src/test. src/test/resources</code>, which will hold any resources required for unit tests or integration tests, and the <code class="literal">src/test/xml</code> folder can hold the XML data from any other JIRA instance. If the XML is supplied, the SDK will use it to configure the JIRA instance before running the integration tests.</p><p>So, that is our plugin Skeleton. All that is pending is some useful Java code and proper module types in the <code class="literal">atlassian-plugin.xml</code> file!</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>Remember, the first Maven run is going to take some time as it downloads all the dependencies into your local repository. A coffee break might not be enough!! If you have a choice, plan your meals. ;)</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>There's more...</h2></div></div></div><p>Sometimes, for the geeks, it is much easier to run a single command to create a project without bothering about the step-by-step creation. In this section, we will quickly see how to do it. We will also have a look at how to create an Eclipse project if you opt out of installing m2eclipse.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec06"/>One step to your skeleton plugin</h3></div></div></div><p>You can ignore the interactive mode by passing the parameters like <code class="literal">groupID</code>, <code class="literal">artifactId</code>, and so on, as arguments to the <code class="literal">atlas-create-jira-plugin</code> command<a id="id61" class="indexterm"/>.</p><div><pre class="programlisting">
<strong>atlas-create-jira-plugin -g my_groupID -a my_artefactId -v my_version -p my_package –non-interactive</strong>
</pre></div><p>In this example, for the values we saw previously, the single line command will be:</p><div><pre class="programlisting">
<strong>atlas-create-jira-plugin -g com.jtricks.demo -a demoplugin -v 1.0 -p com.jtricks.mypackage –non-interactive</strong>
</pre></div><p>You can pick and choose the parameters and provide the rest in an interactive mode as well!</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Creating an Eclipse project</h3></div></div></div><p>If you are not using m2eclipse, just run the following command from the folder where you have the <a id="id62" class="indexterm"/>
<code class="literal">pom.xml</code> file:</p><div><pre class="programlisting">
<strong>atlas-mvn eclipse:eclipse</strong>
</pre></div><a id="id63" class="indexterm"/><a id="id64" class="indexterm"/><p>This will generate the plugin project for Eclipse and you can then import this project into the IDE.</p><p>Type <code class="literal">atlas-mvn eclipse:clean eclipse:eclipse</code> if you want to clean the old project and create again!</p><p>With IDEA or m2eclipse, just opening a file will do. That is, you can just import the project using the option <strong>File</strong> | <strong>Import</strong> | <strong>Existing</strong> <strong>Maven</strong> <strong>Projects</strong>, and select the relevant project.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Deploying a plugin</em></li><li class="listitem" style="list-style-type: disc"><em>Making changes and re-deploying a plugin</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Deploying a plugin</h1></div></div></div><p>In this recipe, we will see how to deploy a plugin into JIRA. We will see both the automated deployment using Atlassian Plugin SDK and the manual deployment.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Getting ready</h2></div></div></div><p>Make sure you have the development environment set up, as we discussed earlier. Also the skeleton plugin should now have the plugin logic implemented in it.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec19"/>How to do it...</h2></div></div></div><a id="id65" class="indexterm"/><a id="id66" class="indexterm"/><p>Installing a JIRA plugin using Atlassian Plugin SDK is a cake walk. Here is how it is done:</p><div><ol class="orderedlist arabic"><li class="listitem">Open a command window and go to your plugin's root folder, that is, the folder where your <code class="literal">pom.xml</code> resides.</li><li class="listitem">Type <code class="literal">atlas-run</code> and press <em>Enter</em>. It is possible to pass more options as argument to this command for which the details can be found at: <a class="ulink" href="http://confluence.atlassian.com/display/DEVNET/atlas-run">http://confluence.atlassian.com/display/DEVNET/atlas-run</a>.</li><li class="listitem">You will see a lot of things happening as Maven downloads all the dependent libraries into your local repository. As usual, it is going to take lot of time when you run it for the first time.</li><li class="listitem">If you are on Windows, and if you see a security alert popping up, click on <strong>Unblock</strong> to allow incoming network connections.</li><li class="listitem">When the installation is completed, you will see the following message:<div><pre class="programlisting">[WARNING] [talledLocalContainer] INFO: Server startup in 123558 ms
[INFO] [talledLocalContainer] Tomcat 6.x started on port [2990]
[INFO] jira started successfully and available at http://localhost:2990/jira
[INFO] Type CTRL-C to exit</pre></div></li><li class="listitem">Open <code class="literal">http://localhost:2990/jira</code> in your browser.</li><li class="listitem">Login using the username as <strong>admin</strong> and password as <strong>admin</strong>.</li><li class="listitem">Test your plugin! You can always go to the <strong>Administration</strong> | <strong>Plugin</strong> menu to confirm that the plugin is deployed properly.</li></ol></div><p>If you already have a local JIRA installed or if you want to manually install your plugin for some reason, all you need to do is to package the plugin JAR and copy it across to the <code class="literal">JIRA_Home/plugins/installed-plugins</code> directory.</p><a id="id67" class="indexterm"/><a id="id68" class="indexterm"/><p>You can package the plugin using the following command:</p><div><pre class="programlisting">
<strong>atlas-mvn clean package</strong>
</pre></div><p>Use <code class="literal">atlas-mvn clean install</code> if you also want to install the package plugin into your local repository.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How it works...</h2></div></div></div><p>There is only one single command that does the whole thing: <code class="literal">atlas-run</code>. When you execute this command, it does the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Builds your plugin JAR file</li><li class="listitem">Downloads the latest/specified version of JIRA to your local machine if it is the first time you're running the command.</li><li class="listitem">Creates a virtual JIRA installation under your plugin/target folder.</li><li class="listitem">Copies the JAR file into the /<code class="literal">target/jira/home/plugins/installed-plugins</code> directory</li><li class="listitem">Starts JIRA in the Tomcat container.</li></ol></div><p>Now, if you look at your target folder, you will see a lot of new folders which were created for the virtual JIRA installation! The two main folders are the <code class="literal">container</code> folder, which has the Tomcat container setup, and the <code class="literal">jira</code> folder, which has the JIRA WAR along with the JIRA home setup!</p><p>You will find the database (<code class="literal">HSQLDB</code>), indexes, backups, and attachments under /<code class="literal">target/jira/home</code>. And you will see your <code class="literal">jira-webapp</code> at <code class="literal">/target/container/tomcat6x/cargo-jira-home/webapps/jira</code>.</p><a id="id69" class="indexterm"/><a id="id70" class="indexterm"/><p>If you have any JSPs that need to be put under the webapp, you will have to copy it to the appropriate folder under the aforementioned path!</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec21"/>There's more...</h2></div></div></div><p>There's more to this.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Using a specific version of JIRA</h3></div></div></div><a id="id71" class="indexterm"/><p>As mentioned earlier, <code class="literal">atlas-run</code> deploys the latest version of JIRA. But what if you want to deploy the plugin into an earlier version of JIRA and test it?</p><p>There are two ways to do it:</p><div><ol class="orderedlist arabic"><li class="listitem">Mention the JIRA version as an argument to <code class="literal">atlas-run</code>; make sure you run <code class="literal">atlas-clean</code>, if you already have the latest version deployed:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Run <code class="literal">atlas-clean</code> (if required).</li><li class="listitem" style="list-style-type: disc">Run <code class="literal">atlas-run –v 4.1.2</code> or <code class="literal">atlas-run –version 4.1.2</code> if you are developing for JIRA version 4.1.2. Replace the version number with a version of your choice.</li></ul></div></li><li class="listitem">Permanently change the JIRA version in your plugin <code class="literal">pom.xml</code>:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Go to your <code class="literal">pom.xml</code>.</li><li class="listitem" style="list-style-type: disc">Modify the <code class="literal">jira.version</code> property value to the desired version.</li><li class="listitem" style="list-style-type: disc">Modify the <code class="literal">jira.data.version</code> to a matching version.</li></ul></div></li></ol></div><p>This is how it will look for JIRA 4.1.2:</p><div><pre class="programlisting">&lt;properties&gt;
    &lt;jira.version&gt;4.1.2&lt;/jira.version&gt;
    &lt;jira.data.version&gt;4.1&lt;/jira.data.version&gt;
&lt;/properties&gt;</pre></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec09"/>Reusing the configurations in each run</h3></div></div></div><a id="id72" class="indexterm"/><p>Suppose you added some data on to virtual JIRA, how do you retain it when you clean start-up JIRA next time?</p><p>This is where a new SDK command comes to our rescue.</p><p>After the <code class="literal">atlas-run</code> is finished, that is, after you pressed <em>Ctrl </em>+ <em>C</em>, execute the following command:</p><div><pre class="programlisting">
<strong>atlas-create-home-zip</strong>
</pre></div><p>This will generate a file named <code class="literal">generated-test-resources.zip</code> under the target folder. Copy this file to the <code class="literal">/src/test/resources</code> folder or any other known locations. Now modify the <code class="literal">pom.xml</code> to add the following entry under configurations in the <code class="literal">maven-jira-plugin</code>:</p><div><pre class="programlisting">&lt;productDataPath&gt;${basedir}/src/test/resources/generated-test-resources.zip&lt;/productDataPath&gt;</pre></div><p>Modify the path accordingly. This will reuse the configurations the next time you run <code class="literal">atlas-run</code>.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Troubleshooting</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Missing JAR file exception? Make sure the local-repository attribute in the <code class="literal">settings.xml</code> file points to the embedded Maven repository that comes with the SDK. If the problem still persists, manually download the missing JAR files and <code class="literal">use atlas-mvn install</code> to install them in to the local repository.<p>Watch out for the proxy settings or antivirus settings that can potentially block the download in some cases!</p></li><li class="listitem" style="list-style-type: disc">BeanCreationException? Make sure your plugin is of version 2. Check your <code class="literal">atlassian-plugin.xml</code> to see if the following entry is there or not. If not, add the entry:<div><pre class="programlisting">&lt;atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.artifactId}" plugins-version="2"&gt;</pre></div></li></ul></div><p>Run <code class="literal">atlas-clean</code> followed by <code class="literal">atlas-run</code> after you do that.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Making changes and re-deploying a plugin</h1></div></div></div><p>Now that we have deployed the test plugin, it is time to add some proper logic, re-deploy the plugin, and test it. Making the changes and re-deploying a plugin is pretty easy. In this recipe, we will quickly look at how to do this.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How to do it...</h2></div></div></div><a id="id73" class="indexterm"/><a id="id74" class="indexterm"/><a id="id75" class="indexterm"/><a id="id76" class="indexterm"/><p>You can make changes to the plugin and re-deploy it while the JIRA application is still running. Here is how we do it:</p><div><ol class="orderedlist arabic"><li class="listitem">Keep the JIRA application running in the window where we ran <code class="literal">atlas-run</code>.</li><li class="listitem">Open a new command window and go to the root plugin folder where your <code class="literal">pom.xml</code> resides.</li><li class="listitem">Run <code class="literal">atlas-cli</code>.</li><li class="listitem">Wait for the command—<code class="literal">Waiting for messages</code>.</li><li class="listitem">Run <code class="literal">pi</code>. Pi stands for "plugin install" and this will compile your changes, package the plugin JAR, and install it into the <code class="literal">installed-plugins</code> folder.</li></ol></div><p>Now, there is one thing you need to keep an eye on! Not all the plugin modules can be redeployed like this prior to JIRA 4.4. The following is a list of the plugin modules that can be reloaded with <code class="literal">pi</code> in JIRA 4.0.x:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ComponentImport</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Gadget</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ModuleType</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Resource</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">REST</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ServletContextListener</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ServletContextParameter</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ServletFilter</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Servlet</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">WebItem</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">WebResource</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">WebSection</code></li></ul></div><p>If your plugin module is not there in the preceding list or if the changes doesn't seem to be reflected, press <em>Ctrl</em> + <em>C</em> in the command window running <code class="literal">atlas-run</code> and re-run the <code class="literal">atlas-run</code> command. That will re-deploy the plugin and restart JIRA.</p><p>Post JIRA 4.1, SDK supports reloading of more modules, but whether it works or not depends on what the module does internally.</p><p>JIRA 4.4+<a id="id77" class="indexterm"/> supports reloading of all the plugin modules.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Debugging in Eclipse</h2></div></div></div><a id="id78" class="indexterm"/><a id="id79" class="indexterm"/><a id="id80" class="indexterm"/><p>It is also possible to run the plugin in debug mode and point your IDE's remote debugger to it.</p><p>Following are the steps to do this in Eclipse:</p><div><ol class="orderedlist arabic"><li class="listitem">Use <code class="literal">atlas-debug</code> instead of <code class="literal">atlas-run</code>.</li><li class="listitem">Once the virtual JIRA is up and running with tour plugin deployed in it, go to <strong>Run</strong> | <strong>Debug Configurations</strong> in Eclipse.</li><li class="listitem">Create a new <code class="literal">Remote Java Application</code>.</li><li class="listitem">Give a name, keep the defaults, and give the port number as <code class="literal">5005</code>. This is the default debug port on which the virtual JIRA runs.</li><li class="listitem">Happy Debugging!</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec24"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Setting up the development environment</em></li><li class="listitem" style="list-style-type: disc"><em>Creating a skeleton plugin</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Testing and debugging</h1></div></div></div><p>In the world of <strong>Test Driven Development</strong> (<strong>TDD</strong>)<a id="id81" class="indexterm"/>, writing tests is a part and parcel of the development process. I don't want to bore you with why testing is important! Let us just say, all these holds true for JIRA plugin development as well.</p><a id="id82" class="indexterm"/><a id="id83" class="indexterm"/><p>In this recipe, we will see the various commands for running unit tests and integration tests in JIRA plugins.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec25"/>Getting ready</h2></div></div></div><p>Make sure you have the plugin development environment set up and the skeleton plugin created!</p><p>You might have noticed that there are two sample test files, one each for unit tests and integration tests, created under the <code class="literal">src/test/java/your_package/</code> and <code class="literal">src/test/java/it</code> folders.</p><p>Once you have it ready, it is time to write some tests and run those tests to make sure things work as expected!</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec26"/>How to do it...</h2></div></div></div><p>The first step is to write some tests! We recommend you to use some powerful testing frameworks like JUnit in collaboration with mocking frameworks like <strong>PowerMock</strong><a id="id84" class="indexterm"/> or <strong>Mockito</strong><a id="id85" class="indexterm"/>. Make sure you have the valid dependencies added on to your <code class="literal">pom.xml</code>.</p><p>Let us now make a huge assumption that you have written a few tests!</p><p>Following is the command to run your unit tests from the command line:</p><div><pre class="programlisting">
<strong>atlas-unit-test</strong>
</pre></div><p>The normal Maven command <code class="literal">atlas-mvn clean test</code> also does the same thing. If you are running the integration tests, the command to use is:</p><div><pre class="programlisting">
<strong>atlas-integration-test</strong>
</pre></div><a id="id86" class="indexterm"/><a id="id87" class="indexterm"/><p>Or the Maven command: <code class="literal">atlas-mvn clean integration-test</code>.</p><p>Once we are on to the stage of running tests, we will see it failing at times. There comes the need for debugging. Checkout the <code class="literal">*.txt</code> and <code class="literal">*.xml</code> files created under <code class="literal">target/ surefire-reports/</code> which has all the required information on the various tests that are executed.</p><p>Now, if you want to skip the tests at the various stages, use <code class="literal">–skip-tests</code>. For example, <code class="literal">atlas-unit-test --skip-tests</code> will skip the unit tests.</p><p>You can also use the Maven options directly to skip the unit/integrations tests or both together.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">-Dmaven.test.skip=true</code>: skips both unit and integration tests</li><li class="listitem" style="list-style-type: disc"><code class="literal">-Dmaven.test.unit.skip=true</code>: skips unit tests</li><li class="listitem" style="list-style-type: disc"><code class="literal">-Dmaven.test.it.skip=true</code>: skips integration tests</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec27"/>How it works...</h2></div></div></div><p>The <code class="literal">atlas-unit-test</code> command<a id="id88" class="indexterm"/> merely runs the related Maven command: <code class="literal">atlas-mvn clean test</code> in the backend to execute the various unit tests. It also generates the outputs into the <code class="literal">surefire-reports</code> directory for reference or debugging.</p><p>The <code class="literal">atlas-integration-test</code><a id="id89" class="indexterm"/> does a bit more. It runs the integration tests in a virtual JIRA environment. It will start up a new JIRA instance running inside a Tomcat container, set up the instance with some default data including a temporary license that lasts for three hours, and execute your tests!</p><p>How does JIRA differentiate between the unit tests and integration tests? This is where the folder structure plays an important role. Anything under the <code class="literal">src/test/java/it/</code> folder <a id="id90" class="indexterm"/>
<a id="id91" class="indexterm"/>will be treated as integration tests and everything else will be treated as unit tests!</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec28"/>There's more...</h2></div></div></div><p>There is more to it.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Using custom data for Integration/Functional Tests</h3></div></div></div><a id="id92" class="indexterm"/><a id="id93" class="indexterm"/><a id="id94" class="indexterm"/><a id="id95" class="indexterm"/><p>While <code class="literal">atlas-integration-test</code> makes our life easier by setting up a JIRA instance with some default data in it, we might need some custom data as well to successfully run a few functional tests.</p><p>We can do this in a couple of steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Export the data from a pre-configured JIRA instance into XML.</li><li class="listitem">Put it under the <code class="literal">src/test/xml/</code> directory.</li><li class="listitem">Provide this path as the value for the <code class="literal">jira.xml.data.location</code> property in the <code class="literal">localtest.properties</code> under <code class="literal">src/main/resources</code>.</li></ol></div><p>The XML resource will then be imported to JIRA before the tests are executed.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Testing against different version of JIRA/Tomcat</h3></div></div></div><a id="id96" class="indexterm"/><p>Just like the <code class="literal">atlas-run</code> command, you can use the <code class="literal">-v</code> option to test your plugin against a different version of JIRA. As before, make sure you do an <code class="literal">atlas-clean</code> before running the tests if you had tested it against another version before.</p><p>You can also use the <code class="literal">-c</code> option to test it against a different version of the Tomcat container.</p><p>For example, <code class="literal">atlas-clean &amp;&amp; atlas-integration-test -v 3.0.1 -c tomcat5x</code> will test your plugin against JIRA version 3.0.1 using Tomcat container 5.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec29"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Setting up the development environment</em></li><li class="listitem" style="list-style-type: disc"><em>Deploying a plugin</em></li></ul></div></div></div></body></html>