- en: AWS CloudFormation StackSets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Serving worldwide customers from various regions needs more attention in designing
    applications and infrastructure. Sometimes, deploying infrastructure to some regions
    is not easy. Moreover, we should perform infrastructure changes on various regions.
    This chapter will explore how to design and build infrastructure in various regions
    by applying CloudFormation StackSets.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to AWS CloudFormation StackSets
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Preparing CloudFormation StackSets
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Implementing StackSets using the management console
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating StackSets using the AWS CLI
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Editing CloudFormation StackSets
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deleting CloudFormation StackSets
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction to AWS CloudFormation StackSets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A company with worldwide customers probably encounters problems when serving
    their customers. We should be able to provide services that are close to a customer's
    location. In an IT problem context, we should deploy our applications and services
    in various regions to address network latency.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can describe our problem to serve worldwide customers as shown in *Figure
    4.1*.  We have customers from the US, Asia, and Europe. We have applications and
    services that should be deployed in those regions. Sometimes, each region has
    unique features on applications and services. Problems will become more complex
    if we change our applications and services and deploy them on various servers:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00070.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.1: Infrastructure design with regional features'
  prefs: []
  type: TYPE_NORMAL
- en: To address this issue, we can apply the AWS CloudFormation template to build
    a dynamic infrastructure. We could also deploy the AWS CloudFormation template
    to various regions. Some CloudFormation templates can  be deployed in certain
    regions.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we'll explore how to use AWS CloudFormation StackSets to deploy
    CloudFormation stacks in certain regions.
  prefs: []
  type: TYPE_NORMAL
- en: Preparing CloudFormation StackSets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We should perform some tasks in order to work with CloudFormation StackSets.
    These tasks are part of the security rules from AWS CloudFormation. To get started
    with CloudFormation StackSets, let''s first perform the following tasks:'
  prefs: []
  type: TYPE_NORMAL
- en: Getting the user ID from the IAM user as the AWS CloudFormation administrator
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating an IAM role, `AWSCloudFormationStackSetAdministrationRole`
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating a service role, `AWSCloudFormationStackSetExecutionRole`
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We'll go through these tasks in the next sections.
  prefs: []
  type: TYPE_NORMAL
- en: Getting the user ID from the IAM user
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'First, you should have an administrator account on AWS IAM. Copy your ARN user
    from your IAM account on the AWS IAM Management Console at [https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/).
    For instance, you could  have an ARN user account as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Pick up your user ID from the account number of the ARN user. From the preceding
    ARN user, we have `123456789012` as the user ID. We will use this user ID to attach
    to a CloudFormation policy.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we will create the IAM role, called `AWSCloudFormationStackSetAdministrationRole`,
    on the IAM management console.
  prefs: []
  type: TYPE_NORMAL
- en: Creating the AWSCloudFormationStackSetAdministrationRole IAM role
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To build CloudFormation StackSets, we should create an IAM role, `AWSCloudFormationStackSetAdministrationRole`.
    This is required by AWS. If we don't, we will obtain an error when creating a
    CloudFormation StackSet.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can create an IAM role, named `AWSCloudFormationStackSetAdministrationRole`,
    using CloudFormation Stack. First, we create the CloudFormation template. In this
    case, we use the following YAML format:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: You can save these scripts into a file called `AWSCloudFormationStackSetAdministrationRole.yaml`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, you can navigate to the AWS CloudFormation dashboard at [https://console.aws.amazon.com/cloudformation/](https://console.aws.amazon.com/cloudformation/) 
    and create a new CloudFormation stack. Upload the`AWSCloudFormationStackSetAdministrationRole.yaml`
    file. Give it a stack name, for instance `AWSCloudFormationStackSetAdministrationRole`,
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00071.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.2: Adding CloudFormation stack to create an IAM role, AWSCloudFormationStackSetAdministrationRole'
  prefs: []
  type: TYPE_NORMAL
- en: 'When you''re done, click on the Next button until you complete this task. Read
    [Chapter 2](part0032.html#UGI00-ff9c6455e1444393ad97060c22881bf4), *Building Your
    First AWS CloudFormation Project* and [Chapter 3](part0048.html#1DOR00-ff9c6455e1444393ad97060c22881bf4), *Developing
    AWS CloudFormation Templates* for details on how to work with CloudFormation stacks.
    After you''ve created a CloudFormation stack, you should see your CloudFormation
    stack on the CloudFormation stacks dashboard, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00072.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.3: Creation of the AWSCloudFormationStackSetAdministrationRole role
    was completed'
  prefs: []
  type: TYPE_NORMAL
- en: If you see the stack status as CREATE_COMPLETE, it means your CloudFormation
    stack has already been created. Now, you can verify it by opening the IAM AWS
    Management Console. Open a browser and navigate to [https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/).
  prefs: []
  type: TYPE_NORMAL
- en: 'On the management console, click on the Roles in the left menu. You should
    see `AWSCloudFormationStackSetAdministrationRole` on the role list:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00073.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.4: Checking the AWSCloudFormationStackSetAdministrationRole IAM roles
    dashboard'
  prefs: []
  type: TYPE_NORMAL
- en: You have created the `AWSCloudFormationStackSetAdministrationRole` role on AWS
    IAM. Next, we should create a service role named `AWSCloudFormationStackSetExecutionRole`.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a service role – AWSCloudFormationStackSetExecutionRole
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we've created the `AWSCloudFormationStackSetAdministrationRole` role
    on IAM Roles, we'll create a service role named `AWSCloudFormationStackSetExecutionRole`.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can create a service role using CloudFormation. You can write these scripts
    for the CloudFormation template:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Save these scripts into a file called `AWSCloudFormationStackSetExecutionRole.yaml`.
  prefs: []
  type: TYPE_NORMAL
- en: This service needs an administrator account to enable it to run a service on
    CloudFormation. We have prepared the IAM user and copied the ARN of the user.
    Now, you can open a browser and navigate to the CloudFormation dashboard. Upload
    the `AWSCloudFormationStackSetExecutionRole.yaml` file to AWS CloudFormation stacks.
    Fill in your stack name and the ARN user from your IAM user, for instance, `123456789012`.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can see the stack screen in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00074.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.5: Creating a service role, AWSCloudFormationStackSetExecutionRole'
  prefs: []
  type: TYPE_NORMAL
- en: 'You can follow created stacks instructions. Once done, you can check your stack
    creation status. Make sure your stack completes:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00075.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 4.6: AWSCloudFormationStackSetExecutionRole service role was completed
  prefs: []
  type: TYPE_NORMAL
- en: We have created a service role, `AWSCloudFormationStackSetExecutionRole`. Now,
    we are ready to create a StackSet. Next, we will create a StackSet using the management
    console and the AWS CLI.
  prefs: []
  type: TYPE_NORMAL
- en: Implementing StackSets using management console
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will create a StackSet using the **Web Management Console**
    (**WMC**). You should have created the IAM role, `AWSCloudFormationStackSetAdministrationRole`,
    and a service role, `AWSCloudFormationStackSetExecutionRole`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, you can open a browser and navigate to the CloudFormation StackSet dashboard
    at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
    You should see the dashboard shown in *Figure 4.7*:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00076.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.7: CloudFormation StackSets dashboard'
  prefs: []
  type: TYPE_NORMAL
- en: 'By default, the CloudFormation management console shows the Stacks dashboard.
    You can select the StackSets dashboard by clicking on the StackSets menu from
    the main menu, as shown in *Figure 4.8*:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/00077.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.8: Opening the CloudFormation StackSets dashboard from the main menu'
  prefs: []
  type: TYPE_NORMAL
- en: 'In this section, we will perform the following tasks:'
  prefs: []
  type: TYPE_NORMAL
- en: Creating a new StackSet
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Adding a CloudFormation stack into a StackSet
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Deleting a CloudFormation stack from a StackSet
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We'll perform these tasks in the next sections.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a new StackSet
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we'll create a StackSet using the management console. A StackSet
    consists of stacks that are deployed in one or more regions.
  prefs: []
  type: TYPE_NORMAL
- en: 'Some steps should be followed to create a StackSet. Perform these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Open your browser and navigate to the CloudFormation StackSets dashboard at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should see the CloudFormation StackSets dashboard, shown in *Figure 4.7*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To create a new StackSet, click on the Create StackSet button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once you''ve clicked it, you should see the screen shown in *Figure 4.9*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00078.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.9: Creating StackSet by selecting template'
  prefs: []
  type: TYPE_NORMAL
- en: Choose the Select a sample template from the following templates option.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Enable AWS Config template. Once done, click on the Next button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see the screen, shown in *Figure 4.10*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00079.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.10: Filling StackSet name and attributes'
  prefs: []
  type: TYPE_NORMAL
- en: Fill in your StackSet name, for instance, `my-stackset`. Once done, click on
    the Next button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should see the screen shown in *Figure 4.11*. Select the Deploy stacks in
    accounts option.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter your ARN user in the textbox. You can fill in some accounts on this StackSet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00080.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.11: Setting up accounts for StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: Scroll down so you see the screen shown in *Figure 4.12*. Select one or a few
    regions for your accounts.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For our demo, I've selected the US East (N.Virginia) and Asia Pacific (Singapore)
    regions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once done, click on the Next button:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00081.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.12: Setting targeted regions'
  prefs: []
  type: TYPE_NORMAL
- en: 'You should get the screen shown in *Figure 4.13*. In this form, we''ll do nothing.
    Click on the Next button to continue:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00082.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.13: Setting up options for StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: 'You will get the review screen, shown in *Figure 4.14*. Review your input.
    Click on the Create button to start to create a StackSet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00083.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.14: Confirmation for creating StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: 'You should get the screen shown in *Figure 4.15*. You should see your StackSet
    with Enable AWS Config template:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00084.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 4-15\. StackSet was created
  prefs: []
  type: TYPE_NORMAL
- en: 'To see whether your StackSet was created successfully or not, scroll down to
    view the Operations and Stacks statuses. You should see the screen shown in *Figure
    4.16*. You can see your operation and region stack status. If the StackSet operation
    status is SUCCEEDED, your StackSet was created successfully. You also should see
    all Stacks statuses are CURRENT, as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00085.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.16: Checking the status on Operations and Stacks'
  prefs: []
  type: TYPE_NORMAL
- en: 'Some status information for the Operations and Stacks sections can be found
    in *Table 4.1* and *Table 4.2*:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **StackSets operation status** | **Operation** |'
  prefs: []
  type: TYPE_TB
- en: '| RUNNING | The operation is currently in progress |'
  prefs: []
  type: TYPE_TB
- en: '| SUCCEEDED | The operation finished without exceeding the failure tolerance
    for the operation |'
  prefs: []
  type: TYPE_TB
- en: '| FAILED | The number of stacks on which the operation could not be completed
    exceeded the user-defined failure tolerance |'
  prefs: []
  type: TYPE_TB
- en: '| STOPPING | The operation is in the process of stopping, at the user''s request
    |'
  prefs: []
  type: TYPE_TB
- en: '| STOPPED | The operation has been stopped, at the user''s request |'
  prefs: []
  type: TYPE_TB
- en: 'Table 4.1: A list of status information for StackSets operations'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Stack instance status** | **Operation** |'
  prefs: []
  type: TYPE_TB
- en: '| CURRENT | The stack is currently up-to-date with the stack set |'
  prefs: []
  type: TYPE_TB
- en: '| OUTDATED | The stack is not currently up-to-date |'
  prefs: []
  type: TYPE_TB
- en: '| INOPERABLE | A DeleteStackInstances operation has failed and left the stack
    in an unstable state |'
  prefs: []
  type: TYPE_TB
- en: 'Table 4.2: A list of status information for the Stack instance'
  prefs: []
  type: TYPE_NORMAL
- en: Now that you have created StackSet on CloudFormation through management console.
    Next, we'll create one or more stacks on StackSet.
  prefs: []
  type: TYPE_NORMAL
- en: Adding a new CloudFormation Stack
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can add additional stacks on an existing StackSet. In this case, you can't
    use a new CloudFormation stack template. You should use an existing stack template
    from StackSet that has been already deployed. We can use cross accounts and regions.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this demo, I''ll add a new region for my existing StackSet. Perform the
    following tasks to add a CloudFormation stack into a StackSet:'
  prefs: []
  type: TYPE_NORMAL
- en: Open a browser and navigate to the CloudFormation StackSets dashboard at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see the screen shown in *Figure 4.17*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00086.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.17: A list of CloudFormation StackSets'
  prefs: []
  type: TYPE_NORMAL
- en: 'Select a StackSet that will be added to stacks. Click on the Actions button
    so you get the menu shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00087.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.18: Actions menu on StackSets dashboard'
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on the Manage stacks in StackSet menu. You should get the screen shown
    in *Figure 4.19*. Select the Create stacks option:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00088.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure  4.19: Select an option to add stacks'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once done, click on the Next button. You should get the screen shown in *Figure
    4.20*. Select the Create stacks in accounts option. Fill in your AWS IAM accounts. You
    also should specify the regions that will be used for targeted deployment:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00089.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.20: Set accounts and their regions'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you''ve filled in the data, click on the Next button. You should get the
    screen shown in *Figure 4.21*. Set stack parameters. Once done, click on the Next
    button:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00090.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.21: Set StackSet parameters'
  prefs: []
  type: TYPE_NORMAL
- en: 'You will get a confirmation screen, which is shown in *Figure 4.22*. Check
    your input data. Once done, click on the Create button to provision your stack:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00091.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.22: A confirmation for adding stacks'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once clicked, CloudFormation will perform this task. You should see your stack
    on the StackSet properties:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00092.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.23: A new stack on an existing StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: This is the end of adding stacks. You can add more stacks as you need them. Next,
    you will learn how to delete stacks from StackSets.
  prefs: []
  type: TYPE_NORMAL
- en: Deleting CloudFormation stacks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can delete stacks from StackSets if you think they're not going to be used.
    In this section, we'll learn how to remove stacks from StackSets.
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow these steps to delete stacks:'
  prefs: []
  type: TYPE_NORMAL
- en: Open a browser and navigate to CloudFormation StackSets (see *Figure 4.17*).
    Select and open your StackSet.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on the Manage StackSet button, and you will get the screen shown in the
    following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00093.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.24: Select a deletion option for existing Stacks'
  prefs: []
  type: TYPE_NORMAL
- en: 'Select the Delete stacks option. Click on the Next button. Once clicked, you
    should see the screen shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00094.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.25: Fill in accounts and the regions that will be deleted'
  prefs: []
  type: TYPE_NORMAL
- en: Fill in your accounts and their region details. Click on the Next button to
    continue.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see the confirmation screen shown in *Figure 4.26*. Click on the Delete
    stacks button to confirm deletion:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00095.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.26: Confirming deletion of stack accounts and regions'
  prefs: []
  type: TYPE_NORMAL
- en: You can continue to delete other stacks. This is the end of deleting stacks.
    Next, you can perform StackSets operations using the AWS CLI.
  prefs: []
  type: TYPE_NORMAL
- en: Creating StackSets using the AWS CLI
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous section, we built StackSets using the CloudFormation management
    console. In this section, we'll use the AWS CLI to manage CloudFormation StackSets.
    A list of AWS CLI commands for CloudFormation can be found here at [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html#cli-aws-cloudformation](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html#cli-aws-cloudformation).
  prefs: []
  type: TYPE_NORMAL
- en: 'We''ll use the AWS CLI to create a StackSet. Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Configure your working region. A list of AWS regions can be found at [https://docs.aws.amazon.com/general/latest/gr/rande.html](https://docs.aws.amazon.com/general/latest/gr/rande.html).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For instance, I changed my region to the `us-east-1` region. You can type the
    following commands at the Terminal:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Once executed, you can verify using the `aws configure get region` command.
    You can see my program output in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00096.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.27: Configure the working region on the AWS CLI'
  prefs: []
  type: TYPE_NORMAL
- en: Create a StackSet using the Enable AWS Config template. This template is available
    at [https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml](https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Create a StackSet named `my-stackset`. You can use the `create-stack-set` command.
    Type this command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Once executed, you should obtain StackSetId, which can be used to retrieve
    your StackSet information. You can see my StackSetId in the following screenshot
    when I created a StackSet:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00097.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.28: Creating a StackSet through the AWS CLI'
  prefs: []
  type: TYPE_NORMAL
- en: To get a creation status from your StackSet, use the `list-stack-sets` command.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If your StackSet has been created successfully, you should see your StackSet
    status as ACTIVE:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00098.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.29: Getting a list of StackSets through the AWS CLI'
  prefs: []
  type: TYPE_NORMAL
- en: We can continue to create stack instances. We define accounts and their regions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use the `create-stack-instances` command when passing your StackSet name, accounts,
    and regions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'I created a stack instance on my StackSet name—`my-stackset`. I set one account, `123456789012`,
    with target regions `us-east-1` and `us-east-2`. You can type this command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Once executed, you should get the OperationId field. It will be used to check
    your execution. You can see my program output in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00099.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.30: Creating stacks instances'
  prefs: []
  type: TYPE_NORMAL
- en: To check and verify your operation status, use the `describe-stack-set-operation`
    command, passing the name of the StackSet and `operation-id`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For instance, I want to check the StackSet named `my-stackset` with the `7c5d3b1e-844c-4e02-9cb2-ad42e3e4d53d` Operation
    ID. I type the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'You can see my program output sample in *Figure 4.31*. If you see your Operation
    ID status as SUCCEEDED, it means your stack instance was created:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00100.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.31: Checking operation status'
  prefs: []
  type: TYPE_NORMAL
- en: This is the end of creating a CloudFormation StackSet using the AWS CLI. You
    can practice more with CloudFormation StackSet development.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we will learn how to edit CloudFormation StackSets.
  prefs: []
  type: TYPE_NORMAL
- en: Editing CloudFormation StackSets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Sometimes, you want to edit your StackSet parameters. You can perform this task.
    In this section, we'll explore how to modify StackSets using the CloudFormation
    management console.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can perform the following steps to edit a StackSet:'
  prefs: []
  type: TYPE_NORMAL
- en: Open your browser and navigate to the StackSets dashboard, as shown in *Figure
    4.17*. Select the StackSet you want to edit.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Actions button and select the Manage stacks in StackSet menu (see
    *Figure 4.18*).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should get the screen shown in *Figure 4.32*:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00101.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.32: Opting to edit a StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: Select the Edit StackSet option. Once done, click on the Next button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see the screen shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00102.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.33: Selecting a StackSet template to be edited'
  prefs: []
  type: TYPE_NORMAL
- en: 'In this case, we''ll modify the current template, so select the Current template:
    Update my-stackset option. Once done, click on the Next button.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should get a screen showing your template. For instance, the Enable AWS
    Config template is shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00103.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.34: Configure StackSet parameters'
  prefs: []
  type: TYPE_NORMAL
- en: Click on the Next button. Follow the next step to confirm and execute your StackSet
    changes. Once done, your StackSet is modified.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You have learned how to modify your StackSet template. Next, we'll learn how
    to delete StackSets.
  prefs: []
  type: TYPE_NORMAL
- en: Deleting CloudFormation StackSets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will learn how to delete StackSets. To delete a StackSet,
    you should delete all stacks from the StackSet first. If you don't, you will get
    errors when deleting StackSets.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can perform the following steps to delete a StackSet:'
  prefs: []
  type: TYPE_NORMAL
- en: Open your browser and navigate to the CloudFormation StackSets dashboard at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
    Select the StackSet you want to delete.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on the Actions button, and you should get the menu shown in the following
    screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00104.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.35: A menu for deleting StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: 'You should get the confirmation dialog shown in *Figure 4.36*. Click on the
    Yes, Delete button:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00105.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.36: Confirmation for deleting a StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: 'If you have stacks within the StackSet, you should delete these stacks before
    deleting the StackSet. If you don''t, you''ll get errors, as shown in the following
    screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00106.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.37: Getting errors on deleting a StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: 'You can set accounts and target regions to be removed. You can see the account
    and regions that are being deleted in *Figure 4.38*. Once done, you can back to
    perform actions on step 2:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/00107.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4.38: Removing all stacks from a StackSet'
  prefs: []
  type: TYPE_NORMAL
- en: You have deleted a StackSet from CloudFormation. I recommend you delete StackSets
    that you no longer use. I also recommend you learn best practices related to CloudFormation
    StackSets, which you can find at [https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-bestpractices.html](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-bestpractices.html).
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You learned how to create CloudFormation StackSets using the WMC and the AWS
    CLI. You also learned how to add stacks into a StackSet by attaching accounts
    and target regions. Then, you learned how to manage stacks from a StackSet, for
    instance, by editing and deleting them. Finally, you learned how to modify and
    delete the current StackSet.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we'll learn how to build AWS Lambda functions using AWS
    CloudFormation.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Answer the following questions to evaluate your learning:'
  prefs: []
  type: TYPE_NORMAL
- en: What is a CloudFormation StackSet?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the maximum number of stacks in a StackSet?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
