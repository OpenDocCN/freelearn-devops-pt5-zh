- en: AWS CloudFormation StackSets
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS CloudFormation StackSets
- en: Serving worldwide customers from various regions needs more attention in designing
    applications and infrastructure. Sometimes, deploying infrastructure to some regions
    is not easy. Moreover, we should perform infrastructure changes on various regions.
    This chapter will explore how to design and build infrastructure in various regions
    by applying CloudFormation StackSets.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 为全球客户提供来自多个区域的服务需要更多关注在设计应用程序和基础设施时。有时，将基础设施部署到某些区域并不容易。此外，我们还应该在多个区域执行基础设施变更。本章将探讨如何通过应用CloudFormation
    StackSets来设计和构建多区域基础设施。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Introduction to AWS CloudFormation StackSets
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS CloudFormation StackSets简介
- en: Preparing CloudFormation StackSets
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备CloudFormation StackSets
- en: Implementing StackSets using the management console
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用管理控制台实现StackSets
- en: Creating StackSets using the AWS CLI
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用AWS CLI创建StackSets
- en: Editing CloudFormation StackSets
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编辑CloudFormation StackSets
- en: Deleting CloudFormation StackSets
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除CloudFormation StackSets
- en: Introduction to AWS CloudFormation StackSets
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AWS CloudFormation StackSets简介
- en: A company with worldwide customers probably encounters problems when serving
    their customers. We should be able to provide services that are close to a customer's
    location. In an IT problem context, we should deploy our applications and services
    in various regions to address network latency.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 一家面向全球客户的公司在为客户提供服务时可能会遇到问题。我们应该能够提供接近客户位置的服务。在IT问题的背景下，我们应当将应用程序和服务部署到多个区域，以解决网络延迟问题。
- en: 'We can describe our problem to serve worldwide customers as shown in *Figure
    4.1*.  We have customers from the US, Asia, and Europe. We have applications and
    services that should be deployed in those regions. Sometimes, each region has
    unique features on applications and services. Problems will become more complex
    if we change our applications and services and deploy them on various servers:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以像*图4.1*所示那样描述我们的全球客户服务问题。我们有来自美国、亚洲和欧洲的客户。我们有一些应用程序和服务需要部署到这些区域。有时，每个区域的应用程序和服务可能具有独特的特性。如果我们更改我们的应用程序和服务，并将其部署到不同的服务器上，问题将变得更加复杂：
- en: '![](img/00070.jpeg)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00070.jpeg)'
- en: 'Figure 4.1: Infrastructure design with regional features'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.1：具有区域特性的基础设施设计
- en: To address this issue, we can apply the AWS CloudFormation template to build
    a dynamic infrastructure. We could also deploy the AWS CloudFormation template
    to various regions. Some CloudFormation templates can  be deployed in certain
    regions.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，我们可以应用AWS CloudFormation模板来构建动态基础设施。我们还可以将AWS CloudFormation模板部署到多个区域。有些CloudFormation模板只能在特定区域进行部署。
- en: In this chapter, we'll explore how to use AWS CloudFormation StackSets to deploy
    CloudFormation stacks in certain regions.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨如何使用AWS CloudFormation StackSets将CloudFormation堆栈部署到特定区域。
- en: Preparing CloudFormation StackSets
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备CloudFormation StackSets
- en: 'We should perform some tasks in order to work with CloudFormation StackSets.
    These tasks are part of the security rules from AWS CloudFormation. To get started
    with CloudFormation StackSets, let''s first perform the following tasks:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用CloudFormation StackSets，我们需要执行一些任务。这些任务是AWS CloudFormation的安全规则的一部分。让我们首先执行以下任务，开始使用CloudFormation
    StackSets：
- en: Getting the user ID from the IAM user as the AWS CloudFormation administrator
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为AWS CloudFormation管理员从IAM用户获取用户ID
- en: Creating an IAM role, `AWSCloudFormationStackSetAdministrationRole`
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建IAM角色，`AWSCloudFormationStackSetAdministrationRole`
- en: Creating a service role, `AWSCloudFormationStackSetExecutionRole`
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建服务角色，`AWSCloudFormationStackSetExecutionRole`
- en: We'll go through these tasks in the next sections.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的章节中讨论这些任务。
- en: Getting the user ID from the IAM user
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从IAM用户获取用户ID
- en: 'First, you should have an administrator account on AWS IAM. Copy your ARN user
    from your IAM account on the AWS IAM Management Console at [https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/).
    For instance, you could  have an ARN user account as follows:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您应该在AWS IAM上拥有管理员账户。复制您的IAM账户中的ARN用户，您可以在AWS IAM管理控制台的[https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/)查看。例如，您可以拥有如下ARN用户账户：
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Pick up your user ID from the account number of the ARN user. From the preceding
    ARN user, we have `123456789012` as the user ID. We will use this user ID to attach
    to a CloudFormation policy.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 从ARN用户的账户号中获取用户ID。从前面的ARN用户中，我们可以获得`123456789012`作为用户ID。我们将使用此用户ID来附加CloudFormation策略。
- en: Next, we will create the IAM role, called `AWSCloudFormationStackSetAdministrationRole`,
    on the IAM management console.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将在IAM管理控制台创建名为`AWSCloudFormationStackSetAdministrationRole`的IAM角色。
- en: Creating the AWSCloudFormationStackSetAdministrationRole IAM role
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建AWSCloudFormationStackSetAdministrationRole IAM角色
- en: To build CloudFormation StackSets, we should create an IAM role, `AWSCloudFormationStackSetAdministrationRole`.
    This is required by AWS. If we don't, we will obtain an error when creating a
    CloudFormation StackSet.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建CloudFormation StackSets，我们应创建一个名为`AWSCloudFormationStackSetAdministrationRole`的IAM角色。这是AWS要求的。如果我们不创建，创建CloudFormation
    StackSet时将会遇到错误。
- en: 'We can create an IAM role, named `AWSCloudFormationStackSetAdministrationRole`,
    using CloudFormation Stack. First, we create the CloudFormation template. In this
    case, we use the following YAML format:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用CloudFormation Stack创建一个名为`AWSCloudFormationStackSetAdministrationRole`的IAM角色。首先，我们需要创建CloudFormation模板。在本例中，我们使用以下YAML格式：
- en: '[PRE1]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You can save these scripts into a file called `AWSCloudFormationStackSetAdministrationRole.yaml`.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将这些脚本保存到名为`AWSCloudFormationStackSetAdministrationRole.yaml`的文件中。
- en: 'Now, you can navigate to the AWS CloudFormation dashboard at [https://console.aws.amazon.com/cloudformation/](https://console.aws.amazon.com/cloudformation/) 
    and create a new CloudFormation stack. Upload the`AWSCloudFormationStackSetAdministrationRole.yaml`
    file. Give it a stack name, for instance `AWSCloudFormationStackSetAdministrationRole`,
    as shown in the following screenshot:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以导航到AWS CloudFormation仪表板，[https://console.aws.amazon.com/cloudformation/](https://console.aws.amazon.com/cloudformation/)，并创建一个新的CloudFormation堆栈。上传`AWSCloudFormationStackSetAdministrationRole.yaml`文件。为其指定堆栈名称，例如`AWSCloudFormationStackSetAdministrationRole`，如下图所示：
- en: '![](img/00071.jpeg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00071.jpeg)'
- en: 'Figure 4.2: Adding CloudFormation stack to create an IAM role, AWSCloudFormationStackSetAdministrationRole'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2：添加CloudFormation堆栈以创建IAM角色，`AWSCloudFormationStackSetAdministrationRole`
- en: 'When you''re done, click on the Next button until you complete this task. Read
    [Chapter 2](part0032.html#UGI00-ff9c6455e1444393ad97060c22881bf4), *Building Your
    First AWS CloudFormation Project* and [Chapter 3](part0048.html#1DOR00-ff9c6455e1444393ad97060c22881bf4), *Developing
    AWS CloudFormation Templates* for details on how to work with CloudFormation stacks.
    After you''ve created a CloudFormation stack, you should see your CloudFormation
    stack on the CloudFormation stacks dashboard, as shown in the following screenshot:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，点击“下一步”按钮，直到完成此任务。阅读[第二章](part0032.html#UGI00-ff9c6455e1444393ad97060c22881bf4)《构建您的第一个AWS
    CloudFormation项目》和[第三章](part0048.html#1DOR00-ff9c6455e1444393ad97060c22881bf4)《开发AWS
    CloudFormation模板》，了解如何使用CloudFormation堆栈。创建CloudFormation堆栈后，您应能在CloudFormation堆栈仪表板上看到您的CloudFormation堆栈，如下图所示：
- en: '![](img/00072.jpeg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00072.jpeg)'
- en: 'Figure 4.3: Creation of the AWSCloudFormationStackSetAdministrationRole role
    was completed'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.3：创建`AWSCloudFormationStackSetAdministrationRole`角色已完成
- en: If you see the stack status as CREATE_COMPLETE, it means your CloudFormation
    stack has already been created. Now, you can verify it by opening the IAM AWS
    Management Console. Open a browser and navigate to [https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您看到堆栈状态为CREATE_COMPLETE，则表示您的CloudFormation堆栈已成功创建。现在，您可以通过打开IAM AWS管理控制台来验证它。打开浏览器并访问[https://console.aws.amazon.com/iam/](https://console.aws.amazon.com/iam/)。
- en: 'On the management console, click on the Roles in the left menu. You should
    see `AWSCloudFormationStackSetAdministrationRole` on the role list:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在管理控制台中，点击左侧菜单中的“角色”。您应该能在角色列表中看到`AWSCloudFormationStackSetAdministrationRole`：
- en: '![](img/00073.jpeg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00073.jpeg)'
- en: 'Figure 4.4: Checking the AWSCloudFormationStackSetAdministrationRole IAM roles
    dashboard'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.4：检查AWSCloudFormationStackSetAdministrationRole IAM角色仪表板
- en: You have created the `AWSCloudFormationStackSetAdministrationRole` role on AWS
    IAM. Next, we should create a service role named `AWSCloudFormationStackSetExecutionRole`.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 您已在AWS IAM中创建了`AWSCloudFormationStackSetAdministrationRole`角色。接下来，我们应创建一个名为`AWSCloudFormationStackSetExecutionRole`的服务角色。
- en: Creating a service role – AWSCloudFormationStackSetExecutionRole
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建服务角色 – AWSCloudFormationStackSetExecutionRole
- en: Now that we've created the `AWSCloudFormationStackSetAdministrationRole` role
    on IAM Roles, we'll create a service role named `AWSCloudFormationStackSetExecutionRole`.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经在IAM角色中创建了`AWSCloudFormationStackSetAdministrationRole`角色，接下来我们将创建一个名为`AWSCloudFormationStackSetExecutionRole`的服务角色。
- en: 'We can create a service role using CloudFormation. You can write these scripts
    for the CloudFormation template:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用CloudFormation创建服务角色。您可以编写以下脚本来创建CloudFormation模板：
- en: '[PRE2]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Save these scripts into a file called `AWSCloudFormationStackSetExecutionRole.yaml`.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些脚本保存到名为`AWSCloudFormationStackSetExecutionRole.yaml`的文件中。
- en: This service needs an administrator account to enable it to run a service on
    CloudFormation. We have prepared the IAM user and copied the ARN of the user.
    Now, you can open a browser and navigate to the CloudFormation dashboard. Upload
    the `AWSCloudFormationStackSetExecutionRole.yaml` file to AWS CloudFormation stacks.
    Fill in your stack name and the ARN user from your IAM user, for instance, `123456789012`.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 此服务需要一个管理员帐户，以便它可以在CloudFormation上运行服务。我们已经准备了IAM用户并复制了该用户的ARN。现在，您可以打开浏览器并导航至CloudFormation仪表盘。将`AWSCloudFormationStackSetExecutionRole.yaml`文件上传到AWS
    CloudFormation堆栈。填写您的堆栈名称和IAM用户的ARN，例如`123456789012`。
- en: 'You can see the stack screen in the following screenshot:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在以下截图中看到堆栈屏幕：
- en: '![](img/00074.jpeg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00074.jpeg)'
- en: 'Figure 4.5: Creating a service role, AWSCloudFormationStackSetExecutionRole'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.5：创建服务角色，AWSCloudFormationStackSetExecutionRole
- en: 'You can follow created stacks instructions. Once done, you can check your stack
    creation status. Make sure your stack completes:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以按照已创建的堆栈说明进行操作。完成后，您可以检查堆栈的创建状态。确保堆栈完成：
- en: '![](img/00075.jpeg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00075.jpeg)'
- en: Figure 4.6: AWSCloudFormationStackSetExecutionRole service role was completed
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.6：AWSCloudFormationStackSetExecutionRole服务角色已完成
- en: We have created a service role, `AWSCloudFormationStackSetExecutionRole`. Now,
    we are ready to create a StackSet. Next, we will create a StackSet using the management
    console and the AWS CLI.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经创建了服务角色`AWSCloudFormationStackSetExecutionRole`。现在，我们准备创建一个StackSet。接下来，我们将使用管理控制台和AWS
    CLI创建一个StackSet。
- en: Implementing StackSets using management console
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用管理控制台实现StackSets
- en: In this section, we will create a StackSet using the **Web Management Console**
    (**WMC**). You should have created the IAM role, `AWSCloudFormationStackSetAdministrationRole`,
    and a service role, `AWSCloudFormationStackSetExecutionRole`.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用**Web管理控制台**（**WMC**）创建一个StackSet。您应该已经创建了IAM角色`AWSCloudFormationStackSetAdministrationRole`和服务角色`AWSCloudFormationStackSetExecutionRole`。
- en: 'Now, you can open a browser and navigate to the CloudFormation StackSet dashboard
    at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
    You should see the dashboard shown in *Figure 4.7*:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以打开浏览器并导航至CloudFormation StackSet仪表盘：[https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home)。您应该看到如*图4.7*所示的仪表盘：
- en: '![](img/00076.jpeg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00076.jpeg)'
- en: 'Figure 4.7: CloudFormation StackSets dashboard'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.7：CloudFormation StackSets仪表盘
- en: 'By default, the CloudFormation management console shows the Stacks dashboard.
    You can select the StackSets dashboard by clicking on the StackSets menu from
    the main menu, as shown in *Figure 4.8*:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，CloudFormation管理控制台显示堆栈仪表盘。您可以通过点击主菜单中的StackSets菜单来选择StackSets仪表盘，如*图4.8*所示：
- en: '![](img/00077.jpeg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00077.jpeg)'
- en: 'Figure 4.8: Opening the CloudFormation StackSets dashboard from the main menu'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8：从主菜单打开CloudFormation StackSets仪表盘
- en: 'In this section, we will perform the following tasks:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将执行以下任务：
- en: Creating a new StackSet
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建新的StackSet
- en: Adding a CloudFormation stack into a StackSet
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将一个CloudFormation堆栈添加到StackSet
- en: Deleting a CloudFormation stack from a StackSet
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从StackSet中删除CloudFormation堆栈
- en: We'll perform these tasks in the next sections.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的部分中执行这些任务。
- en: Creating a new StackSet
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建新的StackSet
- en: In this section, we'll create a StackSet using the management console. A StackSet
    consists of stacks that are deployed in one or more regions.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用管理控制台创建一个StackSet。一个StackSet由在一个或多个区域部署的堆栈组成。
- en: 'Some steps should be followed to create a StackSet. Perform these steps:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 创建StackSet时需要遵循一些步骤。执行以下步骤：
- en: Open your browser and navigate to the CloudFormation StackSets dashboard at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并导航至CloudFormation StackSets仪表盘：[https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home)。
- en: You should see the CloudFormation StackSets dashboard, shown in *Figure 4.7*.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该看到如*图4.7*所示的CloudFormation StackSets仪表盘。
- en: To create a new StackSet, click on the Create StackSet button.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建一个新的StackSet，点击创建StackSet按钮。
- en: 'Once you''ve clicked it, you should see the screen shown in *Figure 4.9*:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击后，您应该看到如*图4.9*所示的屏幕：
- en: '![](img/00078.jpeg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00078.jpeg)'
- en: 'Figure 4.9: Creating StackSet by selecting template'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.9：通过选择模板创建StackSet
- en: Choose the Select a sample template from the following templates option.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择以下模板中的一个样本模板选项。
- en: Click on the Enable AWS Config template. Once done, click on the Next button.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击启用AWS Config模板。完成后，点击下一步按钮。
- en: 'You should see the screen, shown in *Figure 4.10*:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该看到如*图 4.10*所示的屏幕：
- en: '![](img/00079.jpeg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00079.jpeg)'
- en: 'Figure 4.10: Filling StackSet name and attributes'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.10：填写 StackSet 名称和属性
- en: Fill in your StackSet name, for instance, `my-stackset`. Once done, click on
    the Next button.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写你的 StackSet 名称，例如 `my-stackset`。完成后，点击下一步按钮。
- en: You should see the screen shown in *Figure 4.11*. Select the Deploy stacks in
    accounts option.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该看到如*图 4.11*所示的屏幕。选择“在账户中部署堆栈”选项。
- en: 'Enter your ARN user in the textbox. You can fill in some accounts on this StackSet:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文本框中输入你的 ARN 用户。你可以为该 StackSet 填写一些账户：
- en: '![](img/00080.jpeg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00080.jpeg)'
- en: 'Figure 4.11: Setting up accounts for StackSet'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.11：为 StackSet 设置账户
- en: Scroll down so you see the screen shown in *Figure 4.12*. Select one or a few
    regions for your accounts.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动，直到看到如*图 4.12*所示的屏幕。为你的账户选择一个或多个区域。
- en: For our demo, I've selected the US East (N.Virginia) and Asia Pacific (Singapore)
    regions.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们的演示中，我选择了美国东部（弗吉尼亚州北部）和亚太地区（新加坡）区域。
- en: 'Once done, click on the Next button:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，点击下一步按钮：
- en: '![](img/00081.jpeg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00081.jpeg)'
- en: 'Figure 4.12: Setting targeted regions'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.12：设置目标区域
- en: 'You should get the screen shown in *Figure 4.13*. In this form, we''ll do nothing.
    Click on the Next button to continue:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该会看到如*图 4.13*所示的屏幕。在此表单中，我们不进行任何操作。点击下一步按钮继续：
- en: '![](img/00082.jpeg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00082.jpeg)'
- en: 'Figure 4.13: Setting up options for StackSet'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.13：为 StackSet 设置选项
- en: 'You will get the review screen, shown in *Figure 4.14*. Review your input.
    Click on the Create button to start to create a StackSet:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到审核屏幕，如*图 4.14*所示。审核你的输入。点击创建按钮以开始创建 StackSet：
- en: '![](img/00083.jpeg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00083.jpeg)'
- en: 'Figure 4.14: Confirmation for creating StackSet'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.14：创建 StackSet 的确认
- en: 'You should get the screen shown in *Figure 4.15*. You should see your StackSet
    with Enable AWS Config template:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该会看到如*图 4.15*所示的屏幕。你应该看到带有启用 AWS Config 模板的 StackSet：
- en: '![](img/00084.jpeg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00084.jpeg)'
- en: Figure 4-15\. StackSet was created
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4-15：StackSet 已创建
- en: 'To see whether your StackSet was created successfully or not, scroll down to
    view the Operations and Stacks statuses. You should see the screen shown in *Figure
    4.16*. You can see your operation and region stack status. If the StackSet operation
    status is SUCCEEDED, your StackSet was created successfully. You also should see
    all Stacks statuses are CURRENT, as shown in the following screenshot:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 若要查看你的 StackSet 是否创建成功，请向下滚动查看操作和堆栈的状态。你应该看到如*图 4.16*所示的屏幕。你可以看到你的操作和区域堆栈状态。如果
    StackSet 操作状态是 SUCCEEDED，说明你的 StackSet 创建成功。你还应该看到所有堆栈的状态为 CURRENT，如以下截图所示：
- en: '![](img/00085.jpeg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00085.jpeg)'
- en: 'Figure 4.16: Checking the status on Operations and Stacks'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.16：检查操作和堆栈的状态
- en: 'Some status information for the Operations and Stacks sections can be found
    in *Table 4.1* and *Table 4.2*:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 有关操作和堆栈部分的一些状态信息可以在*表 4.1*和*表 4.2*中找到：
- en: '| **StackSets operation status** | **Operation** |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| **StackSets 操作状态** | **操作** |'
- en: '| RUNNING | The operation is currently in progress |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| RUNNING | 操作当前正在进行 |'
- en: '| SUCCEEDED | The operation finished without exceeding the failure tolerance
    for the operation |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| SUCCEEDED | 操作已完成，且未超出操作的失败容忍度 |'
- en: '| FAILED | The number of stacks on which the operation could not be completed
    exceeded the user-defined failure tolerance |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| FAILED | 无法完成操作的堆栈数量超过了用户定义的失败容忍度 |'
- en: '| STOPPING | The operation is in the process of stopping, at the user''s request
    |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| STOPPING | 操作正在停止中，应用户请求 |'
- en: '| STOPPED | The operation has been stopped, at the user''s request |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| STOPPED | 操作已停止，应用户请求 |'
- en: 'Table 4.1: A list of status information for StackSets operations'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.1：StackSets 操作状态信息列表
- en: '| **Stack instance status** | **Operation** |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| **堆栈实例状态** | **操作** |'
- en: '| CURRENT | The stack is currently up-to-date with the stack set |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| CURRENT | 堆栈当前与堆栈集保持最新状态 |'
- en: '| OUTDATED | The stack is not currently up-to-date |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| OUTDATED | 堆栈当前不是最新的 |'
- en: '| INOPERABLE | A DeleteStackInstances operation has failed and left the stack
    in an unstable state |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| INOPERABLE | 删除 Stack 实例操作失败，导致堆栈处于不稳定状态 |'
- en: 'Table 4.2: A list of status information for the Stack instance'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 表 4.2：Stack 实例的状态信息列表
- en: Now that you have created StackSet on CloudFormation through management console.
    Next, we'll create one or more stacks on StackSet.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你已经通过管理控制台在 CloudFormation 上创建了 StackSet。接下来，我们将为 StackSet 创建一个或多个堆栈。
- en: Adding a new CloudFormation Stack
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加新的 CloudFormation 堆栈
- en: You can add additional stacks on an existing StackSet. In this case, you can't
    use a new CloudFormation stack template. You should use an existing stack template
    from StackSet that has been already deployed. We can use cross accounts and regions.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在现有 StackSet 上添加额外的堆栈。在这种情况下，您不能使用新的 CloudFormation 堆栈模板。您应当使用已经部署的 StackSet
    中的现有堆栈模板。我们可以使用跨账户和跨区域的配置。
- en: 'In this demo, I''ll add a new region for my existing StackSet. Perform the
    following tasks to add a CloudFormation stack into a StackSet:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在本演示中，我将为现有的 StackSet 添加一个新区域。执行以下任务以将 CloudFormation 堆栈添加到 StackSet 中：
- en: Open a browser and navigate to the CloudFormation StackSets dashboard at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器，导航到 CloudFormation StackSets 仪表盘：[https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home)。
- en: 'You should see the screen shown in *Figure 4.17*:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该会看到如*图 4.17*所示的屏幕：
- en: '![](img/00086.jpeg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00086.jpeg)'
- en: 'Figure 4.17: A list of CloudFormation StackSets'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.17：CloudFormation StackSets 列表
- en: 'Select a StackSet that will be added to stacks. Click on the Actions button
    so you get the menu shown in the following screenshot:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个将要添加堆栈的 StackSet。点击 Actions 按钮，您将看到如下截图中的菜单：
- en: '![](img/00087.jpeg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00087.jpeg)'
- en: 'Figure 4.18: Actions menu on StackSets dashboard'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.18：StackSets 仪表盘上的操作菜单
- en: 'Click on the Manage stacks in StackSet menu. You should get the screen shown
    in *Figure 4.19*. Select the Create stacks option:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Manage stacks in StackSet 菜单。您应该会看到如*图 4.19*所示的屏幕。选择 Create stacks 选项：
- en: '![](img/00088.jpeg)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00088.jpeg)'
- en: 'Figure  4.19: Select an option to add stacks'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.19：选择一个选项以添加堆栈
- en: 'Once done, click on the Next button. You should get the screen shown in *Figure
    4.20*. Select the Create stacks in accounts option. Fill in your AWS IAM accounts. You
    also should specify the regions that will be used for targeted deployment:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，点击 Next 按钮。您应该会看到如*图 4.20*所示的屏幕。选择 Create stacks in accounts 选项。填写您的 AWS
    IAM 账户信息。您还应当指定用于目标部署的区域：
- en: '![](img/00089.jpeg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00089.jpeg)'
- en: 'Figure 4.20: Set accounts and their regions'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.20：设置账户及其区域
- en: 'Once you''ve filled in the data, click on the Next button. You should get the
    screen shown in *Figure 4.21*. Set stack parameters. Once done, click on the Next
    button:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写完数据后，点击 Next 按钮。您应该会看到如*图 4.21*所示的屏幕。设置堆栈参数。完成后，点击 Next 按钮：
- en: '![](img/00090.jpeg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00090.jpeg)'
- en: 'Figure 4.21: Set StackSet parameters'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.21：设置 StackSet 参数
- en: 'You will get a confirmation screen, which is shown in *Figure 4.22*. Check
    your input data. Once done, click on the Create button to provision your stack:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到一个确认屏幕，如*图 4.22*所示。检查您的输入数据。完成后，点击 Create 按钮来配置您的堆栈：
- en: '![](img/00091.jpeg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00091.jpeg)'
- en: 'Figure 4.22: A confirmation for adding stacks'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.22：添加堆栈的确认界面
- en: 'Once clicked, CloudFormation will perform this task. You should see your stack
    on the StackSet properties:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击后，CloudFormation 将执行此任务。您应该会看到您的堆栈出现在 StackSet 属性中：
- en: '![](img/00092.jpeg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00092.jpeg)'
- en: 'Figure 4.23: A new stack on an existing StackSet'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.23：在现有 StackSet 上创建新堆栈
- en: This is the end of adding stacks. You can add more stacks as you need them. Next,
    you will learn how to delete stacks from StackSets.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 添加堆栈的操作已经结束。如果需要，您可以继续添加更多堆栈。接下来，您将学习如何从 StackSets 中删除堆栈。
- en: Deleting CloudFormation stacks
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除 CloudFormation 堆栈
- en: You can delete stacks from StackSets if you think they're not going to be used.
    In this section, we'll learn how to remove stacks from StackSets.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您认为某些堆栈将不再使用，您可以从 StackSets 中删除它们。在本节中，我们将学习如何从 StackSets 中删除堆栈。
- en: 'Follow these steps to delete stacks:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤删除堆栈：
- en: Open a browser and navigate to CloudFormation StackSets (see *Figure 4.17*).
    Select and open your StackSet.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器，导航到 CloudFormation StackSets（参见*图 4.17*）。选择并打开您的 StackSet。
- en: 'Click on the Manage StackSet button, and you will get the screen shown in the
    following screenshot:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Manage StackSet 按钮，您将看到如下截图所示的屏幕：
- en: '![](img/00093.jpeg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00093.jpeg)'
- en: 'Figure 4.24: Select a deletion option for existing Stacks'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.24：选择删除现有堆栈的选项
- en: 'Select the Delete stacks option. Click on the Next button. Once clicked, you
    should see the screen shown in the following screenshot:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 Delete stacks 选项。点击 Next 按钮。点击后，您应该会看到如下截图中的屏幕：
- en: '![](img/00094.jpeg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00094.jpeg)'
- en: 'Figure 4.25: Fill in accounts and the regions that will be deleted'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.25：填写将要删除的账户和区域
- en: Fill in your accounts and their region details. Click on the Next button to
    continue.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写您的账户及其区域信息。点击 Next 按钮继续。
- en: 'You should see the confirmation screen shown in *Figure 4.26*. Click on the Delete
    stacks button to confirm deletion:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该会看到如*图 4.26*所示的确认屏幕。点击删除堆栈按钮以确认删除：
- en: '![](img/00095.jpeg)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00095.jpeg)'
- en: 'Figure 4.26: Confirming deletion of stack accounts and regions'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.26：确认删除栈账户和区域
- en: You can continue to delete other stacks. This is the end of deleting stacks.
    Next, you can perform StackSets operations using the AWS CLI.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以继续删除其他栈。这是删除栈的结束。接下来，您可以使用 AWS CLI 执行 StackSets 操作。
- en: Creating StackSets using the AWS CLI
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 AWS CLI 创建 StackSets
- en: In the previous section, we built StackSets using the CloudFormation management
    console. In this section, we'll use the AWS CLI to manage CloudFormation StackSets.
    A list of AWS CLI commands for CloudFormation can be found here at [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html#cli-aws-cloudformation](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html#cli-aws-cloudformation).
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们使用 CloudFormation 管理控制台构建了 StackSets。在本节中，我们将使用 AWS CLI 来管理 CloudFormation
    StackSets。AWS CLI 的 CloudFormation 命令列表可以在[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html#cli-aws-cloudformation](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html#cli-aws-cloudformation)找到。
- en: 'We''ll use the AWS CLI to create a StackSet. Follow these steps:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 AWS CLI 创建一个 StackSet。请按照以下步骤操作：
- en: Configure your working region. A list of AWS regions can be found at [https://docs.aws.amazon.com/general/latest/gr/rande.html](https://docs.aws.amazon.com/general/latest/gr/rande.html).
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置您的工作区域。AWS 区域的列表可以在[https://docs.aws.amazon.com/general/latest/gr/rande.html](https://docs.aws.amazon.com/general/latest/gr/rande.html)找到。
- en: 'For instance, I changed my region to the `us-east-1` region. You can type the
    following commands at the Terminal:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 例如，我将我的区域更改为`us-east-1`区域。您可以在终端中输入以下命令：
- en: '[PRE3]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Once executed, you can verify using the `aws configure get region` command.
    You can see my program output in the following screenshot:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行后，您可以使用`aws configure get region`命令来验证。您可以在下方的截图中看到我的程序输出：
- en: '![](img/00096.jpeg)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00096.jpeg)'
- en: 'Figure 4.27: Configure the working region on the AWS CLI'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.27：在 AWS CLI 上配置工作区域
- en: Create a StackSet using the Enable AWS Config template. This template is available
    at [https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml](https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml).
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 Enable AWS Config 模板创建 StackSet。该模板可在[https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml](https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml)获取。
- en: 'Create a StackSet named `my-stackset`. You can use the `create-stack-set` command.
    Type this command:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`my-stackset`的 StackSet。您可以使用`create-stack-set`命令。输入以下命令：
- en: '[PRE4]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Once executed, you should obtain StackSetId, which can be used to retrieve
    your StackSet information. You can see my StackSetId in the following screenshot
    when I created a StackSet:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行后，您应该获得 StackSetId，可以用来检索您的 StackSet 信息。您可以在下方的截图中看到我创建 StackSet时的 StackSetId：
- en: '![](img/00097.jpeg)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00097.jpeg)'
- en: 'Figure 4.28: Creating a StackSet through the AWS CLI'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.28：通过 AWS CLI 创建 StackSet
- en: To get a creation status from your StackSet, use the `list-stack-sets` command.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要从您的 StackSet 获取创建状态，请使用`list-stack-sets`命令。
- en: 'If your StackSet has been created successfully, you should see your StackSet
    status as ACTIVE:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的 StackSet 创建成功，您应该看到 StackSet 状态为 ACTIVE：
- en: '![](img/00098.jpeg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00098.jpeg)'
- en: 'Figure 4.29: Getting a list of StackSets through the AWS CLI'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.29：通过 AWS CLI 获取 StackSets 列表
- en: We can continue to create stack instances. We define accounts and their regions.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以继续创建栈实例。我们定义账户及其区域。
- en: Use the `create-stack-instances` command when passing your StackSet name, accounts,
    and regions.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当传入 StackSet 名称、账户和区域时，使用`create-stack-instances`命令。
- en: 'I created a stack instance on my StackSet name—`my-stackset`. I set one account, `123456789012`,
    with target regions `us-east-1` and `us-east-2`. You can type this command:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我在名为`my-stackset`的 StackSet 上创建了一个栈实例。我设置了一个账户，`123456789012`，目标区域为`us-east-1`和`us-east-2`。您可以输入以下命令：
- en: '[PRE5]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once executed, you should get the OperationId field. It will be used to check
    your execution. You can see my program output in the following screenshot:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行后，您应该获得 OperationId 字段。它将用于检查您的执行情况。您可以在下方的截图中看到我的程序输出：
- en: '![](img/00099.jpeg)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00099.jpeg)'
- en: 'Figure 4.30: Creating stacks instances'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.30：创建栈实例
- en: To check and verify your operation status, use the `describe-stack-set-operation`
    command, passing the name of the StackSet and `operation-id`.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要检查并验证您的操作状态，使用`describe-stack-set-operation`命令，传入 StackSet 名称和`operation-id`。
- en: 'For instance, I want to check the StackSet named `my-stackset` with the `7c5d3b1e-844c-4e02-9cb2-ad42e3e4d53d` Operation
    ID. I type the following command:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 例如，我想检查名为 `my-stackset` 的 StackSet，操作 ID 为 `7c5d3b1e-844c-4e02-9cb2-ad42e3e4d53d`。我输入以下命令：
- en: '[PRE6]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You can see my program output sample in *Figure 4.31*. If you see your Operation
    ID status as SUCCEEDED, it means your stack instance was created:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以在 *图 4.31* 中看到我的程序输出示例。如果您看到您的操作 ID 状态为 SUCCEEDED，说明您的堆栈实例已经创建：
- en: '![](img/00100.jpeg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00100.jpeg)'
- en: 'Figure 4.31: Checking operation status'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.31：检查操作状态
- en: This is the end of creating a CloudFormation StackSet using the AWS CLI. You
    can practice more with CloudFormation StackSet development.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是使用 AWS CLI 创建 CloudFormation StackSet 的结束。您可以进一步练习 CloudFormation StackSet
    的开发。
- en: Next, we will learn how to edit CloudFormation StackSets.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将学习如何编辑 CloudFormation StackSets。
- en: Editing CloudFormation StackSets
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编辑 CloudFormation StackSets
- en: Sometimes, you want to edit your StackSet parameters. You can perform this task.
    In this section, we'll explore how to modify StackSets using the CloudFormation
    management console.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，您可能需要编辑 StackSet 参数。您可以执行此任务。在本节中，我们将探讨如何使用 CloudFormation 管理控制台修改 StackSets。
- en: 'You can perform the following steps to edit a StackSet:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以执行以下步骤来编辑 StackSet：
- en: Open your browser and navigate to the StackSets dashboard, as shown in *Figure
    4.17*. Select the StackSet you want to edit.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并导航到 StackSets 仪表板，如 *图 4.17* 所示。选择您想要编辑的 StackSet。
- en: Click on the Actions button and select the Manage stacks in StackSet menu (see
    *Figure 4.18*).
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Actions 按钮并选择 Manage stacks in StackSet 菜单（见 *图 4.18*）。
- en: 'You should get the screen shown in *Figure 4.32*:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该会看到 *图 4.32* 所示的屏幕：
- en: '![](img/00101.jpeg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00101.jpeg)'
- en: 'Figure 4.32: Opting to edit a StackSet'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.32：选择编辑 StackSet
- en: Select the Edit StackSet option. Once done, click on the Next button.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 Edit StackSet 选项。完成后，点击 Next 按钮。
- en: 'You should see the screen shown in the following screenshot:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该会看到以下截图所示的屏幕：
- en: '![](img/00102.jpeg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00102.jpeg)'
- en: 'Figure 4.33: Selecting a StackSet template to be edited'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.33：选择要编辑的 StackSet 模板
- en: 'In this case, we''ll modify the current template, so select the Current template:
    Update my-stackset option. Once done, click on the Next button.'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '在这种情况下，我们将修改当前模板，因此选择 Current template: Update my-stackset 选项。完成后，点击 Next 按钮。'
- en: 'You should get a screen showing your template. For instance, the Enable AWS
    Config template is shown in the following screenshot:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该能看到显示模板的屏幕。例如，以下截图显示的是启用 AWS Config 模板：
- en: '![](img/00103.jpeg)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00103.jpeg)'
- en: 'Figure 4.34: Configure StackSet parameters'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.34：配置 StackSet 参数
- en: Click on the Next button. Follow the next step to confirm and execute your StackSet
    changes. Once done, your StackSet is modified.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Next 按钮。按照下一步确认并执行您的 StackSet 更改。完成后，您的 StackSet 已被修改。
- en: You have learned how to modify your StackSet template. Next, we'll learn how
    to delete StackSets.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经学会了如何修改 StackSet 模板。接下来，我们将学习如何删除 StackSets。
- en: Deleting CloudFormation StackSets
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除 CloudFormation StackSets
- en: In this section, we will learn how to delete StackSets. To delete a StackSet,
    you should delete all stacks from the StackSet first. If you don't, you will get
    errors when deleting StackSets.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习如何删除 StackSets。要删除 StackSet，您应该先删除 StackSet 中的所有堆栈。如果没有删除，您在删除 StackSet
    时将会遇到错误。
- en: 'You can perform the following steps to delete a StackSet:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以执行以下步骤来删除 StackSet：
- en: Open your browser and navigate to the CloudFormation StackSets dashboard at [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home).
    Select the StackSet you want to delete.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并导航到 CloudFormation StackSets 仪表板，网址为 [https://console.aws.amazon.com/cloudformation/stacksets/home](https://console.aws.amazon.com/cloudformation/stacksets/home)。选择您想要删除的
    StackSet。
- en: 'Click on the Actions button, and you should get the menu shown in the following
    screenshot:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Actions 按钮，您应该会看到以下截图所示的菜单：
- en: '![](img/00104.jpeg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00104.jpeg)'
- en: 'Figure 4.35: A menu for deleting StackSet'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.35：删除 StackSet 的菜单
- en: 'You should get the confirmation dialog shown in *Figure 4.36*. Click on the
    Yes, Delete button:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您应该会看到如 *图 4.36* 所示的确认对话框。点击“是，删除”按钮：
- en: '![](img/00105.jpeg)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00105.jpeg)'
- en: 'Figure 4.36: Confirmation for deleting a StackSet'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.36：删除 StackSet 的确认界面
- en: 'If you have stacks within the StackSet, you should delete these stacks before
    deleting the StackSet. If you don''t, you''ll get errors, as shown in the following
    screenshot:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的 StackSet 中有堆栈，您应该先删除这些堆栈再删除 StackSet。如果不这样做，将会出现错误，如下图所示：
- en: '![](img/00106.jpeg)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00106.jpeg)'
- en: 'Figure 4.37: Getting errors on deleting a StackSet'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.37：删除 StackSet 时出现错误
- en: 'You can set accounts and target regions to be removed. You can see the account
    and regions that are being deleted in *Figure 4.38*. Once done, you can back to
    perform actions on step 2:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以设置需要移除的账户和目标区域。你可以在*图 4.38*中查看正在删除的账户和区域。完成后，你可以返回执行第 2 步中的操作：
- en: '![](img/00107.jpeg)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00107.jpeg)'
- en: 'Figure 4.38: Removing all stacks from a StackSet'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.38：从 StackSet 中移除所有堆栈
- en: You have deleted a StackSet from CloudFormation. I recommend you delete StackSets
    that you no longer use. I also recommend you learn best practices related to CloudFormation
    StackSets, which you can find at [https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-bestpractices.html](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-bestpractices.html).
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经从 CloudFormation 中删除了一个 StackSet。我建议你删除不再使用的 StackSets。我还建议你学习与 CloudFormation
    StackSets 相关的最佳实践，你可以在 [https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-bestpractices.html](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-bestpractices.html)
    中找到这些最佳实践。
- en: Summary
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: You learned how to create CloudFormation StackSets using the WMC and the AWS
    CLI. You also learned how to add stacks into a StackSet by attaching accounts
    and target regions. Then, you learned how to manage stacks from a StackSet, for
    instance, by editing and deleting them. Finally, you learned how to modify and
    delete the current StackSet.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经学习了如何使用 WMC 和 AWS CLI 创建 CloudFormation StackSets。你还学习了如何通过附加账户和目标区域将堆栈添加到
    StackSet 中。然后，你学习了如何从 StackSet 中管理堆栈，例如编辑和删除它们。最后，你学习了如何修改和删除当前的 StackSet。
- en: In the next chapter, we'll learn how to build AWS Lambda functions using AWS
    CloudFormation.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将学习如何使用 AWS CloudFormation 构建 AWS Lambda 函数。
- en: Questions
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to evaluate your learning:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 请回答以下问题以评估你的学习成果：
- en: What is a CloudFormation StackSet?
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么是 CloudFormation StackSet？
- en: What is the maximum number of stacks in a StackSet?
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: StackSet 中最多可以有多少个堆栈？
