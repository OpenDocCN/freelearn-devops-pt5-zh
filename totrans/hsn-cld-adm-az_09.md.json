["```\n{\n    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"location\": {\n            \"type\": \"string\"\n        },\n        \"resourceGroup\": {\n           \"type\": \"string\"\n        },\n        \"azureFirewallName\": {\n            \"type\": \"string\"\n        },\n        \"vnetName\": {\n            \"type\": \"string\"\n        },\n        \"vnetAddressSpace\": {\n            \"type\": \"string\"\n        },\n        \"subnetAddressSpace\": {\n            \"type\": \"string\"\n        },\n        \"publicIpAddressName\": {\n            \"type\": \"string\"\n        },\n        \"subnetId\": {\n            \"type\": \"string\"\n        }\n    },\n    \"variables\": {\n        \"networkApiVersion\": \"?api-version=2018-08-01\"\n    },\n    \"resources\": [\n        {\n            \"apiVersion\": \"2018-08-01\",\n            \"type\": \"Microsoft.Network/publicIpAddresses\",\n            \"name\": \"[parameters('publicIpAddressName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"sku\": {\n                \"name\": \"Standard\"\n            },\n            \"properties\": {\n                \"publicIPAllocationMethod\": \"Static\"\n            },\n            \"tags\": {}\n        },\n        {\n            \"apiVersion\": \"2018-07-01\",\n            \"type\": \"Microsoft.Network/azureFirewalls\",\n            \"name\": \"[parameters('azureFirewallName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"dependsOn\": [\n                \"[resourceId(parameters('resourceGroup'), 'Microsoft.Network/publicIpAddresses', parameters('publicIpAddressName'))]\"\n            ],\n            \"properties\": {\n                \"ipConfigurations\": [\n                    {\n                        \"name\": \"IpConf\",\n                        \"properties\": {\n                            \"subnet\": {\n                                \"id\": \"[parameters('subnetId')]\"\n                            },\n                            \"publicIPAddress\": {\n                                \"id\": \"[resourceId(parameters('resourceGroup'), 'Microsoft.Network/publicIpAddresses', parameters('publicIpAddressName'))]\"\n                            }\n                        }\n                    }\n                ]\n            },\n            \"tags\": {}\n        }\n    ]\n}\n```", "```\n{\n    \"$schema\": \"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"name\": {\n            \"type\": \"String\"\n        },\n        \"location\": {\n            \"type\": \"String\"\n        },\n        \"sku\": {\n            \"defaultValue\": \"Standard\",\n            \"allowedValues\": [\n                \"Standard\",\n                \"standard\",\n                \"Premium\",\n                \"premium\"\n            ],\n            \"type\": \"String\",\n            \"metadata\": {\n                \"description\": \"SKU for the vault\"\n            }\n        },\n        \"accessPolicies\": {\n            \"defaultValue\": [],\n            \"type\": \"Array\",\n            \"metadata\": {\n                \"description\": \"The access policies defined for this vault.\"\n            }\n        },\n        \"tenant\": {\n            \"type\": \"String\"\n        },\n        \"enabledForDeployment\": {\n            \"type\": \"Bool\"\n        },\n        \"enabledForTemplateDeployment\": {\n            \"type\": \"Bool\"\n        },\n        \"enabledForDiskEncryption\": {\n            \"type\": \"Bool\"\n        },\n        \"networkAcls\": {\n            \"type\": \"Object\",\n            \"metadata\": {\n                \"description\": \"The network firewall defined for this vault.\"\n            }\n        }\n    },\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.KeyVault/vaults\",\n            \"name\": \"[parameters('name')]\",\n            \"apiVersion\": \"2016-10-01\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"enabledForDeployment\": \"[parameters('enabledForDeployment')]\",\n                \"enabledForTemplateDeployment\": \"[parameters('enabledForTemplateDeployment')]\",\n                \"enabledForDiskEncryption\": \"[parameters('enabledForDiskEncryption')]\",\n                \"accessPolicies\": \"[parameters('accessPolicies')]\",\n                \"tenantId\": \"[parameters('tenant')]\",\n                \"sku\": {\n                    \"name\": \"[parameters('sku')]\",\n                    \"family\": \"A\"\n                },\n                \"networkAcls\": \"[parameters('networkAcls')]\"\n            }\n        }\n    ]\n}\n```", "```\nInstall-Module -Name AzureRM\n```", "```\nImport-Module AzureRM\n```", "```\nUpdate-Module -Name AzureRM\n```", "```\nConnect-AzureRmAccount\n```", "```\n$dbRG = 'PacktPaaSDB';\n$dbServer = 'packt';\n$server = Set-AzureRmSqlServer -ResourceGroupName $dbRG -ServerName $dbServer -AssignIdentity\n```", "```\n$dbRG = 'PacktPaaSDB';\n$dbServer = 'packt';\n$KeyVaultName = 'PacktKV';\nSet-AzureRmKeyVaultAccessPolicy -VaultName $KeyVaultName -ObjectId $server.Identity.PrincipalId -PermissionsToKeys get, wrapKey, unwrapKey\n```", "```\n$dbRG = 'PacktPaaSDB';\n$dbServer = 'packt';\n$rgName = 'PacktKeyVault';\n$KeyVaultName = 'PacktKV';\n$keyEncryptionKeyName = 'MyKey';\n$keyEncryptionKeyUrl = (Get-AzureKeyVaultKey -VaultName $KeyVaultName -Name $keyEncryptionKeyName).Key.kid;\n\n<# Add the key from Key Vault to the server #>\nAdd-AzureRmSqlServerKeyVaultKey -ResourceGroupName $dbRG -ServerName $dbServer -KeyId $keyEncryptionKeyUrl\n<# Set the key as the TDE protector for all resources under the server #>\nSet-AzureRmSqlServerTransparentDataEncryptionProtector -ResourceGroupName $dbRG -ServerName $dbServer -Type AzureKeyVault -KeyId $keyEncryptionKeyUrl\n<# To confirm that the TDE protector was configured as intended: #>\nGet-AzureRmSqlServerTransparentDataEncryptionProtector -ResourceGroupName $dbRG -ServerName $dbServer\n```", "```\n$dbRG = 'PacktPaaSDB';\n$dbServer = 'packt';\n$dbName = 'Demo'\nSet-AzureRMSqlDatabaseTransparentDataEncryption -ResourceGroupName $dbRG -ServerName $dbServer -DatabaseName $dbName -State \"Enabled\"\n```", "```\nSet-AzureRmKeyVaultAccessPolicy -VaultName 'PacktKV' -ResourceGroupName 'PacktKeyVault' -EnabledForDiskEncryption\n```", "```\n$VMRG = 'PacktIaaS';\n$VMname= 'DBserver';\n$rgName = 'PacktKeyVault';\n$KeyVaultName = 'PacktKV';\n$KeyVault = Get-AzureRmKeyVault -VaultName $KeyVaultName -ResourceGroupName $rgname;\n$diskEncryptionKeyVaultUrl = $KeyVault.VaultUri;\n$KeyVaultResourceId = $KeyVault.ResourceId;\n\n Set-AzureRmVMDiskEncryptionExtension -ResourceGroupName $VMRG -VMName $vmName -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $KeyVaultResourceId;\n```"]