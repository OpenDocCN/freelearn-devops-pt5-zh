<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Gadgets and Reporting in JIRA</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Writing a JIRA report</li><li class="listitem" style="list-style-type: disc">Reports in Excel format</li><li class="listitem" style="list-style-type: disc">Data validation in JIRA reports</li><li class="listitem" style="list-style-type: disc">Restricting access to reports</li><li class="listitem" style="list-style-type: disc">Object configurable parameters for reports</li><li class="listitem" style="list-style-type: disc">Creating a pie chart in JIRA</li><li class="listitem" style="list-style-type: disc">Writing JIRA 4 gadgets</li><li class="listitem" style="list-style-type: disc">Invoking REST services from gadgets</li><li class="listitem" style="list-style-type: disc">Configuring user preferences in gadgets</li><li class="listitem" style="list-style-type: disc">Accessing gadgets outside of JIRA</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Introduction</h1></div></div></div><a id="id824" class="indexterm"/><p>Reporting<a id="id825" class="indexterm"/> support in an application like JIRA is inevitable! With so much data spanning across different projects, issues, and lot of project planning done on it, we need more and more reports with customized data according to our needs.</p><p>There are two different kinds of reporting available in JIRA:</p><div><ol class="orderedlist arabic"><li class="listitem"><a id="id826" class="indexterm"/><a id="id827" class="indexterm"/><a id="id828" class="indexterm"/>Gadgets that can be added into a user's dashboard – From 4.x, the JIRA dashboard<a id="id829" class="indexterm"/> was revamped to include gadgets, replacing the legacy portlets. These gadgets are mini applications built using HTML<a id="id830" class="indexterm"/> and JavaScript<a id="id831" class="indexterm"/> that can run on any OpenSocial gadget container<a id="id832" class="indexterm"/>. They communicate with JIRA using REST APIs<a id="id833" class="indexterm"/> and retrieve the required information before rendering the display for the user appropriately.<p>As the JIRA dashboard is now an OpenSocial gadget container<a id="id834" class="indexterm"/>, we can even add third-party gadgets onto it provided they meet the gadget specifications. Similarly,<a id="id835" class="indexterm"/> JIRA gadgets<a id="id836" class="indexterm"/> can be added on to other containers like<a id="id837" class="indexterm"/> iGoogle, <a id="id838" class="indexterm"/>Gmail, and so on, but not all features of JIRA gadgets are supported by other gadget containers.</p></li><li class="listitem">Normal JIRA reports<a id="id839" class="indexterm"/> – JIRA also provides an option to create reports that show statistics for particular people, projects, versions, or other fields within issues. These reports can be found under 'Browse Project', and can be used to generate simple tabular reports, charts, and so on, and can then be exported to Excel if supported.<p>JIRA provides a number of built-in reports, the details of which can be found at <a class="ulink" href="http://confluence.atlassian.com/display/JIRA/Generating+Reports">http://confluence.atlassian.com/display/JIRA/Generating+Reports</a>.</p></li></ol></div><p>In addition to the Gadgets and Reports that JIRA provides, there are a lot of them available in the Atlassian plugin exchange. But still, we will end up writing some that are customized specifically for our organization and that is where JIRA's plugin architecture helps us by providing two plugin modules, one for reports and one for gadgets.</p><p>In this chapter, we will see more details on writing JIRA reports and gadgets, converting legacy portlets into gadgets, and so on.</p><p>In addition to that, we will also have a quick look at the <strong>JIRA Query Language</strong> (<strong>JQL</strong>), which provides advanced searching capabilities within the issue navigator. <a id="id840" class="indexterm"/>JQL helps us to generate a lot of the reports in issue navigator and export them into convenient views like Excel, Word, and so on.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Writing a JIRA report</h1></div></div></div><a id="id841" class="indexterm"/><a id="id842" class="indexterm"/><a id="id843" class="indexterm"/><p>As we just mentioned, a JIRA report can display statistical information based on all elements within JIRA – for example, issues<a id="id844" class="indexterm"/>, projects<a id="id845" class="indexterm"/>, users<a id="id846" class="indexterm"/>, issue types<a id="id847" class="indexterm"/>, and so on. They can have HTML results and optionally Excel results.</p><p>To add new reports in JIRA, you can use the <strong>Report Plugin Module</strong><a id="id848" class="indexterm"/>. The following are the key attributes and elements supported:</p><a id="id849" class="indexterm"/><p><strong>Attributes</strong>:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">key</code></p>
</td><td style="text-align: left" valign="top">
<p>This should be unique within the plugin.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">class</code></p>
</td><td style="text-align: left" valign="top">
<p>Class to provide contexts for rendered velocity templates. Must implement the <code class="literal">com.atlassian.jira.plugin.report.Report</code> interface. Recommended to extend the <code class="literal">com.atlassian.jira.plugin.report.impl.AbstractReport</code> class.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">i18n-name-key</code></p>
</td><td style="text-align: left" valign="top">
<p>The localization key for the human-readable name of the plugin module.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">name</code></p>
</td><td style="text-align: left" valign="top">
<p>Human-readable name of the report. Appears in the plugins page. Default is the plugin key.</p>
</td></tr></tbody></table></div><a id="id850" class="indexterm"/><p><strong>Elements</strong>:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">description</code></p>
</td><td style="text-align: left" valign="top">
<p>Description of the report.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">label</code></p>
</td><td style="text-align: left" valign="top">
<p>User visible name of the report.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">resource type="velocity"</code></p>
</td><td style="text-align: left" valign="top">
<p>Velocity templates for the report views.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">resource type="18n"</code></p>
</td><td style="text-align: left" valign="top">
<p>JAVA properties file for the i18n localization</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">properties</code></p>
</td><td style="text-align: left" valign="top">
<p>Reports configurable parameters that used to accept user inputs.</p>
</td></tr></tbody></table></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec150"/>Getting ready</h2></div></div></div><p>Create a skeleton plugin using the Atlassian plugin SDK.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec151"/>How to do it...</h2></div></div></div><a id="id851" class="indexterm"/><a id="id852" class="indexterm"/><a id="id853" class="indexterm"/><p>Let us consider creating a very simple report with little business logic in it. The example we choose here is to display the key and summary of all <em>issues</em> in a selected <em>project</em>. The only input for the report will be the <em>project name</em>, which can be selected from a drop-down list.</p><p>The following is the step-by-step procedure to create this report:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the report plugin module in the plugin descriptor.<p>In this first step, we will look at populating the entire plugin module in the <code class="literal">atlassian-plugin.xml</code> file<a id="id854" class="indexterm"/>.</p><div><ol class="orderedlist loweralpha"><li class="listitem">Include the report module:<div><pre class="programlisting">&lt;report key="allissues-report" name="All Issues Report"      class="com.jtricks.AllIssuesReport"&gt;
  &lt;description key="report.allissues.description"&gt;This report shows details of all isses a specific project. &lt;/description&gt;
   &lt;!-- the label of this report, which the user will use to select it --&gt;        &lt;label key="report.allissues.label" /&gt;
&lt;/report&gt;</pre></div><p>As usual, the plugin module should have a unique key. The other most important attribute here is the class. <code class="literal">AllIssuesReport</code><a id="id855" class="indexterm"/>, in this case, is the class that populates the context for the velocity templates used in the report display. It holds the business logic to retrieve the report results based on the criteria entered by the user.</p></li><li class="listitem">Include the <code class="literal">i18n</code> property resource that can be used for internationalization within the report. The keys entered, such as <code class="literal">report.allissues.label</code>, will be mapped to a key within the property file:<div><pre class="programlisting">&lt;!-- this is a .properties file containing the i18n keys for this report --&gt;
&lt;resource type="i18n" name="i18n" location="com.jtricks.allissues.AllIssuesReport" /&gt;</pre></div><p>Here, the <code class="literal">AllIssuesReport.properties</code> file will be present in the <code class="literal">com.jtricks.allissues</code> package<a id="id856" class="indexterm"/> under the resources folder in your plugin. All the keys that you used should be present in the properties file with the appropriate values.</p></li><li class="listitem"><a id="id857" class="indexterm"/><a id="id858" class="indexterm"/><a id="id859" class="indexterm"/>Include the velocity template resources within the report module:<div><pre class="programlisting">&lt;!-- the 'view' template is used to render the HTML result --&gt;
&lt;resource type="velocity" name="view" location="templates/allissues/allissues-report.vm" /&gt;</pre></div><p>Here we have defined the velocity templates that will be used to render the HTML and the Excel views for the report.</p></li><li class="listitem">Define the user-driven properties:<div><pre class="programlisting">&lt;!-- the properties of this report which the user must select before running it --&gt;
 &lt;properties&gt;
  &lt;property&gt;
    &lt;key&gt;projectId&lt;/key&gt;
    &lt;name&gt;Project&lt;/name&gt;
    &lt;description&gt;report.allissues.project.description&lt;/description&gt;
     &lt;!-- valid types are string, text, long, select, date etc--&gt;
     &lt;type&gt;select&lt;/type&gt;
     &lt;!-- the values generator is a class which will generate values for this select list --&gt;
     &lt;values class="com.jtricks.ProjectValuesGenerator"/&gt;
  &lt;/property&gt;
&lt;/properties&gt;</pre></div><p>This is a list of properties that will be rendered appropriately on the report input page. In our example, we need to select a project from a select list before generating the report. For this, we have defined a project property here for which the type is <code class="literal">select</code>. JIRA will automatically render this as a select list by taking the key/value pair from the <code class="literal">ProjectValuesGenerator</code> class<a id="id860" class="indexterm"/>. We will see more details on the types supported in the coming recipes.</p></li></ol></div><p>Now we have the plugin descriptor filled in with the details required for the report plugin module. The entire module now looks as follows:</p><div><pre class="programlisting">&lt;report key="allissues-report" name="All Issues Report"  class="com.jtricks.AllIssuesReport"&gt;
   &lt;description key="report.allissues.description"&gt;This report shows details of all isses a specific project. &lt;/description&gt;
  &lt;label key="report.allissues.label" /&gt;
  &lt;resource type="velocity" name="view" location="templates/allissues/allissues-report.vm" /&gt;
  &lt;resource type="i18n" name="i18n" location="com.jtricks.allissues.AllIssuesReport" /&gt;
  &lt;properties&gt;
    &lt;property&gt;
        &lt;key&gt;projectId&lt;/key&gt;
        &lt;name&gt;Project&lt;/name&gt;
        &lt;description&gt;report.allissues.project.description&lt;/description&gt;
        &lt;type&gt;select&lt;/type&gt;
        &lt;values class="com.jtricks.ProjectValuesGenerator"/&gt;
    &lt;/property&gt;
    &lt;/properties&gt;
&lt;/report&gt;</pre></div></li><li class="listitem">Create the <code class="literal">i18n</code> resource properties file. As mentioned, it will be created in the <code class="literal">com.jtricks.allissues</code> package under the resources folder. The name of the file will be <code class="literal">AllIssuesReport.properties</code>. We have used three properties so far, which will be populated with the appropriate values:<div><pre class="programlisting">report.allissues.description=Displays all Issues from a project
report.allissues.label=All Issues report
report.allissues.project.description=Project to be used as the basis of the report</pre></div><p>You can create <code class="literal">AllIssuesReport.proprties_{language}_{countrycode}</code> to support other locales.</p></li><li class="listitem">Create the <strong>Value Generator</strong> class<a id="id861" class="indexterm"/>. This is the class that is used to generate the values to be used for rendering the user properties on the report input page. In our example, we have used the<a id="id862" class="indexterm"/> <code class="literal">ProjectValuesGenerator</code> class.<p>The class that generates the values should implement the <code class="literal">ValuesGenerator</code> interface. It should then implement the <code class="literal">getValues()</code> method<a id="id863" class="indexterm"/> to return a key/value map. The value will be used for display, and the key will be returned as the property value which will be used in the report class.</p><p>In the <code class="literal">ProjectValuesGenerator</code> class, we use the project ID and the name as the key/value pair.</p><div><pre class="programlisting">public class ProjectValuesGenerator implements ValuesGenerator{
  public Map&lt;String, String&gt; getValues(Map userParams) {
    Map&lt;String, String&gt; projectMap = new HashMap&lt;String, String&gt;(); 
    List&lt;Project&gt; allProjects = ComponentManager.getInstance().getProjectManager().getProjectObjects(); 
    for (Project project : allProjects) {        
      projectMap.put(project.getId().toString(), project.getName());
    }
    return projectMap;
  }
}</pre></div></li><li class="listitem"><a id="id864" class="indexterm"/><a id="id865" class="indexterm"/><a id="id866" class="indexterm"/>Create the report class. This is where the actual business logic lies.<p>The report class, <code class="literal">AllIssuesReport</code> in this case, should extend the <code class="literal">AbstractReport</code> class<a id="id867" class="indexterm"/>. It can just implement the <code class="literal">Report</code> interface, but <code class="literal">AbstractReport</code> has some already implemented methods, and hence is recommended.</p><p>The only mandatory method we need to implement here is the <code class="literal">generateReportHtml</code> method<a id="id868" class="indexterm"/>. We need to populate a map here that can be used to render the velocity views. In our example, we populate the map with variable issues, which is a list of issue objects in the selected project.</p><p>The selected project can be retrieved using the key value entered in the property in the <code class="literal">atlassian-plugin.xml</code> file:</p><div><pre class="programlisting">  final String projectid = (String) reqParams.get("projectId");
  final Long pid = new Long(projectid);</pre></div><p>We now use this <code class="literal">pid</code> to retrieve the list of issues using the method <code class="literal">getIssuesFromProject</code>:</p><div><pre class="programlisting">  List&lt;Issue&gt; getIssuesFromProject(Long pid) throws SearchException {
    JqlQueryBuilder builder = JqlQueryBuilder.newBuilder();
    builder.where().project(pid);
    Query query = builder.buildQuery();
    SearchResults results = ComponentManager.getInstance().getSearchService().search(ComponentManager.getInstance().getJiraAuthenticationContext().getUser(), query, PagerFilter.getUnlimitedFilter());
    return results.getIssues();
  }</pre></div><p>Now all we need to do here is populate the map with this and return the rendered view as follows:</p><div><pre class="programlisting">  final Map&lt;String, Object&gt; velocityParams = new HashMap&lt;String, Object&gt;();
  velocityParams.put("issues", getIssuesFromProject(pid));
  return descriptor.getHtml("view", velocityParams);</pre></div><p>You can populate any useful variable like this, and it can then be used in the velocity templates to render the view.</p><p>The class now looks as follows:</p><div><pre class="programlisting">public class AllIssuesReport extends AbstractReport {

  public String generateReportHtml(ProjectActionSupport action, Map reqParams) throws Exception {
    return descriptor.getHtml("view", getVelocityParams(action, reqParams));
  }

private Map&lt;String, Object&gt; getVelocityParams(ProjectActionSupport action, Map reqParams) throws SearchException {
    final String projectid = (String) reqParams.get("projectId");
    final Long pid = new Long(projectid);

    final Map&lt;String, Object&gt; velocityParams = new HashMap&lt;String, Object&gt;();
    velocityParams.put("report", this);
    velocityParams.put("action", action);
    velocityParams.put("issues", getIssuesFromProject(pid));
    return velocityParams;
  }

  List&lt;Issue&gt; getIssuesFromProject(Long pid) throws SearchException {
    JqlQueryBuilder builder = JqlQueryBuilder.newBuilder();
    builder.where().project(pid);
    Query query = builder.buildQuery();
    SearchResults results =   ComponentManager.getInstance().getSearchService().search(ComponentManager.getInstance().getJiraAuthenticationContext().getUser(), query, PagerFilter.getUnlimitedFilter());
    return results.getIssues();
  }
}</pre></div></li><li class="listitem"><a id="id869" class="indexterm"/><a id="id870" class="indexterm"/><a id="id871" class="indexterm"/>Create the velocity template. In our case, we are using <code class="literal">templates/allissues/allissues-report.vm</code>. We will use the issues variable we populated in the report class, iterate on it, and display the issue key and summary:<div><pre class="programlisting">&lt;table id="allissues-report-table" border="0" cellpadding="3" cellspacing="1" width="100%"&gt;
   &lt;tr class="rowNormal"&gt;
    &lt;th&gt;Key&lt;/th&gt;
    &lt;th&gt;Summary&lt;/th&gt;
  &lt;/tr&gt;
   #foreach ($issue in $issues)
     &lt;tr class="rowNormal"&gt;
      &lt;td&gt;$issue.key&lt;/td&gt;
       &lt;td&gt;$issue.summary&lt;/td&gt;
    &lt;/tr&gt;
   #end
&lt;/table&gt;</pre></div></li><li class="listitem">With that, our report is ready. Package the plugin and deploy it. We will see more on creating Excel reports, validation within reports, and so on in the coming recipes.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec152"/>How it works...</h2></div></div></div><p>The whole logic of how it works can be outlined as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The input view of reports is generated by the object configurable properties, a set of pre-defined properties used to populate input parameters in JIRA. In our example, we used the <code class="literal">select</code> property. We will see more of this in detail later in this chapter.</li><li class="listitem" style="list-style-type: disc">The report class gets the properties, uses them to retrieve the details required in the report, and populates the velocity context with the details.</li><li class="listitem" style="list-style-type: disc">Velocity templates use the details in its context to render the report.</li></ul></div><a id="id872" class="indexterm"/><a id="id873" class="indexterm"/><a id="id874" class="indexterm"/><p>After the plugin is deployed, you can see the report among other JIRA reports in the <strong>Browse Project</strong> section, as shown in the following screenshot:</p><div><img src="img/1803-05-01.jpg" alt="How it works..."/></div><p>After clicking on the report, the input screen is displayed, which is constructed using the properties entered in the plugin descriptor, <strong>Project</strong> drop-down in our case:</p><div><img src="img/1803-05-02.jpg" alt="How it works..."/></div><a id="id875" class="indexterm"/><a id="id876" class="indexterm"/><a id="id877" class="indexterm"/><p>Clicking on <strong>Next</strong>, the report will be generated using the Report class and will be rendered using the velocity template as follows:</p><div><img src="img/1803-05-03.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec153"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Creating a skeleton plugin</em> in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a>, <em>Plugin Development Process</em></li><li class="listitem" style="list-style-type: disc">Deploying your plugin in <a class="link" href="ch01.html" title="Chapter 1. Plugin Development Process">Chapter 1</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Reports in Excel format</h1></div></div></div><p>In the previous recipe, we saw how to write a simple report. We will now see how to modify the report plugin to include Excel reports.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec154"/>Getting ready</h2></div></div></div><p>Create the report plugin, as mentioned in the previous recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec155"/>How to do it...</h2></div></div></div><a id="id878" class="indexterm"/><a id="id879" class="indexterm"/><p>The following are the steps to include the provision of exporting the report to Excel.</p><div><ol class="orderedlist arabic"><li class="listitem">Add the velocity resource type for the Excel view in the plugin descriptor if not added already:<div><pre class="programlisting">&lt;resource type="velocity" name="excel" location="templates/allissues/allissues-report-excel.vm" /&gt;</pre></div></li><li class="listitem">Override the <code class="literal">isExcelViewSupported</code> method in the report class to return true. In our case, we add this in the <code class="literal">AllIssuesReport.java</code>:<div><pre class="programlisting">@Override
public boolean isExcelViewSupported() {
  return true;
}</pre></div><p>This method returns false by default, as it is implemented that way in the <code class="literal">AbstractReport</code> class.</p></li><li class="listitem">Override the <code class="literal">generateReportExcel</code> method<a id="id880" class="indexterm"/> returning the Excel view. This is very similar to the <code class="literal">generateReportHtml</code> we implemented in the previous recipe. The only difference is the view returned. The method looks as follows:<div><pre class="programlisting">@Override
public String generateReportExcel(ProjectActionSupport action, Map reqParams) throws Exception {
  return descriptor.getHtml("excel", getVelocityParams(action, reqParams));
}</pre></div><p>Here the <code class="literal">getVelocityParams</code> method<a id="id881" class="indexterm"/> is exactly the same as what is used in the <code class="literal">generateReportHtml</code> method<a id="id882" class="indexterm"/> in the previous recipe. It retrieves the list of issues and populates the map of velocity parameters with the variable name issues.</p></li><li class="listitem">Create the Excel velocity template. The template is created using HTML tags and velocity syntax, just like the other templates. In our example, it will be <code class="literal">allissues-report-excel.vm</code> under the folder <code class="literal">templates/allissues/</code> under resources. This is where the view can be customized for Excel.<p>In our example, all we have is a list of issues with its summary and key. Hence, we can even use the same template for Excel. It appears as follows:</p><div><pre class="programlisting">&lt;table id="allissues-report-table" border="0" cellpadding="3" cellspacing="1" width="100%"&gt;
   &lt;tr class="rowNormal"&gt;
    &lt;th&gt;Key&lt;/th&gt;
    &lt;th&gt;Summary&lt;/th&gt;
   &lt;/tr&gt;
   #foreach ($issue in $issues)
     &lt;tr class="rowNormal"&gt;
      &lt;td&gt;$issue.key&lt;/td&gt;
      &lt;td&gt;$issue.summary&lt;/td&gt;
     &lt;/tr&gt;
   #end
&lt;/table&gt;</pre></div></li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec156"/>How it works...</h2></div></div></div><a id="id883" class="indexterm"/><a id="id884" class="indexterm"/><p>Once the Excel view is added into the reports, a link <strong>Excel View</strong> will appear on the right-hand top side of the generated reports, as shown in the next screenshot:</p><div><img src="img/1803-05-04.jpg" alt="How it works..."/></div><p>On clicking the link, the <code class="literal">generateReportExcel</code> method<a id="id885" class="indexterm"/> is executed, which in turn will generate the report and render the Excel view using the appropriate template that is <a id="id886" class="indexterm"/>
<a id="id887" class="indexterm"/>defined in the plugin descriptor.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec157"/>There's more...</h2></div></div></div><p>You may have noticed that when you click on the <strong>Excel View</strong> link, the excel report that opens is of the name <code class="literal">ConfigureReport!excelView.jspa</code>, and we need to rename that to <code class="literal">.xls </code>to make it Excel-friendly.</p><p>To do it automatically, we need to set the <strong>content-disposition</strong> parameter<a id="id888" class="indexterm"/> in the response header, as shown:</p><div><pre class="programlisting">final StringBuilder contentDispositionValue = new StringBuilderStringBuffer(50);
    contentDispositionValue.append("attachment;filename=\"");
    contentDispositionValue.append(getDescriptor().getName()).append(".xls\";");  
final HttpServletResponse response = ActionContext.getResponse();
    response.addHeader("content-disposition", contentDispositionValue.toString());</pre></div><p>This snippet is added in the <code class="literal">generateReportExcel</code> method before returning the excel view using the descriptor. The report will now open as a <code class="literal">.xls</code> file and can then be opened in Excel without any renaming.</p><div><img src="img/1803-05-05.jpg" alt="There's more..."/></div><div><div><h3 class="title"><a id="note14"/>Note</h3><p>Please refer to <a class="ulink" href="http://support.microsoft.com/kb/260519">http://support.microsoft.com/kb/260519</a> and <a class="ulink" href="http://jira.atlassian.com/browse/JRA-8484">http://jira.atlassian.com/browse/JRA-8484</a> for some details on this.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec158"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing a JIRA report</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Data validation in JIRA reports</h1></div></div></div><a id="id889" class="indexterm"/><a id="id890" class="indexterm"/><p>Whenever we take user inputs, it is always a good idea to validate them to make sure the input is in the format that is expected. The same applies to reports also. JIRA reports, as we have seen in the previous recipes, accept user inputs based on which the reports are generated. In the example we used, a project is selected and the details of issues in the selected project are displayed.</p><p>In the previous example, the likelihood of a wrong project being selected is low as the project is selected from a valid list of available projects. But still, the final URL that generates the report can be tampered with to include a wrong project ID, and so it is best to do the validation no matter how the input is taken.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec159"/>Getting ready</h2></div></div></div><p>Create the report plugin, as explained in the first recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec160"/>How to do it...</h2></div></div></div><a id="id891" class="indexterm"/><a id="id892" class="indexterm"/><p>All we need here is to override the validate method to include our custom validations. The following are the steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Override the <code class="literal">validate</code> method<a id="id893" class="indexterm"/> in the report class we created in the previous recipe.</li><li class="listitem">Extract the input parameters from the request parameters, which is an argument to the <code class="literal">validate</code> method:<div><pre class="programlisting">final String projectid = (String) reqParams.get("projectId");</pre></div><p><code class="literal">reqParams</code> here is an argument of the <code class="literal">validate</code> method:</p><div><pre class="programlisting">public void validate(ProjectActionSupport action, Map reqParams)</pre></div></li><li class="listitem">Check the validity of the input parameter. In our example, the input parameter is the <code class="literal">projectId</code>. We can check if it is valid by verifying if a project exists with the given ID. The following condition returns true if it is an invalid project ID:<div><pre class="programlisting">if (ComponentManager.getInstance().getProjectManager().getProjectObj(pid) == null)</pre></div></li><li class="listitem">If the parameter is invalid, add an error to the action with the appropriate error message:<div><pre class="programlisting">action.addError("projectId", "Invalid project Selected");</pre></div><p>Here we pass the field name to the<a id="id894" class="indexterm"/> <code class="literal">addError</code> method so that the error message appears on top of the field.</p><p>You can use internationalization here as well to include appropriate error messages.</p></li><li class="listitem">Add similar validation for all the interested parameters. The following is how the method looks like in our example:<div><pre class="programlisting">@Override
public void validate(ProjectActionSupport action, Map reqParams) {
  // Do your validation here if you have any!
   final String projectid = (String) reqParams.get("projectId");
   final Long pid = new Long(projectid);

   if (ComponentManager.getInstance().getProjectManager().getProjectObj(pid) == null) {
    action.addError("projectId", "No project with id:"+projectId+" exists!");
  }
  super.validate(action, reqParams);
 }</pre></div></li><li class="listitem">Package the plugin and deploy it!</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec161"/>How it works...</h2></div></div></div><a id="id895" class="indexterm"/><a id="id896" class="indexterm"/><p>Just before the report is generated, the <code class="literal">validate</code> method is executed. If there is any error, the user is taken back to the input screen with the error highlighted as follows:</p><div><img src="img/1803-05-06.jpg" alt="How it works..."/></div><p>This example shows an error when the report URL is tampered with to include an invalid project with ID 12020.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec162"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing a JIRA report</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Restricting access to reports</h1></div></div></div><a id="id897" class="indexterm"/><a id="id898" class="indexterm"/><a id="id899" class="indexterm"/><p>It is possible to restrict access to JIRA reports based on pre-defined criteria, such as making the report visible only to a certain group of people, or showing the report only in certain projects, and so on. Let us quickly have a look at how to code permissions for a JIRA report.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec163"/>Getting ready</h2></div></div></div><p>Create the report plugin, as explained in the first recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec164"/>How to do it...</h2></div></div></div><p>All we need to do here is to implement the <code class="literal">showReport</code> method on the report. Let us assume we want to restrict the report only to JIRA Administrators. The following are the steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Override the<a id="id900" class="indexterm"/> <code class="literal">showReport</code> method in the report class we created in the previous recipes.</li><li class="listitem">Implement the logic to return <code class="literal">true</code> only if the condition is satisfied. In our example, the report should be visible only to JIRA Administrators, and hence we should return <code class="literal">true</code> only if the current user is a JIRA Administrator:<div><pre class="programlisting">@Override
public boolean showReport() {
  User user = ComponentManager.getInstance().getJiraAuthenticationContext().getUser();
  return ComponentManager.getInstance().getUserUtil().getAdministrators().contains(user);
}</pre></div><p>Note that the method <code class="literal">getJiraAdministrators</code><a id="id901" class="indexterm"/> should be used from JIRA v 4.3.</p></li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec165"/>How it works...</h2></div></div></div><p>If the user is an Administrator, he/she will see the report link under the Browse projects area. If not, the report link won't be visible. We can include similar conditions and evaluate them in the <code class="literal">showReport</code> method<a id="id902" class="indexterm"/> before returning true:</p><div><img src="img/1803-05-07.jpg" alt="How it works..."/></div><a id="id903" class="indexterm"/><a id="id904" class="indexterm"/><a id="id905" class="indexterm"/><p>The user <strong>Test User</strong>, highlighted in the preceding screenshot, is not a JIRA Administrator and therefore, not able to see the <strong>All Issues</strong> report.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec166"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing a JIRA report</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec58"/>Object configurable parameters for reports</h1></div></div></div><a id="id906" class="indexterm"/><a id="id907" class="indexterm"/><a id="id908" class="indexterm"/><p>We have seen how to write JIRA reports and we also had a brief look at how JIRA lets us configure the input parameters. The example we have chosen in the previous recipe, on creating JIRA reports, explained the usage of the <code class="literal">select</code> type. In this recipe, we will see the various property types supported and some examples on how to configure them.</p><a id="id909" class="indexterm"/><a id="id910" class="indexterm"/><a id="id911" class="indexterm"/><p>There are a number of property types supported in JIRA. The full list supported by your JIRA version can be found in the <code class="literal">com.atlassian.configurable.ObjectConfigurationTypes</code> class. For JIRA 4.2.*, the following are the types supported for reports:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Input HTML type</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">string</code><a id="id912" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Text Box</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">long</code><a id="id913" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Text Box</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">hidden</code><a id="id914" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>NA. Hidden to the user.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">date</code><a id="id915" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Text Box with Calendar popup</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">user</code><a id="id916" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Text Box with User Picker</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">text</code><a id="id917" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Text Area</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">select</code><a id="id918" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Select List</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">multiselect</code><a id="id919" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Multi select List</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">checkbox</code><a id="id920" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Check Box</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">filterpicker</code><a id="id921" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Filter Picker</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">filterprojectpicker</code><a id="id922" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Filter or Project Picker</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cascadingselect</code><a id="id923" class="indexterm"/></p>
</td><td style="text-align: left" valign="top">
<p>Cascading Select List. Dependant on a parent Select List.</p>
</td></tr></tbody></table></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec167"/>How to do it...</h2></div></div></div><p>Let us quickly see each property and how it is used:</p><p><strong>string</strong>: The <code class="literal">string</code> property<a id="id924" class="indexterm"/> is used to create a Text Box. The Java data type is String. All you need here is to add the <code class="literal">property</code> tag with the type as <code class="literal">string</code>:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testString&lt;/key&gt;
       &lt;name&gt;Test String&lt;/name&gt;
       &lt;description&gt;Example String property&lt;/description&gt;
       &lt;type&gt;string&lt;/type&gt;
       &lt;default&gt;test val&lt;/default&gt;
     &lt;/property&gt;</pre></div><p>Each of the property types, including the <code class="literal">string</code> property, can have a default value populated using the <code class="literal">default</code> tag, as shown.</p><p><strong>long</strong>: The <code class="literal">long</code> property<a id="id925" class="indexterm"/> is used to create a Text Box. The Java data type is again String:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testLong&lt;/key&gt;
       &lt;name&gt;Test Long&lt;/name&gt;
       &lt;description&gt;Example Long property&lt;/description&gt;
       &lt;type&gt;long&lt;/type&gt;
     &lt;/property&gt;</pre></div><p><strong>select</strong>: The select property is used to create a Select List. The Java data type is String. We have seen an example of this in the previous recipe. There are two ways you can populate the values of a select property:</p><div><ol class="orderedlist arabic"><li class="listitem"><a id="id926" class="indexterm"/><a id="id927" class="indexterm"/><a id="id928" class="indexterm"/><strong>Using a Value Generator class</strong>: The class should implement the <code class="literal">ValuesGenerator</code> interface<a id="id929" class="indexterm"/> and return a map of key/value pairs. The <em>key</em> will be the value returned to the report class, whereas the <em>value</em> is the display value to the user. Let us use the same example in the previous recipe here:<div><pre class="programlisting">&lt;property&gt;
  &lt;key&gt;projectId&lt;/key&gt;
  &lt;name&gt;Project&lt;/name&gt;
  &lt;description&gt;report.allissues.project.description&lt;/description&gt;
  &lt;type&gt;select&lt;/type&gt;
  &lt;values class="com.jtricks.ProjectValuesGenerator"/&gt;
&lt;/property&gt;</pre></div><p><code class="literal">ProjectValuesGenerator</code> implements the <code class="literal">getValues()</code> method<a id="id930" class="indexterm"/> as follows:</p><div><pre class="programlisting">public class ProjectValuesGenerator implements ValuesGenerator{
  public Map&lt;String, String&gt; getValues(Map userParams) {
    Map&lt;String, String&gt; projectMap = new HashMap&lt;String, String&gt;();
    List&lt;Project&gt; allProjects = ComponentManager.getInstance().getProjectManager().getProjectObjects();
    for (Project project : allProjects) {
      projectMap.put(project.getId().toString(), project.getName());
    }
    return projectMap;
  }
}</pre></div></li><li class="listitem"><strong>Using pre-defined key/value pairs in the property</strong>: The following is an example:<div><pre class="programlisting">    &lt;property&gt;
        &lt;key&gt;testSelect&lt;/key&gt;
        &lt;name&gt;Test Select&lt;/name&gt;
        &lt;description&gt;Example Select Property&lt;/description&gt;
        &lt;type&gt;select&lt;/type&gt;
        &lt;values&gt;
          &lt;value&gt;
              &lt;key&gt;key1&lt;/key&gt;
              &lt;value&gt;Key 1&lt;/value&gt;
          &lt;/value&gt;
          &lt;value&gt;
              &lt;key&gt;key2&lt;/key&gt;
              &lt;value&gt;Key 2&lt;/value&gt;
          &lt;/value&gt;
          &lt;value&gt;
              &lt;key&gt;key3&lt;/key&gt;
              &lt;value&gt;Key 3&lt;/value&gt;
          &lt;/value&gt;
        &lt;values&gt;
    &lt;/property&gt;</pre></div></li></ol></div><p><strong>multiselect</strong>: The <code class="literal">multiselect</code> property<a id="id931" class="indexterm"/> is used to create a Multi Select List. It is the same as the select property. The only difference is that the type name is multiselect. Here the Java type will be a String if only one value is selected, and it will be an array of Strings (<code class="literal">String[]</code>) if more than one value is selected!</p><a id="id932" class="indexterm"/><a id="id933" class="indexterm"/><a id="id934" class="indexterm"/><p><strong>hidden</strong>: The <code class="literal">hidden</code> property<a id="id935" class="indexterm"/> is used to pass a Hidden Value. The Java data type is String:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testHidden&lt;/key&gt;
       &lt;name&gt;Test Hidden&lt;/name&gt;
       &lt;description&gt;Example Hidden property&lt;/description&gt;
       &lt;type&gt;hidden&lt;/type&gt;
       &lt;default&gt;test hidden val&lt;/default&gt;
     &lt;/property&gt;</pre></div><p>We need to provide a value using the <code class="literal">default</code> tag as the user won't be seeing the field to enter a value.</p><p><strong>date</strong>: The <code class="literal">date</code> property<a id="id936" class="indexterm"/> is used to create a Date Picker. The Java data type is String. We should then parse it to the <code class="literal">Date</code> object in the report:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testDate&lt;/key&gt;
       &lt;name&gt;Test Date&lt;/name&gt;
       &lt;description&gt;Example Date property&lt;/description&gt;
       &lt;type&gt;date&lt;/type&gt;
     &lt;/property&gt;</pre></div><p><strong>user</strong>: The <code class="literal">user</code> property<a id="id937" class="indexterm"/> is used to create a User Picker. The Java data type is String and it will be the username:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testUser&lt;/key&gt;
       &lt;name&gt;Test User&lt;/name&gt;
       &lt;description&gt;Example User property&lt;/description&gt;
       &lt;type&gt;user&lt;/type&gt;
     &lt;/property&gt;</pre></div><p><strong>text</strong>: The <code class="literal">text</code> property<a id="id938" class="indexterm"/> is used to create a Text Area. The Java data type is String:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testText&lt;/key&gt;
       &lt;name&gt;Test Text Area&lt;/name&gt;
       &lt;description&gt;Example Text property&lt;/description&gt;
       &lt;type&gt;text&lt;/type&gt;
     &lt;/property&gt;</pre></div><a id="id939" class="indexterm"/><a id="id940" class="indexterm"/><a id="id941" class="indexterm"/><p><strong>checkbox</strong>: The <code class="literal">checkbox</code> property<a id="id942" class="indexterm"/> is used to create a Checkbox. The Java data type is String and the value will be <code class="literal">true</code> if selected. If the checkbox is unchecked, the value will be <code class="literal">null</code>:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testCheckbox&lt;/key&gt;
       &lt;name&gt;Test Check Box&lt;/name&gt;
       &lt;description&gt;Example Checkbox property&lt;/description&gt;
       &lt;type&gt;checkbox&lt;/type&gt;
     &lt;/property&gt;</pre></div><p><strong>filterpicker</strong>: The <code class="literal">filterpicker</code> property<a id="id943" class="indexterm"/> is used to create a Filter Picker. The Java data type is String and it will hold the ID of the selected filter:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testFilterPicker&lt;/key&gt;
       &lt;name&gt;Test Filter Picker&lt;/name&gt;
       &lt;description&gt;Example Filter Picker property&lt;/description&gt;
       &lt;type&gt;filterpicker&lt;/type&gt;
     &lt;/property&gt;</pre></div><p><strong>filterprojectpicker</strong>: <a id="id944" class="indexterm"/>Used to create a Filter or Project Picker. The Java data type is String, and it will be the ID preceded by filter (if a filter is selected) and project (if a project is selected):</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testFilterProjectPicker&lt;/key&gt;
       &lt;name&gt;Test Filter or Project Picker&lt;/name&gt;
       &lt;description&gt;Example Filter or Project Picker property&lt;/
        description&gt;
       &lt;type&gt;filterprojectpicker&lt;/type&gt;
     &lt;/property&gt;</pre></div><p><strong>cascadingselect</strong><a id="id945" class="indexterm"/>: Used to create a Cascading Select, based on another select box:</p><div><pre class="programlisting">     &lt;property&gt;
       &lt;key&gt;testCascadingSelect&lt;/key&gt;
       &lt;name&gt;Test Cascading Select&lt;/name&gt;
       &lt;description&gt;Example Cascading Select&lt;/description&gt;
       &lt;type&gt;cascadingselect&lt;/type&gt;
       &lt;values class="com.jtricks.CascadingValuesGenerator"/&gt;
       &lt;cascade-from&gt;testSelect&lt;/cascade-from&gt;
     &lt;/property&gt;</pre></div><a id="id946" class="indexterm"/><a id="id947" class="indexterm"/><a id="id948" class="indexterm"/><p>Here the cascading select <code class="literal">testCascadingSelect</code> depends on the select property named <code class="literal">testSelect</code>. We have seen the <code class="literal">testSelect</code> property with the key/value pairs. The next important thing is the values generator class. As with the other value generator classes, this one also generates a map of key/value pairs.</p><p>Here the key in the key/value pair should be the value that will be returned to the user. The value should be an instance of a <code class="literal">ValueClassHolder</code> class, which is a static class. The <code class="literal">ValueClassHolder</code> class<a id="id949" class="indexterm"/> will look like the following:</p><div><pre class="programlisting">  private static class ValueClassHolder {
    private String value;
    private String className;

    public ValueClassHolder(String value, String className) {
      this.value = value;
      this.className = className;
    }

    public String getValue() {
      return value;
    }

    public String getClassName() {
      return className;
    }

    public String toString() {
      return value;
    }
  }</pre></div><a id="id950" class="indexterm"/><a id="id951" class="indexterm"/><a id="id952" class="indexterm"/><p>The <code class="literal">value</code> in the <code class="literal">ValueClassHolder</code> will be the display value of the cascading select options to the user. The <code class="literal">className</code> attribute will be the <code class="literal">key</code> of the parent select option.</p><p>In our example, the parent select property is <code class="literal">testSelect</code>. It has three keys – <code class="literal">key1</code>, <code class="literal">key2</code>, and <code class="literal">key3</code>. The <code class="literal">getValues()</code> method will, therefore, look as follows:</p><div><pre class="programlisting">  public Map getValues(Map arg0) {
    Map allValues = new LinkedHashMap();
    
    allValues.put("One1", new ValueClassHolder("First Val1", "key1"));
    allValues.put("Two1", new ValueClassHolder("Second Val1", "key1"));
    allValues.put("Three1", new ValueClassHolder("Third Val1", "key1"));
    allValues.put("One2", new ValueClassHolder("First Val2", "key2"));
    allValues.put("Two2", new ValueClassHolder("Second Val2", "key2"));
    allValues.put("One3", new ValueClassHolder("First Val3", "key3"));
    
    return allValues;
  }  </pre></div><p>If you take a single line, for example, <code class="literal">allValues.put("One1", new ValueClassHolder("First Val1", "key1"))</code>, it will have the key/value pair <code class="literal">One1/First Val1</code> when the select list has the key <code class="literal">key1</code> selected!</p><p>After selecting the appropriate values, they can be retrieved in the report class, as shown in the following lines of code:</p><div><pre class="programlisting">    final String testString = (String) reqParams.get("testString");
    final String testLong = (String) reqParams.get("testLong");
    final String testHidden = (String) reqParams.get("testHidden");
    final String testDate = (String) reqParams.get("testDate");
    final String testUser = (String) reqParams.get("testUser");
    final String testText = (String) reqParams.get("testText");
    final String[] testMultiSelect = (String[]) reqParams.get("testMultiSelect");
    final String testCheckBox = (String) reqParams.get("testCheckBox");
    final String testFilterPicker = (String) reqParams.get("testFilterPicker");
    final String testFilterProjectPicker = (String) reqParams.get("testFilterProjectPicker");
    final String testSelect = (String) reqParams.get("testSelect");
    final String testCascadingSelect = (String) reqParams.get("testCascadingSelect");</pre></div><a id="id953" class="indexterm"/><a id="id954" class="indexterm"/><a id="id955" class="indexterm"/><p>Special mention should be given to the <code class="literal">filterprojectpicker</code>. The value will be <code class="literal">filter-10000</code> if a filter with the ID 10000 is selected. The value will be <code class="literal">project-10000</code> if a project with ID 10000 is selected.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec168"/>How it works...</h2></div></div></div><p>When the report input screen is presented to the user, the properties mentioned in the plugin descriptor are converted into the appropriate HTML elements, as discussed. We can then retrieve their values in the report class and process them to generate the report.</p><p>The following two screenshots show how these properties appear on the input screen:</p><div><img src="img/1803-05-08.jpg" alt="How it works..."/></div><div><img src="img/1803-05-09.jpg" alt="How it works..."/></div><a id="id956" class="indexterm"/><a id="id957" class="indexterm"/><a id="id958" class="indexterm"/><p>If you print the extracted values into the console in the report class, it will appear as follows:</p><div><img src="img/1803-05-10.jpg" alt="How it works..."/></div><p>Hopefully, that gives you a fair idea of how to use Object Configurable Parameters in JIRA reports.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec169"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing a JIRA report</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec59"/>Creating a pie chart in JIRA</h1></div></div></div><a id="id959" class="indexterm"/><a id="id960" class="indexterm"/><p>As we have already seen in the previous recipes, JIRA ships with a bunch of built-in reports. It also lets us write our own reports using the report plugin module. One of the reports that attract a lot of users in JIRA is the Pie Chart. While the existing JIRA pie reports are really good at what it is meant for, sometimes the need arises to write our own pie charts.</p><p>Writing a pie chart in JIRA is easy because JIRA already supports <code class="literal">JFreeChart</code><a id="id961" class="indexterm"/> and has utility classes which do most of the work in creating these charts. In this recipe, we will see how to write a simple pie chart with the help of Atlassian Utility classes.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec170"/>Getting ready…</h2></div></div></div><p>Create a skeleton plugin using Atlassian Plugin SDK.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec171"/>How to do it...</h2></div></div></div><p>Let us try to create a very simple pie chart without any business logic. To keep things simple and to concentrate on the pie chart, let us go for a report without any input parameters and with just the HTML view. The following are the steps to accomplish this:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the report plugin module in the plugin descriptor:<div><pre class="programlisting">&lt;report key="pie-chart" name="Pie Chart" class="com.jtricks.PieChart"&gt;
  &lt;description&gt;Sample Pie Chart&lt;/description&gt;
  &lt;label&gt;Eaxmple Pie Chart&lt;/label&gt;
  &lt;resource type="velocity" name="view" location="templates/pie/pie-chart.vm" /&gt;
&lt;/report&gt;</pre></div><p>All it has is a class and a velocity template for the HTML view.</p></li><li class="listitem">Create the report class. As usual, it should implement the <code class="literal">AbstractReport</code> class. All we do here is to populate the velocity templates with parameters from the pie chart we create using a custom <code class="literal">PieChartGenerator</code> class<a id="id962" class="indexterm"/>.<p>Here is how the <code class="literal">generateReportHtml</code> looks:</p><div><pre class="programlisting">public String generateReportHtml(ProjectActionSupport action, Map reqParams) throws Exception {
  final Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
  params.put("report", this);
  params.put("action", action);
  params.put("user", authenticationContext.getUser());

  final Chart chart = new JTricksPieChartGenerator().generateChart(authenticationContext.getUser(),REPORT_IMAGE_WIDTH, REPORT_IMAGE_HEIGHT);

  params.putAll(chart.getParameters());
  return descriptor.getHtml("view", params);
}</pre></div><p>The <code class="literal">Chart</code> class is an Atlassian class of the type <code class="literal">com.atlassian.jira.charts.Chart</code>. The business logic of creating the chart is done inside a custom utility class, <code class="literal">JTricksPieChartGenerator</code><a id="id963" class="indexterm"/>, which we will see next.</p></li><li class="listitem"><a id="id964" class="indexterm"/><a id="id965" class="indexterm"/>Create the <code class="literal">JTricksPieChartGenerator</code> utility class, which generates the pie chart.<p>This is where the business logic of creating the chart is done, and therefore, we will see them in detail:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create the <code class="literal">DefaultPieDataset</code>, which will be the data set for the pie chart. This is a <code class="literal">JFreeChart</code> class for which the Java Docs can be found at <a class="ulink" href="http://www.jfree.org/jfreechart/api/javadoc/org/jfree/data/general/DefaultPieDataset.html">http://www.jfree.org/jfreechart/api/javadoc/org/jfree/data/general/DefaultPieDataset.html</a>.<div><pre class="programlisting">DefaultPieDataset dataset = new DefaultPieDataset();</pre></div></li><li class="listitem" style="list-style-type: disc">Populate the values in <code class="literal">dataset</code>:<div><pre class="programlisting">dataset.setValue("One", 10L);dataset.setValue("Two", 15L);</pre></div><p>In the example, we just populated two key/value pairs with a <em>name</em> and a <em>number</em> <em>value</em>. This is the data, using which the pie chart is generated. When we generate custom charts, we should replace this with the appropriate data that we are interested in.</p></li><li class="listitem" style="list-style-type: disc">Get an <code class="literal">i18nBean</code>. This is required in the Atlassian utility class:<div><pre class="programlisting">final I18nBean i18nBean = new I18nBean(remoteUser);</pre></div></li><li class="listitem" style="list-style-type: disc">Create the chart:<div><pre class="programlisting">final ChartHelper helper = new PieChartGenerator(dataset, i18nBean).generateChart();helper.generate(width, height);</pre></div><p>Here we use the <code class="literal">com.atlassian.jira.charts.jfreechart.PieChartGenerator</code> class to generate the chart using the dataset we just created and the <code class="literal">i18nBean</code>. Make sure you invoke the generate method, as shown in the preceding snippet.</p></li><li class="listitem" style="list-style-type: disc">Populate a map with all the required parameters from the generated <code class="literal">ChartHelper</code> and return a <code class="literal">Chart</code> object, as shown next:<div><pre class="programlisting">params.put("chart", helper.getLocation());
params.put("chartDataset", dataset);
params.put("imagemap", helper.getImageMap());
params.put("imagemapName", helper.getImageMapName());

return new Chart(helper.getLocation(), helper.getImageMap(), helper.getImageMapName(), params);</pre></div><p>You can add all parameters available, but we are limiting it to the absolute minimum. <code class="literal">params.putAll(chart.getParameters())</code> in the report class will then populate the velocity context with all these parameters.</p></li><li class="listitem" style="list-style-type: disc"><a id="id966" class="indexterm"/><a id="id967" class="indexterm"/>The <code class="literal">generateChart</code> method<a id="id968" class="indexterm"/> will now look as follows:<div><pre class="programlisting">      public Chart generateChart(User remoteUser, int width, int 
        height) {
      try {
        final Map&lt;String, Object&gt; params = new HashMap&lt;String, 
          Object&gt;();
        // Create Dataset
        DefaultPieDataset dataset = new DefaultPieDataset();

        dataset.setValue("One", 10L);
        dataset.setValue("Two", 15L);

        final I18nBean i18nBean = new I18nBean(remoteUser);

        final ChartHelper helper = new PieChartGenerator(dataset,       i18nBean).generateChart();
        helper.generate(width, height);

        params.put("chart", helper.getLocation());
        params.put("chartDataset", dataset);
        params.put("imagemap", helper.getImageMap());
        params.put("imagemapName", helper.getImageMapName());
        return new Chart(helper.getLocation(), helper.
          getImageMap(), helper.getImageMapName(), params);

      } catch (Exception e) {
        e.printStackTrace();
        throw new RuntimeException("Error generating chart", e);
      }
    }</pre></div></li></ul></div></li><li class="listitem">Create the velocity template for the HTML view using the context we populated in the report class. In our example, the template is <code class="literal">templates/pie/pie-chart.vm</code>. It looks like the following block of code:<div><pre class="programlisting">Sample Chart: &lt;br&gt;&lt;br&gt;
&lt;table width="100%" class="report"&gt;
  &lt;tr&gt;
    &lt;td&gt;
      #if ($chart)
         #if ($imagemap)
          $imagemap
        #end
        &lt;p class="report-chart"&gt;
          &lt;img src='$baseurl/charts?filename=$chart' border='0' #if ($imagemap) usemap="\#$imagemapName" #end/&gt;
        &lt;/p&gt;
      #end
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;</pre></div><p>Here we display the chart we created. The chart is available at the URL <code class="literal">$baseurl/charts?filename=$chart</code>, where <code class="literal">$chart</code> is the location generated by the helper class. We populated this earlier in the context.</p></li><li class="listitem"><a id="id969" class="indexterm"/><a id="id970" class="indexterm"/>Package the plugin, deploy it, and test it!</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec172"/>How it works...</h2></div></div></div><p>In short, the bit we need to do here is to create the <code class="literal">DefaultPieDataset</code> and everything else is done by JIRA for you. The <code class="literal">generateChart</code> method<a id="id971" class="indexterm"/> may take more arguments depending on the complexity of the reports we are going to create. For example: <code class="literal">startDate</code>, <code class="literal">endDate</code>, and so on. The data set will then be created using these arguments instead of our hardcoded values!</p><p>In our example, the chart appears as follows:</p><div><img src="img/1803-05-11.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec173"/>There's more...</h2></div></div></div><p>Have a look at the other helper classes under the <code class="literal">com.atlassian.jira.charts.jfreechart</code> package, for example, <code class="literal">StackedBarChartGenerator</code>, <code class="literal">HistogramChartGenerator</code>, <code class="literal">CreatedVsResolvedChartGenerator</code>, and so on, for other types of charts!</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec174"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing a JIRA report</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec60"/>Writing JIRA 4 gadgets</h1></div></div></div><a id="id972" class="indexterm"/><p>Gadgets are a big leap in JIRA's reporting features! The fact that JIRA is now an OpenSocial container lets its user add useful gadgets (both JIRA's own and third-party) into its dashboard. At the same time, gadgets written for JIRA can be added in other containers like iGoogle<a id="id973" class="indexterm"/>, Gmail<a id="id974" class="indexterm"/>, and so on!</p><p>In this recipe, we will have a look at writing a very simple gadget, one that says 'Hello from JTricks'. By keeping the content simple, it will let us concentrate more on writing the gadget!</p><a id="id975" class="indexterm"/><a id="id976" class="indexterm"/><p>Before we start writing the gadget, it is probably worth understanding the key components of a JIRA gadget:</p><div><ol class="orderedlist arabic"><li class="listitem">Gadget XML<a id="id977" class="indexterm"/> is the most important part of a JIRA Gadget. It holds the specification of the gadget and includes the following:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Gadget Characteristics</strong>. It includes title, description, author's name, and so on</li><li class="listitem" style="list-style-type: disc"><strong>Screenshot and a thumbnail image</strong>. Please note that the screenshot is not used within Atlassian containers such as JIRA or Confluence. We can optionally add it if we want them to be used in other OpenSocial containers</li><li class="listitem" style="list-style-type: disc"><strong>Required features</strong> that the gadget container must provide for the gadget</li><li class="listitem" style="list-style-type: disc"><strong>User preferences</strong> which will be configured by the gadget users</li><li class="listitem" style="list-style-type: disc">The <strong>Gadget content</strong><a id="id978" class="indexterm"/> created using HTML and JavaScript</li></ul></div></li><li class="listitem">A screenshot and thumbnail image will be used during preview and while selecting the gadget from the container.</li><li class="listitem">An <code class="literal">i18n</code> property file<a id="id979" class="indexterm"/> used for internationalization in the gadget</li><li class="listitem">Optional CSS and JavaScript file used to render the display in the <strong>Content</strong> section of the gadget</li></ol></div><p>We will see each of them in the recipe.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec175"/>Getting ready</h2></div></div></div><p>Create a skeleton plugin using Atlassian Plugin SDK.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec176"/>How to do it...</h2></div></div></div><p>The following are the steps to write our irst gadget, one that shows the greetings from JTricks!<a id="id980" class="indexterm"/></p><div><ol class="orderedlist arabic"><li class="listitem">Modify the plugin descriptor with the gadget module and the resources required for our gadget:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add the <code class="literal">Gadget</code> module in the plugin descriptor:<div><pre class="programlisting">&lt;gadget key="hello-gadget" name="Hello Gadget" location="hello-gadget.xml"&gt;&lt;description&gt;Hello Gadget! &lt;/description&gt;
&lt;/gadget&gt;</pre></div><p>As you can see, this has a unique <code class="literal">key</code> and points to the <code class="literal">location</code> of the gadget XML! You can have as many gadget definitions as you want in your <code class="literal">atlassian-plugin.xml</code> file, but in our example, we stick with the preceding one.</p></li><li class="listitem" style="list-style-type: disc">Include the thumbnail and screenshot images and downloadable resources in the plugin descriptor. We have seen details of this in the previous chapter and more can be learned at <a class="ulink" href="http://confluence.atlassian.com/display/JIRADEV/Downloadable+Plugin+Resources">http://confluence.atlassian.com/display/JIRADEV/Downloadable+Plugin+Resources</a>. In our example, the resources are added on to the plugin descriptor as:<div><pre class="programlisting">&lt;resource type="download" name="screenshot.png" location="/images/screenshot.png"/&gt;
&lt;resource type="download" name="thumbnail.png" location="/images/thumbnail.png"/&gt;</pre></div><p>The location is relative to the <code class="literal">src/main/resources</code> folder in the plugin. As mentioned before, the screenshot is optional.</p></li></ul></div></li><li class="listitem"><a id="id981" class="indexterm"/><a id="id982" class="indexterm"/>Add the <code class="literal">i18n</code> properties file that will be used in the gadget also as a downloadable resource:<div><pre class="programlisting">&lt;resource type="download" name="i18n/messages.xml" location="i18n/messages.xml"&gt;
  &lt;param name="content-type" value="text/xml; charset=UTF-8"/&gt;
&lt;/resource&gt;</pre></div><p>The <code class="literal">atlassian-plugin.xml</code> will now look like this:</p><div><pre class="programlisting">&lt;atlassian-plugin key="com.jtricks.gadgets" name="Gadgets Plugin" plugins-version="2"&gt;
    &lt;plugin-info&gt;
      &lt;description&gt;Gadgets Example&lt;/description&gt;
      &lt;version&gt;2.0&lt;/version&gt;
      &lt;vendor name="JTricks" url="http://www.j-tricks.com/" /&gt;
    &lt;/plugin-info&gt;
    &lt;gadget key="hello-gadget" name="Hello Gadget" location="hello-gadget.xml"&gt;
      &lt;description&gt;Hello Gadget!&lt;/description&gt;
    &lt;/gadget&gt;

    &lt;resource type="download" name="screenshot.png" location="/images/screenshot.png"/&gt;
    &lt;resource type="download" name="thumbnail.png" location="/images/thumbnail.png"/&gt;

    &lt;resource type="download" name="i18n/messages.xml" location="i18n/messages.xml"&gt;
      &lt;param name="content-type" value="text/xml; charset=UTF-8"/&gt;
    &lt;/resource&gt;
  &lt;/atlassian-plugin&gt;</pre></div></li><li class="listitem">Add the screenshot and thumbnail images under the <code class="literal">src/main/resources/images</code> folder. The thumbnail image should be of the size 120 x 60 pixels.</li><li class="listitem">Add the <code class="literal">i18n</code> properties file under the <code class="literal">src/main/resources/i18n</code> folder. The name of the filer we defined in <code class="literal">messages.xml</code>.<p>This file is an XML file wrapped within the <code class="literal">messagebundle</code> tag. Each property in the file is entered as an XML tag, as shown next:</p><div><pre class="programlisting">&lt;msg name="gadget.title"&gt;Hello Gadget&lt;/msg&gt;</pre></div><p>The <code class="literal">msg</code> tag has a <code class="literal">name</code> attribute, which is the property, and the corresponding Value is enclosed in the <code class="literal">msg</code> tag. We use three properties in our example and the entire file in our example looks like the following:</p><div><pre class="programlisting">&lt;messagebundle&gt;
  &lt;msg name="gadget.title"&gt;Hello Gadget&lt;/msg&gt;
  &lt;msg name="gadget.title.url"&gt;http://www.j-tricks.com&lt;/msg&gt;
  &lt;msg name="gadget.description"&gt;Example Gadget from J-Tricks&lt;/msg&gt;
&lt;/messagebundle&gt;</pre></div></li><li class="listitem"><a id="id983" class="indexterm"/><a id="id984" class="indexterm"/>Write the Gadget XML.<p>The Gadget XML has a Module element at the root of the XML. It has mainly three elements underneath – <code class="literal">ModulePrefs</code>, <code class="literal">UserPref</code>, and <code class="literal">Content</code>. We will write of each of them in this example. The entire set of attributes and elements and other details of the gadget specification can be read at <a class="ulink" href="http://confluence.atlassian.com/display/GADGETDEV/Creating+your+Gadget+XML+Specification">http://confluence.atlassian.com/display/GADGETDEV/Creating+your+Gadget+XML+Specification</a>.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Write the <code class="literal">ModulePrefs</code> element. This element holds the information about the gadget. It also has two child elements – <code class="literal">Require</code> and <code class="literal">Optional</code>, that are used to define the required or optional features for the gadget.<p>The following is how the <code class="literal">ModulePrefs</code> element looks in our example after it is populated with all the attributes:</p><div><pre class="programlisting">&lt;ModulePrefs title="__MSG_gadget.title__" 
             title_url="__MSG_gadget.title.url__" 
             description="__MSG_gadget.description__" 
             author="Jobin Kuruvilla" 
             author_email=jobinkk@gmail.com
             screenshot='#staticResourceUrl("com.jtricks.gadgets:hello-gadget", "screenshot.png")' 
             thumbnail='#staticResourceUrl("com.jtricks.gadgets:hello-gadget", "thumbnail.png")' height="150"  &gt;
&lt;/ModulePrefs&gt;</pre></div><p>As you can see, it holds information like <code class="literal">title</code>, <code class="literal">title URL</code> (to which the gadget title will link to), <code class="literal">description</code>, <code class="literal">author</code> <code class="literal">name</code> and <code class="literal">email</code>, <code class="literal">height</code> of the gadget, and URLs to screenshot and thumbnail images.</p><p>Anything that starts with <code class="literal">__MSG_</code> and ends with <code class="literal">__</code> is a property that is referred from the <code class="literal">i18n</code> properties file.</p><p>The <code class="literal">height</code> of the gadget is optional and 200, by default. The images are referenced using <code class="literal">#staticResourceUrl</code> where the first argument is the fully qualified gadget module key which is of the form <code class="literal">${atlassian-plugin-key}:${module-key}</code>. In our example, the plugin key is <code class="literal">com.jtricks.gadgets</code> and the module key is <code class="literal">hello-gadget</code>.</p></li><li class="listitem" style="list-style-type: disc">Add the optional gadget directory feature inside <code class="literal">ModulePrefs</code>. This is currently supported only in JIRA:<div><pre class="programlisting">&lt;Optional feature="gadget-directory"&gt;
  &lt;Param name="categories"&gt;
    Other
  &lt;/Param&gt;
&lt;/Optional&gt;
</pre></div><a id="id985" class="indexterm"/><a id="id986" class="indexterm"/><p>In the example, we add the category as <code class="literal">Other</code>!</p><p>Other values supported for category are: <code class="literal">JIRA</code>, <code class="literal">Confluence</code>, <code class="literal">FishEye</code>, <code class="literal">Crucible</code>, <code class="literal">Crowd</code>, <code class="literal">Clover</code>, <code class="literal">Bamboo</code>, <code class="literal">Admin</code>, <code class="literal">Charts</code>, and <code class="literal">External</code> <code class="literal">Content</code>.</p></li></ul></div><p>You can add the gadget to more than one category by adding the categories within the <code class="literal">Param</code> element, each in a new line.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Include <code class="literal">Required</code> features if there are any under the XML tag <code class="literal">require</code>. A full list of supported features can be found at <a class="ulink" href="http://confluence.atlassian.com/display/GADGETDEV/Including+Features+into+your+Gadget">http://confluence.atlassian.com/display/GADGETDEV/Including+Features+into+your+Gadget</a>.</li><li class="listitem" style="list-style-type: disc">Add the <code class="literal">Locale</code> element to point to the <code class="literal">i18n</code> properties file:<div><pre class="programlisting">&lt;Locale messages="__ATLASSIAN_BASE_URL__/download/resources/com.jtricks.gadgets/i18n/messages.xml"/&gt;</pre></div><p>Here the property <code class="literal">__ATLASSIAN_BASE_URL__</code> will be automatically substituted with JIRA's configured base URL when the gadget is rendered. The path to the property file here is <code class="literal">__ATLASSIAN_BASE_URL__/download/resources/com.jtricks.gadgets</code>, where <code class="literal">com.jtricks.gadgets</code> is the Atlassian plugin key. The path to the XML file <code class="literal">/i18n/messages.xml</code> is what is defined in the resource module earlier.</p></li><li class="listitem" style="list-style-type: disc">Add User Preferences if required, using the <code class="literal">UserPref</code> element. We will omit the same in this example as the 'Hello Gadget' doesn't take any inputs from the user.</li><li class="listitem" style="list-style-type: disc">Add the <code class="literal">Content</code> for the gadget. This is where the gadget is rendered using HTML and JavaScript. In our example, we just need to provide the static text 'Hello From JTricks' and it is fairly easy.</li></ul></div><p>The entire content is wrapped within the <code class="literal">&lt; ![CDATA[</code> and <code class="literal">]]&gt;</code>, so that they won't be treated as XML tags. The following is how it looks in our example:</p><div><pre class="programlisting">&lt;Content type="html" view="profile"&gt;
  &lt; ![CDATA[ Hello From JTricks ]]&gt;
&lt;/Content&gt;</pre></div><p>Our gadget's XML is now ready and looks like the following block of code:</p><div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;Module&gt;
  &lt;ModulePrefs title="__MSG_gadget.title__" 
               title_url="__MSG_gadget.title.url__" 
               description="__MSG_gadget.description__" 
               author="Jobin Kuruvilla" 
               author_email=<a class="ulink" href="http://jobinkk@gmail.com">jobinkk@gmail.com</a> 
               screenshot='#staticResourceUrl("com.jtricks.gadgets:hello-gadget", "screenshot.png")' 
               thumbnail='#staticResourceUrl("com.jtricks.gadgets:hello-gadget", "thumbnail.png")' height="150" &gt;
    &lt;Optional feature="gadget-directory"&gt;
      &lt;Param name="categories"&gt;
        Other
      &lt;/Param&gt;
    &lt;/Optional&gt;
    &lt;Locale messages="__ATLASSIAN_BASE_URL__/download/resources/com.jtricks.gadgets/i18n/messages.xml"/&gt;
  &lt;/ModulePrefs&gt;
  &lt;Content type="html" view="profile"&gt;
    &lt; ![CDATA[ Hello From JTricks ]]&gt;
   &lt;/Content&gt;
&lt;/Module&gt;</pre></div><a id="id987" class="indexterm"/><a id="id988" class="indexterm"/></li><li class="listitem">Package the plugin, deploy it, and test it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec177"/>How it works...</h2></div></div></div><p>Once the plugin is deployed, we need to add the gadget in the JIRA dashboard. The following is how it appears in the <strong>Add Gadget</strong> screen. Note the thumbnail is the one we have in the plugin and also note that it appears in the <strong>Other</strong> section:</p><div><img src="img/1803-05-12.jpg" alt="How it works..."/></div><a id="id989" class="indexterm"/><a id="id990" class="indexterm"/><p>Once it is added, it appears as follows in the <strong>Dashboards</strong> section:</p><div><img src="img/1803-05-13.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec178"/>There's more...</h2></div></div></div><p>We can modify the look-and-feel of the gadgets by adding more HTML or gadget preferences! For example, <code class="literal">&lt;font color="red"&gt;Hello From JTricks&lt;/font&gt;</code> will make it appear in red.</p><p>We can adjust the size of the gadget using the dynamic-height feature. We should add the following under the <code class="literal">ModulePrefs</code> element:</p><div><pre class="programlisting">&lt;Require feature="dynamic-height"/&gt;</pre></div><p>We should then invoke <code class="literal">gadgets.window.adjustHeight();</code> whenever the content is reloaded. For example, we can do it in a window onload event, as shown next:</p><div><pre class="programlisting">  &lt;script type="text/javascript" charset="utf-8"&gt;
    function resize()
    {
      gadgets.window.adjustHeight();
    }
    window.onload=resize;
  &lt;/script&gt;</pre></div><a id="id991" class="indexterm"/><a id="id992" class="indexterm"/><p>The <code class="literal">gadget xml</code> file, in this case, will look like this:</p><div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;Module&gt;
    &lt;ModulePrefs title="__MSG_gadget.title__"
                 title_url="__MSG_gadget.title.url__"
                 description="__MSG_gadget.description__"
                 author="Jobin Kuruvilla"
                 author_email="jobinkk@gmail.com"
                 screenshot='#staticResourceUrl("com.jtricks.gadgets:hello-gadget", "screenshot.png")'
                 thumbnail='#staticResourceUrl("com.jtricks.gadgets:hello-gadget", "thumbnail.png")'
     height="150"&gt;
        &lt;Optional feature="gadget-directory"&gt;
            &lt;Param name="categories"&gt;Other&lt;/Param&gt;
        &lt;/Optional&gt;
  &lt;Require feature="dynamic-height"/&gt;
  &lt;Locale messages="__ATLASSIAN_BASE_URL__/download/resources/com.jtricks.gadgets/i18n/messages.xml"/&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html" view="profile"&gt;
        &lt; ![CDATA[
  &lt;script type="text/javascript" charset="utf-8"&gt;
      function resize() 
      {
    gadgets.window.adjustHeight();
      }
  window.onload=resize;
  &lt;/script&gt;
  Hello From JTricks
        ]]&gt;
    &lt;/Content&gt;
&lt;/Module&gt;</pre></div><p>The gadget should now appear as follows:</p><div><img src="img/1803-05-14.jpg" alt="There's more..."/></div><p>Note that the size is adjusted to just fit the text!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec61"/>Invoking REST services from gadgets</h1></div></div></div><a id="id993" class="indexterm"/><a id="id994" class="indexterm"/><a id="id995" class="indexterm"/><p>In the previous recipe, we saw how to write a gadget with static content. In this recipe, we will have a look at creating a gadget with dynamic content or the data that is coming from the JIRA server.</p><p>JIRA uses REST services to communicate between the gadgets and the server. We will see how to write REST services in the coming chapters. In this recipe, we will use an existing REST service.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec179"/>Getting ready</h2></div></div></div><p>Create the <strong>Hello Gadget</strong>, as described in the previous recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec180"/>How to do it...</h2></div></div></div><p>Let us consider a simple modification to the existing <strong>Hello Gadget</strong> to understand the basics of invoking REST services from gadgets. We will try to greet the current user by retrieving the user details from the server instead of displaying the static text: <strong>Hello From JTricks</strong>.</p><p>JIRA ships with some inbuilt REST methods, one of which is to retrieve the details of the current user. The method can be reached in the URL: <code class="literal">/rest/gadget/1.0/currentUser</code>. We will use this method to retrieve the current user's full name and then display it in the gadget greeting. If the user's name is <strong>Jobin Kuruvilla</strong>, the gadget will display the message as <strong>Hello, Jobin Kuruvilla</strong>.</p><p>As we are only changing the content of the gadget, the only modification is required in the gadget XML, which is <code class="literal">hello-gadget.xml</code> in our example. Only the <code class="literal">Content</code> element needs to be modified, which will now invoke the REST service and render the content.</p><a id="id996" class="indexterm"/><a id="id997" class="indexterm"/><a id="id998" class="indexterm"/><p>The following are the steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Include the common Atlassian gadget resources:<div><pre class="programlisting">#requireResource("com.atlassian.jira.gadgets:common")
#includeResources()</pre></div><p><code class="literal">#requireResource</code> will bring in the JIRA gadget JavaScript framework into the gadget's context. <code class="literal">#includeResources</code> will write out the HTML tags for the resource in place. Check out <a class="ulink" href="http://confluence.atlassian.com/display/GADGETDEV/Using+Web+Resources+in+your+Gadget">http://confluence.atlassian.com/display/GADGETDEV/Using+Web+Resources+in+your+Gadget</a> for more details.</p></li><li class="listitem">Construct a gadget object as follows:<div><pre class="programlisting">var gadget = AJS.Gadget</pre></div><p>The gadget object has four top-level options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">baseUrl</code>: An option to pass the base URL. It is a mandatory option, and we use <code class="literal">__ATLASSIAN_BASE_URL__</code> here which will be rendered as JIRA's base URL.</li><li class="listitem" style="list-style-type: disc"><code class="literal">useOauth</code>: An optional parameter. Used to configure the type of authentication which must be a URL. <code class="literal">/rest/gadget/1.0/currentUser</code> is commonly used.</li><li class="listitem" style="list-style-type: disc"><code class="literal">config</code>: Another optional parameter. Only used if there are any configuration options for the gadget.</li><li class="listitem" style="list-style-type: disc"><code class="literal">view</code>: Used to define the gadget's view.<p>In our example, we don't use authentication or any configuration options. We will just go with the <code class="literal">baseUrl</code> and <code class="literal">view</code> options. The following is how the Gadget is created using JavaScript:</p><div><pre class="programlisting">    &lt;script type="text/javascript"&gt;
      (function () {
            var gadget = AJS.Gadget({
              baseUrl: "__ATLASSIAN_BASE_URL__",
              view: {
            ...
          }
            });
      })();
    &lt;/script&gt;</pre></div></li></ul></div></li><li class="listitem">Populate the gadget view.<a id="id999" class="indexterm"/><a id="id1000" class="indexterm"/><a id="id1001" class="indexterm"/><p>The <code class="literal">view</code> object has the following properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">enableReload</code>: Optional. Used to reload the gadget at regular intervals.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onResizeReload</code>: Optional. Used to reload the gadget when the browser is resized.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onResizeAdjustHeight</code>: Optional and used along with the <code class="literal">dynamic-height</code> feature. This will adjust the gadget height when the browser is resized.</li><li class="listitem" style="list-style-type: disc"><code class="literal">template</code>: Created the actual view.</li><li class="listitem" style="list-style-type: disc"><code class="literal">args</code>: An array of objects or function that returns an array of objects. It has two attributes. <code class="literal">Key</code> –used to access the data from within the template and <code class="literal">ajaxOptions</code> – set of request options used to connect to the server and retrieve data.</li></ul></div><p>In our example, we will use the <code class="literal">template</code> and <code class="literal">args</code> properties to render the view. First, let us see <code class="literal">args</code> because we use the data retrieved here in the <code class="literal">template</code>. <code class="literal">args</code> will look like the following:</p><div><pre class="programlisting">    args: [{
      key: "user",
      ajaxOptions: function() {
        return {
          url: "/rest/gadget/1.0/currentUser"
        };
      }
    }]
    </pre></div><p>As you can see, we invoke the <code class="literal">/rest/gadget/1.0/currentUser</code> method and use the key <code class="literal">user</code> to refer the data we retrieved while rendering the view. <code class="literal">ajaxOptions</code> uses the jQuery Ajax Options, details of which can be found at <a class="ulink" href="http://api.jquery.com/jQuery.ajax#options">http://api.jquery.com/jQuery.ajax#options</a>.</p><p>The key <code class="literal">user</code> will now hold the user details from the REST method, as follows:</p><div><pre class="programlisting">UserPref name="displayName" datatype="hidden" default_value="true
{"username":"jobinkk","fullName":"Jobin Kuruvilla","email":"jobinkk@gmail.com"}</pre></div><a id="id1002" class="indexterm"/><a id="id1003" class="indexterm"/><a id="id1004" class="indexterm"/><p>The <code class="literal">template</code> function will now use this <code class="literal">args</code> object (defined earlier) and its <code class="literal">key</code>, <code class="literal">user</code> to render the view as follows:</p><div><pre class="programlisting">    template: function(args) {
      var gadget = this;
       
      var userDetails = AJS.$("&lt;h1/&gt;").text("Hello, "+args.user["fullName"]);     
      gadget.getView().html(userDetails);
    }
  </pre></div><p>Here, <code class="literal">args.user["fullName"]</code> will retrieve the user's <code class="literal">fullName</code> from the REST output. Username or e-mail can be retrieved in a similar fashion.</p><p><code class="literal">AJS.$</code> will construct the view as <code class="literal">&lt;h1&gt;Hello, Jobin Kuruvilla&lt;/h1&gt;</code>, where <code class="literal">Jobin Kuruvilla</code> is the <code class="literal">fullName</code> retrieved.</p><p>The entire <code class="literal">Content</code> section will look as shown in the following lines of code:</p><div><pre class="programlisting">    &lt;Content type="html" view="profile"&gt;
          &lt; ![CDATA[
                #requireResource("com.atlassian.jira.gadgets:common")
          #includeResources()
   
          &lt;script type="text/javascript"&gt;
      (function () {
            var gadget = AJS.Gadget({
                baseUrl: "__ATLASSIAN_BASE_URL__",
                view: {
                template: function(args) {
                 var gadget = this;       
                 var userDetails = AJS.$("&lt;h1/&gt;").text("Hello, "+args.user["fullName"]);       
                 gadget.getView().html(userDetails);
                },
                args: [{
                key: "user",
                ajaxOptions: function() {
                  return {
                    url: "/rest/gadget/1.0/currentUser"
                  };
              }
              }]
          }
          });
      })();
          &lt;/script&gt;
          ]]&gt;
        &lt;/Content&gt;</pre></div></li><li class="listitem">Package the gadget and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec181"/>How it works...</h2></div></div></div><a id="id1005" class="indexterm"/><a id="id1006" class="indexterm"/><a id="id1007" class="indexterm"/><p>After the modification to the gadget XML, the gadget will now display the method as follows:</p><div><img src="img/1803-05-14a.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec182"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing JIRA 4 gadgets</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec62"/>Configuring user preferences in gadgets</h1></div></div></div><a id="id1008" class="indexterm"/><a id="id1009" class="indexterm"/><a id="id1010" class="indexterm"/><p>In the previous two recipes, we saw how to create gadgets from static content and dynamic content. In this recipe, we will go one step further and display the gadget content, based on user input.</p><p>The user will configure the gadget during its creation, or modify it later and the gadget content will vary depending on the configuration parameters.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec183"/>Getting ready...</h2></div></div></div><p>Create the <strong>Hello Gadget</strong>, populated with dynamic content, as described in the previous recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec184"/>How to do it...</h2></div></div></div><p>In this recipe, we will let the user choose whether to display the name in the greeting message or not. There will be a property on the gadget named <code class="literal">displayName</code>. If it is set to <code class="literal">true</code>, the gadget will display the username and the greeting message will be <strong>Hello, Jobin Kuruvilla</strong>. If the <code class="literal">displayName</code> is set to false, the greeting message will be <strong>Hello</strong>!</p><p>The following are the steps to configure user preferences:</p><div><ol class="orderedlist arabic"><li class="listitem">Include the <code class="literal">setprefs</code> and the <code class="literal">views</code> features under the <code class="literal">ModulePrefs</code> element:<div><pre class="programlisting">&lt;Require feature="setprefs" /&gt;&lt;Require feature="views" /&gt;</pre></div><p><code class="literal">setprefs</code> is required to persist user preferences, whereas <code class="literal">views</code> determines whether the current user can edit the preferences or not.</p></li><li class="listitem">Include the gadget, the <code class="literal">common</code> locale, under <code class="literal">ModulePrefs</code>, along with our custom <code class="literal">Locale</code> element:<div><pre class="programlisting">#supportedLocales("gadget.common")</pre></div><p>This is required to get the gadget configuration language properly.</p></li><li class="listitem">Include the required <code class="literal">UserPref</code> elements. This element defines the various user preferences. The element supports the following fields:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: Required. Name of the user preferences. The value of this can then be accessed using <code class="literal">gadget.getPref("name")</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">display_name</code>: Display name of the field. By default, it will be the same as the name.</li><li class="listitem" style="list-style-type: disc"><code class="literal">urlparam</code>: Optional string to pass as the parameter name for content <code class="literal">type="url"</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">datatype</code>: Data type of the field. Valid options include: <code class="literal">string</code>, <code class="literal">bool</code>, <code class="literal">enum</code>, <code class="literal">hidden</code>, or <code class="literal">list</code>. Default is string.</li><li class="listitem" style="list-style-type: disc"><code class="literal">required</code>: Marks the field as required. Default is false.</li><li class="listitem" style="list-style-type: disc"><code class="literal">default_value</code>: Sets a default value.</li></ul></div><p>In our example, we add the <code class="literal">displayName</code> property as follows:</p><div><pre class="programlisting">    &lt;UserPref name="displayName" datatype="hidden" default_value="true"/&gt;</pre></div><p>The field is marked as <code class="literal">hidden</code> so that it won't appear in the OpenSocial gadget configuration form!</p></li><li class="listitem">Modify the creation of <code class="literal">AJS.Gadget</code> to include the <code class="literal">config</code> property. <code class="literal">config</code> is normally of the form:<div><pre class="programlisting">...
config: {
    descriptor: function(){...},
    args: {Function, Array}
},
... </pre></div><a id="id1011" class="indexterm"/><a id="id1012" class="indexterm"/><a id="id1013" class="indexterm"/><p>Here, <code class="literal">descriptor</code> is a function that returns a new Configuration Descriptor. <code class="literal">args</code> is an array of objects or a function that returns one similar to <code class="literal">view</code>.</p><p>In our example, we define a function to return a descriptor with the configuration details of the <code class="literal">displayName</code> property. It looks like the following:</p><div><pre class="programlisting">config: {
  descriptor: function (args) {
    var gadget = this;
    return  {
      fields: [
        {
          userpref: "displayName",
          label: gadget.getMsg("property.label"),
          description:gadget.getMsg("property.description"),
          type: "select",
          selected: gadget.getPref("displayName"),
          options:[
            {
               label:"Yes",
              value:"true"
            },
            {
              label:"No",
              value:"false"
            }
          ]
         }
      ]
     };
  }
}</pre></div><p>Here, there is only one field: <code class="literal">displayName</code>. It is of the type <code class="literal">select</code> and has a <code class="literal">label</code> and <code class="literal">description</code>, both populated from the <code class="literal">i18n</code> property file using the <code class="literal">gadget.getMsg</code> method. The <code class="literal">Selected</code> attribute is populated with the current value – <code class="literal">gadget.getPref("displayName")</code>. <code class="literal">Options</code> are given as an array, as shown in the preceding snippet.</p><p>More details on the various other field types and their properties can be found at <a class="ulink" href="http://confluence.atlassian.com/display/GADGETDEV/Field+Definitions">http://confluence.atlassian.com/display/GADGETDEV/Field+Definitions</a>.</p></li><li class="listitem">Add the new <code class="literal">i18n</code> properties to the message bundle:<div><pre class="programlisting">&lt;msg name="property.label"&gt;Display Name?&lt;/msg&gt;&lt;msg name="property.description"&gt;Example Property from J-Tricks&lt;/msg&gt;</pre></div></li><li class="listitem">Include the <code class="literal">UserPref</code> – <code class="literal">isConfigured</code>:<div><pre class="programlisting">&lt;UserPref name="isConfigured" datatype="hidden" default_value="false"/&gt;</pre></div><p>The user preferences are set every time the gadget loads, and we use this property which is specially designed to prevent this.</p><p>When this property is used, <code class="literal">AJS.gadget.fields.nowConfigured()</code> should be added as an additional field under the <code class="literal">config descriptor</code>.</p></li><li class="listitem"><a id="id1014" class="indexterm"/><a id="id1015" class="indexterm"/><a id="id1016" class="indexterm"/>Modify the view to display usernames based on the configured property.<p>The <code class="literal">template</code> function is modified as follows:</p><div><pre class="programlisting">if (gadget.getPref("displayName") == "true")
  var userDetails = AJS.$("&lt;h1/&gt;").text("Hello, "+args.user["fullName"]);
} else {
  var userDetails = AJS.$("&lt;h1/&gt;").text("Hello!");
 }  </pre></div><p>As you can see, the configured property is retrieved using <code class="literal">gadget.getPref("displayName")</code>. If it is <code class="literal">true</code>, the username is used.</p><p>The entire <code class="literal">Content</code> section now looks like the following lines of code:</p><div><pre class="programlisting">&lt;Content type="html" view="profile"&gt;
&lt; ![CDATA[#requireResource("com.atlassian.jira.gadgets:common")
#includeResources()
&lt;script type="text/javascript"&gt;
      (function () {
var gadget = AJS.Gadget({
	baseUrl: "__ATLASSIAN_BASE_URL__",
	config: {
descriptor: function (args) {
var gadget = this;
return  {
fields: [
{
userpref: "displayName",
label: gadget.getMsg("property.label"),
description:gadget.getMsg("property.description"),
type: "select",
selected: gadget.getPref("displayName"),
options:[
                    {
label:"Yes",
value:"true"
             },
                    {
label:"No",
value:"false"
                    }
                  ]
}, 
AJS.gadget.fields.nowConfigured()
                ]
};
}
	},
	view: {
template: function(args) {
var gadget = this;       
if (gadget.getPref("displayName") == "true")
              {
varuserDetails = AJS.$("&lt;h1/&gt;").text("Hello, "+args.user["fullName"]);
              } else {
varuserDetails = AJS.$("&lt;h1/&gt;").text("Hello!");
              }       
gadget.getView().html(userDetails);
},
args: [{
key: "user",
ajaxOptions: function() {
return {
url: "/rest/gadget/1.0/currentUser"
                };
              }
            }]
	}
	});
      })();
&lt;/script&gt;
]]&gt;
&lt;/Content&gt;</pre></div></li><li class="listitem">Package the gadget and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec185"/>How it works...</h2></div></div></div><a id="id1017" class="indexterm"/><a id="id1018" class="indexterm"/><a id="id1019" class="indexterm"/><p>Once the user configurable properties are added, the gadget on its creation will ask the user to configure the <code class="literal">displayName</code> property, as shown next. The default value will be <code class="literal">true</code> (label :Yes) as we configured it.</p><div><img src="img/1803-05-15.jpg" alt="How it works..."/></div><p>When <strong>Yes</strong> is selected, it appears as:</p><div><img src="img/1803-05-16.jpg" alt="How it works..."/></div><p>If you click on the gadget options now, you can see the <strong>Edit</strong> option, as shown in the following screenshot:</p><div><img src="img/1803-05-17.jpg" alt="How it works..."/></div><a id="id1020" class="indexterm"/><a id="id1021" class="indexterm"/><a id="id1022" class="indexterm"/><p>The following screenshot appears while clicking on <strong>Edit</strong>:</p><div><img src="img/1803-05-18.jpg" alt="How it works..."/></div><a id="id1023" class="indexterm"/><a id="id1024" class="indexterm"/><a id="id1025" class="indexterm"/><p>On selecting <strong>No</strong>, the message is displayed without the username, as shown in the following screenshot:</p><div><img src="img/1803-05-19.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec186"/>There's more...</h2></div></div></div><p>One of the most popular user preferences in JIRA gadgets, and therefore, worth a special mention, is its ability to auto refresh itself at a configured interval. JIRA has a pre-defined feature that helps us to do it.</p><p>There are only a couple of things you need do to implement this feature:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the <code class="literal">refresh</code> UserPref:<div><pre class="programlisting">&lt;UserPref name="refresh" datatype="hidden" default_value="false"/&gt;</pre></div></li><li class="listitem">Include the <code class="literal">enableReload: true</code> property in the <code class="literal">view</code>:<div><pre class="programlisting">view: {
  enableReload: true,
   template: function(args) {
    ...
  },
  args: [{
    ...
   }]
}</pre></div></li></ol></div><p>You will now see an extra <strong>Refresh</strong> action on the gadget properties, as shown in the next screenshot:</p><div><img src="img/1803-05-20.jpg" alt="There's more..."/></div><p>This can be used to refresh the gadget at any time.</p><a id="id1026" class="indexterm"/><a id="id1027" class="indexterm"/><a id="id1028" class="indexterm"/><p>On clicking on <strong>Edit</strong>, the automatic refresh interval can be selected, as shown in the following screenshot:</p><div><img src="img/1803-05-21.jpg" alt="There's more..."/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec187"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing JIRA 4 gadgets</em></li><li class="listitem" style="list-style-type: disc">Invoking REST services from gadgets</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec63"/>Accessing gadgets outside of JIRA</h1></div></div></div><a id="id1029" class="indexterm"/><p>We have seen how to write a gadget and add it onto the JIRA Dashboard. But have we made use of all the advantages of an OpenSocial gadget? How about adding them onto other OpenSocial containers such as Gmail<a id="id1030" class="indexterm"/> or iGoogle<a id="id1031" class="indexterm"/>?</p><p>In this recipe, we will see how to add a gadget in to Gmail. The process is pretty much similar for other containers as well.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec188"/>How to do it...</h2></div></div></div><p>The following is a quick step-by-step procedure to add a gadget to Gmail:</p><div><ol class="orderedlist arabic"><li class="listitem">Identify the Gadget URL for the gadget that we are going to add. We can find this URL from the JIRA gadgets directory, as shown in the next screenshot. In the example, we choose to add the <strong>Favourite Filters</strong> gadget:<div><img src="img/1803-05-22.jpg" alt="How to do it..."/></div></li><li class="listitem">Go to <strong>Gmail</strong> | <strong>Settings</strong> | <strong>Gadgets</strong>. Enter the URL, as shown in the next screenshot:<div><img src="img/1803-05-23.jpg" alt="How to do it..."/></div><p>Note that this is the only process that will be different for different containers. We need to enter this URL in the appropriate place for each different container.</p></li><li class="listitem"><a id="id1032" class="indexterm"/>Once added, the gadget will appear in the settings as shown in the following screenshot:<div><img src="img/1803-05-24.jpg" alt="How to do it..."/></div></li><li class="listitem">The gadget should now be available under the list of gadgets you have in your Gmail sidebars. Save the configurations. In our example, we need to choose whether to display the count of issues or not and the refresh interval.<p>Refer to the next screenshot to see how it appears in Gmail.</p></li><li class="listitem"><a id="id1033" class="indexterm"/>The gadget now shows no results because we haven't connected to JIRA with a proper username/password. Edit the gadget settings and you will see an option, <strong>Login &amp; Approve</strong>, which allows you to log in to your JIRA instance and approve the retrieval of data to be displayed in Gmail:<div><img src="img/1803-05-25.jpg" alt="How to do it..."/></div></li><li class="listitem"><a id="id1034" class="indexterm"/><strong>Approve Access</strong>, as shown in the following screenshot. The gadget should now show the results:<div><img src="img/1803-05-26.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec189"/>How it works...</h2></div></div></div><a id="id1035" class="indexterm"/><p>The way it works is identical to that of its behavior in JIRA Dashboards. The gadget will communicate with JIRA using the REST APIs and the data is rendered using the HTML and JavaScript code under the <code class="literal">view</code> section in the gadget XML's <code class="literal">Content</code> element.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec190"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Writing JIRA 4 gadgets</em></li><li class="listitem" style="list-style-type: disc"><em>Invoking REST services from gadgets</em></li></ul></div></div></div></body></html>