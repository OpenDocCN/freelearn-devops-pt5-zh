<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">CI/CD for Android with Visual Studio Team Services</h1>
                </header>
            
            <article>
                
<p>In the last chapter, we learned about continuous integration and various tools to implement it in a development life cycle. We also learned in detail about continuous integration using TeamCity as a CI tool.</p>
<p>In this chapter, we will go into more detail about continuous integration and continuous delivery using <strong>Visual Studio Team Services</strong> (<strong>VSTS</strong>) as a tool. We will be discussing all the steps that you require to set up and put VSTS to work.</p>
<p>VSTS is another tool provided by Microsoft for DevOps that works with almost any third-party DevOps chain tool in the market. It has great integration with GitHub, Jenkins, Azure, and many other similar tools for your continuous integration needs.</p>
<p>Some of the topics covered in this chapter are as follows:</p>
<ul>
<li>Creating an account in Visual Studio</li>
<li>Getting the code from GitHub</li>
<li>Creating the build definition</li>
<li>Configuring a repository</li>
<li>Queue build</li>
<li>Building with every commit</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an account in Visual Studio</h1>
                </header>
            
            <article>
                
<p>To get started with VSTS, head to your web browser and follow these steps:</p>
<ol>
<li>Open Microsoft's website at this URL: <span class="URLPACKT"><a href="https://www.visualstudio.com/team-services/">https://www.visualstudio.com/team-services/</a>.</span></li>
</ol>
<ol start="2">
<li>On the website, you'll see a <span class="packt_screen">Get started for free</span> button, as shown in the next screenshot. Click on that button:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/179a5477-0975-4b44-a2ea-556dbcec320b.png" style=""/></div>
<ol start="3">
<li>Clicking on the button will take you to the signup page, where you can log in using your existing Microsoft account:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/d8f82e9a-1a23-44e5-b68d-7367fcc2f003.png" style=""/></div>
<ol start="4">
<li>If you don't already have a Microsoft account, then you can click on the <span class="packt_screen">Create account</span> link on the same page.</li>
<li>Clicking on the <span class="packt_screen">Create account</span> link will take you to the next page, where you can choose a username and password for your account and click <span class="packt_screen">Next</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/21d17e0c-d37d-4ed5-9622-5e011d185fab.png" style=""/></div>
<ol start="6">
<li>It might ask you to verify that you are an actual person creating an account, so after completing that step, your account should be ready to use.</li>
<li>After completing the signup form, the next step is to set up the URL to host your Team Services project at <a href="https://www.visualstudio.com/"><span class="URLPACKT">https://www.visualstudio.com/</span></a>.</li>
<li>Here, you give the URL for the project hosting and select the way you will be managing your code's source version (that is, TFS or Git):</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/7cc77b55-8671-4d51-8a6a-e43c3356a16a.png" style=""/></div>
<ol start="9">
<li>We will be using Git as our source code repository to manage our project.</li>
<li>Select <span class="packt_screen">Git</span> as the code managing platform and click on the <span class="packt_screen">Continue</span> button, and the signup process is done.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting the code from GitHub</h1>
                </header>
            
            <article>
                
<p>Now that your account is created, it's time to import your code into VSTS:</p>
<ol>
<li>On the next page, you'll see different options to integrate your project from your computer, using the command line and even by initializing a new Git repository.</li>
<li>We already have our project synced on Git, so we'll be choosing the option to import a project from Git, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/40dcb7cd-5638-4175-96e9-66288b0ad16d.png"/></div>
<ol start="3">
<li>Clicking on the <span class="packt_screen">Import</span> button will open a small popup window where you can choose either Git or TFS as your source type and provide your repository URL.</li>
</ol>
<ol start="4">
<li>Please note that it will require you to give this application permission to access using your Git credentials:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ecac0952-4fef-474d-a21e-8812ab05fba3.png"/></div>
<ol start="5">
<li>After providing the repository URL and login information, click on the <span class="packt_screen">Import</span> button.</li>
<li>This will import your project from Git into the VSTS server, where you then can manage all the processes related to the DevOps life cycle.</li>
</ol>
<ol start="7">
<li>Once your code is imported, you'll be able to see all the directories and code in the code section of VSTS:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/09811256-637b-417e-9777-0f36044514e1.png"/></div>
<ol start="8">
<li>So now that your code is also imported into VSTS, it is time to create a build for the project.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the build definition</h1>
                </header>
            
            <article>
                
<p>Creating the build definition in VSTS is a straightforward and simple process. It provides you with templates for various tools to help you create build definitions.</p>
<p>Follow these steps to start creating the build definitions for your project:</p>
<ol>
<li>On the code page, click on the <span class="packt_screen">Set up build</span> button, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/808671df-20f0-4535-8134-0ebe7a27617a.png"/></div>
<ol start="2">
<li>This will take you to the next page where you can select a predefined VSTS template to use.</li>
<li>On the next page, select <span class="packt_screen">GitHub</span> or your choice of any other source versioning the build would be connecting from.</li>
<li>Give a connection name in the input box provided and click on the <span class="packt_screen">Authorize using OAuth</span> button:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/8a7aa725-8e4a-436a-8779-804bd036399c.png"/></div>
<ol start="5">
<li>A pop-up window will open; you might need to unblock the popup from the VSTS website to see it.</li>
</ol>
<ol start="6">
<li>Authorize and give VSTS OAuth permissions to access your GitHub repository:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/954645a8-4edf-43f0-a6f4-9db2610b4369.png" style=""/></div>
<ol start="7">
<li>Click on the <span class="packt_screen">Authorize vsonline</span> button to authorize and give permissions to access the account.</li>
<li>Once done, on the next step it will ask you to select the project repository and branch to take the code from:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c72a8ace-07ad-45f2-b4d9-a99a4be7e590.png"/></div>
<ol start="9">
<li>Select the project repository from the repository dropdown provided, and then the branch accordingly, and click on the <span class="packt_screen">Continue</span> button, as shown in the preceding screenshot.</li>
</ol>
<ol start="10">
<li>In this example, we are following up with the same project we developed and used as an example in previous projects, which was the Android app we developed with Xamarin.Android.</li>
<li>Now, because VSTS and Xamarin are both Microsoft tools, they have great compatibility and built-in templates.</li>
<li>So, on the next page, scroll down the list of templates until you see the <span class="packt_screen">Xamarin.Android</span> template and apply that template:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/642324c3-2a50-446d-aa40-2a19b4786664.png"/></div>
<ol start="13">
<li>Now that a template is applied, it's time to configure the build definition.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring the build definition</h1>
                </header>
            
            <article>
                
<p>VSTS has great support for the Xamarin application build process, and automatically takes all the steps you might require for the project's build configuration. But, you might need to provide some extra information for some of the build steps involved:</p>
<ol>
<li>You will see the build steps already in place on the next page in VSTS:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/26bd9280-729f-4b0a-b35b-d4d0228586c8.png"/></div>
<ol start="2">
<li>Let's stop here for a second and look at the build steps provided by VSTS, all automatically set up for you to just start the build.</li>
</ol>
<ol start="3">
<li>It's a good idea to have a brief look at the steps involved, starting from Nuget package restore, to building the packages, and finally to publishing them:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b15dc618-518c-42b4-a445-c30f2235a04c.png" style=""/></div>
<ol start="4">
<li>Here we need to provide some information related to our Xamarin Test Cloud account so VSTS can run Test Cloud tests there.</li>
</ol>
<ol start="5">
<li>Click on the <span class="packt_screen">Test</span> step on the left-hand side of the screen. It will highlight the required information fields on the right-hand side of the screen:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/2675611a-88af-46af-a3fb-410d1c20bcd6.png"/></div>
<ol start="6">
<li>You'll have to use the team API key from your Xamarin Test Cloud account and the user email under which you would like the build to run, and also the devices you would like the tests to run on.</li>
<li>Let's go back and log in to Xamarin Test Cloud, then go to <span class="packt_screen">Account settings</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/1bef3879-a71c-47ba-bc4f-f2995b9334b3.png" style=""/></div>
<ol start="8">
<li>Click on <span class="packt_screen">Account settings</span> and there you need to go to the <span><span class="packt_screen">Teams &amp; Apps</span></span> section to get the API and other required details.</li>
<li>In the <span class="packt_screen">Accounts settings</span>, click on the <span class="packt_screen">Teams &amp; Apps</span> link from the left pane which will open the <span class="packt_screen">Teams &amp; Apps</span> section:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/8ae002d2-e8a7-4c36-94cb-ac995629e5ce.png"/></div>
<ol start="10">
<li>As shown in the preceding screenshot, the team we had created to run the tests is visible.</li>
<li>In that <span><span class="packt_screen">Teams &amp; Apps</span></span> section, there will be a link to <span class="packt_screen">show API key</span>, as shown in the preceding screenshot.</li>
<li>Click on that same link to see the API key for the team defined, and note it down:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b26eb3b5-6e75-487a-a2bc-d79d7283fd8c.png" style=""/></div>
<ol start="13">
<li>Then, click on the gear icon to get the team members' details and their emails:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/86c3fb35-c817-41ea-8c05-af20ca7d94d8.png"/></div>
<ol start="14">
<li>Make sure you note the user credentials that have all the permissions required to run the tests.</li>
<li>Copy the email of the user and note it down.</li>
<li>The last value required is the devices string; this string stores information about the list of devices to run the Xamarin Tests on.</li>
</ol>
<ol start="17">
<li>The devices string can be found as the value of the <kbd>-devices</kbd> command line argument of a Test Cloud test run as described in previous chapters:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/7b5573a4-6140-438b-8800-68887c849417.png" style=""/></div>
<ol start="18">
<li>Now that we have all the values required, let's get back to the build configuration steps and put the values in.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Queue build</h1>
                </header>
            
            <article>
                
<p>All the configurations are done, and now we can save the configuration and queue the build:</p>
<ol>
<li>Once the preceding steps are completed, click on the <span class="packt_screen">Save &amp; queue</span> button at the top of the build configuration page:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/5ecb31ca-da8f-4846-950d-d043958350e3.png" style=""/></div>
<ol start="2">
<li>Give your name to the build and commit comments, and click <span class="packt_screen">Save &amp; queue</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/fb06102a-297d-48ed-92d8-c3b8bdf30a32.png"/></div>
<ol start="3">
<li>Once the build is saved and queued, you'll get a small notification, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/f659a053-6dfb-40c8-add8-0f605aca0e30.png"/></div>
<ol start="4">
<li>Congratulations, you have now successfully completed the build configuration and queued the build for execution.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Triggers - build with every commit</h1>
                </header>
            
            <article>
                
<p>Now we have covered how to configure the build steps and queue them manually. In continuous integration, it is important to automate the build, especially whenever developers check code in. This helps keep the latest build up to date with all the changes made and lets developers know of any issues in the build at earlier stages of development.</p>
<p>Follow these steps now to set up triggers and automate the build:</p>
<ol>
<li>Click on the <span class="packt_screen">Triggers</span> tab in the configurations section shown in previous steps:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/cf8d1552-875c-4de0-a79a-b25420bbd0be.png"/></div>
<ol start="2">
<li>In the <span class="packt_screen">Triggers</span> tab, in the left pane, you'll see a section for <span class="packt_screen">Continuous integration</span>, under which you will find your repository linked.</li>
<li>Click on that link to open the continuous integration section on the right-hand side:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/0141f42e-ecfa-44c3-bdb2-07909fe744d3.png" style=""/></div>
<ol start="4">
<li>Check the <span class="packt_screen">Enable continuous integration</span> box.</li>
<li>You'll notice there is one more checkbox, to <span class="packt_screen">Batch changes while build in progress</span>. This option is useful when you have many developers frequently checking in changes to a repository. Checking this option will batch the new changes in the repository while a build is already in process, queue further changes in a batch until the build completes, and then queue a new build for those changes.</li>
<li>The following are the integration checkboxes; you'll see options to select specific branches to include in the build. You can also exclude some branches specifically, as per your requirements:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/14f5cb9c-7b4c-4fa9-baae-3811d1b8ae8f.png" style=""/></div>
<ol start="7">
<li>Once the changes are done, you can save the build definition and now the build is part of our continuous integration process, which will:
<ul>
<li>Start building your project with every check-in or in batches, as per your configurations</li>
<li>Run tests on Xamarin Test Cloud</li>
<li>Sign and zipalign the project's APK file</li>
<li>Publish your app</li>
</ul>
</li>
</ol>
<p>All these steps will be performed as part of your build configuration, with everything automated.</p>
<p>Now, all developers need to worry about is writing quality code, and they can get their code tested in real time on real devices using Microsoft's CI tools and get them published with every build.</p>
<p>This helps quality app development with quicker feedback and a continuous workflow between all the stages of development.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed continuous integration using VSTS, a great tool for CI needs if you use a lot of Microsoft tools in your development life cycle, especially Xamarin. We learned how to configure build steps in VSTS and integrate the Xamarin Test Cloud Teams API for continuous testing, and at the end, we set up triggers for continuous builds.</p>
<p>In the next chapter, we'll discuss deploying and migrating your applications to the cloud.</p>


            </article>

            
        </section>
    </body></html>