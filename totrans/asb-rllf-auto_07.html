<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-125"><a id="_idTextAnchor125"/>7</h1>
<h1 id="_idParaDest-126"><a id="_idTextAnchor126"/>Managing Your Virtualization and Cloud Platforms</h1>
<p>Since the introduction of virtualization and cloud computing, organizations can handle their IT infrastructure using programmatic methods since most of the IT components are software-defined, such as <strong class="bold">software-defined data centers</strong> (<strong class="bold">SDDC</strong>), <strong class="bold">software-defined storage</strong> (<strong class="bold">SDS</strong>), <strong class="bold">software-defined networking</strong> (<strong class="bold">SDN</strong>), and others. But this additional layer of technologies also made infrastructure management more complex as engineers need to handle both the underlying infrastructure and the overcloud virtual components. </p>
<p>Ansible can help you automate both the underlying cloud infrastructure as well as the overcloud virtual components such as the automated cluster configurations of virtualization platforms (VMware, OpenStack, Red Hat Virtualization, and others). It can also help you provision virtual components such as virtual machines, virtual networks, and virtual storage.</p>
<p>In this chapter, we will cover the following topics: </p>
<ul>
<li>Introduction to Infrastructure as Code</li>
<li>Managing cloud platforms using Ansible </li>
<li>Automating VMware vSphere resources using Ansible</li>
<li>Using Ansible as an IaC tool for AWS</li>
<li>Creating resources in GCP using Ansible</li>
</ul>
<p>First, you will learn how to configure the necessary authentication and provision resources in virtualization platforms such as VMware vCenter and public cloud platforms such as GCP and AWS.</p>
<h1 id="_idParaDest-127"><a id="_idTextAnchor127"/>Technical requirements</h1>
<p>The following are the technical requirements for this chapter:</p>
<ul>
<li>A Linux machine for the Ansible control node (with internet access)</li>
<li>Knowledge of managing cloud platforms (VMware, GCP, and AWS)</li>
<li>Access to the VMware vCenter console and API (for the VMware use case)</li>
<li>Access to the AWS console and API</li>
<li>Access to the GCP console and API</li>
</ul>
<p>All the Ansible code, playbooks, commands, and snippets for this chapter can be found in this book’s GitHub repository at <a href="https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-07">https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-07</a>.  </p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor128"/>Introduction to Infrastructure as Code</h1>
<p><strong class="bold">Infrastructure as Code</strong> (<strong class="bold">IaC</strong>) is a <a id="_idIndexMarker403"/>method that’s used to provision and manage infrastructure details and configurations as software code and make changes inside the code instead of changing the infrastructure whenever required. There are many dedicated tools and software for IaC, including Ansible. Instead of manually deploying the infrastructure components, such as virtual machines, storage, network, policies, and so on, it is possible to develop IaC and use tools to deploy the infrastructure automatically. The following diagram shows some typical IaC components regarding the following:</p>
<ul>
<li>Infrastructure component details will be stored as code in a specific format (for example, YAML playbooks).</li>
<li>IaC tools (for example, Ansible) will create and manage the infrastructure component in the private or public cloud based on the infrastructure code:</li>
</ul>
<div><div><img alt="Figure 7.1 – Typical Infrastructure as Code components " height="741" src="img/B18383_07_01.jpg" width="1169"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Typical Infrastructure as Code components</p>
<p>In the next sections, you<a id="_idIndexMarker404"/> will learn how to use Ansible as an IaC tool for deploying and managing infrastructure in private and public cloud platforms. </p>
<h1 id="_idParaDest-129"><a id="_idTextAnchor129"/>Managing cloud platforms using Ansible </h1>
<p>As you learned<a id="_idIndexMarker405"/> in the previous chapters, Ansible can manage both Linux, Windows, and network devices. But virtualization platforms work differently and you cannot use SSH-based connections and operations to automate such platforms. Most of these platforms offer <strong class="bold">application programming interface</strong> (<strong class="bold">API</strong>) and <strong class="bold">software development kit</strong> (<strong class="bold">SDK</strong>)-based access to help us access and control such platforms over HTTP (or HTTPS). Since Ansible can use SDK (Python libraries) and communicate over HTTP/HTTPS, it is possible to automate any platforms that offer such access.</p>
<p>The following diagram shows the different connection methods used by Ansible to communicate<a id="_idIndexMarker406"/> with the managed devices and platforms:</p>
<div><div><img alt="Figure 7.2 – Ansible connection methods " height="805" src="img/B18383_07_02.jpg" width="1118"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Ansible connection methods</p>
<p class="callout-heading">Application Programming Interface</p>
<p class="callout">An API is a connection or protocol that allows one system to communicate with another using a dedicated set of instructions and results. Unlike command-line utilities, which are meant for human interaction with the system, API-based access can help automate and control such systems programmatically and in a controlled way. Read more about APIs at <a href="https://en.wikipedia.org/wiki/API">https://en.wikipedia.org/wiki/API</a>.</p>
<p>Ansible has hundreds of modules (refer to <em class="italic">Figure 7.3</em>) and plugins that support cloud automation and they are available as collections for specific cloud or virtualization platforms. With these modules, it is possible to create and manage cloud resources such as virtual <a id="_idIndexMarker407"/>machines, virtual private networks, virtual disks, access policies, serverless components, containers, and more: </p>
<div><div><img alt="Figure 7.3 – Ansible cloud modules " height="713" src="img/B18383_07_03.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Ansible cloud modules</p>
<p>Find the full list of cloud modules at <a href="https://docs.ansible.com/ansible/2.9/modules/list_of_cloud_modules.xhtml">https://docs.ansible.com/ansible/2.9/modules/list_of_cloud_modules.xhtml</a> (for Ansible 2.9). Since the introduction of Ansible collections, these modules have been migrated to the respective cloud collections. Check out the collection pages in Ansible Galaxy (<a href="https://galaxy.ansible.com">https://galaxy.ansible.com</a>) to see all the plugins, roles, and playbooks that are part of the Ansible content collection. For example, the following screenshot shows the Ansible collection page of the VMware collection by the community (<a href="https://galaxy.ansible.com/community/vmware">https://galaxy.ansible.com/community/vmware</a>):</p>
<div><div><img alt="Figure 7.4 – Ansible VMware collection " height="539" src="img/B18383_07_04.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Ansible VMware collection</p>
<p>Search for<a id="_idIndexMarker408"/> the collection in Ansible Galaxy and use the appropriate collection either from the community or from the vendors themselves. The following screenshot shows the search result for the <code>aws</code> collection in the Ansible Galaxy portal:</p>
<div><div><img alt="Figure 7.5 – AWS collection result in Ansible Galaxy " height="386" src="img/B18383_07_05.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – AWS collection result in Ansible Galaxy</p>
<p>By exploring the Ansible Galaxy portal, you will find thousands of contributions from the community and vendors. By using Ansible collections, it is possible to save playbook development time by using existing roles, modules, and playbooks from existing collections.</p>
<p>In the next section, you will learn how to manage VMware using Ansible by using connection methods, modules, and more.</p>
<h1 id="_idParaDest-130"><a id="_idTextAnchor130"/>Automating VMware vSphere resources using Ansible</h1>
<p>We will start with <a id="_idIndexMarker409"/>some simple automation use cases for VMware, such as provisioning of virtual machines, managing <code>community.vmware</code>) contains around 150 modules and other plugins:</p>
<div><div><img alt="Figure 7.6 – Ansible VMware collection by the community " height="219" src="img/B18383_07_06.jpg" width="1048"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 – Ansible VMware collection by the community</p>
<p>The <code>community.vmware</code> collection relies on the <code>pyvmomi</code> and <code>community.vmware</code> collection, you<a id="_idIndexMarker411"/> need to install appropriate packages for Ansible to use it.</p>
<p>VMware has already introduced<a id="_idIndexMarker412"/> the <code>vmware.vmware_rest</code>) to manage the operations using a REST API instead of Python libraries and SDKs. <code>vmware.vmware_rest</code> contains around 130 modules and other plugins:</p>
<div><div><img alt="Figure 7.7 – Ansible VMware REST API collection by VMware " height="548" src="img/B18383_07_07.jpg" width="1074"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – Ansible VMware REST API collection by VMware</p>
<p>Use any of these <a id="_idIndexMarker413"/>Ansible collections, depending on your vSphere version and module requirements.</p>
<p class="callout-heading">VMware Ansible Collections</p>
<p class="callout">The Ansible VMware community collection based on the Python library is available at <a href="https://galaxy.ansible.com/community/vmware">https://galaxy.ansible.com/community/vmware</a>. The collection based on the REST API is available at <a href="https://galaxy.ansible.com/vmware/vmware_rest">https://galaxy.ansible.com/vmware/vmware_rest</a>.</p>
<h2 id="_idParaDest-131"><a id="_idTextAnchor131"/>Ansible VMware automation prerequisites</h2>
<p>To use the<a id="_idIndexMarker414"/> VMware collection, you need to meet the following requirements:</p>
<ul>
<li>Install the Ansible VMware collection.</li>
<li>Install the required libraries.</li>
</ul>
<p class="callout-heading">VMware vCenter Lab</p>
<p class="callout">If you do not have access to a VMware lab to test and practice, then get an evaluation copy of VMware vSphere (<a href="https://customerconnect.vmware.com/en/web/vmware/evalcenter?p=vsphere-eval-7">https://customerconnect.vmware.com/en/web/vmware/evalcenter?p=vsphere-eval-7</a>) and install it on your home server. Refer to <em class="italic">How to Install VMware vSphere Hypervisor ESXi</em> (<a href="https://www.techbeatly.com/how-to-install-vmware-vsphere-hypervisor-esxi">https://www.techbeatly.com/how-to-install-vmware-vsphere-hypervisor-esxi</a>) and <em class="italic">How to Install VMware vCenter Server Appliance</em> (<a href="https://www.techbeatly.com/how-to-install-vmware-vcenter-server-appliance">https://www.techbeatly.com/how-to-install-vmware-vcenter-server-appliance</a>) to set up a VMware home lab.</p>
<h3>Installing an Ansible VMware collection</h3>
<p>Use the <code>ansible-galaxy</code> command <a id="_idIndexMarker415"/>to install a collection. By default, <code>ansible-galaxy</code> will store the collection’s content in the <code>HOME_DIRECTORY/.ansible/collections</code> path. It is a best practice to store the collection in a project directory instead of a home directory to avoid any dependency issues. Configure the collection path in <code>ansible.cfg</code>, as follows:</p>
<div><div><img alt="Figure 7.8 – ansible.cfg with collection_paths " height="270" src="img/B18383_07_08.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.8 – ansible.cfg with collection_paths</p>
<p>When you execute the <code>ansible-galaxy</code> command, the collection will be downloaded and stored in the project directory as per the configuration, as shown in the following screenshot (refer to the <strong class="bold">VMware Ansible collections</strong> page at <a href="http://galaxy.ansible.com">galaxy.ansible.com</a> to see the installation command; refer to the previous information box to find the link):</p>
<div><div><img alt="Figure 7.9 – Installing the VMware collection " height="328" src="img/B18383_07_09.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.9 – Installing the VMware collection</p>
<p>Verify the<a id="_idIndexMarker416"/> collection’s details using the <code>ansible-galaxy collection list</code> command, as follows:</p>
<div><div><img alt="Figure 7.10 – Listing the installed collections " height="378" src="img/B18383_07_10.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.10 – Listing the installed collections</p>
<p>If you have installed the Ansible community package, then the default collection will be there as part of Python’s <code>site-packages</code>. The latest collection that’s been installed inside your custom collection directory can be seen in the preceding screenshot.</p>
<h3>Installing the required Python libraries</h3>
<p>The list of required <a id="_idIndexMarker417"/>Python libraries and SDKs will be stored inside the <code>requirements.txt</code> file in the collection folder, as shown here:</p>
<div><div><img alt="Figure 7.11 – Collection dependencies in requirements.txt " height="194" src="img/B18383_07_11.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.11 – Collection dependencies in requirements.txt</p>
<p>Use the <code>pip install</code> command to install all the dependencies for the Ansible collection, as follows:</p>
<div><div><img alt="Figure 7.12 – Installing the requirements for the collection " height="114" src="img/B18383_07_12.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.12 – Installing the requirements for the collection</p>
<p>If you are <a id="_idIndexMarker418"/>using Python virtual environments for Ansible, then remember to activate the appropriate virtual environment and install the necessary libraries inside the Python virtual environment.</p>
<p class="callout-heading">Automation Execution Environments</p>
<p class="callout">Red Hat Ansible Tower used Python virtual environments to handle dependencies such as Python<a id="_idIndexMarker419"/> libraries, collections, and so on. In <code>ansible-core</code>, and the required collections. Refer to <a href="https://www.ansible.com/products/execution-environments">https://www.ansible.com/products/execution-environments</a> for more details. Learn how to build new execution environments (container images) using the <code>ansible-builder</code> utility (<a href="https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.xhtml</a>).</p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor132"/>Provisioning VMware virtual machines in Ansible</h2>
<p>In this <a id="_idIndexMarker420"/>exercise, you will create Ansible content to provision virtual machines in a VMware cluster. </p>
<p>You must have the following configurations and details in place before proceeding with this exercise:</p>
<ul>
<li>A virtual machine template in VMware vCenter (Linux or Windows)</li>
<li>A default user account inside the virtual machine template to access new virtual machines once provisioned</li>
<li>A VMware vCenter username and password with adequate access to create and manage resources in the cluster</li>
<li>Details of the data center, cluster, datastore, and folder to save the VM in</li>
</ul>
<p>Ensure the appropriate permissions are in place by logging into VMware vCenter and creating some test machines using the VMware VM template. Once you have confirmed the access and permissions, start developing Ansible artifacts for VMware VM provisioning.</p>
<h3>Creating Ansible automation artifacts for VM provisioning</h3>
<p>You need to<a id="_idIndexMarker421"/> declare and pass a few variables for the vCenter access and VM creation. Keep these variables inside the playbook or in a separate file. Follow these steps:</p>
<ol>
<li>Store the vCenter credentials inside your Ansible Vault file – that is, <code>vars/vmware-credential.yaml</code>:</li>
</ol>
<div><div><img alt="Figure 7.13 – Creating an Ansible Vault file for your VMware credentials " height="245" src="img/B18383_07_13.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.13 – Creating an Ansible Vault file for your VMware credentials</p>
<ol>
<li value="2">Add the VMware vCenter username and password inside the file and save the vault file:<pre>vcenter_username: yourvmwareadmin
vcenter_password: yoursecretpassword</pre></li>
</ol>
<p>Remember the vault password as you will need this while executing the playbook.</p>
<ol>
<li value="3">Create <a id="_idIndexMarker422"/>another variable file called <code>vars/common-vars.yml</code> for storing details about the new virtual machine (refer to <code>Chapter-07</code> in this book’s GitHub repository for more details):</li>
</ol>
<div><div><img alt="Figure 7.14 – Variables for the VMware cluster and VM " height="565" src="img/B18383_07_14.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.14 – Variables for the VMware cluster and VM</p>
<p>It is possible to add multiple VM details inside and loop the task. However, we only covered using a single VM here. </p>
<ol>
<li value="4">Create a role for virtual machine provisioning by using the <code>ansible-galaxy role init</code> command, as follows:</li>
</ol>
<div><div><img alt="Figure 7.15 – Initializing a new role using the ansible-galaxy role init command " height="219" src="img/B18383_07_15.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.15 – Initializing a new role using the ansible-galaxy role init command</p>
<ol>
<li value="5">Add<a id="_idIndexMarker423"/> the necessary tasks to <code>roles/vmware-provision-vm-from-template/tasks/main.yml</code>:</li>
</ol>
<div><div><img alt="Figure 7.16 – main.yaml with a subtasks file " height="300" src="img/B18383_07_16.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.16 – main.yaml with a subtasks file</p>
<p><code>tasks/main.yml</code> contains two tasks for calling the subtasks file. The first task does a pre-check to ensure a VM with the same name does not exist before you proceed with VM creation. If one doesn’t exist, then the next task will be executed based on the <code>when: vm_check.failed</code> condition. This is a best practice as you need to add all possible validations and error handling inside the playbook.</p>
<ol>
<li value="6">Create the necessary content for <code>roles/vmware-provision-vm-from-template/tasks/vmware-provisioning-pre-check.yaml</code>. Also, display a message if the virtual machine already exists:</li>
</ol>
<div><div><img alt="Figure 7.17 – vmware-provisioning-pre-check.yaml " height="565" src="img/B18383_07_17.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.17 – vmware-provisioning-pre-check.yaml</p>
<ol>
<li value="7">Create <code>roles/vmware-provision-vm-from-template/tasks/vmware-provisioning-task.yaml</code> and add a task to create<a id="_idIndexMarker424"/> a new VMware VM (refer to this book’s GitHub repository for the full code), as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 7.18 – VMware VM creation task file " height="618" src="img/B18383_07_18.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.18 – VMware VM creation task file</p>
<ol>
<li value="8">It is a best <a id="_idIndexMarker425"/>practice to keep the default values of variables in <code>roles/vmware-provision-vm-from-template/defaults/main.yml</code> and pass the actual values while executing the playbook:</li>
</ol>
<div><div><img alt="Figure 7.19 – Default variable for the VMware role " height="219" src="img/B18383_07_19.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.19 – Default variable for the VMware role</p>
<ol>
<li value="9">Create the main playbook, <code>Chapter-07/vmware-provision-vm-from-template.yml</code>. Since the execution happens on a local machine for API and HTTP-based platforms, make sure <code>hosts: localhost</code> has been configured, as follows:</li>
</ol>
<div><div><img alt="Figure 7.20 – The main playbook to create the VMware infrastructure " height="741" src="img/B18383_07_20.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.20 – The main playbook to create the VMware infrastructure</p>
<p>It is <a id="_idIndexMarker426"/>possible to keep the variables under <code>group_vars</code> or <code>host_vars</code> as needed. However, here we have used a variable file approach to demonstrate this use case easily.</p>
<p>In the preceding snippet, the <code>ansible.builtin.wait_for</code> module is being used to wait for the newly created virtual machine to come online with SSH. We used the IP address of the virtual machine, port <code>22</code> (SSH), and instructed Ansible to wait for some period (<code>vm_wait_for_ssh_time</code>). Refer to <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/wait_for_module.xhtml">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/wait_for_module.xhtml</a> to learn more about the <code>wait_for</code> module.</p>
<ol>
<li value="10">Once the VM is up and running, add the new VM to a dynamic host group, <code>vmwarenewvms</code>, for post-provisioning tasks, as shown here:</li>
</ol>
<div><div><img alt="Figure 7.21 – Adding the newly created VM to the Ansible inventory " height="484" src="img/B18383_07_21.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.21 – Adding the newly created VM to the Ansible inventory</p>
<p>Instead of <a id="_idIndexMarker427"/>adding hosts, it is possible to use the dynamic inventory plugin for VMware to detect the newly created virtual machines and use them in the next set of tasks. Refer to <a href="https://docs.ansible.com/ansible/latest/collections/community/vmware/vmware_vm_inventory_inventory.xhtml">https://docs.ansible.com/ansible/latest/collections/community/vmware/vmware_vm_inventory_inventory.xhtml</a> for more details. Also, refer to <a href="B18383_05.xhtml#_idTextAnchor086"><em class="italic">Chapter 5</em></a>, <em class="italic">Expanding Your Automation Landscape</em>, the <em class="italic">Ansible dynamic inventory</em> section, to learn how to use an Ansible dynamic inventory with AWS.</p>
<ol>
<li value="11">Create another play in the same Ansible playbook to execute the post-provisioning tasks such as creating new users, configuring system files, and installing new packages, as shown here:</li>
</ol>
<div><div><img alt="Figure 7.22 – Second play in the playbook for post-provisioning tasks " height="749" src="img/B18383_07_22.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.22 – Second play in the playbook for post-provisioning tasks</p>
<p>When you <a id="_idIndexMarker428"/>use Ansible Automation Controller (part of Ansible Automation Platform) or Ansible AWX, it is possible to split the playbook into multiple job templates and create job workflows, as shown in the following diagram:</p>
<div><div><img alt="Figure 7.23 – Workflow templates (source: docs.ansible.com) " height="165" src="img/B18383_07_23.jpg" width="766"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.23 – Workflow templates (source: docs.ansible.com)</p>
<p>You will learn about workflow job templates and Ansible Automation Controller in <a href="B18383_12.xhtml#_idTextAnchor213"><em class="italic">Chapter 12</em></a>, <em class="italic">Integrating Ansible with Your Tools</em>. Refer to <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/workflows.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/workflows.xhtml</a> to learn more about workflow templates.</p>
<ol>
<li value="12">Execute the <code>ansible-playbook vmware-provision-vm-from-template.yml</code> playbook with <code>--ask-vault-password</code> and provide the vault password, as follows:</li>
</ol>
<div><div><img alt="Figure 7.24 – Executing the playbook to create the VMware VM " height="140" src="img/B18383_07_24.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.24 – Executing the playbook to create the VMware VM</p>
<p>Add more tasks <a id="_idIndexMarker429"/>to the post-provisioning section to automate the VM configuration workflows and make it a single workflow for end-to-end VM provisioning. In the next section, you will learn about cloud management for <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>) and how to use Ansible as an IaC tool.</p>
<p class="callout-heading">Create a Template in the vSphere Client</p>
<p class="callout">Refer to <a href="https://docs.vmware.com/en/VMware-vSphere/6.0/com.vmware.vsphere.hostclient.doc/GUID-40BC4243-E4FA-4A46-8C8B-F50D92C186ED.xhtml">https://docs.vmware.com/en/VMware-vSphere/6.0/com.vmware.vsphere.hostclient.doc/GUID-40BC4243-E4FA-4A46-8C8B-F50D92C186ED.xhtml</a> for VMware template creation procedures.</p>
<h1 id="_idParaDest-133"><a id="_idTextAnchor133"/>Using Ansible as an IaC tool for AWS</h1>
<p>In this section, you<a id="_idIndexMarker430"/> will create Ansible content to provision and manage AWS resources using Ansible. Let’s assume that whenever you need to create a new EC2 instance, you need to follow multiple manual procedures such as creating a new <strong class="bold">Virtual Private Cloud</strong> (<strong class="bold">VPC</strong>), a<a id="_idIndexMarker431"/> new security group, network access policies, and many other items. You also need to do post-provisioning steps such as creating new user accounts, installing packages, configuring applications, and more. </p>
<p>With the<a id="_idIndexMarker432"/> help of the Ansible AWS collection, it is possible to automate all of these tasks and manage the entire life cycle of the infrastructure.</p>
<h3>AWS Free Tier</h3>
<p>To practice <a id="_idIndexMarker433"/>AWS and Ansible use cases, it is possible to use AWS Free Tier, which provides more than 100 AWS resources free of charge. Visit <a href="https://aws.amazon.com/free">https://aws.amazon.com/free</a> (<em class="italic">Figure 7.25</em>) and sign up for a free AWS Free Tier account to find them:</p>
<div><div><img alt="Figure 7.25 – AWS Free Tier access with more than 100 services " height="809" src="img/B18383_07_25.jpg" width="1234"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.25 – AWS Free Tier access with more than 100 services</p>
<p>It is important to ensure that your AWS resource usage is within the AWS Free Tier limit to avoid the credit or debit card connected with your account being billed. Refer to <a href="https://aws.amazon.com/aws-cost-management/aws-budgets/">https://aws.amazon.com/aws-cost-management/aws-budgets/</a> to learn how to configure budget alerts and other billing details for your AWS account.</p>
<p>I have ensured<a id="_idIndexMarker434"/> that the following demonstration only uses the AWS Free Tier-based resources so that no additional costs will be incurred to your AWS Free Tier account. But it is also important to delete the resource from the AWS account once you have finished testing.</p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor134"/>Installing the Ansible AWS collection</h2>
<p>As you<a id="_idIndexMarker435"/> learned in the previous section, it is possible to use the <code>ansible-galaxy</code> command to install the Ansible AWS collection. If you need multiple collections for the project, then create a <code>requirements.yaml</code> file and mention the required collections and roles inside it:</p>
<div><div><img alt="Figure 7.26 – The requirements.yaml file with collection details " height="592" src="img/B18383_07_26.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.26 – The requirements.yaml file with collection details</p>
<p>Once <code>requirements.yaml</code> has been updated, install the collection using the <code>ansible-galaxy</code> command by calling the <code>requirements.yaml</code> file:</p>
<div><div><img alt="Figure 7.27 – Installing the collection using requirements.yaml " height="114" src="img/B18383_07_27.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.27 – Installing the collection using requirements.yaml</p>
<p>The collection will be installed in the <code>Chapter-07/collections</code> path that you configured <a id="_idIndexMarker436"/>in <code>ansible.cfg</code>. Verify the collection, as follows:</p>
<div><div><img alt="Figure 7.28 – Ansible collection list " height="404" src="img/B18383_07_28.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.28 – Ansible collection list</p>
<p>The Ansible collection for AWS automation is now ready to use. Now, start developing your Ansible playbook. </p>
<h2 id="_idParaDest-135"><a id="_idTextAnchor135"/>Creating Ansible IaC content for the AWS infrastructure</h2>
<p>In this scenario, two<a id="_idIndexMarker437"/> web servers will be installed with website content and configured to serve<a id="_idIndexMarker438"/> behind an <strong class="bold">elastic load balancer</strong> (<strong class="bold">ELB</strong>), as shown in the following diagram:</p>
<div><div><img alt="Figure 7.29 – Build a web server infrastructure and application " height="641" src="img/B18383_07_29.jpg" width="764"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.29 – Build a web server infrastructure and application</p>
<p>Multiple roles <a id="_idIndexMarker439"/>can be created to handle multiple resources in this Ansible automation content, as shown in the following screenshot:</p>
<div><div><img alt="Figure 7.30 – Ansible roles for managing cloud platforms " height="512" src="img/B18383_07_30.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.30 – Ansible roles for managing cloud platforms</p>
<p>Check out the <code>amazon.aws</code> collection document (<a href="https://galaxy.ansible.com/amazon/aws">https://galaxy.ansible.com/amazon/aws</a>), to <a id="_idIndexMarker440"/>see the Python library requirements for installing the <code>boto</code> and <code>boto3</code> Python libraries. You learned how to do this in <a href="B18383_05.xhtml#_idTextAnchor086"><em class="italic">Chapter 5</em></a>, <em class="italic">Expanding Your Automation Landscape</em>. Please refer to this chapter to learn how to configure the AWS credential for this automation job.</p>
<h3>Creating a variable for the AWS environment</h3>
<p>Details <a id="_idIndexMarker441"/>about the AWS region, VPC, and subnets are stored in the <code>Chapter-07/vars/aws-common-vars.yml</code> file (refer to the course repository on GitHub):</p>
<div><div><img alt="Figure 7.31 – AWS-related variables in vars/aws-common-vars.yml " height="484" src="img/B18383_07_31.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.31 – AWS-related variables in vars/aws-common-vars.yml</p>
<p>Once the <a id="_idIndexMarker442"/>details about the AWS cloud have been stored in a variable, you must create a variable to store the EC2 instance details.</p>
<h3>Default VPC in AWS</h3>
<p>A default VPC<a id="_idIndexMarker443"/> will be present in each AWS region when you start using AWS VPC, which comes with the following resources:</p>
<ul>
<li>Subnets (public) in each <strong class="bold">Availability Zone</strong> (<strong class="bold">AZ</strong>)</li>
<li>An internet gateway</li>
<li>DNS resolution</li>
</ul>
<p>In this demonstration, we will use the <code>amazon.aws.ec2_vpc_net</code> Ansible module. Refer to the official documentation (<a href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.xhtml">https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.xhtml</a>) to learn more.</p>
<h3>Listing the EC2 instances</h3>
<p>Details about<a id="_idIndexMarker444"/> the new EC2 instances are stored in the <code>vars/aws-ec2-new.yml</code> file:</p>
<div><div><img alt="Figure 7.32 – New EC2 details in the variable file " height="460" src="img/B18383_07_32.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.32 – New EC2 details in the variable file</p>
<p>The number<a id="_idIndexMarker445"/> of EC2 instances can be controlled in this variable as you will be using a loop to provision them. Now, you must configure the AWS security group variables.</p>
<h3>Creating an AWS security group</h3>
<p>Use <a id="_idIndexMarker446"/>the <code>amazon.aws.ec2_group</code> module to create a new security group with the required rules in <code>roles/aws-create-sg/tasks/main.yml</code>, as shown here:</p>
<div><div><img alt="Figure 7.33 – Security group task " height="618" src="img/B18383_07_33.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.33 – Security group task</p>
<p>If your <a id="_idIndexMarker447"/>application is serving over different ports, add the ports accordingly and adjust the playbook as needed. Once you’ve done this, you must create the SSH key pair task.</p>
<h3>Creating the SSH key pair</h3>
<p>A new<a id="_idIndexMarker448"/> key can be created using the <code>amazon.aws.ec2_key</code> module. A local key pair (<code>~/.ssh/id_rsa.pub</code>) will be used for this in <code>roles/aws-create-keypair/tasks/main.yml</code>:</p>
<div><div><img alt="Figure 7.34 – Creating the SSH key resource " height="300" src="img/B18383_07_34.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.34 – Creating the SSH key resource</p>
<p>This key pair is important as you will need it later to access the EC2 instances and configure web servers and other details. In the preceding code block, we used an existing SSH key pair on the workstation (<code>~/.ssh/id_rsa.pub</code>) and its public key to create this new <a id="_idIndexMarker449"/>key pair resource in AWS so that we do<a id="_idIndexMarker450"/> not need to download the private key again. Now, you must add tasks for creating an <strong class="bold">Elastic Load Balancer</strong> (<strong class="bold">ELB</strong>).</p>
<h3>Creating an Elastic Load Balancer</h3>
<p>A new ELB <a id="_idIndexMarker451"/>can be created by using the <code>amazon.aws.ec2_elb_lb</code> module in <code>roles/aws-create-elb/tasks/main.yml</code>, as shown here:</p>
<div><div><img alt="Figure 7.35 – Creating an Amazon ELB " height="661" src="img/B18383_07_35.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.35 – Creating an Amazon ELB</p>
<p>If you are using a different version of the AWS Ansible collection, then check out the appropriate Ansible module for creating load balancers and change the playbook accordingly. Now, you are ready to create the EC2 instance tasks.</p>
<h3>Creating EC2 instances</h3>
<p>Finally, start <a id="_idIndexMarker452"/>creating the EC2 instances. However, you must ensure that no duplicate VMs are created. It is a best practice to add validations inside the playbook to avoid any mistakes happening automatically as AWS will not complain about creating multiple instances with the same name.</p>
<p>Create the necessary tasks in <code>roles/aws-create-ec2/tasks/main.yml</code> to collect the existing instances. Only proceed with EC2 creation if the instances don’t exist:</p>
<div><div><img alt="Figure 7.36 – Fetching EC2 instances " height="618" src="img/B18383_07_36.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.36 – Fetching EC2 instances</p>
<p>If the EC2 instance already exists, then you should not create a new EC2 instance again. So, based on <code>existing_ec2_list</code>, create new EC2 instances, as shown here: </p>
<div><div><img alt="Figure 7.37 – Creating an EC2 instance if one does not exist " height="749" src="img/B18383_07_37.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.37 – Creating an EC2 instance if one does not exist</p>
<p>After creating <a id="_idIndexMarker453"/>the EC2 instances, you need to collect the newly created EC2 instances’ details and wait for them to boot up and respond as being online, as shown here:</p>
<div><div><img alt="Figure 7.38 – Collecting information about the newly created EC2 instances " height="724" src="img/B18383_07_38.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.38 – Collecting information about the newly created EC2 instances</p>
<p>Once the <a id="_idIndexMarker454"/>EC2 instances are up and running, collect their details so that you can update them to ELB:</p>
<div><div><img alt="Figure 7.39 – Collecting the new EC2 instances’ details " height="484" src="img/B18383_07_39.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.39 – Collecting the new EC2 instances’ details</p>
<p>Using the collected details (<code>ec2_existing_collected</code>), update the ELB with instance items in the backend, as shown here:</p>
<div><div><img alt="Figure 7.40 – Updating the ELB with instance details in the backend " height="669" src="img/B18383_07_40.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.40 – Updating the ELB with instance details in the backend</p>
<p>The <a id="_idIndexMarker455"/>ELB and backend instances are ready and connected, but nothing is running inside the EC2 instances. Now, you need to install the web server and its content inside it. For that, collect the newly created EC2 instances’ details in a dynamic host group for <strong class="bold">post-provisioning</strong> tasks, as shown here:</p>
<div><div><img alt="Figure 7.41 – Updating the inventory with new EC2 instance details " height="484" src="img/B18383_07_41.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.41 – Updating the inventory with new EC2 instance details</p>
<p>Instead of <a id="_idIndexMarker456"/>collecting the host details, as shown in the preceding screenshot, it is possible to utilize an Ansible dynamic inventory. Refer to <a href="B18383_05.xhtml#_idTextAnchor086"><em class="italic">Chapter 5</em></a>, <em class="italic">Expanding Your Automation Landscape</em>, the <em class="italic">Ansible dynamic inventory</em> section to learn how to use an Ansible dynamic inventory with AWS.</p>
<p>Once you have prepared all of the tasks in the roles, use these roles in the appropriate order inside the main playbook.</p>
<h3>The main playbook for integrating the provisioning workflow for AWS</h3>
<p>The IaC provisioning workflow <a id="_idIndexMarker457"/>is written inside the main playbook – that is, <code>Chapter-07/aws-infra-provisioning.yaml</code> (refer to this book’s GitHub repository for the full code). The variables can be stored under <code>group_vars</code> or <code>host_vars</code> as a best practice. However, we have used the variable file approach to demonstrate this use case easily. Use the previously created roles in the appropriate order, as follows:</p>
<div><div><img alt="Figure 7.42 – AWS infrastructure provisioning playbook " height="1013" src="img/B18383_07_42.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.42 – AWS infrastructure provisioning playbook</p>
<p>In the<a id="_idIndexMarker458"/> same playbook, the post-provisioning tasks have been added under different plays called <code>Deploy Webserver to EC2 instances</code> and <code>hosts: ec2webservers</code> (the dynamic host group created in <code>roles/aws-create-ec2/tasks/main.yml</code>). </p>
<p>The <code>deploy-web-server</code> role will install the <code>httpd</code> web server and install <code>firewalld</code> and configure the web server with the default website content. The following screenshot shows the post-provisioning play and an optional play to show the ELB address so that you do not need to log into the AWS console and check for the URL to access the website:</p>
<div><div><img alt="Figure 7.43 – Post-provisioning tasks in the second play " height="618" src="img/B18383_07_43.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.43 – Post-provisioning tasks in the second play</p>
<p>When you<a id="_idIndexMarker459"/> execute the playbook, the workflow will be triggered for provisioning the infrastructure and application:</p>
<pre class="source-code">
[ansible@ansible Chapter-07]$ ansible-playbook aws-infra-provisioning.yaml</pre>
<p>Finally, the following message will be displayed after the post-provisioning tasks:</p>
<div><div><img alt="Figure 7.44 – The Ansible playbook displaying the ELB details " height="328" src="img/B18383_07_44.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.44 – The Ansible playbook displaying the ELB details</p>
<p>Add more resources to the provisioning workflow, such as additional EBS volumes to the server, Network Access Control rules, and images from custom AMIs or snapshots. Post-provisioning can be expanded with more configurations as necessary. </p>
<p>Now, you need to create the playbook’s content to delete the resources to complete the full IaC life cycle.</p>
<h2 id="_idParaDest-136"><a id="_idTextAnchor136"/>Completing the IaC life cycle by using a destroy playbook</h2>
<p>The <code>Chapter-07/aws-infra-destroy.yaml</code> playbook will take care of destroying the<a id="_idIndexMarker460"/> resources and housekeeping jobs (refer to this book’s GitHub repository for the full code):</p>
<div><div><img alt="Figure 7.45 – AWS infrastructure destroy playbook " height="830" src="img/B18383_07_45.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.45 – AWS infrastructure destroy playbook</p>
<p>If the resources are not required, then destroy the entire infrastructure using the destroy playbook:</p>
<pre class="source-code">
[ansible@ansible Chapter-07]$ ansible-playbook aws-infra- destroy.yaml</pre>
<p>In this section, you learned how to create AWS resources and manage the end-to-end life cycle for<a id="_idIndexMarker461"/> implementing IaC practices. In the next section, you will explore similar automation for <strong class="bold">Google Cloud Platform</strong> (<strong class="bold">GCP</strong>).</p>
<p class="callout-heading">Ansible AWS Integration</p>
<p class="callout">Read more about Ansible AWS integration at <a href="https://www.ansible.com/integrations/cloud/amazon-web-services">https://www.ansible.com/integrations/cloud/amazon-web-services</a>.</p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor137"/>Creating resources in GCP using Ansible </h1>
<p>Like VMware and <a id="_idIndexMarker462"/>AWS, it is possible to create and manage GCP resources with the help of the Ansible GCP content collection.</p>
<h2 id="_idParaDest-138"><a id="_idTextAnchor138"/>Prerequisite for Ansible GCP automation</h2>
<p>Before you <a id="_idIndexMarker463"/>start, you need to ensure the prerequisites have been configured for Ansible GCP automation.</p>
<p>As you learned for VMware, AWS, and other platforms, you need to install the relevant Ansible content collection. In this case, you must install the <code>google.cloud</code> collection if you haven’t done so yet:</p>
<pre class="source-code">
[ansible@ansible Chapter-07]$ ansible-galaxy collection install google.cloud</pre>
<p>The <code>google.cloud</code> collection contains around 170 modules, roles, and other plugins to automate the GCP infrastructure and its resources. </p>
<p>The modules in the <code>google.cloud</code> collection require the following Python libraries to be installed on the system:</p>
<pre class="source-code">
$ pip install requests google-auth</pre>
<p>Make sure you are installing the libraries into the correct path if you are using a Python virtual environment for Ansible.</p>
<p class="callout-heading">Ansible for Google Cloud</p>
<p class="callout">Learn more about Ansible GCP automation by reading the <em class="italic">Google Cloud Platform Guide</em>: <a href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_gce.xhtml">https://docs.ansible.com/ansible/latest/scenario_guides/guide_gce.xhtml</a>. Also, check out the Google Cloud Ansible collection at <a href="https://galaxy.ansible.com/google/cloud">https://galaxy.ansible.com/google/cloud</a> to explore Ansible modules for GCP automation.</p>
<h2 id="_idParaDest-139"><a id="_idTextAnchor139"/>GCP free trial</h2>
<p>To practice <a id="_idIndexMarker464"/>GCP and Ansible use cases, it is possible to get a GCP free trial with more than 20 GCP services to use free of cost. Visit <a href="https://cloud.google.com/free">https://cloud.google.com/free</a> and sign up for a GCP Free Tier account. I have ensured that the following demonstration only uses the GCP Free Tier-based resources so that no additional costs will be incurred on your account. It is also important to delete the resource from your GCP account once you have finished testing.</p>
<h2 id="_idParaDest-140"><a id="_idTextAnchor140"/>Configuring GCP credentials</h2>
<p>Use your<a id="_idIndexMarker465"/> GCP service accounts or machine accounts to configure the platform access for Ansible automation (refer to the following information box for more information). Once you created the service account and downloaded the JSON file, configure Ansible to use the JSON file as the credential for GCP access. </p>
<p>It is possible to configure the credential as module parameters or as environment variables, as follows:</p>
<pre class="source-code">
GCP_AUTH_KIND
GCP_SERVICE_ACCOUNT_EMAIL
GCP_SERVICE_ACCOUNT_FILE
GCP_SCOPES</pre>
<p>Depending on the environment and practices, follow an appropriate method, similar to what we did for VMware and AWS.</p>
<p class="callout-heading">Creating a GCP Service Account</p>
<p class="callout">Refer to <a href="https://developers.google.com/identity/protocols/oauth2/service-account#creatinganaccount">https://developers.google.com/identity/protocols/oauth2/service-account#creatinganaccount</a> to learn <a id="_idIndexMarker466"/>how to create a GCP service account and create and download JSON key files.</p>
<h2 id="_idParaDest-141"><a id="_idTextAnchor141"/>Creating a GCP instance using Ansible</h2>
<p>In this exercise, you <a id="_idIndexMarker467"/>will create Ansible content to create a simple compute instance in GCP:</p>
<ol>
<li value="1">Create a variable file called <code>vars/gcp-details.yaml</code> so that you can store the GCP credential details, as follows:</li>
</ol>
<div><div><img alt="Figure 7.46 – GCP configuration variables for Ansible " height="270" src="img/B18383_07_46.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.46 – GCP configuration variables for Ansible</p>
<ol>
<li value="2">Create the <code>Chapter-07/gcp-create-instance.yml</code> playbook. Create a new VPC network using <code>google.cloud.gcp_compute_network</code> if required and configure the new GCP instance so that it uses the new VPC network. In this exercise, you will be using the <code>default</code> VPC network and adding a task to fetch the <code>default</code> VPC network details:</li>
</ol>
<div><div><img alt="Figure 7.47 – GCP provisioning playbook " height="565" src="img/B18383_07_47.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.47 – GCP provisioning playbook</p>
<ol>
<li value="3">Add a task <a id="_idIndexMarker468"/>to the same playbook to create the GCP instance boot disk with the Debian 9 operating system (use other public images or your own private images as needed):</li>
</ol>
<div><div><img alt="Figure 7.48 – Creating a GCP disk for the new VM " height="460" src="img/B18383_07_48.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.48 – Creating a GCP disk for the new VM</p>
<p>The <code>instance_source_disk</code> variable will contain details about the disk. We will pass this information to the instance creation task in the next step.</p>
<ol>
<li value="4">Add a task to create the GCP instance and pass the network and disk details, as follows:</li>
</ol>
<div><div><img alt="Figure 7.49 – Creating a GCP instance with network and disk details " height="618" src="img/B18383_07_49.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.49 – Creating a GCP instance with network and disk details</p>
<ol>
<li value="5">Execute the <a id="_idIndexMarker469"/>Ansible <code>gcp-create-instance.yml</code> playbook:<pre>[ansible@ansible Chapter-07]$ ansible-playbook gcp-create-instance.yml</pre></li>
<li>Verify the instance details on the GCP console, as shown here:</li>
</ol>
<div><div><img alt="Figure 7.50 – Verifying the instance on the GCP dashboard " height="271" src="img/B18383_07_50.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.50 – Verifying the instance on the GCP dashboard</p>
<ol>
<li value="7">Also, verify the disk details, as shown here:</li>
</ol>
<div><div><img alt="Figure 7.51 – Verifying the disk details on the GCP dashboard " height="184" src="img/B18383_07_51.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.51 – Verifying the disk details on the GCP dashboard</p>
<p>With around <a id="_idIndexMarker470"/>170 modules available, it is possible to manage almost all cloud resources in GCP, including computing, disk, networks, load balancers, firewalls, routing, cloud builds, autoscaling, DNS, databases, Spanner, and more. </p>
<p class="callout-heading">Ansible GCP Modules</p>
<p class="callout">Refer to the official documentation to <a id="_idIndexMarker471"/>see the available Ansible GCP modules: <a href="https://docs.ansible.com/ansible/latest/collections/google/cloud/index.xhtml">https://docs.ansible.com/ansible/latest/collections/google/cloud/index.xhtml</a>.</p>
<h1 id="_idParaDest-142"><a id="_idTextAnchor142"/>Summary</h1>
<p>In this chapter, you learned about IaC concepts and how to use Ansible as an IaC tool. You also learned about how Ansible can manage virtualization and cloud platforms such as VMware, AWS, and GCP. Then, you learned about the different methods and credential configurations for these platforms so that Ansible can access and execute automated operations.</p>
<p>Next, you explored the Ansible modules and collections that are available for VMware, AWS, and GCP. By developing the basic playbooks for creating new virtual machines (EC2 instances or GCP instances), you have started your journey in infrastructure automation and management. Expand the playbook’s content to build use cases suitable for your cloud and virtualization environment.</p>
<p>In the next chapter, you will learn how to help non-platform teams use Ansible for their automation use cases, such as building and managing databases using Ansible. </p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor143"/>Further reading</h1>
<p>To learn more about the topics that were covered in this chapter, take a look at the following resources:</p>
<ul>
<li><em class="italic">What is Infrastructure as Code (IaC)?</em>: <a href="https://www.redhat.com/en/topics/automation/what-is-infrastructure-as-code-iac">https://www.redhat.com/en/topics/automation/what-is-infrastructure-as-code-iac</a></li>
<li><em class="italic">Ansible VMware Guide</em>: <a href="https://docs.ansible.com/ansible/2.5/scenario_guides/guide_vmware.xhtml">https://docs.ansible.com/ansible/2.5/scenario_guides/guide_vmware.xhtml</a> </li>
<li><em class="italic">VMware API and SDK Documentation</em>: <a href="https://www.vmware.com/support/pubs/sdk_pubs.xhtml">https://www.vmware.com/support/pubs/sdk_pubs.xhtml</a></li>
<li><em class="italic">Introducing the VMware REST Ansible Content Collection</em>: <a href="https://www.ansible.com/blog/introducing-the-vmware-rest-ansible-content-collection">https://www.ansible.com/blog/introducing-the-vmware-rest-ansible-content-collection</a></li>
<li><em class="italic">Ansible Amazon Web Services Guide</em>: <a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/docsite/guide_aws.xhtml">https://docs.ansible.com/ansible/latest/collections/amazon/aws/docsite/guide_aws.xhtml</a></li>
</ul>
</div>
<div><div></div>
</div>
</div></body></html>