- en: Robust Networking Implementations
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 强大的网络实施
- en: In the previous chapter, we covered the serverless and microservices objectives.
    We covered how to design serverless computing and which features Azure provides
    for creating them. We also covered microservices-based solutions, and the differences
    between all the different Azure features and when to use them.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了无服务器和微服务的目标。我们讨论了如何设计无服务器计算以及 Azure 提供的创建这些服务的功能。我们还介绍了基于微服务的解决方案，以及不同的
    Azure 功能之间的差异及其适用场景。
- en: This chapter introduces the networking objectives. It starts with how to design
    Azure Virtual Networks. This consists of designing solutions that use Azure networking
    services, such as designs for load balancing using Azure Load Balancer and Azure
    Traffic Manager, defining DNS, DHCP, and IP strategies, determining when to use
    Azure Application Gateway, and when to use multi-node application gateways, Traffic
    Manager, and Load Balancers.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了网络目标。它从如何设计 Azure 虚拟网络开始，包括使用 Azure 网络服务设计的解决方案，例如使用 Azure 负载均衡器和 Azure
    流量管理器的负载均衡设计，定义 DNS、DHCP 和 IP 策略，确定何时使用 Azure 应用程序网关，以及何时使用多节点应用程序网关、流量管理器和负载均衡器。
- en: After that, it covers designing external connectivity for Azure Virtual Networks.
    In this chapter, you will learn how to determine when to use Azure VPN, ExpressRoute,
    virtual network peering architecture, when to use **User Defined Routes** (**UDRs**),
    and when to use VPN gateway site-to-site failover for ExpressRoute.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，本章介绍如何为 Azure 虚拟网络设计外部连接。你将学习如何确定何时使用 Azure VPN、ExpressRoute、虚拟网络对等架构，何时使用**用户定义路由**（**UDRs**），以及何时使用
    VPN 网关站点对站点故障切换功能来支持 ExpressRoute。
- en: Lastly, this chapter covers how to design security strategies by determining
    when to use network virtual appliances, how to design a perimeter network (DMZ),
    and determine when to use a **Web Application Firewall** (**WAF**), **Network
    Security Group** (**NSG**), and virtual network service tunneling.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，本章介绍如何通过确定何时使用网络虚拟设备、如何设计边界网络（DMZ）以及确定何时使用**Web 应用程序防火墙**（**WAF**）、**网络安全组**（**NSG**）和虚拟网络服务隧道来设计安全策略。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Designing Azure Virtual Networks
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计 Azure 虚拟网络
- en: When to use Azure Application Gateway
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 何时使用 Azure 应用程序网关
- en: When to use multi-node application gateways, Azure Traffic Manager, and Load
    Balancers
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 何时使用多节点应用程序网关、Azure 流量管理器和负载均衡器
- en: Designing external connectivity for Azure Virtual Networks
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计 Azure 虚拟网络的外部连接
- en: Designing security strategies
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计安全策略
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter uses the following tools for the examples:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章使用以下工具进行示例：
- en: Azure PowerShell: [https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.1.1](https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.1.1)
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure PowerShell: [https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.1.1](https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.1.1)
- en: 'The source code for this chapter can be downloaded here:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的源代码可以在此下载：
- en: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%205](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%205)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%205](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%205)'
- en: Azure Virtual Network
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 虚拟网络
- en: An **Azure Virtual Network** (**VNet**) is a virtual representation of a traditional
    network, hosted in the cloud. It is totally software-based, where traditional
    networks use cables, routers, and more. VNets provide a secure and isolated environment
    and they connect Azure resources with each other. By default, the different resources
    are not reachable from outside of the virtual network. You can, however, connect
    multiple VNets to each other or connect a VNet to your on-premises network as
    well. All the Azure resources that are connected inside the same VNet must reside
    in the same region and subscription.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '**Azure 虚拟网络**（**VNet**）是传统网络的虚拟化表示，托管在云中。它完全基于软件，与传统网络使用电缆、路由器等设备不同。虚拟网络提供安全的隔离环境，并将
    Azure 资源相互连接。默认情况下，不同的资源不能从虚拟网络外部访问。然而，你可以将多个虚拟网络互连，或将虚拟网络连接到本地网络。所有连接在同一虚拟网络中的
    Azure 资源必须位于同一区域和订阅下。'
- en: When you create a VNet, one subnet is automatically created as well. You can
    create multiple subnets inside the same VNet (there is a maximum of 1000 subnets
    allowed per VNet). Connecting multiple VNets to each other is called **virtual
    network peering**. There is a maximum of 10 peerings allowed per Azure subscription.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 当你创建虚拟网络时，一个子网会自动创建。你可以在同一个虚拟网络内创建多个子网（每个虚拟网络最多允许 1000 个子网）。将多个虚拟网络连接在一起称为 **虚拟网络对等连接**。每个
    Azure 订阅最多允许 10 个对等连接。
- en: The smallest subnet that can be used in Azure is the /29 subnet, which consists
    of eight addresses and the largest is /8, which consists of 16 million addresses.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，最小的子网是 /29 子网，包含 8 个地址，最大的子网是 /8，包含 1600 万个地址。
- en: For more information on subnetting, you can refer to the Subnet Mask Cheat Sheet: [https://www.aelius.com/njh/subnet_sheet.html](https://www.aelius.com/njh/subnet_sheet.html).
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 如需了解更多关于子网划分的信息，你可以参考子网掩码备忘单：[https://www.aelius.com/njh/subnet_sheet.html](https://www.aelius.com/njh/subnet_sheet.html)。
- en: IP addresses
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IP 地址
- en: A virtual network in Azure can have private and public IP addresses. Private
    IP addresses are only accessible from within the virtual network and public IP
    addresses can be accessed from the internet as well. You can access private IP
    addresses from a VPN Gateway or an ExpressRoute connection. Both private and public
    IP addresses can be static or dynamic, but when you create a new VNet, the IP
    address is static by default. You can change the IP address to static from the
    Azure Portal, PowerShell, and CLI.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 中的虚拟网络可以拥有私有和公共 IP 地址。私有 IP 地址只能在虚拟网络内访问，而公共 IP 地址可以从互联网访问。你可以通过 VPN 网关或
    ExpressRoute 连接访问私有 IP 地址。私有和公共 IP 地址都可以是静态或动态的，但当你创建新的虚拟网络时，IP 地址默认是静态的。你可以通过
    Azure 门户、PowerShell 和 CLI 将 IP 地址更改为静态。
- en: '![](img/bb8a5384-a8a3-4dff-958c-d8a7df199da1.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bb8a5384-a8a3-4dff-958c-d8a7df199da1.png)'
- en: Dynamic and static IP address configuration in the Azure Portal
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 门户中的动态和静态 IP 地址配置
- en: '**Dynamic**: Dynamic IP addresses are assigned by Azure automatically and are
    selected from the configured subnet''s address range from the virtual network
    where the Azure resource resides. The IP address is assigned to the Azure resource
    upon creation or start. The IP address will then be released when the resource
    is stopped and deallocated (when you stop the VM from the Azure Portal, the VM
    is deallocated automatically as well) and added back to the pool of available
    addresses inside the subnet by Azure.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**动态**：动态 IP 地址由 Azure 自动分配，并从虚拟网络中配置的子网地址范围内选择。IP 地址在 Azure 资源创建或启动时分配给该资源。当资源停止并释放时（例如你从
    Azure 门户停止虚拟机时，虚拟机会自动释放），该 IP 地址将被 Azure 添加回子网的可用地址池中。'
- en: '**Static**: Static IP addresses (private and public) are pre-assigned and will
    remain the same until you delete the assignment. You can select a static private
    IP address manually. They can only be assigned to non-internet facing connections,
    such as an internal Load Balancer. You can assign a private IP address to a connection
    to your on-premises network or to an ExpressRoute circuit as well. Public static
    IP addresses are created by Azure automatically and they can be assigned to internet
    facing connections, such as an external Load Balancer.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**静态**：静态 IP 地址（包括私有和公共）是预先分配的，并且在你删除分配之前会保持不变。你可以手动选择静态私有 IP 地址。它们只能分配给非互联网连接，比如内部负载均衡器。你还可以将私有
    IP 地址分配给与你本地网络的连接或 ExpressRoute 电路。公共静态 IP 地址由 Azure 自动创建，并可以分配给面向互联网的连接，例如外部负载均衡器。'
- en: Public IP address
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 公共 IP 地址
- en: Public IP addresses can be used for internal communication between Azure services
    and external communication over the internet. You can use IPv4 and IPv6 for public
    IP addresses, but the support for IPv6 is limited. At the time of writing, you
    can only assign IPv6 addresses to external Load Balancers.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 公共 IP 地址可以用于 Azure 服务之间的内部通信以及通过互联网进行的外部通信。你可以使用 IPv4 和 IPv6 作为公共 IP 地址，但对 IPv6
    的支持有限。写作时，你只能将 IPv6 地址分配给外部负载均衡器。
- en: Azure assigns the public IP address to the network interface when the Azure
    resource is started or created. When a outbound connection is initiated, Azure
    will map the private IP address to the public IP address (SNAT). Return traffic
    to the resource is allowed as well.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 在 Azure 资源启动或创建时，会将公共 IP 地址分配给网络接口。当发起外部连接时，Azure 会将私有 IP 地址映射到公共 IP 地址（SNAT）。返回流量也会被允许进入资源。
- en: Public IP addresses are typically used for VMs, internet-facing Load Balancers,
    VPN gateways, and application gateways. There is a maximum of 60 dynamic public
    IP addresses and 20 static public IP addresses per subscription. The first five
    static IP address are free, the rest have a cost.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 公共 IP 地址通常用于虚拟机、面向互联网的负载均衡器、VPN 网关和应用程序网关。每个订阅最多可以有 60 个动态公共 IP 地址和 20 个静态公共
    IP 地址。前五个静态 IP 地址是免费的，其余的需要付费。
- en: The following document is beyond the scope of this book, but definitely interesting—*Understanding
    outbound connections in Azure*: [https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections?toc=%2fazure%2fvirtual-network%2ftoc.json](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections?toc=%2fazure%2fvirtual-network%2ftoc.json).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 以下文档超出了本书的范围，但绝对值得一读——*理解 Azure 中的出站连接*：[https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections?toc=%2fazure%2fvirtual-network%2ftoc.json](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections?toc=%2fazure%2fvirtual-network%2ftoc.json)。
- en: Private IP address
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 私有 IP 地址
- en: Private IP addresses support IPv4 and IPv6 as well, but support for IPv6 is
    also limited. They can only be assigned dynamically and IPv6 addresses cannot
    communicate with each other inside a VNet. The only way to use IPv6 addresses
    is by assigning them to an internet-facing Load Balancer, where the frontend IP
    address is an IPv4 address and the backend is an IPV6 address.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 私有 IP 地址支持 IPv4 和 IPv6，但对 IPv6 的支持也有限。它们只能动态分配，并且 IPv6 地址在 VNet 内部无法相互通信。唯一使用
    IPv6 地址的方法是将其分配给面向互联网的负载均衡器，其中前端 IP 地址是 IPv4 地址，后端是 IPv6 地址。
- en: Private IP addresses are typically used for VMs, internal Load Balancers, and
    application gateways. A VPN cannot have a private IP address because it is always
    internet-facing. There is a maximum of 4096 private IP addresses per VNet. You
    can, however, create multiple VNets (50 per subscription).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 私有 IP 地址通常用于虚拟机、内部负载均衡器和应用程序网关。VPN 无法拥有私有 IP 地址，因为它总是面向互联网。每个 VNet 最多可以拥有 4096
    个私有 IP 地址。然而，你可以创建多个 VNet（每个订阅最多 50 个）。
- en: These limits are based on the default limits from the following page: [https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits?toc=%2fazure%2fvirtual-network%2ftoc.json#networking-limits](https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits?toc=%2fazure%2fvirtual-network%2ftoc.json#networking-limits).
    You can open a support request to raise the limits. The limits can't be raised
    above the maximum limit, as described in the limit table.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这些限制基于以下页面的默认限制：[https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits?toc=%2fazure%2fvirtual-network%2ftoc.json#networking-limits](https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits?toc=%2fazure%2fvirtual-network%2ftoc.json#networking-limits)。你可以提交支持请求来提高这些限制。根据限制表的描述，限制不能超过最大限制。
- en: Creating a public IP address
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建公共 IP 地址
- en: 'In the following example, we are going to create a static public IP address
    using PowerShell:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例中，我们将使用 PowerShell 创建一个静态公共 IP 地址：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 进入 Azure 门户。
- en: Open the Azure Cloud Shell and make sure PowerShell is selected.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Azure Cloud Shell，并确保选择了 PowerShell。
- en: 'Add the following command:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加以下命令：
- en: 'If necessary, select the right subscription:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，选择正确的订阅：
- en: '[PRE0]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Create the IP address:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 IP 地址：
- en: '[PRE1]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This is the easiest way to create a static IP address. However, you still have
    to assign it to a Azure resource. It is only created now. I've used an existing
    resource group for this example. If you don't have one, you need to create it
    before creating the IP address.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是创建静态 IP 地址的最简单方法。然而，你仍然需要将它分配给一个 Azure 资源。此时它只是刚刚创建。为了本示例，我使用了一个现有的资源组。如果你没有资源组，需要在创建
    IP 地址之前先创建一个资源组。
- en: DNS
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNS
- en: Besides IP addresses, VMs can also be addressed by using hostnames or **fully
    qualified domain names** (**FQDN**). You can configure a DNS label for this on
    a public IP address. For Azure services that are all hosted inside the same VNet,
    Azure internal DNS can be used for name resolving. If you want to use DNS for
    multiple VNets, you have to set up your own DNS server. For instance, if you add
    the DNS label `packtuniquedns`, the FQDN will become packtuniquedns.westeurope.cloudapp.azure.com.
    This FQDN will then map to the public IP address of the Azure resource.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 IP 地址，虚拟机还可以通过使用主机名或 **完全限定域名**（**FQDN**）来访问。你可以为此在公共 IP 地址上配置 DNS 标签。对于所有托管在同一
    VNet 内的 Azure 服务，可以使用 Azure 内部 DNS 进行名称解析。如果你想在多个 VNet 中使用 DNS，则必须设置自己的 DNS 服务器。例如，如果你添加
    DNS 标签 `packtuniquedns`，FQDN 将变为 packtuniquedns.westeurope.cloudapp.azure.com。此
    FQDN 将映射到 Azure 资源的公共 IP 地址。
- en: '![](img/9761561e-d4f5-4a9f-97ee-bd078ea86f83.jpg)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9761561e-d4f5-4a9f-97ee-bd078ea86f83.jpg)'
- en: Built-in DNS name resolving
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 内置 DNS 名称解析
- en: You can point your DNS to the Azure resource by adding a CNAME record as well.
    So instead of using the default DNS suffix, you can use Azure DNS to assign a
    custom hostname to the resource. If you want your Azure resource to be reached
    with a hostname without the `www` prefix, you need to add an A record. CNAME will
    only work with the `www` prefix.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以通过添加 CNAME 记录将 DNS 指向 Azure 资源。因此，你可以使用 Azure DNS 为资源分配自定义主机名，而不是使用默认的 DNS
    后缀。如果你希望通过主机名访问 Azure 资源且没有 `www` 前缀，你需要添加 A 记录。CNAME 仅适用于带有 `www` 前缀的情况。
- en: For more information on this, you can refer to the following articles—*Create
    a fully qualified domain name in the Azure Portal for a Linux VM*: [https://docs.microsoft.com/en-us/azure/virtual-machines/linux/portal-create-fqdn](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/portal-create-fqdn)
    and *Use Azure DNS to provide custom domain settings for an Azure service*: [https://docs.microsoft.com/en-us/azure/dns/dns-custom-domain?toc=%2fazure%2fvirtual-network%2ftoc.json#public-ip-address](https://docs.microsoft.com/en-us/azure/dns/dns-custom-domain?toc=%2fazure%2fvirtual-network%2ftoc.json#public-ip-address).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 有关此方面的更多信息，你可以参考以下文章——*在 Azure 门户为 Linux 虚拟机创建完全限定的域名*：[https://docs.microsoft.com/en-us/azure/virtual-machines/linux/portal-create-fqdn](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/portal-create-fqdn)
    和 *使用 Azure DNS 为 Azure 服务提供自定义域名设置*：[https://docs.microsoft.com/en-us/azure/dns/dns-custom-domain?toc=%2fazure%2fvirtual-network%2ftoc.json#public-ip-address](https://docs.microsoft.com/en-us/azure/dns/dns-custom-domain?toc=%2fazure%2fvirtual-network%2ftoc.json#public-ip-address)。
- en: Creating a VNet with two subnets
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建带有两个子网的 VNet
- en: 'In this example, we are going to create a VNet with two subnets from the Azure
    Portal. You can use PowerShell, CLI, and an ARM template as well. We are going
    to create a VNet and subnets according to the following diagram:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在本示例中，我们将从 Azure 门户创建一个带有两个子网的 VNet。你也可以使用 PowerShell、CLI 或 ARM 模板。我们将根据以下示意图创建
    VNet 和子网：
- en: '![](img/5c3360aa-ebf1-45ef-9bbd-3a52ded71f39.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5c3360aa-ebf1-45ef-9bbd-3a52ded71f39.png)'
- en: A VNet with two subnets
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 带有两个子网的 VNet
- en: 'Take the following steps to create the VNet:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤创建 VNet：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 访问 Azure 门户。
- en: 'Click on New and type `virtual network` in the search bar to create a new virtual
    network:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“新建”，在搜索框中输入`virtual network`以创建一个新的虚拟网络：
- en: '![](img/6eeb8780-d483-40dd-9582-3ab1880f233c.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6eeb8780-d483-40dd-9582-3ab1880f233c.jpg)'
- en: Creating a new virtual network
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 创建新的虚拟网络
- en: 'A new blade opens up, where you can fill in the settings. Add the following
    values:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将打开一个新的面板，你可以在其中填写设置。添加以下值：
- en: '![](img/b1947b66-332a-400b-a827-803d933934fa.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b1947b66-332a-400b-a827-803d933934fa.png)'
- en: VNet and subnet settings
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: VNet 和子网设置
- en: Click on Create. You can only create one subnet when creating a VNet from the
    Azure Portal. So, the second one needs to be added after creating the VNet.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建”。在从 Azure 门户创建 VNet 时，你只能创建一个子网。因此，第二个子网需要在创建 VNet 后添加。
- en: 'Go to the VNet Settings and choose Subnets from the left-hand menu and click
    + Subnet in the top menu, as shown in the following screenshot:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 VNet 设置，从左侧菜单选择“子网”，然后点击顶部菜单中的“+ 子网”，如下图所示：
- en: '![](img/59ebdf64-0c4b-476f-aeb1-a9d47bd7749a.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/59ebdf64-0c4b-476f-aeb1-a9d47bd7749a.png)'
- en: Adding a second subnet
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 添加第二个子网
- en: 'A new blade will open up. Enter the following values and click on OK:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将打开一个新的面板。输入以下值并点击“确定”：
- en: '![](img/faf67320-4bd8-4cc3-82d5-c59f8699a03b.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/faf67320-4bd8-4cc3-82d5-c59f8699a03b.png)'
- en: Second subnet settings
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个子网设置
- en: Azure Load Balancer
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 负载均衡器
- en: Azure Load Balancer is a Load Balancer which can be used for VMs, containers,
    and apps. It works at the transport layer (layer four in the OSI network reference
    stack) by distributing network traffic in the same Azure data center. It offers
    an external and an internal Load Balancer.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 负载均衡器是一种可以用于虚拟机、容器和应用的负载均衡器。它在传输层（OSI 网络参考模型中的第四层）工作，通过在同一 Azure 数据中心内分发网络流量。它提供外部负载均衡器和内部负载均衡器。
- en: The external Load Balancer provides a single endpoint with a public IP address
    that is called by all client applications and services, and then distributes the
    incoming traffic over multiple healthy VMs, containers, or apps to provide scaling,
    high availability, and performance. The internal Load Balancer has the same features
    as the external, but it uses a private IP address.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 外部负载均衡器提供一个带有公共 IP 地址的单一端点，所有客户端应用和服务都会调用此端点，然后将传入流量分发到多个健康的虚拟机、容器或应用上，以提供扩展、高可用性和性能。内部负载均衡器与外部负载均衡器具有相同的功能，但它使用私有
    IP 地址。
- en: '![](img/afbd59bb-d956-4461-98a3-0fec6dce30a7.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](img/afbd59bb-d956-4461-98a3-0fec6dce30a7.png)'
- en: External and internal Load Balancer
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 外部和内部负载均衡器
- en: 'There are two versions of Azure Load Balancer:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 负载均衡器有两个版本：
- en: '**Basic**: The basic Load Balancer is free to use. It can be configured as
    an internet-facing Load Balancer, as an internal Load Balancer, and it can forward
    traffic to a specific VM. For the internet-facing Load Balancer, the public IP
    address is mapped to the private IP address by the Load Balancer. When traffic
    comes in, Azure distributes it to the Azure resource by using the internal IP
    address.'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基本版**：基本版负载均衡器是免费的。它可以配置为面向互联网的负载均衡器、内部负载均衡器，并可以将流量转发到特定的虚拟机。对于面向互联网的负载均衡器，公共
    IP 地址通过负载均衡器映射到私有 IP 地址。当流量进入时，Azure 使用内部 IP 地址将流量分配到 Azure 资源。'
- en: It offers hashed-based distribution, port forwarding, automatic reconfiguration
    when you scale down or up, service monitoring, and source NAT.
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 它提供基于哈希的分发、端口转发、在扩展或缩减时的自动重新配置、服务监控和源 NAT。
- en: '**Standard**: At the time of writing, the standard Load Balancer is still in
    preview. On top of all the features that the basic Load Balancer offers, the standard
    version offers enterprise scale. You can use standalone VMs or VMs up to 1000
    instances using the standard Load Balancer. It also offers diagnostic insights
    for public and internal Load Balancer configurations, high reliability by using
    HA ports, and rules for individual ports. You can use NSGs (which we will discuss
    later in this chapter) and availability zones.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准版**：在撰写本文时，标准版负载均衡器仍处于预览阶段。除了基本负载均衡器提供的所有功能外，标准版还提供了企业级扩展。您可以使用独立虚拟机或最多
    1000 个虚拟机实例来使用标准版负载均衡器。它还提供了公共和内部负载均衡器配置的诊断信息，通过使用 HA 端口提供高可靠性，并为每个端口提供规则。您可以使用
    NSG（稍后将在本章中讨论）和可用性区域。'
- en: For more information on the standard Load Balancer, you can refer to the following
    article: [https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-standard-overview](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-standard-overview).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 欲了解有关标准版负载均衡器的更多信息，您可以参考以下文章：[https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-standard-overview](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-standard-overview)。
- en: Probes
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探针
- en: 'The Azure Load Balancer uses probes to define the health of your servers and
    services that are leveraging the Load Balancer. There are two different types
    of probes: the HTTP and the TCP Probe.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 负载均衡器使用探针来定义利用负载均衡器的服务器和服务的健康状况。探针有两种不同的类型：HTTP 探针和 TCP 探针。
- en: For cloud services (such as VMs, web apps, APIs, and more), it uses a **guest
    agent probe**. In this scenario, there is a guest agent installed on your VM that
    responds with an HTTP 200 OK response. Every 15 seconds, the Load Balancer sends
    a message to the cloud service to which the agent responds. You can also create
    a custom HTTP Probe with your own logic that overrrides the  logic of the default
    guest agent. The TCP Probe uses a three-way handshake to set up the connection.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 对于云服务（如虚拟机、Web 应用、API 等），它使用**来宾代理探针**。在这种情况下，您的虚拟机上安装了一个来宾代理，该代理会返回一个 HTTP
    200 OK 响应。负载均衡器每 15 秒向云服务发送一条消息，来宾代理会做出响应。您还可以创建一个自定义的 HTTP 探针，使用您自己的逻辑覆盖默认来宾代理的逻辑。TCP
    探针通过三次握手建立连接。
- en: When health logging is enabled, the data is stored in an Azure storage account.
    You can view this log data by using different Azure tools, such as PowerShell
    or CLI, the REST API, or the Azure Portal. You can also use Power BI to visualize
    and analyze the data using pre-defined dashboards provided by the *Azure Audit
    Logs content pack for Power BI*.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 启用健康日志记录后，数据会存储在 Azure 存储帐户中。您可以通过使用不同的 Azure 工具（如 PowerShell 或 CLI、REST API
    或 Azure 门户）来查看这些日志数据。您还可以使用 Power BI 来可视化和分析数据，通过 *Azure 审计日志内容包 for Power BI*
    提供的预定义仪表板。
- en: For more information and to download the Azure Audit Logs content pack for Power
    BI, you can refer to [https://docs.microsoft.com/en-us/power-bi/service-connect-to-azure-audit-logs](https://docs.microsoft.com/en-us/power-bi/service-connect-to-azure-audit-logs).
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 如需更多信息并下载 Power BI 的 Azure 审计日志内容包，您可以参考 [https://docs.microsoft.com/en-us/power-bi/service-connect-to-azure-audit-logs](https://docs.microsoft.com/en-us/power-bi/service-connect-to-azure-audit-logs)。
- en: Azure Traffic Manager
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Traffic Manager
- en: Azure Traffic Manager spreads the workload over multiple regions and data centers
    in the world. It will handle the load and locate the closest geographical region
    or most suitable region at the DNS level. The client makes a DNS request and,
    based on the location of the DNS, Azure Traffic Manager will locate the nearest
    region in Azure and sends that location back to the client via a DNS response.
    The client then calls the location directly, without any further interference
    of Azure Traffic Manager. Traffic Manager also monitors the endpoints, so in case
    of a failure inside one region, the Traffic Manager will send back the endpoint
    of a different healthy region.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Traffic Manager 将工作负载分散到全球多个地区和数据中心。它将处理负载并在 DNS 层面定位最接近的地理区域或最合适的区域。客户端发出
    DNS 请求，Azure Traffic Manager 会根据 DNS 的位置确定最近的 Azure 区域，并通过 DNS 响应将该位置返回给客户端。然后，客户端直接调用该位置，Azure
    Traffic Manager 不再干预。Traffic Manager 还会监控端点，因此，如果某个地区发生故障，Traffic Manager 会返回另一个健康区域的端点。
- en: This differs from the Azure Load Balancer, where the client calls the IP address
    of the Load Balancer and the Load Balancer distributes the traffic over multiple
    cloud services, such as VMs, containers, or web apps. Also, the Azure Load Balancer
    spreads traffic over multiple instances in the same region and data center, whereas
    Traffic Manager can span over multiple regions and data centers.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这与 Azure 负载均衡器不同，后者客户端调用负载均衡器的 IP 地址，负载均衡器将流量分发到多个云服务上，如虚拟机、容器或 Web 应用。此外，Azure
    负载均衡器将流量分发到同一地区和数据中心中的多个实例，而 Traffic Manager 可以跨多个地区和数据中心进行流量分发。
- en: 'You can use both the Azure Load Balancer and Azure Traffic Manager in a highly
    available and high-performing architecture, such as the one shown in the following
    diagram:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在高可用且高性能的架构中同时使用 Azure 负载均衡器和 Azure Traffic Manager，如下图所示：
- en: '![](img/4a3baf05-758b-4913-a977-ee22896a672e.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4a3baf05-758b-4913-a977-ee22896a672e.png)'
- en: Azure Traffic Manager
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Traffic Manager
- en: Azure Traffic Manager was also discussed in [Chapter 3](de2f1b21-edb1-4616-a8ff-8fbf484459a0.xhtml),
    *Designing Web Applications*, in the section about high availability and performance
    for your web apps. The different routing methods that are available for Azure
    Traffic Manager are also described there.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Traffic Manager 也在 [第 3 章](de2f1b21-edb1-4616-a8ff-8fbf484459a0.xhtml)，*设计
    Web 应用程序* 中的关于 Web 应用的高可用性和性能的部分进行了讨论。那里还描述了 Azure Traffic Manager 提供的不同路由方法。
- en: Azure Application Gateway
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 应用程序网关
- en: The Azure Application Gateway offers an **Application Delivery Controller**
    (**ADC**), which operates on the application layer (layer seven in the OSI network
    reference stack).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 应用程序网关提供 **应用交付控制器** (**ADC**)，该控制器在应用层（OSI 网络参考模型中的第七层）上运行。
- en: It provides web load balancing, so it provides load balancing on layer seven,
    which is for HTTP(S) only. It also provides a web application firewall, which
    can be leveraged to protect your apps from common web-based attacks, such as cross-site
    scripting, SQL injection, and session-hijacking (this is described in more detail
    in the *Network Security Strategies* section in this chapter). It can decrypt
    HTTPS traffic, so you can install your SSL certificates on the application gateway
    instead of onto the different web servers. This way, the web servers don't have
    to take care of this and management will be easier because it is all in one place.
    Application Gateway will then encrypt the response before it is sent back to the
    client. It can also provide URL-based content routing, so traffic can be routed
    to specific backends. For example, a call to a CDN that is hosted on a dedicated
    backend can be called directly, which reduces unnecessary routing. It also provides
    health monitoring and advanced diagnostics.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 它提供了 web 负载均衡，因此它在第七层提供负载均衡，仅适用于 HTTP(S)。它还提供了一个 web 应用程序防火墙，可以用于保护您的应用免受常见的基于
    web 的攻击，如跨站脚本、SQL 注入和会话劫持（在本章的 *网络安全策略* 部分中有更详细的描述）。它可以解密 HTTPS 流量，因此您可以将 SSL
    证书安装在应用程序网关上，而不是安装在不同的 web 服务器上。这样，web 服务器就不必处理这些问题，管理也会更容易，因为所有内容都集中在一个地方。然后，应用程序网关将在响应发送回客户端之前对其进行加密。它还可以提供基于
    URL 的内容路由，因此流量可以路由到特定的后端。例如，可以直接调用托管在专用后端上的 CDN，这样可以减少不必要的路由。它还提供健康监控和高级诊断功能。
- en: '![](img/1e5bfc48-a3df-49fd-b4f5-f1a46075da6d.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1e5bfc48-a3df-49fd-b4f5-f1a46075da6d.png)'
- en: Azure Application Gateway
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 应用程序网关
- en: For more information on Azure Application Gateway and the different features,
    you can refer to [https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview](https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview).
    This page also gives an overview of all the differences between the Azure Load
    Balancer, Azure Traffic Manager, and the Azure Application Gateway.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 Azure 应用程序网关及其不同功能的更多信息，请参阅 [https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview](https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview)。此页面还概述了
    Azure 负载均衡器、Azure 流量管理器和 Azure 应用程序网关之间的所有差异。
- en: External connectivity for Azure Virtual Networks
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 虚拟网络的外部连接
- en: The cloud is becoming more popular everyday, but for the next few years, most
    organizations will still have an on-premises infrastructure that will be used
    and maintained. In fact, some organizations will never move to the cloud completely
    because of business requirements or some sort of legacy system that is still in
    use and cannot be moved for some reason or other. Also, security requirements
    could be a reason for keeping a part of your data on-premises. So, there will
    always be a need for hybrid environments. From a networking perspective, Azure
    offers various features to set up seamless connections from your on-premises infrastructure
    to Azure and vice versa.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 云计算的普及程度日益增加，但在接下来的几年里，大多数组织仍将拥有并维护本地基础设施。事实上，一些组织由于业务需求或某些仍在使用的遗留系统，可能永远不会完全迁移到云端。安全性要求也可能是将部分数据保留在本地的原因。因此，混合环境的需求将永远存在。从网络的角度来看，Azure
    提供了多种功能，可以建立从本地基础设施到 Azure 以及反向连接的无缝连接。
- en: Azure VPN
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure VPN
- en: Azure VPN provides a secure gateway that can be used to connect your on-premises
    infrastructure with Azure and to connect multiple VNets with each other by sending
    an encrypted message from one location to the other. Most organizations use VPN
    connections to let remote workers connect to their private network.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: Azure VPN 提供一个安全的网关，可以用来将您的本地基础设施与 Azure 连接，并通过将加密消息从一个位置发送到另一个位置来连接多个虚拟网络（VNet）。大多数组织使用
    VPN 连接来让远程工作人员连接到他们的私有网络。
- en: 'Azure VPN offers multiple ways to set up a secure connection, such as site-to-site
    VPN, point-to-site VPN, and ExpressRoute. They are described in the following
    sections. When setting up an Azure network gateway for one of these connection
    types, you have to choose between the different SKUs that Azure offers. Azure
    VPN offers the following SKUs:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: Azure VPN 提供多种方式来建立安全连接，例如站点到站点 VPN、点对站点 VPN 和 ExpressRoute。它们在以下章节中进行了描述。当为这些连接类型之一设置
    Azure 网络网关时，您必须在 Azure 提供的不同 SKU 之间进行选择。Azure VPN 提供以下 SKU：
- en: '**Basic**: Provides a maximum of 10 site-to-site/VNet-to-VNet tunnels and a
    maximum of 128 point-to-site connections. The average bandwidth is 100 Mbps.'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基础版**: 提供最多 10 个站点到站点 / VNet 到 VNet 隧道，最多支持 128 个点对站点连接。平均带宽为 100 Mbps。'
- en: '**VpnGw1**: Provides a maximum of 30 site-to-site/VNet-to-VNet tunnels and
    a maximum of 128 point-to-site connections. The average bandwidth is 650 Mbps.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VpnGw1**: 提供最多 30 个站点到站点 / VNet 到 VNet 隧道，最多支持 128 个点对站点连接。平均带宽为 650 Mbps。'
- en: '**VpnGw2**: Provides a maximum of 30 site-to-site/VNet-to-VNet tunnels and
    a maximum of 128 point-to-site connections. The average bandwidth is 1 Gbps.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VpnGw2**: 提供最多 30 个站点到站点 / VNet 到 VNet 隧道，最多支持 128 个点对站点连接。平均带宽为 1 Gbps。'
- en: '**VpnGw3**: Provides a  maximum of 30 site-to-site/VNet-to-VNet tunnels and
    a maximum of 128 point-to-site connections. The average bandwidth is 1.25 Gbps.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VpnGw3**: 提供最多 30 个站点到站点 / VNet 到 VNet 隧道，最多支持 128 个点对站点连接。平均带宽为 1.25 Gbps。'
- en: You can set up route-based or policy-based VPN types. Which one to use depends
    on the compatibility of your VPN device and the VPN connection type you want to
    use.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以设置基于路由或基于策略的 VPN 类型。使用哪种类型取决于您的 VPN 设备的兼容性以及您希望使用的 VPN 连接类型。
- en: Policy-based means that you have to write your own routing-table entries. This
    can be suitable for small organizations, but most will rather do this dynamically. Policy-based
    routing also has some restrictions; you can only set up one site-to-site VPN tunnel
    using IKEv1 and no point-to-site tunnel.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 基于策略意味着您必须编写自己的路由表条目。这可能适用于小型组织，但大多数组织会选择动态配置。基于策略的路由也有一些限制；您只能使用 IKEv1 设置一个站点到站点
    VPN 隧道，且不能设置点对站点隧道。
- en: Route-based means that the routing-table entries are added dynamically and that
    you can use all the VPN connection types and IKEv2.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 基于路由意味着路由表条目是动态添加的，您可以使用所有 VPN 连接类型和 IKEv2。
- en: Site-to-site VPN
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 站点到站点 VPN
- en: A **site-to-site** (**S2S**) VPN  is designed to create secure connections between
    a location, such as an office for instance, and Azure over the internet. You can
    then connect from every server or computer from that location using the same VPN
    connection. It requires a compatible VPN device or **Routing and Remote Access
    Service** (**RRAS**) and a public IP address for your VPN device. The RRAS can
    be deployed on a Windows server by activating the remote access server role.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '**站点到站点** (**S2S**) VPN 旨在通过互联网在某个位置（例如办公室）与 Azure 之间创建安全连接。然后，您可以使用相同的 VPN
    连接从该位置的每台服务器或计算机进行连接。它需要一个兼容的 VPN 设备或 **路由和远程访问服务** (**RRAS**)，并且您的 VPN 设备需要一个公共
    IP 地址。可以通过启用远程访问服务器角色在 Windows 服务器上部署 RRAS。'
- en: The S2S VPN gateway creates a connection over a IPsec/IKE (IKEv1 or IKEv2) VPN
    tunnel. **Internet Protocol Security** (**IPSec**) is an open standard for securing
    connections over the internet and **Internet Key Exchange** (**IKE**) is a key
    management protocol standard used in conjunction with IPSec. It is a method for exchanging
    keys for encryption and authentication.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: S2S VPN 网关通过 IPsec/IKE（IKEv1 或 IKEv2）VPN 隧道创建连接。**互联网协议安全** (**IPSec**) 是一个用于通过互联网安全连接的开放标准，**互联网密钥交换**
    (**IKE**) 是与 IPSec 一起使用的密钥管理协议标准。这是一种用于交换加密和身份验证密钥的方法。
- en: '![](img/7715e2d5-e331-4673-ab5d-58ed4755e6ea.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7715e2d5-e331-4673-ab5d-58ed4755e6ea.png)'
- en: Site-to-site VPN connection
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 站点到站点 VPN 连接
- en: For a list of compatible VPN devices and the supported VPN types, you can refer
    to the following overview: [https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-devices](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-devices).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 有关兼容的 VPN 设备和支持的 VPN 类型的列表，请参考以下概述：[https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-devices](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-devices)。
- en: VNet-to-VNet VPN
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VNet 到 VNet VPN
- en: VNet-to-VNet is a connection type that can be set up as well. In this case,
    you are creating a connection between multiple Azure VNets. A typical reason for
    setting up this type of connection, could be for geo-redundancy. This connection
    type is the same as the S2S connection type.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: VNet 到 VNet 是一种可以设置的连接类型。在这种情况下，您正在创建多个 Azure VNet 之间的连接。设置这种连接的典型原因可能是为了地理冗余。这种连接类型与
    S2S 连接类型相同。
- en: Point-to-site VPN
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 点对站点 VPN
- en: A **point-to-site** (**P2S**) VPN is designed to create secure connections between
    an individual client computer over IKEv2 or SSTP. The connection is established
    by starting it from the client computer using a script. These connections are
    used for remote workers that log on to the private network from a different location
    or they can be used when you have a few clients that need to connect to the VPN.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '**点对站**（**P2S**）VPN 是设计用于通过 IKEv2 或 SSTP 在客户端计算机之间建立安全连接的。连接是通过从客户端计算机启动并使用脚本进行建立的。这些连接适用于远程工作者，他们从不同位置登录私有网络，或者在需要少量客户端连接到
    VPN 时使用。'
- en: '**Secure Socket Tunneling Protocol** (**SSTP**) is a VPN tunnel that creates
    a connection through an SSL/TLS channel. By using SSL/TLS over port `443`, the
    connection can pass through all firewalls and proxy servers.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全套接字隧道协议**（**SSTP**）是一种通过 SSL/TLS 通道建立连接的 VPN 隧道。通过在端口`443`上使用 SSL/TLS，连接可以通过所有防火墙和代理服务器。'
- en: P2S connections don't require a VPN device or a public IP address for the client
    computer. They can be used in conjunction with the S2S connection as well as through
    the same VPN gateway, as long as the requirements for both the connections are
    the same.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: P2S 连接不需要 VPN 设备或客户端计算机的公共 IP 地址。它们可以与 S2S 连接一起使用，或者通过相同的 VPN 网关使用，只要两个连接的要求相同。
- en: '![](img/8ec66b5d-7f4c-42d2-95fb-2eb83b0fb1f6.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8ec66b5d-7f4c-42d2-95fb-2eb83b0fb1f6.png)'
- en: Point-to-site VPN connection
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 点对站 VPN 连接
- en: ExpressRoute
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ExpressRoute
- en: ExpressRoute is the most advanced type of VPN connection. It offers a fast connection
    from your on-premises infrastructure to the Azure via your internal WAN, unlike
    S2S connections, which go over the internet. By using your WAN, ExpressRoute can
    provide faster speeds, lower latency, and higher security than an S2S connection.
    The maximum bandwidth that can be provided per ExpressRoute circuit is 10 GBps.
    With ExpressRoute, you can also set up hybrid connections with Office 365 and
    Dynamics 365. ExpressRoute also guarantees a connection uptime SLA, whereas S2S
    doesn't.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: ExpressRoute 是最先进的 VPN 连接类型。它通过您的内部 WAN 提供从本地基础设施到 Azure 的快速连接，而与 S2S 连接通过互联网不同。通过使用您的
    WAN，ExpressRoute 可以提供比 S2S 连接更快的速度、更低的延迟和更高的安全性。每个 ExpressRoute 电路可以提供的最大带宽为 10
    GBps。通过 ExpressRoute，您还可以与 Office 365 和 Dynamics 365 设置混合连接。ExpressRoute 还保证连接的正常运行时间
    SLA，而 S2S 连接则没有。
- en: 'ExpressRoute offers the following connection models:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: ExpressRoute 提供以下连接模型：
- en: '**Any-to-any (IPVPN)**: With this type of connection, you integrate your WAN
    with Azure using an IPVPN provider. The provider is then responsible for setting
    up the secure connection between your on-premises network and Azure. WAN providers
    typically offer a layer three connection.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**任意对任意（IPVPN）**：通过这种类型的连接，您可以使用 IPVPN 提供商将您的 WAN 与 Azure 集成。提供商负责在本地网络和 Azure
    之间建立安全连接。WAN 提供商通常提供第三层连接。'
- en: '**Point-to-point Ethernet**: With this type of connection, you connect through
    point-to-point Ethernet links. Point-to-point providers typically provide a layer
    two connection.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**点对点以太网**：通过这种类型的连接，您可以通过点对点以太网链路进行连接。点对点提供商通常提供第二层连接。'
- en: '**Co-located at a Cloud Exchange**: With this type of connection, you can order
    connections through the provider''s Ethernet exchange. These providers typically
    offer layer two cross-connections and managed layer three cross-connections.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**位于云交换中心**：通过这种类型的连接，您可以通过提供商的以太网交换机订购连接。这些提供商通常提供第二层交叉连接和管理的第三层交叉连接。'
- en: '![](img/f52f570a-b378-4990-9ad2-7c8c647e3726.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f52f570a-b378-4990-9ad2-7c8c647e3726.jpg)'
- en: ExpressRoute VPN connection
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: ExpressRoute VPN 连接
- en: Network security strategies
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络安全策略
- en: With all the hacking incidents nowadays, a strong network security strategy
    is key. It is not secure to just create a public IP address and expose your Azure
    resource to the internet. This will make you vulnerable for attacks. Design your
    networks with security in mind and reduce what is exposed to the internet. You
    can use the features that Azure provides for securing your networks. Azure offers
    support for different security strategies, which are described in the following
    section.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 由于如今的黑客攻击事件频发，强大的网络安全策略至关重要。仅创建一个公共 IP 地址并将您的 Azure 资源暴露在互联网上并不安全，这会让您容易受到攻击。设计您的网络时应考虑安全性，并减少暴露于互联网的内容。您可以使用
    Azure 提供的功能来保护您的网络。Azure 提供对不同安全策略的支持，接下来的部分将进行描述。
- en: DMZ
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DMZ
- en: A **demilitarized zone** (**DMZ**) or perimeter network is a physical or logical
    boundary between the internal and the external network of an organization. The
    external network can be the internet. The purpose is to add an additional security
    layer to the internal network. You don't open any ports from the internal network
    to the internet, but only to the DMZ. Azure offers multiple features that you
    can use to create a DMZ, such as **Network Security Groups** (**NSGs**), firewalls,
    and **User Defined Routes** (**UDRs**).
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**非军事区**（**DMZ**）或外围网络是组织内部网络和外部网络之间的物理或逻辑边界。外部网络可以是互联网。其目的是为内部网络增加一层额外的安全保护。你不从内部网络打开任何端口到互联网，而是仅仅开放端口到
    DMZ。Azure 提供了多个功能，你可以用来创建 DMZ，例如 **网络安全组**（**NSG**）、防火墙和 **用户定义路由**（**UDR**）。'
- en: The following diagram shows an example of a physical DMZ created using a frontend
    VNet with two VMs in it. Only this VNet is connected to the internet.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了使用前端 VNet 创建的物理 DMZ 示例，VNet 中有两个虚拟机。只有这个 VNet 与互联网连接。
- en: '![](img/a4b47dfc-600c-4445-ad0a-941547a2a2bf.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a4b47dfc-600c-4445-ad0a-941547a2a2bf.png)'
- en: Simple DMZ example
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的 DMZ 示例
- en: Network Security Groups
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络安全组
- en: A NSG is an access control list inside Azure where you can add inbound and outbound
    rules. When a connection is established between VMS, VNets, or other cloud services,
    this list is checked to see whether the connection is allowed or denied.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: NSG 是 Azure 内的一个访问控制列表，你可以在其中添加入站和出站规则。当虚拟机、虚拟网络或其他云服务之间建立连接时，会检查此列表，看看连接是否被允许或拒绝。
- en: NSGs can be applied to one or more subnets or individual **network interfaces**
    (**NIC**). This means that all resources that are associated with this subnet
    or NIC will automatically have all the rules applied.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: NSG 可以应用于一个或多个子网或单个**网络接口**（**NIC**）。这意味着所有与此子网或 NIC 关联的资源将自动应用所有规则。
- en: NSG rules are processed in priority order, with lower numbers before higher
    numbers, and they can be applied to inbound or outbound traffic.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: NSG 规则按优先级顺序处理，较低的数字优先于较高的数字，它们可以应用于入站或出站流量。
- en: Creating a NSG
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建 NSG
- en: 'Follow these steps to create a NSG:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤创建 NSG：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开[https://portal.azure.com/](https://portal.azure.com/)来导航到 Azure 门户。
- en: 'Click New, type `Network Security Group` in the search bar, and create a new
    one:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“新建”，在搜索栏中输入`Network Security Group`，然后创建一个新的 NSG：
- en: '![](img/111c8b2d-105a-434b-a6e2-6bc789b25068.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](img/111c8b2d-105a-434b-a6e2-6bc789b25068.png)'
- en: New NSG
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 新的 NSG
- en: 'A new blade opens up. Add the following settings and click on Create:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个新的面板。添加以下设置并点击“创建”：
- en: '![](img/cb721549-3fa5-4dc3-ad9d-925983941516.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cb721549-3fa5-4dc3-ad9d-925983941516.png)'
- en: New NSG settings
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 新的 NSG 设置
- en: 'A NSG is created with some default inbound and outbound security rules. They
    are low-priority rules, as they have a high number, so there is a lot of room
    to add custom rules. To add a custom rule, click on Inbound security rules in
    the left-hand menu:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个 NSG 会创建一些默认的入站和出站安全规则。它们是低优先级规则，因为它们的编号较高，因此有很大的空间来添加自定义规则。要添加自定义规则，请点击左侧菜单中的“入站安全规则”：
- en: '![](img/33a6dd01-fe7f-42cb-8113-03d65f2dc43b.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](img/33a6dd01-fe7f-42cb-8113-03d65f2dc43b.jpg)'
- en: NSG default Inbound and Outbound rules
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: NSG 默认入站和出站规则
- en: 'Click the Addbutton and add the following values to create rules that allow
    traffic from port `80`:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“添加”按钮，并添加以下值以创建允许来自端口`80`的流量的规则：
- en: '![](img/ce8a42ac-82e5-487f-b0e8-764cc59f0db6.jpg)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ce8a42ac-82e5-487f-b0e8-764cc59f0db6.jpg)'
- en: New rule
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 新规则
- en: 'You can now associate this NSG with an NIC or a subnet by clicking on Network
    Interfaces or Subnets from the left-hand menu:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你可以通过点击左侧菜单中的“网络接口”或“子网”来将此 NSG 与 NIC 或子网关联：
- en: '![](img/88ea5cb2-4d7f-4061-bffe-c672e2489431.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](img/88ea5cb2-4d7f-4061-bffe-c672e2489431.jpg)'
- en: Associate the NSG with a NIC or subnet
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 将 NSG 与 NIC 或子网关联
- en: User Defined Routes
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用户定义路由（UDR）
- en: When you create subnets, Azure creates system routes that enable all resources
    in a subnet to communicate with each other. You can override the system routes
    by creating UDRs. This way, you can force traffic to follow a particular route.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 当你创建子网时，Azure 会创建系统路由，使子网中的所有资源能够相互通信。你可以通过创建用户定义路由（UDR）来覆盖这些系统路由。通过这种方式，你可以强制流量遵循特定的路由。
- en: For instance, you have a network that consists of two subnets and you want to
    add a VM that is used as a DMZ and has a firewall installed on it. You want traffic
    only to go through the firewall and not between the two subnets.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设你有一个由两个子网组成的网络，并且你希望添加一个虚拟机（VM）作为 DMZ，并在其上安装防火墙。你希望流量只能通过防火墙，而不是在这两个子网之间传输。
- en: To create UDRs and enable IP forwarding, you have to create a routing table
    in Azure. When this table is created and there are custom routes in there, Azure
    prefers the custom routes over the default system routes.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建 UDR 并启用 IP 转发，必须在 Azure 中创建路由表。当此表创建并包含自定义路由时，Azure 会优先选择自定义路由，而不是默认的系统路由。
- en: Creating User Defined Routes
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建用户定义路由
- en: 'To create UDRs, follow these steps:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 UDR 的步骤如下：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 进入 Azure 门户。
- en: Click on New, type `Routing Table` in the search bar, and create a new one.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **New**，在搜索栏中输入 `Routing Table`，然后创建一个新的路由表。
- en: '![](img/4a1e9208-a18d-405d-ab95-155e7942bfbc.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4a1e9208-a18d-405d-ab95-155e7942bfbc.jpg)'
- en: Create a new routing table
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个新的路由表
- en: 'Add the following values:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加以下值：
- en: '![](img/90af0ec4-b471-4ee1-932a-bd31e38c31db.jpg)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![](img/90af0ec4-b471-4ee1-932a-bd31e38c31db.jpg)'
- en: Route table settings
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 路由表设置
- en: 'A new and empty route table is created. To add custom routes, click on Routes in
    the left-hand menu:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建了一个新的空路由表。要添加自定义路由，点击左侧菜单中的 **Routes**：
- en: '![](img/0deb9af8-7766-4486-ad30-1e910fd7cc09.jpg)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0deb9af8-7766-4486-ad30-1e910fd7cc09.jpg)'
- en: Empty route table
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 空路由表
- en: 'Click the Add button in the top menu and add the following values to create
    a custom route. In this example, we want all internet traffic to go through the
    firewall. So, add a `0.0.0.0/0` as the Address prefix. The Next hop type is a
    `Virtual appliance`; this is the firewall. And last, the Next hop address; this
    will be the internal IP address of the firewall:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击顶部菜单中的 **Add** 按钮，并添加以下值以创建自定义路由。在这个示例中，我们希望所有互联网流量都通过防火墙。因此，添加 `0.0.0.0/0`
    作为 **Address prefix**。接下来，选择 **Next hop type** 为 `Virtual appliance`，即防火墙。最后，设置
    **Next hop address** 为防火墙的内部 IP 地址：
- en: '![](img/a67cdb65-9b8d-41b9-9fb7-b6c54edc7bf1.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a67cdb65-9b8d-41b9-9fb7-b6c54edc7bf1.jpg)'
- en: Add custom route
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 添加自定义路由
- en: For more detailed instructions on how to create UDPs and a virtual appliance,
    you can refer to the following tutorial: [https://docs.microsoft.com/en-us/azure/virtual-network/create-user-defined-route-portal](https://docs.microsoft.com/en-us/azure/virtual-network/create-user-defined-route-portal).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 了解如何创建 UDP 和虚拟设备的详细说明，请参考以下教程：[https://docs.microsoft.com/en-us/azure/virtual-network/create-user-defined-route-portal](https://docs.microsoft.com/en-us/azure/virtual-network/create-user-defined-route-portal)。
- en: Virtual network service tunneling
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟网络服务隧道
- en: With **virtual network service tunneling,** all your external traffic is forced
    to go through a site-to-site VPN tunnel. Without this, external traffic will always
    go directly from Azure to the internet. This gives you the opportunity to audit
    the traffic.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '**虚拟网络服务隧道**会强制所有外部流量通过站点到站点的 VPN 隧道。如果没有这个功能，外部流量将直接从 Azure 传输到互联网。这给你提供了审计流量的机会。'
- en: 'Forced tunneling uses the UDRs to define the routing. Instead of choosing the
    virtual appliance, you now choose the virtual network gateway:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 强制隧道使用 UDR 定义路由。你现在选择虚拟网络网关，而不是虚拟设备：
- en: '![](img/066341b9-ff33-4598-a2b4-b10da7b19b35.jpg)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](img/066341b9-ff33-4598-a2b4-b10da7b19b35.jpg)'
- en: Virtual network service tunneling
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网络服务隧道
- en: For more information about virtual network service tunneling and an example
    on how to create it using PowerShell, you can refer to the following tutorial: [https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm).
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 了解有关虚拟网络服务隧道的更多信息以及如何使用 PowerShell 创建它的示例，可以参考以下教程：[https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm)。
- en: Web Application Firewall
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Web 应用防火墙
- en: The WAF is part of the application gateway and it provides a firewall to protect
    your web apps from hacking attacks. It is based on rules from the OWASP core rule
    set 3.0\. It can protect a maximum of 20 applications behind an application gateway
    and it provides monitoring for your applications using Azure Monitor (in the future,
    monitoring will be added to the Azure Security Center as well).
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: WAF 是应用程序网关的一部分，它提供防火墙来保护你的 Web 应用免受黑客攻击。它基于 OWASP 核心规则集 3.0。它最多可以保护 20 个应用程序，并通过
    Azure Monitor 对你的应用进行监控（未来，监控功能也会添加到 Azure 安全中心）。
- en: OWASP is an open standard for application security. For more information on
    the rule set, you can refer to the OWASP website: [https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project](https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project).
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: OWASP 是一个开放的应用安全标准。如需了解规则集的更多信息，可以参考 OWASP 网站：[https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project](https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project)。
- en: 'By default, it protects your application from the following:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，它保护你的应用免受以下攻击：
- en: From SQL injection attacks
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自 SQL 注入攻击
- en: From cross-site scripting attacks
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自跨站脚本攻击
- en: From command injection, HTTP request smuggling, HTTP response splitting, and
    remote file inclusion attacks
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自命令注入、HTTP 请求走私、HTTP 响应拆分和远程文件包含攻击
- en: Against HTTP protocol violations and anomalies
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对 HTTP 协议违规和异常
- en: Against bots, crawlers, and scanners
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对机器人、爬虫和扫描器
- en: It detects common application misconfigurations
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它能够检测常见的应用配置错误
- en: You can also add or customize the rules and rule group to suit the needs of
    your application. You can refer to the following tutorial to customize rules: [https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal).
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以添加或自定义规则和规则组，以适应你应用的需求。你可以参考以下教程来自定义规则：[https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal)。
- en: Summary
  id: totrans-199
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have covered the networking objectives. We've covered how
    to design Azure Virtual Networks. We've discussed IP addresses and Azure DNS.
    We also covered when to use the Azure Application Gateway, Azure Traffic Manager,
    and Azure Load Balancer. We then looked at designing external connectivity for
    Azure VNets using different VPN connections, and finally, we talked about designing
    different security strategies.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 本章内容涵盖了网络目标。我们讨论了如何设计 Azure 虚拟网络，介绍了 IP 地址和 Azure DNS。同时，我们还讨论了何时使用 Azure 应用程序网关、Azure
    流量管理器和 Azure 负载均衡器。接着，我们探讨了如何使用不同的 VPN 连接设计 Azure VNet 的外部连接，最后，我们讨论了设计不同的安全策略。
- en: In the next chapter, we will cover hybrid applications.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论混合应用。
- en: Questions
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 回答以下问题以测试你对本章信息的理解。你可以在本书末尾的*评估*部分找到答案：
- en: When you create a new routing table in Azure, is the system routing table deleted?
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你在 Azure 中创建新的路由表时，系统路由表会被删除吗？
- en: 'Yes'
  id: totrans-205
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-206
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是的
- en: Are NSG rules processed by priority number from high to low?
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: NSG 规则是否按照优先级从高到低进行处理？
- en: 'Yes'
  id: totrans-208
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是的
- en: Does DMZ consist of a firewall?
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: DMZ 是否包括防火墙？
- en: 'Yes'
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-212
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是的
- en: Further reading
  id: totrans-213
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'You can check out the following links for more information on the topics that
    are covered in this chapter:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查看以下链接以获取有关本章所涵盖主题的更多信息：
- en: '**Azure Virtual Network**: [https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview)'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 虚拟网络**：[https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview)'
- en: '**Virtual Network Peering**: [https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview)'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟网络对等连接**：[https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview)'
- en: '**Azure Load Balancer overview**: [https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview)'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 负载均衡器概述**：[https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview)'
- en: '**Overview of Traffic Manager**: [https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview](https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview)'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**流量管理器概述**：[https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview](https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview)'
- en: '**Overview of Application Gateway**: [https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-introduction](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-introduction)'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序网关概述**: [https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-introduction](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-introduction)'
- en: '**About VPN Gateway**: [https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways)'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关于 VPN 网关**: [https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways)'
- en: '**ExpressRoute overview**: [https://docs.microsoft.com/en-us/azure/expressroute/expressroute-introduction](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-introduction)'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ExpressRoute 概述**: [https://docs.microsoft.com/en-us/azure/expressroute/expressroute-introduction](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-introduction)'
- en: '**Filter network traffic with network security groups**: [https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-nsg](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-nsg)'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用网络安全组过滤网络流量**: [https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-nsg](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-nsg)'
- en: '**User Defined Routes**: [https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#custom-routes](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#custom-routes)'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户定义路由**: [https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#custom-routes](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#custom-routes)'
- en: '**Web Application Firewall**: [https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-overview](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-overview)'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Web 应用防火墙**: [https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-overview](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-overview)'
