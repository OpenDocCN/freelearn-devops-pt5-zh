<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Introducing Ansible for Enterprises</h1></div></div></div><p>In this chapter, we will discuss the state of Ansible on different OSes. We'll also take a look at Ansible Galaxy and Ansible Tower.</p><p>We'll explore the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Ansible on Windows</li><li class="listitem" style="list-style-type: disc">Ansible for networking devices</li><li class="listitem" style="list-style-type: disc">Ansible Galaxy</li><li class="listitem" style="list-style-type: disc">Ansible Tower</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec79"/>Ansible on Windows</h1></div></div></div><p>Ansible version 1.7 started being able to manage Windows machines with a few basic modules. After the acquisition of Ansible by Red Hat, a lot of effort has been put into this task by Microsoft and many other companies and people. By the time of the 2.1 release, Ansible's ability to manage Windows machines was close to being complete. Some modules have been extended to work seamlessly on Unix and Windows, while in other cases, the Windows logic was so different from Unix that new modules needed to be created.</p><div><div><h3 class="title"><a id="note54"/>Note</h3><p>At the moment, using Windows as a control machine is not supported, though some users have tweaked the code and their environment to make it work.</p></div></div><p>The connection from the control machine to Windows machines is not made over SSH; instead, it's made over <strong>Windows Remote Management</strong> (<strong>WinRM</strong>). You can visit Microsoft's website for a detailed explanation and implementation: <a class="ulink" href="http://msdn.microsoft.com/en-us/library/aa384426(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/aa384426(v=vs.85).aspx</a>.</p><p>On the control machine, once you've installed Ansible, it's important that you install WinRM. You can do it via <code class="literal">pip</code> with this command:</p><pre class="programlisting">
<strong>pip install "pywinrm&gt;=0.1.1"</strong>
</pre><div><div><h3 class="title"><a id="note55"/>Note</h3><p>You may need to use <code class="literal">sudo</code> or the <code class="literal">root</code> account to execute this command.</p></div></div><p>On each of the remote Windows machines, you need to install PowerShell version 3.0 or higher. Ansible provides a couple of helpful scripts to set it up:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>WinRM</strong>: <a class="ulink" href="https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1">https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</a></li><li class="listitem" style="list-style-type: disc"><strong>PowerShell 3.0 upgrade</strong>: <a class="ulink" href="https://github.com/cchurch/ansible/blob/devel/examples/scripts/upgrade_to_ps3.ps1">https://github.com/cchurch/ansible/blob/devel/examples/scripts/upgrade_to_ps3.ps1</a></li></ul></div><p>You will also need to allow port <code class="literal">5986</code> via the firewall, as this is the default WinRM connection port, and make sure it is accessible from the command center.</p><p>To make sure you can access the service remotely, run a <code class="literal">curl</code> command:</p><pre class="programlisting">
<strong>curl -vk -d `` -u "$USER:$PASSWORD" "https://&lt;IP&gt;:5986/wsman". </strong>
</pre><p>If basic authentication works, you're set to start running commands. Once the setup is done, you're ready to start running Ansible! Let's run the equivalent of the Windows version of the <code class="literal">Hello, world!</code> program in Ansible by running <code class="literal">win_ping</code>. In order to do this, let's set up our credentials file.</p><p>This can be done using Ansible vault, as follows:</p><pre class="programlisting">
<strong>$ ansible-vault create group_vars/windows.yml</strong>
</pre><p>As we've seen, Ansible vault will ask interactively to set the password:</p><pre class="programlisting">
<strong>Vault password:</strong>
<strong>Confirm Vault password:</strong>
</pre><p>At this point, we can add the variables we need:</p><pre class="programlisting">    ansible_ssh_user: Administrator &#13;
    ansible_ssh_pass: &lt;password&gt; &#13;
    ansible_ssh_port: 5986 &#13;
    ansible_connection: winrm &#13;
</pre><p>Let's set up our <code class="literal">inventory</code> file, as follows:</p><pre class="programlisting">    [windows] &#13;
    174.129.181.242 &#13;
</pre><p>Followed by this, let's run <code class="literal">win_ping</code>:</p><pre class="programlisting">
<strong>ansible windows -i inventory -m win_ping --ask-vault-pass</strong>
</pre><p>Ansible will ask us the vault password and then print the result of the run, as follows:</p><pre class="programlisting">    Vault password: &#13;
    174.129.181.242 | success &gt;&gt; { &#13;
        "changed": false, &#13;
        "ping": "pong" &#13;
    } &#13;
</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec80"/>Ansible for networking devices</h1></div></div></div><p>Since version 2.1, we have seen many new modules for the management of networking devices and softwares. Many of those modules have been contributed directly from the company that creates the device (or software). The big advantage of this, which is based on the idea of <strong>Software Defined Networking</strong> (<strong>SDN</strong>), is that having Ansible that manages all your networking infrastructure allows you to have an entire datacenter completely managed within Ansible. This means, having a single language for all components and all people within your IT, and this will allow people to understand better how the company IT works as well as working more closely with each other.</p></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec81"/>Ansible Galaxy</h1></div></div></div><p>Ansible Galaxy is a free site from where you can download Ansible roles developed by the community and kick-start your automation within minutes. You can share or review community roles so that others can easily find the most trusted roles on Ansible Galaxy. You can start using Ansible Galaxy by simply signing up with social media applications such as Twitter, Google, and GitHub or by creating a new account on the Ansible Galaxy website at <a class="ulink" href="https://galaxy.ansible.com/">https://galaxy.ansible.com/</a> and downloading the required roles using the <code class="literal">ansible-galaxy</code> command, which ships with Ansible version 1.4.2 and higher.</p><div><div><h3 class="title"><a id="note56"/>Note</h3><p>In case you want to host your own local Ansible Galaxy instance, you can do so by fetching the code from <a class="ulink" href="https://github.com/ansible/galaxy">https://github.com/ansible/galaxy</a>.</p></div></div><p>To download an Ansible role from Ansible Galaxy, use the following syntax:</p><pre class="programlisting">
<strong>ansible-galaxy install username.rolename</strong>
</pre><p>You can also specify a version as follows:</p><pre class="programlisting">
<strong>ansible-galaxy install username.rolename[,version]</strong>
</pre><p>If you don't specify a version, then the <code class="literal">ansible-galaxy</code> command will download the latest available version. You can install multiple roles in two ways; firstly, by passing multiple role names separated by a space, as follows:</p><pre class="programlisting">
<strong>ansible-galaxy install username.rolename[,version] username.rolename[,version]</strong>
</pre><p>Secondly, you can do so by specifying role names in a file and passing that filename to the <code class="literal">-r/--role-file</code> option. For instance, you could create the <code class="literal">requirements.txt</code> file with the following content:</p><pre class="programlisting">    user1.rolename,v1.0.0 &#13;
    user2.rolename,v1.1.0 &#13;
    user3.rolename,v1.2.1 &#13;
</pre><p>You could then install roles by passing the filename to the <code class="literal">ansible-galaxy</code> command, as follows:</p><pre class="programlisting">
<strong>ansible-galaxy install -r requirements</strong>
</pre><p>Let's see how you can use <code class="literal">ansible-galaxy</code> to download a role for Apache HTTPd:</p><pre class="programlisting">
<strong>sudo ansible-galaxy install geerlingguy.apache</strong>
</pre><p>You'll see output like this:</p><pre class="programlisting">
<strong>- downloading role 'apache', owned by geerlingguy</strong>
<strong>- downloading role from https://github.com/geerlingguy/ansible-role-apache/archive/1.7.3.tar.gz</strong>
<strong>- extracting geerlingguy.apache to /etc/ansible/roles/geerlingguy.apache</strong>
<strong>- geerlingguy.apache was installed successfully</strong>
</pre><p>The preceding <code class="literal">ansible-galaxy</code> command will download the Apache HTTPd role to the <code class="literal">/etc/ansible/roles</code> directory. You can now directly use the preceding role in your playbook, creating the <code class="literal">playbooks/galaxy.yaml</code> file with the following content:</p><pre class="programlisting">    - hosts: web &#13;
      user: ansible &#13;
      become: True &#13;
      roles: &#13;
      - geerlingguy.apache &#13;
</pre><p>As you can see, we created a simple playbook with a <code class="literal">geerlingguy.apache</code> role. We can now test it:</p><pre class="programlisting">
<strong>ansible-playbook playbooks/galaxy.yaml</strong>
</pre><p>This should give us the following output:</p><pre class="programlisting">
<strong>PLAY [web] *******************************************************&#13;
&#13;
</strong>
<strong>TASK [setup] *****************************************************</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Include OS-specific variables.] *******</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Define apache_packages.] **************</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Ensure Apache is installed on RHEL.] **</strong>
<strong>changed: [ws01.fale.io] =&gt; (item=[u'httpd', u'httpd-devel', u'mod_ssl', u'openssh'])</strong>
<strong>changed: [ws02.fale.io] =&gt; (item=[u'httpd', u'httpd-devel', u'mod_ssl', u'openssh'])&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Ensure Apache is installed on Suse.] **</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=[])</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=[])&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Update apt cache.] ********************</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Ensure Apache is installed on Debian.]</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=[])</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=[])&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Ensure Apache is installed on Solaris.]</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=httpd)</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=httpd)</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=httpd-devel)</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=httpd-devel)</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=mod_ssl)</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=mod_ssl)</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=openssh)</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=openssh)&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Get installed version of Apache.] *****</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Create apache_version variable.] ******</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : include_vars] *************************</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : include_vars] *************************</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Configure Apache.] ********************</strong>
<strong>ok: [ws01.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})</strong>
<strong>ok: [ws02.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Check whether certificates defined in vhosts exist.]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Add apache vhosts configuration.] *****</strong>
<strong>changed: [ws01.fale.io]</strong>
<strong>changed: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Configure Apache.] ********************</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Check whether certificates defined in vhosts exist.]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Add apache vhosts configuration.] *****</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Configure Apache.] ********************</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Enable Apache mods.] ******************</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=rewrite.load)</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=rewrite.load)</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item=ssl.load)</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item=ssl.load)&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Disable Apache mods.] *****************&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Check whether certificates defined in vhosts exist.]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Add apache vhosts configuration.] *****</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Add vhost symlink in sites-enabled.] **</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Remove default vhost in sites-enabled.]</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Configure Apache.] ********************</strong>
<strong>skipping: [ws01.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})</strong>
<strong>skipping: [ws02.fale.io] =&gt; (item={u'regexp': u'^Listen ', u'line': u'Listen 80'})&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Add apache vhosts configuration.] *****</strong>
<strong>skipping: [ws01.fale.io]</strong>
<strong>skipping: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>TASK [geerlingguy.apache : Ensure Apache has selected state and enabled on boot.]</strong>
<strong>ok: [ws01.fale.io]</strong>
<strong>ok: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>RUNNING HANDLER [geerlingguy.apache : restart apache] ************</strong>
<strong>changed: [ws01.fale.io]</strong>
<strong>changed: [ws02.fale.io]&#13;
&#13;
</strong>
<strong>PLAY RECAP *******************************************************</strong>
<strong>ws01.fale.io      : ok=11   changed=3    unreachable=0    failed=0</strong>
<strong>ws02.fale.io      : ok=11   changed=3    unreachable=0    failed=0</strong>
</pre><div><div><h3 class="title"><a id="note57"/>Note</h3><p>As you may have noticed, many steps were skipped due to the fact that this role is designed to work on many different Linux distributions.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec82"/>Ansible Tower</h1></div></div></div><p>Ansible Tower is a web-based GUI developed by Red Hat. Ansible Tower provides you with an easy-to-use dashboard to manage your nodes and role-based authentication to control access to your Ansible Tower dashboard. The biggest features of Ansible Tower are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>LDAP/AD integration</strong>: You can import (and give privileges to) users based on the result of LDAP/AD queries that Ansible Tower performs on your LDAP/AD server</li><li class="listitem" style="list-style-type: disc"><strong>Role-based access control</strong>: Limit the users to only run the playbooks they are authorized to run and/or target only a limited amount of hosts</li><li class="listitem" style="list-style-type: disc"><strong>REST API</strong>: All Ansible Tower capabilities are exposed via a REST API</li><li class="listitem" style="list-style-type: disc"><strong>Job scheduling</strong>: Ansible Tower allows us to schedule jobs (playbook execution)</li><li class="listitem" style="list-style-type: disc"><strong>Graphical inventory management</strong>: Ansible Tower manages the inventory in a more dynamic way than Ansible</li><li class="listitem" style="list-style-type: disc"><strong>Dashboard</strong>: Ansible Tower allows us to see the situation of all current and previous job executions</li><li class="listitem" style="list-style-type: disc"><strong>Logging</strong>: Ansible Tower logs all the results of every job execution to be able to go back and check if needed</li></ul></div><p>Although Red Hat has promised to make Ansible Tower open source soon, at the moment, it is not freely available and you need to pay depending on the number of nodes you want to manage.</p><p>At the time of writing, Red Hat provides a free copy of Ansible Tower for 10 nodes. For more details, visit the Ansible Tower website at <a class="ulink" href="http://www.ansible.com/tower">http://www.ansible.com/tower</a>; the user guide is available at <a class="ulink" href="http://docs.ansible.com/ansible-tower/">http://docs.ansible.com/ansible-tower/</a>.</p></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec83"/>Summary</h1></div></div></div><p>In this chapter, we have seen some options that Ansible and its ecosystem provide us. This chapter also wants to teach you to search even less canonical things on the Ansible documentation, because it could be that Ansible has such capability. Also, as you may have noticed, in this chapter many of the covered topics have had major changes in 2.1 (released less than 6 months before the publication of the second edition of this book) and are very actively developed areas, so the official documentation is the right place to check the current state of such topics.</p></div></body></html>