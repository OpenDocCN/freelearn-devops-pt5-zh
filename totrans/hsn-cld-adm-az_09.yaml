- en: Azure Security and Administration
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Security is often one of main reasons why many organizations are postponing
    their move to the cloud. There are too many unknown factors; people don't understand
    how security is set up and often don't trust anyone with their data. "If it leaves
    our data center, then I don't know what is happening to it" is something I have
    heard often over the years.
  prefs: []
  type: TYPE_NORMAL
- en: The truth is that your data is probably far more secure in Azure than it could
    ever be in your local center. In this chapter, I'll try to explain how security
    in Azure is set up and remove any doubts about cloud security.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory multi-factor authentication
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Network Security
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Firewall
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Data encryption
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Key Vault
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Security Center
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Advanced threat protection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Just-in-Time access
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'For this chapter you''ll need the following:'
  prefs: []
  type: TYPE_NORMAL
- en: An Azure subscription
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: PowerShell
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure PowerShell
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Demystifying cloud security
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: So, how secure is Azure really? Let's start by saying very secure.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft is investing heavily in Azure, and particularly in Azure Security.
    Azure has extensive compliance offerings, including HIPAA, FFIEC, PCI DSS, ISO
    9001, and ISO 27001, just to name a few.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Security starts with physical security. Data center has dedicated security
    staff around the clock; everything is covered by cameras and alarms, and there
    are several layers of perimeter checks.
  prefs: []
  type: TYPE_NORMAL
- en: To enter the Azure data center, you need to pass several checkpoints and provide
    valid authentication and authorization. Authentication is done on multi-factor
    levels, and besides providing a PIN or password, you must pass biometric and card
    reader checks as well.
  prefs: []
  type: TYPE_NORMAL
- en: Everything within data centers is encrypted and secure. All data is encrypted
    at rest, and even if someone manages to steal a disk containing your data, it
    would be unusable. All data transferring is also encrypted per industry standards.
  prefs: []
  type: TYPE_NORMAL
- en: Another important part of data security is redundancy to ensure that data is
    never lost. The default redundancy in Azure is 3 (three). When you create a new
    resource, Azure VM for example, a disk is created with three copies. This ensures
    that data is always available, and even if one disk fails, there are an additional
    two copies. Redundant 3 is present even with backup power generators; if one fails,
    there are two additional backups.
  prefs: []
  type: TYPE_NORMAL
- en: And even Microsoft is heavily involved in Azure Security; it's not enough to
    put your data into Azure for it to be safe. The partnership with Microsoft takes
    care of one part of security and provides various tools and services to help you
    stay secure. However, you are responsible for how you implement these tools and
    put them to use.
  prefs: []
  type: TYPE_NORMAL
- en: Securing your identity
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Securing your identity is a very important part of IT security. Most data breaches
    happen as a result of social engineering or phishing attacks. So, in most cases,
    leaked credentials are responsible for breaches.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory offers a few tools to improve security, and one that
    stands up is **multi-factor authentication** (**MFA**). MFA requires users to
    provide additional security authentication after signing in. After a user provides
    a username and password, additional action is required to prove their identity. Many
    different tools can be used for additional checks, like biometric readers or card
    readers, but the most popular tool is a mobile device. After signing in, a user
    receives a notification on their mobile device and needs to provide additional
    confirmation. Notifications can be in the form of a phone call (the user needs
    to provide a code during the call), a text message (a user receives a code that
    needs to be provided during login), or an application (connected to the user account
    and requires confirmation that the user is trying to log in).
  prefs: []
  type: TYPE_NORMAL
- en: When MFA is enabled, leaked credentials are less of a concern, as stealing a
    username and password is not enough to access data anymore. Access to a user's
    mobile device is required to authorize your sign-in attempt, and this makes data
    breaching much harder.
  prefs: []
  type: TYPE_NORMAL
- en: Enabling multi-factor authentication
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Enabling MFA in Azure Active Directory is simple and fast. In Azure Active
    Directory, under User management you need to select Multi-Factor Authentication.
    An example is shown in the screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d7072359-f3db-423f-bf95-142b5e799985.png)'
  prefs: []
  type: TYPE_IMG
- en: 'A new window will open in which all MFA is done. Here, you can set up individual
    user settings or do bulk updates for multiple users. Under Service settings, you
    can also edit what options are available for MFA and choose between a phone call,
    text message, mobile app, or token. To enable a single user for MFA, select the
    user and click Enable in the settings on the right side, as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/32bbd793-cc46-41ee-9d99-932f4fcadf67.png)'
  prefs: []
  type: TYPE_IMG
- en: MFA is free for users with the global administrator role. So, there is no excuse
    for not adding an additional layer of security for admins as a leaked admin account
    can do far more damage than a regular user. However, if you want to enable MFA
    for all users, then an additional license is required. MFA comes with Azure Active
    Directory Premium, but can be licensed as a standalone service per user or per
    login.
  prefs: []
  type: TYPE_NORMAL
- en: Other identity security options
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Active Directory offers other services that can help you increase security.
  prefs: []
  type: TYPE_NORMAL
- en: Other service such as conditional access or privileged identity management can
    help us increase security and prevent unauthorized access. We can use audit logs
    and risky sign-ins to review who tried to access services and data and when. There
    are extensive Azure Active Directory logs that can be used for audits as well.
    Most of these features come with AAD Premium and aren't available with a basic
    or free license.
  prefs: []
  type: TYPE_NORMAL
- en: Securing the network
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The next step in staying secure is securing our network resources. Leaving a
    network unprotected can result in data breaches or service denial. Even the Azure
    networking stack comes with lots of security features, such as default DDOS protection
    or network security groups; sometimes this is not enough and we need to take additional
    steps.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Firewall
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Firewall is a managed, cloud-based network security service that protects
    Azure Virtual Network resources. It is Firewall as a Service with built-in high
    availability and scalability.
  prefs: []
  type: TYPE_NORMAL
- en: With Azure Firewall, you can create, enforce, and log application and network
    connectivity policies. Static public IP addresses for your virtual network resources
    allow outside firewalls to identify traffic originating from your virtual network.
    The service is integrated with Azure Monitor for logging and analytics.
  prefs: []
  type: TYPE_NORMAL
- en: Preparing the environment
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Firewall requires you to be connected to a subnet named AzureFirewallSubnet.
    We can create a new Azure VNet and a new subnet in the process of creating new
    Azure Firewall. But as I already have the VNet that I want to use, I'll add a
    new subnet to `PackVnet`, which was previously created.
  prefs: []
  type: TYPE_NORMAL
- en: 'An example of how to add a new subnet for Azure Firewall is shown in the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/cdefc1e3-463f-436c-869f-04d06174824f.png)'
  prefs: []
  type: TYPE_IMG
- en: Creating an Azure Firewall
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To create a new Azure Firewall, we need to provide a Subscription, Resource
    group, Name, and Location. Additionally, we need to provide a Virtual network
    and Public IP address. In both cases, we can Use existing resources or Create
    new ones. Note that for the existing virtual network, `AzureFirewallSubnet` must
    exist. Example parameters are shown in the screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/009801d9-757d-439e-865c-5506e2448322.png)'
  prefs: []
  type: TYPE_IMG
- en: After the deployment is finished, Azure Firewall is ready for use and we can
    start the configuration. For now, take note of the Private IP address (remember
    it or write it down), as we are going to need it in the next few steps.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Azure Firewall blade is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bd63d41f-4b2c-40d9-9377-a6b062c8972e.png)'
  prefs: []
  type: TYPE_IMG
- en: To deploy Azure Firewall, we can use ARM templates as well.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the ARM template to deploy a new Azure Firewall:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Azure Route Table
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now we want to create a route table that will direct all traffic through Azure
    Firewall. To create a new Azure Route Table, we need to provide a Name, Subscription,
    Resource group, and Location. Optionally, we can enable or disable BGP route propagation.
    An example of how to create a new route table is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2d75d61e-157b-446d-921f-5767afa60650.png)'
  prefs: []
  type: TYPE_IMG
- en: 'After the route table is created, we need to associate it with a subnet and
    create a route. Under the Subnets option in the route table blade, select Associate,
    as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/47884909-abd2-4f4c-92f3-daf9173e12e5.png)'
  prefs: []
  type: TYPE_IMG
- en: 'To associate a route table with a subnet, we need to provide a Virtual network
    and Subnet in that network. In the following example, the Virtual network PacktVnet
    is selected and the Subnet is default:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d2cdb8cd-26bc-4e40-a83a-9d5f37aa9a39.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Finally, we need to add a route. We need to provide a Route name, Address prefix,
    Next hop type, and Next hop address. For the Next hop type, we need to select
    Virtual appliance. Azure Firewall is a Firewall as a Service, but it still falls
    under this category. To create a similar effect, we could use any virtual appliance
    in which we would use third-party firewalls in IaaS mode. Under Next hop address,
    we enter the private IP address of our Azure Firewall (I previously mentioned
    that you needed to remember this address). An example of route settings is shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2945731a-cb3c-444c-8672-18d95d6c0963.png)'
  prefs: []
  type: TYPE_IMG
- en: All traffic from the default subnet in the `PacktVnet` virtual network is now
    routed to our Azure Firewall. We can proceed and create rules on what will be
    allowed or denied.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Azure Firewall
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Under Rules in the Azure Firewall blade, we have three options: NAT rule collection,
    Network rule collection, and Application rule collection. Depending on what we
    want to achieve, we can use NAT rules to rewrite the source address. We can use
    network rules to define traffic from what source is allowed to go to what target,
    or with application rules we can define FQDNs that are allowed or denied. An example
    of the Rules blade in Azure Firewall is shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bb40fad8-666f-4a33-b773-1398804379dc.png)'
  prefs: []
  type: TYPE_IMG
- en: Let's create a rule that will allow for traffic from the default subnet to VSTS.
    First, we need to provide a Name, Priority, and Action (Allow or Deny). Then we
    need to define SOURCE ADDRESSES, a PROTOCOL:PORT, and TARGET FQDNS. Optionally,
    we can add tags to our rule. For the SOURCE ADDRESSES, I'll add a subnet, as I
    want VSTS to be reached from anywhere on the subnet. You can use a smaller scope
    of IP addresses if you want to restrict where FQDN can be reached from.
  prefs: []
  type: TYPE_NORMAL
- en: 'The protocol will be HTTP and HTTPS and the TARGET FQDNS is `*.visualstudio.com`.
    An example of a new application rule is shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1466506a-541e-47b0-9b46-2241aaa2f216.png)'
  prefs: []
  type: TYPE_IMG
- en: Note that you can have more than one rule in a collection and you can create
    all rules that apply to a specific service in a single collection. This makes
    it easier to manage and maintain Azure Firewall rules.
  prefs: []
  type: TYPE_NORMAL
- en: If everything is configured correctly, you can go to VM, located in the default
    subnet, and open any browser. You should be able to access any VSTS collection,
    but nothing else will be allowed.
  prefs: []
  type: TYPE_NORMAL
- en: Other network security options
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Besides using default Azure components such as NSG, route tables, or even Azure
    Firewall, there are a number of third-party firewalls that are available as virtual
    appliances. Virtual appliances are set up as Azure VMs, and most industry leaders
    in network security are available in Azure. Managing virtual appliances has two
    components: managing Azure VM and managing firewalls. We already talked about
    managing Azure VMs, and managing firewalls depends on the manufacturer and isn''t
    any different than managing those firewalls on-premises.'
  prefs: []
  type: TYPE_NORMAL
- en: Other than that, we can collect logs from our network resources with Azure Monitor
    and Log Analytics to help us audit and troubleshoot Azure Network. There is another
    tool that can help us monitor Azure Network, which is called Network Watcher. Azure
    Network Watcher provides tools to monitor, diagnose, view metrics, and enable
    or disable logs for resources in an Azure virtual network.
  prefs: []
  type: TYPE_NORMAL
- en: With Azure Network Watcher, we can monitor endpoints, network flow, hops, VPNs,
    and everything else network-related. It's a great tool, as it allows us to graphically
    display our network schema and locate issues in an easier way.
  prefs: []
  type: TYPE_NORMAL
- en: Encryption
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Another important step in security is encryption. We want our data to be encrypted
    always—in rest and transit. Everything is redundant to ensure there is no data
    is lost, and even with three copies of that, all of them encrypted, we have the
    option to create additional redundancy with geo-replication and other settings.
  prefs: []
  type: TYPE_NORMAL
- en: All resources in Azure are encrypted at rest by default. But sometimes we need
    additional security to ensure data is more protected. For example, disks for our
    Azure VMs are encrypted inside the Azure data center, and even if the disk was
    accessed without authorization, no one could read data on that disk. But what
    if the disk was downloaded? In this case, the disk could be used. Data could be
    read or attached to another VM, or a VM could be created with that disk.
  prefs: []
  type: TYPE_NORMAL
- en: We can apply additional encryption and make our resources more secure by using
    **Azure Key Vault**.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Key Vault
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Key Vault is used to store secrets, keys, and certificates. It's a centralized
    management solution for holding, distributing, and controlling secrets, keys,
    and certificates. Secrets in Azure Key Vault can be called during deployment so
    you can prevent passwords from being shown in plain text. Keys can be used to
    encrypt storage and disks. You can use certificates in Azure Key Vault and assign
    them to services during deployment to secure SSL and TLS.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Key Vault greatly reduces the chances that secrets may be accidentally
    leaked, increases the security of your resources at rest by using keys to encrypt,
    and increases security in transit by assigning certificates.
  prefs: []
  type: TYPE_NORMAL
- en: Creating an Azure Key Vault
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To create a new Key Vault, we need to provide a Name, Subscription, Resource
    Group, and Location. We can optionally change the Pricing tier, assign Access
    policies, and provide Virtual Network Access. The tier comes with two options: Standard
    and Premium. The only difference is that Premium supports **hardware security
    modules** (**HSMs**). The default policy assigned is to grant all access to the
    person creating the vault. You can additionally add policies as needed at any
    time, either during creation or later. Virtual Network Access is granted to all
    networks in your subscription by default, but you can edit this and grant access
    to specific networks only. An example of the default settings is shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/39e071e3-ae20-4fcd-9102-79c6c7600ce4.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Creating an Azure Key Vault is relatively fast and should be completed in under
    one minute. Note the DNS Name, as this will be used later. An example of an Azure
    Key Vault blade is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1f76fda4-c3ea-465d-b0ab-854aabef74d2.png)'
  prefs: []
  type: TYPE_IMG
- en: 'To deploy Azure Key Vault, you can use the following ARM template:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Adding keys and secrets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After the Key Vault is created, we can add secrets and keys.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s first add a key that we''ll use for encryption later. Keys can be generated,
    imported, or restored from backup. An example of how to add a new key is shown
    here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a389addd-9dcc-4658-89db-14797600cd5d.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Secrets can be used to provide passwords when creating resources. When you
    are creating resources using an ARM template, you need to provide a password.
    To prevent the password from being shown as plain text, you can use secrets in
    Key Vault to provide a value for the password and prevent this. Secrets can be
    manually created or imported from the certificate. In this example, we can see
    how to add a new secret manually:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/15fdf418-7f07-4c14-9ee2-45537e1e730f.png)'
  prefs: []
  type: TYPE_IMG
- en: Similar to these two examples, you can add certificates. Certificates can be
    generated or imported. Note that if you want to use these certificates for publicly
    available applications, you must use a valid certificate issued by a public certification
    authority.
  prefs: []
  type: TYPE_NORMAL
- en: Encrypting the storage account
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As mentioned, most resources are encrypted by default, and the same goes with
    the Azure Storage Account. However, you have the option to use your own key to
    encrypt storage. To use your own key, you must select Use your own key, which
    will allow you to select the Key Vault and the key that will be used for encryption.
    An example is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/52f50779-c14a-44e9-99ae-3892c42b5586.png)'
  prefs: []
  type: TYPE_IMG
- en: The time it takes to encrypt storage depends on the amount of data in the storage
    account. For smaller storage, it's a matter of seconds, but with large storage
    accounts it can take hours until the process is completed. If you are encrypting
    large storage accounts in a production environment, try doing this outside of
    working hours as it may impact performance.
  prefs: []
  type: TYPE_NORMAL
- en: Encrypting databases
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Azure SQL Databases are encrypted with TDE. This option is now enabled by default
    when creating a new Azure SQL Database. If you have older databases, created before
    this became a default option, it''s enough to change the option to ON and save.
    The Transparent database encryption options in the Azure SQL Database blade are
    shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4025bb91-4b6a-400f-b00c-d0ee6b89bbb2.png)'
  prefs: []
  type: TYPE_IMG
- en: When TDE is enabled for Azure SQL Database, data and backups are encrypted at
    rest. But if you download or export a backup, this will no longer be the case.
    To have a database encrypted even after leaving Azure data center, we can use
    our own key for encryption. To do so we'll need to use Azure PowerShell.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Azure PowerShell
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: PowerShell is a command-line shell and scripting language based on the .NET
    Framework. It's used by system administrators to automate tasks and manage operating
    systems.
  prefs: []
  type: TYPE_NORMAL
- en: Azure PowerShell is a PowerShell module that allows us to automate and manage
    Azure resources.
  prefs: []
  type: TYPE_NORMAL
- en: To install Azure PowerShell, we need to have Windows PowerShell installed. Luckily,
    Windows PowerShell comes pre-installed on Microsoft OS from Windows 7 (Client
    OS) and Windows Server 2012 R2 (Server OS).
  prefs: []
  type: TYPE_NORMAL
- en: 'To install Azure PowerShell, we need to run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, we need to import the module:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'If the module is already installed, we can update it with:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'After we have successfully imported the module, we can connect to Azure with:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Using your own key for Azure SQL Database encryption
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To use our own key for Azure SQL Database TDE, we must execute a few commands.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we need to sign our Azure Active Directory identity in to our Azure
    SQL server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Second, we must grant Key Vault permission to our server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Third, we add the Key Vault key to the server and set the TDE protection level:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, we turn on the TDE:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: All parameters in Azure PowerShell script can be edited. To execute this on
    any Azure SQL Database using any Key Vault, change the names of the parameters
    accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: Encrypting VM disks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'A similar thing can be applied to Azure VMs. Disks are encrypted by default
    and data is protected at rest. But as mentioned, when a disk is exported or downloaded,
    it''s no longer protected. Using Key Vault, we can set additional encryption to
    our Azure VM disks and protect data in any situation. If we open disks in any
    of our Azure VMs, we can see that the disk is not encrypted, as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2333194d-b184-46db-9bef-69b8ae2acedd.png)'
  prefs: []
  type: TYPE_IMG
- en: 'To enable disk encryption, first we must enable the Key Vault for disk encryption:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Now we can enable disk encryption:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'The command will run in 5-15 minutes, depending on the size of the disk. After
    we receive a message that it''s completed, we can check the disk status again
    and see that encryption is enabled:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a311bb86-5c5f-41a6-85da-e959bf3e0cae.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure Security Center
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Security Center provides a central place for security management and advanced
    threat protection across Azure and the hybrid cloud. With security center, we
    can apply security policies across workloads, limit exposure to threats, and detect
    and respond to attacks. It comes in two tiers, free and standard. The free tier
    is enabled by default, and it provides a security policy, continuous security
    assessment, and actionable security recommendations to protect Azure resources.
    The standard tier extends to private or hybrid cloud workloads and adds advanced
    threat detection. Advanced threat detection uses built-in behavioral analytics
    and machine learning to identify attacks and zero-day exploits to reduce exposure
    to any type of attack.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Security Center overview
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The Overview dashboard in the Azure Security Center blade provides an instant
    summary of the security status of your Azure and non-Azure workloads, enabling
    you to discover and assess the security of your workloads and to identify and
    mitigate risks. We can see different metrics that allow us to instantly identify
    any security risks and see recommendations on what needs to be improved in our
    subscription based on best practices. An example of the Overview dashboard in
    Azure Security Center is shown in the screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bf282a44-618d-47ea-82a1-b35c8ecd5f57.png)'
  prefs: []
  type: TYPE_IMG
- en: Azure Security Center is a complex service with a lot of options. As with many
    other services, it deserves a book of its own and it would be hard to cover all
    options in a single chapter. We are going to concentrate on the most important
    ones that will help you instantly increase your security.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Security Center recommendations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Azure Security Center analyzes your security settings and compares them to
    best practices. Based on this, you can see recommended changes that need to be
    implemented under Security Center - Recommendations. Recommendations are divided
    into four categories—Compute & apps, Data & storage, Networking, and Identity
    & access (Preview). All resources can have three statuses: green, orange, and
    red. Green shows that all security best practices are enabled and that the resource
    is secure; orange represents recommendations that should be implemented but aren''t
    critical; and red shows recommendations that present high security risks and should
    be implemented immediately. We can also see our security score based on what is
    implemented and what remains to be resolved as a possible security risk. The Security
    Center - Recommendations blade is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/36668786-11ca-4f38-8c17-30b3cf19b595.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Let''s take the Compute section as an example. Here, we can find a list of
    all security issues that are related to compute resources (Vms and Computers,
    App services (Preview), and Cloud services). In this list of recommendations,
    we can see descriptions of issues and how many resources are affected by these
    issues. In the example here, we can see at the top of the list that 8 out of 10
    VMs don''t have endpoint protection enabled and that this is classified as red:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/67328018-7f64-4b78-921c-c864f6946501.png)'
  prefs: []
  type: TYPE_IMG
- en: Enabling endpoint protection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As an example, let''s click on this recommendation and resolve it. A new blade
    will open with a list of VMs that don''t have endpoint protection. We can select
    specific VMs or all of them, and can opt to install endpoint protection. Installation
    will start, and after it is completed, we''ll see that the recommendation is resolved:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4c989d75-1d8c-434e-b711-98c7ce19670f.png)'
  prefs: []
  type: TYPE_IMG
- en: Similar to this, we can resolve most security center recommendations. We click
    on the recommendation and follow the steps. However, some recommendations can't
    be resolved in this way and require additional steps. In this case, you will be
    taken to documentation that describes the issue and provides steps to resolving
    it.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Security Center Alerts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Alerts are another part of Azure Security Center; these are very helpful and
    allow you to detect possible issues. The security alerts section allows you to
    track and see when unauthorized access to your resources was attempted. In the
    overview of alerts in Azure Security Center, you can see a list of possible attacks
    on your resources and see when they happened, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e804c86b-050a-42b7-ad47-6fa0a6ff0faf.png)'
  prefs: []
  type: TYPE_IMG
- en: If we select any alerts, we will see more information such as a date, what credentials
    were used, the number of login attempts, and other information. Under Geo and
    Threat Intelligence Information, we can see from where an attack took place, giving
    us a detailed geographical location of the attack origin. Based on the login information
    and geo-location, we can detect if this was a legitimate user or a brute-force
    attack on our resources. If we have a valid user attempting this three times from
    a known location, we can assume this was a user who has simply forgotten their
    password.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we have 50 attempts from unknown user(s) from unknown location(s), we can
    assume it was a brute-force attack. Under Remediation steps, we have instructions
    on how to prevent similar attacks in the future. A sample of suspicious authentication
    activity is shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/50027950-2ffa-4fe1-bb98-5d0a09170e1d.png)'
  prefs: []
  type: TYPE_IMG
- en: 'At the bottom, we have two additional actions—Investigate and View playbooks.
    Investigate allows us to review details about incidents with more details. View
    playbooks allows us to create (or use an existing) logic app that will take action
    if similar events happen in the future. With a logic app, we can design steps
    and actions that will prevent attacks. For example, if login with an invalid user
    is attempted more than three times, it will add an NSG rule that will prevent
    access to a resource for the next 48 hours. An example of investigation details
    is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5584f19d-281c-4106-a3a1-dbc8806af21a.png)'
  prefs: []
  type: TYPE_IMG
- en: Just-in-Time access
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the best features in Azure Security Center is Just-in-Time access. Just-in-Time
    access prevents access to Azure VMs unless it's been specifically requested. By
    default, all management ports are closed, and you need to request access from
    specific IP address(es) for a short period of time to enable such access.
  prefs: []
  type: TYPE_NORMAL
- en: 'To set up Just-in-Time access on Azure VM, go to the Just-in-Time access blade
    in the Security Center and select one or more VMs from the list, as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/aaf61239-c0f0-4186-b737-17d88ea458cd.png)'
  prefs: []
  type: TYPE_IMG
- en: 'After you select the VM(s) that will have Just-in-Time access enabled, a new
    blade will open. Here we must define ports that will be closed by default and
    enabled only on request. The default ports are SSH (`22`), RDP (`3389`), and WinRM
    (`5985` and `5986`), but you can remove and add any port you want. An example
    of the default settings is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/552f65da-0fc6-4109-b93d-634de40cea5b.png)'
  prefs: []
  type: TYPE_IMG
- en: 'After Just-in-Time access is enabled, the option to connect to the VM will
    not be available. To access the VM, you must request access in Azure Security
    Center. Here, you need to define which port you want to open, from which IP address(es)
    it will be able to connect, and for how long (from 1 to 3 hours). An example of
    the request blade is shown here, where we can see how to open the RDP port from
    the current IP address for one hour:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/542743ad-46c8-48b7-acce-dff56bc2fcad.png)'
  prefs: []
  type: TYPE_IMG
- en: With Just-in-Time access, you are controlling who can access your VMs, when,
    and from where. Unauthorized access is brought to a minimum and your VMs are protected.
    Another amazing thing is that with Azure Security Center in the standard tier,
    you can register and protect resources in private and hybrid clouds. This option
    is not limited only to Azure VMs, but can be enabled for on-premises VMs as well.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Microsoft takes Azure Security very seriously. Lot of steps are taken to ensure
    your resources are protected and safe in Azure. In addition to this, Microsoft
    offers lots of additional services that we can use to improve security further.
    To be secure and achieve maximum, it takes combines effort from Microsoft and
    us, and we need to take advantage of the security services that Azure has to offer
    in addition to what Microsoft is already doing to secure our data and services. Besides
    security features that are declared as security services (such as Key Vault or
    security center), there are lots of security features that services have built
    in (such as Azure SQL Firewall or network security groups).
  prefs: []
  type: TYPE_NORMAL
- en: As we are getting toward the end, we are going to review what we have learned.
    In the last chapter, we are going to talk about services we already discussed
    and the best practices when using them. Infrastructure-as-Code is a very important
    part of cloud computing, and we're going to talk about tools that will allow us
    to work with Azure by automating tasks. Using the Azure portal is a great way
    to learn about Azure, but if you want to take full advantage, Infrastructure-as-Code
    is what you want to use.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Everything in Azure is redundant and has how many copies?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: One
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Two
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Three
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Most data breaches are caused by...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Brute-force attacks
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Leaked credentials
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Viruses
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: MFA stands for...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Multi-factor authentication
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Multi-factor authorization
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Multi-factor activation
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'MFA can be configured to use:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Phone calls
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Text messages
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: A mobile app
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: All of the above
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Firewall is...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Infrastructure as a Service
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Firewall as a Service
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Both
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure resources can be encrypted using...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: An Azure-provided key
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: A custom key
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Both
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: To use custom keys, we must use...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Security Center
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Key Vault
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Both
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Security Center provides...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Security management
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Advanced threat protection
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Both
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Security Center can be used to protect...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure resources
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: On-premises resources
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Both
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Just-in-Time access provides...
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Control over management access for our VMs
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Live monitoring of access to VMs
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Both
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
