<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-67"><a id="_idTextAnchor067"/>4</h1>
<h1 id="_idParaDest-68"><a id="_idTextAnchor068"/>Exploring Collaboration in Automation Development</h1>
<p>When you work as a team, collaboration is the key to your team’s harmony. Instead of keeping your automation content and knowledge to yourself, you can share it with your team, or even other departments. By doing that, the content will be useful to many others and also, they can contribute with their own ideas and tips. Compared to custom scripts, Ansible content is human-readable and easy for others to understand. Hence, they can modify it and later contribute to the content by fixing bugs or adding features. It is possible to use any standard methods to keep and distribute your Ansible automation content, such as a Git server, Subversion, or any other <strong class="bold">Version Control System</strong> (<strong class="bold">VCS</strong>). </p>
<p>In this chapter, you will learn about the following topics: </p>
<ul>
<li>The importance of version control in IT automation</li>
<li>Where should I keep automation artifacts?</li>
<li>Managing automation content in a Git server </li>
<li>Collaboration is the key to automation </li>
</ul>
<p>You will start by looking at GitHub account configuration and access management to share content with your team. You will also learn how to manage contributions from other users without losing the original content.</p>
<p>This chapter focuses on Git and how to use Git for Ansible content. If you are familiar with Git and GitHub, then you may skip the sections about those topics.</p>
<h1 id="_idParaDest-69"><a id="_idTextAnchor069"/>Technical requirements</h1>
<p>The following are the technical requirements to proceed with this chapter:</p>
<ul>
<li>One Linux machine for the Ansible control node.</li>
<li>One or more Linux machines with Red Hat repositories configured (if you are using other Linux operating systems instead of RHEL machines, then make sure you have appropriate repositories configured to get packages and updates).</li>
<li>An email ID to create a new GitHub account (if you don’t already have a GitHub account).</li>
<li>Basic knowledge about source control server and version control systems.</li>
</ul>
<p>All the Ansible code, Ansible playbooks, commands, and snippets for this chapter can be found in the GitHub repository at <a href="https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-04">https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-04</a>.</p>
<h1 id="_idParaDest-70"><a id="_idTextAnchor070"/>The importance of version control in IT automation</h1>
<p>Like any <a id="_idIndexMarker205"/>other software, configurations, or scripts, it is not a best practice to keep your Ansible playbooks and configurations on the local machine, which is the Ansible control node. There are many reasons for not keeping the automation content on the local Ansible control node. A few of them are listed here:</p>
<ul>
<li>If something happens to the Ansible control node, you will lose all your automation content, which is not desirable.</li>
<li>If someone accidentally deletes any files or changes any configurations, you will not have the opportunity to restore the original content. </li>
<li>If you want to make any changes to configurations or playbooks, then you need to make a backup of files and configurations. This is general practice in case something goes wrong and you want to restore an old version of your files.</li>
</ul>
<p>You need to consider the Ansible automation content as software code, which should keep track of every change and have the option to use old versions at any point in time. Keeping multiple versions of the content will give you the freedom and confidence to make continuous changes to your automation playbooks and configurations. This will also implement the <em class="italic">single-source-of-truth</em> practice where your Ansible playbooks and variables reside in a central place and track all the changes. </p>
<p>VCSs, such as Git and Subversion, will help you to keep a track of the changes for your Ansible automation content and configurations. Depending on the technology, all these tools will create new versions of your content whenever there are changes made to it. </p>
<p>You will keep your <a id="_idIndexMarker206"/>content in Git servers as repositories, which are collections of files and directories. It is possible to create and maintain multiple Git repositories based on the content, such as one Git repository for keeping package installation playbooks and tasks, another Git repository for Linux remediation automation, and so on. You will practice creating and managing Git repositories in the following sections of this chapter.</p>
<p class="callout-heading">Git Documentation</p>
<p class="callout">Check <a href="https://git-scm.com/doc">https://git-scm.com/doc</a> for the<a id="_idIndexMarker207"/> reference manual, books, and videos to learn Git. Learn the important terminologies in Git, such as branch, commit, push, pull, clone, and staging. Since this book is focused on Ansible, we will not go into detail about these topics.</p>
<p class="callout">Please <a id="_idIndexMarker208"/>note that <strong class="bold">Software Configuration Management</strong> (<strong class="bold">SCM</strong>) is not the same as VCS but VCS is a part or subset of SCM. </p>
<h2 id="_idParaDest-71"><a id="_idTextAnchor071"/>Selecting a Git server</h2>
<p>Choose any type of VCS, but in this chapter, we will focus on how to use Git servers for storing your Ansible automation content. Organizations use enterprise Git solutions <a id="_idIndexMarker209"/>such as <strong class="bold">GitHub Enterprise</strong>, GitLab <strong class="bold">Enterprise Edition</strong> (<strong class="bold">EE</strong>), and <strong class="bold">Atlassian Bitbucket</strong>. If you do not have<a id="_idIndexMarker210"/> a Git<a id="_idIndexMarker211"/> server in your environment, then it is possible to easily set up one using any of the free and open source solutions available, such<a id="_idIndexMarker212"/> as <a id="_idIndexMarker213"/>GitLab <strong class="bold">Community Edition</strong> (<strong class="bold">CE</strong>), Gogs, and <a id="_idIndexMarker214"/>Gitea. Most of them are included a web <strong class="bold">Graphical User Interface</strong> (<strong class="bold">GUI</strong>) and you can use them for any general Git use cases, including Ansible automation content. </p>
<h3>GitHub</h3>
<p>GitHub is a <a id="_idIndexMarker215"/>hosted service provider for version control repositories and other <strong class="bold">Continuous Integration/Continuous Delivery</strong> (<strong class="bold">CI/CD</strong>) operations. It is possible to create a personal GitHub account and create unlimited public or private repositories to store your software or configurations. One of the main limitations of GitHub is that you cannot host a private GitHub server for your environment. </p>
<h3>GitLab</h3>
<p>GitLab (<a href="http://gitlab.com">gitlab.com</a>) is <a id="_idIndexMarker216"/>another <a id="_idIndexMarker217"/>hosted VCS provider similar to GitHub but with different features and services. GitLab offers public-hosted servers (<a href="http://gitlab.com">gitlab.com</a>) and also private hosting via GitLab EE or CE. </p>
<p class="callout-heading">How to Install a Git Server</p>
<p class="callout">Refer to <a href="https://www.techbeatly.com/build-your-own-git-server-using-gogs/">https://www.techbeatly.com/build-your-own-git-server-using-gogs/</a> to learn how to install a Git server <a id="_idIndexMarker218"/>using Gogs inside a simple Docker container. If you want to install GitLab CE, then refer to the documentation at <a href="https://about.gitlab.com/install/">https://about.gitlab.com/install/</a> for detailed instructions.</p>
<p>We have learned the importance of storing Ansible automation content in Git servers and about the different Git servers available to use. In the next section, we will learn the best practices for storing Ansible content in Git and repository guidelines.</p>
<h1 id="_idParaDest-72"><a id="_idTextAnchor072"/>Where should I keep automation artifacts?</h1>
<p>Keep<a id="_idIndexMarker219"/> your playbooks and configurations in multiple Git repositories based on the automation and content type. </p>
<h2 id="_idParaDest-73"><a id="_idTextAnchor073"/>Ansible and Git repositories – best practices </h2>
<p>There are <a id="_idIndexMarker220"/>many best practices for keeping your Ansible automation content in a VCS. </p>
<h3>Repository for Ansible roles</h3>
<p>If you are creating<a id="_idIndexMarker221"/> Ansible roles alone (it is no longer common to create individual roles for distribution without a collection), then create one Git repository per role so that the development and collaboration will be easy without depending on other tasks and configurations. See the sample ansible-role repositories in <em class="italic">Figure 4.1</em>.</p>
<div><div><img alt="Figure 4.1 – Separate repositories for Ansible roles " height="247" src="img/B18383_04_01.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.1 – Separate repositories for Ansible roles</p>
<h3>Repositories for Ansible collections</h3>
<p>If you are<a id="_idIndexMarker222"/> creating Ansible collections, then create one Git repository per collection to make the development and management easy. Move your existing Ansible roles, libraries, modules, and other plugins to an Ansible collection repository and distribute them in a standard way. See the sample ansible-collection repositories in <em class="italic">Figure 4.2</em>.</p>
<div><div><img alt="Figure 4.2 – Ansible collection repositories " height="169" src="img/B18383_04_02.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.2 – Ansible collection repositories</p>
<h3>Dedicated repositories for teams</h3>
<p>It is a best practice <a id="_idIndexMarker223"/>to create different repositories for different teams if they are working on different items as it will make repository management easy and transparent. </p>
<h3>Dedicated repositories for inventories</h3>
<p>Keeping inventories for different environments and groups in separate Git repositories will help <a id="_idIndexMarker224"/>you to use them efficiently in playbooks. Also, this practice will avoid the accidental execution of automation jobs in wrong inventories. For example, you can keep production servers in one repository and development servers in another repository, as shown in <em class="italic">Figure 4.3</em>:</p>
<div><div><img alt="Figure 4.3 – Ansible inventory directory structure for different environments " height="512" src="img/B18383_04_03.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.3 – Ansible inventory directory structure for different environments</p>
<p>By separating inventories for different environments into different Git repositories, it is possible to  control the access to these inventories’ data as well, such as who can modify or use this content.</p>
<p>If you use an Ansible controller, this practice will also help you as it is possible to import inventories from project repositories. Read <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/inventories.xhtml#sourced-from-a-project">https://docs.ansible.com/automation-controller/latest/html/userguide/inventories.xhtml#sourced-from-a-project</a> to find out more.</p>
<h1 id="_idParaDest-74"><a id="_idTextAnchor074"/>Managing automation content in a Git server</h1>
<p>In this section, you <a id="_idIndexMarker225"/>will learn how to create a GitHub (<a href="http://github.com">github.com</a>) account, create, install, and configure the repositories, and keep Ansible automation content inside the repositories.</p>
<h2 id="_idParaDest-75"><a id="_idTextAnchor075"/>Setting up a GitHub account</h2>
<p>If you<a id="_idIndexMarker226"/> already have a GitHub personal or enterprise account, then you can skip the account creation steps:</p>
<ol>
<li>Open your web browser and go to <a href="http://github.com">github.com</a>, then click the <strong class="bold">Signup</strong> button in the top-right corner of the page.</li>
<li>Enter your email address and a password and username on the next screen, as shown in <em class="italic">Figure 4.4</em>. GitHub will tell you whether the username is available as usernames in GitHub must be unique:</li>
</ol>
<div><div><img alt="Figure 4.4 – Creating a GitHub account " height="643" src="img/B18383_04_04.jpg" width="1179"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.4 – Creating a GitHub account</p>
<ol>
<li value="3">Click <strong class="bold">Continue</strong> and finish the simple puzzle (CAPTCHA) on the next screen to verify your identity. Once done, create your account.</li>
<li>On the next screen, GitHub will ask you for the one-time code that you will receive on your registered email. Check your email inbox for the code (<em class="italic">Figure 4.5</em>).</li>
</ol>
<div><div><img alt="Figure 4.5 – Fetching the activation token from your mailbox " height="698" src="img/B18383_04_05.jpg" width="1071"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.5 – Fetching the activation token from your mailbox</p>
<ol>
<li value="5">Enter <a id="_idIndexMarker227"/>the code into the GitHub window and complete the signup process (<em class="italic">Figure 4.6</em>).</li>
</ol>
<div><div><img alt="Figure 4.6 – Inputting the one-time token in GitHub " height="561" src="img/B18383_04_06.jpg" width="1101"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.6 – Inputting the one-time token in GitHub</p>
<ol>
<li value="6">Now, you will be taken to the<a id="_idIndexMarker228"/> GitHub home page with your activated account (<em class="italic">Figure 4.7</em>).</li>
</ol>
<div><div><img alt="Figure 4.7 – GitHub account home page " height="554" src="img/B18383_04_07.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.7 – GitHub account home page</p>
<p class="callout-heading">Other Git Servers</p>
<p class="callout">Use any other Git services, such<a id="_idIndexMarker229"/> as GitLab (https://gitlab.com) or Bitbucket (<a href="https://bitbucket.org">https://bitbucket.org</a>), and <a id="_idIndexMarker230"/>the sign-up process will be more or less the same.</p>
<h2 id="_idParaDest-76"><a id="_idTextAnchor076"/>Creating your first Git repository</h2>
<p>In this exercise, you<a id="_idIndexMarker231"/> will create a new Git repository to store your playbooks and configurations:</p>
<ol>
<li value="1">From the GitHub home page, click the <strong class="bold">+</strong> icon in the upper-right corner and select <strong class="bold">New repository</strong> from the menu.</li>
</ol>
<div><div><img alt="Figure 4.8 – Creating a new repository " height="193" src="img/B18383_04_08.jpg" width="268"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.8 – Creating a new repository</p>
<ol>
<li value="2">Enter<a id="_idIndexMarker232"/> the details of the new repository, such as the repository name and description. Also select the visibility of the repository as a public or private repository. Also, tick the <strong class="bold">Add a README file</strong> option as shown in <em class="italic">Figure 4.9</em>.</li>
</ol>
<div><div><img alt="Figure 4.9 – Entering a new repository name and details " height="787" src="img/B18383_04_09.jpg" width="900"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.9 – Entering a new repository name and details</p>
<p class="callout-heading">Note</p>
<p class="callout">It is possible to change all these configurations at any time, but it is a best practice not to change the repository name as it may break your integrations and paths. </p>
<p>Once you<a id="_idIndexMarker233"/> have entered all the details, click on the <strong class="bold">Create repository</strong> button.</p>
<ol>
<li value="3">GitHub will show the repository with default <code>README.md</code> file content (<em class="italic">Figure 4.10</em>). This file was created automatically because we ticked the <strong class="bold">Add a README file</strong> option in the previous step.</li>
</ol>
<div><div><img alt="Figure 4.10 – GitHub repository default view with README.md file " height="554" src="img/B18383_04_10.jpg" width="1102"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.10 – GitHub repository default view with README.md file</p>
<p><code>README.md</code> is a <a id="_idIndexMarker234"/>special file <a id="_idIndexMarker235"/>that will be used to communicate important information about the repository or directory inside a repository. GitHub will render and show the content of the <code>README.md</code> file as an HTML-equivalent format, which is a great way to add your repository information, documentation, and more. </p>
<p class="callout-heading">Markdown Format</p>
<p class="callout">The <code>.md</code> extension<a id="_idIndexMarker236"/> is used for Markdown files, which is a lightweight markup language. Markdown language is used for creating formatted text using plain-text editors that is later rendered to HTML or other formats. Read <a href="https://www.markdownguide.org/getting-started">https://www.markdownguide.org/getting-started</a> for more details.</p>
<h2 id="_idParaDest-77"><a id="_idTextAnchor077"/>Installing Git on a local machine</h2>
<p>Create and manage your Git repository and content from the GitHub web UI itself, but this is limited as you cannot do any bulk operations, such as changing multiple files in a single commit. You can manage your repository and content from any compatible Git CLI or GUI tools, such as the default Git CLI, GitHub Desktop, Sourcetree, TortoiseGit, SmartGit, and Tower. </p>
<p>In this exercise, you will install and use the Git command-line utility to access and manage your Git repositories:</p>
<ol>
<li value="1">To install Git on the Ansible control node, use the following:<pre>[ansible@ansible ~]$ sudo yum install git</pre></li>
<li>Next, verify the Git version:<pre>[ansible@ansible ~]$ git version
git version 2.27.0</pre></li>
<li>Configure <a id="_idIndexMarker237"/>the Git username and email address. This step will update the global username and email address for your Git environment. You need to use the username and email address that you used during the GitHub account creation:<pre>[ansible@ansible ~]$ git config --global user.name “demouser-2022”
[ansible@ansible ~]$ git config --global user.email “M demo1@techbeatly.com”</pre></li>
</ol>
<p>Note that it is possible to use any other dummy username or email address as this information is not used as credentials for GitHub access but the identity for local users.</p>
<p class="callout-heading">Git CLI and GUI Clients</p>
<p class="callout">Check out <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">https://git-scm.com/book/en/v2/Getting-Started-Installing-Git</a> to find out how to install Git on different operating systems. Git GUI clients are used for better management of Git repositories without much command-line execution. Check out https://git-scm.com/downloads/guis for available Git GUI clients. </p>
<h2 id="_idParaDest-78"><a id="_idTextAnchor078"/>Configuring SSH keys in GitHub</h2>
<p>It is possible to <a id="_idIndexMarker238"/> access and manage your GitHub repositories using your username and password, but it is not desirable to enter the username and password every time you want to update something in the Git server. This is where we can utilize SSH keys, and you can use the same or different SSH keys to configure GitHub access.</p>
<p>In this <a id="_idIndexMarker239"/>exercise, you will configure the SSH public keys to GitHub for seamless and password-less access from the Git client:</p>
<ol>
<li value="1">Fetch the SSH public key content. Use the same SSH key pairs that were created in the <em class="italic">Setting up SSH key-based authentication</em> section in <a href="B18383_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Ansible Automation – Introduction</em>. Copy the public key content as shown in <em class="italic">Figure 4.11</em>:</li>
</ol>
<div><div><img alt="Figure 4.11 – Copy SSH public key content " height="274" src="img/B18383_04_11.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.11 – Copy SSH public key content</p>
<ol>
<li value="2">Go to <strong class="bold">GitHub</strong> | <strong class="bold">Settings</strong>.</li>
</ol>
<div><div><img alt="Figure 4.12 – Opening the GitHub settings " height="521" src="img/B18383_04_12.jpg" width="234"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.12 – Opening the GitHub settings</p>
<ol>
<li value="3">Select <a id="_idIndexMarker240"/>the <strong class="bold">SSH and GPG keys</strong> tab on the left (<em class="italic">Figure 4.13</em>).</li>
</ol>
<div><div><img alt="Figure 4.13 – GitHub account SSH and GPG keys configuration  " height="780" src="img/B18383_04_13.jpg" width="1060"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.13 – GitHub account SSH and GPG keys configuration </p>
<ol>
<li value="4">Click on<a id="_idIndexMarker241"/> the <strong class="bold">New SSH key</strong> button and enter a title (any identifiable name) and the SSH public key content that we copied in <em class="italic">Step 1</em>. Click on <strong class="bold">Add SSH key</strong>.</li>
</ol>
<div><div><img alt="Figure 4.14 – Adding SSH public key content " height="468" src="img/B18383_04_14.jpg" width="905"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.14 – Adding SSH public key content</p>
<p>GitHub will ask for your password to confirm this SSH key addition task.</p>
<ol>
<li value="5">Verify<a id="_idIndexMarker242"/> that the SSH key has been added (<em class="italic">Figure 4.15</em>).</li>
</ol>
<div><div><img alt="Figure 4.15 – Verifying SSH keys  " height="569" src="img/B18383_04_15.jpg" width="1279"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.15 – Verifying SSH keys </p>
<p>Add any number of keys here; for example, if you want to manage your GitHub repository from <a id="_idIndexMarker243"/>another workstation (or your laptop), then add the SSH public key from that workstation here. Also, note that if you find that any of the SSH keys are not in use or have been compromised, you can remove them from this page and deny access.</p>
<p class="callout-heading">Adding SSH Keys to GitHub</p>
<p class="callout">Refer to the documentation at <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account</a> for more details.</p>
<h2 id="_idParaDest-79"><a id="_idTextAnchor079"/>Adding content to the Git repository</h2>
<p>In this exercise, you<a id="_idIndexMarker244"/> will add your previously  created automation playbooks  (in <a href="B18383_02.xhtml#_idTextAnchor043"><em class="italic">Chapter 2</em></a>, <em class="italic">Starting with Simple Automation</em>) and configurations to the newly created GitHub repository. To achieve that, you need to <strong class="bold">clone</strong> the remote repository (on <a href="http://github.com">github.com</a>) to a local machine:</p>
<ol>
<li value="1">Go to GitHub and access your repository.</li>
</ol>
<div><div><img alt="Figure 4.16 – GitHub repository details " height="674" src="img/B18383_04_16.jpg" width="1294"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.16 – GitHub repository details</p>
<ol>
<li value="2">Find the <strong class="bold">Code</strong> button, click on the drop-down arrow, switch to the <strong class="bold">SSH</strong> option, and <a id="_idIndexMarker245"/>copy the command to clone the repository to your local machine.</li>
</ol>
<div><div><img alt="Figure 4.17 – Getting the GitHub repository URL " height="351" src="img/B18383_04_17.jpg" width="910"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.17 – Getting the GitHub repository URL</p>
<p>Since you have configured the SSH keys, you can use the SSH-based clone and access the repository. If you are using HTTPS-based cloning, GitHub will ask for your username and password every time you update the content back to the remote repository.</p>
<ol>
<li value="3">On your Ansible control node, execute the <code>git clone</code> command:</li>
</ol>
<div><div><img alt="Figure 4.18 – Clone Git repository to local machine " height="247" src="img/B18383_04_18.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.18 – Clone Git repository to local machine</p>
<ol>
<li value="4">Check the content of the cloned Git repository:</li>
</ol>
<div><div><img alt="Figure 4.19 – Listing content of cloned Git repository " height="247" src="img/B18383_04_19.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.19 – Listing content of cloned Git repository</p>
<p>See the <code>README.md</code> file that <a id="_idIndexMarker246"/>was created automatically when you created the Git repository. The <code>.git</code> directory contains all the information about this repository, including remote repository and commit details. </p>
<ol>
<li value="5">Move/copy the files you created in the <code>Chapter-02</code> exercise to this directory and verify the files are inside the directory as shown in <em class="italic">Figure 4.20</em>:</li>
</ol>
<div><div><img alt="Figure 4.20 – Content of Git local repository after files moved " height="328" src="img/B18383_04_20.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.20 – Content of Git local repository after files moved</p>
<ol>
<li value="6">Check <code>git status</code> and notice the changes as shown in <em class="italic">Figure 4.21</em>:</li>
</ol>
<div><div><img alt="Figure 4.21 – git status output for untracked files " height="379" src="img/B18383_04_21.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.21 – git status output for untracked files</p>
<p>From<a id="_idIndexMarker247"/> the preceding output, you can understand the following facts:</p>
<ul>
<li>The <code>ansible.cfg</code>, <code>chrony.conf.sample</code>, <code>hosts</code>, and <code>install-package.yaml</code> files are not in the Git database and <a id="_idIndexMarker248"/>are called <strong class="bold">untracked files</strong>.</li>
<li>If you want to add them to Git, you need to use the <code>git add</code> command.</li>
</ul>
<ol>
<li value="7">Add untracked files to Git (you can add them one by one or all at once):<pre>[ansible@ansible ansible-package-installation]$ git add *</pre></li>
</ol>
<p>Check the <code>git status</code> again as shown in <em class="italic">Figure 4.22</em>.</p>
<div><div><img alt="Figure 4.22 – git status after adding file to the Git repository " height="328" src="img/B18383_04_22.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.22 – git status after adding file to the Git repository</p>
<p>Also note that the files are not transferred to the remote repository (GitHub) yet.</p>
<ol>
<li value="8">Commit<a id="_idIndexMarker249"/> the changes to Git using the <code>git commit</code> command. Use appropriate comments to identify the change in the repository:</li>
</ol>
<div><div><img alt="Figure 4.23 – git commit output " height="247" src="img/B18383_04_23.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.23 – git commit output</p>
<ol>
<li value="9">Now, push the changes to the remote repository using the <code>git push</code> command as shown in <em class="italic">Figure 4.24</em>:</li>
</ol>
<div><div><img alt="Figure 4.24 – Push changes to the remote Git repository " height="274" src="img/B18383_04_24.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.24 – Push changes to the remote Git repository</p>
<p>This will transfer all the files and changes to the remote repository. </p>
<ol>
<li value="10">Verify the content on GitHub.</li>
</ol>
<div><div><img alt="Figure 4.25 – Verifying pushed content on the remote repository " height="712" src="img/B18383_04_25.jpg" width="1287"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.25 – Verifying pushed content on the remote repository</p>
<p>As we can see, the files are already available on the Git repository.</p>
<ol>
<li value="11">Verify the<a id="_idIndexMarker250"/> commit history on GitHub. Click on the <strong class="bold">Commits</strong> link (below the <strong class="bold">Code</strong> button as shown in <em class="italic">Figure 4.25</em>) and check the commits.</li>
</ol>
<div><div><img alt="Figure 4.26 – Verifying Git commits in GitHub " height="390" src="img/B18383_04_26.jpg" width="1279"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.26 – Verifying Git commits in GitHub</p>
<p>You can explore commits and history by<a id="_idIndexMarker251"/> referring to the Git documentation here: https://git-scm.com/docs/gittutorial.</p>
<p>Now we have learned <a id="_idIndexMarker252"/>how to add Ansible content to a Git repository and see the version history from the GitHub UI. In the next section, we will learn how to manage contributions and collaborative development in a Git repository.</p>
<h1 id="_idParaDest-80"><a id="_idTextAnchor080"/>Collaboration is the key to automation</h1>
<p>Now you have<a id="_idIndexMarker253"/> your Ansible automation content in your GitHub repository. There are several advantages to this:</p>
<ul>
<li>You do not need to take a backup of your files before you make changes (once you make the changes, remember to test, commit, and push the changes to a remote GitHub repository).</li>
<li>Pull the content to any of the machines whenever needed and test it. For example, you can download the code to your local workstation and develop it further. Once you make the changes, push it back to the remote repository; a new version of the code will be stored there.</li>
<li>Other users and developers can test and contribute to your code without having access to your Ansible control node. You just need to allow appropriate access to other users.</li>
<li>If any of the code is not working after an update, you can revert to an old version of the code at any point in time.</li>
</ul>
<p>Let’s learn how to use Git branching in the next session.</p>
<h2 id="_idParaDest-81"><a id="_idTextAnchor081"/>Using Git branching</h2>
<p>Git provides a <a id="_idIndexMarker254"/>feature called branching, which will help you to create <a id="_idIndexMarker255"/>multiple versions (or branches) of code in the same Git repository. A <code>main</code> (formerly <code>master</code>) and all your Git commits go to the <code>main</code> branch.</p>
<p>You can create multiple branches on the Git repository to take advantage of the Git workflow:</p>
<ul>
<li>Create multiple branches for <code>development</code> and <code>staging</code> to track the changes. Once the content of <code>development</code> and <code>staging</code> branches are tested and confirmed as good content, then you can merge the content from these <code>development</code> and <code>staging</code> branches to the <code>main</code> branch of your Git repository. With this practice, the <code>main</code> branch will contain only tested and clean code.</li>
<li>Create different branches for patching or bug fixes and merge them to the <code>main</code> branch once tested. </li>
<li>Create a branch for users to contribute their code and merge to the <code>main</code> branch once tested.</li>
</ul>
<p>You can choose any type of branching strategy based on your development workflow and the organization’s requirements. For our exercise, we will be using a simple Git branching strategy, as shown in <em class="italic">Figure 4.27</em>:</p>
<div><div><img alt="Figure 4.27 – Git branching " height="389" src="img/B18383_04_27.jpg" width="725"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.27 – Git branching</p>
<p>Git branching and merging may happen for different reasons. The following are the typical tasks involved in the Git workflow:</p>
<ul>
<li>The <code>main</code> branch will contain the code, for example, version 1.0 of your automation content.</li>
<li>Create new feature branches as needed. Once the feature branch is tested and good to use, you <a id="_idIndexMarker256"/>will raise a merge request (<strong class="bold">PR</strong>, or <strong class="bold">pull request</strong>). This is the stage where a contributor informs the maintainer of the Git repository to review code in the feature branch and merge it into the main branch of the project. You can call this version of code <strong class="bold">2.0</strong>, for example.</li>
<li>If you find any issues in the code, duplicate a bugfix branch (same as the feature branch) and raise another PR to merge the changes into the main branch. You can call this version <strong class="bold">2.1</strong> here.</li>
</ul>
<p>Let’s look at an example to understand this concept better.</p>
<h2 id="_idParaDest-82"><a id="_idTextAnchor082"/>Implementing Git branching</h2>
<p>In this exercise, you will learn <a id="_idIndexMarker257"/>how to create multiple branches and contribute as different users.</p>
<p>In this exercise, I am using another workstation to clone the previously created repository as a different GitHub user (for example, <code>ginigangadharan</code>). Create another GitHub account or ask your friend if you can use their account to test this:</p>
<ol>
<li value="1">Fork the original repository from the web browser as a different user (eg: <code>ginigangadharan</code>). Click on the <strong class="bold">Fork</strong> button as shown in <em class="italic">Figure 4.28</em>.</li>
</ol>
<div><div><img alt="Figure 4.28 – Opening the repository as a different user " height="351" src="img/B18383_04_28.jpg" width="1220"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.28 – Opening the repository as a different user</p>
<ol>
<li value="2">GitHub will ask for the target account as shown in the <em class="italic">Figure 4.29</em> (if you have other organization accounts) to fork the repository and will create a copy of the original <a id="_idIndexMarker258"/>repository in the new user account.</li>
</ol>
<div><div><img alt="Figure 4.29 – Forking the repository " height="349" src="img/B18383_04_29.jpg" width="764"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.29 – Forking the repository</p>
<p>Now you can see a new repository created under the new account, which is forked from the original repository.</p>
<div><div><img alt="Figure 4.30 – Forked repository details " height="190" src="img/B18383_04_30.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.30 – Forked repository details</p>
<ol>
<li value="3">Clone this repository to your workstation and check the content; remember to clone with the<a id="_idIndexMarker259"/> new repository URL:</li>
</ol>
<div><div><img alt="Figure 4.31 – Clone the Git repository from new user account " height="484" src="img/B18383_04_31.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.31 – Clone the Git repository from new user account</p>
<ol>
<li value="4">Create<a id="_idIndexMarker260"/> a new Git branch called <code>feature-1</code>:<pre>$ git branch feature-1</pre></li>
<li>Switch to the new branch:<pre>$ git checkout feature-1
Switched to branch ‘feature-1’</pre></li>
<li>Check the Git branches:<pre>$ git branch
* feature-1
  Main</pre></li>
</ol>
<p>Here, you can see the <code>*</code> symbol, which denotes the current branch.</p>
<ol>
<li value="7">Now, you can update your code, for example, change some lines of code or add some tasks to the playbook.</li>
<li>Check git <code>status</code> to see the changes:</li>
</ol>
<div><div><img alt="Figure 4.32 – Git status after updating repositry content " height="274" src="img/B18383_04_32.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.32 – Git status after updating repositry content</p>
<p>You can see that <code>install-package.yaml</code> (or whichever file you have changed) is highlighted there.</p>
<ol>
<li value="9">Add the <a id="_idIndexMarker261"/>changed file and commit the changes to Git; remember to use appropriate commit messages to identify the changes:</li>
</ol>
<div><div><img alt="Figure 4.33 – Add update to Git and commit changes " height="169" src="img/B18383_04_33.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.33 – Add update to Git and commit changes</p>
<ol>
<li value="10">Check git <code>log</code> to review the commit history as shown in <em class="italic">Figure 4.34</em>:</li>
</ol>
<div><div><img alt="Figure 4.34 – Details of commits in Git logs " height="536" src="img/B18383_04_34.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.34 – Details of commits in Git logs</p>
<ol>
<li value="11">Push <a id="_idIndexMarker262"/>the new branch and changes to the remote repository:</li>
</ol>
<div><div><img alt="Figure 4.35 – Push the changes to remote GIt repository " height="219" src="img/B18383_04_35.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.35 – Push the changes to remote GIt repository</p>
<p>Now the updated code is available in the new user’s GitHub repository, which is a forked copy of the original repository.</p>
<ol>
<li value="12">Go to the new user’s GitHub repository and select <strong class="bold">Pull requests</strong>.</li>
</ol>
<div><div><img alt="Figure 4.36 – Pull requests in the GitHub repository " height="410" src="img/B18383_04_36.jpg" width="1100"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.36 – Pull requests in the GitHub repository</p>
<ol>
<li value="13">Click <a id="_idIndexMarker263"/>on the <strong class="bold">New pull request</strong> button. Select the repository and branches and click on the <strong class="bold">Create pull request</strong> button to submit a PR (provide the PR comment as required):</li>
</ol>
<div><div><img alt="Figure 4.37 – Create a pull request in the GitHub repository " height="327" src="img/B18383_04_37.jpg" width="1085"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.37 – Create a pull request in the GitHub repository</p>
<ol>
<li value="14">Now, go back to the <code>demouser-2022</code> user’s GitHub account and check the PRs. You will find the PR from the other user (that is, <code>ginigangadharan</code>) and can open the PR. Verify the merge, check for any conflicts, and click on the <strong class="bold">Merge pull request</strong> button to accept the changes from this user.</li>
</ol>
<div><div><img alt="Figure 4.38 – Pull request details in GitHub repository " height="890" src="img/B18383_04_38.jpg" width="986"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.38 – Pull request details in GitHub repository</p>
<p>Now you have the<a id="_idIndexMarker264"/> latest contribution from another user in your Git repository. </p>
<p>Please note that this is a very basic Git workflow, and you need to include additional steps, such as adding PR approvals, creating tests before merging to the <code>main</code> branch, and other policies as required. </p>
<p>Accept contributions from other users and teams using the preceding workflow without giving full access to your repository, which is a common method used for any other open source software. </p>
<h1 id="_idParaDest-83"><a id="_idTextAnchor083"/>Summary</h1>
<p>In this chapter, you have learned the importance of version control in an IT automation environment. You have learned the basics of Git and different Git servers and providers. You have practiced creating a GitHub account, Git repository, and other steps. You also learned how to accept contributions to your Git content, branching methods, and PR processes. </p>
<p>In the next chapter, you will learn how to find more automation use cases from your workplace and personal projects. You will also learn more about inventory management and different strategies to keep your managed nodes’ information.</p>
<h1 id="_idParaDest-84"><a id="_idTextAnchor084"/>Further reading</h1>
<p>To learn more about the topics covered in this chapter, please visit the following links:</p>
<ul>
<li><em class="italic">What is Git?</em>: <a href="https://git-scm.com/docs/gittutorial">https://git-scm.com/docs/gittutorial</a> </li>
<li><em class="italic">What is version control?</em>: <a href="https://en.wikipedia.org/wiki/Version_control">https://en.wikipedia.org/wiki/Version_control</a></li>
<li><em class="italic">What are pull requests?</em>: <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests</a></li>
<li><em class="italic">Syncing your branch</em>: <a href="https://docs.github.com/en/desktop/contributing-and-collaborating-using-github-desktop/keeping-your-local-repository-in-sync-with-github/syncing-your-branch">https://docs.github.com/en/desktop/contributing-and-collaborating-using-github-desktop/keeping-your-local-repository-in-sync-with-github/syncing-your-branch</a></li>
</ul>
</div>
</div>

<div><div><h1 id="_idParaDest-85"><a id="_idTextAnchor085"/>Part 2: Finding Use Cases and Integrations</h1>
</div>
<div><p>This part of the book will explain how to use Ansible in real-world use cases in an IT environment. It will also cover most of the general items, such as infrastructure, platforms, and applications.</p>
<p>This part of the book comprises the following chapters:</p>
<ul>
<li><a href="B18383_05.xhtml#_idTextAnchor086"><em class="italic">Chapter 5</em></a><em class="italic">, Expanding Your Automation Landscape</em></li>
<li><a href="B18383_06.xhtml#_idTextAnchor105"><em class="italic">Chapter 6</em></a><em class="italic">, Automating Microsoft Windows and Network Devices </em></li>
<li><a href="B18383_07.xhtml#_idTextAnchor125"><em class="italic">Chapter 7</em></a><em class="italic">, Managing Your Virtualization and Cloud Platforms</em></li>
<li><a href="B18383_08.xhtml#_idTextAnchor144"><em class="italic">Chapter 8</em></a><em class="italic">, Helping the Database Team with Automation</em></li>
<li><a href="B18383_09.xhtml#_idTextAnchor161"><em class="italic">Chapter 9</em></a><em class="italic">, Implementing Automation in a DevOps Workflow</em></li>
<li><a href="B18383_10.xhtml#_idTextAnchor178"><em class="italic">Chapter 10</em></a><em class="italic">, Managing Containers Using Ansible</em></li>
<li><a href="B18383_11.xhtml#_idTextAnchor194"><em class="italic">Chapter 11</em></a><em class="italic">, Managing Kubernetes Using Ansible</em></li>
<li><a href="B18383_12.xhtml#_idTextAnchor213"><em class="italic">Chapter 12</em></a><em class="italic">, Integrating Ansible with Your Tools</em></li>
<li><a href="B18383_13.xhtml#_idTextAnchor241"><em class="italic">Chapter 13</em></a><em class="italic">, Using Ansible for Secret Management</em></li>
</ul>
</div>
<div><div></div>
</div>
</div></body></html>