<html><head></head><body>
        

                            
                    <h1 class="header-title">Git Providers, Integrations, and Clients</h1>
                
            
            
                
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Setting up an organization at GitHub</li>
<li>Creating a repository at GitHub</li>
<li>Adding templates for issues and pull requests</li>
<li>Creating a GitHub API key</li>
<li>Using GitHub to authenticate at Jenkins</li>
<li>Triggering Jenkins builds</li>
<li>Using Jenkinsfiles</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Introduction</h1>
                
            
            
                
<p>It is possible to host your own Git installation and maintain a central server for your organization. If you are a small company or an open source project, maintaining such an infrastructure can be a burden. But today, there exists a number of Git providers who can lift the burden.</p>
<p>GitHub is the best-known Git provider with 40 million users. Many high-profiled open source projects are hosted by GitHub. Once you have created an account at GitHub, you can explore the 85 million Git repositories currently hosted.</p>
<p>In modern software development, <strong>continuous integration</strong> (<strong>CI</strong>) is popular. The idea is that changes from developers are merged into the code base as soon as possible. Git's <strong>pull requests</strong> (<strong>PRs</strong>) are a way of doing so. Of course, GitHub provides a UI to create PRs and let's collaborators do code reviews. Part of a CI policy is also to run all tests automatically. Software like Jenkins can be configured to build and test for every commit.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting up an organization at GitHub</h1>
                
            
            
                
<p>Whether you have a commercial product or an open source project, there is likely a company or a group of people behind it. GitHub supports such a structure by allowing users to create an organization.</p>
<p>An organization can have repositories associated and it has members. The advantage of using an organization is that members might come and go (developers will get a new job, and leave), but the repositories will be associated with the organization so there will be no need to transfer ownership of repositories.</p>
<p>As a user, you can be a member of multiple organizations. It is common to be a member of your employer's organization but also of a number of organizations behind open source projects.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>You will need a user account at GitHub. For this recipe, we will use the GitHub user <kbd>johndoepackt</kbd>. Any user can create an organization. </p>
<p>If you don't have a GitHub account, it is time to create one. Once you have created your account and signed in, you are ready to go.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Creating an organization is a function under Settings. So, you need to find Settings in your GitHub account, as shown in the following screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-562 image-border" src="img/cf88d2b4-db69-488f-89d5-d3f270f3462b.png" style="width:166.25em;height:99.00em;"/></div>
<ol start="2">
<li>One menu item in Settings is Organizations. You can create an organization in two different ways. You can either turn your user into an organization or create a separate organization. We will create an organization and not turn the user into an organization, as shown in the next screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-563 image-border" src="img/613d523d-0aff-479b-b6a5-0e77edd1fb88.png" style="width:166.25em;height:98.25em;"/></div>
<ol start="3">
<li>Once the organization is created, you can invite users to become members. It is also possible to add outside or external collaborators. </li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Organizations at GitHub are a layer on top of Git. They can be seen as a way to provide access control to associated repositories.</p>
<p>When GitHub users explore the repositories associated with your organizations, they will be subject to the privileges you have set up. This means that you are in charge of what you allow others to see.</p>
<p class="mce-root"/>
<p>If you are a paying customer at GitHub, your organization can have private repositories. A private repository is only accessible by members of the organization. A company can have open source projects or examples as public repositories. But, by using a private repository, it is possible to have some company secrets.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>Each organization has a number of settings that you can tweak. In order to increase the security of your organization, you can require that members have to use two-factor authentication.</p>
<p>You also have access to an audit log for your organization. In many cases, you will have to ensure who did what. The audit log can also reveal if someone has gained access to your organization and tried to tamper with it.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>GitHub organizations are a well-documented feature of GitHub. The documentation is located at <a href="https://help.github.com/categories/setting-up-and-managing-organizations-and-teams/">https://help.github.com/categories/setting-up-and-managing-organizations-and-teams/</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a repository at GitHub</h1>
                
            
            
                
<p>Using Git is all about repositories. GitHub provides a UI for creating repositories. The UI makes it easier for new Git users to get started. And for obvious reasons, GitHub does not give you access to their server directly.</p>
<p>In the previous recipe, we created an organization at GitHub. In this recipe, we will create a repository within the organization. As an individual user (not an organization), you can create repositories too.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>You begin by logging in at GitHub. Before creating the repository, you have to make two decisions. First, what should the repository's name be? Second, should the repository be public or private?</p>
<p class="mce-root"/>
<p>Private repositories are only visible for members of the organization. But in order to create private repositories, you must be a paying customer.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Since we are going to create a repository for the organization, you will have to switch from your ordinary user to your organization. It's a dropdown with the title Switch dashboard context. Once you have switched context, your screen will look like this:</li>
</ol>
<div><img class="alignnone size-full wp-image-564 image-border" src="img/d0f7c508-0ece-475c-ad6b-69926ffce962.png" style="width:166.25em;height:100.42em;"/></div>
<ol start="2">
<li>Now, you are ready to create the repository. You will have to set the name, a Description (optional), and decide whether the repository is Public or Private. Moreover, GitHub can create <kbd>.gitignore</kbd>, <kbd>LICENSE</kbd>, and a simple <kbd>README.md</kbd> for you. Often you will know the main programming language, and a <kbd>.gitignore</kbd> based on best practices can be generated. In the following screenshot, you can see all the fields with values:</li>
</ol>
<div><img class="alignnone size-full wp-image-565 image-border" src="img/5eaebe29-d75b-4ea5-bf43-73e145a865c6.png" style="width:166.25em;height:100.42em;"/></div>
<ol start="3">
<li>Once the repository is created, you can clone it on your computer as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git clone https://github.com/JohnDoePacktOrg/nomen-nescio.git</strong><br/><strong>$ cd nomen-nescio</strong><br/><strong>$ ls -a</strong><br/><strong>.          ..         .git       .gitignore LICENSE    README.md</strong></pre>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The screens you went through in the recipe are <em>Creating a repository at GitHub</em> server. In essence, it is simply creating a directory and running <kbd>git init</kbd>.</p>
<p>Adding the extra files (<kbd>.gitignore</kbd>, <kbd>LICENSE</kbd>, and <kbd>README.md</kbd>) is fairly simple too. Setting up a good <kbd>.gitignore</kbd> takes time, but you get a good starting point with the generated one.</p>
<p>GitHub also sets up access control for your repository. Only members of the organization have write permissions; that is, they have the rights to commit. In the settings of the repository, you can define more precise access control under the menu item Collaborators &amp; teams. A team is a group of GitHub users who work together. In your company, you might have iOS, Android, and DevOps teams.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>With a repository at GitHub, code reviews are an integral part of pull requests. Let's update <kbd>README.md</kbd> and perform a code review at GitHub:</p>
<pre><strong>$ git checkout -b update-readme</strong><br/><strong>Switched to a new branch 'update-readme'<br/></strong><strong>$ echo "\nSoon a better name will be decided." &gt;&gt; README.md<br/></strong><strong>$ git add README.md<br/></strong><strong>$ git commit -m "Updating README.md"</strong><br/><strong>[update-readme 6829c33] Updating README.md<br/></strong><strong>1 file changed, 1 insertion(+)<br/></strong><strong>$ git push origin update-readme<br/></strong><strong>Counting objects: 3, done.</strong><br/><strong>Delta compression using up to 4 threads.</strong><br/><strong>Compressing objects: 100% (3/3), done.</strong><br/><strong>Writing objects: 100% (3/3), 330 bytes | 330.00 KiB/s, done.</strong><br/><strong>Total 3 (delta 1), reused 0 (delta 0)</strong><br/><strong>remote: Resolving deltas: 100% (1/1), completed with 1 local object.</strong><br/><strong>To https://github.com/JohnDoePacktOrg/nomen-nescio.git</strong><br/><strong> * [new branch] update-readme -&gt; update-readme</strong></pre>
<p>You can now go to GitHub, find your repository and create a pull request. You can invite your collaborators to review your changes before they are merged, as shown in the following screenshot:</p>
<div><img class="alignnone size-full wp-image-566 image-border" src="img/2f2403ac-af3d-4031-9b13-f3913ab12e48.png" style="width:166.25em;height:100.42em;"/></div>
<p>When we created the repository, we had the option to create it as a private one. Private repositories are only available for paying customers. From a Git perspective, there is no difference between public and private repositories. The major difference is who can view a repository. As you might imagine, public repositories can be viewed by everybody. You don't even have to log in to GitHub to view a public repository. These repositories are ideal for open source projects—and if you read GitHub's terms closely, you will see that a public repository is meant to be open source.</p>
<p>Private repositories can only be viewed by the users you have given access to. Typically, every member of your organization can view private repositories. In other words, private repositories are ideal for internal projects or proprietary software. Today, many companies are mixing public and private repositories while their software developers can fluently move between repositories. </p>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding templates for issues and pull requests</h1>
                
            
            
                
<p>In <a href="fcc6f77f-119c-41e9-b4b0-9b7df263b7f1.xhtml">Chapter 7</a>, <em>Enhancing Your Daily Work with Git Hooks, Aliases, and Scripts</em>, we showed how to add templates for commits.  A commit template helps the developer to include the relevant information in the commit message. At GitHub, users will create issues and pull requests. It is up to the issue or pull request creator to write a meaningful description.</p>
<p>This recipe will explain to you how to add templates for issues and pull requests. The purpose is to help people to remember to include enough context for you to quickly understand what the issue or pull request is about.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>We will continue to use the repository <kbd>nomen-rescio</kbd> that we created in a previous recipe. GitHub is using <strong>Markdown</strong> as a markup language everywhere. Markdown is developer friendly since it is plain text with some special conversions for typesetting bold, bullet lists, and so on. Going through Markdown might be a complete book on its own.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>To start, you will need to find Settings for your repository. There is a big Set up templates button which is what you are looking for. You can choose to use one of the precanned templates, but we will create a custom one, as shown in the next screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-567 image-border" src="img/332195f3-6fd1-4ba3-a646-f101b2a965c8.png" style="width:166.25em;height:100.42em;"/></div>
<ol start="2">
<li>You save the template by clicking on Commit changes. When a user is creating an issue, your template will be shown. The user can choose to delete all your text but most users will read it before doing so; note the following screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-568 image-border" src="img/8ef16abf-bd1d-423e-a8c4-9ccc5c8a90e9.png" style="width:166.25em;height:100.42em;"/></div>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Your templates live in the repository itself. Actually, you find them in the directory <kbd>.github</kbd>. If you prefer, you can edit a template in your favorite editor and commit changes just like any other file.</p>
<p>The directory <kbd>ISSUE_TEMPLATE</kbd> contains the templates for issues is the file. Similar, if you create a file under the directory <kbd>PULL_REQUEST_TEMPLATE</kbd>, you will have a template for pull requests. With multiple templates, the user will be asked to choose which template is appropriate. </p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a GitHub API key</h1>
                
            
            
                
<p>So far, all the work we have performed at GitHub has been manual. Programmers like to automate processes, and performing GitHub work is no exception to that rule. With the next recipe, we will show you how you can automate tasks.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>To automate GitHub tasks you need to be able to access GitHub. Instead of logging in using a user name and password, you can use an API key or personal access token. Such a token should not be shared, and you need to keep it secret at all times.</p>
<p>So, this recipe begins with generating an access token and shows you a simple Python script. The Python script will find all your repositories, and find all the pull requests for each repository.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>First, we need to generate the personal access token. You will have to drill down in the menu system: Settings, Developer settings, and finally, Person access token. We will give our token the name <kbd>basic-query</kbd> since we plan only to do that. You can specify what the token has access to. Our token will only need access to repository actions, as indicated in the following screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-569 image-border" src="img/2772c873-f590-432f-8746-ee788cc6a08e.png" style="width:166.25em;height:100.42em;"/></div>
<ol start="2">
<li>Once you generate the token, it will displayed. You will only see it once at GitHub, so it is important to copy it to your computer. In the following screenshot, you can see the page with the generated token (except we have added a rectangle since we need to keep it a secret):</li>
</ol>
<div><img class="alignnone size-full wp-image-570 image-border" src="img/cfe13a2d-f11c-461b-a03d-9a3a048a7ddb.png" style="width:166.25em;height:88.75em;"/></div>
<ol start="3">
<li>As already mentioned, we will use Python. You need to install the small library PyGitHub. Using Pip, the installation is easy:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ pip install pygithub<br/></strong></pre>
<ol start="4">
<li>Now, we are ready to run the Python script that will fetch the repositories and the pull requests. The script is just iterating over repositories and pull requests:</li>
</ol>
<pre style="padding-left: 60px">from github import Github<br/>import datetime<br/><br/>g = Github("YOUR_PERSONAL_ACCESS_TOKEN")<br/>for repo in g.get_user().get_repos():<br/>  print(repo.name)<br/>  for pr in repo.get_pulls():<br/>    print(" " + pr.created_at.isoformat() + " : " + pr.title)</pre>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The token gives you access to GitHub but only the parts that were specified when you created the token. Behind the scenes, the methods of PyGitHub are implemented as HTTP calls to GitHub's API.</p>
<p>For example, the call <kbd>get_repos</kbd> is an HTTP GET of <kbd>/user/repos</kbd>. The HTTP request will return the result as JSON. PyGitHub is parsing the JSON result and populating Python objects so the result is more natural for a Python developer.</p>
<p>Python is not the only programming language. You can find libraries for almost any known language.</p>
<p>Of course, you can go beyond the simple scripts and develop a full-blown GitHub client. We will leave that as an exercise for you.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>The complete API documentation for PyGitHub can be found at <a href="http://pygithub.readthedocs.io/en/latest/reference.html">http://pygithub.readthedocs.io/en/latest/reference.html</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using GitHub to authenticate at Jenkins</h1>
                
            
            
                
<p>Jenkins is the most popular continuous integration software and it allows users to continuously build, test, and release any kind of software. It is extremely flexible and configurable in every aspect, including the way users are able to log in and authorize. GitHub is able to act as an OAuth provider, which is very convenient since it makes a lot of sense to map the users working on a project with the relative area of the CI system.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p class="md-focus-p">In order to demonstrate the procedure, we will need a Jenkins instance. Every company will have a different setup so, in order to make things more predictable, we will work with a local version of Jenkins.</p>
<p class="">Jenkins is a Java app but still, the easiest way to get a running ephemeral instance of Jenkins for our example is by using Docker. With Docker installed and running on your machine, simply run:</p>
<pre class="md-fences md-end-block contain-cm modeLoaded"><strong>$ docker run --rm -p 8080:8080 jenkinsci/blueocean</strong></pre>
<p>This instance of Jenkins won't leave behind any traces of itself once the docker container is stopped.</p>
<p class="">The logs will start appearing on your console and they will contain the password for the first login. Look for something that appears as follows:</p>
<pre class="md-fences md-end-block contain-cm modeLoaded">*************************************************************<br/>*************************************************************<br/>*************************************************************<br/>​<br/>Jenkins initial setup is required. An admin user has been created and a password generated.<br/>Please use the following password to proceed to installation:<br/>​<br/>YOUR_PASSWORD_HERE<br/>​<br/>This may also be found at: /Users/emanuelez/.jenkins/secrets/initialAdminPassword<br/>​<br/>*************************************************************<br/>*************************************************************<br/>*************************************************************</pre>
<p>At this point you can point your browser to <kbd>http://localhost:8080/</kbd> and you will be prompted for your password, as shown in the next screenshot:</p>
<div><img class="alignnone size-full wp-image-571 image-border" src="img/b34e77c7-c424-4e3e-8b8b-f91ea5e2d8df.png" style="width:54.42em;height:47.92em;"/></div>
<p class="">At this point, you will be prompted to install plugins. For this example, let's just install the suggested plugins as shown in the next screenshot:</p>
<div><img class="alignnone size-full wp-image-572 image-border" src="img/ec328140-0764-46ea-8b48-e19f841e49c9.png" style="width:50.42em;height:44.17em;"/></div>
<p>Next, you will be prompted to create an admin user, but, since this is an ephemeral image, you can just continue by clicking Continue as admin:</p>
<div><img class="alignnone size-full wp-image-573 image-border" src="img/f7591874-d9bb-4e45-b05a-87b9d4b9ee51.png" style="width:51.33em;height:44.17em;"/></div>
<p>Next, you will be asked to set up the Instance Configuration. Just keep the default value and click Save and Finish.</p>
<p class="mce-root"/>
<p>At this point, Jenkins is ready to be used. Just click on Start using Jenkins, as shown in the next screenshot:</p>
<div><img class="alignnone size-full wp-image-574 image-border" src="img/fb5ccf16-e5f4-4300-a40d-cfd41cf6b552.png" style="width:166.25em;height:145.75em;"/></div>
<p> You will now see the Welcome to Jenkins! homepage, as follows:</p>
<div><img class="alignnone size-full wp-image-575 image-border" src="img/96d02e42-61b3-43f1-a5c5-c84df8c2017b.png" style="width:166.25em;height:85.83em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>In order to authenticate to Jenkins using GitHub, you will have to install the GitHub Authentication Plugin. To do this, click on Manage Jenkins on the panel on the left and on the new page click on Manage Plugins, as shown in the following screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-576 image-border" src="img/0ddbc1fc-69d3-4378-a7f5-53b7be64800b.png" style="width:166.25em;height:136.67em;"/></div>
<ol start="2">
<li>Now you can navigate to the Available tab and type <kbd>github auth</kbd> in the search box , as shown in the next screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-577 image-border" src="img/b541849b-9f58-4a8e-ab44-b51e86a70f0b.png" style="width:166.25em;height:53.83em;"/></div>
<ol start="3">
<li class="md-focus-p">You can now install the plugin by checking the box on the left and clicking on Install without restart.</li>
<li>Once the plugin is installed you can go back to the Jenkins homepage by clicking on the Jenkins logo in the top-left corner and, once again, clicking on Manage Jenkins.</li>
<li>This time we will proceed by clicking on Configure Global Security, as shown in the next screenshot:</li>
</ol>
<div><img class="alignnone size-full wp-image-578 image-border" src="img/b4224b1c-0d05-408c-b817-ebef1fbde4d0.png" style="width:43.17em;height:53.58em;"/></div>
<ol start="6">
<li>Now head over to GitHub and, as shown in the next screenshot, register a new application by navigating to <a href="https://github.com/settings/applications/new">https://github.com/settings/applications/new</a>:</li>
</ol>
<div><img class="alignnone size-full wp-image-579 image-border" src="img/9c7343b9-4334-48a3-b6d7-f3b5f2b5a125.png" style="width:106.00em;height:78.83em;"/></div>
<p class="md-focus-p" style="padding-left: 60px">Here you will need to fill in an arbitrary Application name and the Authorization callback URL as shown. Once you register the application you will be able to see your Client ID and Client Secret. These will be needed in Jenkins in order to fill in the relative fields in the Global Security Settings.</p>
<ol start="7">
<li>Once you submit the form you will be able to log in to Jenkins using your GitHub credentials.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p class="md-focus-p">Authentication needs to solve the question, Who is the person trying to access the service?. There are many ways to do it: login and password, tokens, and so on. OAuth is another way to answer that question. OAuth stands for Open Authentication and it is an open standard for access delegation. It allows users to have access to websites (such as our Jenkins instance) without having to provide them, and therefore trust them, with a password.</p>
<p>GitHub has the ability to act as an OAuth provider, which means that other websites can be configured to accept the credentials provided by GitHub to let users access their services.</p>
<p class="">This means that whenever a user tries to access a Jenkins instance configured to accept GitHub OAuth, he will be redirected to GitHub itself to authenticate and, subsequently, GitHub will redirect the user to the Jenkins instance with an attached identity token.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p class="md-focus-p">Authentication is only half of the equation. Identifying a user is, of course, important, but what we do with that information is critical as well. Here is where authorization comes into play, which, keeping the question analogy, aims to answer the question: Given that the person trying to access the service is X, what is he allowed and not allowed to do?</p>
<p>The way we configured the Jenkins instance, anybody able to log in will be able to do anything. This might not be the desired behavior, which leads to another section of the Global Security page in Jenkins.</p>
<p class="">You will find a section called Authorization, which provides many options. One is the GitHub Committer Authorization Strategy, which determines if a user is allowed to see a specific Jenkins job–but only if he's allowed to access the relative GitHub repository.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>The documentation of the GitHub OAuth Plugin is available at <a href="https://wiki.jenkins.io/display/JENKINS/GitHub+OAuth+Plugin">https://wiki.jenkins.io/display/JENKINS/GitHub+OAuth+Plugin</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Triggering Jenkins builds</h1>
                
            
            
                
<p class="md-focus-p">When you create a Jenkins job, how will Jenkins know when it's time to build a specific branch or pull request? Jenkins offers many ways to do this, from continuously building based on a timer, to polling the Git repository to see if anything changed. Both of these options are not very efficient, but luckily GitHub allows for a better solution.</p>
<p>GitHub has the concept of Webhooks, which means that it can be configured to contact a server, such as our Jenkins instance, when something important happens.</p>
<p class="">There are many ways to achieve the goal, but in this recipe we will focus on one approach, which is going to be helpful especially in an enterprise environment where a GitHub organization is used, containing several repositories. Managing a single job or more per repository can quickly become a repetitive chore and that is where the <strong>GitHub Branch Source</strong> plugin comes into play.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p class="md-focus-p">We are going to need a Jenkins instance so the same preparatory steps as the previous recipe are needed.</p>
<p class="">Additionally, if the Jenkins instance is not reachable from the internet, a reverse proxy will be needed in order for GitHub to send notifications to the Jenkins instance.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>The steps are as follows:</p>
<ol>
<li class="md-focus-p">The GitHub Branch Source plugin comes preinstalled with the default installation, but if your setup does not already have the plugin, you can easily install it as we did in the previous recipe. Go to the Jenkins home page and proceed to Manage Jenkins, Manage Plugins, click on the Available tab and look for GitHub Branch Source. Install the plugin.</li>
</ol>
<ol start="2">
<li>Now, go back to the Jenkins homepage and click on Create New Jobs:</li>
</ol>
<div><img class="alignnone size-full wp-image-580 image-border" src="img/424c5a74-f3bd-43b9-a794-bf5127c127de.png" style="width:166.25em;height:97.50em;"/></div>
<ol start="3">
<li>Choose a job name and select GitHub Organization before clicking OK. The following configuration page can look a bit daunting, so let's break it down:</li>
</ol>
<div><img class="alignnone size-full wp-image-581 image-border" src="img/31013018-1169-47ff-ac05-57ec0aa70bec.png" style="width:35.75em;height:52.75em;"/></div>
<ol start="4">
<li class="md-focus-p">The only section that really needs to be taken care of is Projects. The first thing to set is the GitHub credentials. This will allow Jenkins to automatically set up webhooks for us. Credentials in Jenkins are treated with security in mind and are properly encrypted, so don't be afraid to save them here.</li>
<li>Next, we need to specify the Owner, which is simply the name of the GitHub organization we want to keep under control. The following section describes the behaviors, which are completely fine in their default form. They will allow building:
<ul>
<li>Branches</li>
<li>PRs coming from the repo itself</li>
<li>PRs coming from forks, but from trusted users</li>
</ul>
</li>
</ol>
<p class="">That is it! Now Jenkins will be able to automatically build any branch or PR as long as the code contains a Jenkinsfile. Jenkinsfiles are going to be treated in the next recipe, so stay tuned!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p class="md-focus-p">The GitHub Branch Souce plugin will allow Jenkins to periodically scan the whole specified GitHub organization, and for every repository it will check all the branches and PRs, and if they contain a file called <kbd>Jenkinsfile</kbd> they will be automatically built following the directives contained in the Jenkinsfile itself.</p>
<p class="">This is quite a powerful paradigm and it allows to keep under version control not only the code of the project but also the instructions on how to build, test, and even release it in the same code base.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>The job configuration page will allow changing many different behaviors. What if, for example, we don't want to build all branches, but only the ones whose name matches a regular expression? The solution is just a few clicks away! There are so many possibilities and the Jenkins developers keep adding new ones, so it's worth taking a look periodically at what's available.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>The documentation for the GitHub Branch Source plugin is available at <a href="https://go.cloudbees.com/docs/cloudbees-documentation/cje-user-guide/index.html#github-branch-source">https://go.cloudbees.com/docs/cloudbees-documentation/cje-user-guide/index.html#github-branch-source</a>.</p>
<p> </p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Jenkinsfiles</h1>
                
            
            
                
<p>Jenkinsfiles are a relatively new feature in the Jenkins world and they come in two varieties and syntaxes:</p>
<ul>
<li>Declarative</li>
<li>Groovy DSL</li>
</ul>
<p>The Groovy DSL is very flexible and powerful, but it also facilitates some anti-patterns, so in this recipe we're going to focus on the declarative-style Jenkinsfiles.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>You will need a GitHub repository containing a codebase that can be built and tested. Given the sheer number of possible programming languages and build systems available, we will choose an arbitrary Java project using the popular Maven build system.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>It will be sufficient to add a file called `Jenkinsfile` with these contents:</p>
<pre class="CodeRay highlight nowrap">pipeline {
  agent any
  tools {
    maven 'Maven 3.3.9'
    jdk 'jdk8'
  }
  stages {
    stage ('Initialize') {
      steps {
        sh '''
          echo "PATH = ${PATH}"
          echo "M2_HOME = ${M2_HOME}"
        '''
      }
    }

    stage ('Build') {
      steps {
        sh 'mvn -Dmaven.test.failure.ignore=true install' 
      }
      post {
        success {
          junit 'target/surefire-reports/**/*.xml' 
        }
      }
    }
  }
}</pre>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The Jenkinsfile describes both how to build and test the software and the environment in which to run such an operation.</p>
<p>Let's take a look at the different sections:</p>
<ul>
<li><kbd>agent any</kbd> specifies that this build can be run on any available executor.</li>
<li>The <kbd>tools {}</kbd> section specifies the programs needed to run our build. In this case, Maven and the <strong>Java Development Kit</strong> (<strong>JDK</strong>) are needed and the versions are specified as well.</li>
<li><kbd>stages {}</kbd> and <kbd>stage() {}</kbd> allow splitting the run into well-defined sections which will allow better analysis of build results.</li>
<li>Each stage needs to contain a <kbd>steps {}</kbd> section that will describe exactly which operations to perform. In this case, in the <em>Initialize</em> stage, we are simply running a shell script that echoes a couple of environment variables.</li>
<li>The Build stage actually runs Maven and, if the build succeeds, it will analyze the results of the unit tests contained in an XML file.</li>
</ul>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>Jenkinsfiles are a huge topic that would be able to fill a book on its own, so the examples provided have only scratched the surface of what is possible. To give some examples, you will be able to:</p>
<ul>
<li>Run steps in parallel on different machines to save build time</li>
<li>Save and deploy build artifacts</li>
<li>Run complete releases</li>
<li>Wait for some user input</li>
<li>And much much more</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>The syntax for declarative Jenkinsfiles can be found at <a href="https://jenkins.io/doc/book/pipeline/syntax/">https://jenkins.io/doc/book/pipeline/syntax/</a>.</p>
<p>Be aware that plugins are able to contribute all kinds of steps and tools, so be sure to check the documentation of the plugin you are planning to use!</p>


            

            
        
    </body></html>