- en: Securing Your Resources
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保护您的资源
- en: In the previous chapter, we covered designing for the Azure Data Services objective.
    We've covered some of the different Azure Data Services as well as relational
    databases in Azure. We also covered backup and security strategies and designing
    for high availability and performance.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了设计 Azure 数据服务目标的内容。我们涵盖了一些不同的 Azure 数据服务以及 Azure 中的关系数据库。我们还介绍了备份和安全策略以及高可用性和性能设计。
- en: In this chapter, you will learn about the objective of the Design Security and
    Identity Solutions domains, by covering how to secure your resources, such as
    using Azure AD Connect, Multi-Factor Authentication (MFA), and more. It also covers
    how to use the different Identity Providers for your Azure Solutions.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将了解设计安全性和身份解决方案领域的目标，包括如何保护您的资源，例如使用 Azure AD Connect、多因素身份验证（MFA）等。还将介绍如何为您的
    Azure 解决方案使用不同的身份提供者。
- en: 'The following topics will be covered:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 以下主题将被涵盖：
- en: Azure Active Directory (Azure AD)
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory（Azure AD）
- en: Azure AD Connect
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure AD Connect
- en: Active Directory Federation Services (ADFS)
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Active Directory 联合身份认证服务（ADFS）
- en: Multi-Factor Authentication
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多因素身份验证
- en: Azure Active Directory Business to Business (Azure AD B2B)
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory 企业对企业（Azure AD B2B）
- en: Azure Active Directory Business to Consumer (Azure AD B2C)
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Active Directory 企业对消费者（Azure AD B2C）
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter uses the following tools for the examples:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章使用以下工具进行示例：
- en: Visual Studio 2017: [https://www.visualstudio.com/downloads/](https://www.visualstudio.com/downloads/)
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Visual Studio 2017：[https://www.visualstudio.com/downloads/](https://www.visualstudio.com/downloads/)
- en: 'The source code for this chapter can be downloaded from the following link:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的源代码可以通过以下链接下载：
- en: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%209/](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%209/)'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%209/](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%209/)'
- en: Azure Active Directory
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Active Directory
- en: Azure Active Directory (Azure AD) offers directory and identity management from
    the cloud. It offers traditional username and password identity management and
    roles and permissions management. On top of that, it offers more enterprise solutions,
    such as MFA and applications monitoring, solution monitoring, and alerting. Azure
    AD can easily be integrated with your on-premises Active Directory to create a
    hybrid infrastructure.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Active Directory（Azure AD）提供来自云端的目录和身份管理。它提供传统的用户名和密码身份管理、角色和权限管理。除此之外，还提供更多企业级解决方案，如
    MFA、应用监控、解决方案监控和警报。Azure AD 可以轻松与您的本地 Active Directory 集成，以创建混合基础设施。
- en: 'Azure AD offers the following pricing plans:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 提供以下定价计划：
- en: '**Free**: This offers the most basic features, such as support for up to 500,000
    objects, SSO, support for Azure AD Connect synchronization, and standard security
    reports'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Free**：提供最基本的功能，如支持最多 500,000 个对象、SSO、支持 Azure AD Connect 同步和标准安全报告'
- en: '**Basic**: This offers no object limit, SLA of 99.9%, Groups, self-service
    password reset, and support for the Application Proxy'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Basic**：不限制对象数量，提供 99.9% SLA、组功能、自助密码重置和对应用代理的支持'
- en: '**Premium P1**: This offers Advanced Reporting, MFA, MDM auto-enrollment, Cloud
    app discovery, and Azure AD Connect Health'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Premium P1**：提供高级报告、MFA、MDM 自动注册、云应用发现和 Azure AD Connect 健康监控'
- en: '**Premium P2**:Identity protection and Privileged Identity Management'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Premium P2**：身份保护和特权身份管理'
- en: For a detailed overview of the different pricing plans and all the features
    that are offered for each plan, you can refer to the following pricing page: [https://azure.microsoft.com/en-us/pricing/details/active-directory/](https://azure.microsoft.com/en-us/pricing/details/active-directory/).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 若要详细了解不同定价计划及每个计划提供的所有功能，您可以参考以下定价页面：[https://azure.microsoft.com/en-us/pricing/details/active-directory/](https://azure.microsoft.com/en-us/pricing/details/active-directory/)。
- en: Note that Azure AD Premium is part of the Enterprise Mobility + Security Suite.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，Azure AD Premium 是企业移动性 + 安全套件的一部分。
- en: Azure AD can be leveraged in your custom apps and APIs as well for authorizing
    your users and securing your resources. It offers support for industry standard
    protocols such as OAuth2.0 and OpenID Connect and supports authentication for
    single and multitenant applications, as well as line of business (LOB) applications.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以在自定义应用和 API 中利用 Azure AD 来授权用户并保护您的资源。它支持行业标准协议，如 OAuth2.0 和 OpenID Connect，并支持单租户和多租户应用的身份验证，以及业务线（LOB）应用。
- en: 'It offers two different endpoints that can be leveraged in your custom applications:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 它提供了两个不同的端点，可以在你的自定义应用程序中使用：
- en: '**V1 endpoint**:This endpoint offers support for Microsoft work or school accounts
    only, and it uses the Azure Portal to register the apps in Azure AD. It uses the **Azure
    Active Directory Library** (**ADAL**) SDK to authenticate users within the application.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**V1 端点**：此端点仅支持 Microsoft 工作或学校账户，并使用 Azure Portal 在 Azure AD 中注册应用。它使用 **Azure
    Active Directory 库**（**ADAL**）SDK 来认证应用程序中的用户。'
- en: '**V2 endpoint**: This offers support for both Microsoft work or school accounts
    and personal accounts such as Outlook.com. It also offers a new registration portal
    located at `apps.dev.microsoft.com`, and that makes it much easier to register
    your application in Azure AD. It uses the **Microsoft Authentication Library **(**MSAL**)
    in order to authenticate your users within the application. Using this endpoint,
    you can create one single App ID for multiplatform apps. If your applications
    consist of a separate web, Android, and IoS app, they can all use the same App
    ID. You can use dynamic consent, where you grant permissions only at the time
    you need them in the application itself and not up front when registering the
    app in Azure AD.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**V2 端点**：此端点同时支持 Microsoft 工作或学校账户和个人账户（如 Outlook.com）。它还提供一个新的注册门户，位于 `apps.dev.microsoft.com`，使得在
    Azure AD 中注册应用程序变得更加容易。它使用 **Microsoft 身份验证库**（**MSAL**）来认证应用程序中的用户。使用此端点，你可以为多平台应用创建一个单一的
    App ID。如果你的应用程序由独立的 Web、Android 和 iOS 应用组成，它们可以使用相同的 App ID。你可以使用动态授权，在应用程序本身需要权限时再进行授权，而不是在
    Azure AD 中注册应用时预先授权。'
- en: Microsoft Graph
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Microsoft Graph
- en: Microsoft Graph is a set of APIs that connects multiple Azure services together
    and provides a single endpoint for developers to use in their custom applications.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Graph 是一组 API，它将多个 Azure 服务连接在一起，并为开发者提供一个单一的端点，用于在自定义应用程序中使用。
- en: Microsoft Graph is made up of relationships between the various Azure services.
    By calling the endpoint for a particular user, that is added to Azure AD, you
    can retrieve the documents where the user is working on, find his/her manager,
    retrieve the users meetings, get a list of devices, and much more.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Graph 由各种 Azure 服务之间的关系构成。通过调用特定用户的端点（该用户已添加到 Azure AD 中），你可以检索用户正在处理的文档，找到他的/她的经理，获取用户的会议列表，列出设备等。
- en: Azure AD is integrated in Microsoft Graph as well, but it can be leveraged for
    more than Azure AD features only. In fact, nearly all SaaS products of Azure use
    Azure AD, such as Office 365, Intune, Dynamic 365, and Azure SQL. All of those
    Azure services are integrated in Microsoft Graph and can be leveraged inside your
    apps and APIs.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 也集成在 Microsoft Graph 中，但它不仅仅可以用于 Azure AD 的功能。事实上，几乎所有 Azure 的 SaaS
    产品都使用 Azure AD，例如 Office 365、Intune、Dynamic 365 和 Azure SQL。所有这些 Azure 服务都集成在
    Microsoft Graph 中，可以在你的应用和 API 中使用。
- en: Microsoft Graph offers two different endpoints, the V1.0 endpoint, which consists
    of all the APIs that are general available and the beta endpoint, with the latter
    providing APIs that can still change over time.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Graph 提供了两个不同的端点，一个是 V1.0 端点，它包含了所有正式发布的 API；另一个是 beta 端点，后者提供的 API
    可能会随着时间的推移发生变化。
- en: To get started with the Graph API and to register your App in Azure AD, you
    can refer to: [https://developer.microsoft.com/en-us/graph](https://developer.microsoft.com/en-us/graph).
    This is a great starting point, where you can also download secure sample applications
    for multiple programming languages.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用 Graph API 并在 Azure AD 中注册你的应用程序，可以参考：[https://developer.microsoft.com/en-us/graph](https://developer.microsoft.com/en-us/graph)。这是一个很好的起点，你还可以下载适用于多种编程语言的安全示例应用程序。
- en: For an overview of all the Azure services that are integrated in Microsoft Graph,
    you can refer to this website as well.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 有关所有集成在 Microsoft Graph 中的 Azure 服务的概述，你也可以参考这个网站。
- en: Azure AD Connect
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure AD Connect
- en: Azure AD Connect is a service that you can use to synchronize your on-premises
    Active Directory identities with Azure. This way, you can use the same identities
    for authentication on your on-premises environment as well as in the cloud and
    other SaaS applications.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 是一个服务，允许你将本地 Active Directory 身份与 Azure 同步。这样，你可以在本地环境和云环境及其他
    SaaS 应用中使用相同的身份进行身份验证。
- en: The Azure AD Connect sync service consists of two parts, theAzure AD Connect
    sync component, which is a tool that is installed on a separate server inside
    your on-premises environment, and the Azure AD Connect sync service, which is
    part of Azure AD. The sync component can sync data from Active Directory and SQL
    Server to Azure. There is also a third component named the Active Directory Federation
    Services component, which can be used in a scenario where ADFS is involved. To
    monitor the on-premises identity infrastructure and the different Azure AD components,
    you can use a tool named Azure AD Connect Health.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 同步服务由两个部分组成：Azure AD Connect 同步组件，这是一个安装在您本地环境中单独服务器上的工具，以及
    Azure AD Connect 同步服务，这是 Azure AD 的一部分。同步组件可以将数据从 Active Directory 和 SQL Server
    同步到 Azure。还有一个名为 Active Directory 联合身份验证服务（ADFS）组件的第三个组件，可以在涉及 ADFS 的场景中使用。要监控本地身份基础设施和不同的
    Azure AD 组件，您可以使用一个名为 Azure AD Connect Health 的工具。
- en: '![](img/d868326b-9917-4cfb-a551-ca44a36d0a5e.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d868326b-9917-4cfb-a551-ca44a36d0a5e.jpg)'
- en: Azure AD Connect architecture
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 架构
- en: For more information about how to install Azure AD Connect and syncing the user
    accounts and passwords, you can refer to [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-select-installation](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-select-installation)[.
    For more information about monitoring the Health, you can refer to: ](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)[https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)[.](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 有关如何安装 Azure AD Connect 并同步用户帐户和密码的更多信息，请参考 [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-select-installation](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-select-installation)。有关监控健康状况的更多信息，请参考：[https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)。
- en: Azure AD Connect offers support for your users to sign in with the same passwords
    to both on-premises as cloud resources. It provides three different authentication
    methods for this, the password hash synchronization method, the pass-through authentication
    method, and the Federated SSO method (in conjunction with Active Directory Federation
    Services).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 提供支持，允许用户使用相同的密码登录本地和云资源。为此提供了三种不同的身份验证方法：密码哈希同步方法、直通身份验证方法和联合单点登录方法（与
    Active Directory 联合身份验证服务配合使用）。
- en: These three different authentication methods are covered in more detail in the
    upcoming sections.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这三种不同的身份验证方法将在接下来的部分中详细介绍。
- en: Azure Active Directory password hash synchronization
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Active Directory 密码哈希同步
- en: Most organizations only have a requirement to enable user sign-in to Office
    365, SaaS applications, and other Azure AD-based resources. The password hash
    synchronization method is well suitable for those scenario's.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数组织只需要启用用户登录到 Office 365、SaaS 应用程序和其他基于 Azure AD 的资源。密码哈希同步方法非常适合这种场景。
- en: Using this method, hashes of the user's password are synced between the on-premises
    Active Directory and Azure Active Directory. When there are any changes to the
    user's password, the password is synced immediately, so users can always log in
    with the same credentials on-premises as well as in Azure.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此方法，用户的密码哈希在本地 Active Directory 和 Azure Active Directory 之间同步。当用户密码发生变化时，密码会立即同步，因此用户可以始终使用相同的凭证在本地和
    Azure 中登录。
- en: This authentication method also provides Azure AD Seamless Single Sign-On (SSO).
    This way, users are automatically signed in when they are using a domain-joined
    device on the corporate network. Users only have to enter their username when
    using Seamless SSO. To use Seamless SSO, you don't have to install additional
    software or components on the on-premises network. You can push this capability
    to your users using group policies.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 此认证方法还提供 Azure AD 无缝单点登录（SSO）。这样，用户在公司网络上使用域加入设备时，系统会自动登录。使用无缝 SSO 时，用户只需输入用户名。为了使用无缝
    SSO，您无需在本地网络上安装额外的软件或组件。您可以通过组策略将此功能推送给用户。
- en: Azure Active Directory pass-through authentication
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Active Directory 直通认证
- en: Azure Active Directory pass-through authentication offers the same capability,
    such as Azure AD password hash synchronization. Users can log in to their Azure
    resources as well as on-premises resources using the same credentials. The difference
    is that passwords aren't synced with Azure AD using pass-through authentication.
    The passwords are validated using the on-premises Active Directory and are not
    stored in the Azure Active Directory at all.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Active Directory 直通认证提供相同的功能，例如 Azure AD 密码哈希同步。用户可以使用相同的凭据登录到其 Azure
    资源以及本地资源。不同之处在于，使用直通认证时，密码不会与 Azure AD 同步。密码是在本地 Active Directory 中验证的，完全不会存储在
    Azure Active Directory 中。
- en: This method is suitable for organizations that have security and compliance
    restrictions and aren't allowed to send usernames and passwords outside the on-premises
    network.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法适用于那些有安全性和合规性限制的组织，这些组织不允许将用户名和密码发送到本地网络之外。
- en: Pass-through authentication requires an agent to be installed on a domain-joined
    Windows Server that resides inside the on-premises environment. This agent then
    listens for password validation requests and only makes an outbound connection
    from within your network. It also offers support for MFA and Azure AD Conditional
    Access policies.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 直通认证需要在本地网络内安装一个代理在域加入的 Windows Server 上。该代理会监听密码验证请求，并仅从您的网络内发起外部连接。它还支持 MFA
    和 Azure AD 条件访问策略。
- en: Azure AD pass-through authentication offers Azure AD Seamless SSO as well.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 直通认证还提供 Azure AD 无缝 SSO。
- en: Active Directory Federation Services
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Active Directory 联邦服务
- en: Active Directory Federation Services (ADFS) is a standards-based service and
    a feature of Windows Server that you can enable on a Windows Server machine. It
    provides an authentication provider for external users to log in to an on-premises
    environment over the internet.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Active Directory 联邦服务（ADFS）是一项基于标准的服务，是 Windows Server 的一项功能，您可以在 Windows Server
    机器上启用它。它为外部用户提供一个身份验证提供者，使其能够通过互联网登录到本地环境。
- en: 'ADFS offers the following features:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ADFS 提供以下功能：
- en: '**Web SSO**: This provides SSO for federated users when they access applications
    that are installed in the on-premises data center.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Web SSO**：当联合用户访问安装在本地数据中心的应用程序时，提供 SSO。'
- en: '**Web Services (WS) - interoperability**: Applications or users that don''t
    use the Windows identity model but are compatible with the WS-Federation specification
    can still authenticate to the ADFS server and your on-premises applications.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Web 服务（WS）- 互操作性**：不使用 Windows 身份模型但兼容 WS-Federation 规范的应用程序或用户，仍然可以通过 ADFS
    服务器对其进行身份验证，并访问本地应用程序。'
- en: '**No external user account management**:External users can authenticate using
    their own organization or personal credentials. Inside ADFS, a trust is established
    using the external authentication provider and ADFS. The user can then federate
    using Security Assertion Markup Language (SAML) claims.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无外部用户帐户管理**：外部用户可以使用其所属组织或个人凭证进行身份验证。在 ADFS 中，使用外部身份验证提供者和 ADFS 建立信任。然后，用户可以通过安全声明标记语言（SAML）声明进行联合身份验证。'
- en: The Federated SSO Authentication method uses Azure AD Connect in conjunction
    with ADFS to offer federated Single Sign On to your users. You can deploy ADFS
    inside your on-premises data center or using Azure VMs. You can use the same Azure
    AD APIs, such as Microsoft Graph, to connect to your on-premises identities. Azure
    Active Directory is responsible for connecting to your on-premises environment
    via ADFS and takes care of the authentication process.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 联合 SSO 认证方法使用 Azure AD Connect 与 ADFS 结合，为用户提供联合单点登录。您可以将 ADFS 部署在本地数据中心或使用
    Azure 虚拟机。您可以使用相同的 Azure AD API，如 Microsoft Graph，连接到本地身份。Azure Active Directory
    负责通过 ADFS 连接到您的本地环境，并处理认证过程。
- en: You can also expand the functionality of Azure AD using ADFS. You can implement
    custom claims or conditional policies that don't exist in Azure AD, or use you
    organization login screen with additional notifications or information or use
    a custom MFA provider. You can also create a trust between different environments
    using ADFS.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用 ADFS 扩展 Azure AD 的功能。你可以实现自定义声明或条件策略，这些功能在 Azure AD 中不存在，或者使用你的组织登录屏幕，添加额外的通知或信息，或者使用自定义
    MFA 提供商。你还可以使用 ADFS 在不同的环境之间创建信任。
- en: Multi-Factor Authentication
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多因素身份验证
- en: In today's world, securing your data and systems is key. MFA adds a second layer
    of security to user sign-ins and is now a best practice to secure data. It enables
    two-step verification, where you first sign in with what you know and then with
    something you have.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在今天的世界中，保护数据和系统至关重要。MFA 为用户登录增加了第二层安全性，并且现在已成为保护数据的最佳实践。它启用两步验证，你首先使用你所知道的信息登录，然后使用你所拥有的信息进行验证。
- en: 'Azure MFA uses the following verification methods:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: Azure MFA 使用以下验证方法：
- en: '**Something you know**: This is like a traditional password.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**你知道的东西**：这类似于传统密码。'
- en: '**Something you have**: This is like a phone, by sending a text message, using
    a verification app, or receiving a phone call. Azure MFA also supports third-party
    OAUTH tokens.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**你拥有的东西**：这类似于手机，通过发送短信、使用验证应用程序或接听电话来进行验证。Azure MFA 还支持第三方 OAUTH 令牌。'
- en: '**Something you are**: This is like biometrics, using fingerprints or facial
    recognition.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**你是谁**：这类似于生物识别技术，通过指纹或面部识别进行验证。'
- en: Azure MFA is part of Office 365 and Azure services. It is easy to set up, and
    you can select which verification methods you want to use for your users. When
    you have requirements to add MFA to on-premises applications that are not published
    to the cloud using the Azure Application Proxy, you can choose to deploy a on-premises
    MFA server as well.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: Azure MFA 是 Office 365 和 Azure 服务的一部分。它易于设置，你可以选择要为用户使用的验证方法。当你需要将 MFA 添加到未通过
    Azure 应用程序代理发布到云中的本地应用程序时，你也可以选择部署本地 MFA 服务器。
- en: If you want more information about the on-premises MFA Server and which features
    it offers, you can refer to: [https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication-get-started-server.](https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication-get-started-server)
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想了解更多有关本地 MFA 服务器的信息及其提供的功能，你可以参考：[https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication-get-started-server.](https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication-get-started-server)
- en: Azure MFA is included in the Azure Active Directory Premium Plans and the Enterprise
    Mobility + Security Suite. You can buy it as a standalone product as well.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: Azure MFA 包含在 Azure Active Directory Premium 计划和企业移动性与安全套件中。你也可以将其作为独立产品购买。
- en: You can leverage MFA in your custom applications using the MFA SDK as well.
    Users can sign in to the app using their existing credentials. The app sends a
    request to the Azure MFA service, and the Azure MFA service will send a request
    to a phone or other device. Once the user is authenticated, the Azure MFA service
    will send the response back to the application so that the user can be signed
    in. The MFA SDK can be used for multiple programming languages, such as C#, PHP,
    Ruby, and Java.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以在自定义应用程序中使用 MFA SDK 来实现 MFA。用户可以使用现有的凭证登录应用程序。该应用程序向 Azure MFA 服务发送请求，Azure
    MFA 服务将向电话或其他设备发送请求。用户通过身份验证后，Azure MFA 服务将响应返回给应用程序，从而完成用户登录。MFA SDK 支持多种编程语言，如
    C#、PHP、Ruby 和 Java。
- en: Enabling MFA in the Azure Portal
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 Azure 门户中启用 MFA
- en: 'To enable MFA in the Azure Portal, take the following steps:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Azure 门户中启用 MFA，请按照以下步骤操作：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 导航到 Azure 门户。
- en: Click on Azure Active Directory in the left menu.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧菜单中点击 Azure Active Directory。
- en: 'In the next blade, click on** Users**. Click on **Multi-Factor Authentication**
    in the top menu:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗格中，点击**用户**。然后在顶部菜单中点击 **多因素身份验证**：
- en: '![](img/afc45c9c-5e47-4b98-a9ce-9485065cb9d1.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/afc45c9c-5e47-4b98-a9ce-9485065cb9d1.jpg)'
- en: Enabling MFA - Azure Portal
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 MFA - Azure 门户
- en: The MFA portal is opened where you can enable MFA for each user.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将打开 MFA 门户，你可以为每个用户启用 MFA。
- en: Enabling MFA in Office 365
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 Office 365 中启用 MFA
- en: 'To enable MFA in the Office 365 admin center, take the following steps:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Office 365 管理中心启用 MFA，请按照以下步骤操作：
- en: Navigate to the Office 365 admin center by opening [https://portal.office.com/adminportal/home](https://portal.office.com/adminportal/home).
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开[https://portal.office.com/adminportal/home](https://portal.office.com/adminportal/home)
    进入 Office 365 管理中心。
- en: 'Go to Users | Active Users. Click More | Setup Azure mult.... as shown in the
    following screenshot:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入“用户 | 活跃用户”。点击“更多 | 设置 Azure 多重身份验证”，如下面的截图所示：
- en: '![](img/a6a27f28-2b84-49dd-829c-1ee7d6ea1f94.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a6a27f28-2b84-49dd-829c-1ee7d6ea1f94.jpg)'
- en: Enabling MFA - Office 365 Admin Center
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 MFA - Office 365 管理中心
- en: The MFA portal of Office 365 is opened, which looks basically the same as the
    Azure MFA portal.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Office 365 的 MFA 门户已打开，外观与 Azure MFA 门户基本相同。
- en: Azure Active Directory Business to Business
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Active Directory Business to Business
- en: Azure Active Directory Business to Business (B2B) is a feature on top of Azure
    Active Directory, which enables organizations to work safely with external users.
    To be added to Azure B2B, external users don't need to have an Microsoft work
    or personal account that is added to an existing Azure AD tenant. All sorts of
    accounts can be added to Azure B2B. You don't have to configure anything in the
    Azure Portal to use B2B; this feature is enabled by default for all Azure AD tenants.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Active Directory Business to Business (B2B) 是 Azure Active Directory 的一项功能，使组织能够安全地与外部用户合作。要加入
    Azure B2B，外部用户不需要拥有 Microsoft 工作或个人账户，并将其添加到现有的 Azure AD 租户中。各种账户都可以加入 Azure B2B。你无需在
    Azure 门户中进行任何配置即可使用 B2B；此功能默认对所有 Azure AD 租户启用。
- en: Azure B2B is integrated with Office 365 for external sharing. It also provides
    APIs that can be leveraged inside custom applications to let both internal and
    external users authenticate.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Azure B2B 与 Office 365 集成，支持外部共享。它还提供可以在自定义应用程序中使用的 API，让内部和外部用户都能进行身份验证。
- en: Azure AD Free features are available for external users at no cost. However,
    if you want external users to use Azure AD Premium features, such as MFA and conditional
    access, you need to have enough Azure AD Premium licenses with a ratio of 5:1\.
    This means, for every Azure AD Premium license, you can add five external users.
    So for instance, if your organization wants to add 50 external users to Azure
    B2B, there should be 10 Azure AD Premium licensed being purchased.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 免费功能对外部用户开放且无需收费。然而，如果你希望外部用户使用 Azure AD Premium 功能，如多重身份验证（MFA）和条件访问，你需要有足够的
    Azure AD Premium 许可证，比例为 5:1。这意味着每购买一个 Azure AD Premium 许可证，你可以添加五个外部用户。因此，举例来说，如果你的组织想要添加
    50 个外部用户到 Azure B2B，你需要购买 10 个 Azure AD Premium 许可证。
- en: 'Azure AD B2B offers the following features:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2B 提供以下功能：
- en: '**Management portal**: Separate portal for the external organization, where
    administrators can add, manage, and remove users.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理门户**：为外部组织提供的单独门户，管理员可以在其中添加、管理和删除用户。'
- en: '**Groups**: You can create groups for external users. You can use dynamic groups
    as well. Administrators can set up rules to populate groups based on user attributes.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组**：你可以为外部用户创建组。你也可以使用动态组。管理员可以设置规则，根据用户属性自动填充组。'
- en: '**Conditional access**: With conditional access, you can set certain conditions
    for your users. You can enforce external users to use MFA, or give them access
    to certain applications or only access from certain locations.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**条件访问**：通过条件访问，你可以为用户设置某些条件。你可以强制外部用户使用 MFA，或只允许他们访问某些应用程序，或仅允许从特定位置访问。'
- en: '**Sharing policies**:Not only administrators can invite external users. You
    can use policies to delegate these permissions to other external users. You can
    add the Guest Invitor role to the user, which is then allowed to send invites.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**共享策略**：不仅管理员可以邀请外部用户。你可以使用策略将这些权限委派给其他外部用户。你可以将“访客邀请者”角色分配给用户，这样该用户就可以发送邀请。'
- en: '**Auditing and reporting**: Just like normal users, there are auditing and
    reporting capabilities as well. You can look into the invitation history and acceptance
    details.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**审计和报告**：与普通用户一样，也有审计和报告功能。你可以查看邀请历史和接受详情。'
- en: Azure Active Directory Business to Consumer
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure Active Directory Business to Consumer
- en: Azure Active Directory Business to Consumer (B2C) is a cloud identity-management
    solution for mobile and web applications. It offers out-of-the-box authentication
    providers that can be leveraged from within your apps and custom APIs using MSAL,
    which is used in other Azure AD applications as well (using the V2 endpoint).
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Active Directory Business to Consumer (B2C) 是一种用于移动和 Web 应用程序的云身份管理解决方案。它提供开箱即用的身份验证提供程序，可以通过
    MSAL 在你的应用程序和自定义 API 中使用，这也是其他 Azure AD 应用程序所使用的（使用 V2 端点）。
- en: This means that developers don't have to add additional SDKs manually; that
    is all handled by Microsoft. Next, to the authentication providers that are offered
    by Microsoft, it also provides the ability to add your own authentication providers.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着开发人员无需手动添加额外的 SDK；所有这一切都由 Microsoft 处理。接下来，除了 Microsoft 提供的身份验证提供程序外，它还提供了添加您自己身份验证提供程序的能力。
- en: 'Azure AD B2C offers the following authentication providers:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD B2C 提供以下身份验证提供程序：
- en: '**Social accounts**: They are Facebook, Google, LinkedIn, and more'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**社交帐户**：它们是 Facebook、Google、LinkedIn 等'
- en: '**Enterprise accounts**: They use open standards protocols, such as OpenID
    Connect or SAML'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**企业帐户**：它们使用开放标准协议，如 OpenID Connect 或 SAML'
- en: '**Local accounts**: They are accounts using email address/username and password'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地帐户**：它们是使用电子邮件地址/用户名和密码的帐户。'
- en: Your application needs to be registered inside the Azure B2C tenant. After registration,
    built-in policies can be configured for the app where you can enable different
    authentication methods, set claims, enable MFA, or create a password reset policy,
    that the App can use.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 您的应用程序需要在 Azure B2C 租户内注册。注册后，可以为该应用配置内置策略，您可以启用不同的身份验证方法、设置声明、启用 MFA 或创建密码重置策略，供应用使用。
- en: You then add the required configuration settings for the application that is
    registered in the Azure B2C tenant to your code, and all the earlier-mentioned
    settings can be used without any further configuration.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，您将所需的配置设置添加到您注册在 Azure B2C 租户中的应用程序的代码中，并且所有前面提到的设置都可以在没有进一步配置的情况下使用。
- en: You can refer to the following site for more information about Azure AD B2C: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以参考以下网站获取更多有关 Azure AD B2C 的信息：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview)。
- en: Leveraging Azure AD B2C in your application
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在您的应用程序中利用 Azure AD B2C
- en: In this demo, we are creating an application that leverages the Azure AD B2C
    features for authentication. This consists of two steps, first is creating an
    Azure AD B2C tenant in the Azure Portal, and the second is creating the application.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在此演示中，我们创建一个利用 Azure AD B2C 功能进行身份验证的应用程序。此过程分为两个步骤，首先是在 Azure 门户中创建一个 Azure
    AD B2C 租户，然后是创建该应用程序。
- en: 'To create the Azure AD B2C tenant in the Azure Portal, follow these steps:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中创建 Azure AD B2C 租户，请按照以下步骤操作：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过打开 [https://portal.azure.com/](https://portal.azure.com/) 访问 Azure 门户。
- en: 'Click on New and type `Azure Active Directory B2C` in the search bar. Create
    a new tenant:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击新建，在搜索框中输入 `Azure Active Directory B2C`。创建一个新的租户：
- en: '![](img/dbd4030a-c9d0-4dac-924c-ead79b3587b9.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dbd4030a-c9d0-4dac-924c-ead79b3587b9.jpg)'
- en: Creating Azure B2C tenant
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 Azure B2C 租户
- en: 'Select Create a new Azure AD B2C Tenant, add the following settings, and click
    on Create:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择创建新的 Azure AD B2C 租户，添加以下设置，然后点击创建：
- en: '![](img/98944852-12ea-4de6-b275-efa89ade14e8.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/98944852-12ea-4de6-b275-efa89ade14e8.jpg)'
- en: Adding the settings
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 添加设置
- en: 'You can select the tenant by opening the menu in the top-right corner of the
    Azure Portal:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以通过打开 Azure 门户右上角的菜单来选择租户：
- en: '![](img/02c4a43f-5280-4850-8478-ab4ef88f31ec.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](img/02c4a43f-5280-4850-8478-ab4ef88f31ec.jpg)'
- en: Selecting Azure B2C tenant
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 Azure B2C 租户
- en: After creation, you can navigate to the Azure B2C page in the portal.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建后，您可以导航到门户中的 Azure B2C 页面。
- en: You can now set up different authentication providers inside the B2C tenant.
    For this demo, I've added a Google Identity provider. To add this, you can refer
    to the tutorial at: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app).
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以在 B2C 租户中设置不同的身份验证提供程序。在此演示中，我添加了一个 Google 身份提供程序。要添加此提供程序，您可以参考教程：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)。
- en: 'The next thing to do is to register the application. Click on Applicationsin
    the left menu and click on the Add button:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来要做的是注册应用程序。在左侧菜单中点击“应用程序”，然后点击“添加”按钮：
- en: '![](img/affc9aca-f58e-4b58-ad18-7615d0520295.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/affc9aca-f58e-4b58-ad18-7615d0520295.jpg)'
- en: Registering the application in Azure B2C
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure B2C 中注册应用程序
- en: 'We are going to create a Web App that authenticates to Azure B2C. We are using
    OpenID Connect sign in, so you have to enable Allow implicit flow. You need to
    add a Reply URL as well. Add the following settings and click on Create:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将创建一个Web应用程序来进行Azure B2C身份验证。我们使用OpenID Connect进行登录，因此你需要启用“允许隐式流”（Allow implicit
    flow）。你还需要添加回复URL。添加以下设置并点击“创建”：
- en: '![](img/f4ef0274-7beb-4dcb-bf51-3edd56ff4b59.jpg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f4ef0274-7beb-4dcb-bf51-3edd56ff4b59.jpg)'
- en: Adding App settings
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 添加应用程序设置
- en: 'When your app is created, click on the App. Copy the Application ID to your
    Notepad. The Application Key needs to be copied as well. Click on Keys in the
    left menu and click on Generate key:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当应用程序创建完成后，点击该应用程序。将应用程序ID复制到记事本中。还需要复制应用程序密钥。在左侧菜单中点击“密钥”（Keys），然后点击生成密钥（Generate
    key）：
- en: '![](img/ebef553c-3a01-4c78-a3b8-c1e4a541b8b5.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ebef553c-3a01-4c78-a3b8-c1e4a541b8b5.jpg)'
- en: Generating the key
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 生成密钥
- en: Immediately, click on Save and copy the key to the Notepad.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 立即点击保存并将密钥复制到记事本中。
- en: 'The next thing to do is to create a Google Identity Provider. Open Identity
    providers in the left menu and click on the Add button:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来要做的是创建一个Google身份提供者。打开左侧菜单中的身份提供者（Identity providers），然后点击“添加”按钮：
- en: '![](img/aa468f6e-aa53-474a-961c-95e71381a565.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aa468f6e-aa53-474a-961c-95e71381a565.jpg)'
- en: Adding Google Identity Provider
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 添加Google身份提供者
- en: 'In the next blade, select the following settings:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个面板中，选择以下设置：
- en: '![](img/e9aa08c8-ee15-4341-86c7-fb6ba8d90561.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e9aa08c8-ee15-4341-86c7-fb6ba8d90561.jpg)'
- en: Selecting Google
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 选择Google
- en: 'Open a new browser tab and navigate to: [https://console.developers.google.com](https://console.developers.google.com).
    Create a new project and add call it `PacktB2C`.Go back to the API home page and
    click on Credentials in the left menu:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个新的浏览器标签页并访问：[https://console.developers.google.com](https://console.developers.google.com)。创建一个新项目并命名为`PacktB2C`。返回API主页并在左侧菜单中点击凭据（Credentials）：
- en: '![](img/23158673-52d7-42d6-822d-61ed69db628e.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23158673-52d7-42d6-822d-61ed69db628e.jpg)'
- en: Retrieving App Credentials
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 获取应用程序凭据
- en: 'Click on the OAuth consent screen settings in the top menu, add the following,
    and click on Save:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击顶部菜单中的OAuth同意屏幕设置，添加以下内容，然后点击保存：
- en: '![](img/eaeac997-5a44-4896-9de3-387ff02d1adb.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/eaeac997-5a44-4896-9de3-387ff02d1adb.jpg)'
- en: OAuth consent settings
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: OAuth同意设置
- en: 'Click on the Credentials consent settings in the top menu and add the following
    settings:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击顶部菜单中的凭据同意设置（Credentials consent settings），然后添加以下设置：
- en: '![](img/e88c015a-631a-4211-98ed-ceec55a9bf72.jpg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e88c015a-631a-4211-98ed-ceec55a9bf72.jpg)'
- en: Creating OAuth credentials
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 创建OAuth凭据
- en: 'Add the following settings to create the app:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加以下设置以创建应用程序：
- en: '![](img/f1090aba-10ff-42d6-a1e7-afe40fe183ea.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f1090aba-10ff-42d6-a1e7-afe40fe183ea.jpg)'
- en: Registering the app
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 注册应用程序
- en: A popup appears with the Client ID and the Client secret. Copy it to the Notepad.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个弹出窗口会显示客户端ID和客户端密钥。将其复制到记事本中。
- en: 'Go back to the Azure Portal and add the Client ID and the Client secret to
    the blade where we were registering the Identity Provider and click on OK:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回Azure门户，将客户端ID和客户端密钥添加到我们注册身份提供者的面板中，然后点击“确定”：
- en: '![](img/a41fb438-e599-402c-95dc-cb1e915258a5.jpg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a41fb438-e599-402c-95dc-cb1e915258a5.jpg)'
- en: Adding Client ID and Client Secret
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 添加客户端ID和客户端密钥
- en: 'Next, you have to add Sign-in Policy.Click this in the left menu and click
    on Add. Add the following settings:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，你需要添加登录策略。在左侧菜单中点击此项，然后点击“添加”（Add）。添加以下设置：
- en: '![](img/2bc5f9ac-babd-40ec-87b8-6ef0d3415ae5.jpg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2bc5f9ac-babd-40ec-87b8-6ef0d3415ae5.jpg)'
- en: Adding the policy
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 添加策略
- en: 'Select the following application claims and click on OK, and then click on Create:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择以下应用程序声明并点击“确定”，然后点击“创建”：
- en: '![](img/4c7efdb8-7a67-46e2-b761-456fa6e179ca.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4c7efdb8-7a67-46e2-b761-456fa6e179ca.jpg)'
- en: Selecting Google Claims
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 选择Google声明
- en: 'The sample application can be downloaded from GitHub. Open the `Web.config` of
    the application and update the settings with the values that were copied to the
    Notepad earlier. It will look as follows:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 示例应用程序可以从GitHub下载。打开应用程序的`Web.config`文件，并用之前复制到记事本中的值更新设置。它应该如下所示：
- en: '[PRE0]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Run the application and click on the Sign inbutton. Make sure that the application
    runs on the IP address that you''ve configured in the Azure Portal as the Reply
    URL:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行应用程序并点击登录按钮。确保应用程序在你已在Azure门户配置为回复URL的IP地址上运行：
- en: '![](img/1ebd0cf2-7871-4299-ab4c-6b00c36b5437.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1ebd0cf2-7871-4299-ab4c-6b00c36b5437.jpg)'
- en: Signing into the application
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 登录应用程序
- en: You can now sign in using your Google account.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你可以使用你的Google账户进行登录。
- en: Summary
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we covered how to secure your resources using the different
    capabilities that Azure provides. We covered Azure Active Directory and how to
    design a hybrid environment using Azure AD Connect. We covered ADFS, Azure B2B,
    and Azure B2C.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中，我们介绍了如何利用Azure提供的不同功能来保护你的资源。我们讲解了Azure Active Directory，以及如何使用Azure AD
    Connect设计混合环境。我们还讨论了ADFS、Azure B2B和Azure B2C。
- en: The next chapter will be about securing your data.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章将讲解如何保护你的数据。
- en: Questions
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 回答以下问题，以测试你对本章内容的理解。你可以在本书最后的*评估*部分找到答案：
- en: You are creating a meeting application that leverages data from Office 365\.
    Users should be able to log in using their Azure Active Directory credentials.
    Can you use Microsoft Graph for this?
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你正在创建一个利用Office 365数据的会议应用程序。用户应该能够使用他们的Azure Active Directory凭据登录。你可以使用Microsoft
    Graph来实现吗？
- en: 'Yes'
  id: totrans-170
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是
- en: 'No'
  id: totrans-171
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否
- en: You want to create a hybrid environment and use single sign-on for both the
    on-premises applications as well as the cloud applications. Should you use Azure
    AD Connect for this?
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你想创建一个混合环境，并为本地应用程序和云应用程序都使用单一登录。你应该使用Azure AD Connect来实现吗？
- en: 'Yes'
  id: totrans-173
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是
- en: 'No'
  id: totrans-174
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否
- en: Is Azure AD B2B the appropriate solution for enabling external sharing in your
    SharePoint Online environment?
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Azure AD B2B是否是启用SharePoint Online环境中的外部共享的合适解决方案？
- en: 'Yes'
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是
- en: 'No'
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否
- en: Further reading
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 深入阅读
- en: 'You can check the following links for more information about the topics that
    have been covered in this chapter:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查看以下链接，获取有关本章涵盖主题的更多信息：
- en: '**Azure Active Directory Documentation**: [https://docs.microsoft.com/en-us/azure/active-directory/](https://docs.microsoft.com/en-us/azure/active-directory/)'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory文档**：[https://docs.microsoft.com/en-us/azure/active-directory/](https://docs.microsoft.com/en-us/azure/active-directory/)'
- en: '**Azure AD Connect sync**: Understand and customize synchronization: [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-whatis](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-whatis)'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure AD Connect同步**：了解和定制同步：[https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-whatis](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-whatis)'
- en: '**Azure AD Connect user sign-in options**: [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin)'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure AD Connect 用户登录选项**：[https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin)'
- en: '**Active Directory Federation Services**: [https://msdn.microsoft.com/en-us/library/bb897402.aspx](https://msdn.microsoft.com/en-us/library/bb897402.aspx)'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Active Directory 联合身份认证服务**：[https://msdn.microsoft.com/en-us/library/bb897402.aspx](https://msdn.microsoft.com/en-us/library/bb897402.aspx)'
- en: '**Deploying Active Directory Federation Services in Azure**: [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-azure-adfs](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-azure-adfs)'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**在Azure中部署Active Directory联合身份认证服务**：[https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-azure-adfs](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-azure-adfs)'
- en: '**Multi-factor Authentication Documentation**: [https://docs.microsoft.com/en-us/azure/multi-factor-authentication/](https://docs.microsoft.com/en-us/azure/multi-factor-authentication/)'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**多重身份验证文档**：[https://docs.microsoft.com/en-us/azure/multi-factor-authentication/](https://docs.microsoft.com/en-us/azure/multi-factor-authentication/)'
- en: '**What is Azure AD B2B collaboration?**: [https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b)'
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**什么是Azure AD B2B协作？**：[https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b)'
- en: '**Azure Active Directory B2C: Provide sign-up and sign-in to consumers with
    Microsoft accounts**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-msa-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-msa-app)'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory B2C：为使用Microsoft帐户的消费者提供注册和登录功能**：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-msa-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-msa-app)'
- en: '**Azure Active Directory B2C: Provide sign-up and sign-in to consumers with
    Facebook accounts**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-fb-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-fb-app)'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory B2C：为使用 Facebook 账户的消费者提供注册和登录功能**：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-fb-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-fb-app)'
- en: '**Azure Active Directory B2C: Provide sign-up and sign-in to consumers with
    Google+ accounts**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory B2C：为使用 Google+ 账户的消费者提供注册和登录功能**：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)'
- en: '**Azure Active Directory B2C: Register your application**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration)'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory B2C：注册你的应用程序**：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration)'
- en: '**Azure Active Directory B2C: Enable Multi-Factor Authentication in your consumer-facing
    applications**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-mfa](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-mfa)'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory B2C：在面向消费者的应用程序中启用多重身份验证**：[https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-mfa](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-mfa)'
