- en: Securing Your Resources
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, we covered designing for the Azure Data Services objective.
    We've covered some of the different Azure Data Services as well as relational
    databases in Azure. We also covered backup and security strategies and designing
    for high availability and performance.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, you will learn about the objective of the Design Security and
    Identity Solutions domains, by covering how to secure your resources, such as
    using Azure AD Connect, Multi-Factor Authentication (MFA), and more. It also covers
    how to use the different Identity Providers for your Azure Solutions.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered:'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory (Azure AD)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure AD Connect
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Active Directory Federation Services (ADFS)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Multi-Factor Authentication
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Active Directory Business to Business (Azure AD B2B)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Active Directory Business to Consumer (Azure AD B2C)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This chapter uses the following tools for the examples:'
  prefs: []
  type: TYPE_NORMAL
- en: Visual Studio 2017: [https://www.visualstudio.com/downloads/](https://www.visualstudio.com/downloads/)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The source code for this chapter can be downloaded from the following link:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%209/](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%209/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Active Directory
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Active Directory (Azure AD) offers directory and identity management from
    the cloud. It offers traditional username and password identity management and
    roles and permissions management. On top of that, it offers more enterprise solutions,
    such as MFA and applications monitoring, solution monitoring, and alerting. Azure
    AD can easily be integrated with your on-premises Active Directory to create a
    hybrid infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure AD offers the following pricing plans:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Free**: This offers the most basic features, such as support for up to 500,000
    objects, SSO, support for Azure AD Connect synchronization, and standard security
    reports'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Basic**: This offers no object limit, SLA of 99.9%, Groups, self-service
    password reset, and support for the Application Proxy'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Premium P1**: This offers Advanced Reporting, MFA, MDM auto-enrollment, Cloud
    app discovery, and Azure AD Connect Health'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Premium P2**:Identity protection and Privileged Identity Management'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For a detailed overview of the different pricing plans and all the features
    that are offered for each plan, you can refer to the following pricing page: [https://azure.microsoft.com/en-us/pricing/details/active-directory/](https://azure.microsoft.com/en-us/pricing/details/active-directory/).
  prefs: []
  type: TYPE_NORMAL
- en: Note that Azure AD Premium is part of the Enterprise Mobility + Security Suite.
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD can be leveraged in your custom apps and APIs as well for authorizing
    your users and securing your resources. It offers support for industry standard
    protocols such as OAuth2.0 and OpenID Connect and supports authentication for
    single and multitenant applications, as well as line of business (LOB) applications.
  prefs: []
  type: TYPE_NORMAL
- en: 'It offers two different endpoints that can be leveraged in your custom applications:'
  prefs: []
  type: TYPE_NORMAL
- en: '**V1 endpoint**:This endpoint offers support for Microsoft work or school accounts
    only, and it uses the Azure Portal to register the apps in Azure AD. It uses the **Azure
    Active Directory Library** (**ADAL**) SDK to authenticate users within the application.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**V2 endpoint**: This offers support for both Microsoft work or school accounts
    and personal accounts such as Outlook.com. It also offers a new registration portal
    located at `apps.dev.microsoft.com`, and that makes it much easier to register
    your application in Azure AD. It uses the **Microsoft Authentication Library **(**MSAL**)
    in order to authenticate your users within the application. Using this endpoint,
    you can create one single App ID for multiplatform apps. If your applications
    consist of a separate web, Android, and IoS app, they can all use the same App
    ID. You can use dynamic consent, where you grant permissions only at the time
    you need them in the application itself and not up front when registering the
    app in Azure AD.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Graph
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Microsoft Graph is a set of APIs that connects multiple Azure services together
    and provides a single endpoint for developers to use in their custom applications.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Graph is made up of relationships between the various Azure services.
    By calling the endpoint for a particular user, that is added to Azure AD, you
    can retrieve the documents where the user is working on, find his/her manager,
    retrieve the users meetings, get a list of devices, and much more.
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD is integrated in Microsoft Graph as well, but it can be leveraged for
    more than Azure AD features only. In fact, nearly all SaaS products of Azure use
    Azure AD, such as Office 365, Intune, Dynamic 365, and Azure SQL. All of those
    Azure services are integrated in Microsoft Graph and can be leveraged inside your
    apps and APIs.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Graph offers two different endpoints, the V1.0 endpoint, which consists
    of all the APIs that are general available and the beta endpoint, with the latter
    providing APIs that can still change over time.
  prefs: []
  type: TYPE_NORMAL
- en: To get started with the Graph API and to register your App in Azure AD, you
    can refer to: [https://developer.microsoft.com/en-us/graph](https://developer.microsoft.com/en-us/graph).
    This is a great starting point, where you can also download secure sample applications
    for multiple programming languages.
  prefs: []
  type: TYPE_NORMAL
- en: For an overview of all the Azure services that are integrated in Microsoft Graph,
    you can refer to this website as well.
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD Connect
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure AD Connect is a service that you can use to synchronize your on-premises
    Active Directory identities with Azure. This way, you can use the same identities
    for authentication on your on-premises environment as well as in the cloud and
    other SaaS applications.
  prefs: []
  type: TYPE_NORMAL
- en: The Azure AD Connect sync service consists of two parts, theAzure AD Connect
    sync component, which is a tool that is installed on a separate server inside
    your on-premises environment, and the Azure AD Connect sync service, which is
    part of Azure AD. The sync component can sync data from Active Directory and SQL
    Server to Azure. There is also a third component named the Active Directory Federation
    Services component, which can be used in a scenario where ADFS is involved. To
    monitor the on-premises identity infrastructure and the different Azure AD components,
    you can use a tool named Azure AD Connect Health.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d868326b-9917-4cfb-a551-ca44a36d0a5e.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Azure AD Connect architecture
  prefs: []
  type: TYPE_NORMAL
- en: For more information about how to install Azure AD Connect and syncing the user
    accounts and passwords, you can refer to [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-select-installation](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-select-installation)[.
    For more information about monitoring the Health, you can refer to: ](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)[https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)[.](https://docs.microsoft.com/en-us/azure/active-directory/connect-health/active-directory-aadconnect-health)
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD Connect offers support for your users to sign in with the same passwords
    to both on-premises as cloud resources. It provides three different authentication
    methods for this, the password hash synchronization method, the pass-through authentication
    method, and the Federated SSO method (in conjunction with Active Directory Federation
    Services).
  prefs: []
  type: TYPE_NORMAL
- en: These three different authentication methods are covered in more detail in the
    upcoming sections.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory password hash synchronization
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Most organizations only have a requirement to enable user sign-in to Office
    365, SaaS applications, and other Azure AD-based resources. The password hash
    synchronization method is well suitable for those scenario's.
  prefs: []
  type: TYPE_NORMAL
- en: Using this method, hashes of the user's password are synced between the on-premises
    Active Directory and Azure Active Directory. When there are any changes to the
    user's password, the password is synced immediately, so users can always log in
    with the same credentials on-premises as well as in Azure.
  prefs: []
  type: TYPE_NORMAL
- en: This authentication method also provides Azure AD Seamless Single Sign-On (SSO).
    This way, users are automatically signed in when they are using a domain-joined
    device on the corporate network. Users only have to enter their username when
    using Seamless SSO. To use Seamless SSO, you don't have to install additional
    software or components on the on-premises network. You can push this capability
    to your users using group policies.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Active Directory pass-through authentication
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Active Directory pass-through authentication offers the same capability,
    such as Azure AD password hash synchronization. Users can log in to their Azure
    resources as well as on-premises resources using the same credentials. The difference
    is that passwords aren't synced with Azure AD using pass-through authentication.
    The passwords are validated using the on-premises Active Directory and are not
    stored in the Azure Active Directory at all.
  prefs: []
  type: TYPE_NORMAL
- en: This method is suitable for organizations that have security and compliance
    restrictions and aren't allowed to send usernames and passwords outside the on-premises
    network.
  prefs: []
  type: TYPE_NORMAL
- en: Pass-through authentication requires an agent to be installed on a domain-joined
    Windows Server that resides inside the on-premises environment. This agent then
    listens for password validation requests and only makes an outbound connection
    from within your network. It also offers support for MFA and Azure AD Conditional
    Access policies.
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD pass-through authentication offers Azure AD Seamless SSO as well.
  prefs: []
  type: TYPE_NORMAL
- en: Active Directory Federation Services
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Active Directory Federation Services (ADFS) is a standards-based service and
    a feature of Windows Server that you can enable on a Windows Server machine. It
    provides an authentication provider for external users to log in to an on-premises
    environment over the internet.
  prefs: []
  type: TYPE_NORMAL
- en: 'ADFS offers the following features:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Web SSO**: This provides SSO for federated users when they access applications
    that are installed in the on-premises data center.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Web Services (WS) - interoperability**: Applications or users that don''t
    use the Windows identity model but are compatible with the WS-Federation specification
    can still authenticate to the ADFS server and your on-premises applications.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**No external user account management**:External users can authenticate using
    their own organization or personal credentials. Inside ADFS, a trust is established
    using the external authentication provider and ADFS. The user can then federate
    using Security Assertion Markup Language (SAML) claims.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Federated SSO Authentication method uses Azure AD Connect in conjunction
    with ADFS to offer federated Single Sign On to your users. You can deploy ADFS
    inside your on-premises data center or using Azure VMs. You can use the same Azure
    AD APIs, such as Microsoft Graph, to connect to your on-premises identities. Azure
    Active Directory is responsible for connecting to your on-premises environment
    via ADFS and takes care of the authentication process.
  prefs: []
  type: TYPE_NORMAL
- en: You can also expand the functionality of Azure AD using ADFS. You can implement
    custom claims or conditional policies that don't exist in Azure AD, or use you
    organization login screen with additional notifications or information or use
    a custom MFA provider. You can also create a trust between different environments
    using ADFS.
  prefs: []
  type: TYPE_NORMAL
- en: Multi-Factor Authentication
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In today's world, securing your data and systems is key. MFA adds a second layer
    of security to user sign-ins and is now a best practice to secure data. It enables
    two-step verification, where you first sign in with what you know and then with
    something you have.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure MFA uses the following verification methods:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Something you know**: This is like a traditional password.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Something you have**: This is like a phone, by sending a text message, using
    a verification app, or receiving a phone call. Azure MFA also supports third-party
    OAUTH tokens.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Something you are**: This is like biometrics, using fingerprints or facial
    recognition.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure MFA is part of Office 365 and Azure services. It is easy to set up, and
    you can select which verification methods you want to use for your users. When
    you have requirements to add MFA to on-premises applications that are not published
    to the cloud using the Azure Application Proxy, you can choose to deploy a on-premises
    MFA server as well.
  prefs: []
  type: TYPE_NORMAL
- en: If you want more information about the on-premises MFA Server and which features
    it offers, you can refer to: [https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication-get-started-server.](https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication-get-started-server)
  prefs: []
  type: TYPE_NORMAL
- en: Azure MFA is included in the Azure Active Directory Premium Plans and the Enterprise
    Mobility + Security Suite. You can buy it as a standalone product as well.
  prefs: []
  type: TYPE_NORMAL
- en: You can leverage MFA in your custom applications using the MFA SDK as well.
    Users can sign in to the app using their existing credentials. The app sends a
    request to the Azure MFA service, and the Azure MFA service will send a request
    to a phone or other device. Once the user is authenticated, the Azure MFA service
    will send the response back to the application so that the user can be signed
    in. The MFA SDK can be used for multiple programming languages, such as C#, PHP,
    Ruby, and Java.
  prefs: []
  type: TYPE_NORMAL
- en: Enabling MFA in the Azure Portal
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To enable MFA in the Azure Portal, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on Azure Active Directory in the left menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the next blade, click on** Users**. Click on **Multi-Factor Authentication**
    in the top menu:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/afc45c9c-5e47-4b98-a9ce-9485065cb9d1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Enabling MFA - Azure Portal
  prefs: []
  type: TYPE_NORMAL
- en: The MFA portal is opened where you can enable MFA for each user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enabling MFA in Office 365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To enable MFA in the Office 365 admin center, take the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Office 365 admin center by opening [https://portal.office.com/adminportal/home](https://portal.office.com/adminportal/home).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Go to Users | Active Users. Click More | Setup Azure mult.... as shown in the
    following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a6a27f28-2b84-49dd-829c-1ee7d6ea1f94.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Enabling MFA - Office 365 Admin Center
  prefs: []
  type: TYPE_NORMAL
- en: The MFA portal of Office 365 is opened, which looks basically the same as the
    Azure MFA portal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Azure Active Directory Business to Business
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Active Directory Business to Business (B2B) is a feature on top of Azure
    Active Directory, which enables organizations to work safely with external users.
    To be added to Azure B2B, external users don't need to have an Microsoft work
    or personal account that is added to an existing Azure AD tenant. All sorts of
    accounts can be added to Azure B2B. You don't have to configure anything in the
    Azure Portal to use B2B; this feature is enabled by default for all Azure AD tenants.
  prefs: []
  type: TYPE_NORMAL
- en: Azure B2B is integrated with Office 365 for external sharing. It also provides
    APIs that can be leveraged inside custom applications to let both internal and
    external users authenticate.
  prefs: []
  type: TYPE_NORMAL
- en: Azure AD Free features are available for external users at no cost. However,
    if you want external users to use Azure AD Premium features, such as MFA and conditional
    access, you need to have enough Azure AD Premium licenses with a ratio of 5:1\.
    This means, for every Azure AD Premium license, you can add five external users.
    So for instance, if your organization wants to add 50 external users to Azure
    B2B, there should be 10 Azure AD Premium licensed being purchased.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure AD B2B offers the following features:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Management portal**: Separate portal for the external organization, where
    administrators can add, manage, and remove users.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Groups**: You can create groups for external users. You can use dynamic groups
    as well. Administrators can set up rules to populate groups based on user attributes.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Conditional access**: With conditional access, you can set certain conditions
    for your users. You can enforce external users to use MFA, or give them access
    to certain applications or only access from certain locations.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Sharing policies**:Not only administrators can invite external users. You
    can use policies to delegate these permissions to other external users. You can
    add the Guest Invitor role to the user, which is then allowed to send invites.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Auditing and reporting**: Just like normal users, there are auditing and
    reporting capabilities as well. You can look into the invitation history and acceptance
    details.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Active Directory Business to Consumer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure Active Directory Business to Consumer (B2C) is a cloud identity-management
    solution for mobile and web applications. It offers out-of-the-box authentication
    providers that can be leveraged from within your apps and custom APIs using MSAL,
    which is used in other Azure AD applications as well (using the V2 endpoint).
  prefs: []
  type: TYPE_NORMAL
- en: This means that developers don't have to add additional SDKs manually; that
    is all handled by Microsoft. Next, to the authentication providers that are offered
    by Microsoft, it also provides the ability to add your own authentication providers.
  prefs: []
  type: TYPE_NORMAL
- en: 'Azure AD B2C offers the following authentication providers:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Social accounts**: They are Facebook, Google, LinkedIn, and more'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Enterprise accounts**: They use open standards protocols, such as OpenID
    Connect or SAML'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Local accounts**: They are accounts using email address/username and password'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your application needs to be registered inside the Azure B2C tenant. After registration,
    built-in policies can be configured for the app where you can enable different
    authentication methods, set claims, enable MFA, or create a password reset policy,
    that the App can use.
  prefs: []
  type: TYPE_NORMAL
- en: You then add the required configuration settings for the application that is
    registered in the Azure B2C tenant to your code, and all the earlier-mentioned
    settings can be used without any further configuration.
  prefs: []
  type: TYPE_NORMAL
- en: You can refer to the following site for more information about Azure AD B2C: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview).
  prefs: []
  type: TYPE_NORMAL
- en: Leveraging Azure AD B2C in your application
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this demo, we are creating an application that leverages the Azure AD B2C
    features for authentication. This consists of two steps, first is creating an
    Azure AD B2C tenant in the Azure Portal, and the second is creating the application.
  prefs: []
  type: TYPE_NORMAL
- en: 'To create the Azure AD B2C tenant in the Azure Portal, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on New and type `Azure Active Directory B2C` in the search bar. Create
    a new tenant:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/dbd4030a-c9d0-4dac-924c-ead79b3587b9.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Creating Azure B2C tenant
  prefs: []
  type: TYPE_NORMAL
- en: 'Select Create a new Azure AD B2C Tenant, add the following settings, and click
    on Create:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/98944852-12ea-4de6-b275-efa89ade14e8.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Adding the settings
  prefs: []
  type: TYPE_NORMAL
- en: 'You can select the tenant by opening the menu in the top-right corner of the
    Azure Portal:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/02c4a43f-5280-4850-8478-ab4ef88f31ec.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Selecting Azure B2C tenant
  prefs: []
  type: TYPE_NORMAL
- en: After creation, you can navigate to the Azure B2C page in the portal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can now set up different authentication providers inside the B2C tenant.
    For this demo, I've added a Google Identity provider. To add this, you can refer
    to the tutorial at: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app).
  prefs: []
  type: TYPE_NORMAL
- en: 'The next thing to do is to register the application. Click on Applicationsin
    the left menu and click on the Add button:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/affc9aca-f58e-4b58-ad18-7615d0520295.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Registering the application in Azure B2C
  prefs: []
  type: TYPE_NORMAL
- en: 'We are going to create a Web App that authenticates to Azure B2C. We are using
    OpenID Connect sign in, so you have to enable Allow implicit flow. You need to
    add a Reply URL as well. Add the following settings and click on Create:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/f4ef0274-7beb-4dcb-bf51-3edd56ff4b59.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Adding App settings
  prefs: []
  type: TYPE_NORMAL
- en: 'When your app is created, click on the App. Copy the Application ID to your
    Notepad. The Application Key needs to be copied as well. Click on Keys in the
    left menu and click on Generate key:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ebef553c-3a01-4c78-a3b8-c1e4a541b8b5.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Generating the key
  prefs: []
  type: TYPE_NORMAL
- en: Immediately, click on Save and copy the key to the Notepad.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next thing to do is to create a Google Identity Provider. Open Identity
    providers in the left menu and click on the Add button:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/aa468f6e-aa53-474a-961c-95e71381a565.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Adding Google Identity Provider
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next blade, select the following settings:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e9aa08c8-ee15-4341-86c7-fb6ba8d90561.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Selecting Google
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a new browser tab and navigate to: [https://console.developers.google.com](https://console.developers.google.com).
    Create a new project and add call it `PacktB2C`.Go back to the API home page and
    click on Credentials in the left menu:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/23158673-52d7-42d6-822d-61ed69db628e.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Retrieving App Credentials
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on the OAuth consent screen settings in the top menu, add the following,
    and click on Save:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/eaeac997-5a44-4896-9de3-387ff02d1adb.jpg)'
  prefs: []
  type: TYPE_IMG
- en: OAuth consent settings
  prefs: []
  type: TYPE_NORMAL
- en: 'Click on the Credentials consent settings in the top menu and add the following
    settings:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e88c015a-631a-4211-98ed-ceec55a9bf72.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Creating OAuth credentials
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following settings to create the app:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/f1090aba-10ff-42d6-a1e7-afe40fe183ea.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Registering the app
  prefs: []
  type: TYPE_NORMAL
- en: A popup appears with the Client ID and the Client secret. Copy it to the Notepad.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Go back to the Azure Portal and add the Client ID and the Client secret to
    the blade where we were registering the Identity Provider and click on OK:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a41fb438-e599-402c-95dc-cb1e915258a5.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Adding Client ID and Client Secret
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, you have to add Sign-in Policy.Click this in the left menu and click
    on Add. Add the following settings:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2bc5f9ac-babd-40ec-87b8-6ef0d3415ae5.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Adding the policy
  prefs: []
  type: TYPE_NORMAL
- en: 'Select the following application claims and click on OK, and then click on Create:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4c7efdb8-7a67-46e2-b761-456fa6e179ca.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Selecting Google Claims
  prefs: []
  type: TYPE_NORMAL
- en: 'The sample application can be downloaded from GitHub. Open the `Web.config` of
    the application and update the settings with the values that were copied to the
    Notepad earlier. It will look as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Run the application and click on the Sign inbutton. Make sure that the application
    runs on the IP address that you''ve configured in the Azure Portal as the Reply
    URL:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1ebd0cf2-7871-4299-ab4c-6b00c36b5437.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Signing into the application
  prefs: []
  type: TYPE_NORMAL
- en: You can now sign in using your Google account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we covered how to secure your resources using the different
    capabilities that Azure provides. We covered Azure Active Directory and how to
    design a hybrid environment using Azure AD Connect. We covered ADFS, Azure B2B,
    and Azure B2C.
  prefs: []
  type: TYPE_NORMAL
- en: The next chapter will be about securing your data.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Answer the following questions to test your knowledge of the information in
    this chapter. You can find the answers in the *Assessments* section at the end
    of this book:'
  prefs: []
  type: TYPE_NORMAL
- en: You are creating a meeting application that leverages data from Office 365\.
    Users should be able to log in using their Azure Active Directory credentials.
    Can you use Microsoft Graph for this?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: You want to create a hybrid environment and use single sign-on for both the
    on-premises applications as well as the cloud applications. Should you use Azure
    AD Connect for this?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Is Azure AD B2B the appropriate solution for enabling external sharing in your
    SharePoint Online environment?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Yes'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'No'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can check the following links for more information about the topics that
    have been covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Azure Active Directory Documentation**: [https://docs.microsoft.com/en-us/azure/active-directory/](https://docs.microsoft.com/en-us/azure/active-directory/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure AD Connect sync**: Understand and customize synchronization: [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-whatis](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-whatis)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure AD Connect user sign-in options**: [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Active Directory Federation Services**: [https://msdn.microsoft.com/en-us/library/bb897402.aspx](https://msdn.microsoft.com/en-us/library/bb897402.aspx)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Deploying Active Directory Federation Services in Azure**: [https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-azure-adfs](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-azure-adfs)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Multi-factor Authentication Documentation**: [https://docs.microsoft.com/en-us/azure/multi-factor-authentication/](https://docs.microsoft.com/en-us/azure/multi-factor-authentication/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**What is Azure AD B2B collaboration?**: [https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Active Directory B2C: Provide sign-up and sign-in to consumers with
    Microsoft accounts**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-msa-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-msa-app)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Active Directory B2C: Provide sign-up and sign-in to consumers with
    Facebook accounts**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-fb-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-fb-app)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Active Directory B2C: Provide sign-up and sign-in to consumers with
    Google+ accounts**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Active Directory B2C: Register your application**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Azure Active Directory B2C: Enable Multi-Factor Authentication in your consumer-facing
    applications**: [https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-mfa](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-mfa)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
