- en: Working with Azure Virtual Machines
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Azure 虚拟机
- en: This is the first chapter of the book *Architecting Azure Solutions*. This book
    will cover all the objectives for the 70-535 exam. When relevant, we will provide
    you with extra information and further guidance on how to design and architect
    robust, future-proof, and effective solutions on the Azure platform.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 这是《*设计 Azure 解决方案*》一书的第一章。本书将涵盖70-535考试的所有目标。在相关部分，我们将为您提供额外的信息和指导，帮助您在 Azure
    平台上设计和架构强大、未来-proof 和有效的解决方案。
- en: This chapter introduces the Microsoft Azure **Virtual Machine** (**VM**) objective.
    We will cover information about series and sizes. We will also cover how to design
    VM deployments using Availability Sets, fault domains, and update domains. In
    addition, we will show you how to create an Availability Set from the Azure Portal,
    as well as from Azure PowerShell. Finally, we will cover how to design and manage
    VM Scale Sets from the Azure Portal.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了 Microsoft Azure **虚拟机**（**VM**）的目标。我们将涵盖虚拟机的系列和规格信息。我们还将讲解如何通过可用性集、故障域和更新域设计虚拟机部署。此外，我们将向您展示如何通过
    Azure 门户以及 Azure PowerShell 创建可用性集。最后，我们将介绍如何通过 Azure 门户设计和管理 VM 扩展集。
- en: 'In this chapter, the following topics will be covered:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Designing solutions for virtual machines
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为虚拟机设计解决方案
- en: Virtual machine series and sizes
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟机系列和规格
- en: Availability Sets
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用性集
- en: Fault domains and update domains
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障域和更新域
- en: Managed Disks
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 托管磁盘
- en: Creating highly available VMs
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建高可用性的虚拟机
- en: VM Scale Sets
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VM 扩展集
- en: Disaster recovery
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 灾难恢复
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter uses the following tools for its examples:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章示例使用以下工具：
- en: Azure PowerShell: [https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.6.0&viewFallbackFrom=azurermps-5.1.1](https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.6.0&viewFallbackFrom=azurermps-5.1.1)
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Azure PowerShell: [https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.6.0&viewFallbackFrom=azurermps-5.1.1](https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.6.0&viewFallbackFrom=azurermps-5.1.1)'
- en: 'The source code for this chapter can be downloaded here:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的源代码可以在此下载：
- en: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%201](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%201)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%201](https://github.com/SjoukjeZaal/AzureArchitectureBook/tree/master/Chapter%201)'
- en: Designing solutions for virtual machines
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为虚拟机设计解决方案
- en: In Azure, you can run both Windows VMs as well as Linux VMs. Virtual machines
    come in all sorts of sizes and a variety of prices, ranging from VMs with a small
    amount of memory and processing power for general purposes to large VMs that can
    be used for GPU-intensive and high-performance computing workloads.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 中，您可以运行 Windows 虚拟机和 Linux 虚拟机。虚拟机有各种大小和价格，从具有少量内存和处理能力的一般用途虚拟机，到可用于
    GPU 密集型和高性能计算工作负载的大型虚拟机。
- en: To create a virtual machine, you can choose from a number of predefined images.
    There are images available for operating systems such as Windows Server or Kali
    Linux, as well as predefined applications, such as SQL Server images and complete
    farms, which consist of multiple VMs that can be deployed at once. An example
    of a farm is a three-tier SharePoint farm.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建虚拟机，您可以选择多个预定义的镜像。操作系统镜像（如 Windows Server 或 Kali Linux）以及预定义的应用程序（如 SQL Server
    镜像和完整的 farm，这些 farm 由多个虚拟机组成，可以一次性部署）都可以选择。例如，三层 SharePoint farm 就是一个 farm 示例。
- en: VMs can be created and managed either from the Azure Portal, PowerShell, or
    CLI. If you're planning on using PowerShell, please note that there are multiple
    versions of Azure PowerShell available, and that there is a notable difference
    between Azure PowerShell, which supports the classic deployment model, and the
    *new* Azure PowerShell. To install and configure Azure PowerShell, please refer
    to the beginning of this chapter.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机可以通过 Azure 门户、PowerShell 或 CLI 创建和管理。如果您计划使用 PowerShell，请注意 Azure PowerShell
    有多个版本，而且 Azure PowerShell 和 *新* Azure PowerShell 之间存在显著差异。要安装和配置 Azure PowerShell，请参阅本章的开头部分。
- en: For the demos in this book, we will be using the Azure PowerShell version that
    supports the *new* Azure PowerShell. I strongly advise using this version of PowerShell
    for all your new deployments and solutions. The classic model should only be used
    for solutions that have already been deployed using this model previously.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的演示将使用支持 *新* Azure PowerShell 的版本。我强烈建议您在所有新的部署和解决方案中使用此版本的 PowerShell。经典模型仅应用于之前已使用此模型部署的解决方案。
- en: Designing the most effective virtual machine solution depends on a few things,
    such as deciding which size and series to use, deciding if your VMs need high
    availability, and if your solution will need to scale up and down easily.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 设计最有效的虚拟机解决方案取决于几个因素，例如决定使用哪个尺寸和系列，决定虚拟机是否需要高可用性，以及解决方案是否需要轻松进行横向扩展和纵向扩展。
- en: Virtual machine series and sizes
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机系列和尺寸
- en: There are a lot of different VM sizes available to choose from in Azure. Note
    that it is important to know what options there are from a design perspective,
    because choosing the wrong VM size can have a negative impact on the performance
    of your VM, or your application installed on the VM. Choosing between the different
    available options will also have a huge effect on the overall costs. For example,
    if your company or client wants to reduce costs by migrating data centers to Azure,
    choosing your VMs wisely will either make your project a success or a failure.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 提供了许多不同的虚拟机尺寸可供选择。请注意，从设计角度了解可用选项非常重要，因为选择错误的虚拟机尺寸可能会对虚拟机的性能或安装在虚拟机上的应用程序产生负面影响。在不同选项之间的选择也会对整体成本产生巨大影响。例如，如果您的公司或客户希望通过将数据中心迁移到
    Azure 来降低成本，明智地选择虚拟机将决定您的项目是成功还是失败。
- en: Azure VMs are organized into machine series, starting with the A-series, which
    are VMs mainly used for general purposes. There are also VM sizes that are optimized
    for compute, memory, storage, and GPU, as well as high-performance compute VMs.
    All of the available series and sizes are explained in more detail in the following
    section.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 虚拟机按机器系列进行组织，从 A 系列开始，这些虚拟机主要用于通用目的。还有专为计算、内存、存储和 GPU 优化的虚拟机系列，以及高性能计算虚拟机。以下部分将详细解释所有可用的系列和尺寸。
- en: Available VM series and sizes
  id: totrans-26
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可用的虚拟机系列和尺寸
- en: 'At the time of writing this book, the following VM series are available:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在编写本书时，以下虚拟机系列可供选择：
- en: '| **Sizes** | **Type** | **Description** |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| **尺寸** | **类型** | **描述** |'
- en: '| A0-7, Av2, B, D, DS, Dv2, DSv2, Dv3, Dsv3 | General purpose | These VMs have a balanced
    CPU-to-memory ratio and are ideal for testing and development scenarios. They
    are also suitable for small and medium databases and web servers with low to medium
    traffic. |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| A0-7, Av2, B, D, DS, Dv2, DSv2, Dv3, Dsv3 | 通用型 | 这些虚拟机具有平衡的 CPU 与内存比率，适用于测试和开发场景。它们也适用于小型和中型数据库以及低至中等流量的
    Web 服务器。 |'
- en: '| F, Fs, Fsv2 | Compute optimized | These VMs have a high CPU-to-memory ratio
    and are suitable for web servers with medium traffic, application servers, and
    network appliances for nodes in batch processing. |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| F, Fs, Fsv2 | 计算优化型 | 这些虚拟机具有高 CPU 与内存比率，适用于中等流量的 Web 服务器、应用程序服务器和批处理节点的网络设备。
    |'
- en: '| D, DS, Dv2, DSv2, Ev3, Esv3, G, GS, M | Memory optimized | These VMs have
    a high memory-to-CPU ratio and are suitable for relational database servers, medium
    to large caches, and in-memory analytics. |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| D, DS, Dv2, DSv2, Ev3, Esv3, G, GS, M | 内存优化型 | 这些虚拟机具有高内存与 CPU 比率，适用于关系型数据库服务器、中到大型缓存和内存分析。
    |'
- en: '| Ls | Storage optimized | These VMs have high disk throughput and IO and are
    suitable for big data, SQL, and NoSQL databases. |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| Ls | 存储优化型 | 这些虚拟机具有高磁盘吞吐量和 I/O，适用于大数据、SQL 和 NoSQL 数据库。 |'
- en: '| NC, NCv2, NCv3, ND, NV | GPU | These VMs are targeted for heavy graphic rendering
    and video editing, deep learning applications, and machine learning model training.
    These VMs are available with single or multiple GPUs.  |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| NC, NCv2, NCv3, ND, NV | GPU | 这些虚拟机专为重度图形渲染、视频编辑、深度学习应用和机器学习模型训练而设计。此类虚拟机可以选择单个或多个
    GPU。 |'
- en: '| A8-11, H | High-performance compute | These are the fastest VMs available.
    They offer the most powerful CPU with optional high-throughput network interfaces
    (RDMA). |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| A8-11, H | 高性能计算型 | 这些是最快的虚拟机，提供最强大的 CPU 和可选的高吞吐量网络接口（RDMA）。 |'
- en: VM machine series are updated constantly. New series, types, and sizes are added
    and removed frequently. To stay up to date with these changes, you can refer to
    the following site for Windows VM sizes: [https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes).
    For Linux VM sizes, you can refer to [https://docs.microsoft.com/en-us/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机系列会不断更新。新的系列、类型和大小会频繁地添加和移除。要了解这些变化，您可以参考以下网站获取 Windows 虚拟机的大小：[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes)。对于
    Linux 虚拟机大小，您可以参考[https://docs.microsoft.com/en-us/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)。
- en: Availability Sets
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可用性集
- en: 'To create a reliable infrastructure, adding your virtual machines to an Availability
    Set is key. There are several scenarios that can have an impact on the availability
    of your Azure Virtual Machines. These are as follows:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建一个可靠的基础设施，将虚拟机添加到可用性集是关键。有几个场景可能会影响您 Azure 虚拟机的可用性，具体如下：
- en: '**Unplanned hardware maintenance event**:When hardware is about to fail, Azure
    fires an unplanned hardware maintenance event. Live migration technology is used,
    which predicts the failure and then moves the VM, the network connections, memory,
    and storage to different physical machines without disconnecting the client. When
    your VM is moved, the performance is reduced for a short time because the VM is
    paused for 30 seconds. Network connections, memory, and open files are still preserved.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**非计划的硬件维护事件**：当硬件即将发生故障时，Azure 会触发一个非计划的硬件维护事件。使用实时迁移技术，预测故障并将虚拟机、网络连接、内存和存储迁移到不同的物理机器上，而不会中断客户端。当虚拟机迁移时，性能会暂时下降，因为虚拟机会暂停30秒。网络连接、内存和打开的文件仍然被保留。'
- en: '**Unexpected downtime**:The virtual machine is down when this event occurs
    because Azure needs to heal your VM inside the same data center. A hardware or
    physical infrastructure failure often causes this event to happen.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**意外停机**：当发生此事件时，虚拟机会宕机，因为 Azure 需要在同一数据中心内修复您的虚拟机。硬件或物理基础设施故障通常会导致此事件的发生。'
- en: '**Planned hardware maintenance event: **This type of event is a periodic update
    from Microsoft in Azure to improve the platform. Most of these updates don''t
    have a significant impact on the uptime of VMs, but some of them may require a
    reboot or restart.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**计划硬件维护事件**：此类事件是 Microsoft 在 Azure 中定期进行的更新，以改进平台。大多数更新不会对虚拟机的正常运行时间产生重大影响，但其中一些可能需要重启或重新启动。'
- en: To provide redundancy during these types of events, you can group two or more
    VMs in an Availability Set. By leveraging Availability Sets, VMs are distributed
    across multiple isolated hardware nodes in a cluster. This way, Azure can ensure
    that during an event or failure, only a subset of your VMs is impacted and your
    overall solution will remain operational and available. This way, the 99.95% Azure
    SLA can be met.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在这些事件期间提供冗余，您可以将两个或更多虚拟机分组到一个可用性集中。通过利用可用性集，虚拟机分布在集群中的多个隔离硬件节点上。这样，Azure 可以确保在发生事件或故障时，只有一部分虚拟机会受到影响，您的整体解决方案仍将保持运行并可用。这样可以确保达到99.95%的
    Azure 服务等级协议（SLA）。
- en: For a detailed overview of when and how the SLA applies, you can refer to the
    following overview: [https://azure.microsoft.com/en-us/support/legal/sla/virtual-machines/v1_6/](https://azure.microsoft.com/en-us/support/legal/sla/virtual-machines/v1_6/).
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 要详细了解 SLA 适用的时机和方式，您可以参考以下概述：[https://azure.microsoft.com/en-us/support/legal/sla/virtual-machines/v1_6/](https://azure.microsoft.com/en-us/support/legal/sla/virtual-machines/v1_6/)。
- en: Fault domains and update domains
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障域和更新域
- en: When you place your VMs in an Availability Set, Azure guarantees to spread them
    across fault and update domains. By default, Azure will assign **three fault domains
    and five update domains** (which can be increased to a maximum of 20) to the Availability Set.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 当您将虚拟机放入可用性集时，Azure 保证将它们分布在故障域和更新域中。默认情况下，Azure 会为可用性集分配**三个故障域和五个更新域**（最多可增加到20个）。
- en: When spreading your VMs over fault domains, your VMs sit over three different
    racks in the Azure data center. So, in the case of an event or failure on the
    underlying platform, only one rack gets affected and the other VMs are still accessible.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 当将虚拟机分布在故障域时，您的虚拟机会分布在 Azure 数据中心的三个不同机架上。因此，在底层平台发生事件或故障时，只有一个机架会受到影响，其他虚拟机仍然可以访问。
- en: '![](img/9e1f45dc-0099-4de3-a63a-475bbce23614.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9e1f45dc-0099-4de3-a63a-475bbce23614.jpg)'
- en: VMs spread over three fault domains
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机分布在三个故障域上
- en: Update domains are useful in the case of an OS or host update. When you spread
    your VMs across multiple update domains, one domain will be updated and rebooted
    while the others remain accessible.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 更新域在操作系统或主机更新时非常有用。当您将虚拟机分布到多个更新域时，一个域会被更新并重启，而其他域仍然可以访问。
- en: '![](img/f93ad0fd-5a40-408a-9a98-d035d6457e87.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f93ad0fd-5a40-408a-9a98-d035d6457e87.jpg)'
- en: VMs spread over five update domains and three fault domains
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机分布在五个更新域和三个故障域上
- en: Managed Disks
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 托管磁盘
- en: Azure Managed Disks are the default disks selected when you create a VM in the
    Azure Portal. They handle storage for your virtual machines completely. Previously,
    you would have to manually create storage accounts to store VM hard disks, and
    when your VM needed to scale up, you have to add additional storage accounts to
    make sure you didn't exceed the limit of 20,000 IOPS per account.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 托管磁盘是在 Azure 门户中创建虚拟机时选择的默认磁盘。它们完全处理您的虚拟机存储。以前，您需要手动创建存储帐户来存储虚拟机硬盘，并且当虚拟机需要扩展时，您还需要添加额外的存储帐户，以确保不会超过每个帐户
    20,000 IOPS 的限制。
- en: With Managed Disks, this burden is now handled for you by Azure. You can now
    create 10,000 VM disks inside a subscription, which can result in thousands of
    VMs inside a subscription, without the need to copy disks between storage accounts.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 使用托管磁盘时，这些负担现在由 Azure 为您处理。您现在可以在一个订阅中创建 10,000 个虚拟机磁盘，这样就能在一个订阅中部署成千上万个虚拟机，而无需在存储帐户之间复制磁盘。
- en: If you are still using Unmanaged Disks, it is highly recommended that you switch
    to Managed Disks. To convert your disks from Unmanaged to Managed, refer to the
    following article: [https://docs.microsoft.com/en-us/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您仍在使用非托管磁盘，强烈建议您切换到托管磁盘。要将磁盘从非托管转换为托管，请参考以下文章：[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks)。
- en: Disaster recovery
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 灾难恢复
- en: 'Business continuity and disaster recovery is still key, even when you are deploying
    your virtual machines to the cloud. Azure provides two different services for
    this: the **Azure Backup Service** and the **Azure Site Recovery Service**. Together,
    they address disaster recovery needs natively in the cloud.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 即使您将虚拟机部署到云中，业务连续性和灾难恢复仍然至关重要。Azure 提供了两种不同的服务来处理此问题：**Azure 备份服务**和**Azure
    站点恢复服务**。它们共同在云中原生地解决了灾难恢复需求。
- en: Backup and recovery
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 备份与恢复
- en: Azure uses the Azure Backup Service to back up virtual machines. You can use
    this service to back up your Azure VMs as well as your on-premises VMs. You can
    also use it to extend your backup solution in a hybrid configuration or fully
    replace your on-premises backup solution with Azure Backup. The service can back
    up files, folders, VMs, applications, workloads, system states, and volumes.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 使用 Azure 备份服务来备份虚拟机。您可以使用此服务备份 Azure 虚拟机以及本地虚拟机。您还可以将它用于混合配置中的备份解决方案扩展，或完全用
    Azure 备份替代本地备份解决方案。该服务可以备份文件、文件夹、虚拟机、应用程序、工作负载、系统状态和卷。
- en: 'Azure Backup consists of the following backup components:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 备份由以下备份组件组成：
- en: '**Azure Backup (MARS) agent**: This agent needs to be installed on a Windows
    Server VM (there is currently no support for Linux) that runs in Azure or resides
    on your on-premises infrastructure. You can use it to back up VMs, files, folders,
    and system states.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 备份（MARS）代理**：此代理需要安装在运行于 Azure 或您本地基础设施上的 Windows Server 虚拟机上（当前不支持
    Linux）。您可以使用它来备份虚拟机、文件、文件夹和系统状态。'
- en: '**Protection for system center Data Protection Manager (DPM) servers**: You
    can use Azure Backup for a hybrid setup in conjunction with DPM servers. The DPM
    server can be deployed inside your on-premises data center or on a virtual machine
    in Azure. You can use it to store older data in the Azure Recovery Services Vault
    and use the disks for newer data, for instance.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**保护 System Center 数据保护管理器（DPM）服务器**：您可以在混合设置中与 DPM 服务器一起使用 Azure 备份。DPM 服务器可以部署在您的本地数据中心内或
    Azure 的虚拟机上。您可以使用它将旧数据存储在 Azure 备份服务保险库中，并使用磁盘存储新数据，例如。'
- en: '**Azure Backup Server**: This component is installed on an on-premises Windows
    server or a Windows VM in Azure. It offers backup support for Windows and Linux
    servers and it uses the Azure Recovery Services Vault to store backups.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 备份服务器**：这个组件安装在本地 Windows 服务器或 Azure 的 Windows VM 上。它为 Windows 和 Linux
    服务器提供备份支持，并使用 Azure 恢复服务保险库存储备份。'
- en: '**Azure IaaS VM backup**: This consists of an agent that needs to be installed
    on your Azure VMs. These can be either Linux or Windows VMs. You cannot use this
    tool to back up your on-premises servers.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure IaaS VM backup**：这包括一个需要安装在您的 Azure 虚拟机上的代理程序。这些虚拟机可以是 Linux 或 Windows
    虚拟机。您不能使用此工具备份您的本地服务器。'
- en: When using the Azure Backup Service to back up your VM, most of the work will
    be in preparing the virtual machines. Your VM must meet the prerequisites before
    the backup can be initiated to take snapshots from the virtual machines. First,
    you will need to create a **Recovery Services Vault** in Azure to store the backups.
    Then, the VM agent needs to be installed on the virtual machine. You also need
    to check your network connectivity at this point. When all the prerequisites have
    been met, you can back up your VMs to the Recovery Services Vault. These backups
    are easily created from the Azure Portal, PowerShell, or CLI. The snapshots are
    then stored inside the Recovery Services Vault, and from there you can also restore
    the snapshots. When restoring, you can choose to either restore the whole VM or
    only individual files or folders.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Azure 备份服务备份您的 VM 时，大部分工作将在准备虚拟机方面。在备份可以从虚拟机中进行快照之前，您的 VM 必须满足先决条件。首先，您需要在
    Azure 中创建一个**恢复服务保险库**以存储备份。然后，需要在虚拟机上安装 VM 代理程序。此时还需要检查您的网络连接。当所有先决条件都满足时，您可以将
    VM 备份到恢复服务保险库中。这些备份可以轻松地通过 Azure 门户、PowerShell 或 CLI 创建。然后，快照将存储在恢复服务保险库中，您也可以从那里恢复快照。在恢复时，您可以选择恢复整个
    VM 或仅恢复单个文件或文件夹。
- en: 'The prerequisites for backing up virtual machines are described in detail in
    the following article: [https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms-prepare](https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms-prepare).'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机备份的先决条件在以下文章中有详细描述：[https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms-prepare](https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms-prepare)。
- en: Creating highly available virtual machines
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建高可用性虚拟机
- en: VMs can only be added to an an Availability Set by creation. When you want to
    add existing VMs to an Availability Set, this will result in recreating your VMs.
    This is something to be aware of when designing your solutions.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: VM 只能通过创建添加到可用性集。当您希望将现有 VM 添加到可用性集时，这将导致重新创建您的 VM。这是设计解决方案时需要注意的事项。
- en: Creating highly available virtual machines from the Azure Portal
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从 Azure 门户创建高可用性虚拟机
- en: 'Follow the given steps to create a VM from the Azure Portal:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤从 Azure 门户创建虚拟机：
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 [https://portal.azure.com/](https://portal.azure.com/) 导航到 Azure 门户。
- en: 'Click on New and, on the right-hand side, choose an image (or you can type
    an image name in the search bar). For this demo, we have selected the Windows
    Server 2016 VM image:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**新建**，在右侧选择一个镜像（或者您可以在搜索栏中输入镜像名称）。在这个演示中，我们选择了 Windows Server 2016 VM 镜像：
- en: '![](img/dad0756c-36fb-4fa6-a3b8-8ff192f9070b.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dad0756c-36fb-4fa6-a3b8-8ff192f9070b.png)'
- en: Creating an Azure VM
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 Azure 虚拟机
- en: 'A new blade opens up where you can fill in the basic settings of the VM. Add
    the following details and click on OK:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个新的面板打开，您可以填写虚拟机的基本设置。添加以下详细信息，然后点击**确定**：
- en: '![](img/ba6d94ca-70c1-4a46-86aa-ede9764a2205.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ba6d94ca-70c1-4a46-86aa-ede9764a2205.png)'
- en: Filling in the basic settings
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 填写基本设置
- en: 'A new blade will open where you can choose the VM type and size. By default,
    only the recommended VMs are displayed, but you can choose to display all VMs
    by clicking on View all and then clicking on Select, as shown in the following
    screenshot:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 会打开一个新窗口，在这里你可以选择虚拟机类型和大小。默认情况下，只显示推荐的虚拟机，但你可以通过点击“查看所有”并选择“选择”来显示所有虚拟机，如以下截图所示：
- en: '![](img/5489c2ec-632c-4d8f-ab90-51f26b92405c.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5489c2ec-632c-4d8f-ab90-51f26b92405c.png)'
- en: Choosing your VM size
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 选择虚拟机大小
- en: 'A new blade opens up where you can configure additional options. Here, select Availability
    set and then click Create new:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 会打开一个新窗口，在这里你可以配置其他选项。选择“可用性集”，然后点击“创建新建”：
- en: '![](img/20d4ca89-282e-4ce3-9e72-4b78762ececc.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/20d4ca89-282e-4ce3-9e72-4b78762ececc.jpg)'
- en: Creating a high Availability Set
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 创建高可用性集
- en: By default, your VMs are assigned two fault domains and five update domains.
    Accept the default settings here and click on OK twice when prompted.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，虚拟机会被分配两个故障域和五个更新域。接受默认设置，并在提示时点击“确定”两次。
- en: The last blade opens up, which provides a summary with all the settings you've
    entered. Check the permission box.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一个窗口会打开，提供一个摘要，列出你输入的所有设置。勾选权限框。
- en: Click on Create andyour VM is now created. Next to the Createbutton, you should
    see a link where you can download the ARM template of this virtual machine.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建”，你的虚拟机现在已创建。你应该可以在“创建”按钮旁边看到一个链接，点击该链接可以下载此虚拟机的 ARM 模板。
- en: Create the second VM and, instead of creating a new Availability Set, add the
    second VM to the Availability Set that we have already created using the previous
    steps.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建第二个虚拟机，并且不是创建一个新的可用性集，而是将第二个虚拟机添加到我们已经使用前面步骤创建的可用性集中。
- en: You can download the ARM template of the configuration of the VM. This template
    can be used to deploy the second VM as well. There are a lot of templates available
    on GitHub that have been created by Microsoft and the community: [https://azure.microsoft.com/en-us/resources/templates/](https://azure.microsoft.com/en-us/resources/templates/).
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以下载虚拟机配置的 ARM 模板。此模板也可以用于部署第二个虚拟机。GitHub 上有许多由 Microsoft 和社区创建的模板：[https://azure.microsoft.com/en-us/resources/templates/](https://azure.microsoft.com/en-us/resources/templates/)。
- en: Creating highly available virtual machines from PowerShell
  id: totrans-88
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从 PowerShell 创建高可用虚拟机
- en: 'VMs and Availability Sets can be created using PowerShell as well. Besides
    the traditional PowerShell, you can also use the **Azure Cloud Shell** to create
    your Availability Set. By using the Azure Cloud Shell, you are basically using
    PowerShell from inside the browser. Inside the Azure Cloud Shell, Windows users
    can opt for PowerShell and Linux users can opt for Bash. You can open the Azure
    Cloud Shell from the Azure Portal, as shown in the following screenshot:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机和可用性集也可以使用 PowerShell 创建。除了传统的 PowerShell，你还可以使用 **Azure Cloud Shell** 来创建可用性集。通过使用
    Azure Cloud Shell，你实际上是在浏览器内使用 PowerShell。在 Azure Cloud Shell 中，Windows 用户可以选择
    PowerShell，而 Linux 用户可以选择 Bash。你可以从 Azure 门户打开 Azure Cloud Shell，如以下截图所示：
- en: '![](img/8ac6cef6-b643-4a0f-a8f1-69782161b680.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8ac6cef6-b643-4a0f-a8f1-69782161b680.png)'
- en: Azure Cloud Shell
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Cloud Shell
- en: 'To create two VMs and add them to an Availability Set, add the following PowerShell
    statements to Azure Cloud Shell or Windows PowerShell (note that when using the
    Azure Cloud Shell, you don''t have to log in):'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建两个虚拟机并将它们添加到可用性集，请将以下 PowerShell 语句添加到 Azure Cloud Shell 或 Windows PowerShell
    中（请注意，在使用 Azure Cloud Shell 时，无需登录）：
- en: '[PRE0]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If necessary, select the right subscription, shown as follows:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，选择正确的订阅，如下所示：
- en: '[PRE1]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Create a resource group:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 创建资源组：
- en: '[PRE2]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now, create an Availability Set:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，创建一个可用性集：
- en: '[PRE3]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Next, we need to create the two VMs and add them to the Availability Set. This
    is done by setting the `-AvailabilitySetId` parameter to the ID of the Availability
    Set. When running this script, you will be prompted for the username and password
    for your VM, as shown in the following snippet:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要创建两个虚拟机并将它们添加到可用性集中。这是通过将 `-AvailabilitySetId` 参数设置为可用性集的 ID 来完成的。运行此脚本时，系统将提示输入虚拟机的用户名和密码，如以下片段所示：
- en: '[PRE4]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: VM Scale Sets
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机规模集
- en: VM Scale Sets are used for deploying multiple VMs at once without the need for
    manual actions or using scripts. You can then manage them all at once from a single
    place. VM Scale Sets are typically used to build large-scale infrastructures,
    where keeping all of your VMs in sync is key. The maintenance of VMs, including
    keeping them in sync, is handled by Azure.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机规模集用于一次性部署多个虚拟机，无需手动操作或使用脚本。然后，您可以从一个地方管理所有虚拟机。虚拟机规模集通常用于构建大规模基础设施，其中保持所有虚拟机同步是关键。虚拟机的维护，包括同步，它由Azure处理。
- en: VM Scale Sets use Availability Sets under the hood. VMs inside a scale set are
    automatically spread over the fault and update domains by the underlying platform. VM
    Scale Sets use Azure autoscale by default. You can, however, add or remove instances
    yourself instead of using autoscale.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机规模集在后台使用可用性集。规模集内的虚拟机会自动由底层平台分布在故障域和更新域中。虚拟机规模集默认使用Azure自动扩展。然而，您也可以手动添加或删除实例，而不使用自动扩展。
- en: 'When creating a scale set, a couple of artifacts are created for you automatically.
    As well as the number of VMs you have specified being added to the set, an **Azure
    Load Balancer** and **Azure Autoscaling** is added, along with a virtual network
    and a public IP:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建规模集时，系统会自动为您创建一些资源。除了您指定的虚拟机数量会被添加到规模集中外，还会添加**Azure负载均衡器**和**Azure自动扩展**，以及一个虚拟网络和一个公共IP：
- en: '![](img/64933d23-99da-41c1-81a5-67c7047b130a.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](img/64933d23-99da-41c1-81a5-67c7047b130a.png)'
- en: Azure VM Scale Set architecture
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Azure虚拟机规模集架构
- en: Creating a VM Scale Set from the Azure Portal
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从Azure门户创建虚拟机规模集
- en: Navigate to the Azure Portal by opening [https://portal.azure.com/](https://portal.azure.com/).
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开[https://portal.azure.com/](https://portal.azure.com/)访问Azure门户。
- en: Click on New and type in `Scale` in the search bar. Select Virtual machine scale
    set.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“新建”并在搜索框中输入`Scale`。选择虚拟机规模集。
- en: 'In the next screen, click on Create and add the following settings before clicking
    the Create button:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕中，点击“创建”，并在点击“创建”按钮之前添加以下设置：
- en: '![](img/ee555b4a-e64d-4408-b847-2343246cd6fa.jpg)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ee555b4a-e64d-4408-b847-2343246cd6fa.jpg)'
- en: Creating a VM Scale Set
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 创建虚拟机规模集
- en: After creation, you can manage the VM Scale Set from the Azure Portal as well
    as from PowerShell and CLI.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 创建后，您可以通过Azure门户、PowerShell和CLI管理虚拟机规模集。
- en: Accessing your VM Scale Sets
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问您的虚拟机规模集
- en: 'There are a number of ways to access your VM Scale Sets; they are as follows:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种方法可以访问您的虚拟机规模集，具体方法如下：
- en: '**Connect to VM instances using RDP or SSH**: To connect to VM instances using
    RDP or SSH, you can configure a scale set to automatically assign a public IP
    address. This option is turned off by default. The VMs are inside a virtual network,
    making it impossible to connect to them using RDP or SSH.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用RDP或SSH连接虚拟机实例**：要使用RDP或SSH连接虚拟机实例，您可以配置规模集以自动分配公共IP地址。默认情况下，此选项是关闭的。虚拟机位于虚拟网络内，因此无法通过RDP或SSH连接。'
- en: '**Connect to VM instances using a jumpbox**: You can create a standalone VM
    inside the same virtual network to act as a jumpbox to connect to another scale
    set instance in the set. The standalone VM gets a public IP address, which can
    be connected using RDP or SSH. Once connected to the VM, you can use it to connect
    to other instances using the internal IP address.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用跳板机连接虚拟机实例**：您可以在同一个虚拟网络内创建一个独立的虚拟机，作为跳板机连接到规模集中的其他实例。独立虚拟机将获得一个公共IP地址，可以通过RDP或SSH连接。一旦连接到该虚拟机，您可以使用它通过内部IP地址连接到其他实例。'
- en: '**Connect to VM instances using NAT rules**: You can also connect to VM instances
    using NAT rules that are created inside the load balancer. Those NAT rules assign
    the instances to a different RDP port.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用NAT规则连接虚拟机实例**：您还可以使用在负载均衡器内部创建的NAT规则连接虚拟机实例。这些NAT规则将实例分配到不同的RDP端口。'
- en: '**Distribute incoming traffic using load balancing: **Incoming traffic can
    be distributed across VM instances using the round-robin approach. You can use
    the Azure Load Balancer and the Azure Application Gateway for this, where the
    former provides layer-4 load balancing rules, and the latter layer-7 load balancing
    rules.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用负载均衡分配流入流量**：流入的流量可以使用轮询方法分配到虚拟机实例。您可以使用Azure负载均衡器和Azure应用程序网关来实现这一点，前者提供第4层负载均衡规则，后者提供第7层负载均衡规则。'
- en: VM Scale Set templates
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机规模集模板
- en: You can also deploy VM Scale Sets using ARM templates. ARM templates are a great
    way to deploy solutions automatically, and you can even embed customization and
    extensions inside the template. You can, for instance, install an application
    inside a container and deploy it within the VM instances during the deployment
    process of your scale set.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用 ARM 模板部署 VM 扩展集。ARM 模板是自动部署解决方案的好方法，你甚至可以在模板中嵌入定制和扩展。例如，你可以在容器内部安装应用程序，并在扩展集部署过程中将其部署到
    VM 实例中。
- en: 'There are also ARM templates provided by Microsoft and the community that have
    already been configured for different architectures; these can be downloaded and
    deployed to create Azure scale sets, with extensions to manage the scale sets
    included. Some examples of templates are as follows:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 微软和社区还提供了一些已经为不同架构配置好的 ARM 模板，这些模板可以下载并部署，以创建 Azure 扩展集，模板中已包含用于管理扩展集的扩展功能。以下是一些模板示例：
- en: '**Simple deployment of a VM Scale Set of Windows VMs behind a load balancer
    with NAT rules**: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat)'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单部署带有 NAT 规则的负载均衡器后面的 Windows VM 扩展集**： [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat)'
- en: '**Simple deployment of a VM Scale Set of Linux VMs behind a load balancer with
    NAT rules**: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat)'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单部署带有 NAT 规则的负载均衡器后面的 Linux VM 的 VM 扩展集**： [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat)'
- en: '**Simple deployment of a VM Scale Set of Linux VMs with a jumpbox**: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox)'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单部署带有跳板机的 Linux VM 扩展集**： [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox)'
- en: '**Windows VM Scale Set with Application Gateway Integration**: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway)'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Windows VM 扩展集与应用网关集成**： [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway)'
- en: Replication
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 复制
- en: Azure Site Recovery Services offers a business continuity and disaster recovery
    solution from Azure by orchestrating and automating the replication of Azure VMs.
    It can replicate workloads and applications from a primary to a secondary location
    so that your VMs or applications are still up and running during a disaster. You
    can also easily fall back to the primary location when it is up and running again.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 站点恢复服务通过协调和自动化 Azure VM 的复制，提供了一种来自 Azure 的业务连续性和灾难恢复解决方案。它可以将工作负载和应用程序从主位置复制到次级位置，以确保在灾难发生时，VM
    或应用程序依然可以运行。当主位置恢复时，你还可以轻松地恢复到主位置。
- en: 'Azure Site Recovery Services offers the following features and capabilities:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 站点恢复服务提供以下功能和能力：
- en: '**Azure VM, on-premises VM, and workload replication**: You can set up the disaster
    recovery of Azure VMs from a primary region to a secondary region in Azure. You
    can replicate on-premises VMs and physical servers to Azure or to a secondary
    on-premises data center. You can replicate any workload from on-premises Hyper-V
    and VMware VMs, Windows/Linux physical servers, and Azure VMs.'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure VM、本地 VM 和工作负载复制**：你可以将 Azure VM 从主区域复制到 Azure 的次级区域进行灾难恢复。你也可以将本地
    VM 和物理服务器复制到 Azure 或者复制到次级本地数据中心。你可以复制任何来自本地 Hyper-V 和 VMware VM、Windows/Linux
    物理服务器以及 Azure VM 的工作负载。'
- en: '**Data resilience**: No application data is intercepted during replication.
    Data is stored in Azure storage, and during failover the VMs are created using
    data from Azure storage.'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据弹性**：复制过程中没有应用数据被拦截。数据存储在 Azure 存储中，并且在故障转移时，VM 是使用 Azure 存储中的数据创建的。'
- en: '**Customized recovery plans**: You can create customized recovery plans where
    you can group VMs together or add custom scripts or tasks.'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**定制的恢复计划**：你可以创建定制的恢复计划，将 VM 分组在一起，或者添加自定义脚本或任务。'
- en: '**BDCR integration**: You can integrate Azure Recovery Services with other
    BDCR solutions as well.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BDCR 集成**：你还可以将 Azure 恢复服务与其他 BDCR 解决方案集成。'
- en: '**Network integration**: Azure Recovery Services is integrated with networking
    features in Azure. You can reserve IP addresses, configure load balancers, and
    integrate Azure Traffic Manager for network switchovers.'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络集成**：Azure 恢复服务与 Azure 中的网络功能集成。你可以预留 IP 地址、配置负载均衡器，并集成 Azure 流量管理器以实现网络切换。'
- en: '**Consistent apps**: You can keep applications consistent during failovers
    using recovery points with application-consistent snapshots. These snapshots can
    capture disk data, all data in memory, and all transactions in process.'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**一致性应用程序**：你可以在故障恢复过程中通过应用程序一致的快照保持应用程序的一致性。这些快照可以捕捉磁盘数据、内存中的所有数据以及所有正在进行的事务。'
- en: For more information about all the features that Azure Recovery Services provides,
    you can refer to [https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview).
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解 Azure 恢复服务提供的所有功能，您可以参考 [https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview)。
- en: Summary
  id: totrans-138
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we covered the virtual machine objective. We covered the different
    sizes and series that are available from Azure. We also covered Availability Sets,
    fault and update domains, and how to create them. We also covered Managed Disks
    and we showed you how to create highly available VMs. We've talked about VM Scale
    Sets and when to use them, and finally we covered backup and recovery for your
    virtual machines.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了虚拟机的目标。我们讲解了 Azure 提供的不同大小和系列。我们还讨论了可用性集、故障和更新域，以及如何创建它们。我们还讲解了托管磁盘，并向你展示了如何创建高可用性的虚拟机。我们讨论了虚拟机规模集及其使用时机，最后我们讲解了虚拟机的备份与恢复。
- en: The next chapter will cover compute-intensive applications using Azure services
    and Azure Batch.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章将讲解使用 Azure 服务和 Azure 批处理的计算密集型应用程序。
- en: Questions
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Answer the following questions to test your knowledge of the information found
    in this chapter. You can find the answers in the *Assessments* section at the
    end of this book.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 回答以下问题，测试你对本章内容的理解。你可以在本书最后的*评估*部分找到答案。
- en: Are Azure Managed Disks selected by default when creating a new virtual machine?
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建新虚拟机时，Azure 托管磁盘是否默认被选中？
- en: 'Yes'
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-145
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是
- en: If you want your virtual machines to be available when failure occurs in the
    underlying infrastructure, should you use Availability Sets?
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你希望在底层基础设施发生故障时，虚拟机仍然可用，是否应该使用可用性集？
- en: 'Yes'
  id: totrans-147
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-148
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是
- en: Are VMs spread over three fault domains, and four update domains when you add
    them to an Availability Set by default?
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你将虚拟机添加到可用性集中时，虚拟机是否默认分布在三个故障域和四个更新域中？
- en: 'Yes'
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是的
- en: 'No'
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不是
- en: Further reading
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'You can check the following links for more information about the topics covered
    in this chapter:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查看以下链接，获取更多关于本章所涉及主题的信息：
- en: '**Managing the availability of Windows virtual machines in Azure**: [https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability)'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理 Azure 中 Windows 虚拟机的可用性**：[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability)'
- en: '**Example Azure infrastructure walkthrough for Windows VMs**: [https://docs.microsoft.com/en-us/azure/virtual-machines/windows/infrastructure-example](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/infrastructure-example)'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Windows 虚拟机的示例 Azure 基础架构操作**：[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/infrastructure-example](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/infrastructure-example)'
- en: '**Planned maintenance for virtual machines in Azure**: [https://docs.microsoft.com/en-us/azure/virtual-machines/windows/maintenance-and-updates](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/maintenance-and-updates)'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 中虚拟机的计划维护**：[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/maintenance-and-updates](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/maintenance-and-updates)'
- en: '**Virtual Machine Scale Sets Documentation**:[ https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/](https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/)'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟机规模集文档**：[https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/](https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/)'
- en: '**Using a custom Docker image for Web App for Containers**: [https://docs.microsoft.com/en-us/azure/app-service/containers/tutorial-custom-docker-image](https://docs.microsoft.com/en-us/azure/app-service/containers/tutorial-custom-docker-image)'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用自定义 Docker 镜像为容器 Web 应用服务提供支持**: [https://docs.microsoft.com/en-us/azure/app-service/containers/tutorial-custom-docker-image](https://docs.microsoft.com/en-us/azure/app-service/containers/tutorial-custom-docker-image)'
- en: '**Overview of the features in Azure Backup**: [https://docs.microsoft.com/en-us/azure/backup/backup-introduction-to-azure-backup](https://docs.microsoft.com/en-us/azure/backup/backup-introduction-to-azure-backup)'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 备份功能概述**: [https://docs.microsoft.com/en-us/azure/backup/backup-introduction-to-azure-backup](https://docs.microsoft.com/en-us/azure/backup/backup-introduction-to-azure-backup)'
- en: '**Backing up Azure virtual machines to a Recovery Services Vault**: [https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms](https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms)'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**将 Azure 虚拟机备份到恢复服务保管库**: [https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms](https://docs.microsoft.com/en-us/azure/backup/backup-azure-arm-vms)'
- en: '**Planing your VM backup infrastructure in Azure**: [https://docs.microsoft.com/en-us/azure/backup/backup-azure-vms-introduction](https://docs.microsoft.com/en-us/azure/backup/backup-azure-vms-introduction)'
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**在 Azure 中规划虚拟机备份基础架构**: [https://docs.microsoft.com/en-us/azure/backup/backup-azure-vms-introduction](https://docs.microsoft.com/en-us/azure/backup/backup-azure-vms-introduction)'
- en: '**Site recovery**: [https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview)'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**站点恢复**: [https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-overview)'
