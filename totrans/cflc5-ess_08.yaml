- en: Chapter 8. Advanced Confluence
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: So far we have been using Confluence out of the box, making use of all the features,
    templates, and macros that are bundled with the installation. Confluence also
    comes with the possibility to add your own features, templates, and macros to
    the product. This way you can tailor your Confluence installation to your company's
    needs.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we will learn about the more advanced features in Confluence,
    such as how to create and apply templates to give your content more structure.
    We will also take a look at creating our own macros, which can be used while creating
    content.
  prefs: []
  type: TYPE_NORMAL
- en: 'By the end of the chapter, you will have learned about:'
  prefs: []
  type: TYPE_NORMAL
- en: Creating and managing content templates
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing user macros
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the page properties macro
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating shortcut links
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Templates
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We have been adding a lot of pages by now and every time we started from scratch;
    but we don't have to. When you find yourself creating the same page structure
    over again, or you want your users to use the same structure for reasons of consistency,
    templates are the answer.
  prefs: []
  type: TYPE_NORMAL
- en: Templates are predefined pages that can be used as a scaffold when you are creating
    pages. Only new pages can be created from a template, and when a template is used
    the new page will contain the same content as the template. Templates are very
    useful when you want a uniform style or format for your pages.
  prefs: []
  type: TYPE_NORMAL
- en: Using templates
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'When there are templates available, you can start using them to create new
    pages. When you create a page based on a template, Confluence will copy the following
    content and information to the new page:'
  prefs: []
  type: TYPE_NORMAL
- en: Labels
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Text and styles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Layouts and other formatting
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Macros
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Displayed media such as images or videos
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The newly created page is not connected in any way to the original template;
    changes made to the template will not reflect on the created page. It is not possible
    to apply a template to an existing page; templates can only be used when creating
    a new page. The newly created page can be edited in any way a blank page can;
    content can be added, updated, and removed.
  prefs: []
  type: TYPE_NORMAL
- en: 'To create a page based on a template, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Click on **Create** in the header.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select a space to create the new page in.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose a template from the available templates.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If the template contains variables, you will see a form. Type the relevant information
    into the fields and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will see a new page based upon the template.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Give the page a title and add, update, or delete the content.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The following screenshot displays the available templates that can be used
    to create a new page:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using templates](img/9526EN_08_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Creating templates
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In Confluence, templates can be created on two levels of the Confluence hierarchy:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Space templates**: These templates are only available in the space you created
    them in. Space Administrators can define space templates via the space admin screen.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Global templates**: These templates are available in every space in Confluence.
    Confluence Administrators can define global templates via the Administration Console.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Space templates
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Space templates can be created by Space Administrators and are only available
    in the space you create them in.
  prefs: []
  type: TYPE_NORMAL
- en: 'To add a template for a space, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Go to any page in the space.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Space Tools** from the sidebar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Content Tools**, followed by **Templates** from the space admin menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Create new Template** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If your space uses the documentation theme:'
  prefs: []
  type: TYPE_NORMAL
- en: Select **Browse** | **Space Admin**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Templates** from the left-hand navigation.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Create new Template** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be redirected to the **Create Template** screen. How you can add content
    and create your template is explained in the *Adding content to your template*
    section.
  prefs: []
  type: TYPE_NORMAL
- en: Global templates
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Global templates can be created by Confluence Administrators and are available
    in all spaces within Confluence.
  prefs: []
  type: TYPE_NORMAL
- en: 'To add a global template, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose **Global Templates** in the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Add New Global Template** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be redirected to the **Create Template** screen. How you can add content
    and create your template is explained in the *Adding content to your template*
    section.
  prefs: []
  type: TYPE_NORMAL
- en: Adding content to your template
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The **Create Template** view is very similar to the regular editor in Confluence:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding content to your template](img/9526EN_08_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: What normally is the page title will now be the template name. The template
    name will be displayed when you create a new page, so choose a descriptive name
    for your template.
  prefs: []
  type: TYPE_NORMAL
- en: The content of the template is just like a regular page; you can use styles,
    layouts, and other formatting. You can also add links and macros. In addition
    to the normal features, the template editor also allows you to add variables and
    instruction texts. Using variables in your template will create a form for collection
    of data when someone adds a page based on the template.
  prefs: []
  type: TYPE_NORMAL
- en: 'Some points to take into account when creating a template are:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Labels**: Select **Labels** from the bottom-left to add labels to the template.
    These labels will be included in all the pages created using this template.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Images and other attachments**: It is not possible to add any file or image
    to a template. If you want to use an image or attachment in your template, you
    need to attach this file to another page in Confluence.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Then insert the image by performing the following steps:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Select **Insert** | **Image**.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Use the media browser to find your image.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Insert** to insert your image.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Instructional text**: Instructional text allows you to add placeholder content
    to a template. This placeholder is only visible in the editor and disappears when
    the author of the page begins typing in that placeholder.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: These texts can provide instructions for users on how to use the template and
    which data is expected at certain locations.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'To insert an instructional text, perform the following steps:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Place your cursor on the template where you want the instructional text to appear.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Template** on the editor toolbar.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Instructional Text**.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Start typing; the instructional text appears in italics with a shaded background
    to distinguish it from the normal paragraph text.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: The type of the placeholder can be changed from "text" to a "user mention",
    which starts the mention's autocomplete when the author starts typing. To change
    the placeholder type, click on the placeholder and select **User Mention**.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Variables**: With variables you can introduce data entry to your template,
    making sure not only the layout is organized but the content as well. Variables
    added to a template act as form fields. When somebody creates a page based on
    your template, Confluence will display an entry box for each variable as shown
    in the following screenshot. Users can enter data into each field and the data
    is then inserted onto the new page:![Adding content to your template](img/9526EN_08_02.jpg)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Each variable must have a unique name. If you add the same variable more than
    once in the same template, Confluence will provide both placeholders with the
    same value. This is useful when you need the same information in more than one
    position.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'To insert a variable into a template, perform the following steps:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Place your cursor at the location you want to insert a variable
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Template** from the editor toolbar.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Select an existing variable or click on **New Variable**.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the variable name.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Press *Enter*. This will create a single-line text input field.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: To change the variable type, click on the placeholder. The property panel will
    appear where you can choose different types. See the next table for a description
    of those types.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Speed up variable entry by using the keyboard shortcut *$* (*Shift* + *4*) for
    autocomplete.
  prefs: []
  type: TYPE_NORMAL
- en: 'These are the types of variables available:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Variable type | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Text | Creates a single-line text input field as shown:![Adding content to
    your template](img/9526EN_08_03.jpg) |'
  prefs: []
  type: TYPE_TB
- en: '| Multi-line text | Creates a textbox that allows more than one line of text.By
    default, this textbox is of **5** rows with **100** characters wide. You can change
    the size in the property panel:![Adding content to your template](img/9526EN_08_04.jpg)
    |'
  prefs: []
  type: TYPE_TB
- en: '| List | Creates a drop-down list. You must specify the values for the drop-down
    list. These values:'
  prefs: []
  type: TYPE_NORMAL
- en: Must be separated by commas
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Can include any letter, number, spaces, and other special characters except
    a comma, as these are used as separators
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Adding content to your template](img/9526EN_08_05.jpg) |'
  prefs: []
  type: TYPE_NORMAL
- en: Importing templates
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In addition to creating your own templates, you can download predefined templates
    from the Atlassian Marketplace in the form of a template bundle or Blueprints.
    Each bundle contains one or more templates, created by Atlassian or other parties.
  prefs: []
  type: TYPE_NORMAL
- en: 'An example of one of those bundles is available here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://marketplace.atlassian.com/20489](https://marketplace.atlassian.com/20489)'
  prefs: []
  type: TYPE_NORMAL
- en: Downloading and installing add-ons, like template bundles, is described in more
    detail in [Chapter 9](ch09.html "Chapter 9. General Administration"), *General
    Administration*.
  prefs: []
  type: TYPE_NORMAL
- en: Checking installed template bundles
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To check which bundles are available and can be imported, perform the following
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Import Templates** from the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will see a list of template bundles installed and all the templates included
    in each bundle:![Checking installed template bundles](img/9526EN_08_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Display of template bundles available for import
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Making templates available for usage
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you have one or more template bundles installed, you can import them to make
    those templates available for your users.
  prefs: []
  type: TYPE_NORMAL
- en: 'To import a template, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Import Templates** from the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will see a list of template bundles installed and all the templates included
    in each bundle. If you click on the template name, a preview is shown.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the templates you want to import by checking the boxes next to the template
    names.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose the destination for the templates in the **Import To:** dropdown. If
    you want to import the templates to a specific space, select that space; otherwise
    select **Global Templates** to make the templates available for all spaces.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: User Macros
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Throughout the book, we have learned what macros are and how we can use them
    to make our content more engaging and alive. Most macros we have used so far are
    either bundled with Confluence, or part of an add-on we have installed. But there
    is another possibility to add macros: via user macros.'
  prefs: []
  type: TYPE_NORMAL
- en: User macros are short pieces of code that make it easier to perform often-used
    functions or add custom formatting to your page. This could, for example, be a
    preconfigured panel macro with different styling than the defaults. We will create
    this example ourselves later in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: System Administrators can add user macros via the Confluence Administration
    Console.
  prefs: []
  type: TYPE_NORMAL
- en: Managing user macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To manage user macros, you need to have System Administrator permissions. Be
    careful when installing user macros from an unknown source; macros could potentially
    affect the stability and security of your Confluence installation.
  prefs: []
  type: TYPE_NORMAL
- en: 'Perform the following steps for adding a user macro:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **User Macros** from the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Create a User Macro** at the bottom of the list of macros.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the macro details as explained in the *Writing user macros* section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Perform the following steps for editing a user macro:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **User Macros** from the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Edit** next to the relevant macro.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Change the macro details as explained in the *Writing user macros* section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Perform the following steps for removing a user macro:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **User Macros** from the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Remove** next to the relevant macro.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you remove a user macro that is being used on a Confluence page, you will
    need to remove the macro from the page manually.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can use the Confluence search to find pages that are using a user macro.
    More information on searching for macros can be found in the *Searching labels*
    section in [Chapter 4](ch04.html "Chapter 4. Managing Content"), *Managing Content*.
  prefs: []
  type: TYPE_NORMAL
- en: Writing user macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Writing a user macro is done via a form in the Administration Console. We''ll
    go over the input fields to help you create your first user macro:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Writing user macros](img/9526EN_08_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Input form for creating a new user macro
  prefs: []
  type: TYPE_NORMAL
- en: '**Macro Name**: This is the name of the macro and can only contain letters,
    numbers, and hyphens (-); for example: teaser-panel.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Visibility**: Here you can set the visibility in the macro browser; this
    can be all users or only system administrators. Hiding the macro for all users
    will still allow them to use the macro, but it avoids cluttering the Macro Browser
    and autocomplete.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Choosing **Visible only to system administrators in the Macro Browser** means
    that:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Only system administrators will see this macro in the Macro Browser or autocomplete.
    For other users, the macro will not show up, even while searching the macro.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The macro output will be visible to all users who have permissions to see the
    page.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Any user with edit permissions will see the macro on the page if it is already
    on it. Your users are also allowed to edit or remove the macro.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Macro Title**: The macro title is the name that will appear in the Macro
    Browser and autocomplete. Choose a descriptive title to make it easier for your
    users to find the macro.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Description**: The description text shows next to the macro in the Macro
    Browser. The search in the Macro Browser will also use the description text to
    search in.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Categories**: Select one or more categories to place your user macro in.
    These categories relate to the categories a user sees in the Macro Browser. To
    select multiple categories, hold down the *Ctrl* key while selecting.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Icon URL**: The Macro Browser can display an icon for your macro if you provide
    a URL. This can either be an absolute URL, or a path relative to the Confluence''s
    base URL; for example: `http://example.com/images/no-print-icon.png` or `/images/icons/macrobrowser/no-print-icon.png`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Documentation URL**: If you have online documentation, enter the URL of this
    documentation here. The link will appear in the macro properties dialog. In some
    cases, a Confluence page documenting your user macro is very useful for your users.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Macro Body Processing**: You can specify that your macro can have a body,
    allowing your users to enter content in your macro. An example of a macro with
    a body is the panel macro.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If your macro has a body, this body will be available in your macro template
    with the `$body` variable. The content of your body depends on how the processing
    is done.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '| Processing option | Description |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| --- | --- |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **No macro body** | Select this option if your macro doesn''t need a body.
    |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Escaped** | If your macro has a body and you make use of the body in your
    template, Confluence will escape any HTML in the body.So, if the body is: `<b>Example
    HTML</b>`Then the value of $body is: `&lt;b&gt;ExampleHTML&lt;/b&gt;`This will
    be rendered as: `<b>Example HTML</b>` |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Unrendered** | Use this option if you want the `$body` variable to be exactly
    like the user entered it. You should process the body within the template to make
    sure HTML is outputted by the template. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Rendered** | The body will be rendered, so most HTML will be passed to
    the template unmodified; but Confluencespecific markup, such as macro definitions,
    will be processed and rendered.So, if the body is: `<b>Example HTML</b>`Then the
    value of `$body`: is `<b>Example HTML</b>`This will be rendered as: **Example
    HTML** |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '**Template**: This is where the magic happens: the macro template. Here you
    should write the code that specifies what your macro will do. We will go into
    detail on how to write a user macro template soon, but here is a quick guide up
    front:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use HTML and Confluence-specific XML elements in your macro template. Use the
    Storage Format tool to find the specific XML.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: It is possible to use Apache Velocity in the template.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: If your macro has a body, the content is available in the `$body` variable.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Each parameter for your macro should have matching metadata definitions. Use
    `@param` to define that metadata.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Use `@noparams` if your macro does not access any parameters.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Apache Velocity is a template engine that provides a template language to reference
    objects defined in the backend of Confluence. Velocity is the main template engine
    in Confluence and is used for displaying almost every page. Velocity can be used
    in your macro to add some logic (if-else) or to get information from the backend,
    that is, the current page title and other page properties.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Writing a user macro template
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A user macro template is a piece of code that specifies what your macro does.
    It is written in a combination of HTML, XML, and Velocity. We will build a user
    macro together to give you some insight into what the possibilities are.
  prefs: []
  type: TYPE_NORMAL
- en: I assume you have filled in the other text fields of the macro based on the
    previous paragraph. Make sure that the **Macro Body Processing** option is set
    to **Rendered**.
  prefs: []
  type: TYPE_NORMAL
- en: A descriptive header
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is a good practice to have a descriptive header at the top of every template.
    The header tells what the macro does and what kind of parameters it expects.
  prefs: []
  type: TYPE_NORMAL
- en: 'Our header would look something like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Parameters
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is possible to use parameters in your user macro, so that users can pass
    extra information for you to render. If you define your parameters, Confluence
    will display the corresponding fields in the **Macro properties** dialog and browser.
  prefs: []
  type: TYPE_NORMAL
- en: 'A parameter definition in the template consists of three parts:'
  prefs: []
  type: TYPE_NORMAL
- en: '`@param` – to let Confluence know we are defining a parameter'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Name – to access the parameter's value in your template
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Extra attributes – to further describe your parameter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Parameters are generally defined at the top of the template, just below the
    header. The order in which you specify the parameters is also the order in which
    they are displayed in the parameter section (the right-hand side) in the Macro
    Browser.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'As you may have noticed, there are quite a few extra attributes you can use
    to describe your parameter. The more you specify, the better Confluence can help
    your users with the Macro Browser and properties editor. Let''s go over the available
    attributes:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Attribute name | Description | Required? |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| [unnamed first attribute] | The parameter name is the first attribute, and
    doesn''t require a name.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Will define the parameter `example`. | Required |
  prefs: []
  type: TYPE_NORMAL
- en: '| `title` | The parameter title that will appear in the Macro Browser. If no
    title is specified, the parameter name is used. | Recommended |'
  prefs: []
  type: TYPE_TB
- en: '| `type` | The field type of the parameters. Learn about types in the next
    pages. | Recommended |'
  prefs: []
  type: TYPE_TB
- en: '| `desc` | The description of the parameter shown in the Macro Browser. | Optional
    |'
  prefs: []
  type: TYPE_TB
- en: '| required | Specify if the parameter is required; default is **false**. |
    Optional |'
  prefs: []
  type: TYPE_TB
- en: '| multiple | Specify if the parameters allows multiple values; default is **false**.
    | Optional |'
  prefs: []
  type: TYPE_TB
- en: '| default | The default value of the parameter. | Optional |'
  prefs: []
  type: TYPE_TB
- en: If you don't specify the type of the parameter, it will default to a string.
    But there are many more types available from which you can choose. Confluence
    will render the input field of your parameter based on the type you specify.
  prefs: []
  type: TYPE_NORMAL
- en: '| Type | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `boolean` | Displays a checkbox to the user and passes the value **true**
    or **false** to the macro as a string.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `enum` | Offers a list of values for selection. You can specify the values
    to appear in the dropdown yourself. The variable will be passed on the to macro
    as it is, including capitalization.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `string` | Shows a text field; this is the default if no other type is specified.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `confluence-content` | Shows a quick search where the user can search for
    a page or blog post in Confluence.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `username` | Shows a quick search for users.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `spacekey` | Shows a list of spaces for selection; the space key is passed
    on to the macro.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `date` | Currently threated as a normal string. Users can type a date in
    any format; be sure to check the date in your template.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `int` | Type is accepted, but currently treated as a normal string.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '| `percentage` | Type is accepted, but currently treated as a normal string.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: The parameters are available in your template as, for example, `$paramtitle`
    and `$paramcolor` for parameters called title and color respectively.
  prefs: []
  type: TYPE_NORMAL
- en: 'Normally, if a parameter like `$paramtitle` is missing, it will appear as `$paramtitle`
    in the output. To output nothing when a parameter is not set, use an exclamation
    mark after the dollar sign: `$!paramtitle`.'
  prefs: []
  type: TYPE_NORMAL
- en: 'When your macro doesn''t have any parameters, you should use `@noparams` in
    your template. This will let Confluence know that it doesn''t need to display
    a parameter input field. If your macro doesn''t contain parameters and does not
    specify `@noparams`, the macro browser will display a free-format textbox allowing
    users to enter undefined parameters. You should use `@noparams` in your template
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Template code
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that we have a good descriptive header and parameter declarations for our
    macro, it is time to write to the macro template code.
  prefs: []
  type: TYPE_NORMAL
- en: 'When writing your macro, the following objects are available to you to use:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Variable | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `$body` | The body of the macro, if your macro has one. |'
  prefs: []
  type: TYPE_TB
- en: '| `$param<name>` | Named parameters as described in your macro template. |'
  prefs: []
  type: TYPE_TB
- en: '| `$renderContext` | The `PageContext` object, useful for (among other things)
    checking `$renderContext.baseUrl` or `$renderContext.spaceKey`. More information
    on the `PageContext` object is located at [http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/renderer/PageContext.html](http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/renderer/PageContext.html).
    |'
  prefs: []
  type: TYPE_TB
- en: '| `$space` | The space object where this page or blog post is located. This
    object can be used to retrieve information as the space name, description, and
    URL. More information is available at [http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/spaces/Space.html](http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/spaces/Space.html).
    |'
  prefs: []
  type: TYPE_TB
- en: '| `$content` | The current `ContentEntity` object in which this macro is included.
    This can for example be used to retrieve attachments, labels, or comments. More
    information is available at [http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/core/ContentEntityObject.html](http://docs.atlassian.com/atlassian-confluence/latest/com/atlassian/confluence/core/ContentEntityObject.html).
    |'
  prefs: []
  type: TYPE_TB
- en: Using these objects it is possible to get access to certain extra information
    that is otherwise not available on a Confluence page; this makes user macros really
    powerful.
  prefs: []
  type: TYPE_NORMAL
- en: Including another macro
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: For our user macro we want to include a predefined version of the panel macro,
    bundled with Confluence. This means we need to find out what the Confluence-specific
    XML is that defines the panel.
  prefs: []
  type: TYPE_NORMAL
- en: 'The easiest way to do this is consulting the Storage Format tool. To get the
    storage format for the panel macro:'
  prefs: []
  type: TYPE_NORMAL
- en: Create and save a new page containing the panel macro, including all the parameters
    we want to have predefined.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Tools** | **View Storage format**. This option is only available for
    Confluence Administrators, and shows the XML source for the page, exactly what
    we need.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A Confluence macro starts with `<ac:macroac:name…`.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: A macro parameter starts with `<ac parameter ac:name…`.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'For our panel, the XML we want to use in our template looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: As you might have noticed, I have already included the `title` parameter and
    `@body` in the XML. I did this by using the value in the `panel` attribute I created
    on the page, so that I know I put the variables on the right spot.
  prefs: []
  type: TYPE_NORMAL
- en: If we put all the pieces of code together, we have our own teaser macro.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: If you want to read more about writing user macros, take a look at some online
    examples at [https://confluence.atlassian.com/x/V4lYDQ](https://confluence.atlassian.com/x/V4lYDQ).
  prefs: []
  type: TYPE_NORMAL
- en: 'The end result of our user macro looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Including another macro](img/9526EN_08_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The Page Properties macro
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There is one macro I want to emphasize a bit more. The **Page Properties macro**,
    also known as the **metadata details macro**, is a little beauty.
  prefs: []
  type: TYPE_NORMAL
- en: The Page Properties macro enables you to embed data on a page and then display
    that information in a tabular form on another page. The Page Properties macro
    can be placed upon as many pages as you like, and you can use the Page Properties
    Report macro to display all the data.
  prefs: []
  type: TYPE_NORMAL
- en: An example, which we will implement, is customer contact information where every
    customer has a page with contact details, using the Page Properties macro. Then
    on an overview page, we will display all the customers contact information in
    a table.
  prefs: []
  type: TYPE_NORMAL
- en: 'To create customer details pages, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a `Sales & Marketing` space for this exercise, or use a test/sandbox
    space if you have one available.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the new space, create a page called `Customers Overview`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the body, add the macro Page Properties Report.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: In the macro properties, use the label `customer-contact-details`.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save** to save the page.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a new page as the child of the Customers Overview page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use your customer name as title.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert the Page Properties macro.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: In the body of the macro, create a table with two columns and four rows.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter some contact details in the table:'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Name** – `Ford Prefect`.'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Position** – `Managing Directory`.'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Email** – `ford.prefect@example.com`.'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Phone** – `317-822-2752`.'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: Give the page a label `customer-contact-details`.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Save** to save the page.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Repeat this step for a couple of customers. (This is a great example on where
    to use a template.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'So now we have a couple of pages with customer information, looking similar
    to the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Page Properties macro](img/9526EN_08_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If we now browse back to our **Customer Overview** page we created earlier,
    we should see a table with our customers. As with all tables in Confluence, you
    can sort the table by the columns.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The columns are ordered alphabetically and not as you specified in the Page
    Properties macro. If you want to reorder the columns, adding a number to them
    is a good trick.
  prefs: []
  type: TYPE_NORMAL
- en: '![The Page Properties macro](img/9526EN_08_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The table generated by the Page Properties Report macro can also be used as
    input for other macros like the Charting macro.
  prefs: []
  type: TYPE_NORMAL
- en: Shortcut links
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Shortcut links provide a quick way of linking to resources that you use often,
    for example, a link to a Google search. Shortcut links need to be configured by
    a Confluence Administrator before users can use them.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a shortcut link
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you search for a book on the Packt Publishing website, the URL will look
    like [http://www.packtpub.com/books?keys=](http://www.packtpub.com/books?keys=).
    If you create a shortcut for this search with the key `packt`, every time a user
    needs to visit the website they can just type `[terms@packt]` and Confluence will
    link to [http://www.packtpub.com/books?keys=terms](http://www.packtpub.com/books?keys=terms).
  prefs: []
  type: TYPE_NORMAL
- en: Browse to the Administration Console (**Administration** | **Confluence Admin**).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Shortcut Link** from the left-hand side menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter a key for you shortcut value. In our case, we will use `packt`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Enter the **Expanded Value**: `http://www.packtpub.com/books?keys=`. You can
    use `%s` in the URL to specify where the term needs to be inserted. If there is
    no `%s` in the URL, the term is put at the end.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter a **Default Alias**. This is the text of the link that will be displayed
    in Confluence. `%s` can also be used within the text. If no value is entered,
    Confluence will use `term@key` as the link text.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Submit**.![Creating a shortcut link](img/9526EN_08_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Using shortcut links
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your users can use the shortcut links you created earlier just like any other
    link.
  prefs: []
  type: TYPE_NORMAL
- en: Open a page in the edit mode and place your cursor at the location where you
    want to add the link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Link** in the toolbar, or press *Ctrl* + *K*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Advanced** and enter the shortcut link `confluence@packt` into the
    link textbox.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter a link text that will be displayed.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Insert**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can also use the *[* keyboard shortcut and type the link, enclosed with
    `'` `'`; for example `'[confluence@packt]'`.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Users need to be told which shortcuts are available. The best way of doing this
    is to create a separate page listing the shortcuts. Confluence doesn't provide
    a way to list them automatically.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you want to create uniformity or just want to give your users a head start
    creating content, templates are there for you. Templates are preformatted pages
    that can be used when you add a new page. We have learned how to create those
    templates and that templates can be added on a space or global level.
  prefs: []
  type: TYPE_NORMAL
- en: Another mechanism to automate things you find yourself doing often is user macros.
    User macros allow you to code some functionality or formatting, which your users
    can reuse. User macros can easily be added via the Confluence user interface,
    but they do require a bit of knowledge about HTML and XML. With the example in
    this chapter, you should have a solid base to start building your own macros.
  prefs: []
  type: TYPE_NORMAL
- en: That macros can be really powerful is demonstrated by the Page Properties macro
    that you can use to get metadata from pages and show this in an overview table.
  prefs: []
  type: TYPE_NORMAL
- en: There are many add-ons available that add templates, macros, and other functionalities
    to Confluence. These add-ons can be installed via the Atlassian Marketplace, which
    we will learn about in the next chapter.
  prefs: []
  type: TYPE_NORMAL
