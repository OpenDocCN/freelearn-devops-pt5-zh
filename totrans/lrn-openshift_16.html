<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Building a Multi-Tier Application from Source Code</h1>
                
            
            <article>
                
<p class="calibre2">In the previous chapter, we learned what build entities are—created by <span class="calibre11">OpenShift—and </span><span class="calibre11">how to deploy a simple PHP application from source code. We showed you </span><span class="calibre11">how to start a new build and h</span>ow to customize a build process.</p>
<p class="calibre2">In this chapter, you are going to build and deploy a WordPress application from a custom template. You are also going to work with<span class="calibre11"> OpenShift templates, learn how to create and deploy OpenShift templates, and </span>deploy applications from OpenShift templates.</p>
<p class="calibre2"><span class="calibre11">We are going to cover the topic that is b</span>uilding a multi-tier application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Technical requirements</h1>
                
            
            <article>
                
<p class="calibre2">This chapter relies on a working installation of OpenShift. We assume that OpenShift master's address is<span class="calibre11"> </span><kbd class="calibre12">openshift.example.com</kbd><span class="calibre11"> </span>and the default subdomain is<span class="calibre11"> </span><kbd class="calibre12">example.com</kbd>.</p>
<p class="calibre2">Some of the lab items require a custom DNS record, which can be simulated by setting a record in<span class="calibre11"> </span><kbd class="calibre12">/etc/hosts</kbd>. Both methods are acceptable.</p>
<p class="calibre2">You will be required to run minishift in this Chapter, to avoid certain errors and reconfiguration you might be required to do with other openshift deployment methods.</p>
<pre class="calibre18"><strong class="calibre1">$ minishift start --openshift-version=v3.9.0 --vm-driver=virtualbox --memory 4GB<br class="title-page-name"/><br class="title-page-name"/></strong>...<br class="title-page-name"/>output truncated for brevity<br class="title-page-name"/>...<br class="title-page-name"/>-- Minishift VM will be configured with ...<br class="title-page-name"/>   Memory: 4 GB<br class="title-page-name"/>   vCPUs : 2<br class="title-page-name"/>   Disk size: 20 GB<br class="title-page-name"/>...<br class="title-page-name"/>output truncated for brevity<br class="title-page-name"/>...<br class="title-page-name"/>OpenShift server started.<br class="title-page-name"/><br class="title-page-name"/>The server is accessible via web console at:<br class="title-page-name"/>    https://192.168.99.110:8443<br class="title-page-name"/><br class="title-page-name"/>You are logged in as:<br class="title-page-name"/>    User: developer<br class="title-page-name"/>    Password: &lt;any value&gt;<br class="title-page-name"/><br class="title-page-name"/>To login as administrator:<br class="title-page-name"/>    oc login -u system:admin<strong class="calibre1"><br class="title-page-name"/></strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Building a multi-tier application</h1>
                
            
            <article>
                
<p class="calibre2">We explained to you previously how to use templates to deploy simple and multi-tier applications. This allows for deploying complex applications by creating deployment configs and deploying a number of pods, services, and routes. This approach is limited since most of the multi-tier applications need to be built from source code. OpenShift templates allow building applications from source code. The combination of building an application from source code and using templates to deploy and build a multi-tier application is described in this chapter. This is a hands-on chapter that gives you real examples of leveraging OpenShift templates to deploy applications in a production environment. Now it is time to see how to build a WordPress application from source code using MariaDB as a database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">WordPress template</h1>
                
            
            <article>
                
<p class="calibre2"><span class="calibre11">WordPress i</span><span class="calibre11">s a </span><span class="calibre11">free and open-source</span><span class="calibre11"> <strong class="calibre4">C</strong></span><strong class="calibre4"><span class="calibre11">ontent Management System</span></strong><span class="calibre11"> (<strong class="calibre4">CMS</strong>) based on </span><span class="calibre11">PHP</span><span class="calibre11"> and </span><span class="calibre11">MySQL. We want to demonstrate the <strong class="calibre4">Source-to-Image</strong> (<strong class="calibre4">S2I</strong>) build process for WordPress using templates prepared at <a href="https://github.com/openshift-evangelists/wordpress-quickstart" class="calibre8">https://github.com/openshift-evangelists/wordpress-quickstart</a>. This repository contains ready-to-use templates for deploying WordPress on an OpenShift cluster. There are two example templates available in the repository. Let's clone the repository first:</span></p>
<pre class="calibre18"><strong class="calibre1">$ git clone https://github.com/openshift-evangelists/wordpress-quickstart.git</strong><br class="title-page-name"/>Cloning into 'wordpress-quickstart'...<br class="title-page-name"/>remote: Counting objects: 331, done.<br class="title-page-name"/>remote: Total 331 (delta 0), reused 0 (delta 0), pack-reused 331<br class="title-page-name"/>Receiving objects: 100% (331/331), 1.07 MiB | 1.96 MiB/s, done.<br class="title-page-name"/>Resolving deltas: 100% (119/119), done.</pre>
<p class="calibre2">We are going to apply the <kbd class="calibre12">wordpress-quickstart/templates/classic-standalone.json</kbd> <span class="calibre11">WordPress template</span>. For simplicity, we converted the template from JSON to YAML and removed persistent storage-related entities. We also removed a default value for the <kbd class="calibre12">APPLICATION_NAME</kbd> parameter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Building a WordPress application</h1>
                
            
            <article>
                
<p class="calibre2">First, we want to place the application into a separate namespace:</p>
<pre class="calibre18"><strong class="calibre1">$ oc new-project wp</strong><br class="title-page-name"/>Now using project "wp" on server "https://openshift.example.com:8443".</pre>
<p class="calibre2">First, since it is a new template for us, we want to gather some information regarding available parameters. As was previously described, <kbd class="calibre12">oc process --parameters</kbd> can be helpful:</p>
<pre class="calibre18"><strong class="calibre1">$ oc process --parameters -f  wordpress-quickstart/templates/classic-standalone.json<br class="title-page-name"/></strong><br class="title-page-name"/>NAME DESCRIPTION GENERATOR VALUE<br class="title-page-name"/>APPLICATION_NAME The name of the WordPress instance.<br class="title-page-name"/>QUICKSTART_REPOSITORY_URL The URL of the quickstart Git repository. https://github.com/openshift-evangelists/wordpress-quickstart<br class="title-page-name"/>WORDPRESS_DEPLOYMENT_STRATEGY Type of the deployment strategy for Wordpress. Recreate<br class="title-page-name"/>WORDPRESS_MEMORY_LIMIT Amount of memory available to WordPress. 512Mi<br class="title-page-name"/>DATABASE_MEMORY_LIMIT Amount of memory available to the database. 512Mi<br class="title-page-name"/>DATABASE_USERNAME The name of the database user. expression user[a-f0-9]{8}<br class="title-page-name"/>DATABASE_PASSWORD The password for the database user. expression [a-zA-Z0-9]{12}<br class="title-page-name"/>MYSQL_VERSION The version of the MySQL database. 5.7<br class="title-page-name"/>PHP_VERSION The version of the PHP builder. 7.0</pre>
<p class="calibre2">Notice that only <kbd class="calibre12">APPLICATION_NAME</kbd> doesn't have a default value.</p>
<p class="calibre2">Let's build the application from source code by instantiating that template with its <kbd class="calibre12">APPLICATION_NAME=wordpress</kbd>:</p>
<pre class="calibre18"><strong class="calibre1">$ oc new-app -f wordpress-quickstart/templates/classic-standalone.json -p APPLICATION_NAME=wordpress</strong><br class="title-page-name"/>--&gt; Deploying template "wp/wordpress-classic-standalone" for "wordpress.yaml" to project wp<br class="title-page-name"/><strong class="calibre1">...</strong><br class="title-page-name"/><strong class="calibre1">&lt;output omitted&gt;</strong><br class="title-page-name"/><strong class="calibre1">...</strong><br class="title-page-name"/>--&gt; Success<br class="title-page-name"/>    Build scheduled, use 'oc logs -f bc/wordpress' to track its progress.<br class="title-page-name"/>    Access your application via route 'wordpress-wp.apps.kropachev.pro'<br class="title-page-name"/>    Run 'oc status' to view your app.</pre>
<p class="calibre2">You may want to check the build logs for wordpress application:</p>
<pre class="calibre18"><strong class="calibre1">$ oc logs bc/wordpress -f</strong><br class="title-page-name"/>Cloning "https://github.com/openshift-evangelists/wordpress-quickstart" ...<br class="title-page-name"/>  Commit: 0f5076fbb3c898b77b820571fa30d1293c3ac33b (Update README with details on how to enable WebDav access.)<br class="title-page-name"/><strong class="calibre1">...</strong><br class="title-page-name"/><strong class="calibre1">&lt;output omitted&gt;</strong><br class="title-page-name"/><strong class="calibre1">...</strong><br class="title-page-name"/>Pushed 9/10 layers, 96% complete<br class="title-page-name"/>Pushed 10/10 layers, 100% complete<br class="title-page-name"/>Push successful</pre>
<p class="calibre2">After some time, all WordPress pods will be up and running, as shown as follows:</p>
<pre class="calibre18"><strong class="calibre1">$ oc get pod</strong><br class="title-page-name"/>NAME READY STATUS RESTARTS AGE<br class="title-page-name"/>wordpress-1-build 0/1 Completed 0 2m<br class="title-page-name"/>wordpress-1-zjfs2 1/1 Running 0 51s<br class="title-page-name"/>wordpress-db-1-9mxgb 1/1 Running 0 2m</pre>
<p class="calibre2">This indicates that our application should work now. Let's see what URL it was exposed through and try to access it via a web browser:</p>
<pre class="calibre18"><strong class="calibre1">$ oc get route</strong><br class="title-page-name"/>NAME HOST/PORT PATH SERVICES PORT TERMINATION WILDCARD<br class="title-page-name"/>wordpress wordpress-wp.127.0.0.1.nip.io wordpress 8080 edge/Allow None</pre>
<p class="calibre2">Once you open your browser and go to <kbd class="calibre12">http://wordpress-wp.127.0.0.1.nip.io/</kbd>, the WordPress application should display a configuration page. Choose you favorite language and press <kbd class="calibre12">continue</kbd> On the next page, just fill in the fields, as shown here, and click on <kbd class="calibre12">Install WordPress</kbd>.</p>
<p class="cdpaligncenter"><img class="alignnone58" src="../images/00068.jpeg"/></p>
<p class="calibre2">The next window displays the installation status:</p>
<p class="cdpaligncenter"><img class="alignnone59" src="../images/00069.jpeg"/></p>
<p class="calibre2">Once you click on the <em class="calibre17"><span class="calibre11">Log In</span></em> button, the following page is displayed:</p>
<p class="cdpaligncenter"><img class="alignnone60" src="../images/00070.jpeg"/></p>
<p class="calibre2">You just need to type in the <span class="calibre11">username</span> and <span class="calibre11">password</span> provided during the setup phase. At this point, you should see the WordPress workspace:</p>
<p class="cdpaligncenter"><img class="alignnone61" src="../images/00071.jpeg"/></p>
<p class="calibre2">This indicates that everything was configured properly.</p>
<p class="calibre2"><span class="calibre11">Use the following code to clean everything up for the next lab:</span></p>
<pre class="calibre18"><strong class="calibre1">$ oc delete all --all<br class="title-page-name"/></strong>deploymentconfig "wordpress" deleted<br class="title-page-name"/>deploymentconfig "wordpress-db" deleted<br class="title-page-name"/>buildconfig "wordpress" deleted<br class="title-page-name"/>imagestream "wordpress-img" deleted<br class="title-page-name"/>route "wordpress" deleted<br class="title-page-name"/>pod "wordpress-1-tnvhl" deleted<br class="title-page-name"/>pod "wordpress-db-1-pdsbb" deleted<br class="title-page-name"/>service "wordpress" deleted<br class="title-page-name"/>service "wordpress-db" deleted<br class="title-page-name"/><br class="title-page-name"/><strong class="calibre1">$ oc delete project wp</strong><br class="title-page-name"/>project "wp" deleted<br class="title-page-name"/><br class="title-page-name"/><strong class="calibre1">$ oc project myproject</strong><br class="title-page-name"/>Now using project "myproject" on server "https://127.0.0.1:8443".</pre>
<p class="calibre2">You may also delete your minishift VM running <kbd class="calibre12">minishift destroy</kbd> command, if you are done for today. Or just keep minishift up and proceed with the next chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we learned how to build and deploy a WordPress application from a custom template. You learned how to work with<span class="calibre11"> OpenShift templates, how to create and deploy OpenShift templates, and how to </span>deploy applications from OpenShift templates.</p>
<p class="calibre2"><span class="calibre11">The following chapter introduces readers to CI/CD, Jenkins, OpenShift pipelines, and Jenkins integration with OpenShift. We are going to show you how to create sample CI/CD pipelines in OpenShift, edit pipelines, and manage pipeline execution.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Questions</h1>
                
            
            <article>
                
<ol class="calibre13">
<li value="1" class="calibre10">Which of the following OpenShift entities controls the build process (choose one):
<ol class="calibre14">
<li value="1" class="calibre10">buildconfig</li>
<li value="2" class="calibre10">deploymentconfig</li>
<li value="3" class="calibre10">replicationctonroller</li>
<li value="4" class="calibre10">service</li>
<li value="5" class="calibre10">pod</li>
<li value="6" class="calibre10">route</li>
</ol>
</li>
</ol>
<ol start="2" class="calibre13">
<li value="2" class="calibre10">Which of the following OpenShift entities can be created using templates (choose one):
<ol class="calibre14">
<li value="1" class="calibre10">pod</li>
<li value="2" class="calibre10">service</li>
<li value="3" class="calibre10">route</li>
<li value="4" class="calibre10">deployment config</li>
<li value="5" class="calibre10">buildconfig</li>
<li value="6" class="calibre10">All of above<strong class="calibre1"><br class="title-page-name"/></strong></li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    </body></html>