<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;The Emergence of Software-defined Networking"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. The Emergence of Software-defined Networking</h1></div></div></div><p>This chapter will discuss the emergence of open protocols that have helped <span class="strong"><strong>Software-defined Networking</strong></span> (<span class="strong"><strong>SDN</strong></span>) solutions. It will focus specifically on the Nuage VSP SDN solution, which is an SDN platform from Nokia, formerly known as Alcatel-Lucent, which allows users to create a virtual overlay network. We will look at some of the scaling benefits and features Nuage VSP provides over and above the out of the box experience from AWS and OpenStack. It will articulate why these networking solutions have become a necessity for notoriously complex private cloud networks, by simplifying networking using software constructs while aiding automation of the network by providing a set of programmable APIs and SDKs.</p><p>This chapter will focus on the following topics in detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Why SDN solutions are necessary</li><li class="listitem" style="list-style-type: disc">How the Nuage SDN solution works</li><li class="listitem" style="list-style-type: disc">The integration of OpenStack with the Nuage VSP Platform</li><li class="listitem" style="list-style-type: disc">The Nuage VSP Software-defined object model</li><li class="listitem" style="list-style-type: disc">How the Nuage VSP can support Greenfield and Brownfield Projects</li><li class="listitem" style="list-style-type: disc">The Nuage VSP Multicast Support</li></ul></div><div class="section" title="Why SDN solutions are necessary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Why SDN solutions are necessary</h1></div></div></div><p>SDN solutions <a id="id149" class="indexterm"/>are necessary as they allow businesses to simplify their network operations, and it also allows them to automate network functions. It fits well with the DevOps initiative and the need to make network operations more agile.</p><p>A byproduct of SDN is that it allows network functions to become as accurate and repeatable as creating a new virtual machine on a hypervisor.</p><p>SDN solutions from vendors are made up of a centralized controller that is implemented to become the nerve center of the network. SDN controllers rely heavily on <span class="strong"><strong>Open vSwitch database</strong></span> (<span class="strong"><strong>OVSDB</strong></span>), which is a programmable, open standard schema which utilizes the OpenFlow protocol, which integrates directly with switches to route packets in the network as well as applying ACL policies to particular virtual machines, physical servers, or containers.</p><p>As long <a id="id150" class="indexterm"/>as a switch can talk OVSDB and OpenFlow, then it can integrate with common SDN controllers. There are now a wide variety of SDN controllers currently on the market:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CISCO ACI<p>
<a class="ulink" href="http://www.cisco.com/c/en/us/solutions/data-center-virtualization/application-centric-infrastructure/index.html">http://www.cisco.com/c/en/us/solutions/data-center-virtualization/application-centric-infrastructure/index.html</a>
</p></li><li class="listitem" style="list-style-type: disc">Nokia Nuage VSP<p>
<a class="ulink" href="http://www.nuagenetworks.net/products/virtualized-services-platform/">http://www.nuagenetworks.net/products/virtualized-services-platform/</a>
</p></li><li class="listitem" style="list-style-type: disc">Juniper Contrail<p>
<a class="ulink" href="http://www.juniper.net/uk/en/products-services/sdn/contrail/">http://www.juniper.net/uk/en/products-services/sdn/contrail/</a>
</p></li><li class="listitem" style="list-style-type: disc">VMWare NSX<p>
<a class="ulink" href="http://www.vmware.com/products/nsx.html">http://www.vmware.com/products/nsx.html</a>
</p></li><li class="listitem" style="list-style-type: disc">Open Daylight<p>
<a class="ulink" href="https://www.opendaylight.org/">https://www.opendaylight.org/</a>
</p></li><li class="listitem" style="list-style-type: disc">MidoNet Midokura<p>
<a class="ulink" href="http://www.midokura.com/midonet/">http://www.midokura.com/midonet/</a>
</p></li></ul></div><p>SDN controllers <a id="id151" class="indexterm"/>do the following for enterprises:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Provide an easy-to-use solution for network functions, with the SDN controllers abstracting the network functions from hardware devices and instead expose GUIs and API endpoints that can be programmatically altered to control network operations.</li><li class="listitem" style="list-style-type: disc">SDN controllers lend themselves to DevOps models such as self-service network operations for developers, which allow Continuous Delivery of network functions and increased collaboration between teams.</li><li class="listitem" style="list-style-type: disc">Provide increased visibility of network configuration as it is described in easy-to-understand software constructs.</li><li class="listitem" style="list-style-type: disc">Provide better integration with infrastructure through the use of open networking standards, so this gives companies choice over which switch vendors they integrate.</li><li class="listitem" style="list-style-type: disc">Allow the same set of policies in a private datacenter to be applied across private and public clouds. This makes the aim of distributing different workloads into different cloud providers a reality and makes security governance of hybrid clouds much easier for security teams.</li></ul></div><p>The emergence of AWS undoubtedly influenced network vendors to adapt their solutions to be less hardware centric and focus more on a software approach to networking, which, in turn, has simplified network operations and made networking easier to scale.</p><p>Vendors have now adopted and implemented open protocols to allow centralized management of network functions and allowed network operators to manage the whole network using an SDN controller.</p><p>Software-defined networking is being used by businesses to maximize the performance of their <a id="id152" class="indexterm"/>network and create repeatable workflows for network operations in the same way hypervisor virtualization helped infrastructure teams automate server provisioning and management.</p><p>However, based on my personal experience, software-defined networking in the private cloud is being used to run OpenStack at massive scale. The continued uptake on OpenStack projects by many major companies, such as Walmart, Ebay, PayPal, Go Daddy, and my company Paddy Power Betfair, means that companies are turning to SDN solutions to allow them to meet necessary scaling targets and simplifying network operations.</p></div></div>
<div class="section" title="How the Nuage SDN solution works"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>How the Nuage SDN solution works</h1></div></div></div><p>One of <a id="id153" class="indexterm"/>the market-leading SDN solutions is the Nuage SDN (VSP) platform, which is Nokia's SDN solution (formerly Alcatel Lucent), so we will explore how this market-leading SDN solution works.</p><p>The Nuage VSP platform comprises three main components—the VSD, VSC, and VRS.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Virtualized Service Directory</strong></span> (<span class="strong"><strong>VSD</strong></span>): This is the policy engine for the overall <a id="id154" class="indexterm"/>platform, and <a id="id155" class="indexterm"/>it provides a graphical user interface and exposes a restful API for network engineers to use and interact with network functions.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Virtualized Service Controller</strong></span> (<span class="strong"><strong>VSC</strong></span>): This <a id="id156" class="indexterm"/>is the SDN controller for Nuage, and it uses OpenFlow and OVSDB management protocol to distribute <a id="id157" class="indexterm"/>switching and routing information to hypervisors, bare metal servers, or containers.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Virtual Routing and Switching</strong></span> (<span class="strong"><strong>VRS</strong></span>): This <a id="id158" class="indexterm"/>is Nuage's customized version <a id="id159" class="indexterm"/>of Open vSwitch, which is installed on compute nodes (hypervisors).<div class="mediaobject"><img src="graphics/B05559_02_01.jpg" alt="How the Nuage SDN solution works"/></div></li></ul></div><p>The Nuage VSP can integrate with OpenStack, CloudStack, and VMWare private cloud platforms or public cloud solutions such as AWS. Nuage creates an overlay network that has the ability to secure virtual machines, bare metal servers, and containers in an isolated tenant <a id="id160" class="indexterm"/>network, so it is highly flexible depending on what kind of workload needs to be deployed.</p><p>Virtual machines, of course, are deployed as a virtual abstraction on top of physical hypervisors, where containers can run on top of virtual machines or physical servers. Containers are used to isolate particular processes or resources using Linux namespaces and control groups, which divide resources at operating system level, so the networking requirements for virtual machines and containers are very different. Containers are used because they are portable and can run on either virtual machines or bare metal (physical) servers. Another advantage is they are encapsulated by the Linux operating system and multiple containers can run on a virtual machine or physical server.</p><p>Nuage also supports multicast between tenant networks by routing multicast traffic via hypervisors on the underlay network via hypervisors or physical machines and flooding it to specific virtual or physical machines within a tenant network, which has been somewhat of an issue with cloud solutions, but Nuage has a solution to that particular problem.</p><p>The <a id="id161" class="indexterm"/>Nuage VSPs SDN Controller (VSC) integrates with switches using OVSDB via hardware VTEPs exposed by switches at the access or leaf layer of the network. VSCs are deployed redundantly <a id="id162" class="indexterm"/>and communicate with each other with <span class="strong"><strong>Multipath Border Gate Protocol</strong></span> (<span class="strong"><strong>MP-BGP</strong></span>) and program VXLAN encapsulation to the switches as they are hardware VTEP aware.</p><p>The VSD <a id="id163" class="indexterm"/>component is set up in an active cluster containing three VSD servers, which are load balanced using a viable load balancer solution. The load balancer provides a <span class="strong"><strong>Virtual IP</strong></span> (<span class="strong"><strong>VIP</strong></span>), which load balances three VSDs servers in round-robin mode.</p><p>The VSDs VIP exposes the graphical user interface for the Nuage VSP platform and API entry point to programmatically control the overlay network using REST calls. Any operation carried out on the Nuage VSD GUI initiates a REST API call to the VSD, so both the GUI and the REST API are carrying out identical programmatic calls and all operations are exposed via the REST API.</p><p>The Nuage <a id="id164" class="indexterm"/>VSD governs layer 2 and 3 domains, zones, subnets, and ACL policies. The VSD communicates policy information to the VSC using <span class="strong"><strong>Extensible Messaging and Presence Protocol</strong></span> (<span class="strong"><strong>XMPP</strong></span>), and the VSC uses OpenFlow to push down flow information to a customized version of Open vSwitch (VRS) on the compute hosts (hypervisor) to create firewall policy for applications.</p><p>The Nuage <a id="id165" class="indexterm"/>VSP allows bare metal servers to be connected to overlay networks too by pushing down OpenFlow Data to the <span class="strong"><strong>Virtualized Services Gateway</strong></span> (<span class="strong"><strong>VSG</strong></span>) and leaking routing information into the overlay network.</p><p>An overview of the VSP platform protocol integration can be found in the following figure:</p><div class="mediaobject"><img src="graphics/B05559_02_02.jpg" alt="How the Nuage SDN solution works"/></div></div>
<div class="section" title="Integrating OpenStack with the Nuage VSP platform"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Integrating OpenStack with the Nuage VSP platform</h1></div></div></div><p>Private data <a id="id166" class="indexterm"/>center networks can be very complex, so using vanilla OpenStack neutron to meet all use cases may not provide <a id="id167" class="indexterm"/>all the features that are required. It is important to note that the features in neutron are maturing very quickly with every new OpenStack release, so neutron is likely as feature rich as dedicated SDN controllers in the future.</p><p>Neutron lends itself to integration with SDN controllers by providing a REST API extension, so SDN controllers can easily be used to extend the base networking functions provided by neutron if required to provide a very rich set of networking features.</p><p>The use of SDN solutions have helped OpenStack to scale massively, as it moves the networking aspect of OpenStack away from the centralized layer 3 agent and instead requests are moved to the dedicated SDN controllers with distributed firewalling.</p><p>This means that one OpenStack cloud can potentially scale the amount of compute instances that are supported horizontally, without having to worry about bottlenecks or scaling issues associated with the current neutron network architecture.</p><p>OpenStack is one of the most popular private cloud solutions, and the Nuage VSP platform integrates with OpenStack using the Nuage plug-in. The Nuage plugin is installed <a id="id168" class="indexterm"/>on each of the <span class="strong"><strong>Highly Available</strong></span> (<span class="strong"><strong>HA</strong></span>) OpenStack controllers.</p><p>The Neutron ML2 and L3 agents are both switched off on the controllers in favor of the Nuage plugin. The following image shows the architecture for OpenStack neutrons SDN controller <a id="id169" class="indexterm"/>framework with SDN <a id="id170" class="indexterm"/>controllers communicating with OpenStack neutron via REST API calls:</p><div class="mediaobject"><img src="graphics/B05559_02_03.jpg" alt="Integrating OpenStack with the Nuage VSP platform"/></div><p>The VSD, which is the Nuage policy engine, integrates with OpenStack by setting up a net partition that can be used to map one Nuage VSP to an OpenStack cloud and communicates with neutron using REST API calls.</p><p>Multiple instances of OpenStack can be mapped to a single Nuage VSP via the use of net partitions. Net partitions are a way of telling the Nuage VSP platform, which OpenStack instance to map its subnets to and wait for VPort commands to be issued, which signify that the OpenStack nova compute service, has provisioned a virtual machine instance that needs to be governed by Nuage ACL policies.</p><p>When Nuage VSP is integrated with OpenStack, OpenStack vendor installers need to either support Nuage natively or the installer will need to be customized slightly to install the Nuage plugin on OpenStack controllers. The Nuage version of OpenvSwitch (VRS) also needs to be installed on each compute node (hypervisor) that is deployed within an OpenStack cloud.</p><p>The Nuage plugin integrates with the OpenStack Controllers and KVM compute using the following workflow:</p><div class="mediaobject"><img src="graphics/B05559_02_04.jpg" alt="Integrating OpenStack with the Nuage VSP platform"/></div><p>When a <a id="id171" class="indexterm"/>neutron command is issued <a id="id172" class="indexterm"/>to OpenStack, the Nuage plugin uses <span class="strong"><strong>REST API</strong></span> calls to communicate with the <span class="strong"><strong>Nuage</strong></span> <span class="strong"><strong>VSD</strong></span> to say that a new <a id="id173" class="indexterm"/>network has <a id="id174" class="indexterm"/>been created or a new VPort on that network has been <a id="id175" class="indexterm"/>created, this is possible due to neutrons SDN controller pluggable <span class="strong"><strong>REST API</strong></span> architecture.</p><p>The <span class="strong"><strong>Nuage</strong></span> <span class="strong"><strong>VSD</strong></span> policy engine then communicates with the <span class="strong"><strong>VSC</strong></span> to push flow data using XMPP. The <span class="strong"><strong>VSC</strong></span> (SDN Controller) then administers flow data (OpenFlow) to the <span class="strong"><strong>Nuage VRS</strong></span> (Open vSwitch), and the <span class="strong"><strong>Nuage VRS</strong></span> secures OpenStack virtual machines or physical <a id="id176" class="indexterm"/>servers with the predefined firewall policies.</p><p>Firewall policies can either be OpenStack Security Groups or Nuage ACL rules depending if OpenStack managed mode or Nuage VSD managed mode are selected.</p><div class="section" title="Nuage or OpenStack managed networks"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Nuage or OpenStack managed networks</h2></div></div></div><p>The Nuage <a id="id177" class="indexterm"/>OpenStack plugin can be used in <a id="id178" class="indexterm"/>two modes of operation to manage networks that are provisioned in OpenStack:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Nuage VSD-managed mode</li><li class="listitem" style="list-style-type: disc">OpenStack-managed mode</li></ul></div><p>Nuage VSD-managed mode allows Nuage to become the master of network provisioning; this allows Nuage VSP platform to provide a rich feature set to manage networks within an OpenStack environment. Network functions are provisioned directly via the VSD using the Nuage REST API by the GUI or direct API calls and mapped one-to-one with OpenStack subnets.</p><p>The alternative mode of operation is the OpenStack-managed mode, which requires no direct provisioning on VSD. All commands are issued via neutron; however, functionality is limited to the commands that OpenStack neutron supports.</p><p>All networks that are created in Nuage are replicated in OpenStack in a one-to-one mapping with the Nuage VSD being the master in VSD-managed mode, whereas OpenStack neutron is the master of configuration in OpenStack-managed mode.</p><p>In OpenStack-managed mode, all ACL rules are governed by OpenStack Security Groups, whereas in VSD-managed mode, ACL rules are held instead of the Nuage VSD with security groups disabled.</p><p>Nuage integrates with OpenStack by setting up a net partition. Using net partitions, one Nuage VSP Platform can be mapped to multiple instances of OpenStack. Net partitions are a way of mapping an OpenStack cloud to a Nuage organization entity.</p><p>Using the Nuage VSP platform with an organization named <code class="literal">Company</code>, whenever a subnet is created under the organization, it is subsequently assigned a unique <code class="literal">nuage_subnet_uuid</code> on creation. In order to map the organization and Nuage subnet to OpenStack neutron, the following command is issued:</p><div class="informalexample"><pre class="programlisting">neutron subnet-create "Subnet Application1" 10.102.144.0/24 --nuagenet nuage_subnet_uuid --net-partition "Company" --name "Subnet Application1"</pre></div><p>Once a net partition has been established by the Nuage VSP Platform and OpenStack, the firewall policies are secured at the compute host (hypervisor) using the Nuage VRS. The following workflow is triggered when a new instance is created on a Nuage-managed subnet:</p><div class="mediaobject"><img src="graphics/B05559_02_05.jpg" alt="Nuage or OpenStack managed networks"/></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">An instance <a id="id179" class="indexterm"/>is added to an OpenStack network and subnet owned by the Nuage VSP Platform.</li><li class="listitem">A placeholder <a id="id180" class="indexterm"/>VPort is created (VM id, MAC) on <span class="strong"><strong>VSD</strong></span> by the <span class="strong"><strong>Nuage Plugin</strong></span>, within the requested layer 3 domain.</li><li class="listitem">Nova service creates the <span class="strong"><strong>VM</strong></span> on the <span class="strong"><strong>Hypervisor</strong></span>. This is detected by <span class="strong"><strong>VRS</strong></span> (VM id, MAC).</li><li class="listitem">The <span class="strong"><strong>VRS</strong></span> queries <span class="strong"><strong>VSC</strong></span>, the <span class="strong"><strong>VSC</strong></span> then queries the <span class="strong"><strong>VSD</strong></span> in order to retrieve the associated networking information from the placeholder VPort.</li><li class="listitem">The <span class="strong"><strong>VSD</strong></span> matches the VM id, MAC against the VPort it created and associates <span class="strong"><strong>VM</strong></span> with the correct network services.</li><li class="listitem">The policy is downloaded from the <span class="strong"><strong>VSD</strong></span> through the <span class="strong"><strong>VSC</strong></span> to the <span class="strong"><strong>VRS</strong></span> using OpenFlow, and the required flows are dynamically created.</li></ol></div></div><div class="section" title="The Nuage VSP software-defined object model"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>The Nuage VSP software-defined object model</h2></div></div></div><p>As Nuage <a id="id181" class="indexterm"/>creates the overlay network in software, it needs to have a simple object model to allow network operators to manage it. The Nuage VSP software-defined object model provides a graphical hierarchy of the network meaning that the structure of the overlay can be easily viewed and audited.</p><div class="section" title="Object model overview"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec01"/>Object model overview</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Organization</strong></span>: This <a id="id182" class="indexterm"/>governs all Layer 3 domains.<div class="mediaobject"><img src="graphics/B05559_02_06.jpg" alt="Object model overview"/></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Layer 3 domain Template</strong></span>: A layer <a id="id183" class="indexterm"/>3 domain template is required before child layer 3 domains are created. The layer 3 domain template is used to govern overarching default policies that will be propagated to all child layer 3 domains. If a layer 3 domain template is updated at template level, then the update <a id="id184" class="indexterm"/>will be implemented on all layer 3 domains that have been created underneath it immediately.<div class="mediaobject"><img src="graphics/B05559_02_07.jpg" alt="Object model overview"/></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Layer 3 domain</strong></span>: This <a id="id185" class="indexterm"/>can be used to segment different environments, so users cannot hop from subnets deployed under a layer 3 Test domain to an adjacent layer 3 Production domain.<div class="mediaobject"><img src="graphics/B05559_02_08.jpg" alt="Object model overview"/></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Zones</strong></span>: A zone <a id="id186" class="indexterm"/>segments firewall policies at application level, so each microservice application can have its own zone and associated Ingress and Egress policy per layer 3 domain.<div class="mediaobject"><img src="graphics/B05559_02_09.jpg" alt="Object model overview"/></div></li><li class="listitem" style="list-style-type: disc">Layer 3 Subnet: This is where VMs or bare metal servers that are deployed to.<p>In this example, we see <span class="strong"><strong>Subnet Application1</strong></span> and <span class="strong"><strong>Subnet Application2,</strong></span> as follows:</p><div class="mediaobject"><img src="graphics/B05559_02_10.jpg" alt="Object model overview"/></div></li></ul></div><p>The hierarchy <a id="id187" class="indexterm"/>in Nuage VSD is shown below:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">One organization has been created named <span class="strong"><strong>Company</strong></span>.</li><li class="listitem" style="list-style-type: disc">Two layer 3 domains named <span class="strong"><strong>Test</strong></span> and <span class="strong"><strong>Production</strong></span> have been created underneath the Company.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Test</strong></span> layer 3 domain has a zone for <span class="strong"><strong>Application1</strong></span> and <span class="strong"><strong>Application2</strong></span> with 1 child subnet underneath the <span class="strong"><strong>Application1</strong></span> and <span class="strong"><strong>Application2</strong></span> zones.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Production </strong></span>layer 3 domain has a zone for <span class="strong"><strong>Application1</strong></span> and <span class="strong"><strong>Application2</strong></span> with 1 child subnet underneath the <span class="strong"><strong>Application1</strong></span> only. <span class="strong"><strong>Application2</strong></span> zone does not have a child subnet yet.<div class="mediaobject"><img src="graphics/B05559_02_11.jpg" alt="Object model overview"/></div></li></ul></div><p>For security and compliance purposes, demonstrating to security auditors segmentation between <span class="strong"><strong>Development</strong></span> and <span class="strong"><strong>Production</strong></span> environments is very important. Frequently, <span class="strong"><strong>Development</strong></span> environments do not have the same stringent production controls applied to them. Production applications can be secured using the convention of least privilege possible, to minimize access and reduce the probability of a security breach.</p><p>The Nuage <a id="id188" class="indexterm"/>VSP Platform can set up segregation between environments using its layer 3 domain template construct. A domain template can be set up with a default <span class="strong"><strong>Deny All</strong></span> policy at Ingress and Egress level. This is given the highest priority of all the policies and will explicitly drop all packets no matter the protocol for inbound and outbound connections, unless explicitly allowed by the policy for that specific application. The default <span class="strong"><strong>Deny All</strong></span> is the bottom policy on the list of ACL rules applied to an application.</p><p>The explicit drop on <span class="strong"><strong>Egress Security Policy</strong></span> domain template is shown as the <span class="strong"><strong>Bottom policy</strong></span> as follows:</p><div class="mediaobject"><img src="graphics/B05559_02_12.jpg" alt="Object model overview"/></div><p>The contents <a id="id189" class="indexterm"/>of the <span class="strong"><strong>Egress Security Policy</strong></span> are shown with the highest possible priority as follows:</p><div class="mediaobject"><img src="graphics/B05559_02_13.jpg" alt="Object model overview"/></div><p>Likewise, the <a id="id190" class="indexterm"/>explicit drop on Ingress is applied to the domain template as the <span class="strong"><strong>Bottom policy</strong></span>:</p><div class="mediaobject"><img src="graphics/B05559_02_14.jpg" alt="Object model overview"/></div><p>While the <a id="id191" class="indexterm"/>explicit drop on the <span class="strong"><strong>Ingress Security Policy</strong></span> on the domain template is shown as follows:</p><div class="mediaobject"><img src="graphics/B05559_02_15.jpg" alt="Object model overview"/></div><p>The default <a id="id192" class="indexterm"/>Ingress and Egress policies applied to the domain template <span class="strong"><strong>Company L3 Domain Template</strong></span> are illustrated below, which shows the policy applied to all the child layer 3 domains, in this instance, <span class="strong"><strong>Production</strong></span> and <span class="strong"><strong>Test</strong></span>.</p><p>The domain template <span class="strong"><strong>Company L3 Domain Template</strong></span> is shown to be linked to the child layer 3 domains <span class="strong"><strong>Production</strong></span> and <span class="strong"><strong>Test</strong></span> showing the inherited Egress policy from the domain template:</p><div class="mediaobject"><img src="graphics/B05559_02_16.jpg" alt="Object model overview"/></div><p>Likewise, the domain template <span class="strong"><strong>Company L3 Domain Template</strong></span> is linked to the child <a id="id193" class="indexterm"/>layer 3 domains <span class="strong"><strong>Production</strong></span> and <span class="strong"><strong>Test</strong></span> showing the inherited Ingress policy from the domain template:</p><div class="mediaobject"><img src="graphics/B05559_02_17.jpg" alt="Object model overview"/></div><p>It is important to note that, as policies are pushed down to VRS using OpenFlow that ACL rules for Ingress and Egress in Nuage work on the principles:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Egress</strong></span>: This <a id="id194" class="indexterm"/>is a packet flowing from VRS to the subnet or zone</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ingress</strong></span>: This <a id="id195" class="indexterm"/>is a packet flowing from the subnet or zone to the VRS</li></ul></div><p>As an example, an Egress ACL rule will specify that any Egress traffic coming from VRS from port <code class="literal">80</code> will be forwarded to <span class="strong"><strong>Subnet Application1</strong></span>:</p><div class="mediaobject"><img src="graphics/B05559_02_18.jpg" alt="Object model overview"/></div><p>In this <a id="id196" class="indexterm"/>example, an Ingress ACL rule will specify that any Ingress traffic can leave <span class="strong"><strong>Subnet Application1</strong></span> on port <code class="literal">80</code> and will be forwarded to VRS:</p><div class="mediaobject"><img src="graphics/B05559_02_19.jpg" alt="Object model overview"/></div><p>If application owners work on the principle that their layer 3 subnet, where their application is deployed on, is always specified in an ACL rule as either the source or destination in their individual application policy, then ACL rules for an application will only exist in that self-contained policy. If this concept is adhered to, it allows ACL rules for each application to be encapsulated in separate policies, within a layer 3 domain, which, in turn, means that auditing them is much simpler for security teams. It also means that applications support least privilege, meaning only necessary ports are opened so applications can communicate, with an explicit drop applied to anything outside those rules.</p><p>Two policies are shown for two applications, <span class="strong"><strong>Application1</strong></span> and <span class="strong"><strong>Application2</strong></span>, which have separate policies for Ingress and Egress, with the <span class="strong"><strong>Default Ingress Policy</strong></span> specifying the explicit <a id="id197" class="indexterm"/>drop all for any flows not explicitly allowed.</p><p>The <span class="strong"><strong>Ingress Security Policies</strong></span> are shown here:</p><div class="mediaobject"><img src="graphics/B05559_02_20.jpg" alt="Object model overview"/></div><p>The <span class="strong"><strong>Egress Security Policies</strong></span> are shown here:</p><div class="mediaobject"><img src="graphics/B05559_02_21.jpg" alt="Object model overview"/></div><p>Nuage VSP Platform layer 3 domain templates allow a second level of segmentation using zones, so traditionally networks were split into three zones, where applications would be deployed in the following tiers:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Frontend</li><li class="listitem" style="list-style-type: disc">Business Logic</li><li class="listitem" style="list-style-type: disc">Backend</li></ul></div><p>As microservice architectures have grown to prominence, each applications profile doesn't always fit into these three broad profiles. Sometimes, applications can be both a Frontend <a id="id198" class="indexterm"/>application and Business Logic too, so where would the microservice application be placed in the traditional three-tiered structure?</p><p>Instead of the Frontend, Business Logic and Backend segregation policies that can be applied at zone level, meaningful microsegmentation of applications is possible between each subnet. So how does this translate to Nuage?</p><p>If an application wishes to talk to another application it will have an ACL rule that specifies Subnet to Zone communication for east to west communication between applications sitting on adjacent subnets in a layer 3 domain. Nuage allows this by allowing applications to talk Subnet to Zone.</p><div class="mediaobject"><img src="graphics/B05559_02_22.jpg" alt="Object model overview"/></div><p>To allow <a id="id199" class="indexterm"/>this communication, <span class="strong"><strong>Application1</strong></span> could have an ACL policy to allow <span class="strong"><strong>Application2</strong></span> zone to allow traffic to flow into the subnet on port <code class="literal">22</code> allowing east to west communication, so no matter how many different subnets are used then <span class="strong"><strong>Application1</strong></span> will always be allowed to communicate with any applications sitting under the <span class="strong"><strong>Application2</strong></span> zone.</p><div class="mediaobject"><img src="graphics/B05559_02_23.jpg" alt="Object model overview"/></div><p>In terms <a id="id200" class="indexterm"/>of security policies, this allows development and security teams to understand which applications are communicating with each other and the ports they are using by reviewing the application policy.</p><div class="mediaobject"><img src="graphics/B05559_02_24.jpg" alt="Object model overview"/></div></div></div></div>
<div class="section" title="How the Nuage VSP platform can support greenfield and brownfield projects"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>How the Nuage VSP platform can support greenfield and brownfield projects</h1></div></div></div><p>Overlay <a id="id201" class="indexterm"/>networks are typically set up as new network (greenfield) sites, but a completely new network in isolation is not useful, unless there is a planned big bang migration of all applications, which means migrating every application from the legacy network to the new network in a single migration.</p><p>If instead <a id="id202" class="indexterm"/>a staged application migration is chosen, where only a percentage of applications are migrated to the network, then the new overlay network will need to communicate with the legacy network and be required to operate in a brownfield setup.</p><p>A brownfield setup normally means applications are migrated in stages to the new platform, as opposed to all in one go, which builds confidence in the new network and new technology associated with that network. When moving applications to the new platform, it will typically involve performance testing the migrated applications in the new network, prior to throttling live traffic away from the incumbent legacy network to the migrated application in the new overlay network.</p><p>A major <a id="id203" class="indexterm"/>requirement for a staged migration is connectivity back to the legacy network for application dependencies that are hosted there. This connectivity is necessary so migrated applications can operate effectively.</p><p>The Nuage VSP Platform uses its <span class="strong"><strong>Virtualized Service Gateway</strong></span> (<span class="strong"><strong>VSG</strong></span>) to provide the connectivity between the new overlay and legacy network. A pair of Nuage VSGs are connected redundantly in virtual chassis mode which connect to interfaces on routers sitting in the legacy network. VSG performs a route table lookup based on the destination IP of a packet coming in on its VLAN from the attached router interface; it then updates the destination MAC with the next hop address and forwards the packet on the corresponding VXLAN segment. All packets are routed from the legacy network to the VSG via an underlay network.</p><p>This bridges the new overlay network, and the legacy network with VXLAN terminated on VSG.</p><p>The pair <a id="id204" class="indexterm"/>of active VSGs is shown below in Nuage VSD:</p><div class="mediaobject"><img src="graphics/B05559_02_25.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>The Nuage VSG allows <a id="id205" class="indexterm"/>communication with the legacy network by leaking routes to the overlay network. Each VSG will receive and advertise IPv4 routes using a BGP session, this BGP session will be established between VSG, VSC and leaf switch when using a leaf spine topology using iBGP.</p><p>The VSG must advertise its local system IP to legacy routers in the legacy network and all routes received from the native network will then be subsequently leaked from the native network via the underlay network into selected layer 3 domains in the overlay.</p><p>The setup required to leak routes in the Nuage VSP Platform is the creation of a <span class="strong"><strong>GRThubDomain</strong></span> layer 3 domain. In this example, host interfaces are connected into the Frontend, Business Logic, and Backend routers in the legacy network:</p><div class="mediaobject"><img src="graphics/B05559_02_26.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>The Nuage <a id="id206" class="indexterm"/>VSP platform then allows the newly created <span class="strong"><strong>GRThubDomain</strong></span> to be associated with the <span class="strong"><strong>Production</strong></span> or <span class="strong"><strong>Test</strong></span> layer 3 domains by associating a leaking domain against them.</p><p>In the following example, <span class="strong"><strong>GRThubDomain</strong></span> is associated with the <span class="strong"><strong>Production</strong></span> layer 3 domain.</p><p>The leaking <a id="id207" class="indexterm"/>domain in the Nuage GUI is displayed using the following icon showing a leaking domain named <span class="strong"><strong>GRThubDomain</strong></span>:</p><div class="mediaobject"><img src="graphics/B05559_02_27.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>The Production domain with an associated leaking domain is shown in the Nuage GUI as follows:</p><div class="mediaobject"><img src="graphics/B05559_02_28.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>The association of a leaking domain allows the Nuage VSP Platform to leak routes into and from the legacy network through to the new overlay network, meaning applications in the overlay <a id="id208" class="indexterm"/>network can communicate with applications in the legacy network, so long as they have appropriate Ingress and Egress ACL policies specified.</p><p>The <span class="strong"><strong>Test</strong></span> and <span class="strong"><strong>Production</strong></span> layer 3 domains, as explained before, have a <span class="strong"><strong>Deny All</strong></span> for Ingress <a id="id209" class="indexterm"/>and Egress as part of the <span class="strong"><strong>Company L3 Domain Template</strong></span>. So although all routes are leaked into the overlay, they are dropped by the VRS unless explicitly stated otherwise.</p><p>The Nuage VSP platform has the ability to apply ACL rules to the routes leaked from the external legacy network by using a concept named <span class="strong"><strong>Network Macros</strong></span>. In the Nuage VSP Platform, a network macro is simply a fancy name for an external network range.</p><p>If an application, <span class="strong"><strong>Application3</strong></span> in this instance, resides in the legacy network, and its routing has already been exposed by the <span class="strong"><strong>GRThubDomain</strong></span> leaking domain and leaked into the <span class="strong"><strong>Test</strong></span> layer 3 domain, then a network macro can be set up to describe the range required and isolate connectivity to it using a Nuage ACL rule.</p><p>In this instance, the network range <code class="literal">10.58.11.0/24</code> is where <span class="strong"><strong>Application3</strong></span> resides is part of the Frontend range on the <span class="strong"><strong>GRThubdomain</strong></span> that is leaked into the overlay network. The <span class="strong"><strong>Network Macros</strong></span> for <span class="strong"><strong>Application3</strong></span> as it would appear in Nuage is shown below:</p><div class="mediaobject"><img src="graphics/B05559_02_29.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>An Egress ACL policy can then be configured to allow <span class="strong"><strong>Application1</strong></span> to communicate with <span class="strong"><strong>Application3</strong></span> by creating a Network Macros to a subnet ACL rule, which allows <span class="strong"><strong>Application3</strong></span> <span class="strong"><strong>Network Macros</strong></span> to connect to <span class="strong"><strong>Subnet Application1</strong></span> on port <code class="literal">8080.</code>
</p><p>The <a id="id210" class="indexterm"/>
<span class="strong"><strong>Egress Security Policy</strong></span> to allow <a id="id211" class="indexterm"/>communication between <span class="strong"><strong>Application3</strong></span> <span class="strong"><strong>Network Macros</strong></span> and <span class="strong"><strong>Subnet Application1</strong></span> on port <code class="literal">8080</code> is shown here:</p><div class="mediaobject"><img src="graphics/B05559_02_30.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>After creation, the ACL list is updated to show the new <span class="strong"><strong>Network Macro</strong></span> ACL:</p><div class="mediaobject"><img src="graphics/B05559_02_31.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>This allows the Nuage VSP to lock down policy and the overlay network to only allow specific flow data from the legacy network in the same way it would control ACL policies between subnet or zones that resided within the same layer 3 domain. Network macros can also be used to route between multiple cloud technologies as well as different data centers, so they are a very powerful way of connecting networks and controlling policy between them.</p><p>Multiple <a id="id212" class="indexterm"/>network macros can be grouped together into a network macro group, which allows multiple ranges to be controlled by one ACL rule. These are then exploded out at the OpenFlow level on VRS at the <a id="id213" class="indexterm"/>hypervisor. Nuage currently has a limit of 100 ACL rules per VPort in the 3.x release, so only 100 ACL rules can currently be applied to a single instance (virtual machine), so it is important to be careful when grouping <span class="strong"><strong>Network Macros</strong></span>. This has been increased to 500 ACL rules in the 4.x release of the Nuage platform.</p><p>An example of a network macro group can be shown below and then the <span class="strong"><strong>Front End Services</strong></span> <span class="strong"><strong>Network Macro Group</strong></span> can be used in the Egress ACL rule as opposed to specifying individual policies for <span class="strong"><strong>Application3</strong></span> and <span class="strong"><strong>Application4</strong></span>:</p><div class="mediaobject"><img src="graphics/B05559_02_32.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>The <span class="strong"><strong>Egress Security Policy</strong></span> to allow port <code class="literal">8080</code> connection between the <span class="strong"><strong>Front End Services</strong></span> <a id="id214" class="indexterm"/>
<span class="strong"><strong>Network Macro Group</strong></span> and <span class="strong"><strong>Subnet Application1</strong></span>:</p><div class="mediaobject"><img src="graphics/B05559_02_33.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div><p>The <a id="id215" class="indexterm"/>applied ACL implementing the <span class="strong"><strong>Front End Services</strong></span> network macro can be found here:</p><div class="mediaobject"><img src="graphics/B05559_02_34.jpg" alt="How the Nuage VSP platform can support greenfield and brownfield projects"/></div></div>
<div class="section" title="The Nuage VSP multicast support"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>The Nuage VSP multicast support</h1></div></div></div><p>The Nuage <a id="id216" class="indexterm"/>VSP Platform has the ability to route multicast between the following Nuage VSD entities:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Layer 2 and 3 domains</li><li class="listitem" style="list-style-type: disc">Zones</li><li class="listitem" style="list-style-type: disc">Subnets</li><li class="listitem" style="list-style-type: disc">VPorts attached to VMs</li></ul></div><p>Multicast can be routed into the overlay network, which is a unique feature of the Nuage VSP platform. Multicast traffic is routed into the overlay network in Nuage by configuring dedicated VLANs on the underlay layer 2 network, which are attached to compute nodes. This allows the compute (hypervisors) on the underlay network to use the dedicated VLANs, which are ip'd on a per rack basis, to transmit and receive multicast traffic.</p><p>To route multicast traffic across the underlay, the Nuage VRS will duplicate the multicast packets and leak it into the overlay network in a controlled fashion. This is so the overlay network is not flooded with unnecessary multicast traffic, which can cause performance implications to the overlay network if it was not controlled. This makes the Nuage multicast setup highly scalable as it only directs multicast traffic to where it needs to in the overlay network.</p><p>The Nuage VSP uses a dedicated VLAN for multicast send and VLAN for multicast receive on the compute nodes (hypervisor). Each of these VLANs can be configured on each hypervisor in the event applications that have a multicast requirement.</p><p>Each of the hypervisors is allocated a VLAN and unique IP address for multicast send and receive, depending on the rack the hypervisors are provisioned on, so they use the associated switches.</p><p>Port Channel Maps are the entity used in Nuage VSD to leak multicast from the underlay network to the overlay network. Port Channel Maps are only required if multicast needs to be routed subnet to subnet in the overlay network. If multicast is required in the same subnet, then a <span class="strong"><strong>Port Channel Maps</strong></span> is not required and multicast will work within an isolated layer 3 subnet without having to route the traffic via the VLANs on the hypervisors.</p><p>In the <a id="id217" class="indexterm"/>following example, a <span class="strong"><strong>Multicast Channel Map</strong></span> is used to create <span class="strong"><strong>Multicast Ranges</strong></span> for <span class="strong"><strong>Application2</strong></span>, which broadcasts multicast. This will route multicast from <span class="strong"><strong>Subnet Application2</strong></span>, via the underlay VLAN on the hypervisor, to the Nuage VRS and then flood it into <span class="strong"><strong>Subnet Application1</strong></span>.</p><p>The <span class="strong"><strong>Multicast Channel Maps</strong></span> icon is shown here:</p><div class="mediaobject"><img src="graphics/B05559_02_35.jpg" alt="The Nuage VSP multicast support"/></div><p>The following scenario describes the workflow an application will go through to route multicast traffic from one layer 3 subnet to another in the overlay.</p><p>
<span class="strong"><strong>Application1</strong></span> will be deployed under a layer 3 domain, under its own zone, in a /26 microsubnet and on that subnet two virtual machines will be attached to two VPorts. Against a VPort in Nuage, a virtual machine can be set up as a sender or receiver of multicast or both:</p><div class="mediaobject"><img src="graphics/B05559_02_37.jpg" alt="The Nuage VSP multicast support"/></div><p>
<span class="strong"><strong>Application1</strong></span> in this instance is the sender of multicast and wants to send a multicast stream to <span class="strong"><strong>Application2</strong></span>, which is deployed under a layer 3 domain, under its own zone, in a /26 microsubnet, and on that subnet, one virtual machines will be attached to one VPort.</p><p>So a Port Channel Map will need to be set up on <span class="strong"><strong>Application1</strong></span> by associating it with each of the <span class="strong"><strong>Application1</strong></span> VPorts, which lets Nuage know that <span class="strong"><strong>Application1</strong></span> is the multicast sender.</p><p>
<span class="strong"><strong>Application2</strong></span> will have its VPort configured with a Port Channel Map setup, so it can receive multicast.</p><p>When Application1s two virtual machines broadcast multicast traffic, Nuage now knows to route the multicast traffic on the matching multicast range specified on the Port Channel Map to the hypervisor that <span class="strong"><strong>Application1</strong></span> is deployed on.</p><p>Nuage <a id="id218" class="indexterm"/>will transmit multicast across the hypervisor layer 2 domain using the sender VLAN.</p><p>Each of the receiver VLANs on each hypervisor's receiver IPs will then pick up the transmission of multicast.</p><p>If a Port Channel Map is specified on any of the virtual machines on the hypervisor, matching the <span class="strong"><strong>Multicast Ranges</strong></span> configured, which <span class="strong"><strong>Application2</strong></span> does, then the Nuage VRS will duplicate the multicast packets, leaking them into the overlay network to <span class="strong"><strong>Application2</strong></span>.</p><p>This is how Nuage leaks multicast traffic to the overlay network, using the underlay network and sender and receiver VLANs.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Summary</h1></div></div></div><p>In this chapter, we covered some of the advanced networking features provided by the Nuage VSP SDN solution and also touched upon some of the other SDN solutions that are available on the market. Having read this chapter, you should now be familiar with the Nuage SDN controller and understand the rich set of features an SDN controller can bring to OpenStack and the private cloud.</p><p>Given the programmability SDN controllers, AWS, and OpenStack solutions bring, we will now shift focus and look at the cultural changes that are necessary in organizations to make the most of these fantastic technologies. Implementing new technologies without changing operational models is not enough, people and process are key to a successful DevOps model.</p><p>The role of the network engineer is undergoing its biggest evolution in years, so businesses cannot simply implement new technology and expect faster delivery without dealing with people and cultural issues. CTOs have a responsibility to set their networking teams up for success by implementing DevOps transformations that include network functions, and network teams also need to learn new skills such as coding to push forward automation using grass root initiatives.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Useful links on Nuage Networks practical use cases are:</p><p>
<a class="ulink" href="https://www.youtube.com/watch?v=_ZfFbhmiNYo">https://www.youtube.com/watch?v=_ZfFbhmiNYo</a>
</p><p>
<a class="ulink" href="https://www.youtube.com/watch?v=aKa2idHhk94">https://www.youtube.com/watch?v=aKa2idHhk94</a>
</p><p>
<a class="ulink" href="https://www.youtube.com/watch?v=OjXII11hYwc">https://www.youtube.com/watch?v=OjXII11hYwc</a>
</p></div></div></div></body></html>