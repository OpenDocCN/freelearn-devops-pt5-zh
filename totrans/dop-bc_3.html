<html><head></head><body>
        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Containers</h1>
            

            <article>
                
<div class="packtquote1">"The first rule of any technology used in a business is that automation applied to an efficient operation will magnify the efficiency. The second is that automation applied to an inefficient operation will magnify the inefficiency."<br class="title-page-name"/>
                                                                                                                             - Bill Gates</div>
<p class="calibre2">We have seen DevOps practices and continuous integration until now. However, recently, containers have become a buzz word and everyone wants to have a hands-on experience with it. The main reason is to utilize the resources effectively and efficiently. <span>Docker is an open source initiative for OS virtualization that automates the deployment of applications inside software containers. It is extremely useful to utilize containers for Dev or QA environments for better resource utilization.</span></p>
<p class="calibre2">In this chapter, we will try to install and create a sample container. The objective is to get familiar with Docker containers and get a feel of how containers can be utilized for application deployment. </p>
<p class="calibre2">This chapter provides a quick overview of containers. We will be focusing on the following topics in this chapter: </p>
<ul class="calibre10">
<li class="calibre11">Overview of Docker containers</li>
<li class="calibre11">Understanding the difference between virtual machines and containers</li>
<li class="calibre11">Installing and configuring Docker</li>
<li class="calibre11">Creating a Tomcat container</li>
</ul>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Overview of Docker containers</h1>
            

            <article>
                
<p class="calibre2">Docker provides isolated user spaces and hence provides user-based processes, space, and filesystems. Behind the scenes, it shares the Linux host kernel. The following diagram illustrates the working mechanism of a Docker container:</p>
<div class="CDPAlignCenter"><img class="image-border20" src="../images/00287.jpeg"/></div>
<p class="calibre2">Docker has two main components with a client-server architecture:</p>
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">Docker Host</strong></li>
<li class="calibre11"><strong class="calibre1">Docker Hub</strong></li>
</ul>
<p class="calibre2">Let's take a look at them in more detail: </p>
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">Docker Host</strong>: The Docker Host contains the Docker daemon, containers, and images. The Docker engine is an important component that provides the core Docker technology. This core Docker technology enables images and containers. When we install Docker successfully, we run a simple command. In our case, we will consider CentOS for the container. To run an interactive shell in the CentOS image, use docker <kbd class="calibre15">run -i -t &lt;image&gt; /bin/bash</kbd>:
<ul class="calibre24">
<li class="calibre11">The <kbd class="calibre15">-i</kbd> flag initiates an interactive container</li>
<li class="calibre11">The <kbd class="calibre15">-t</kbd> flag creates a pseudoterminal that attaches <kbd class="calibre15">stdin</kbd> and <kbd class="calibre15">stdout</kbd></li>
<li class="calibre11">The image is a CentOS image</li>
<li class="calibre11"><kbd class="calibre15">/bin/bash</kbd> starts a shell</li>
</ul>
</li>
</ul>
<p class="calibre25">When we run this command, it verifies whether the CentOS image is available locally. If it is not available, it will download the image from Docker Hub.</p>
<p class="calibre25">An image has a filesystem and parameter that can be used at runtime, while a container is an instance of an image with a state. It is simple to understand that containers change, while images do not.</p>
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">Docker Hub</strong>: Docker Hub is a <strong class="calibre1">Software as a Service</strong> (<strong class="calibre1">SaaS</strong>) for sharing and managing Docker containers. It is a kind of centralized registry service provided by Docker. As a user, we can use it to build and ship applications. It allows us to create a pipeline to integrate with code repositories and for collaboration, image discovery, and automation.    </li>
</ul>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Understanding the difference between virtual machines and containers</h1>
            

            <article>
                
<p class="calibre2">Before we start installation of docker and creation of a container, it will be useful to get an understanding of why containers are different and how they are different from virtual machines. </p>
<p class="calibre2">Let's understand the basic difference between virtual machines and containers.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Virtual machines</h1>
            

            <article>
                
<p class="calibre2">In a <strong class="calibre1">virtual machine</strong> (<strong class="calibre1">VM</strong>), we need to install an operating system with the appropriate device drivers; hence,the footprint or size of a virtual machine is huge. A normal VM with Tomcat and Java installed may take up to 10 GB of drive space:</p>
<div class="CDPAlignCenter"><img class="image-border21" src="../images/00289.jpeg"/></div>
<p class="CDPAlignLeft1">There's an overhead of memory management and device drivers. A VM has all the components a normal physical machine has in terms of operation.</p>
<p class="CDPAlignLeft1">In a VM, the hypervisor abstracts resources. Its package includes not only the application, but also the necessary binaries and libraries, and an entire guest operating system, for example, CentOS 6.7 and Windows 2003.</p>
<p class="calibre2">Cloud service providers use a hypervisor to provide a standard runtime environment for VMs. Hypervisors come in type 1 and type 2 categories.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Containers</h1>
            

            <article>
                
<p class="calibre2">A container shares the operating system and device drivers of the host. Containers are created from images, and for a container with Tomcat installed, the size is less than 500 MB:</p>
<div class="CDPAlignCenter"><img class="image-border22" src="../images/00292.jpeg"/></div>
<p class="calibre2">Containers are small in size and hence effectively give faster and better performance. They abstract the operating system.</p>
<p class="calibre2">A container runs as an isolated user space, with processes and filesystems in the user space on the host operating system itself, and it shares the kernel with other containers. Sharing and resource utilization are at their best in containers, and more resources are available due to less overhead. It works with very few required resources.</p>
<p class="calibre2">Docker makes it efficient and easier to port applications across environments. </p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Installing and configuring Docker</h1>
            

            <article>
                
<p class="calibre2">Let's quickly install the Docker on Windows 10. In our case, it is a Windows Home edition; so, we need to install Docker toolbox from <a href="https://www.docker.com/products/docker-toolbox" class="calibre4">https://www.docker.com/products/docker-toolbox</a>:</p>
<ol class="calibre17">
<li value="1" class="calibre11">Click on the <span>Download</span> button:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00294.jpeg"/></div>
<ol start="2" class="calibre17">
<li value="2" class="calibre11">It will redirect you to <a href="https://github.com/docker/toolbox/releases/tag/v1.12.5" class="calibre4">https://github.com/docker/toolbox/releases/tag/v1.12.5</a> or the page with the latest version.</li>
</ol>
<ol start="3" class="calibre17">
<li value="3" class="calibre11">Download <span>DockerToolbox</span>. Click on the <kbd class="calibre15">exe</kbd> file of <span>Docker toolbox</span> to install it:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border23" src="../images/00093.jpeg"/></div>
<ol start="4" class="calibre17">
<li value="4" class="calibre11">Click on Next &gt; on the welcome page:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border24" src="../images/00095.jpeg"/></div>
<ol start="5" class="calibre17">
<li value="5" class="calibre11">Select the preferred location to install <span>Docker Toolbox</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border25" src="../images/00097.jpeg"/></div>
<ol start="6" class="calibre17">
<li value="6" class="calibre11">Keep all the default components for installation.</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border26" src="../images/00098.jpeg"/></div>
<ol start="7" class="calibre17">
<li value="7" class="calibre11"><span>Select Additional Tasks</span> that should be performed and click on <span>Next &gt;</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border27" src="../images/00100.jpeg"/></div>
<ol start="8" class="calibre17">
<li value="8" class="calibre11">Click on <span>Install</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border28" src="../images/00101.jpeg"/></div>
<ol start="9" class="calibre17">
<li value="9" class="calibre11">Docker toolbox installation will install the virtual box too:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border29" src="../images/00103.jpeg"/></div>
<ol start="10" class="calibre17">
<li value="10" class="calibre11">Click on <span>Finish</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border30" src="../images/00204.jpeg"/></div>
<p class="calibre2">Before starting operations on Docker, we need to enable the virtualization technology in the Windows system, or else we will get the following error:</p>
<ul class="calibre10">
<li class="calibre11">Creating CA using <kbd class="calibre15">C:UsersMitesh.dockermachinecertsca.pem</kbd></li>
<li class="calibre11">Creating a client certificate using <kbd class="calibre15">C:UsersMitesh.dockermachinecertscert.pem</kbd></li>
<li class="calibre11"><kbd class="calibre15">Running pre-create checks... Error with pre-create check: "This computer doesn't have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory" Looks like something went wrong in step ´Checking if machine default exists´... Press any key to continue...</kbd></li>
</ul>
<ul class="calibre10">
<li class="calibre11">Go to <span>Settings</span> and click on <span>Advanced Startup</span>. <span>Restart the system</span>. <span>Change the BIOS setting to enable Virtualization Technology</span>:</li>
</ul>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00205.gif"/></div>
<p class="calibre2">Once the system is restarted, click on <span>Docker Quickstart Terminal</span> on the desktop. It will run precreate checks and download <kbd class="calibre15">boot2docker.iso</kbd> and run the virtual machine.</p>
<p class="calibre2">After all proper configuration and checks, Docker is up and running:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00207.gif"/></div>
<div class="packtinfobox">To get details on how to install Docker in CentOS, read DevOps for web development, available at <a href="https://www.packtpub.com/networking-and-servers/devops-web-development" class="calibre22">https://www.packtpub.com/networking-and-servers/devops-web-development</a>.</div>
<p class="calibre2">Once <span>Docker is up and running</span>, we are ready to create docker containers. Note the IP address of the default docker machine:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00210.jpeg"/></div>
<p class="calibre2">Let's create a sample hello world container. Execute <kbd class="calibre15">docker run hello-world</kbd>. If you get the <kbd class="calibre15">"Hello from Docker!"</kbd> message, then we have created the container successfully:</p>
<div class="CDPAlignCenter"><img class="image-border31" src="../images/00113.gif"/></div>
<p class="calibre2">As we need to deploy a JEE application, we will create a Tomcat container in the next section.  </p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Creating a Tomcat container</h1>
            

            <article>
                
<p class="calibre2">In this section, we will create a container with the Tomcat web server installed so that we can deploy Java-based web applications into it:</p>
<ol class="calibre17">
<li value="1" class="calibre11">Create an account in Docker hub and <span>Login</span>:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00115.jpeg"/></div>
<ol start="2" class="calibre17">
<li value="2" class="calibre11">We can search different images from the Docker hub:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border32" src="../images/00239.jpeg"/></div>
<ol start="3" class="calibre17">
<li value="3" class="calibre11">You can find the Tomcat image at <a href="https://hub.docker.com/_/tomcat/" class="calibre4">https://hub.docker.com/_/tomcat/</a>. </li>
<li value="4" class="calibre11">Use Docker's <kbd class="calibre15">pull</kbd> command to get the Tomcat image:</li>
</ol>
<pre class="calibre26">
<strong class="calibre1">        docker pull tomcat </strong>
</pre>
<ol start="5" class="calibre17">
<li value="5" class="calibre11">Once the Tomcat image is available, verify it using the <kbd class="calibre15">docker images</kbd> command:</li>
</ol>
<div class="CDPAlignCenter"><img class="image-border33" src="../images/00121.gif"/></div>
<ol start="6" class="calibre17">
<li value="6" class="calibre11">To run docker container from the image, run <kbd class="calibre15">docker run -it --rm -p 8888:8080 tomcat:8.0</kbd>.</li>
</ol>
<div class="CDPAlignCenter"/>
<ol start="7" class="calibre17">
<li value="7" class="calibre11">Use the <span>IP address of the default docker machine and port <kbd class="calibre15">8888</kbd> in the browser to verify whether Tomcat is running properly in the container or not:</span></li>
</ol>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00123.jpeg"/></div>
<ol start="8" class="calibre17">
<li value="8" class="calibre11">To get the IP address of the virtual machine, execute <kbd class="calibre15">docker-machine ls</kbd> command.</li>
</ol>
<p class="calibre2">Let's verify whether we have access to the Tomcat manager application in this container: </p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00125.gif"/></div>
<p class="calibre2">What we will do here is, create a new image with our own <kbd class="calibre15">tomcat-users.xml</kbd>, where we will create a user with the <kbd class="calibre15">manager-script</kbd> role to access the Tomcat manager application.</p>
<p class="calibre2">Create a directory. Go to that directory and create a <kbd class="calibre15">tomcat-users.xml</kbd> file.</p>
<p class="calibre2">Add the following content in it:</p>
<pre class="calibre26">
&lt;?xml version='1.0' encoding='utf-8'?&gt;<br class="title-page-name"/>&lt;tomcat-users  <br class="title-page-name"/>xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd" version="1.0"&gt;<br class="title-page-name"/>&lt;!--<br class="title-page-name"/>NOTE: The sample user and role entries below are intended for use with the examples web application. They are wrapped in a comment and thus are ignored when reading this file. If you wish to configure these users for use with the examples web application, do not forget to remove the &lt;!....&gt; that surrounds them. You will also need to set the passwords to something appropriate.<br class="title-page-name"/>--&gt;<br class="title-page-name"/>&lt;role rolename="manager-script"/&gt;<br class="title-page-name"/>&lt;user username="admin" password="admin@123" roles="manager-script"/&gt;<br class="title-page-name"/>&lt;/tomcat-users&gt;
</pre>
<p class="calibre2">Create a new file with the name <kbd class="calibre15">Dockerfile</kbd> in the same directory and add the following content:</p>
<pre class="calibre26">
<strong class="calibre1">FROM tomcat:8.0<br class="title-page-name"/></strong><strong class="calibre1">MAINTAINER Mitesh&lt;xxxxxx.xxxxxx@gmail.com&gt;<br class="title-page-name"/></strong><strong class="calibre1">COPY tomcat-users.xml /usr/local/tomcat/conf/tomcat-users.xml</strong>
</pre>
<p class="calibre2">In the <span>Docker Quickstart Terminal</span>, go to the directory that we have created.</p>
<p class="calibre2">Execute <kbd class="calibre15">docker build -t devops_tomcat_sc</kbd> .</p>
<p class="calibre2">Once the image is successfully built, verify it using docker images:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00127.jpeg"/></div>
<p class="calibre2"><span>Execute <kbd class="calibre15">docker run -it -p 8888:8080 devops_tomcat_sc:8.0</kbd> and verify the number of containers using <kbd class="calibre15">docker ps -a</kbd>.</span></p>
<p class="calibre2">We can stop the container using <kbd class="calibre15">docker stop &lt;container_name&gt;</kbd>:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00296.gif"/></div>
<p class="calibre2">To change the name of the container, use <kbd class="calibre15"><span>docker run -it -p 9999:8080 --name bootcamp_tomcat </span><span>devops_tomcat_sc</span></kbd>.</p>
<p class="calibre2">Verify the name using <kbd class="calibre15">docker ps -a</kbd>:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00299.gif"/></div>
<p class="calibre2">Use the virtual machine IP address and <kbd class="calibre15">9999</kbd> as a port number to access Tomcat running in the container:</p>
<div class="CDPAlignCenter"><img class="image-border34" src="../images/00133.jpeg"/></div>
<p class="calibre2">Verify the manager access with the <kbd class="calibre15">manager-script</kbd> role using the following URL:</p>
<div class="CDPAlignCenter"><img class="image-border35" src="../images/00305.jpeg"/></div>
<p class="calibre2">Let's just try to deploy an application using the <kbd class="calibre15">Deploy to Container</kbd> plugin in Tomcat. If one build job generates WAR files, then copy it from that build using the copy artifact plugin:</p>
<div class="CDPAlignCenter"><img class="image-border36" src="../images/00311.jpeg"/></div>
<p class="calibre2">In <span>Post-build Actions</span>, select <span>Deploy war/ear to a container</span>. Give the username and password provided in <span>tomcat-users.xml</span>. Give the Tomcat URL. Click on <span>Apply</span>/<span>Save</span>:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00314.jpeg"/></div>
<p class="calibre2">Click on <span>Build Now</span>:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00141.jpeg"/></div>
<p class="calibre2">Go to <span>Console Output</span> and verify the deployment process:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00143.jpeg"/></div>
<p class="calibre2">Verify the application URL using the Tomcat URL and application context:</p>
<div class="CDPAlignCenter"><img class="image-border6" src="../images/00145.jpeg"/></div>
<p class="calibre2">Now we are done.</p>
<p class="calibre2">Thus you can see that we have created an image, a container, and deployed the application in the Tomcat container. </p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
            

            <article>
                
<p class="calibre2">So we have seen in this chapter how to install Docker containers in Windows 10, and how to use Docker hub to find images available in the public domain. </p>
<p class="calibre2">We have executed the hello world container to verify whether Docker has been successfully installed or not. Once we have verified the Docker installation, we used Docker hub to get the Tomcat image and successfully created a Tomcat 8 container and accessed it through the browser. </p>
<p class="calibre2">We also used Jenkins to deploy the application in the Tomcat container. Our objective was to utilize the docker container for application deployment. </p>
<p class="calibre2">In the next chapter, we will cover how we can utilize the configuration management tool Chef for setting up the run-time environment so that we can deploy Java-based web applications in the virtual machine.</p>


            </article>

            <footer class="calibre5">
                
            </footer>

        </section>
    </body></html>