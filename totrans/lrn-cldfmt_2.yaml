- en: Building Your First AWS CloudFormation Project
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建您的第一个AWS CloudFormation项目
- en: We can build various infrastructure models using AWS CloudFormation. We can
    add, update, and delete AWS resources in our infrastructure design as IaC and
    then deploy our IaC scripts to AWS CloudFormation. In this section, we will build
    a simple project to show how to develop IaC using AWS CloudFormation.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用AWS CloudFormation构建各种基础设施模型。我们可以在我们的基础设施设计中作为IaC添加、更新和删除AWS资源，然后将我们的IaC脚本部署到AWS
    CloudFormation。在本节中，我们将构建一个简单的项目，展示如何使用AWS CloudFormation开发IaC。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Preparing a project
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备项目
- en: CloudFormation implementation using the management console
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用管理控制台实现CloudFormation
- en: CloudFormation implementation using the AWS CLI
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用AWS CLI实现CloudFormation
- en: Managing an AWS CloudFormation project
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理AWS CloudFormation项目
- en: CloudFormation project scenario
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: CloudFormation项目场景
- en: In the previous chapter, we learned what AWS CloudFormation is. In this chapter,
    we continue our exploration of AWS CloudFormation. We will focus on how to build
    a simple IaC using CloudFormation.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们了解了什么是AWS CloudFormation。在本章中，我们将继续探索AWS CloudFormation。我们将专注于如何使用CloudFormation构建一个简单的IaC。
- en: 'To minimize problem complexity, we will use a simple AWS resource such as Amazon
    S3, and create a bucket in Amazon S3 through CloudFormation. To build a CloudFormation
    project, we will follow the steps shown in the following diagram:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化问题的复杂性，我们将使用一个简单的AWS资源，如Amazon S3，并通过CloudFormation在Amazon S3中创建一个存储桶。为了构建CloudFormation项目，我们将按照以下图示的步骤进行：
- en: '![](img/00014.jpeg)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00014.jpeg)'
- en: 'Figure 2.1: Project steps for deploying AWS CloudFormation'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.1：部署AWS CloudFormation的项目步骤
- en: 'The preceding diagram shows how to build and deploy a CloudFormation project.
    In this scenario, we will use a CloudFormation stack to build an IaC design. The
    steps are explained as follows:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 上图展示了如何构建和部署CloudFormation项目。在此场景中，我们将使用CloudFormation堆栈来构建IaC设计。步骤如下：
- en: Build IaC scripts in a CloudFormation template to define the AWS resources that
    are used to build an infrastructure
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在CloudFormation模板中构建IaC脚本，以定义用于构建基础设施的AWS资源
- en: Upload the template file to the CloudFormation server
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将模板文件上传到CloudFormation服务器
- en: Create a CloudFormation stack
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建CloudFormation堆栈
- en: Configure all options from the CloudFormation stack
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置CloudFormation堆栈的所有选项
- en: Review all settings before deploying to the CloudFormation server
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在部署到CloudFormation服务器之前，检查所有设置
- en: Deploy a CloudFormation stack
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 部署CloudFormation堆栈
- en: We will apply these steps to our CloudFormation project. Each step will be executed
    in the next section.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将把这些步骤应用到我们的CloudFormation项目中。每个步骤将在下一节中执行。
- en: Preparation
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Technically, we don't need any special preparation. You should have an active
    AWS account in order to build CloudFormation projects, and you also need an internet
    connection since we build and manage AWS through the internet network.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 从技术上讲，我们不需要任何特殊的准备。你应该拥有一个有效的AWS账户才能构建CloudFormation项目，此外你还需要一个互联网连接，因为我们通过互联网网络构建和管理AWS。
- en: Lastly, you should be aware of pricing. Currently, CloudFormation is free, but
    the AWS resources used in a CloudFormation project are probably chargeable. Some
    AWS resources are free with certain limitations.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你应该注意定价。目前，CloudFormation是免费的，但在CloudFormation项目中使用的AWS资源可能会产生费用。某些AWS资源是免费的，但有一些限制。
- en: Implementing a CloudFormation project using the management console
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用管理控制台实现CloudFormation项目
- en: 'In this section, we are going to build our first CloudFormation project graphically
    through the CloudFormation management console. Follow these steps:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将通过CloudFormation管理控制台图形化构建我们的第一个CloudFormation项目。请按照以下步骤操作：
- en: Open a browser and navigate to [https://console.aws.amazon.com/cloudformation](https://console.aws.amazon.com/cloudformation).
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并访问[https://console.aws.amazon.com/cloudformation](https://console.aws.amazon.com/cloudformation)。
- en: 'Log in with your active AWS account. After successful login, you should get
    the AWS CloudFormation management console, as shown in the following screenshot:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你的有效AWS账户登录。登录成功后，你应该能够看到AWS CloudFormation管理控制台，如下图所示：
- en: '![](img/00015.jpeg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00015.jpeg)'
- en: 'Figure 2.2: AWS CloudFormation management console'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.2：AWS CloudFormation管理控制台
- en: To start creating a simple CloudFormation project, first create a stack.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要开始创建一个简单的CloudFormation项目，首先创建一个堆栈。
- en: Click on the Create new stack button, shown in *Figure 2.2*.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击*图2.2*中显示的“创建新堆栈”按钮。
- en: 'You should now see the screen shown in the following screenshot:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你应该能看到以下截图所示的页面：
- en: '![](img/00016.jpeg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00016.jpeg)'
- en: 'Figure 2.3: Selecting a template for CloudFormation'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.3：选择 CloudFormation 的模板
- en: From the screen shown in the preceding screenshot, upload a CloudFormation template
    file. You can upload the template file or create a template using the Design template
    option. If you have a CloudFormation template file that has already been uploaded
    to Amazon S3, you can specify the file path from Amazon S3.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上面的截图所示界面中，上传一个 CloudFormation 模板文件。你可以上传模板文件，或者使用“设计模板”选项创建模板。如果你已经有一个上传到
    Amazon S3 的 CloudFormation 模板文件，可以指定该文件的路径。
- en: For this demo, we uploaded a CloudFormation template file from local to Amazon
    S3\. The template file is in JSON and YAML file formats.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此演示中，我们将一个 CloudFormation 模板文件从本地上传到 Amazon S3。模板文件有 JSON 和 YAML 两种格式。
- en: Now, we can create a template file in JSON and YAML. You can select a template
    file in JSON (`hello-cloudformation.json`) or YAML (`hello-cloudformation.yaml`).
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以创建 JSON 和 YAML 格式的模板文件。你可以选择 JSON 格式的模板文件（`hello-cloudformation.json`）或
    YAML 格式的模板文件（`hello-cloudformation.yaml`）。
- en: 'The following is the content of the `hello-cloudformation.json` file:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是 `hello-cloudformation.json` 文件的内容：
- en: '[PRE0]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The following is the content of the `hello-cloudformation.yaml` file:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是 `hello-cloudformation.yaml` 文件的内容：
- en: '[PRE1]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: After creating a CloudFormation template file in JSON or YAML, you can upload
    it to the CloudFormation management console.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建 JSON 或 YAML 格式的 CloudFormation 模板文件后，你可以将其上传到 CloudFormation 管理控制台。
- en: Select the Upload a template to Amazon S3 option shown in *Figure 2.3*.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择*图 2.3*中显示的“上传模板到 Amazon S3”选项。
- en: Then, click on the Choose File option to select your template file from the
    local computer.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击“选择文件”选项，从本地计算机选择你的模板文件。
- en: Wait until your template file is uploaded to Amazon S3.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待模板文件上传到 Amazon S3。
- en: After it is uploaded, click on the Next button to continue the steps of the
    project.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上传完成后，点击“下一步”按钮继续项目的步骤。
- en: 'You should now see the screen shown in the following screenshot:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你应该能看到以下截图所示的界面：
- en: '![](img/00017.jpeg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00017.jpeg)'
- en: 'Figure 2.4: Adding a stack name'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.4：添加堆栈名称
- en: Fill in your stack name. This is used for stack identity in CloudFormation.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写堆栈名称，这用于 CloudFormation 中堆栈的标识。
- en: After you have filled in the stack name, click on the Next button to continue.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写堆栈名称后，点击“下一步”按钮继续。
- en: 'You will see the following screenshot for configuring stack options such as
    tags and permissions:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到以下截图，用于配置堆栈选项，如标签和权限：
- en: '![](img/00018.jpeg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00018.jpeg)'
- en: 'Figure 2.5: Configuring stack options'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.5：配置堆栈选项
- en: In this demo, we won't configure any options in the CloudFormation stack. We
    can skip this step. Click on the Next button to continue.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此演示中，我们不会配置 CloudFormation 堆栈中的任何选项，因此可以跳过这一步。点击“下一步”按钮继续。
- en: 'You can now see the review screen, as shown in the following screenshot:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你可以看到审查界面，如下图所示：
- en: '![](img/00019.jpeg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00019.jpeg)'
- en: 'Figure 2.6: Confirmation before executing and deploying to Amazon AWS'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.6：执行前的确认，并将资源部署到 Amazon AWS
- en: Review all the information that you have set.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查你所设置的所有信息。
- en: 'Once done, click on the Create button to execute your template and then deploy
    all the resources from the predefined template to Amazon AWS. Your browser should
    be redirected to the CloudFormation dashboard. You should now see the status of
    the stack being created, as shown in the following screenshot:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，点击“创建”按钮执行你的模板，然后将所有资源从预定义模板部署到 Amazon AWS。你的浏览器应该会自动跳转到 CloudFormation
    仪表盘。你现在应该能看到正在创建堆栈的状态，如下图所示：
- en: '![](img/00020.jpeg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00020.jpeg)'
- en: 'Figure 2.7: A stack being created in CloudFormation'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.7：在 CloudFormation 中创建堆栈
- en: If you want to get an update on the progress of the creation, click on the circle-arrow
    at the top right.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你想查看创建进度，可以点击右上角的圆形箭头。
- en: 'Once the process is done, you should see it in the Status column, in the list
    shown in the following screenshot:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 处理完成后，你应该能在“状态”列中看到它，以下截图显示了这个状态：
- en: '![](img/00021.jpeg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00021.jpeg)'
- en: 'Figure 2.8: A stack was completely created'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.8：堆栈已完全创建
- en: If you want to see the details of your created stack, you can click on your
    stack name, as shown in the preceding screenshot.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你想查看已创建堆栈的详细信息，可以点击堆栈名称，如上图所示。
- en: 'Then, you will see details from the selected CloudFormation stack. The following
    screenshot shows an example of a detailed stack:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你将看到选定 CloudFormation 堆栈的详细信息。以下截图显示了堆栈详细信息的示例：
- en: '![](img/00022.jpeg)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00022.jpeg)'
- en: 'Figure 2.9: Getting details from the stack'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.9：从堆栈获取详细信息
- en: AWS CloudFormation creates all the resources that you have already defined in
    the template file.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: AWS CloudFormation 会创建你在模板文件中定义的所有资源。
- en: In our demo, we create Amazon S3\. We can verify it by opening the Amazon S3
    management console at [https://console.aws-amazon.com/s3](https://console.aws-amazon.com/s3).
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们的演示中，我们创建了 Amazon S3。你可以通过打开 Amazon S3 管理控制台在 [https://console.aws-amazon.com/s3](https://console.aws-amazon.com/s3)
    来验证它。
- en: 'On the Amazon S3 management console, you should see a bucket with the name
    that is defined in your CloudFormation stack, as shown in the following screenshot:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Amazon S3 管理控制台中，你应该能看到一个名为你在 CloudFormation 堆栈中定义的名称的桶，如以下截图所示：
- en: '![](img/00023.jpeg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00023.jpeg)'
- en: 'Figure 2.10: A S3 bucket was created in AWS CloudFormation'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.10：在 AWS CloudFormation 中创建了 S3 桶
- en: This is the end of the section on how to build AWS CloudFormation graphically
    through the CloudFormation management console.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 这是通过 CloudFormation 管理控制台图形化构建 AWS CloudFormation 的部分内容结束。
- en: Next, we will work through a similar scenario using the AWS CLI.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将通过 AWS CLI 完成一个类似的操作场景。
- en: Implementing a CloudFormation project using the AWS CLI
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 AWS CLI 实现 CloudFormation 项目
- en: In this section, we'll explore how to work with the AWS CLI on CloudFormation.
    In the previous section, we built and deployed CloudFormation graphically through
    the CloudFormation management console. We will perform a similar action to build
    and deploy CloudFormation using the AWS CLI.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨如何在 CloudFormation 中使用 AWS CLI。在上一节中，我们通过 CloudFormation 管理控制台图形化地构建并部署了
    CloudFormation。我们将进行类似的操作，通过 AWS CLI 构建并部署 CloudFormation。
- en: Let's explore!
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始探索吧！
- en: Setting up the AWS Command Line Interface (CLI)
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 AWS 命令行界面（CLI）
- en: 'The AWS CLI is a tool from Amazon for managing Amazon AWS in Terminal mode.
    We manage all AWS resources from this Terminal. This tool supports Windows, Linux,
    and macOS. If you work with the Windows platform, you can download this tool from
    the following website, selecting your Windows version:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: AWS CLI 是 Amazon 提供的一个工具，用于在终端模式下管理 Amazon AWS。我们通过这个终端管理所有的 AWS 资源。该工具支持 Windows、Linux
    和 macOS。如果你使用 Windows 平台，可以从以下网站下载此工具，并选择你的 Windows 版本：
- en: Windows 64-bit: [https://s3.amazonaws.com/aws-cli/AWSCLI64.msi](https://s3.amazonaws.com/aws-cli/AWSCLI64.msi)
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 64 位: [https://s3.amazonaws.com/aws-cli/AWSCLI64.msi](https://s3.amazonaws.com/aws-cli/AWSCLI64.msi)
- en: Windows 32-bit: [https://s3.amazonaws.com/aws-cli/AWSCLI32.msi](https://s3.amazonaws.com/aws-cli/AWSCLI32.msi)
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 32 位: [https://s3.amazonaws.com/aws-cli/AWSCLI32.msi](https://s3.amazonaws.com/aws-cli/AWSCLI32.msi)
- en: 'For Linux and Mac, you can install the AWS CLI through `pip` with the Python
    runtime. Type the following command:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Linux 和 Mac，你可以通过 Python 运行时使用 `pip` 安装 AWS CLI。请输入以下命令：
- en: '[PRE2]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If you want to upgrade your AWS CLI through `pip`, type the following command:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想通过 `pip` 升级 AWS CLI，请输入以下命令：
- en: '[PRE3]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'If you have installed or upgraded the CLI already, you can verify AWS CLI by
    checking its version. Type the following command in the Terminal:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经安装或升级了 CLI，可以通过检查其版本来验证 AWS CLI。请输入以下命令：
- en: '[PRE4]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You should see the AWS CLI version. For instance, you can see my AWS CLI version
    in the following screenshot:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该能看到 AWS CLI 的版本。例如，你可以在以下截图中看到我的 AWS CLI 版本：
- en: '![](img/00024.jpeg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00024.jpeg)'
- en: 'Figure 2.11: Checking the AWS CLI version'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.11：检查 AWS CLI 版本
- en: 'To configure the AWS CLI with your current AWS account, type the following
    command:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用当前的 AWS 账户配置 AWS CLI，请输入以下命令：
- en: '[PRE5]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You should prepare all the required access and secret keys. I recommend reading
    the guidelines on this at [https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该准备好所有必要的访问密钥和秘密密钥。我建议阅读关于此内容的指南，网址是 [https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html)。
- en: The next step is to configure security access on the AWS CLI to enable working
    with CloudFormation.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是配置 AWS CLI 的安全访问，以便与 CloudFormation 一起使用。
- en: Configuring security access for CloudFormation
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 CloudFormation 的安全访问
- en: To work with CloudFormation from the AWS CLI, we need to configure our security
    access and rights. In this demo, we will build and deploy CloudFormation with
    Amazon S3, so we need to configure security settings for CloudFormation and Amazon
    S3 on the AWS CLI.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 要通过 AWS CLI 使用 CloudFormation，我们需要配置安全访问和权限。在本演示中，我们将使用 Amazon S3 来构建和部署 CloudFormation，因此我们需要在
    AWS CLI 中配置 CloudFormation 和 Amazon S3 的安全设置。
- en: 'The following are the steps for adding security access to CloudFormation and
    Amazon S3:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是为 CloudFormation 和 Amazon S3 添加安全访问的步骤：
- en: Open a browser and navigate to the AWS IAM management console at [https://console.aws.amazon.com/iam](https://console.aws.amazon.com/iam).
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并访问 AWS IAM 管理控制台 [https://console.aws.amazon.com/iam](https://console.aws.amazon.com/iam)。
- en: 'Once you''re at the IAM management console, click on the Policies option in
    the left-hand menu. You should see the screen shown in the following screenshot:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦进入 IAM 管理控制台，在左侧菜单中点击“Policies”选项。你应该看到如下截图：
- en: '![](img/00025.jpeg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00025.jpeg)'
- en: 'Figure 2.12: Add a new policy for CloudFormation'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.12：为 CloudFormation 添加新策略
- en: Now, create a custom policy for CloudFormation.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，创建一个用于 CloudFormation 的自定义策略。
- en: Click on Create policy, which is indicated by the arrow in *Figure 2.12*. Then,
    you should have a policy form, as shown in *Figure 2.13*.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“Create policy”，如*图 2.12*中的箭头所示。然后，你应该看到一个策略表单，如*图 2.13*所示。
- en: 'We will add policy scripts in JSON format, so click on the JSON tab on the
    creation form, as shown in the following screenshot:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将以 JSON 格式添加策略脚本，所以在创建表单中点击 JSON 标签页，如下截图所示：
- en: '![](img/00026.jpeg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00026.jpeg)'
- en: Figure 2.13: Adding a policy to access CloudFormation resources
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.13：添加访问 CloudFormation 资源的策略
- en: 'In this scenario, we give full access to CloudFormation. You can write these
    scripts and paste them to the JSON tab shown in *Figure 2.13*:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这种情况下，我们给予 CloudFormation 完全访问权限。你可以编写这些脚本并将其粘贴到 *图 2.13*中显示的 JSON 标签页：
- en: '[PRE6]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Once you have pasted the scripts, you can click on the Review policy button
    and you should see the form shown in *Figure 2.14*.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦粘贴了脚本，你可以点击“Review policy”按钮，应该看到如*图 2.14*所示的表单。
- en: 'Fill in the name and description of your policy. For instance, the name of
    the review policy in the following screenshot is `AWSCloudFormationLRW`:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写你的策略名称和描述。例如，以下截图中的审查策略名称为 `AWSCloudFormationLRW`：
- en: '![](img/00027.jpeg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00027.jpeg)'
- en: 'Figure 2.14: Fill in the policy name and description'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.14：填写策略名称和描述
- en: Once done, click on Create policy to start creating a policy. Now, we continue
    by adding that policy to our account.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，点击“Create policy”开始创建策略。接下来，我们继续将该策略添加到我们的账户中。
- en: Click on the Users section in the menu on the left and select the user account
    that is used in the AWS CLI.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧菜单中点击“Users”部分，选择在 AWS CLI 中使用的用户账户。
- en: 'In the Summary section of your IAM user, you should have the following screenshot:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的 IAM 用户摘要部分，你应该看到以下截图：
- en: '![](img/00028.jpeg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00028.jpeg)'
- en: 'Figure 2.15: Adding a policy to a user'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.15：将策略添加到用户
- en: To add your own policy to your IAM account, click on Add permissions on the
    Permissions tab; see *Figure 2.15*. You should then see the screen shown in *Figure
    2.16*.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将你自己的策略添加到 IAM 账户中，点击权限标签页中的“Add permissions”；请参见*图 2.15*。然后，你应该看到如*图 2.16*所示的屏幕。
- en: Select the Attach existing policies directly option in the Grant permissions
    section and type your policy name, for instance, `AWSCloudFormationLRW`.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在授予权限部分选择“直接附加现有策略”选项，并输入你的策略名称，例如`AWSCloudFormationLRW`。
- en: 'You should see your own policy. Click on it, as shown in the following screenshot:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该能看到你自己的策略。点击它，如以下截图所示：
- en: '![](img/00029.jpeg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00029.jpeg)'
- en: 'Figure 2.16: Adding permissions from your own policy'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.16：从你自己的策略中添加权限
- en: After selecting your policy, click on Next:Review at the bottom. Now you should
    see the form shown in *Figure 2.17*.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择完策略后，点击底部的 Next:Review。现在你应该看到如*图 2.17*所示的表单。
- en: 'Once done, click on Add permissions to add that policy to your IAM account:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，点击“Add permissions”将该策略添加到你的 IAM 账户：
- en: '![](img/00030.jpeg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00030.jpeg)'
- en: 'Figure 2.17: Confirmation of adding permission'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.17：确认添加权限
- en: Now, your IAM user has a CloudFormation policy with full access.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你的 IAM 用户拥有完整访问权限的 CloudFormation 策略。
- en: Using the same approach, we also need to add the AmazonS3FullAccess policy to
    your IAM account.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用相同的方法，我们还需要将 AmazonS3FullAccess 策略添加到你的 IAM 账户中。
- en: 'Add an existing policy with AmazonS3FullAccess, as shown in the following screenshot:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加现有的 AmazonS3FullAccess 策略，如以下截图所示：
- en: '![](img/00031.jpeg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00031.jpeg)'
- en: 'Figure 2.18: Adding the AmazonS3FullAccess policy to a user'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.18：将 AmazonS3FullAccess 策略添加到用户
- en: Select the AmazonS3FullAccess policy and then add it to your IAM user.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 AmazonS3FullAccess 策略，然后将其添加到你的 IAM 用户。
- en: 'Once done, your IAM should have CloudFormation and AmazonS3FullAccess policies,
    as shown in the following screenshot:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，你的 IAM 应该拥有 CloudFormation 和 AmazonS3FullAccess 策略，如下截图所示：
- en: '![](img/00032.jpeg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00032.jpeg)'
- en: 'Figure 2.19: CloudFormation and Amazon S3 policies have been added'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.19：CloudFormation 和 Amazon S3 策略已被添加
- en: Now, your IAM user has CloudFormation and AmazonS3FullAccess policies. Now,
    you can manage CloudFormation from the AWS CLI.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你的IAM用户拥有CloudFormation和AmazonS3FullAccess权限。现在，你可以通过AWS CLI管理CloudFormation。
- en: The next step is to build CloudFormation and then deploy it to AWS CloudFormation.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是构建CloudFormation并将其部署到AWS CloudFormation。
- en: Building and deploying CloudFormation
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建和部署CloudFormation
- en: In this section, we will use the AWS CLI to deploy AWS CloudFormation. To work
    with CloudFormation in the AWS CLI, we need to know some CloudFormation commands.
    You can find all the commands for CloudFormation at [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我们将使用AWS CLI部署AWS CloudFormation。要在AWS CLI中使用CloudFormation，我们需要了解一些CloudFormation命令。你可以在[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html)找到所有CloudFormation命令。
- en: We will use the same template as in the first demo, `hello-cloudformation.json`.
    We will upload this template to CloudFormation and then deploy it.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用与第一个示例相同的模板，`hello-cloudformation.json`。我们将把这个模板上传到CloudFormation并进行部署。
- en: 'Now open the Terminal and navigate to the directory where `hello-cloudformation.json`
    is located. To create a stack, we can use the `cloudformation create-stack` command.
    Type the following command to upload the template and create a stack:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 现在打开终端并导航到`hello-cloudformation.json`文件所在的目录。要创建堆栈，我们可以使用`cloudformation create-stack`命令。输入以下命令上传模板并创建堆栈：
- en: '[PRE7]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The preceding command is explained as follows:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令的解释如下：
- en: '`--stack-name mystackcli1`: This defines the stack name. In this case, the
    stack name is `mystackcli1`.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--stack-name mystackcli1`：这定义了堆栈名称。在此情况下，堆栈名称为`mystackcli1`。'
- en: '`--template-body file://./hello-cloudformation.json`: This is a template file.
    You should use `file://` with the full template file path. In this demo, Terminal
    has already been navigated to a directory where the `./hello-cloudformation.json` file
    is located.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--template-body file://./hello-cloudformation.json`：这是一个模板文件。你应当使用`file://`并指定完整的模板文件路径。在本示例中，终端已导航至包含`./hello-cloudformation.json`文件的目录。'
- en: '`--debug`: This is a parameter to enable verbosity so we can see all the verbose
    messages from the CLI.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--debug`：这是一个启用详细信息的参数，帮助我们查看CLI的所有详细消息。'
- en: For information about the CloudFormation `create-stack` command, I recommend
    you read the document at: [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html).
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 关于CloudFormation `create-stack`命令的信息，我建议你阅读以下文档：[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html)。
- en: 'If this operation is executed successfully, you should get StackId on the Terminal.
    You can see my program output in the following screenshot:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 如果此操作成功执行，你应该在终端中看到StackId。你可以看到我程序输出的以下截图：
- en: '![](img/00033.jpeg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00033.jpeg)'
- en: 'Figure 2.20: Creating a CloudFormation solution using the AWS CLI'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.20：使用AWS CLI创建CloudFormation解决方案
- en: 'To verify your operation is complete, you can use the `list-stacks` command
    from the CloudFormation CLI. For further information about the `list-stacks` command,
    go to [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stacks.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stacks.html).
    Now, type the following command:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证操作是否完成，你可以使用CloudFormation CLI中的`list-stacks`命令。有关`list-stacks`命令的更多信息，请访问[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stacks.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stacks.html)。现在，输入以下命令：
- en: '[PRE8]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'You should see a status from the stack operation, as you can see in the following
    screenshot, for example. A stack status can be found in the StackStatus option,
    which is indicated by the rectangle:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该能看到堆栈操作的状态，如下图所示。例如，堆栈状态可以在`StackStatus`选项中找到，该选项由矩形框标出：
- en: '![](img/00034.jpeg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00034.jpeg)'
- en: 'Figure 2.21: Showing all CloudFormation stacks from the CLI'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.21：从CLI显示所有CloudFormation堆栈
- en: 'We can also find out stack details using the `describe-stacks` command by passing
    in the stack name. Information about the `describe-stacks` command can be found
    at [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html).
    For the demo, I want to see the details of the stack with the name `mystackcli1`:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以通过传入堆栈名称，使用`describe-stacks`命令来查看堆栈的详细信息。有关`describe-stacks`命令的信息可以在[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html)找到。对于演示，我想查看名为`mystackcli1`的堆栈的详细信息：
- en: '[PRE9]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'After execution, you should see the stack status in the StackStatus option,
    as shown in the following screenshot:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 执行后，你应该可以在堆栈状态选项中看到堆栈状态，如下图所示：
- en: '![](img/00035.jpeg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00035.jpeg)'
- en: 'Figure 2.22: Checking the stack status through the CLI'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.22：通过CLI检查堆栈状态
- en: 'If the status of the stack is CREATE_COMPLETE, stack creation has succeeded.
    You can verify this on the CloudFormation management console. Select the region
    used by your AWS CLI. The following screenshot shows that my stack was created
    by the AWS CLI:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 如果堆栈的状态是CREATE_COMPLETE，则表示堆栈创建成功。你可以在CloudFormation管理控制台中验证这一点。选择你在AWS CLI中使用的区域。以下截图显示了我的堆栈是通过AWS
    CLI创建的：
- en: '![](img/00036.jpeg)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00036.jpeg)'
- en: 'Figure 2.23: A CloudFormation stack has been created from the AWS CLI'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.23：一个通过AWS CLI创建的CloudFormation堆栈
- en: This is the end of the section on how to create a CloudFormation stack using
    the AWS CLI. Next, we will modify an existing CloudFormation stack.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍了如何使用AWS CLI创建CloudFormation堆栈。接下来，我们将修改一个现有的CloudFormation堆栈。
- en: Editing a CloudFormation project
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编辑一个CloudFormation项目
- en: In this section, we will update our CloudFormation project. For a simple update
    scenario, we will modify a bucket name from Amazon S3\. We will modify the CloudFormation
    template and then apply this template to the CloudFormation server.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将更新我们的CloudFormation项目。对于一个简单的更新场景，我们将修改Amazon S3中的存储桶名称。我们将修改CloudFormation模板，然后将此模板应用于CloudFormation服务器。
- en: We will perform project updates using the CloudFormation management console
    and the AWS CLI. Each method will be explained in the next section.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用CloudFormation管理控制台和AWS CLI来执行项目更新。每种方法将在下一节中进行说明。
- en: Editing CloudFormation using the management console
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用管理控制台编辑CloudFormation
- en: We will modify an existing CloudFormation stack. For a simple scenario, we will
    change a bucket title on Amazon S3\. We will use the modified template file, `hello-cloudformation-v2.json`,
    from the previous demo.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将修改一个现有的CloudFormation堆栈。对于一个简单的场景，我们将更改Amazon S3中的存储桶标题。我们将使用之前演示中修改过的模板文件`hello-cloudformation-v2.json`。
- en: 'The following are the steps for modifying an existing stack using the CloudFormation
    management console:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是使用CloudFormation管理控制台修改现有堆栈的步骤：
- en: Open a browser and navigate to AWS CloudFormation at [https://console.aws.amazon.com/cloudformation/](https://console.aws.amazon.com/cloudformation/).
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并导航到AWS CloudFormation，网址是[https://console.aws.amazon.com/cloudformation/](https://console.aws.amazon.com/cloudformation/)。
- en: On the AWS CloudFormation dashboard, select the stack that you want to modify.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在AWS CloudFormation仪表板中，选择要修改的堆栈。
- en: 'Then, click on Actions and select the Update Stack option from the sub-menu.
    You can see this in the following screenshot:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击“操作”并从子菜单中选择“更新堆栈”选项。你可以在下图中看到这一点：
- en: '![](img/00037.jpeg)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00037.jpeg)'
- en: 'Figure 2.24: Editing a selected stack in the CloudFormation management console'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.24：在CloudFormation管理控制台中编辑选定的堆栈
- en: After selecting a stack for editing, select the Upload a template to Amazon
    S3 option.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择要编辑的堆栈后，选择“上传模板到Amazon S3”选项。
- en: 'Click on the Next button to read the CloudFormation template. You should now
    see the following screen:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“下一步”按钮以读取CloudFormation模板。你现在应该看到以下屏幕：
- en: '![](img/00038.jpeg)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00038.jpeg)'
- en: 'Figure 2.25: Uploading an updated template'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.25：上传更新后的模板
- en: Upload the updated template, for instance, `hello-cloudformation-v2.json`. When
    done, click on the Next button.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上传更新后的模板，例如`hello-cloudformation-v2.json`。完成后，点击“下一步”按钮。
- en: CloudFormation will check your template. If the content of the template file
    is similar, CloudFormation will not perform the next process.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: CloudFormation会检查你的模板。如果模板文件的内容相似，CloudFormation将不会执行下一步操作。
- en: 'If there is a change, CloudFormation will continue the process. You should
    see the screen shown in *Figure 2.26*. We can''t change the stack name. Now, click
    on the Next button:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果有更改，CloudFormation将继续该过程。你应该能看到如*图 2.26*所示的屏幕。我们不能更改堆栈名称。现在，点击“Next”按钮：
- en: '![](img/00039.jpeg)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00039.jpeg)'
- en: 'Figure 2.26: Showing a stack for updating'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.26：显示待更新的堆栈
- en: 'You should now see the screen shown in *Figure 2.27*. Change your stack options
    and click on the Next button:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你现在应该能看到如*图 2.27*所示的屏幕。修改你的堆栈选项，然后点击“Next”按钮：
- en: '![](img/00040.jpeg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00040.jpeg)'
- en: 'Figure 2.27: Setting options for a stack'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.27：设置堆栈的选项
- en: 'You should now see the review screen, as shown in *Figure 2.28*. Check all
    your changes and click on Update to deploy the changes to CloudFormation:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你现在应该能看到如*图 2.28*所示的审查屏幕。检查所有更改并点击“Update”以将更改部署到CloudFormation：
- en: '![](img/00041.jpeg)'
  id: totrans-191
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00041.jpeg)'
- en: 'Figure 2.28: Reviewing all changes before deploying'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.28：在部署前审查所有更改
- en: CloudFormation will apply all changes to your stack. You can see the progress
    of the process in the Status column on the Stacks dashboard.
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: CloudFormation将应用所有更改到你的堆栈。你可以在堆栈仪表板的状态列中查看进度。
- en: 'Once done, you should see UPDATE_COMPLETE in the Status column, as shown in
    the following screenshot:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，你应该在状态列中看到UPDATE_COMPLETE，如下图所示：
- en: '![](img/00042.jpeg)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00042.jpeg)'
- en: 'Figure 2.29: Stack update is complete'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.29：堆栈更新完成
- en: This is the end of the section on editing a CloudFormation stack using the management
    console. Next, we will perform the same process using the AWS CLI.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 这是关于使用管理控制台编辑CloudFormation堆栈的部分的结尾。接下来，我们将使用AWS CLI执行相同的过程。
- en: Editing CloudFormation using the AWS CLI
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用AWS CLI编辑CloudFormation
- en: In this section, we will focus on editing an existing CloudFormation stack using
    the AWS CLI. We have the modified template file, `hello-cloudformation-v2.json`.
    We will update an existing CloudFormation stack by replacing it with the `hello-cloudformation-v2.json`
    file.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将重点介绍如何使用AWS CLI编辑现有的CloudFormation堆栈。我们有修改过的模板文件`hello-cloudformation-v2.json`。我们将通过将其替换为`hello-cloudformation-v2.json`文件来更新现有的CloudFormation堆栈。
- en: 'Now open the Terminal and navigate to the directory where `hello-cloudformation-v2.json`
    is located. To update a stack, we can use `cloudformation update-stack`. Type
    the following command to upload the template and create a stack:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 现在打开终端并导航到`hello-cloudformation-v2.json`文件所在的目录。要更新堆栈，我们可以使用`cloudformation
    update-stack`命令。输入以下命令以上传模板并创建堆栈：
- en: '[PRE10]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The preceding command is explained as follows:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令解释如下：
- en: '`--stack-name mystackcli1`: This is the stack that will be updated. In this
    case, the stack name is `mystackcli1`.'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--stack-name mystackcli1`：这是将要更新的堆栈。在本例中，堆栈名称为`mystackcli1`。'
- en: '`--template-body file://./hello-cloudformation-v2.json`: This is a changed
    template file. You should use `file://` with the full template file path. In this
    demo, Terminal has already been navigated to the directory where the `./hello-cloudformation-v2.json` file
    is located.'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--template-body file://./hello-cloudformation-v2.json`：这是已更改的模板文件。你应该使用`file://`与完整的模板文件路径。在本演示中，终端已经导航到包含`./hello-cloudformation-v2.json`文件的目录。'
- en: '`--debug`: This is a parameter to enable verbosity, so we can see all verbose
    messages from the CLI.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--debug`：这是一个启用详细信息的参数，因此我们可以看到CLI的所有详细消息。'
- en: For further information about the CloudFormation `update-stack` command, I recommend
    reading the document at [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 关于CloudFormation `update-stack`命令的更多信息，建议阅读[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html)文档。
- en: 'If this operation is executed successfully, you can check the current operation
    status using the `describe-stacks` command. Type the following command:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 如果此操作成功执行，你可以使用`describe-stacks`命令检查当前操作状态。输入以下命令：
- en: '[PRE11]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'You should see the status of the StackStatus option, as shown in the following
    screenshot:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该能看到如以下截图所示的堆栈状态选项：
- en: '![](img/00043.jpeg)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00043.jpeg)'
- en: 'Figure 2.30: Editing a CloudFormation stack from the CLI'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.30：从CLI编辑CloudFormation堆栈
- en: If successful, you should see the changes on CloudFormation and the AWS resources
    that you have modified.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果成功，你应该能够看到CloudFormation和你已修改的AWS资源上的更改。
- en: In the next section, we will learn how to delete an existing CloudFormation
    project.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一部分，我们将学习如何删除现有的CloudFormation项目。
- en: Deleting a CloudFormation project
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除CloudFormation项目
- en: If you don't use a CloudFormation stack, you can remove it from CloudFormation.
    Since you are probably charged for all of the AWS resources that you use, I recommend
    removing all resources related to the CloudFormation stack. We can also remove
    a CloudFormation stack because of a design error in IaC. Removing a CloudFormation
    stack will delete all the resources related to that stack.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不再使用CloudFormation堆栈，可以在CloudFormation中删除它。由于您可能会因使用的所有AWS资源而收费，建议删除与CloudFormation堆栈相关的所有资源。我们还可以因为基础架构代码设计错误而删除CloudFormation堆栈。删除CloudFormation堆栈将删除与该堆栈相关的所有资源。
- en: In this section, we will learn how to remove a CloudFormation stack using the
    management console and the AWS CLI.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习如何使用管理控制台和AWS CLI删除CloudFormation堆栈。
- en: Deleting CloudFormation using the management console
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用管理控制台删除CloudFormation
- en: If you want to delete your CloudFormation stack, you can visit the CloudFormation
    management console, where you should see your CloudFormation stacks.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想要删除CloudFormation堆栈，可以访问CloudFormation管理控制台，在那里您应该看到您的CloudFormation堆栈。
- en: 'To remove a CloudFormation stack, select the stack to be removed. Then, click
    on Actions and you should see the menu shown in the following screenshot. Select
    the Delete Stack option to delete the selected stack:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除CloudFormation堆栈，请选择要删除的堆栈。然后，点击Actions，您应该看到如下截图所示的菜单。选择Delete Stack选项以删除所选的堆栈：
- en: '![](img/00044.jpeg)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00044.jpeg)'
- en: 'Figure 2.31: Deleting a stack'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.31：删除堆栈
- en: 'After selecting the Delete Stack option from the menu, you should see a confirmation
    dialog, as shown in the following screenshot. Click on Yes, Delete to continue
    the deletion of the stack:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 从菜单中选择删除堆栈选项后，您应该看到一个确认对话框，如下截图所示。点击Yes, Delete继续删除堆栈：
- en: '![](img/00045.jpeg)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00045.jpeg)'
- en: 'Figure 2.32: Confirmation for deleting a stack'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.32：删除堆栈的确认
- en: Once done, your CloudFormation stack is deleted, including all the AWS resources
    that were used in your stack.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，您的CloudFormation堆栈将被删除，包括堆栈中使用的所有AWS资源。
- en: Next, we will perform this operation through the AWS CLI.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将通过AWS CLI执行此操作。
- en: Deleting CloudFormation Stack using the AWS CLI
  id: totrans-227
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用AWS CLI删除CloudFormation堆栈
- en: If you prefer to delete a CloudFormation stack through the AWS CLI, you can
    use `delete-stack` from CloudFormation. You can find this command at [https://docs.aws.amazon.com/cli/latest/reference/cloudformation/delete-stack.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/delete-stack.html).
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望通过AWS CLI删除CloudFormation堆栈，可以使用CloudFormation中的`delete-stack`。您可以在[https://docs.aws.amazon.com/cli/latest/reference/cloudformation/delete-stack.html](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/delete-stack.html)找到此命令。
- en: 'To delete a CloudFormation stack, you can use the `delete-stack` command by
    passing in your stack name. For instance, to delete the CloudFormation stack named `mystackcli1`,
    type the following command:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除CloudFormation堆栈，可以使用`delete-stack`命令，并传入您的堆栈名称。例如，要删除名为`mystackcli1`的CloudFormation堆栈，请输入以下命令：
- en: '[PRE12]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'If you want to get a verbose message, you can add the  `--debug` parameter
    to the command. My program output can be seen in the following screenshot:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想获取详细消息，可以在命令中添加`--debug`参数。我的程序输出可见下面的截图：
- en: '![](img/00046.jpeg)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00046.jpeg)'
- en: 'Figure 2.33: Deleting a stack from the CLI'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.33：从CLI中删除堆栈
- en: 'To verify your deleted stack, you can use the `describe-stacks` command by
    passing in your stack name. For instance, for the stack name `mystackcli1`, type
    the following command:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证已删除的堆栈，您可以使用`describe-stacks`命令，并传入您的堆栈名称。例如，对于堆栈名称`mystackcli1`，请输入以下命令：
- en: '[PRE13]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'A sample of the program output can be seen in the following screenshot:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 程序输出的示例可见下面的截图：
- en: '![](img/00047.jpeg)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00047.jpeg)'
- en: 'Figure 2.34: Checking a stack and the deletion process status from the CLI'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.34：从CLI检查堆栈和删除过程状态
- en: We have now reached the end of this chapter, having learned how to build and
    deploy a CloudFormation project on Amazon AWS.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经学习完本章内容，学会了如何在Amazon AWS上构建和部署一个CloudFormation项目。
- en: Summary
  id: totrans-240
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: We learned how to build a simple CloudFormation project utilizing Amazon S3\.
    We built a CloudFormation project using the CloudFormation management console
    and the AWS CLI. The demo operations included creating, editing, and deleting.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 我们学习了如何利用Amazon S3构建一个简单的CloudFormation项目。我们使用CloudFormation管理控制台和AWS CLI构建了一个CloudFormation项目。演示操作包括创建、编辑和删除。
- en: In the next chapter, we will learn how to build AWS CloudFormation templates.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何构建AWS CloudFormation模板。
- en: Questions
  id: totrans-243
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: What is a CloudFormation stack?
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么是 CloudFormation 堆栈？
- en: What are the benefits of building CloudFormation using the management console?
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理控制台构建 CloudFormation 有什么好处？
- en: What are the advantages of building CloudFormation using the AWS CLI?
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 AWS CLI 构建 CloudFormation 有什么优势？
