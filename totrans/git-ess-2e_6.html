<html><head></head><body>
        

                            
                    <h1 class="header-title">Migrating to Git</h1>
                
            
            
                
<p>You often come to Git after using other versioning systems; there are many different VCS in the world but one of the most popular is <strong>Subversion</strong>, for sure.</p>
<p>Git and Subversion can coexist, as Git has some dedicated commands for exchanging data with Subversion.</p>
<p>The purpose of this chapter is to help developers who actually use Subversion to start using Git instantly, even if the rest of the team will continue to use Subversion.</p>
<p>In addition, the chapter covers definitive migration and preserving the changes' history for people who decide to abandon Subversion in favor of Git.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Before starting</h1>
                
            
            
                
<p>In this first part of the chapter, we will take a look at best practices to maintain safety and work on actual SVN repository with no hassles.</p>
<p>Bear in mind that the purpose of this chapter is only to give readers some hints; dealing with big and complex repositories deserves a more prudent and articulated approach.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing a Subversion client</h1>
                
            
            
                
<p>To be able to do these experiments, you need a Subversion tool; on Windows, the most widely used is the well-known <strong>TortoiseSVN</strong> (<a href="http://tortoisesvn.net/">http://tortoisesvn.net</a>), which provides command-line tools to both GUI and shell integration.</p>
<p>I recommend a full installation of TortoiseSVN, including command-line tools, as we'll need some of them to make experiments.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Working on a Subversion repository using Git</h1>
                
            
            
                
<p>In the first part, we will see the most cautious approach when starting to move away from Subversion, which is to keep the original repository, using Git to fetch and push changes.<br/>
For the purpose of learning, we will create a local Subversion repository, using both Subversion and Git to access to its contents.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a local Subversion repository</h1>
                
            
            
                
<p>Without the hassle of remote servers, let's create a local Subversion repository as a container for our experiments:</p>
<pre><strong>$ cd C:\Repos</strong>
<strong>$ svnadmin create MySvnRepo</strong></pre>
<p>Nothing more, nothing less; the repository is now ready to be filled with folders and files.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Checking out the Subversion repository with the svn client</h1>
                
            
            
                
<p>At this point, we have a working Subversion repository; we can now check it out in a folder of our choice, which will become our <em>working copy</em>; in my case, I will use the <kbd>C:\Sources</kbd> folder:</p>
<pre><strong>$ cd C:\Sources\svn</strong>
<strong>$ svn checkout file:///Repos/MySvnRepo</strong></pre>
<p>You now have a <kbd>MySvnRepo</kbd> folder under your <kbd>Sources</kbd> folder, ready to be filled with your project files; but first, let me remind you of a couple of things.</p>
<p>As you may know, a Subversion repository generally has the following subfolders structure:</p>
<ul>
<li><kbd>/trunk</kbd>, the main folder, where, generally, you have the code under development</li>
<li><kbd>/tags</kbd>, the root folder of the snapshots you usually freeze and leave untouched, for example, <kbd>/tags/v1.0</kbd></li>
<li><kbd>/branches</kbd>, the root folder of all the repository branches you will create for features development, for example, <kbd>/branches/NewDesign</kbd></li>
</ul>
<p>Subversion does not provide a command to initialize a repository with this layout (commonly known as <em>standard layout</em>), so we have to build it up by hand.<br/>
At this point, we can import a skeleton folder that already contains the three subfolders (<kbd>/trunk</kbd>, <kbd>/branches</kbd> and <kbd>/tags</kbd>), with a command like this:</p>
<pre><strong>$ cd \Sources\svn\MySvnRepo</strong>
<strong>$ svn import /path/to/some/skeleton/dir</strong></pre>
<p>Otherwise, we can create folders by hand using the <kbd>svn mkdir</kbd> command:</p>
<pre><strong>$ cd \Sources\svn\MySvnRepo</strong>
<strong>$ svn mkdir trunk</strong>
<strong>$ svn mkdir tags</strong>
<strong>$ svn mkdir branches</strong>  </pre>
<p>Commit the folders we just created and the repository is ready:</p>
<pre><strong>svn commit -m "Initial layout"</strong>  </pre>
<p>Now, add and commit the first file:</p>
<pre><strong>$ cd trunk</strong>
<strong>$ echo "This is a Subversion repo" &gt; readme.txt</strong>
<strong>$ svn add readme.txt</strong>
<strong>$ svn commit -m "Readme file"</strong></pre>
<p>Feel free to add even more files, or import an existing project if you want to replicate a more real situation; to import files in a Subversion repository, you can use the <kbd>svn import</kbd> command, as we already have seen before:</p>
<pre><strong>$ svn import \MyProject\Folder</strong></pre>
<p>Later, we will add a <em>tag</em> and a <em>branch</em> to verify how Git interacts with them.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Cloning a Subversion repository from Git</h1>
                
            
            
                
<p>Git provides a set of tools for cooperating with Subversion; the base command is actually <kbd>git svn</kbd>; with <kbd>git svn</kbd>, you can clone Subversion repositories, retrieve and upload changes, and more.</p>
<p>So, wear the Git hat and clone the Subversion repository using the <kbd>git svn clone</kbd> command:</p>
<pre><strong>$ cd \Sources\git</strong>
<strong>$ git svn clone file:///c/Repos/MySvnRepo</strong>  </pre>
<p>As you can see, this time I added the root drive letter <kbd>c</kbd> to the <kbd>file:///</kbd> path; in Windows, Git pretends that you provide paths starting from the drive letter.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Adding a tag and a branch</h1>
                
            
            
                
<p>Just to have a more realistic situation, I will add a tag and a branch to the Subversion repository; in this manner, we will see how to deal with them while in Git.</p>
<p>So, let's get back to adding a new file:</p>
<pre><strong>$ cd \Sources\svn\MySvnRepo\trunk</strong>
<strong>$ echo "This is the first file" &gt; svnFile01.txt</strong>
<strong>$ svn add svnFile01.txt</strong>
<strong>$ svn commit -m "Add first file"</strong>  </pre>
<p>Then, tag this snapshot of the repository as <kbd>v1.0</kbd>; as you may know, in Subversion, a tag or a branch are copy of a snapshot:</p>
<pre><strong>$ svn copy file:///Repos/MySvnRepo/trunk file:///Repos/MySvnRepo/tags/v1.0 -m "Release 1.0"</strong> </pre>
<p>Once we have a tag, we can even create a branch, supposing we want a place to add bug fixes for the release, <kbd>v1.0</kbd>:</p>
<pre><strong>$ svn copy file:///Repos/MySvnRepo/trunk file:///Repos/MySvnRepo/branches/v1.x -m "Maintenance branch for release 1.0"</strong> </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Committing a file to Subversion using Git as a client</h1>
                
            
            
                
<p>Now that we have a running clone of our original Subversion repository, we can use Git as it was a Subversion client. So, add a new file and commit it using Git:</p>
<pre><strong>$ echo "This file comes from Git" &gt;&gt; gitFile01.txt 
$ git add gitFile01.txt 
$ git commit -m "Add a file using Git"</strong> </pre>
<p>Now, we have to <em>push</em> this file to the Subversion server:</p>
<pre><strong>$ git svn dcommit</strong> </pre>
<p>Well done!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Retrieving new commits from the Subversion server</h1>
                
            
            
                
<p>We can even use Git to fetch changes with the <kbd>git svn fetch</kbd> command, or directly update the local working copy using <kbd>git svn rebase</kbd> as a Git counterpart for the <kbd>svn update</kbd> command:</p>
<pre><strong>$ git svn rebase</strong> </pre>
<p class="mce-root">Git will fetch new commits from the remote Subversion server, as per a <kbd>git pull</kbd> command; then, it will rebase them on the top of the branch you are in at the moment. Maybe you are wondering why we are using rebasing instead of merging, like the <kbd>git pull</kbd> command does by default while dealing with a Subversion remote. Using the <kbd>merge</kbd> command instead of <kbd>rebase</kbd> while applying remote commits can be harmful; in the past, Git had some troubles dealing with Subversion <kbd>svn:mergeinfo </kbd>properties (<a href="http://svnbook.red-bean.com/en/1.6/svn.ref.svn.c.mergeinfo.html">http://svnbook.red-bean.com/en/1.6/svn.ref.svn.c.mergeinfo.html</a>), and even if it supports them (<a href="https://www.git-scm.com/docs/git-svn/2.11.1#git-svn---mergeinfoltmergeinfogt">https://www.git-scm.com/docs/git-svn/2.11.1#git-svn---mergeinfoltmergeinfogt</a>) rebasing is considered a safer option.</p>
<p>Git and Subversion integration is a wide topic; for other commands and options, I recommend to read the main page <kbd>git svn --help</kbd>.</p>
<p>Using Git as a Subversion client is not the best we can obtain, but at least it is a way to start using Git even if you cannot abandon Subversion instantly.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Git with a Subversion repository</h1>
                
            
            
                
<p>Using Git as a client of Subversion can raise some confusions, due to the flexibility of Git as compared to the more rigid way Subversion organizes files.<br/>
To be sure to maintain a Subversion-friendly way of work, I recommend you follow some simple rules.</p>
<p>First of all, ensure that your Git <kbd>master</kbd> branch is related to the <kbd>trunk</kbd> one in Subversion; as we already said, Subversion users usually organize a repository in this way:</p>
<ul>
<li>A <kbd>/trunk</kbd> folder, the main one</li>
<li>A <kbd>/branches</kbd> root folder, where you put all the branches, each one located in a separated subfolder (for example, <kbd>/branches/feat-branch</kbd>)</li>
<li>A <kbd>/tags</kbd> root folder, where you collect all the tags you made (for example, <kbd>/tags/v1.0.0</kbd>)</li>
</ul>
<p>To adhere to this layout, you can use the <kbd>--stdlayout</kbd> option when cloning a Subversion repository:</p>
<pre><strong>$ git svn clone &lt;url&gt; --stdlayout</strong> </pre>
<p>In this manner, Git will hook the <kbd>/trunk</kbd> Subversion branch to the Git <kbd>master</kbd> one, then replicate all the <kbd>/branches</kbd> and <kbd>/tags</kbd> branches in your local Git repository, allowing you to work with them in a 1:1 synchronized context.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Migrating a Subversion repository</h1>
                
            
            
                
<p>When possible, it is recommended to completely migrate a Subversion repository to Git; this is quite simple to do and mostly depends on the size of the Subversion repository and the organization.</p>
<p>If the repository follows the standard layout described earlier, a migration takes only a matter of minutes.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Retrieving the list of Subversion users</h1>
                
            
            
                
<p>If your Subversion repository has been used by different people, you are probably interested in preserving commit author's names as is even in the new Git repository.<br/>
If the <kbd>awk</kbd> command is available (maybe using Git Bash shell or Cygwin while in Windows), there's a script here that fetches all the users from Subversion logs and appends them to a text file we can use in Git while cloning to perfectly match Subversion users even in Git-converted commits:</p>
<pre><strong>$ svn log -q | awk -F '|' '/^r/ {sub("^ ", "", $2); sub(" $", "", $2); print $2" = "$2" &lt;"$2"&gt;"}' | sort -u &gt; authors.txt</strong> </pre>
<p>Now, we will use the <kbd>authors.txt</kbd> file in the next cloning step.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Cloning the Subversion repository</h1>
                
            
            
                
<p>To begin the migration, we have to clone the Subversion repository locally, as we did earlier; I again recommend adding the <kbd>--stdlayout</kbd> option, to preserve branches and tags, and then to adding the <kbd>-A</kbd> option to let Git <em>convert</em> commit authors while cloning:</p>
<pre><strong>$ git svn clone &lt;repo-url&gt; --stdlayout --prefix svn/ -A authors.txt</strong> </pre>
<p>In case the Subversion repository has trunk, branches, and tags located in other paths (so not a standard layout), Git provides you with a way to specify them with the <kbd>--trunk</kbd>, <kbd>--branches</kbd> and <kbd>--tags</kbd> options:</p>
<pre><strong>$ git svn clone &lt;repo-url&gt; --trunk=&lt;trunk-folder&gt; --branches=&lt;branches-folder&gt; --tags=&lt;tags-folder&gt;</strong></pre>
<p>When you fire the <kbd>clone</kbd> command, remember that <strong>this operation can be time consuming</strong>; in a repository with a thousand commits, it is not unusual to wait for one or two quarters of an hour.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Preserving ignored files</h1>
                
            
            
                
<p>To preserve the previous ignored files in Subversion, we can append the <kbd>svn:ignore</kbd> settings to the <kbd>.gitignore</kbd> file:</p>
<pre><strong>$ git svn show-ignore &gt;&gt; .gitignore</strong>
<strong>$ git add .gitignore</strong>
<strong>$ git commit -m "Convert svn:ignore properties to .gitignore"</strong></pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Pushing to a local bare Git repository</h1>
                
            
            
                
<p>Now that we have a local copy of our repository, we can move it to a brand new Git repository. Here, you can already use a remote repository on your server of choice, even GitHub or BitBucket, but I recommend that you use a local bare repository. We may as well do some other little adjustments (such as renaming tags and branches) before pushing files to a blessed repository. So, first initialize a bare repository in a folder of choice:</p>
<pre><strong>$ mkdir \Repos\MyGitRepo.git</strong>
<strong>$ cd \Repos\MyGitRepo.git</strong>
<strong>$ git init --bare</strong></pre>
<p>Now, make the default branch to match the Subversion <kbd>trunk</kbd> branch name:</p>
<p class="mce-root">&lt;pre&gt;<strong>$ git symbolic-ref HEAD refs/heads/trunk</strong></p>
<p>Then, add a <kbd>bare</kbd> remote pointing to the bare repository we just created:</p>
<pre><strong>$ cd \Sources\MySvnRepo</strong>
<strong>$ git remote add bare file:///C/Repos/MyGitRepo.git</strong></pre>
<p>Finally, push the local cloned repository to the new bare one:</p>
<pre><strong>$ git push --all bare</strong></pre>
<p>We have now a brand new bare repository that is a perfect copy of the original Subversion one. We can now adjust branches and tags to fit the Git usual layout better.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Arrange branches and tags</h1>
                
            
            
                
<p>Now, we can rename branches and tags to obtain a more Git-friendly scenario.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Renaming trunk branch to master</h1>
                
            
            
                
<p>Subversion main development branch is <kbd>/trunk</kbd>, but in Git, you know, we prefer to call the main branch <kbd>master</kbd>; here's a way to rename it:</p>
<pre><strong>$ git branch -m trunk master</strong> </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Converting Subversion tags to Git tags</h1>
                
            
            
                
<p>Subversion treats tags as branches; they are all copies of a certain trunk snapshot. In Git, on the contrary, branches, and tags have different significance.<br/>
To convert Subversion tags' branches into Git tags, here's a simple script that does the work:</p>
<pre><strong>$ git for-each-ref --format='%(refname)' refs/heads/tags |</strong>
<strong>cut -d / -f 4 |</strong>
<strong>while read ref</strong>
<strong>do</strong>
<strong>  git tag "$ref" "refs/heads/tags/$ref";</strong>
<strong>  git branch -D "tags/$ref";</strong>
<strong>done</strong></pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Pushing the local repository to a remote</h1>
                
            
            
                
<p>You now have a local bare Git repository ready to be pushed to a remote server; the result of the conversion is a full Git repository, where branches, tags, and commit history have been preserved. The only thing you have to do by hand is to eventually accommodate Git users.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Comparing Git and Subversion commands</h1>
                
            
            
                
<p>In the page that follows, you can find a short and partial recap table, where I try to pair the most common Subversion and Git commands to help Subversion users shift their minds from Subversion to Git quickly.</p>
<p>Remember that Subversion and Git behave differently, so maybe comparing commands is not the best thing to do, but for Git newcomers coming from Subversion, this can help match basic Subversion to the Git counterpart while learning:</p>
<div><img height="552" width="443" class="aligncenter size-full wp-image-189 image-border" src="img/a3720c01-92ce-469c-a5d9-b2bba65385a6.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>This chapter barely scratches the surface, but I think it can be useful to get a sense of the topic. If you have wide Subversion repositories, you will probably need a better training before beginning to convert them to Git, but for small to medium ones, now you know the fundamentals to start moving away.</p>
<p>The only suggestion I want to share with you is to not be in a hurry; start letting Git cooperate with your Subversion server, reorganize the repository when it is messy, take a lot of backups, and finally, try to convert it; you will probably convert it more than once, as I did, but you will get satisfaction in the end.</p>
<p>In the next chapter, I will share with you some useful resources I found during my career as a Git user.</p>
<p class="mce-root"/>


            

            
        
    </body></html>