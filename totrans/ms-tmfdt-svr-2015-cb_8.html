<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Extending and Customizing Team Foundation Server"><div class="titlepage" id="aid-2PKKS2"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Extending and Customizing Team Foundation Server</h1></div></div></div><div class="blockquote"><table border="0" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"First, solve the problem. Then, write the code."</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution"><span class="emphasis"><em>John Johnson</em></span></span></td></tr></table></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Acquiring the TFS object model from the NuGet Gallery</li><li class="listitem">Using Team Project Picker to connect to TFS programmatically</li><li class="listitem">Determining the version of TFS using the TFS object model</li><li class="listitem">Retrieving TFS permissions programmatically using the TFS object model</li><li class="listitem">Getting the Process Template name for a Team Project programmatically</li><li class="listitem">Getting build details programmatically using the REST API</li><li class="listitem">Getting a list of Git repositories programmatically using the REST API</li><li class="listitem">Getting a Work Item by ID programmatically using the REST API</li><li class="listitem">Adding a Team field to the Product Backlog Item to an existing Team Project</li><li class="listitem">Adding multi-item select control in the Work Item form</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec87"/>Introduction</h1></div></div></div><p>TFS provides <a id="id910" class="indexterm"/>integrated tooling for software application delivery and life cycle management. It is not uncommon for organizations to have different tools for managing different parts of the life cycle, for example, Jira for Agile Project Management, TeamCity for builds, Jenkins for release management, and ServiceNow for service management. Customers expect to be able to integrate and share information between different systems. Team Foundation Server has a fairly large ecosystem of tools and services it integrates with. The following screenshot shows some of the partners from<a id="id911" class="indexterm"/> the TFS ecosystem, you can find the complete list at <a class="ulink" href="https://vsipprogram.com/Directory">https://vsipprogram.com/Directory</a>:</p><div class="mediaobject"><img src="../Images/image00836.jpeg" alt="Introduction"/></div><p style="clear:both; height: 1em;"> </p><p>It is virtually<a id="id912" class="indexterm"/> impossible to provide out-of-the-box integration with every other system; to bridge the gap, TFS provides a very rich library that allows you to retrieve, edit, update, insert, and delete data in TFS. The API makes these operations secure and auditable. Today, TFS has two extensibility technologies, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00837.jpeg" alt="Introduction"/></div><p style="clear:both; height: 1em;"> </p><p>Let's explain these two extensibility technologies in detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>The TFS object model</strong></span>: The TFS object model supports both .NET and Java platforms and has been offered in<a id="id913" class="indexterm"/> the product from as early as TFS 2005. The object model library has been enriched with more functionality over releases. Extensions built using the object model can be integrated into Visual Studio and Team Explorer or can be used as standalone tools. The object model has the following limitations:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">It does not support Team Web Portal extensibility</li><li class="listitem">It does not support non-Windows operating systems</li><li class="listitem">It does not support client-side extensions for mobile devices</li></ul></div></li><li class="listitem"><span class="strong"><strong>The RESTful services</strong></span>: The RESTful services first debuted in TFS 2013. The RESTful services are JSON-based REST services, primarily focused on bridging the limitations of the TFS object model. The services enable Team Web Portal extensibility, extensions<a id="id914" class="indexterm"/> for non-Windows platforms, and client-side extensions for mobile devices. The RESTful services can also be called from within the TFS object model. This is quite powerful as this enables you to build extensibility for features that do not support any extension points within the TFS object model. For example, Team Rooms is a web-only feature that has no extensibility points within the TFS object model. The Team Rooms Visual Studio Extension (<a class="ulink" href="http://bit.ly/1TeNIO7">http://bit.ly/1TeNIO7</a>) has been<a id="id915" class="indexterm"/> built using the Team Rooms REST APIs with the TFS object model.</li></ul></div><p>The TFS object model <a id="id916" class="indexterm"/>and RESTful services open up limitless opportunities for extensibility. While RESTful services can be used in conjunction with TFS object model today, the RESTful services aren't quite ready for extending Team Web Portal in TFS. The RESTful services use OAuth for authentication and authorization. TFS does not have an OAuth token provisioning capability. As a work-around, it is possible to use alternate credentials for authenticating with the REST APIs. Organizations may be reluctant to<a id="id917" class="indexterm"/> enable alternate credentials since it requires basic authentication to be enabled on the instance of IIS hosting TFS. Recipes in this chapter using REST APIs have been implemented using alternate credentials. Follow the<a id="id918" class="indexterm"/> instructions here to enable alternate credentials: <a class="ulink" href="http://bit.ly/1IhEQH1">http://bit.ly/1IhEQH1</a>.</p><p>Since TFS does not have an OAuth token provisioning capability, it is not possible to build Team Web Portal extensions for TFS. The OAuth token provision capability is expected to be released in TFS 2015 in future updates. The RESTful extensibility model is the same between TFS and VSTS. Since VSTS has an OAuth token provisioning system, you can use the RESTful services in VSTS to start building extensions for Team Web Portal in VSTS. The RESTful services are the foundation to the marketplace capability recently introduced in VSTS. It is expected that this capability will be available in TFS in future updates. You can learn <a id="id919" class="indexterm"/>more about the VSTS marketplace at <a class="ulink" href="http://bit.ly/1Q6afgw">http://bit.ly/1Q6afgw</a>.</p><p>Apart from covering extensibility, we'll be learning about the possibilities of customization in TFS. TFS provides a customization framework that enables customization at the Team Project level. Customizations to Team Projects are applied through Process Templates. A Process Template is a collection of XML files that hold instructions for artifacts and the processes that need to be applied to a Team Project. To give you an example, the Process Template holds instructions for security groups, areas, iterations, Work Items, and backlogs. The template also applies the workflow and behavior these artifacts exhibit, for example, a Bug Work Item in CMMI template has a ready-for-testing state, the Bug Work Item in the Scrum Template does not. While TFS comes preloaded with the Scrum, Agile, and CMMI Process Templates, TFS supports customizing of existing Process Templates and creating new Process Templates to best meet the needs of your Team. A Process Template consists of nine plugins; each plugin executes a set of tasks during the Team Project setup. The following diagram illustrates the plugins and the object files that can be customized:</p><div class="mediaobject"><img src="../Images/image00838.jpeg" alt="Introduction"/></div><p style="clear:both; height: 1em;"> </p><p>The current Process Template structure and tooling is limited in various ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Tooling</strong></span>: To edit a Process Template, you need to install the Process Template Editor. This <a id="id920" class="indexterm"/>editor can only be installed by installing the TFS power tools (<a class="ulink" href="http://bit.ly/1jJkEmt">http://bit.ly/1jJkEmt</a>). The Process Template Editor is strongly linked to the <a id="id921" class="indexterm"/>version of TFS. The editor can only be launched via Visual Studio. The editor does not support non-Windows platforms.</li><li class="listitem"><span class="strong"><strong>Complexity</strong></span>: To edit a Process Template, you need to have good working knowledge of Process Templates<a id="id922" class="indexterm"/> and Team Projects. The Process Template Editor is rudimentary; it does not provide any validation or the means to test the changes being made.</li><li class="listitem"><span class="strong"><strong>Maintainability</strong></span>: If the Process Template for a Team Project has been modified, TFS does not upgrade that product to the latest features automatically. Features <a id="id923" class="indexterm"/>need to be manually enabled on such projects.</li></ul></div><p>To remove the limitations of the current Process Template customization tooling, a new process customization experience is being developed in Team Web Portal. The new experience will be web based to make it available on non-Windows devices. The new experience will simply modify the process by providing a rich guided experience for common tasks. The new tooling will enable Team Projects to be automatically updated with new functionality after upgrades. To enable this, all system fields in the Process Templates will be locked and won't be<a id="id924" class="indexterm"/> customizable. The new tooling has been released in preview in VSTS. You can learn more about it at <a class="ulink" href="http://bit.ly/1OxP31n">http://bit.ly/1OxP31n</a>. The new tooling is expected to be released in TFS 2015 in one of the future updates. The recipes in this chapter are based on customizing the Process Templates using the Process Template Editor.</p><p>To recap, the extensibility recipes in this chapter are based on the<a id="id925" class="indexterm"/> TFS object model and RESTful services with alternate credentials. The customization recipes in this chapter are based on the Process Template Editor. Both extensibility and<a id="id926" class="indexterm"/> customization are undergoing a great change. While the changes to both have been released in VSTS, they aren't available in TFS 2015 Update 1. These changes are expected to be available in TFS 2015 in future updates.</p></div></div>
<div class="section" title="Acquiring TFS object model from the NuGet Gallery" id="aid-2QJ5E1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec88"/>Acquiring TFS object model from the NuGet Gallery</h1></div></div></div><p>If you have used the TFS<a id="id927" class="indexterm"/> object model before, you will acknowledge that acquiring the DLLs and the dependencies is a cumbersome process. The TFS DLLs need to be picked out from the install directory. The licensing framework does not allow the distribution of these DLLs. This means anyone working with the code either needs all dependencies installed or needs to manually <a id="id928" class="indexterm"/>add the DLLs into project references. In TFS 2013, a standalone installer was introduced that deployed all TFS object model binaries on the machine. While this simplified the setup, it did add an extra step for the developers. This complicates not only the development, but also the build and test process.</p><p>NuGet has become the Standard Package Manager for the Microsoft development platform including .NET. The NuGet client tools provide the ability to produce and consume packages. The NuGet Gallery is the central package repository used by all package authors and consumers. It seems natural to offer the object model as a package through NuGet. With the Team Foundation Server 2015, the object model can now directly be acquired through NuGet. Additionally, the licensing policies have been amended to allow distribution of the package. In this recipe, you will learn how to acquire the TFS object model through NuGet.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec244"/>Getting ready</h2></div></div></div><p>This recipe requires Visual Studio 2015. If you do not have Visual Studio installed, you can use the freely available Visual<a id="id929" class="indexterm"/> Studio Community edition available at <a class="ulink" href="https://www.visualstudio.com/en-us/downloads/download-visual-studio-vs.aspx">https://www.visualstudio.com/en-us/downloads/download-visual-studio-vs.aspx</a>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec245"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open Visual Studio, create a new project of type Windows Console Application, and name the project <code class="literal">asPlayPit</code>.</li><li class="listitem">From the Solution Explorer, right-click on the project and choose <span class="strong"><strong>Manage NuGet Packages</strong></span>. This will load the NuGet package search window within the Visual Studio.</li><li class="listitem">Search and add the <code class="literal">Microsoft.TeamFoundationServer.Client</code> and <code class="literal">Microsoft.TeamFoundationServer.ExtendedClient</code> packages.</li><li class="listitem">Installing these<a id="id930" class="indexterm"/> packages will also<a id="id931" class="indexterm"/> install the dependant packages. Once the package installation has completed successfully, from the Solution Explorer expand the references section in the <code class="literal">PlayPit</code> project. You'll see that all TFSs and dependency DLLs have been successfully added as project reference.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec246"/>How it works…</h2></div></div></div><p>In Team Foundation Server 2015, Team Explorer is now installed as a VSIX package. There are two ramifications of this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Team Explorer install location will likely be different for each install</li><li class="listitem">The TFS assemblies are not in the<a id="id932" class="indexterm"/> <span class="strong"><strong>Global Assembly Cache</strong></span> (<span class="strong"><strong>GAC</strong></span>) anymore</li></ul></div><p>If you are developing an extension, your extension will not be able to resolve TFS references on its own since TFS DLLs are no longer in the GAC. It is, therefore, recommended that you add a reference to TFS NuGet packages in your project to resolve these dependencies. The primary reason for moving the TFS DLLs out of GAC is to reduce the complexities in managing multiple versions of the product and their dependencies.</p><p>Adding the packages through NuGet creates a <code class="literal">package</code> folder at the solution level. All packages added are also stored in this folder. As you can see in the following screenshot, the TFS and related packages that were installed as part of this recipe have been downloaded into this folder:</p><div class="mediaobject"><img src="../Images/image00839.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>When checking in code, these packages will be checked into source control too. The benefit here is that anyone working on the code does not have to worry about the references. The <span class="strong"><strong>auto restore NuGet Packages</strong></span> option can be enabled at the solution level. This will restore<a id="id933" class="indexterm"/> all NuGet references on other developer machines at compile time (this does not require packages to be checked into source control). It also applies during the build and test workflow, and <a id="id934" class="indexterm"/>significantly reduces the overhead on development setup. The license terms have been changed so that you can now redistribute the TFS 2015 client <a id="id935" class="indexterm"/>OM with your application. Refer to <a class="ulink" href="http://bit.ly/1jkoSQj">http://bit.ly/1jkoSQj</a> for more details on the packages, their content, and purpose.</p></div></div>
<div class="section" title="Using Team Project Picker to connect to TFS programmatically" id="aid-2RHM01"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec89"/>Using Team Project Picker to connect to TFS programmatically</h1></div></div></div><p>The TFS object model exposes a few options for connecting to Team Foundation Server. The <span class="strong"><strong>Team Project Picker</strong></span> (<span class="strong"><strong>TPP</strong></span>) is one of the options; the advantage of using the project picker is that the user<a id="id936" class="indexterm"/> sees a TFS connection dialog that they are familiar with. The user can<a id="id937" class="indexterm"/> specify the TFS Server details and authenticate using this dialog. In this recipe, you'll learn how to use the TPP to authenticate and connect to TFS programmatically.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec247"/>Getting ready</h2></div></div></div><p>Follow the steps in the <span class="emphasis"><em>Acquiring TFS object model from the NuGet Gallery</em></span> recipe to create a project in Visual Studio and add the TFS NuGet packages to this project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec248"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the<a id="id938" class="indexterm"/> following code into the <code class="literal">Program.cs</code> class in the newly created project:<div class="informalexample"><pre class="programlisting">// Global Variables
private static TfsTeamProjectCollection _tfs;
private static ProjectInfo _selectedTeamProject;

// Connect to TFS Using Team Project Picker
public static void ConnectToTfsUsingTeamProjectPicker()
{
// The user is allowed to select only one project
var tfsPp = new TeamProjectPicker(TeamProjectPickerMode.SingleProject, false);

tfsPp.ShowDialog();

       // The TFS project collection
       _tfs = tfsPp.SelectedTeamProjectCollection;

if (tfsPp.SelectedProjects.Any())
       {
    //  The selected Team Project
          _selectedTeamProject = tfsPp.SelectedProjects[0];
       }
}</pre></div></li><li class="listitem">From <code class="literal">Main</code>, make<a id="id939" class="indexterm"/> a call to the <code class="literal">ConnectToTfsUsingTeamProjectPicker</code> method. As soon as the <code class="literal">tfsPp.ShowDialog()</code>statement is triggered, the TPP pops up. As illustrated in the following screenshot, the project picker allows you to configure the TFS server, collection, and project interactively:<div class="mediaobject"><img src="../Images/image00840.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec249"/>How it works…</h2></div></div></div><p>The <code class="literal">TeamProjectPicker</code> class accepts the <code class="literal">TeamProjectPickerMode</code> and <code class="literal">DisableCollectionChange</code> as parameters. In the preceding snippet, we are forcing the <code class="literal">TeamProjectPicker </code>class to be launched in single-project mode, that is, only one Team Project can be selected. The false value is used to override, disabling the Team Project Collection change<a id="id940" class="indexterm"/> option available in the picker. The rest of the code is simply reading and storing the name of the selected Team Project in a global variable.</p><p>You can alternatively<a id="id941" class="indexterm"/> pass the <code class="literal">TeamProjectPicker.MultiProject</code> value to allow the user to pick multiple Team Projects. You can also disable the change project collection dropdown by passing the <code class="literal">true</code> value for the <code class="literal">DisableCollectionChange</code> parameter.</p></div></div>
<div class="section" title="Determining the version of TFS using the TFS object model" id="aid-2SG6I1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec90"/>Determining the version of TFS using the TFS object model</h1></div></div></div><p>If you are building<a id="id942" class="indexterm"/> an extension using the TFS object model that is going to target multiple versions of TFS, you would most likely want to programmatically<a id="id943" class="indexterm"/> figure out the version of the TFS Server you are currently pointing at. Some of the API services introduced in the later version of TFS aren't available in earlier versions of TFS. Unfortunately, the API does not expose a property or function that will give you the exact version of TFS. In this recipe, you'll learn how to determine the TFS version programmatically.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec250"/>Getting ready</h2></div></div></div><p>Follow the steps in the <span class="emphasis"><em>Acquiring TFS object model from the NuGet Gallery</em></span> recipe to create a project in Visual Studio. Name the project <code class="literal">DetermineTFSVersion</code> and add the TFS NuGet packages to<a id="id944" class="indexterm"/> this project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec251"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the following<a id="id945" class="indexterm"/> code into the <code class="literal">Program.cs</code> class in the newly created project.</li><li class="listitem">In the <code class="literal">Main</code> method, add the following code:<div class="informalexample"><pre class="programlisting">var server = new TfsTeamProjectCollection(new Uri("http://tfs2015:8080/tfs"));
server.EnsureAuthenticated();
var serverVersion = server.ServerDataProvider.ServerVersion;
Console.WriteLine("Server Version: {0}", serverVersion);
Console.ReadKey();</pre></div></li><li class="listitem">The server version will be printed in the console output, as shown in the following output:<div class="mediaobject"><img src="../Images/image00841.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec252"/>How it works...</h2></div></div></div><p>While the output of this program does not necessarily give you the full assembly version of TFS, it helps you work out the version of the product. In the following screenshot, you can see that the TFS version in the TFS Administration Console is showing up as <code class="literal">14.0.24706.0</code> while the program returns <code class="literal">Dev14.M89-Part7</code>:</p><div class="mediaobject"><img src="../Images/image00841.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>Let's go through the code to understand what is being done:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <code class="literal">TfsTeamProjectCollection</code> class is used to initialize a new connection to the server. The server details in this case are passed as a URI to the class. There are other ways to establish a connection with the TFS Server, as discussed earlier in this chapter in the <span class="emphasis"><em>Using Team Project Picker to connect to TFS programmatically</em></span> recipe.</li><li class="listitem">The <code class="literal">EnsureAuthenticate</code> method is called to invoke the authentication connection process if the connection hasn't already been authenticated before.</li><li class="listitem">Once the connection has been authenticated, the <code class="literal">ServerVersion</code> property nested in the <code class="literal">ServerDataProvider</code> class holds the value of the TFS Server version.</li><li class="listitem">The value of the <code class="literal">ServerVersion</code> property is printed to the console using the console <code class="literal">WriteLine</code> method. The console's <code class="literal">Readkey</code> method is used to pause the console so the result of <code class="literal">ServerVersion</code> being printed to the console output can be read.</li></ul></div><p>There is an alternate<a id="id946" class="indexterm"/> approach to identify the version of TFS programmatically; the TFS location service returns a list of services available in<a id="id947" class="indexterm"/> TFS. The list and version of the services can be used to<a id="id948" class="indexterm"/> identify the version of TFS. More information on this approach is available at <a class="ulink" href="http://bit.ly/21l0YX8">http://bit.ly/21l0YX8</a>.</p></div></div>
<div class="section" title="Retrieving TFS permissions programmatically using the TFS object model" id="aid-2TEN41"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec91"/>Retrieving TFS permissions programmatically using the TFS object model</h1></div></div></div><p>TFS administrators<a id="id949" class="indexterm"/> are often required to publish and review user permissions. In this recipe, you will learn how to use the TFS object model to <a id="id950" class="indexterm"/>programmatically generate the security groups, members, permissions, and security settings of users in Team Projects in TFS.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec253"/>Getting ready</h2></div></div></div><p>Follow the steps in the <span class="emphasis"><em>Acquiring TFS object model from the NuGet Gallery</em></span> recipe to create a project in Visual Studio and add the TFS NuGet packages to this project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec254"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Connect to TFS programmatically</strong></span>: As a first step, a connection to the TFS needs to be established. This can be done using the following snippet:<div class="informalexample"><pre class="programlisting">var tfs = TfsTeamProjectCollectionFactory
                .GetTeamProjectCollection(new Uri("http://tfs2015:8080/tfs")); 
tfs.EnsureAuthenticated();</pre></div></li><li class="listitem"><span class="strong"><strong>Get an instance of the version control server service</strong></span>: The version control server service exposes an interface with a set of methods to work with TFS version control component programmatically:<div class="informalexample"><pre class="programlisting">// Version control service exposes methods to work with TFS version control
var vcs = tfs.GetService&lt;VersionControlServer&gt;();

// Since we'll be reporting groups for all team projects, imp to get all team projects
var teamProjects = vcs.GetAllTeamProjects(false);
// Narrow down to the FabrikamTFVC Team Project
var teamProject = teamProjects.FirstOrDefault(p=&gt;p.Name == "FabrikamTFVC");</pre></div></li><li class="listitem"><span class="strong"><strong>Application groups</strong></span>: The <code class="literal">IGroupSecurityService</code> interface is used to retrieve a list of group<a id="id951" class="indexterm"/> membership for a Team Project:<div class="informalexample"><pre class="programlisting">// Group Security service exposes methods to get groups, users and security details
var sec = tfs.GetService&lt;IGroupSecurityService&gt;();

Identity[] appGroups = sec.ListApplicationGroups(teamProject.ArtifactUri. AbsoluteUri);</pre></div><p>This information <a id="id952" class="indexterm"/>can be retrieved through the Team Explorer by navigating into the <span class="strong"><strong>Settings</strong></span> page and clicking on the <span class="strong"><strong>Group Membership</strong></span> hyperlink. Clicking on the <span class="strong"><strong>Group Membership</strong></span> hyperlink will navigate you to the security page in Team Web Portal. The left-hand side of the following screenshot shows the groups in the security page for FabrikamTFVC project and the right-hand side of the screenshot shows the results returned programmatically:</p><div class="mediaobject"><img src="../Images/image00842.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem"><span class="strong"><strong>Get members within the application groups</strong></span>: Each application group comprises of either<a id="id953" class="indexterm"/> users or further AD groups. The following code snippet loops through the members of the application<a id="id954" class="indexterm"/> groups and gets the identity of each member:<div class="informalexample"><pre class="programlisting">foreach (Identity group in appGroups)
{
Identity[] groupMembers = sec.ReadIdentities(SearchFactor.Sid, new string[] { group.Sid }, QueryMembership.Expanded);

foreach (Identity member in groupMembers)
                {
Console.WriteLine(member.DisplayName); 
if (member.Members != null)
                    {
foreach (string memberSid in member.Members)
                        {
                            Identity memberInfo = sec.ReadIdentity (SearchFactor.Sid, memberSid, QueryMembership.Expanded);
var userName = memberInfo.Domain + "\\" + memberInfo.AccountName;
Console.WriteLine(string.Format("       {0}", memberInfo.AccountName));
                        }
                    }
                }
}</pre></div><p>The program now not only returns the name of the group, but also the members in each of the nested groups:</p><div class="mediaobject"><img src="../Images/image00843.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem"><span class="strong"><strong>Get the user membership settings</strong></span>: The user in the application group either inherits the permissions or is directly assigned the permissions. The following code snippet uses the <code class="literal">GetPermissions</code> method in the version control service to work out the<a id="id955" class="indexterm"/> user membership setting:<div class="informalexample"><pre class="programlisting">var actualPermission = vcs.GetPermissions(new string[] { TeamProject.ServerItem }, RecursionType.Full);
foreach (var memberOf in memberInfo.MemberOf)
   {
    // Get information about the members
}</pre></div><p>This information can<a id="id956" class="indexterm"/> be retrieved through Team Explorer by navigating into the <span class="strong"><strong>Settings</strong></span> page and clicking on the <span class="strong"><strong>Security</strong></span> hyperlink. The <span class="strong"><strong>Security</strong></span> hyperlink launches the security page in Team Web Portal:</p><div class="mediaobject"><img src="../Images/image00844.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem"><span class="strong"><strong>Version control permissions</strong></span>: Individual user permissions on version control can be retrieved using the <code class="literal">GetEffectivePermissions</code> method in the version control service:<div class="informalexample"><pre class="programlisting">var permissions = vcs.GetEffectivePermissions(userName, teamProject.ServerItem);

foreach (var permission in permissions)
{
versionControlPerTmissions.Add(new VersionControlPermission(){Name = permission});
}</pre></div><p>This returns the <a id="id957" class="indexterm"/>version control <a id="id958" class="indexterm"/>permission for each user in the group. As illustrated in the following screenshot, the user <code class="literal">Tarun</code> is a member of the <code class="literal">Project Valid Users</code> group and has the <code class="literal">Manage Branch</code> permission:</p><div class="mediaobject"><img src="../Images/image00845.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Getting the Process Template name for a Team Project programmatically" id="aid-2UD7M1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec92"/>Getting the Process Template name for a Team Project programmatically</h1></div></div></div><p>In this recipe, you'll learn<a id="id959" class="indexterm"/> how to get the<a id="id960" class="indexterm"/> name of the Process Template used to create a Team Project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec255"/>Getting ready</h2></div></div></div><p>Follow the steps in the <span class="emphasis"><em>Acquiring TFS object model from the NuGet Gallery</em></span> recipe to create a project in Visual Studio and add the TFS NuGet packages to this project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec256"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, connect to<a id="id961" class="indexterm"/> TFS programmatically. As a first step, a connection to the TFS needs to be established. This can be done using the following snippet:<div class="informalexample"><pre class="programlisting">var tfs = TfsTeamProjectCollectionFactory
                .GetTeamProjectCollection(new Uri("http://tfs2015:8080/tfs")); 
tfs.EnsureAuthenticated();</pre></div></li><li class="listitem">To obtain the<a id="id962" class="indexterm"/> Process Template details for a Team Project, we need an instance of the <code class="literal">VersionControlServer</code> service and the <code class="literal">Now</code> instance to get <code class="literal">ICommonServerService</code>. The <code class="literal">VersionControlServer</code> service is used to get the project details, specifically, it is <code class="literal">AbsoluteUri</code> that we are after. <code class="literal">AbsoluteUri</code> for the Team Project is used by <code class="literal">ICommonServerService</code> to identify the project properties such as the Process Template name:<div class="informalexample"><pre class="programlisting">// Get an instance of the VersionControlServer
var vcs = server.GetService&lt;VersionControlServer&gt;();
// Get an instance of the ICommonStructureService
var ics = server.GetService&lt;ICommonStructureService&gt;();
ProjectProperty[] ProjectProperties = null;

// Get the team project by name
var teamProject= vcs.GetTeamProject("FabrikamTFVC");

string ProjectName = string.Empty;
string ProjectState = string.Empty;
int templateId = 0;
ProjectProperties = null;

// Get the project properties using the ICommonStructureServer
ics.GetProjectProperties(teamProject.ArtifactUri.AbsoluteUri, 
out ProjectName, out ProjectState, 
out templateId, out ProjectProperties);

// Output all the project properties
foreach (var pp in ProjectProperties)
{
Console.WriteLine(string.Format("{0} - {1}", pp.Name, pp.Value));
}</pre></div><p>Executing this returns the list of properties and their values. As you can see in the following screenshot, the <code class="literal">Scrum</code> template has been used to create the FabrikamTFVC Team Project. The <code class="literal">SourceControlGitEnabled</code> and <code class="literal">SourceControlTfvcEnabled</code> properties tell you source control capabilities in the Team Project:</p><div class="mediaobject"><img src="../Images/image00846.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec257"/>How it works...</h2></div></div></div><p>Use the Process Template Manager to download the Scrum Process Template from TFS. From the download location, open the <code class="literal">Classification.xml</code> file from under the <code class="literal">Classification</code> folder. The API basically renders the contents of <code class="literal">Classification.xml</code>:</p><div class="mediaobject"><img src="../Images/image00847.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>You can add more properties and values to the <code class="literal">Classification.xml</code> file and use this version of the template to<a id="id963" class="indexterm"/> create Team Projects. The <code class="literal">GetProjectProperties</code> method in the <code class="literal">ICommonStructureServer</code> service<a id="id964" class="indexterm"/> will return the newly added properties. In addition to this, you can use the <code class="literal">UpdateProjectProperties</code> method in <code class="literal">ICommonStructureService</code> to update the values of these properties.</p></div></div>
<div class="section" title="Getting build details programmatically using the REST API" id="aid-2VBO81"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec93"/>Getting build details programmatically using the REST API</h1></div></div></div><p>In this recipe, you'll learn how to get a list <a id="id965" class="indexterm"/>of builds with<a id="id966" class="indexterm"/> details in a Team Project using the <code class="literal">BuildHttpClient</code> REST APIs.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec258"/>Getting ready</h2></div></div></div><p>As alluded to in the chapter introduction, Team Foundation Server 2015 does not yet have OAuth token provisioning capability; for this reason, the only way to consume the REST API is using alternate credentials. Alternate credentials uses basic authentication as the authentication protocol. When using basic authentication, the user credentials are sent to the server in plain text. This type of setup simply isn't acceptable in a professional environment. Follow the<a id="id967" class="indexterm"/> instructions at <a class="ulink" href="http://bit.ly/1Nfe8e0">http://bit.ly/1Nfe8e0</a> to set up a self-signed certificate to configure SSL for TFS. With SSL, the traffic between the client and TFS is encrypted.</p><p>If you simply want to play around with the REST API without getting into the complexities of the setup, then <a id="id968" class="indexterm"/>API Sandbox is a great place to start: <a class="ulink" href="https://apisandbox.msdn.microsoft.com">https://apisandbox.msdn.microsoft.com</a>. The API Sandbox is wired up to a sample Visual Studio Team Services account, it gives you pre-configured code samples to try out the capabilities offered by the API, you can additionally connect to your Visual Studio Team Services instance too. While API Sandbox does not offer the capability to connect an on-premise TFS instance, it allows you to call older versions of the API by specifying the version of the API in the version parameter in the constructed service URL. An alternate to the API Sandbox is <a id="id969" class="indexterm"/>Postman (<a class="ulink" href="http://bit.ly/1l044iU">http://bit.ly/1l044iU</a>). Postman is available as a free extension in the Chrome store. It's a fantastic utility to build, test, and document APIs faster. You can trigger all REST operations by directly passing the server URLs and <a id="id970" class="indexterm"/>parameters right from within Postman. This enables you to connect to on-premise TFS instance too; this is very useful to try the APIs against real data.</p><p>Download the <code class="literal">RESTDemo</code> solution provided with the course material. The solution contains three projects, namely, <code class="literal">GetBuildDetails</code>, <code class="literal">GetGitRepos</code>, and <code class="literal">GetWorkitemById</code>. Open<a id="id971" class="indexterm"/> the <code class="literal">RESTDemo</code> solution in Visual Studio. In this recipe, we'll be going through the <code class="literal">GetBuildDetails</code> project to get a list of builds with details from a Team Project.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec259"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">RESTDemo</code> solution, set <code class="literal">GetBuildDetails</code> as the startup project:<div class="mediaobject"><img src="../Images/image00848.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Run the <code class="literal">GetBuildDetails</code> project, this will launch a console, enter the TFS server URL, and press <span class="emphasis"><em>Enter</em></span>:<div class="mediaobject"><img src="../Images/image00849.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the username and password of the user you want to connect to TFS with and press <span class="emphasis"><em>Enter</em></span>:<div class="mediaobject"><img src="../Images/image00850.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the project name you would like to retrieve the build details from:<div class="mediaobject"><img src="../Images/image00851.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The console outputs<a id="id972" class="indexterm"/> the list of builds in FabrikamTFVC along with the details of the build<a id="id973" class="indexterm"/>, such as the name of the build definition, the build number, result, requested by, start time, and finish time of the build:<div class="mediaobject"><img src="../Images/image00852.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec260"/>How it works…</h2></div></div></div><p>We'll go through the code in the <code class="literal">GetBuildDetails</code> project to understand the working of the code. To connect and get the data from TFS, the project requires TFS API binaries. The project uses the <code class="literal">Microsoft.TeamFoundationServer.ClientNuGet</code> package to get the right binary references:</p><div class="mediaobject"><img src="../Images/image00853.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>From the Solution Explorer, open the <code class="literal">Program.cs</code> file in the <code class="literal">GetBuildDetails</code> project. The program gets the TFS Server URL, username, and password details as an input from the user. The password is asterisked on the console by replacing the entered characters into asterisk form before<a id="id974" class="indexterm"/> printing out to the<a id="id975" class="indexterm"/> console. An instance of <code class="literal">VssBasicCredential</code> is created with the username and password. This information is then passed into <code class="literal">BuildHttpClient</code>. When an instance of the <code class="literal">BuildHttpClient</code> class is created, the constructor takes the server URL and credentials. The <code class="literal">BuildHttpClient</code> object validates the connection to TFS as part of the instantiation process:</p><div class="informalexample"><pre class="programlisting">var tfsServerUrl = Console.ReadLine(); 
var userName = Console.ReadLine(); 
var password = GetConsolePassword(); 
var projectName = Console.ReadLine(); 
var credentials = new VssBasicCredential(userName, password); 
BuildHttpClient buildClient = new BuildHttpClient(new Uri(tfsServerUrl), credentials); </pre></div><p>The <code class="literal">BuildHttpClient</code> class contains the <code class="literal">GetBuildsAsync</code> method. The Team Project name is passed as a parameter to the <code class="literal">GetBuildsAsync</code> method:</p><div class="informalexample"><pre class="programlisting">var builds = buildClient.GetBuildsAsync(projectName).Result;</pre></div><p>The function returns a list of build. The build entity contains all build properties, as seen in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00854.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>The program then loops<a id="id976" class="indexterm"/> through the list of<a id="id977" class="indexterm"/> builds and prints the properties to the console. You can get more details <a id="id978" class="indexterm"/>about the build REST API at <a class="ulink" href="https://www.visualstudio.com/integrate/api/build/overview">https://www.visualstudio.com/integrate/api/build/overview</a>.</p></div></div>
<div class="section" title="Getting a list of Git repositories programmatically using the REST API" id="aid-30A8Q1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec94"/>Getting a list of Git repositories programmatically using the REST API</h1></div></div></div><p>In this recipe, you'll learn<a id="id979" class="indexterm"/> how to get a list of Git repositories in a<a id="id980" class="indexterm"/> Team Project programmatically using the <code class="literal">GitHttpClient</code> REST API.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec261"/>Getting ready</h2></div></div></div><p>Refer to instructions in the <span class="emphasis"><em>Getting ready</em></span> section of the <span class="emphasis"><em>Getting build details programmatically using the REST API</em></span> recipe for setup details. Download the <code class="literal">RESTDemo</code> solution provided with the course material. In this recipe, we'll be going through the <code class="literal">GetGitRepos</code> project to get a list of Git repositories with details from a Team Project.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec262"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">RESTDemo</code> solution, set <code class="literal">GetGitRepos</code> as the startup project:<div class="mediaobject"><img src="../Images/image00855.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Run the <code class="literal">GetGitRepos</code> project, this will launch a console. Enter the TFS Server URL and <a id="id981" class="indexterm"/>press <span class="emphasis"><em>Enter</em></span>:<div class="mediaobject"><img src="../Images/image00856.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the username and password of the user you want to connect to the TFS with and press <span class="emphasis"><em>Enter</em></span>:<div class="mediaobject"><img src="../Images/image00850.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the project name <a id="id982" class="indexterm"/>you would like to retrieve the build details from:<div class="mediaobject"><img src="../Images/image00857.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The console outputs the list of Git repositories in FabrikamGit project along with the details of the repositories such as its ID, name, and remote URL:<div class="mediaobject"><img src="../Images/image00858.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec263"/>How it works…</h2></div></div></div><p>We'll go through the code<a id="id983" class="indexterm"/> in the <code class="literal">GetGitRepos</code> project to understand the working of the code. To connect and get the data from TFS, the project requires<a id="id984" class="indexterm"/> TFS API binaries; the project uses the <code class="literal">Microsoft.TeamFoundationServer.ClientNuGet</code> package to get the right binary references:</p><div class="mediaobject"><img src="../Images/image00853.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>From the Solution Explorer open the <code class="literal">Program.cs</code> file in <code class="literal">GetGitRepos</code> project. The program gets the TFS Server URL, username, and password details as an input from the user. The password is asterisked on the console by replacing the entered characters into asterisk form before printing out to the console. An instance of <code class="literal">VssBasicCredential</code> is created with the username and password. This information is then passed into the <code class="literal">GitHttpClient</code>. An instance of the <code class="literal">GitHttpClient</code> class is created, the constructor takes the server URL and credentials. The <code class="literal">GitHttpClient</code> class validates the connection to TFS as part of the instantiation process:</p><div class="informalexample"><pre class="programlisting">var tfsServerUrl = Console.ReadLine();
var userName = Console.ReadLine();
var password = GetConsolePassword();
var projectName = Console.ReadLine();
var credentials = new VssBasicCredential(userName, password);

GitHttpClient gitClient = new GitHttpClient(new Uri(tfsServerUrl), credentials);</pre></div><p>The <code class="literal">GitHttpClient</code> class<a id="id985" class="indexterm"/> contains the <code class="literal">GetRepositoriesAsync</code> method. The Team Project name is passed as a parameter to this method:</p><div class="informalexample"><pre class="programlisting">var gitRepositories = gitClient.GetRepositoriesAsync(projectName, true).Result;</pre></div><p>The function returns a list of<a id="id986" class="indexterm"/> <code class="literal">GitRepository</code>. The <code class="literal">GitRepository</code> entity contains all <code class="literal">GitRepository</code> properties:</p><div class="mediaobject"><img src="../Images/image00859.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>The program then loops through the list of <code class="literal">GitRepositories</code> and prints the properties to the console. You can get more details about the Git REST API at <a class="ulink" href="https://www.visualstudio.com/integrate/api/git/overview">https://www.visualstudio.com/integrate/api/git/overview</a>.</p></div></div>
<div class="section" title="Getting a Work Item by ID programmatically using the REST API" id="aid-318PC1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec95"/>Getting a Work Item by ID programmatically using the REST API</h1></div></div></div><p>In this recipe, you'll learn <a id="id987" class="indexterm"/>how to get details of a Work Item <a id="id988" class="indexterm"/>programmatically using the <code class="literal">WorkItemTrackingHttpClient</code> REST API.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec264"/>Getting ready</h2></div></div></div><p>Refer to instructions in the <span class="emphasis"><em>Getting ready</em></span> section of the <span class="emphasis"><em>Getting build details programmatically using the REST API</em></span> recipe for setup details. Download the <code class="literal">RESTDemo</code> solution provided with the course material. In this recipe, we'll be going through the <code class="literal">GetWorkItemById</code> project to get the details of a Work Item.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec265"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">RESTDemo</code><a id="id989" class="indexterm"/> solution, set <code class="literal">GetWorkItemById</code> as the startup project:<div class="mediaobject"><img src="../Images/image00860.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Run the <code class="literal">GetWorkItemById</code> project, this will launch a console, enter the TFS server URL, and<a id="id990" class="indexterm"/> press <span class="emphasis"><em>Enter</em></span>:<div class="mediaobject"><img src="../Images/image00861.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the username and password of the user you want to connect to TFS with and press <span class="emphasis"><em>Enter</em></span>:<div class="mediaobject"><img src="../Images/image00850.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the Work Item ID you would like to query the API for:<div class="mediaobject"><img src="../Images/image00862.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The console outputs the details of the Work Item such as the Team Project it belongs to, its type, title, state, and created by:<div class="mediaobject"><img src="../Images/image00863.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec266"/>How it works…</h2></div></div></div><p>We'll go through the code in the <code class="literal">GetWorkItemById</code> project to understand the workings of the code. To connect <a id="id991" class="indexterm"/>and get the data from TFS, the project <a id="id992" class="indexterm"/>requires TFS API binaries; the project uses the <code class="literal">Microsoft.TeamFoundationServer.ClientNuGet</code> package to get the right binary references:</p><div class="mediaobject"><img src="../Images/image00853.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>From the Solution Explorer, open the <code class="literal">Program.cs</code> file in the <code class="literal">GetWorkItemById</code> project. The program gets the TFS server URL, username, and password details as an input from the user. The password is asterisked on the console by replacing the entered characters into asterisk form before printing out to the console. An instance of <code class="literal">VssBasicCredential</code> is created with the username and password. This information is then passed into <code class="literal">WorkItemTrackingHttpClient</code>. An instance of the <code class="literal">WorkItemTrackingHttpClient</code> class is created, the constructor takes the server URL and credentials. The <code class="literal">WorkItemTrackingHttpClient</code> class validates the connection to TFS as part of the instantiation process. As you would have noticed, in this sample we did not have to ask for the Team<a id="id993" class="indexterm"/> Project name, that's because Work Item IDs are scoped at the Team Project Collection level. This means a Work Item ID is unique at a Team Project Collection level, since the TFS Server URL contains the collection<a id="id994" class="indexterm"/> name this information does not need to be requested separately:</p><div class="informalexample"><pre class="programlisting">var tfsServerUrl = Console.ReadLine();
var userName = Console.ReadLine();
var password = GetConsolePassword();
var credentials = new VssBasicCredential(userName, password);

WorkItemTrackingHttpClient witClient =
new WorkItemTrackingHttpClient(new Uri(tfsServerUrl),
new VssBasicCredential(userName, password));</pre></div><p>The <code class="literal">WorkItemTrackingHttpClient</code> class contains the <code class="literal">GetWorkItemAsync</code> method. The Work Item ID is passed as a parameter to this method.</p><div class="informalexample"><pre class="programlisting">var workItem = witClient.GetWorkItemAsync(Convert.ToInt32(workitemId)).Result;</pre></div><p>The function returns an object of type <code class="literal">WorkItem</code>. The <code class="literal">WorkItem</code> class contains information about the Work Item fields along with information about the relation and revision:</p><div class="mediaobject"><img src="../Images/image00864.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>The program then prints the values of the fields to the console:</p><div class="informalexample"><pre class="programlisting">Console.WriteLine($"Team Project: workItem.Fields["System.TeamProject"]}");
Console.WriteLine($"Type: {workItem.Fields["System.WorkItemType"]}");
Console.WriteLine($"Title: {workItem.Fields["System.Title"]}");
Console.WriteLine($"State: {workItem.Fields["System.State"]}");
Console.WriteLine($"Created By: {workItem.Fields["System.CreatedBy"]}");</pre></div><p>You can get more details<a id="id995" class="indexterm"/> about the <a id="id996" class="indexterm"/>Work Item<a id="id997" class="indexterm"/> REST API at <a class="ulink" href="https://www.visualstudio.com/integrate/api/wit/overview">https://www.visualstudio.com/integrate/api/wit/overview</a>.</p></div></div>
<div class="section" title="Adding a Team field to the Product Backlog Item to an existing Team Project"><div class="titlepage" id="aid-3279U2"><div><div><h1 class="title"><a id="ch08lvl1sec96"/>Adding a Team field to the Product Backlog Item to an existing Team Project</h1></div></div></div><p>The original purpose of the Area Path field was to logically group Work Items based on the functional or technical area<a id="id998" class="indexterm"/> they belong to before this field got hijacked as the Team Backlog Path. If you intend to use the Area Path for functional <a id="id999" class="indexterm"/>or technical grouping of the Work Items, you will need a new field to allocate the Work Items to Teams within a Team Project. In this recipe, you'll learn how to add a Team field to a Team Project by modifying an existing Process Template.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec267"/>Getting ready</h2></div></div></div><p>A Process Template can be downloaded using the Process Template manager. To do this, navigate to the Team Explorer's <span class="strong"><strong>Settings</strong></span> page. Select the <span class="strong"><strong>Process Template Manager</strong></span> hyperlink from the <span class="strong"><strong>Team Project Collection</strong></span> view:</p><div class="mediaobject"><img src="../Images/image00865.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>The out-of-the-box Process Templates in TFS have been locked for editing. This has been done by adding a known GUID to the Process Template. This ID helps identify the out-of-the-box Process Template from others. If you intend to customize a Process Template, then it is advisable to modify the GUID of the out-of-the-box Process Template to a different GUID. As illustrated in the following screenshot, this can be done by downloading the Process Template and chaining the GUID to a different value:</p><div class="mediaobject"><img src="../Images/image00866.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>Modifying an existing Team Project can lead to corruption of data, it is, therefore, advisable that you create a Test Project using the updated Process Template before trying out the changes highlighted in this recipe. You need to be a member of the Project Administrators Group to make these changes to the Team Project.</p><p>Download and install the<a id="id1000" class="indexterm"/> TFS Power Tools (<a class="ulink" href="http://bit.ly/1jJkEmt">http://bit.ly/1jJkEmt</a>), this will install the Process Editor extension.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec268"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a<a id="id1001" class="indexterm"/> <code class="literal">ProcessTemplateRecipe</code> directory<a id="id1002" class="indexterm"/> and a new file <code class="literal">TeamGlobalList.xml</code>. Copy and save the following text in the <code class="literal">TeamGlobalList</code> file:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;gl:GLOBALLISTS &gt;
    &lt;GLOBALLIST name="Teams"&gt;
        &lt;LISTITEM value="Unassigned"/&gt;
        &lt;LISTITEM value="Fabrikam Feature 1"/&gt;
        &lt;LISTITEM value="Fabrikam Feature 2"/&gt;
        &lt;LISTITEM value="Fabrikam Feature 3"/&gt;
        &lt;LISTITEM value="Fabrikam Feature 4"/&gt;
    &lt;/GLOBALLIST&gt;
&lt;/gl:GLOBALLISTS&gt;</pre></div></li><li class="listitem">Open Visual Studio, and launch the Process Editor from the <span class="strong"><strong>Tools</strong></span> menu. From the context menu, select <span class="strong"><strong>Import Global List</strong></span>:<div class="mediaobject"><img src="../Images/image00867.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">To upload the <code class="literal">TeamGlobalList.xml</code> file, navigate to the directory and select <code class="literal">TeamGlobalList.xml</code>. To validate the upload, choose <span class="strong"><strong>Open Global List</strong></span> from the server:<div class="mediaobject"><img src="../Images/image00868.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open WIT from server by selecting this option from the <span class="strong"><strong>Process Editor</strong></span> menu. Select the<a id="id1003" class="indexterm"/> FabrikamTFVC Team <a id="id1004" class="indexterm"/>Project and the Product Backlog Item type Work Item:<div class="mediaobject"><img src="../Images/image00869.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The Process Editor launches the Product Backlog Item type Work Item in a graphical interface:<div class="mediaobject"><img src="../Images/image00870.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The <span class="strong"><strong>New</strong></span> button is used to add a new field to the Work Item type. Click on <span class="strong"><strong>New</strong></span> and enter the details as illustrated in the following screenshot:<div class="mediaobject"><img src="../Images/image00871.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">From the <span class="strong"><strong>Rules</strong></span><a id="id1005" class="indexterm"/> tab, click on <a id="id1006" class="indexterm"/><span class="strong"><strong>New</strong></span>, choose <span class="strong"><strong>Allowed Values</strong></span>. Click on <span class="strong"><strong>New</strong></span> and choose the Team's global list created earlier:<div class="mediaobject"><img src="../Images/image00872.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to the <span class="strong"><strong>Layout</strong></span> tab and create a new control for Team under the <span class="strong"><strong>Status Group</strong></span> column. Configure the Team control as illustrated in the following screenshot:<div class="mediaobject"><img src="../Images/image00873.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the preview form button to load the preview of changes in the Work Item form. Click on <a id="id1007" class="indexterm"/><span class="strong"><strong>Save</strong></span> in the <span class="strong"><strong>Work Item Type</strong></span> form to apply the changes.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec269"/>How it works…</h2></div></div></div><p>To test the changes, create a<a id="id1008" class="indexterm"/> new Work Item of type <span class="strong"><strong>Product Backlog Item</strong></span>. The form now includes the <span class="strong"><strong>Team</strong></span> field. The changes are applied to the Work Item form in Visual Studio and Team Web Portal:</p><div class="mediaobject"><img src="../Images/image00874.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>By choosing to add the field as a dimension, it now supports being reporting using the TFS warehouse. This is great if you intend to use this field for reporting.</p><p>The Process Templates support<a id="id1009" class="indexterm"/> customization <a id="id1010" class="indexterm"/>not only at the Work Item form level, but also at other levels such as security groups, project defaults, version control, and reports. MSDN has comprehensive guidance <a id="id1011" class="indexterm"/>and walkthroughs on how to apply this customization; read more about it at <a class="ulink" href="http://bit.ly/1lmwLGr">http://bit.ly/1lmwLGr</a>.</p></div></div>
<div class="section" title="Adding multi-item select control in the Work Item form" id="aid-335QG1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec97"/>Adding multi-item select control in the Work Item form</h1></div></div></div><p>Natively, the Work Item<a id="id1012" class="indexterm"/> forms in Team Project do not support multivalue fields. While there isn't native support for multivalue fields in the<a id="id1013" class="indexterm"/> Process Template, there is an open source multivalue field control that allows you to achieve exactly this. In this recipe, you'll learn how to set up and use the multivalue field control in an existing Team Project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec270"/>Getting ready</h2></div></div></div><p>Download and install the<a id="id1014" class="indexterm"/> custom Work Item Control from CodePlex <a class="ulink" href="http://witcustomcontrols.codeplex.com">http://witcustomcontrols.codeplex.com</a>. The download includes a web extension and an extension for Visual Studio. The Visual Studio extension needs to be installed on all machines you intend to use the multivalue control from in Visual Studio. You do not need to install this control on machines where you intend to use this control in Web Portal only. You need to be a member of the Project Administrator Group to make these changes.</p><p>In this recipe, we'll be extending the Team Global List field set up earlier in the chapter in the <span class="emphasis"><em>Adding a Team field to the Product Backlog Item to an existing Team Project</em></span> recipe.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec271"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Launch the Team Web Portal extensions console by browsing <code class="literal">http://tfs2015:8080/tfs/_admin/_extensions</code>:<div class="mediaobject"><img src="../Images/image00875.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Install</strong></span> button to upload the multivalue field control extension in the Web Portal. Select <a id="id1015" class="indexterm"/>and add the extension from the download location:<div class="mediaobject"><img src="../Images/image00876.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enable the extension once it has been uploaded. This will activate this extension across the TFS instance:<div class="mediaobject"><img src="../Images/image00877.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open Visual Studio and launch the Process Editor, choose <span class="strong"><strong>Open WIT from server</strong></span> from the context menu. Connect to the FabrikamTFVC Team Project and open the Product<a id="id1016" class="indexterm"/> Backlog Item Work Item Type. In the previous recipe, a <span class="strong"><strong>Team</strong></span> field was added and associated to a control of type <code class="literal">FieldType</code>. Navigate to the <span class="strong"><strong>Layout</strong></span> tab, locate the <span class="strong"><strong>Team</strong></span> field, and change the type of the control to <code class="literal">MultiValueControl</code>. Click on <span class="strong"><strong>Save</strong></span> to apply the changes:<div class="mediaobject"><img src="../Images/image00878.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec272"/>How it works…</h2></div></div></div><p>To test the changes, create <a id="id1017" class="indexterm"/>a new Work Item of type Product Backlog Item using the Team Web Portal. As illustrated in the following screenshot, the <span class="strong"><strong>Team</strong></span> field shows a checkbox next to each Team name that allows you to select<a id="id1018" class="indexterm"/> multiple items. Select multiple values and save the changes to the Work Item. The values set in the Work Item can also be queried from the <span class="strong"><strong>Work Item Query</strong></span> window:</p><div class="mediaobject"><img src="../Images/image00879.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>You will also see the multivalue selector option in the Product Backlog Item Work Item form when you open it in Visual Studio on a machine that has the multivalue selector control installed.</p></div></div></body></html>