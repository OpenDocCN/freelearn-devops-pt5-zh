<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Installing Docker</h1></div></div></div><p>In this chapter, we will find out where to download and how to install Docker on various operating systems. Some basic Docker commands will be used so that we can verify whether the installation was successful and to interact with Docker for the very first time.</p><p>The following topics are covered in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What is Docker?</li><li class="listitem" style="list-style-type: disc">Docker on Ubuntu Trusty 14.04 LTS</li><li class="listitem" style="list-style-type: disc">Docker on Mac OS X</li><li class="listitem" style="list-style-type: disc">Docker on Windows</li><li class="listitem" style="list-style-type: disc">Docker on Amazon EC2</li></ul></div><p>This book <a class="indexterm" id="id0"/>will take you through all the steps, from installing Docker to running your own <strong>Platform as a Service</strong> (<strong>PaaS</strong>) so that you can push your code without having to think about infrastructure or server provisioning.</p><p>The theme of this book will be to create a modular web application using an isolated web server and a database.</p><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>What is Docker?</h1></div></div></div><p>On Docker's<a class="indexterm" id="id1"/> website, <a class="ulink" href="http://www.docker.com">http://www.docker.com</a>, the following definition is <a class="indexterm" id="id2"/>provided for Docker:</p><div><blockquote class="blockquote"><p><em>"Docker is an open platform for developers and sysadmins to build, ship, and run distributed applications."</em></p></blockquote></div><p>What this means in a more practical sense is that Docker is a way of enclosing services in isolated environments, called <a class="indexterm" id="id3"/>
<strong>containers</strong>, so that they can be packaged with all they need in terms of libraries and dependencies and the developer can be certain that the service will run wherever Docker runs.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Docker on Ubuntu Trusty 14.04 LTS</h1></div></div></div><p>The OS, flavor and version, where it's easiest to install Docker is in Ubuntu Trusty 14.04 LTS. This<a class="indexterm" id="id4"/> is a pretty quick task since we can<a class="indexterm" id="id5"/> use the built-in package<a class="indexterm" id="id6"/> manager <code class="literal">apt-get</code>.</p><div><div><h3 class="title"><a id="note02"/>Note</h3><p>Note that Docker is called <code class="literal">docker.io</code> here and just <code class="literal">docker</code> on other platforms since Ubuntu (and Debian) already has a package named <code class="literal">docker</code>.</p></div></div><p>First we open a terminal and execute these commands one by one:</p><div><pre class="programlisting">
<strong>sudo apt-get update</strong>
<strong>sudo apt-get install docker.io</strong>
<strong>source /etc/bash_completion.d/docker.io</strong>
</pre></div><p>Here, we first update the lists of the packet manager <code class="literal">apt-get</code> in order to get information about all the packages, versions, and dependencies that are available. The next line actually installs Docker, and after that, we enable Ubuntu to tab-complete our Docker commands.</p><p>When you've done this without errors, run <code class="literal">sudo docker.io version</code> just to verify that it works as expected.</p><div><div><h3 class="title"><a id="note03"/>Note</h3><p>Note that this installs the latest released Ubuntu package version, which might not necessarily be the latest released Docker version.</p></div></div><p>In order to have the latest version from an alternative Docker-maintained repository, we can execute the following command:</p><div><pre class="programlisting">
<strong>curl -sSL https://get.docker.com/ubuntu/ | sudo sh</strong>
</pre></div><p>This adds an alternative repository maintained by the Docker team and installs Docker for you as a much more updated version than the one that comes via the Ubuntu repository. Note that the Docker package is named <code class="literal">lxc-docker</code> when it is installed this way. The command used to run Docker commands is still <code class="literal">docker</code>.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Upgrading Docker on Ubuntu Trusty 14.04 LTS</h2></div></div></div><p>To check and <a class="indexterm" id="id7"/>download upgrades, all<a class="indexterm" id="id8"/> you have to do is to execute this command in a terminal:</p><div><pre class="programlisting">
<strong>sudo apt-get update &amp;&amp; sudo apt-get upgrade</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>User permissions</h2></div></div></div><p>For convenience, it's preferred to add our user to the system's Docker user group so that we can <a class="indexterm" id="id9"/>control Docker without using <code class="literal">sudo</code>. This gives our user permission to execute Docker commands.</p><p>Replace <code class="literal">USER</code> with your username before you run the code:</p><div><pre class="programlisting">
<strong>sudo gpasswd -a USER docker</strong>
</pre></div><p>You might have to log out and log in again for it to work. When you are logged back in, run <code class="literal">docker ps</code> to verify that there are no permission problems.</p><div><div><h3 class="title"><a id="note04"/>Note</h3><p>More <a class="indexterm" id="id10"/>detailed information can be found in the official installation guide at <a class="ulink" href="https://docs.docker.com/installation/ubuntulinux/">https://docs.docker.com/installation/ubuntulinux/</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Docker on Mac OS X</h1></div></div></div><p>To be able<a class="indexterm" id="id11"/> to use Docker on Mac OS X, we have to run the <a class="indexterm" id="id12"/>Docker service inside a virtual machine (VM) since Docker uses Linux-specific features to run. We don't have to get frightened by<a class="indexterm" id="id13"/> this since the installation process is very short and straightforward.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Installation</h2></div></div></div><p>There is an OS X installer that installs everything we need, that is, VirtualBox, boot2docker, and Docker.</p><p>VirtualBox is a virtualizer in which we can run the lightweight Linux distribution, and boot2docker is a virtual machine that runs completely in the RAM and occupies just about 27 MB of space.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>The latest released <a class="indexterm" id="id14"/>version of the OS X installer can be found at <a class="ulink" href="https://github.com/boot2docker/osx-installer/releases/latest">https://github.com/boot2docker/osx-installer/releases/latest</a>.</p></div></div><p>Now, let's take a look at how the installation should be done with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the installer by clicking on the button named <strong>Boot2Docker-1.3.0.pkg</strong> to get the <code class="literal">.pkg</code> file, as shown in the following screenshot:<div><img alt="Installation" src="img/3946OT_01_01.jpg"/></div></li><li class="listitem">Double-click <a class="indexterm" id="id15"/>on the downloaded <code class="literal">.pkg</code> file <a class="indexterm" id="id16"/>and go through with the installation <a class="indexterm" id="id17"/>process.</li><li class="listitem">Open the <strong>Finder</strong> window and navigate to your <code class="literal">Applications</code> folder; locate <strong>boot2docker</strong> and double-click on it. A terminal window will open and issue a few commands, as shown here:<div><img alt="Installation" src="img/3946OT_01_02.jpg"/></div><p>This runs a Linux VM, named <code class="literal">boot2docker-vm</code>, that has Docker pre-installed in VirtualBox. The Docker service in the VM runs in daemon (background) mode, and a Docker client is installed in OS X, which communicates directly with the Docker daemon inside the VM via the Docker Remote API.</p></li><li class="listitem">You will <a class="indexterm" id="id18"/>see a screen similar to the following<a class="indexterm" id="id19"/> screenshot, which tells you to set <a class="indexterm" id="id20"/>some environment variables:<div><img alt="Installation" src="img/3946OT_01_03.jpg"/></div><p>We open up the <code class="literal">~/.bash_profile</code> file and paste three lines from our output, as follows, at the end of this file:</p><div><pre class="programlisting">
<strong>export DOCKER_HOST=tcp://192.168.59.103:2376</strong>
<strong>export.DOCKER_CERT_PATH=/Users/xxx/.boot2docker/certs/boot2docker-vm</strong>
<strong>export DOCKER_TLS_VERIFY=1</strong>
</pre></div><p>The reason why we do this is so that our Docker client knows where to find the Docker daemon. If you want to find the IP in the future, you can do so by executing the <code class="literal">boot2docker ip</code> command. Adding the <a class="indexterm" id="id21"/>preceding lines will set these <a class="indexterm" id="id22"/>variables every time a new<a class="indexterm" id="id23"/> terminal session starts. When you're done, close the terminal window. Then, open a new window and type <code class="literal">echo $DOCKER_HOST</code> to verify that the environment variable is set as it should be. You should see the IP and port your boot2docker VM printed.</p></li><li class="listitem">Type <code class="literal">docker version</code> to verify that you can use the Docker command. An output that looks similar to the last few lines of the preceding screenshot will mean that we have succeeded.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Upgrading Docker on Mac OS X</h2></div></div></div><p>Since <a class="indexterm" id="id24"/>Docker is relatively new, there could be a lot happening in every update, so make sure that you check for updates on a regular basis. From<a class="indexterm" id="id25"/> time to time, go to the Mac OS X installer download page and check whether there is an upgrade available. If there is, execute these commands to update it:</p><div><pre class="programlisting">
<strong>boot2docker stop</strong>
<strong>boot2docker download</strong>
<strong>boot2docker start</strong>
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Docker on Windows</h1></div></div></div><p>Just as we have to install a Linux virtual machine when installing Docker in OS X, we have to do<a class="indexterm" id="id26"/> the same in Windows in order to run Docker because of the Linux kernel features that Docker builds on. OS X has a native Docker client <a class="indexterm" id="id27"/>that directly communicates with the Docker <a class="indexterm" id="id28"/>daemon inside the virtual machine, but there isn't one available for Windows yet. There is a native Windows version of the Docker client coming, but it will not be available by the time this book is published.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Installation</h2></div></div></div><p>There is a <a class="indexterm" id="id29"/>Windows installer that installs everything we need in order to run Docker. For this, go to <a class="ulink" href="https://github.com/boot2docker/windows-installer/releases/latest">https://github.com/boot2docker/windows-installer/releases/latest</a>.</p><p>Now, let's take a look at how the installation should be done with the help of the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the <strong>docker-install.exe</strong> button to download the <code class="literal">.exe</code> file, as shown in the <a class="indexterm" id="id30"/>following screenshot:<div><img alt="Installation" src="img/3946OT_01_04.jpg"/></div></li><li class="listitem">When the<a class="indexterm" id="id31"/> download is complete, run the <a class="indexterm" id="id32"/>downloaded installer. Follow through the installation process, and you will get VirtualBox, msysGit, and boot2docker installed.</li><li class="listitem">Go to your <code class="literal">Program Files</code> folder and click on the newly installed boot2docker to start using Docker. If you are prompted to enter a passphrase, just press <em>Enter</em>.</li><li class="listitem">Type <code class="literal">docker version</code> to verify that you can use the Docker command.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Upgrading Docker on Windows</h2></div></div></div><p>A new <a class="indexterm" id="id33"/>software changes often and to keep <code class="literal">boot2docker</code> updated, invoke<a class="indexterm" id="id34"/> these commands:</p><div><pre class="programlisting">
<strong>boot2docker stop</strong>
<strong>boot2docker download</strong>
<strong>boot2docker start</strong>
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Docker on Amazon EC2</h1></div></div></div><p>Throughout this book, I will use an Amazon EC2 instance, and since it is a superb place to host your PaaS, I <a class="indexterm" id="id35"/>will recommend that you do the same.</p><p>
<strong>EC2</strong> stands for <strong>E</strong>lastic <strong>C</strong>ompute <strong>C</strong>loud, and it is an infrastructure type of service. Amazon EC2 offers virtual servers that are created and available within a minute of ordering them.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>Amazon has instances named <code class="literal">t[x].micro</code> that you can use for free for 750 hours per month. You <a class="indexterm" id="id36"/>can read more about them at <a class="ulink" href="http://aws.amazon.com/free">http://aws.amazon.com/free</a>.</p></div></div><p>Amazon has its own Linux named Amazon Linux AMI that can be used to run Docker.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Installation</h2></div></div></div><p>Let's see <a class="indexterm" id="id37"/>how the installation is done with the following<a class="indexterm" id="id38"/> steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create <a class="indexterm" id="id39"/>an account at <a class="ulink" href="http://aws.amazon.com">http://aws.amazon.com</a> and go to Amazon's <strong>Create EC2 Instance Wizard</strong> at <a class="ulink" href="https://console.aws.amazon.com/ec2/v2/home?#LaunchInstanceWizard">https://console.aws.amazon.com/ec2/v2/home?#LaunchInstanceWizard</a>.<p>The next steps are shown in the screenshot as follows:</p><div><img alt="Installation" src="img/3946OT_01_05.jpg"/></div></li><li class="listitem">Click on <strong>Community AMIs</strong> in the menu on the left-hand side and select the latest <code class="literal">amzn-ami-pv</code>. Make sure that you select the <code class="literal">pv</code> version and not the <code class="literal">hvm</code> version so that you have a virtualization that is more stable and has less overhead, as shown here:<div><img alt="Installation" src="img/3946OT_01_06.jpg"/></div></li><li class="listitem">When it's<a class="indexterm" id="id40"/> time to choose an instance <a class="indexterm" id="id41"/>type, you can choose <strong>t1.micro</strong> or <strong>t2.micro</strong> for now if they are available. The micro instances are very limited<a class="indexterm" id="id42"/> in their performance, but since they are available in the free usage tier in some regions and this is not for a live site at the moment, we can use them. Click on <strong>Next: Configure Instance Details</strong> and then click on the <strong>Review and Launch</strong> button, as shown in the following screenshot:<div><img alt="Installation" src="img/3946OT_01_07.jpg"/></div></li><li class="listitem">Verify all the details on the <strong>summary</strong> page and click on the <strong>Launch Instance</strong> button.</li><li class="listitem">You will be prompted whether you want to use an existing key-pair or create a new one. If this is your first time creating an Amazon EC2 instance, you will want to create a new key-pair. This makes it easy to securely connect to your instances.</li><li class="listitem">Download the new key-pair, move it to your <code class="literal">~/.ssh/</code> folder, and remove the .<code class="literal">txt</code> extension.</li><li class="listitem">It's also important to set the correct user permissions on the file or SSH will refuse to use it.<p>In Linux or on a Mac, this is how the terminal command to do this looks:</p><div><pre class="programlisting">
<strong>mv ~/Downloads/amz.pem.txt ~/.ssh/amz.pem</strong>
<strong>chmod 600 ~/.ssh/amz.pem</strong>
</pre></div><p>On Windows, save the key anywhere and use a tool such as PuTTYgen to convert it to a <code class="literal">.ppk</code> file, so you can use it when connecting using PuTTY.</p></li><li class="listitem">You<a class="indexterm" id="id43"/> will be prompted to choose a security <a class="indexterm" id="id44"/>group for your instance. Pick <a class="indexterm" id="id45"/>the default one since this won't be a production server. When it's time to use a production server, we might want to add more security to our instance.</li><li class="listitem">Now we're up and running! Let's connect to it. Click on the <strong>View Instances</strong> button and select your newly created instance in the list, as shown here:<div><img alt="Installation" src="img/3946OT_01_08.jpg"/></div></li><li class="listitem">In the<a class="indexterm" id="id46"/> bottom of the screen, you can see <a class="indexterm" id="id47"/>some information about<a class="indexterm" id="id48"/> the instance. You should be looking for the public DNS information. This is how it should look:<div><pre class="programlisting">
<strong>ec2-54-187-234-27.us-west-2.compute.amazonaws.com</strong>
</pre></div></li><li class="listitem">On a Linux or Mac, open a terminal and connect to it:<div><pre class="programlisting">
<strong>ssh ec2-user@ec2-54-187-234-27.us-west-2.compute.amazonaws.com -i ~/.ssh/amz.pem</strong>
</pre></div><p>The screenshot is displayed as follows:</p><div><img alt="Installation" src="img/3946OT_01_09.jpg"/></div><p>We use<a class="indexterm" id="id49"/> the <code class="literal">ec2-user</code> user that is the <a class="indexterm" id="id50"/>default user for Amazon's<a class="indexterm" id="id51"/> Linux instances, and <code class="literal">amz.pem</code> is the key we downloaded earlier. Replace the URL with your public DNS information from the last step.</p><p>When asked whether you want to continue because of an unknown host, type <code class="literal">yes</code>.</p><p>On Windows, use PuTTY and make sure that you have specified the converted private key from step 4 in the PuTTY Auth tab.</p></li><li class="listitem">Once you are connected to the instance, install Docker:<div><pre class="programlisting">
<strong>sudo yum update</strong>
<strong>sudo yum install -y docker</strong>
<strong>sudo service docker start</strong>
</pre></div></li><li class="listitem">To test whether it's working as expected, type <code class="literal">docker version</code> and make sure<a class="indexterm" id="id52"/> there's no error. You should see a<a class="indexterm" id="id53"/> few lines with the client version, API <a class="indexterm" id="id54"/>version, and so on.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Open ports</h2></div></div></div><p>Amazon's <a class="indexterm" id="id55"/>default security policy is to block the default ports used to expose services from Docker, so we have to change this.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We go back to the EC2 dashboard and click on the <strong>Security Groups</strong> option in the menu</li><li class="listitem" style="list-style-type: disc">Select the security group that your EC2 instance uses and select the <strong>Inbound</strong> tab</li><li class="listitem" style="list-style-type: disc">Docker uses ports in a range from <strong>49000 - 50000</strong>, so we add a rule for this, as shown in the following screenshot:<div><img alt="Open ports" src="img/3946OT_01_10.jpg"/></div></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Upgrading Docker on Amazon EC2</h2></div></div></div><p>Upgrading<a class="indexterm" id="id56"/> an Amazon Linux AMI instance is as easy <a class="indexterm" id="id57"/>as it is for Ubuntu. Type <code class="literal">sudo yum update</code> and confirm whether there's an update waiting. This command will list all the available updates and upon your confirmation, install them.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>User permissions</h2></div></div></div><p>Docker<a class="indexterm" id="id58"/> requires commands to be run by users in the <code class="literal">docker</code> user group. For convenience, we add our user to the Docker group so that we can control Docker without using <code class="literal">sudo</code>:</p><div><pre class="programlisting">
<strong>sudo gpasswd -a ec2-user docker</strong>
</pre></div><p>You might have to log out and log in again for it to work. When you are logged back in, run <code class="literal">docker ps</code> to verify that there are no permission problems. You should see a row of capitalized words, such as <strong>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Displaying Hello World</h2></div></div></div><p>Now that we have Docker running on a machine of our choice, it's time to make Docker work for us. Here are a few very basic commands that we can use for some basic interaction <a class="indexterm" id="id59"/>with the Docker daemon.</p><p>In the next chapter, all the<a class="indexterm" id="id60"/> concepts and phrases used in Docker will be explained:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">docker ps</code>: This<a class="indexterm" id="id61"/> lists the running containers</li><li class="listitem" style="list-style-type: disc"><code class="literal">docker ps -a</code>: This<a class="indexterm" id="id62"/> lists all the containers, both <a class="indexterm" id="id63"/>running and exited</li><li class="listitem" style="list-style-type: disc"><code class="literal">docker images</code>: This<a class="indexterm" id="id64"/> lists local (downloaded <a class="indexterm" id="id65"/>and locally created) images</li><li class="listitem" style="list-style-type: disc"><code class="literal">docker run</code>: This <a class="indexterm" id="id66"/>will launch a new instance <a class="indexterm" id="id67"/>container from an image</li><li class="listitem" style="list-style-type: disc"><code class="literal">docker stop</code>: This<a class="indexterm" id="id68"/> is used to stop a container</li></ul></div><p>Let's try the first <a class="indexterm" id="id69"/>one in the screenshot shown below: </p><div><img alt="Displaying Hello World" src="img/3946OT_01_11.jpg"/></div><p>As expected, we have nothing running yet.</p><p>Launching a container is as easy as <code class="literal">docker run [image] [command]</code>. If the image doesn't exist locally, Docker will download it from the Docker Registry Hub and launch your container when it's downloaded.</p><p>The following steps are displayed as follows:</p><div><img alt="Displaying Hello World" src="img/3946OT_01_12.jpg"/></div><p>Type the<a class="indexterm" id="id70"/> following command in a terminal to launch a container that prints the string <strong>Hello, let me out of here</strong> and then exits:</p><div><pre class="programlisting">
<strong>docker run oskarhane/hello echo "Hello, let me out of here"</strong>
</pre></div><p>This is not very useful, but we just ran a command in Ubuntu inside the container.</p><p>If we type <code class="literal">docker ps</code> again, we can see that we still have no running containers since we exited the one <a class="indexterm" id="id71"/>we just started straightaway. Try using <code class="literal">docker ps -a</code> instead, and try <code class="literal">docker images</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Summary</h1></div></div></div><p>In this chapter, we learned that Docker can be used on most operating systems and that the installation process varies a lot depending on the OS. We had our first interaction with the Docker daemon and launched our first container in Docker. Even though all the container did was write a command, that's how easy it is to start and run something inside a guest operating system.</p><p>We have also introduced the theme that shows what this book is all about, running a multicontainer web app of a web server container and a MySQL container: your own PaaS.</p><p>In the next chapter, we will further explore Docker, its terminology, and the community around it.</p></div></body></html>