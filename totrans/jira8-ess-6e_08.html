<html><head></head><body>
		<div><h1 id="_idParaDest-219" class="chapter-number"><a id="_idTextAnchor220"/>8</h1>
			<h1 id="_idParaDest-220"><a id="_idTextAnchor221"/>Emails and Notifications</h1>
			<p>So far, you have learned how to use and interact with Jira directly from its web interface through a browser. We will now take a look at how Jira uses emails as a notification mechanism to alert you of updates.</p>
			<p>One powerful feature of Jira is its ability to create new issues, add comments to issues, and update issue details through emails. This provides you with a whole new option for how you and your users can interact with Jira.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Jira and email</li>
				<li>Mail servers</li>
				<li>Mail queues</li>
				<li>Events</li>
				<li>Notifications</li>
				<li>Batching email notifications</li>
				<li>Troubleshooting notifications</li>
				<li>Incoming emails</li>
				<li>The HR project</li>
			</ul>
			<h1 id="_idParaDest-221"><a id="_idTextAnchor222"/>Jira and email</h1>
			<p>Emails have <a id="_idIndexMarker581"/>become one<a id="_idIndexMarker582"/> of the most ubiquitous communication tools in today’s world. Businesses and individuals rely on emails to send and receive information around the world almost instantly. Therefore, it should come as no surprise that Jira is fully equipped and integrated with email support.</p>
			<p>Jira’s email support comes in several flavors:</p>
			<ul>
				<li>First, Jira sends emails to users about changes that have been made to their issues, such as adding comments, so people working on the same issue can be kept on the same page</li>
				<li>Second, Jira can poll mailboxes for emails and create issues and comments based on the content of the email</li>
				<li>The last feature is the ability for users to create and subscribe to filters to set up feeds in Jira (we will discuss filters in <a href="B18644_10.xhtml#_idTextAnchor292"><em class="italic">Chapter 10</em></a>, <em class="italic">Searching, Reporting, and Analysis</em>)</li>
			</ul>
			<p>These features open up a whole new dimension to how users can interact with Jira.</p>
			<p>In the following sections, we will look at what you need to do to enable Jira’s powerful email<a id="_idIndexMarker583"/> support, as<a id="_idIndexMarker584"/> well as explore the tools and options at your disposal so that you can configure Jira and email in a way that suits you.</p>
			<h1 id="_idParaDest-222"><a id="_idTextAnchor223"/>Mail servers</h1>
			<p>For Jira to communicate<a id="_idIndexMarker585"/> with emails, you need to configure or register your mail servers in Jira. There are two types of mail servers you need to configure:</p>
			<ul>
				<li><strong class="bold">Outgoing</strong>: This <a id="_idIndexMarker586"/>is used by Jira to send emails out to users. Jira supports <strong class="bold">SMTP</strong> mail servers.</li>
				<li><strong class="bold">Incoming</strong>: This is used by Jira to retrieve emails from users. Jira supports <strong class="bold">POP</strong> and <strong class="bold">IMAP</strong> servers.</li>
			</ul>
			<p>The following diagram shows how Jira interacts with various mail servers:</p>
			<div><div><img src="img/Figure_8.01_B18644.jpg" alt="Figure 8.1 – Mail servers&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Mail servers</p>
			<p>We will start with outgoing mail servers to see the different options we have to configure Jira to<a id="_idIndexMarker587"/> send emails to users, customize the email’s contents, enable SSL for additional security, and finally, send a test email.</p>
			<h2 id="_idParaDest-223"><a id="_idTextAnchor224"/>Working with outgoing mail</h2>
			<p>To configure<a id="_idIndexMarker588"/> the outgoing SMTP server, you <a id="_idIndexMarker589"/>will need the Jira system administrator’s global permission (the user that was created during the initial setup is a system administrator). Perform the following steps to manage the outgoing mail server:</p>
			<ol>
				<li>Log in to Jira as a Jira system administrator.</li>
				<li>Browse to the Jira administration console.</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Outgoing mail</strong> option. This will bring up the <strong class="bold">Outgoing mail</strong> page:</li>
			</ol>
			<div><div><img src="img/Figure_8.02_B18644.jpg" alt="Figure 8.2 – The Outgoing mail page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – The Outgoing mail page</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can only have one outgoing mail server in Jira.</p>
			<p>There are two ways to add an outgoing mail server in Jira. Both options have some <a id="_idIndexMarker590"/>common <a id="_idIndexMarker591"/>configuration parameters that you will need to fill in. The following table shows these parameters:</p>
			<div><div><table id="table001-5" class="No-Table-Style">
						<colgroup>
							<col/>
							<col/>
						</colgroup>
						<tbody>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Field</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Description</strong></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Name</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This specifies a name for the mail server.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Description</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This specifies a brief description of the mail server.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">From address</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This specifies an email address that outgoing emails will appear to have come from.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Email prefix</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This specifies a prefix that will appear with all the emails sent from Jira. This allows your users to set up filter rules in their mail clients. The prefix will be added to the beginning of the email subject.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Service Provider</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>Here, you can select from one of the three predefined mail providers – that is, Google, Yahoo!, or the custom SMTP server.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Host Name</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This specifies the hostname of your mail server (for example, <code>smtp.example.com</code>).</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">SMTP Port</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This specifies the port number that your mail server will be running on. This is optional; if left blank, the default port number of 25 will be used.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Username</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is used to authenticate against the mail server if required. Note that mail servers may require authentication to relay emails to non-local users.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Password</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is used to authenticate the user against the mail server if required.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">JNDI Location</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the JNDI lookup name if you already have a mail server configured for your application server. Refer to the following section for details.</p>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 8.1 – Outgoing mail server configuration</p>
			<p>For the rest of<a id="_idIndexMarker592"/> the <a id="_idIndexMarker593"/>parameters, depending on the option you select to set up your mail server, you only need to fill in the appropriate details.</p>
			<h3>Configuring an SMTP server</h3>
			<p>The first option is <a id="_idIndexMarker594"/>to select from one of the built-in service providers and specify the mail server’s details. For example, if you have an SMTP mail server running, you can select the <strong class="bold">Custom</strong> option from the <strong class="bold">Service Provider</strong> field and specify the host and port number. This is the approach most people will use as it is straightforward. With this approach, the administrator fills in the mail server’s host information, such as the hostname and port number. To do so, follow these steps:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">Outgoing mail</strong> page.</li>
				<li>Click on the <strong class="bold">Configure new SMTP mail server</strong> button.</li>
				<li>Enter the general details of your mail server, including the name, descriptio<a id="_idTextAnchor225"/>n, from address, and email prefix.</li>
				<li>Select the type of mail server from the <strong class="bold">Service Provider</strong> field.</li>
				<li>Enter the mail server’s connection details.</li>
				<li>Click on the <strong class="bold">Test Connection</strong> button to verify the configuration.</li>
				<li>Click on the <strong class="bold">Add</strong> button <a id="_idIndexMarker595"/>to register to the mail server:</li>
			</ol>
			<div><div><img src="img/Figure_8.03_B18644.jpg" alt="Figure 8.3 – The Add SMTP Mail Server page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – The Add SMTP Mail Server page</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Jira comes <a id="_idIndexMarker596"/>with support for Google and Yahoo! mail services. You can select these options in the <strong class="bold">Service Provider</strong> field if you are using these services.</p>
			<h3>Configuring an SMTP server with JNDI</h3>
			<p>The <a id="_idIndexMarker597"/>second<a id="_idIndexMarker598"/> option is to use the <strong class="bold">Java Naming and Directory Interface</strong> (<strong class="bold">JNDI</strong>). This approach is slightly more complicated as it requires configuration on the application server itself, and it requires you to restart Jira.</p>
			<p>If you are using the standalone distribution, which uses Apache Tomcat, the JNDI location will be <code>java:comp/env/mail/JiraMailServer</code>. You will also need to specify the mail server details as a JNDI resource in the <code>server.xml</code> file in the <code>JIRA_INSTALL/conf</code> directory.</p>
			<p>A sample declaration is shown in the following code snippet. You will need to substitute some values with the real values for some of the parameters in the code of your mail server’s details:</p>
			<pre class="source-code">
&lt;Resource name="mail/JiraMailServer" auth="Container" type="javax.mail.Session"
  mail.smtp.host="mail.server.host"
  mail.smtp.port="25"
  mail.transport.protocol="smtp"
  mail.smtp.auth="true"
  mail.smtp.user="username"
  password="password"
/&gt;</pre>
			<p>You will need to restart Jira after saving your changes to the <code>server.xml</code> file.</p>
			<h2 id="_idParaDest-224"><a id="_idTextAnchor226"/>Disabling outgoing mail</h2>
			<p>If you are <a id="_idIndexMarker599"/>running<a id="_idIndexMarker600"/> a test or evaluation Jira instance, or testing changes that you have made to your configurations, you might not want to flood your users with test emails. The easiest way for you to disable all outgoing emails is by just clicking on the <strong class="bold">Disable outgoing mail</strong> button. This will stop Jira from sending all emails as a result of issue updates. Once you are ready to send emails again, you can click on the <strong class="bold">Enable outgoing mail</strong> button.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Disabling outgoing mail will only prevent Jira from sending out notification emails based on notification schemes.</p>
			<h2 id="_idParaDest-225"><a id="_idTextAnchor227"/>Enabling SMTP over SSL</h2>
			<p>To increase security, you<a id="_idIndexMarker601"/> can encrypt the communication <a id="_idIndexMarker602"/>between Jira and your mail server if your <a id="_idIndexMarker603"/>mail server supports SSL. Two steps are involved in enabling SSL over SMTP in Jira:</p>
			<ol>
				<li value="1">The first step is to import your mail server’s SSL certificate into Java’s trust store. You can do this with Java’s <code>keytool</code> utility. On a Windows machine, run the following command in the Command Prompt:<pre><strong class="bold">keytool -import -alias mail.yourcompany.com -keystore $JAVA_HOME/jre/lib/security/cacerts -file yourcertificate</strong></pre></li>
				<li>The second step is to configure your application server to use SSL for mail communication. The following declaration is for Apache Tomcat, which is used by Jira standalone. We can use the same configuration file and only need to add two additional parameters:<pre>&lt;Resource name="mail/JiraMailServer"
  auth="Container"
  type="javax.mail.Session"
  mail.smtp.host="mail.server.host"
  mail.smtp.port="25"
  mail.transport.protocol="smtp"
  mail.smtp.auth="true"
  mail.smtp.user="username"
  password="password"
  mail.smtp.atarttls.enabled="true"
  mail.smtp.socketFactory.class="javax.net.ssl.SSLSocketFactory"
/&gt;</pre></li>
			</ol>
			<p>Once you have imported your certificate and configured your mail server, you will have to restart Jira.</p>
			<h2 id="_idParaDest-226"><a id="_idTextAnchor228"/>Sending a test email</h2>
			<p>It is always a <a id="_idIndexMarker604"/>good idea <a id="_idIndexMarker605"/>to send a test email after you configure your SMTP mail server to make sure that the server is running and that you have set it correctly in Jira. Here is how to go about it:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">Outgoing mail</strong> page.</li>
				<li>Click on the <strong class="bold">Send a test email</strong> link for your SMTP mail server.</li>
				<li>Click on the <strong class="bold">Send</strong> button to send the email. Jira will autofill the <strong class="bold">To</strong> address based on the user you have logged in as.</li>
			</ol>
			<p>If everything is correct, you will see a confirmation message in the <strong class="bold">Mail log</strong> section and receive the email in your inbox. If there are errors, such as an error with the mail server connection, then the <strong class="bold">Mail log</strong> section will display these problems. This is very useful when troubleshooting<a id="_idIndexMarker606"/> any problems with Jira’s connectivity with the <a id="_idIndexMarker607"/>SMTP server:</p>
			<div><div><img src="img/Figure_8.04_B18644.jpg" alt="Figure 8.4 – Testing the outgoing mail server&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – Testing the outgoing mail server</p>
			<p>In the preceding screenshot, you can see that the test email delivery has failed, and the error is because Jira was unable to connect to the configured SMTP server.</p>
			<p>We have now looked at how you can add an outgoing SMTP mail server in Jira, and send out <a id="_idIndexMarker608"/>test<a id="_idIndexMarker609"/> emails. In the next section, we will look at Jira’s mail delivery mechanism.</p>
			<h1 id="_idParaDest-227"><a id="_idTextAnchor229"/>Mail queues</h1>
			<p>Most emails in Jira are<a id="_idIndexMarker610"/> not sent immediately when an operation is performed. Instead, they are placed in a queue, which Jira will process periodically. This is very similar to the real-life scenario where mail is placed in mailboxes and picked up every day by postal workers. In this section, we will take a look at Jira’s mail queue, and how to use it to help identify and troubleshoot if outgoing emails are stuck.</p>
			<h2 id="_idParaDest-228"><a id="_idTextAnchor230"/>Viewing the mail queue</h2>
			<p>Normally, you do<a id="_idIndexMarker611"/> not need to manage the mail queue. Jira automatically places emails into the queue and processes them periodically. However, as an administrator, there may be times when you wish to inspect the mail queue, especially to troubleshoot problems related to Jira notification emails. Sometimes, emails can get stuck, and inspecting the mail queue will help you identify these problems and fix them.</p>
			<p>Perform the following steps to view the content of the mail queue:</p>
			<ol>
				<li value="1">Browse to the Jira administration console.</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Mail queue</strong> option:</li>
			</ol>
			<div><div><img src="img/Figure_8.05_B18644.jpg" alt="Figure 8.5 – The Mail queue page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – The Mail queue page</p>
			<p>This page provides you with a one-page view of the current emails in the queue that are waiting for<a id="_idIndexMarker612"/> delivery. There are two queues – <strong class="bold">Mail queue</strong> and <strong class="bold">Error queue</strong>:</p>
			<ul>
				<li>The <strong class="bold">Mail queue</strong> tab contains all the emails that are pending delivery. If Jira can successfully deliver these emails, they will be removed from the queue. Any items listed in red indicate that Jira has unsuccessfully attempted to send those emails. Jira will retry 10 times, and if still unsuccessful, these items will be moved to the error queue.</li>
				<li>The <strong class="bold">Error queue</strong> tab contains emails that cannot be delivered by Jira. You can choose to resend all the failed items in the error queue or delete them.</li>
			</ul>
			<h2 id="_idParaDest-229"><a id="_idTextAnchor231"/>Flushing the mail queue</h2>
			<p>While Jira automatically<a id="_idIndexMarker613"/> flushes the mail queue, you can also manually flush the queue if you want to send out emails immediately. When you manually flush the queue, Jira will try to send all the emails that are currently in the queue.</p>
			<p>Perform the following steps to manually flush the mail queue:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">Mail queue</strong> page.</li>
				<li>Click on the <strong class="bold">Flush mail queue</strong> button</li>
			</ol>
			<p>If Jira is successful in sending emails, you will see the queue shrink and the items disappear. If some emails fail to be delivered, those items will be highlighted in red. The mail queue is used when Jira automatically sends out emails, as we will see in the next section. When you <a id="_idIndexMarker614"/>manually send out emails in Jira, those emails are sent out immediately.</p>
			<h1 id="_idParaDest-230"><a id="_idTextAnchor232"/>Manually sending emails</h1>
			<p>Sometimes, you, as<a id="_idIndexMarker615"/> the administrator, may need to send out emails containing important messages to your users. For example, if you are planning some maintenance work that will take Jira offline for an extended period, you may want to send an email to all Jira users to let them know of the outage.</p>
			<p>Jira has a built-in facility where you can manually send out emails to specific groups of users. There are two options when manually sending emails – you can send them in groups or by projects.</p>
			<p>When sending them in groups, all you need to do is select one or more groups in Jira, and all users that belong to the selected groups will receive the email. Users belonging to more than one group will not receive duplicated emails.</p>
			<p>When sending emails by projects, you need to select one or more projects and then the project roles. We will discuss project roles in more detail in the next chapter, but for now, you can think of them as groups of users within projects. For example, you can send emails to all users that are part of <strong class="bold">Demonstration Project</strong> rather than all users in Jira.</p>
			<p>To send emails to users in Jira, perform the following steps:</p>
			<ol>
				<li value="1">Browse to the Jira administration console</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Send email</strong> option</li>
				<li>Choose whether you want to send to users by <strong class="bold">Project Roles</strong> or <strong class="bold">Groups</strong></li>
				<li>Enter the email’s <strong class="bold">Subject</strong> and <strong class="bold">Body</strong> content</li>
				<li>Click on the <strong class="bold">Send</strong> button to send the email to all users in the selected project roles/groups</li>
			</ol>
			<p>The following screenshot shows an example of sending maintenance outage notification emails to everyone by selecting the <strong class="bold">jira-software-users</strong> group, which every Jira Software user is a<a id="_idIndexMarker616"/> member of by default:</p>
			<div><div><img src="img/Figure_8.06_B18644.jpg" alt="Figure 8.6 – The Send email page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – The Send email page</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Since Jira does not provide a <strong class="bold">What You See Is What You Get</strong> (<strong class="bold">WYSIWYG</strong>) editor for composing <a id="_idIndexMarker617"/>emails, you may want to draft an email and send it to yourself before sending it out to everyone.</p>
			<p>Now that we have seen how to configure an outgoing mail server in Jira and send emails, let’s take <a id="_idIndexMarker618"/>a deeper look at how Jira automates email notifications when users perform actions on issues.</p>
			<h1 id="_idParaDest-231"><a id="_idTextAnchor233"/>Events</h1>
			<p>Jira is an event-driven <a id="_idIndexMarker619"/>system. This means that when an action occurs (for example, when an issue is created), Jira will fire off a corresponding event. This event is then picked up by components that are designed to listen to the event. These are called <strong class="bold">listeners</strong>. When <a id="_idIndexMarker620"/>a listener picks up an event, it will perform its duty, such as keeping issues up to date with changes or sending an email to users who are watching the issue.</p>
			<p>This mechanism allows Jira to process operations asynchronously. The advantage of this model is operations, such as sending emails, are separated from Jira’s core functions, such as issue creation. If there is a problem with the mail server, for example, you will not want this problem to prevent your users from creating issues.</p>
			<p>There are two types of <a id="_idIndexMarker621"/>events in Jira:</p>
			<ul>
				<li><strong class="bold">System events</strong>: These are<a id="_idIndexMarker622"/> internal events that are used by Jira, and they <a id="_idIndexMarker623"/>usually represent the main functionalities in Jira. They cannot be added, edited, or deleted.</li>
				<li><code>post</code> functions.</li>
			</ul>
			<p>As an administrator, you will be able to get a one-page view of all the events in Jira. You just need to do the following:</p>
			<ol>
				<li value="1">Browse to the Jira administration console.</li>
				<li>Select the <strong class="bold">System</strong> tab and<a id="_idIndexMarker626"/> then the <strong class="bold">Events</strong> option. This will bring up the <strong class="bold">View Events</strong> page:</li>
			</ol>
			<div><div><img src="img/Figure_8.07_B18644.jpg" alt="Figure 8.7 – Issue events&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7 – Issue events</p>
			<p>Each event is associated with a template, which is often referred to <a id="_idIndexMarker627"/>as a <strong class="bold">mail template</strong>. These templates define the content structure of emails when notifications are sent. For system events, you cannot change their templates (you can change the template file’s content, however). For custom events, you can choose to use one of the existing templates or create your own mail template.</p>
			<p>In the following sections, we will look at how to create and register custom mail templates, create a<a id="_idIndexMarker628"/> new custom event to use the new template, and fire the new event when actions are performed on an issue. After that, we will look at how to tie events to notifications so that we can tell Jira who should receive notification emails for the event.</p>
			<h2 id="_idParaDest-232"><a id="_idTextAnchor234"/>Working with mail templates</h2>
			<p>Mail templates<a id="_idIndexMarker629"/> are physical files that you create and edit via a text editor. Jira has a set of default templates for all the system events. Instead of modifying them directly, Jira lets you upload your modified version of the templates and override the default. For us to create a new mail template, we can also look at these existing templates and use them as a starting point. You can download the default templates by following these steps:</p>
			<ol>
				<li value="1">Browse to the Jira administration console</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Email templates</strong> option</li>
				<li>Click on the <strong class="bold">Download .zip</strong> button</li>
			</ol>
			<p>This will download all the default templates in a <code>.zip</code> file. Once you unzip it, you will see two main directories – <code>email</code> and <code>email-batch</code>. The <code>email</code> directory is what we will focus on for now, as it contains all the mail templates for the event. Inside the <code>email</code> directory, you will see the following subdirectories:</p>
			<ul>
				<li><code>css directory</code>: Contains CSS files to apply styles to the email</li>
				<li><code>html directory</code>: Contains templates when Jira is sending out emails as HTML</li>
				<li><code>includes directory</code>: Contains common content that is shared between one or more templates</li>
				<li><code>subject directory</code>: Contains templates that are used to generate the email’s subject</li>
				<li><code>text directory</code>: Contains templates when Jira is sending out emails as plain text</li>
			</ul>
			<p>As we can see, for <a id="_idIndexMarker630"/>a given mail template used by the issue event, there are at least three components – subject, HTML, and text. So, if you want to add a new template for a custom event, you will need to create those three files and place them in those directories accordingly. And if you want to modify an existing mail template, make sure you make your changes to all the necessary files, usually in both the HTML and text directories.</p>
			<p>While creating new mail templates, it is a good practice to name your template files after the issue event, for example, <code>issueescalated.vm</code>. This will help future users understand the purpose of those templates.</p>
			<p>Mail templates use Apache’s Velocity template language (<a href="http://velocity.apache.org">http://velocity.apache.org</a>). For this reason, creating new mail templates will require some understanding of HTML and template programming.</p>
			<p>If your templates only contain static text, you can simply use standard HTML tags for your template. However, if you need to have dynamic data rendered as part of your templates, such as the issue key or summary, you will need to use the Velocity syntax. A full explanation of Velocity is beyond the scope of this book. The following paragraph provides a quick introduction to creating simple mail templates for Jira. You can find more information on Velocity and its usage in Jira mail templates at <a href="https://confluence.atlassian.com/adminjiraserver0822/customizing-email-content-1142237912.html">https://confluence.atlassian.com/adminjiraserver0822/customizing-email-content-1142237912.html</a>.</p>
			<p>In a Velocity template, all the text will be treated as normal. Anything that starts with a dollar sign (<code>$</code>), such as <code>$issue</code>, is a Velocity statement. The <code>$</code> sign tells Velocity to reference the item after the sign, and, when combined with a period (<code>.</code>), you can retrieve the value specified. For example, the following code in a template will get the issue key and summary from the current issue, separated by a <code>-</code> character:</p>
			<pre>$issue.key - $issue.summary</pre>
			<p>This will produce content similar to <code>DEMO-1 - This is a demo issue</code>.</p>
			<p>Jira provides a <a id="_idIndexMarker631"/>range of Velocity references that you can use to create mail templates. These references allow you to access data such as the issue being updated and the user triggering the event. You can find a comprehensive list at <a href="https://developer.atlassian.com/server/jira/platform/jira-templates-and-jsps/#email-templates">https://developer.atlassian.com/server/jira/platform/jira-templates-and-jsps/#email-templates</a>.</p>
			<p>Now that you have a basic understanding of how Velocity works, you need to create a template for the mail subject. The following code shows a typical subject template:</p>
			<pre>$eventTypeName: ($issue.key) $issue.summary</pre>
			<p>When the template is processed, Jira will substitute the actual values for the event type (for example, issue created), issue key, and issue summary. Therefore, the preceding example would produce content similar to <code>Issue Escalated: HD-11: Database server is running very slow</code>.</p>
			<p>Then, you need to create a template for the actual email content. Here, you need to create a text and HTML version. The following code shows a simple example of a text-based template, which displays the key for the escalated issue:</p>
			<pre class="source-code">
Hello,
The ticket $issue.key has been escalated and is currently being worked on.  We will contact you if we require more information.
Regards
Support team.</pre>
			<p>Before Jira sends out the email, the preceding text will be processed, where all Velocity references, such as <code>$issue.key</code>, will be converted into proper values; for example, DEMO-1.</p>
			<p>Once you have either updated or created your mail templates, you will need to upload them to Jira. Here’s how to do that:</p>
			<ol>
				<li value="1">Zip up your mail templates</li>
				<li>Browse to the Jira administration console</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Email templates</strong> option</li>
				<li>Click on the <code>.zip</code> file you created</li>
				<li>Click on the <strong class="bold">Apply</strong> button once Jira has verified your template’s content</li>
			</ol>
			<p>Once the updated templates have been uploaded, it can take up to 5 minutes for the changes to take effect. If you are simply modifying existing templates, then that is all you need to do, but <a id="_idIndexMarker632"/>if you are adding new templates, you will need to register them with Jira.</p>
			<p>To register your new templates, locate and open the <code>email-templates-id-mappings.xml</code> file in the <code>&lt;JIRA_INSTALL&gt;/atlassian-jira/WEB-INF/classes</code> directory in a text editor.</p>
			<p>Add a new entry to the end of the file before closing the <code>&lt;/templatemappings&gt;</code> tag, as follows:</p>
			<pre class="source-code">
&lt;templatemapping id="10001"&gt;
  &lt;name&gt;Example Custom Event&lt;/name&gt;
  &lt;template&gt;examplecustomevent.vm&lt;/template&gt;
  &lt;templatetype&gt;issueevent&lt;/templatetype&gt;
&lt;/templatemapping&gt;</pre>
			<p>Here, we have registered a new custom mail template entry. The details of this are shown in the following table:</p>
			<div><div><table id="table002-3" class="No-Table-Style">
						<colgroup>
							<col/>
							<col/>
						</colgroup>
						<tbody>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold" lang="en-US" xml:lang="en-US">Parameter</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p><strong class="bold" lang="en-US" xml:lang="en-US">Description</strong></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><code>id</code></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the unique ID for the template. You need to make sure that no other template mapping has the same ID.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><code>name</code></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is a human-readable name for Jira to display.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><code>template</code></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>These are the mail template filenames for subject, text, and HTML. All three template files must be named as specified here.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><code>type</code></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the template type. For events that are generated from an issue, the value will be <code>issueevent</code>.</p>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 8.2 – Email template ID mapping parameters</p>
			<p>After creating your templates and registering them in the mapping file, you will have to restart Jira for <a id="_idIndexMarker633"/>the changes to be picked up. The new templates will be available when we create new events, which we will discuss in the following section.</p>
			<h2 id="_idParaDest-233"><a id="_idTextAnchor235"/>Adding a custom event</h2>
			<p>Jira comes <a id="_idIndexMarker634"/>with a comprehensive list of system events that are focused on issue-related operations. However, there will be times when you will need to create custom-designed events that represent specialized business operations, or when you simply need to use a custom email template.</p>
			<p>Perform the following steps to add a new custom event:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">View Events</strong> page.</li>
				<li>Enter a name and description for the new event in the <strong class="bold">Add New Event</strong> section.</li>
				<li>Select the mail template for the new event. If you have registered a new mail template, you can select it for the event.</li>
				<li>Click on the <strong class="bold">Add</strong> button to create a new event:</li>
			</ol>
			<div><div><img src="img/Figure_8.08_B18644.jpg" alt="Figure 8.8 – The Add New Event page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.8 – The Add New Event page</p>
			<p>With that, we have added a new event to Jira and assigned a custom email template to it. We will look at how <a id="_idIndexMarker635"/>we can fire our new event in the next section.</p>
			<h2 id="_idParaDest-234"><a id="_idTextAnchor236"/>Firing a custom event</h2>
			<p>Unlike system <a id="_idIndexMarker636"/>events, with custom events, you need to tell Jira when it can fire a custom event.</p>
			<p>Custom events are mostly fired by workflow transitions. Recall from <a href="B18644_07.xhtml#_idTextAnchor187"><em class="italic">Chapter 7</em></a>, <em class="italic">Workflow and Business Process</em>, that you can add post functions to workflow transitions. Almost all of Jira’s transitions will have post functions that fire appropriate events. It is important to understand that just because an event is fired does not mean that there needs to be something to listen to it.</p>
			<p>If you skipped <a href="B18644_07.xhtml#_idTextAnchor187"><em class="italic">Chapter 7</em></a>, <em class="italic">Workflow and Business Process</em>, or still do not have a good understanding of workflows, now would be a good time to go back and revisit that chapter.</p>
			<p>Perform the following steps to fire a custom event from a workflow post function:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">View Workflows</strong> page.</li>
				<li>Click on the <strong class="bold">Edit</strong> link of the workflow that will be used to fire the event.</li>
				<li>Click on the transition that will fire the event when executed.</li>
				<li>Click on the <strong class="bold">Post Functions</strong> tab.</li>
				<li>Click on the <code>post</code> function that reads <strong class="bold">Fire a &lt;event name&gt; event that can be processed by the listeners</strong>:</li>
			</ol>
			<div><div><img src="img/Figure_8.09_B18644.jpg" alt="Figure 8.9 – Firing an issue event&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.9 – Firing an issue event</p>
			<ol>
				<li value="6">Select the custom event from the drop-down list.</li>
				<li>Click on the <strong class="bold">Update</strong> button to apply any changes to the post function.</li>
				<li>Publish the workflow.</li>
			</ol>
			<p>Now, whenever the workflow transition is executed, the post function will run and fire the selected<a id="_idIndexMarker637"/> event. With events covered, in the next section, we will look at how we can configure Jira to listen for these events and send out notifications accordingly.</p>
			<h1 id="_idParaDest-235"><a id="_idTextAnchor237"/>Notifications</h1>
			<p>Notifications associate events (both system and custom) to email recipients. When an event is fired and<a id="_idIndexMarker638"/> picked up, emails will be sent out. Notification types define the recipients of emails. For example, you can set them to only send emails to a specific user or all members from a given user group. You can add multiple notifications to a given event.</p>
			<p>Jira ships with a comprehensive list of notification types (that is, the recipients) that will cover many of your needs. The following table lists all the notification types that are available and<a id="_idIndexMarker639"/> how they work:</p>
			<div><div><table id="table003-3" class="No-Table-Style">
						<colgroup>
							<col/>
							<col/>
						</colgroup>
						<tbody>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Notification Type</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Description</strong></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Current Assignee</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the current assignee of the issue.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Reporter</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the reporter of the issue (usually the person who created the issue).</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Current User</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the user who fired the event.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Project Lead</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the lead of the project that the issue belongs to.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Component Lead</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This is the lead of the component that the issue belongs to.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Single User</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states any user that exists in Jira.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Group</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states that all users belong to the specified group.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Project Role</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states that all users belong to the specified project role.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Single Email Address</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states any email address.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>All Watchers</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states that all users are watching this issue.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>User Custom Field Value</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states the users specified in the <code>user-type</code> custom field. For example, if you have a User Picker Custom Field called Recipient, the user that’s selected in the custom field will receive notifications if they have access to the issue.</p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Group Custom Field Value</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This states all users that belong to the group in the <code>group-type</code> custom field. For example, if you have a Group Picker Custom Field called Approvers, all users from the group (with access to the issue) that are selected in the custom field will receive notifications.</p>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – Notification types</p>
			<p>As you can see, the list includes a wide range of options, from issue reporters to values contained in custom fields. Anything that can be represented as a user such as Project Lead, or contains user values such as User Custom Field Value, can be chosen to receive notifications.</p>
			<p>If a user belongs to more than one notification for a single event, Jira will make sure that only one email will be sent so that the user does not receive duplicates. For a user to receive notifications, the user must have permission to view the issue. The only exception to this is when using the single email address option (we will discuss security in <a href="B18644_09.xhtml#_idTextAnchor256"><em class="italic">Chapter 9</em></a>, <em class="italic">Securing Jira</em>). If the user does not have permission to view the issue, Jira will not send a notification email.</p>
			<p>So, now that can<a id="_idIndexMarker640"/> create custom events, create and modify mail templates, and control when events are fired, we will look at how to add notifications to events so that users can start receiving emails via a notification scheme.</p>
			<h2 id="_idParaDest-236"><a id="_idTextAnchor238"/>Notification schemes</h2>
			<p>A notification <a id="_idIndexMarker641"/>scheme is a reusable entity that links events with notifications. In other words, it contains the associations between events and their respective email recipients. In this section, we will cover notification schemes and how you can use them to send out notification emails when an event occurs in Jira.</p>
			<p>To manage notification schemes in Jira, follow these steps:</p>
			<ol>
				<li value="1">Browse to the Jira administration console.</li>
				<li>Select the <strong class="bold">Issues</strong> tab and then the <strong class="bold">Notification Schemes</strong> option. This will bring up the <strong class="bold">Notification Schemes</strong> page:</li>
			</ol>
			<div><div><img src="img/Figure_8.10_B18644.jpg" alt="Figure 8.10 – The Notification Schemes page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.10 – The Notification Schemes page</p>
			<p>From this screen, you can see a list of all the notification schemes and the projects that are currently using them. Jira comes with a generic default notification scheme. The default scheme is set up with notifications set for all the system events. This allows you to quickly enable notifications in Jira. The default setup has the following notifications:</p>
			<ul>
				<li><strong class="bold">Current Assignee</strong></li>
				<li><strong class="bold">Reporter</strong></li>
				<li><strong class="bold">All Watchers</strong></li>
			</ul>
			<p>You can modify the default notification scheme to add your own notification rules, but as you grow your <a id="_idIndexMarker642"/>Jira adoption, it is a better idea to create a new scheme from scratch or copy the default scheme and make your modifications there.</p>
			<h2 id="_idParaDest-237"><a id="_idTextAnchor239"/>Adding a notification scheme</h2>
			<p>Unlike other schemes<a id="_idIndexMarker643"/> such as the workflow scheme, where Jira will create one whenever a new project is created, all new projects will be set to use the <strong class="bold">Default Notification Scheme</strong> option. So, if you want to create notifications that are specific to your project, you will have to create a new notification scheme. Perform the following steps to create a new notification scheme:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">Notification Schemes</strong> page</li>
				<li>Click on the <strong class="bold">Add notification scheme</strong> link at the bottom</li>
				<li>Enter a name and description for the new notification scheme</li>
				<li>Click on the <strong class="bold">Add</strong> button to create the notification scheme</li>
			</ol>
			<p>When you create a new notification scheme, you create a blank scheme that can be configured later so that you can add your own notification rules to it. You must configure its notification rules before applying the scheme to projects after you create a new notification scheme; otherwise, no notifications will be sent out. We will look at how to configure notification rules later in this chapter.</p>
			<h2 id="_idParaDest-238"><a id="_idTextAnchor240"/>Managing a notification scheme</h2>
			<p>Notification<a id="_idIndexMarker644"/> schemes contain notifications that are set on events in Jira. A notification determines who will receive an email when the corresponding event is fired. Perform the following steps to add a new notification:</p>
			<ol>
				<li value="1">Click on the <strong class="bold">Notifications</strong> link for the notification scheme you wish to configure.</li>
				<li>Click on the <strong class="bold">Add Notification</strong> link or the <strong class="bold">Add</strong> link for the event you wish to add a notification for. Both actions will bring you to the <strong class="bold">Add Notification</strong> page. If you click on the <strong class="bold">Add</strong> link, the <strong class="bold">Events selection</strong> list will preselect the event for you.</li>
				<li>Select the events you want to add the notification type to.</li>
				<li>Select the notification type from the available options.</li>
				<li>Click on the <strong class="bold">Add</strong> button. For example, the following screenshot shows setting up a notification for Jira to send out emails to the project lead when issues are created and updated:</li>
			</ol>
			<div><div><img src="img/Figure_8.11_B18644.jpg" alt="Figure 8.11 – The Add Notification page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.11 – The Add Notification page</p>
			<p>Once added, the<a id="_idIndexMarker645"/> notification will be listed against the events that have been selected. You can continue adding notifications for the events by repeating the same steps.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can select multiple events to add a notification type to.</p>
			<p>When notifications are no longer required for certain events, you can also have them removed. To remove notifications, you will need to do so one by one, per event:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">Edit Notifications</strong> page for the notification scheme you wish to configure</li>
				<li>Click on the <strong class="bold">Delete</strong> link for the notification you wish to remove</li>
				<li>Click on the <strong class="bold">Delete</strong> button to confirm the removal</li>
			</ol>
			<p>After you remove a notification, users affected by that notification will stop receiving emails from Jira. However, you need to pay attention to your configurations, as there may be other notifications for the same event that will continue to send emails to the same user. For example, if you created two notifications for the issue-created event – one set to a single user, John (who belongs to the <code>jira-administrator</code> group), and another set to the jira-administrator group – and your goal is to prevent emails from being sent to <a id="_idIndexMarker646"/>the user, John, you will need to remove both notifications from the event instead of simply using the <strong class="bold">Single User</strong> option.</p>
			<h2 id="_idParaDest-239"><a id="_idTextAnchor241"/>Assigning a notification scheme</h2>
			<p>When new<a id="_idIndexMarker647"/> projects are created, they are automatically assigned to use the default notification scheme. If you want your project to use a different scheme, you will need to go to the <strong class="bold">Notifications</strong> section of your project’s administration console:</p>
			<ol>
				<li value="1">Browse to the project administration page for the project you want to apply the notification scheme to.</li>
				<li>Select the <strong class="bold">Notifications</strong> option from the left panel:</li>
			</ol>
			<div><div><img src="img/Figure_8.12_B18644.jpg" alt="Figure 8.12 – Associating a notification scheme&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.12 – Associating a notification scheme</p>
			<ol>
				<li value="3">Select <strong class="bold">Use a different scheme</strong> from the <strong class="bold">Actions</strong> menu.</li>
				<li>Select the notification scheme to use.</li>
				<li>Click on the <strong class="bold">Associate</strong> button.</li>
			</ol>
			<p>As soon as a <a id="_idIndexMarker648"/>notification scheme is applied to the project, it will take effect immediately, and you will see emails being sent out for the events that have been configured in the scheme. Like any other schemes in Jira, notification schemes can be assigned to multiple projects so that they can share the same notification behavior.</p>
			<p>With so many notifications, users can often get overwhelmed by the number of emails Jira will send out. In the next section, we will take a look at how we can help reduce the number of notification emails users receive by batching them together.</p>
			<h1 id="_idParaDest-240"><a id="_idTextAnchor242"/>Batching email notifications</h1>
			<p>One common <a id="_idIndexMarker649"/>complaint users have about Jira’s email notifications is their frequency. Every change that’s made to the same issue will trigger an email to be sent, and for a busy team that’s constantly updating issues, such as adding comments, this can very quickly cause a storm of emails being sent that flood users’ inboxes. To help alleviate this challenge, Jira 8 has introduced the feature of batch email notifications. The way this works is as follows – all changes that are made to a given issue in the past 10 minutes will be batched into a single summary email, so the user will only receive one email for these changes instead of one per change. This helps significantly reduce the amount of clutter that’s generated as a result of frequent updates that are made to issues. To enable email batching, follow these steps:</p>
			<ol>
				<li value="1">Browse to the Jira administration console</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Batching email notifications</strong> option</li>
				<li>Check the <strong class="bold">Batching email notifications</strong> option to enable it</li>
			</ol>
			<p>As this is a new feature that was added in Jira 8, improvements are being planned for future releases, such as adding support for including custom field values in the summary email and having a customizable batching option.</p>
			<p>Now that we have covered email notifications, we will see the tools provided by Jira to help us troubleshoot issues related to notifications.</p>
			<h1 id="_idParaDest-241"><a id="_idTextAnchor243"/>Troubleshooting notifications</h1>
			<p>Often, when<a id="_idIndexMarker650"/> people do not receive notifications from Jira, it can be difficult and frustrating to find the cause. The two most common causes of notification-related problems are either outgoing mail server connectivity or misconfiguration of the notification scheme.</p>
			<p>Troubleshooting outgoing mail server problems is quite simple. All you have to do is try to send out a test email, as described in the <em class="italic">Sending a test email</em> section. If you receive your test email, then there will be no problems with your outgoing mail server configuration and you can focus on your notification configurations.</p>
			<p>Troubleshooting notifications is not as straightforward since there are several things that you will need to consider. To help with this challenge, Jira has a handy feature called <strong class="bold">Notification helper</strong>. The <strong class="bold">Notification helper</strong> feature can save the Jira administrator<a id="_idIndexMarker651"/> time by helping them pinpoint why a given user does or does not receive notifications. All the administrator has to do is tell the helper who the user is, which issue (or an example issue from a project) the user will or will not be receiving notifications for, and the event that is triggering the notification. Follow these steps:</p>
			<ol>
				<li value="1">Browse to the Jira administration console</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Notification helper</strong> option</li>
				<li>Specify the<a id="_idIndexMarker652"/> user that will or will not receive notifications in the <strong class="bold">User</strong> field</li>
				<li>Specify the issue to test with</li>
				<li>Select the type of notification event</li>
				<li>Click on the <strong class="bold">Submit</strong> button</li>
			</ol>
			<p>The <strong class="bold">Notification helper</strong> feature will then process the input and report whether the user is expected to receive notifications, and why, based on the notification scheme settings:</p>
			<div><div><img src="img/Figure_8.13_B18644.jpg" alt="Figure 8.13 – The Notification helper page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.13 – The Notification helper page</p>
			<p>As you can see from the preceding screenshot, the user, <strong class="bold">Alana Grant</strong>, is currently not receiving notifications for the <strong class="bold">DEMO-4</strong> issue when it is being updated because the notification is set up to have only the <strong class="bold">Current Assignee</strong> receive emails, and Alana Grant is not the assignee.</p>
			<p>Now that we have looked at how Jira can send out email notifications and how you can troubleshoot<a id="_idIndexMarker653"/> them when you do not receive emails, in the next section, we will look at how to send emails to Jira to create issues and comments.</p>
			<h1 id="_idParaDest-242"><a id="_idTextAnchor244"/>Incoming emails</h1>
			<p>We have seen how to <a id="_idIndexMarker654"/>configure Jira to send emails to notify users about updates on their issues. However, this is only half of the story when it comes to Jira’s email support.</p>
			<p>You can also set up Jira so that it periodically polls mailboxes for emails and creates issues based on the emails’ subject and content. This is a very powerful feature with the following benefits:</p>
			<ul>
				<li>It hides the complexity of Jira from business users so that they can log issues more efficiently and leave the complexity to the IT team.</li>
				<li>It allows users to create issues, even if Jira can only be accessed within the internal network. Users can send emails to a dedicated mailbox for Jira to poll.</li>
			</ul>
			<p>In this section, we will look at how to add incoming mail servers for Jira to poll emails, and then create mail handlers to create issues and/or comments from the emails.</p>
			<h2 id="_idParaDest-243"><a id="_idTextAnchor245"/>Adding an incoming mail server</h2>
			<p>For Jira to retrieve <a id="_idIndexMarker655"/>emails and create issues from them, you <a id="_idIndexMarker656"/>need to add the POP/IMAP mail server configurations to Jira. POP and IMAP are mail protocols that are used to retrieve emails from the server. Email clients, such as Microsoft Outlook, use one of these protocols to retrieve your emails.</p>
			<p>Unlike outgoing mail servers, Jira allows you to add multiple incoming mail servers. This is because while you only need one mail server to send emails, you may have multiple mail servers or multiple mail accounts (on the same server) that people will use to send emails to.</p>
			<p>For example, you might have one that’s dedicated to providing support and another one for sales. It is usually a good idea to create separate mail accounts to make it easier when you’re trying to work out which email can go into which project. For this reason, adding POP/IMAP mail servers can be thought of as adding multiple mail accounts in Jira. Perform the following steps to add an incoming mail server:</p>
			<ol>
				<li value="1">Browse to the Jira administration console</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Incoming mail</strong> option</li>
				<li>Click on the <strong class="bold">Add POP/IMAP Mail Server</strong> button</li>
				<li>Enter a name and description for the mail server</li>
				<li>Select the type of mail service provider – for example, if you are using your own hosted mail service or one of the recognized cloud providers such as Google</li>
				<li>Specify the hostname of the POP/IMAP server if you are using your own (custom provider)</li>
				<li>Enter the username/password credentials for the mail account</li>
				<li>Click on the <strong class="bold">Save</strong> butto<a id="_idIndexMarker657"/>n to create the POP/IMAP <a id="_idIndexMarker658"/>mail server:</li>
			</ol>
			<div><div><img src="img/Figure_8.14_B18644.jpg" alt="Figure 8.14 – The Add mail server page&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.14 – The Add mail server page</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can have multiple incoming servers.</p>
			<h2 id="_idParaDest-244"><a id="_idTextAnchor246"/>Mail handlers</h2>
			<p>Mail handlers are<a id="_idIndexMarker659"/> what Jira uses to process retrieved emails. Each mail handler <a id="_idIndexMarker660"/>can process emails from one incoming mail server and periodically scan for new emails. Jira ships with several mail handlers, each with its own features. In the following sections, we will discuss each of the handlers in detail.</p>
			<h3>Creating a new issue or adding a comment to an existing issue</h3>
			<p>Creating a <a id="_idIndexMarker661"/>new<a id="_idIndexMarker662"/> issue or adding a comment to an existing issue mail handler (also known as the create and comment handler in previous versions of Jira) is the most used mail handler. It will create new issues from the received emails and also add comments to existing issues if the incoming email’s subject contains a matching issue key. If the subject does not contain a matching issue key, a new issue is created. The following table lists the parameters that are required when creating the mail handler:</p>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><img src="img/2.png" alt="Table 8.4 – Mail handler configuration&#13;&#10;"/></p>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 8.4 – Mail handler configuration</p>
			<h3>Adding a comment with the entire email body</h3>
			<p>This mail <a id="_idIndexMarker663"/>handler extracts text from an email’s content and adds it to the issue with a matching issue key in the subject. The author of the comment is taken from the <strong class="bold">From</strong> field.</p>
			<p>It has a set of parameters that are similar to the create and comment handler.</p>
			<h3>Adding a comment from the non-quoted email body</h3>
			<p>Adding a comment<a id="_idIndexMarker664"/> from the non-quoted email body is very similar to the full comment handler, but it only extracts non-quoted text and adds them as comments. Text that starts with <em class="italic">&gt;</em> or <em class="italic">|</em> is considered to be quoted.</p>
			<p>It has a set of parameters that are similar to the create and comment handler.</p>
			<h3>Creating a new issue from each email message</h3>
			<p>Creating a new<a id="_idIndexMarker665"/> issue from each email message is quite similar to the create and comment handler, except this will always create a new issue for every received email.</p>
			<p>It has a set of parameters that are similar to the create and comment handler.</p>
			<h3>Adding a comment before a specified marker or separator in the email body</h3>
			<p>Adding a <a id="_idIndexMarker666"/>comment before a specified <a id="_idIndexMarker667"/>marker or separator in the email body is a more powerful version of the comment handlers. It uses regular expressions to extract text from email contents and adds them to the issue:</p>
			<div><div><table id="table004-3" class="No-Table-Style">
						<colgroup>
							<col/>
							<col/>
						</colgroup>
						<tbody>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Parameter</strong></p>
								</td>
								<td class="No-Table-Style T---Body">
									<p><strong class="bold">Description</strong></p>
								</td>
							</tr>
							<tr class="No-Table-Style">
								<td class="No-Table-Style T---Body">
									<p>Split Regex</p>
								</td>
								<td class="No-Table-Style T---Body">
									<p>This regex expression is used to extract contents. There are two rules for the regex expression:</p>
									<p><code>/</code></p>
									<p><code>/-{}{}{}{}{}\s*Original Message\s*{}-/</code> or <code>/_____________*/</code></p>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 8.5 – Regex mail handler configuration</p>
			<h2 id="_idParaDest-245"><a id="_idTextAnchor247"/>Adding a mail handler</h2>
			<p>You can set up <a id="_idIndexMarker668"/>as many<a id="_idIndexMarker669"/> mail handlers as you want. It is recommended that you create dedicated mailboxes for each project where you wish to allow Jira to create issues from emails. For each account, you will need to create a mail handler. The mailbox you set up needs to be accessible through POP or IMAP. Perform the following steps to add a mail handler:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">Incoming Mail</strong> page.</li>
				<li>Click on the <strong class="bold">Add incoming mail handler</strong> button.</li>
				<li>Provide a name to the new mail handler.</li>
				<li>Select an incoming mail server or <strong class="bold">Local Files</strong>.</li>
				<li>Specify how long Jira will wait to poll the mailbox for new emails (in minutes). You will want to keep this long enough to allow enough time for Jira to process all the emails, but not too long as you may end up having to wait for a long time to see<a id="_idIndexMarker670"/> your <a id="_idIndexMarker671"/>emails converted into issues in Jira.</li>
				<li>Select the type of handler you want to add.</li>
				<li>Click on the <strong class="bold">Next</strong> button:</li>
			</ol>
			<div><div><img src="img/Figure_8.15_B18644.jpg" alt="Figure 8.15 – Adding a mail handler – step 1&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.15 – Adding a mail handler – step 1</p>
			<p>Depending on the handler type you select, the next screen will vary. On the next screen, you will need to provide the required parameters for the mail handler, as described in the preceding section. The following screenshot shows an example configuration dialog box, where new issues will be created in the IT support project as <strong class="bold">Task</strong> types:</p>
			<div><div><img src="img/Figure_8.16_B18644.jpg" alt="Figure 8.16 – Adding a mail handler – step 2&#13;&#10;"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.16 – Adding a mail handler – step 2</p>
			<p>You can<a id="_idIndexMarker672"/> always<a id="_idIndexMarker673"/> use the <strong class="bold">Test</strong> button to test out your configuration. Jira provides helpful hints if there are problems.</p>
			<h2 id="_idParaDest-246"><a id="_idTextAnchor248"/>Advanced mail handler</h2>
			<p>The default <a id="_idIndexMarker674"/>mail handlers that come with Jira are often enough for simple email processing needs. If you need to have more control or need special processing logic for your incoming emails, you can create custom mail handlers. However, creating new mail handlers requires you to have programming knowledge; a better option is<a id="_idIndexMarker675"/> to use an add-on called <strong class="bold">Enterprise Email Handler for Jira</strong> (<strong class="bold">JEMH</strong>).</p>
			<p>With JEMH, you can set up advanced email routing, additional email-triggered operations such as updating an issue based on your email content, an audit of received/processed<a id="_idIndexMarker676"/> emails, and more. You can find out more<a id="_idIndexMarker677"/> about JEMH at <a href="https://marketplace.atlassian.com/apps/4832/enterprise-email-handler-for-jira-jemh">https://marketplace.atlassian.com/apps/4832/enterprise-email-handler-for-jira-jemh</a>.</p>
			<h1 id="_idParaDest-247"><a id="_idTextAnchor249"/>The HR project</h1>
			<p>Users will often<a id="_idIndexMarker678"/> want to get progress updates on their issues after they have logged them. So, instead of business users having to ask for updates, we will proactively update them through our newly acquired knowledge – that is, Jira notifications.</p>
			<p>In <a href="B18644_05.xhtml#_idTextAnchor119"><em class="italic">Chapter 5</em></a>, <em class="italic">Field Management</em>, we added a custom field called <strong class="bold">Direct Manager</strong>, which allows users to add the manager of the new employee or leaving employee so that they can be kept in the loop.</p>
			<p>The other customization we made in <a href="B18644_07.xhtml#_idTextAnchor187"><em class="italic">Chapter 7</em></a>, <em class="italic">Workflow and Business Process</em>, was adding new transitions to the workflow. We need to make sure that those transitions fire the appropriate events and also send out notifications. In summary, we need to do the following:</p>
			<ul>
				<li>Send out notifications for the events that are fired by our custom workflow transitions</li>
				<li>Send out notifications to users that are specified in our <strong class="bold">Direct Manager</strong> custom field</li>
			</ul>
			<p>While you can achieve both using other Jira features, such as adding users as watchers to the issue and reusing existing Jira system events, this exercise will explore the options that are available to you. In later chapters, you will see that there are other criteria to consider while deciding on the best approach.</p>
			<h2 id="_idParaDest-248"><a id="_idTextAnchor250"/>Setting up mail servers</h2>
			<p>The first step<a id="_idIndexMarker679"/> of <a id="_idIndexMarker680"/>enabling email communication, as you may have guessed, is to register mail servers in Jira. If you are using the standalone distribution of Jira, it is recommended that you add your mail server by entering the host information. Follow these steps:</p>
			<ol>
				<li value="1">Log in to Jira as a Jira administrator.</li>
				<li>Browse to the Jira administration console.</li>
				<li>Select the <strong class="bold">System</strong> tab and then the <strong class="bold">Outgoing mail</strong> option.</li>
				<li>Click on the <strong class="bold">Configure new SMTP mail server</strong> button.</li>
				<li>Enter your mail server information. If you do not have a mail server handy, you can sign up for a free Gmail account and use that for testing purposes.</li>
			</ol>
			<p>After adding your <a id="_idIndexMarker681"/>mail server, you can try sending yourself a quick<a id="_idIndexMarker682"/> test email to check whether Jira can access your server successfully.</p>
			<h2 id="_idParaDest-249"><a id="_idTextAnchor251"/>Updating workflow post functions</h2>
			<p>In <a href="B18644_07.xhtml#_idTextAnchor187"><em class="italic">Chapter 7</em></a>, <em class="italic">Workflow and Business Process</em>, we created a few new workflow transitions. Now, we <a id="_idIndexMarker683"/>need to update these <a id="_idIndexMarker684"/>new transitions to make sure they fire the appropriate events:</p>
			<ol>
				<li value="1">Browse to the <strong class="bold">View Workflows</strong> page.</li>
				<li>Click on the <strong class="bold">Edit</strong> link for <strong class="bold">HR: Termination Workflow</strong>.</li>
				<li>Click on any transitions other than <strong class="bold">Done</strong>.</li>
				<li>Update the post function to fire the <em class="italic">Issue Updated</em> event rather than the <em class="italic">Generic Event</em>.</li>
				<li>Repeat this for all other transitions except the <strong class="bold">Done</strong> transition.</li>
				<li>Publish the draft workflow. You can save a backup copy in case you want to revert.</li>
			</ol>
			<p>We are using the <em class="italic">Issue Updated</em> event because it reflects the fact that the issue is being updated; also, the event is tied to more appropriate email templates. We can, of course, also create a new custom event and email templates and make the <code>post</code> function fire<a id="_idIndexMarker685"/> the<a id="_idIndexMarker686"/> custom event instead.</p>
			<h2 id="_idParaDest-250"><a id="_idTextAnchor252"/>Setting up a notification scheme</h2>
			<p>Now, you need to<a id="_idIndexMarker687"/> have a notification scheme so that <a id="_idIndexMarker688"/>you can start adding notifications to your events. We will base our notification scheme on the default scheme to help us get things set up quickly:</p>
			<ol>
				<li value="1">Select the <strong class="bold">Issues</strong> tab and then the <strong class="bold">Notification schemes</strong> option</li>
				<li>Click on the <strong class="bold">Copy</strong> link for the <strong class="bold">Default Notification Scheme</strong> option</li>
				<li>Click on the <strong class="bold">Edit</strong> link of the copied notification scheme</li>
				<li>Rename it <code>HR Notification Scheme</code> and click on <strong class="bold">Update</strong></li>
			</ol>
			<p>This will create a new notification scheme with the basic notifications pre-populated. All you need to do now is modify the events and add your own notification needs.</p>
			<h2 id="_idParaDest-251"><a id="_idTextAnchor253"/>Setting up notifications</h2>
			<p>There are two<a id="_idIndexMarker689"/> rules you need to follow to add notifications. First, you<a id="_idIndexMarker690"/> need to add notifications for your custom events so that emails will be sent out when they are fired. Second, you will want users that are specified in the <strong class="bold">CC list</strong> custom field to also receive emails along with the assignee and reporter of the issue:</p>
			<ol>
				<li value="1">Click on the <strong class="bold">Notifications</strong> link for <strong class="bold">HR Notification Scheme</strong></li>
				<li>Click on the <strong class="bold">Add</strong> notification link</li>
				<li>Select the <strong class="bold">Issue Updated</strong> event type</li>
				<li>Select <strong class="bold">User Custom Field Value</strong> for the notification type and select <strong class="bold">Direct Manager</strong> from the drop-down list</li>
				<li>Click on the <strong class="bold">Add</strong> button</li>
			</ol>
			<p>Nice and easy. With just a few clicks, you have added the <strong class="bold">Direct Manager</strong> custom field to the notification scheme. So, now, regardless of who is put into the field, the user will receive <a id="_idIndexMarker691"/>notifications <a id="_idIndexMarker692"/>for issue updates.</p>
			<h2 id="_idParaDest-252"><a id="_idTextAnchor254"/>Putting it together</h2>
			<p>The last step, as<a id="_idIndexMarker693"/> always, is to associate your scheme with projects for activation:</p>
			<ol>
				<li value="1">Browse to the HR project’s administration page</li>
				<li>Select the <strong class="bold">Notifications</strong> option from the left panel</li>
				<li>Use a different scheme in the <strong class="bold">Actions</strong> menu</li>
				<li>Select the new <strong class="bold">HR Notification Scheme</strong> we just created</li>
				<li>Click on the <strong class="bold">Associate</strong> button</li>
			</ol>
			<p>With just a few clicks, you have enabled Jira to automatically send out emails to update users with their issue’s progress. Not only this, but you have tied in the custom fields you created from earlier chapters to manage who, along with the issue assignee and reporter, will also get these notifications. So, let’s put this to the test:</p>
			<ol>
				<li value="1">Create a new <strong class="bold">Termination</strong> issue in the HR project.</li>
				<li>Select a user for the <strong class="bold">Direct Manager</strong> custom field. It is a good idea not to select yourself since the reporter will get notifications by default. Also, make sure that the user that’s selected has a valid email address.</li>
				<li>Transition the issue so that it moves along the workflow.</li>
				<li>You will receive emails from Jira within minutes.</li>
			</ol>
			<p>If you do not receive emails from Jira, check your mail queue and check whether the mail is being generated. Then, follow the steps provided in the <em class="italic">Troubleshooting notifications</em> section of this chapter.</p>
			<h1 id="_idParaDest-253"><a id="_idTextAnchor255"/>Summary</h1>
			<p>In this chapter, we looked at how Jira can stay in touch with its users through emails. Indeed, with today’s new gadgets, such as smartphones and tablets, being able to keep users updated with emails is a powerful feature, and Jira has a very flexible structure in place to define the rules on who will receive notifications.</p>
			<p>We also very briefly mentioned some of the security rules about who can receive notifications. Jira performs security checks before sending out notifications for two very good reasons – first, there is no point in sending an email to a user who cannot view the issue; second, you will not want unauthorized users viewing the issue and receiving updates that they won’t know anything about.</p>
			<p>In the next chapter, we will look into the security aspects of Jira and how you can secure your data to prevent unauthorized access.</p>
		</div>
	</body></html>