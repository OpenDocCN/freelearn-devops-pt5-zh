<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-213"><a id="_idTextAnchor213"/>12</h1>
<h1 id="_idParaDest-214"><a id="_idTextAnchor214"/>Integrating Ansible with Your Tools</h1>
<p>As an organization grows its IT infrastructure, more and more tools are often needed to solve the technical challenges. Instead of these tools working alone in silos, it is desirable to implement integration between these tools to increase efficiency and scalability. As an example, the <strong class="bold">IT Service Management</strong> (<strong class="bold">ITSM</strong>) tool can send an alert to approvers, or the container platform can trigger a new deployment of the application when a new version has been developed by the team. There are an immeasurable number of opportunities in terms of integrating multiple siloed tools in IT infrastructure. </p>
<p>The same goes for automation as well; Ansible can be used as the key automation tool for implementing integration between multiple infrastructure and application support tools. In the previous chapters, you learned about the Ansible automation and integration opportunities for the infrastructure (public and private cloud), DevOps, networks, applications, and more. In this chapter, you will learn more about the enterprise automation solution called <strong class="bold">Ansible Automation Platform</strong> (<strong class="bold">AAP</strong>) and the integration methods between other tools in the IT infrastructure environment.</p>
<p>We will start by introducing Red Hat AAP and its components, features, and benefits. Then, you will learn how to use AAP by creating various automation resources in automation controller, such as projects, job templates, and credentials. </p>
<p>In this chapter, we will cover the following topics: </p>
<ul>
<li>Introduction to Red Hat AAP</li>
<li>Red Hat AAP components</li>
<li>Database management using Red Hat AAP</li>
<li>Integrating Jenkins with AAP</li>
<li>Integrating an automation controller with Slack and notification services</li>
</ul>
<p>Let’s start learning about AAP, the enterprise IT automation tool.</p>
<h1 id="_idParaDest-215"><a id="_idTextAnchor215"/>Technical requirements</h1>
<p>You will need the following technical requirements for this chapter:</p>
<ul>
<li>One or more Linux machines with Red Hat repositories configured. If you are using other Linux operating systems instead of <strong class="bold">Red Hat Enterprise Linux</strong> (<strong class="bold">RHEL</strong>) machines, then make sure you have the appropriate repositories configured to get packages and updates.</li>
<li>Access to Red Hat AAP.</li>
<li>A GitHub account.</li>
<li>A Jenkins server and basic knowledge about Jenkins pipelines.</li>
<li>A Slack application account and basic knowledge about Slack usage.</li>
</ul>
<p>A single 60-day self-supported subscription to Red Hat AAP is available for testing AAP and its features. Please refer to <a href="https://www.redhat.com/en/technologies/management/ansible/trial">https://www.redhat.com/en/technologies/management/ansible/trial</a> to learn more about the AAP trial subscription.</p>
<p>All the Ansible artifacts, commands, and snippets for this chapter can be found in this book’s GitHub repository at <a href="https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-12">https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-12</a>.</p>
<h1 id="_idParaDest-216"><a id="_idTextAnchor216"/>Introduction to Red Hat AAP</h1>
<p>So far, you have learned how to use Ansible, develop playbooks, create roles, use content collections, and more for your use cases. Anyone can install and use Ansible in their workstation or some random servers in an environment and use them for their automation use cases. However, there won’t be any standardization, traces, or accountability as each person works on their methods and practices. This will result in the following challenges in the organization:</p>
<ul>
<li>Individuals work in silos, which will result in no collaboration in the workplace.</li>
<li>Automation artifacts (playbooks, roles, and collections) are not shared between individuals or teams.</li>
<li>No logging or auditing options will be available since the automation is running on an individual’s workstation or some random servers.</li>
<li>Less control over who can execute the playbooks or automated jobs.</li>
<li>Difficulty keeping secrets and credentials.</li>
<li>Lack of job scheduling and monitoring features.</li>
<li>Complexity in managing managed nodes information.</li>
</ul>
<p>When it comes to enterprise automation, the solution must be able to implement governance, standardization, collaboration, accountability and auditing. </p>
<p>Red Hat AAP <a id="_idIndexMarker723"/>helps organizations cover most of the previously mentioned challenges by implementing an enterprise automation solution that can scale the automation and orchestrate the infrastructure and applications. AAP includes all the tools and features required for enterprise automation, such as <strong class="bold">Graphical User Interface</strong> (<strong class="bold">GUI</strong>) and <strong class="bold">Text User Interface</strong> (<strong class="bold">TUI</strong>)-based tools, analytics, dashboards, auditing, and more. </p>
<p>Note that unlike <a id="_idIndexMarker724"/>Ansible (the <code>ansible-core</code> or <code>ansible</code> package), Red Hat AAP is not free and is delivered as a subscription model (<a href="https://www.ansible.com/products/pricing">https://www.ansible.com/products/pricing</a>), like any other Red Hat product. For testing<a id="_idIndexMarker725"/> and <strong class="bold">proof of concept</strong> (<strong class="bold">POC</strong>) purposes, request a 60-day trial subscription and refer to https://www.redhat.com/en/technologies/management/ansible/try-it to learn more. Please refer to <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_installation_guide/index">https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_installation_guide/index</a> to learn how to install and configure Red Hat AAP.</p>
<p>It is also possible to get a no-cost RHEL individual developer subscription for testing and development purposes. Refer to <a href="https://developers.redhat.com/articles/faqs-no-cost-red-hat-enterprise-linux">https://developers.redhat.com/articles/faqs-no-cost-red-hat-enterprise-linux</a> to learn <a id="_idIndexMarker726"/>more about this free RHEL subscription. </p>
<p class="callout-heading">Red Hat AAP Managed Service in Microsoft Azure</p>
<p class="callout">Red Hat offers AAP as a <a id="_idIndexMarker727"/>managed service on Microsoft Azure, by which the organization can utilize the AAP solution just like any other Microsoft Azure cloud service. This is fully supported by Red Hat and the billing will be <a id="_idIndexMarker728"/>handled inside the same cloud service bill. Refer to <a href="https://www.redhat.com/en/technologies/management/ansible/azure">https://www.redhat.com/en/technologies/management/ansible/azure</a> to learn more about this managed service.</p>
<p>Now, let’s explore the various features of Red Hat AAP.</p>
<h2 id="_idParaDest-217"><a id="_idTextAnchor217"/>Features of Red Hat AAP</h2>
<p>The following important features are included in Red Hat AAP:</p>
<ul>
<li><strong class="bold">WebUI</strong>: The <a id="_idIndexMarker729"/>web-based GUI can help administrators and developers manage the entire automation solution from a web browser. Most of the configurations in AAP can be executed from the WebUI itself, as <a id="_idIndexMarker730"/>shown in the following screenshot:</li>
</ul>
<div><div><img alt="Figure 12.1 – The Red Hat AAP dashboard " height="600" src="img/B18383_12_01.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.1 – The Red Hat AAP dashboard</p>
<ul>
<li><strong class="bold">Role-Based Access Control</strong> (<strong class="bold">RBAC</strong>): Administrators <a id="_idIndexMarker731"/>can create <a id="_idIndexMarker732"/>teams and roles in AAP and assign the roles with adequate permissions to the users or teams. These permissions can be configured for every component in AAP, such as projects, job templates, inventories or credentials.</li>
<li><strong class="bold">Logging and auditing</strong>: AAP <a id="_idIndexMarker733"/>will store the activity logs, including job execution history, and it is possible to access the old job details any time from the WebUI. AAP also includes the option to integrate<a id="_idIndexMarker734"/> with logging<a id="_idIndexMarker735"/> aggregators such as Logstash, Splunk, Loggly, Sumo Logic, and others so that we can keep your logs in a central system.</li>
<li><strong class="bold">REST API</strong> (<strong class="bold">also known as the RESTful API</strong>): The powerful and well-documented <a id="_idIndexMarker736"/>REST API will help you integrate AAP with<a id="_idIndexMarker737"/> the existing tools and applications in your environment. </li>
</ul>
<p class="callout-heading">Automation Controller API Guide </p>
<p class="callout">The automation controller REST API<a id="_idIndexMarker738"/> also helps you manage automation controller operations such as job template creation, credential management or configuring authentication. Refer to the API guide <a href="https://docs.ansible.com/automation-controller/latest/html/controllerapi/index.xhtml">https://docs.ansible.com/automation-controller/latest/html/controllerapi/index.xhtml</a> for more details.</p>
<ul>
<li><strong class="bold">Job templates and workflows</strong>: It is possible to <a id="_idIndexMarker739"/>predefine and configure the job templates<a id="_idIndexMarker740"/> and workflow<a id="_idIndexMarker741"/> templates<a id="_idIndexMarker742"/> to quickly <a id="_idIndexMarker743"/>execute complex automation jobs (<a href="https://docs.ansible.com/automation-controller/latest/html/userguide/workflows.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/workflows.xhtml</a>). </li>
<li><strong class="bold">Credential management</strong>: With credentials, you<a id="_idIndexMarker744"/> store secrets and sensitive information such <a id="_idIndexMarker745"/>as passwords, API keys, tokens, and so on. There are several predefined credential types available in AAP and it is also possible to create<a id="_idIndexMarker746"/> custom credential types if required (<a href="https://docs.ansible.com/automation-controller/latest/html/userguide/credential_types.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/credential_types.xhtml</a>):</li>
</ul>
<div><div><img alt="Figure 12.2 – Automation controller credentials " height="660" src="img/B18383_12_02.jpg" width="1211"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.2 – Automation controller credentials</p>
<ul>
<li><strong class="bold">Job scheduling</strong>: Automation <a id="_idIndexMarker747"/>jobs can be scheduled and executed <a id="_idIndexMarker748"/>automatically without user intervention, as shown in the following screenshot. This is useful for many automation jobs that must be executed in a specific period and without manual intervention. For example, we can schedule a weekly or monthly reboot job (as we learned in <a href="B18383_03.xhtml#_idTextAnchor052"><em class="italic">Chapter 3</em></a>, <em class="italic">Automating Your Daily Jobs</em>) using an automation controller:</li>
</ul>
<div><div><img alt="Figure 12.3 – Job scheduling in an automation controller " height="668" src="img/B18383_12_03.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.3 – Job scheduling in an automation controller</p>
<ul>
<li><strong class="bold">Notifications</strong>: AAP supports<a id="_idIndexMarker749"/> multiple types of notifications, such as email, IRC, and webhook, and tool integration for Grafana, Slack, Mattermost, and others.</li>
<li><strong class="bold">Integration with Red Hat Insights</strong>: By <a id="_idIndexMarker750"/>enabling this integration, it is possible to analyze the automation status and data for the automation platforms (AAP clusters) in your environments. </li>
<li><strong class="bold">Integration with third-party authentication systems</strong>: Instead of managing the local user <a id="_idIndexMarker751"/>accounts in AAP, integrate with the existing authentication providers, such as Active Directory, Google OAuth2, LDAP, RADIUS, SAMPLE, or TACACS.</li>
</ul>
<p class="callout-heading">Red Hat AAP Features and Benefits</p>
<p class="callout">Please go to <a href="https://www.redhat.com/en/technologies/management/ansible/features">https://www.redhat.com/en/technologies/management/ansible/features</a> to learn more about the features of <a id="_idIndexMarker752"/>AAP and their benefits.</p>
<p>In the next section, you will learn more about the components of Red Hat AAP.</p>
<h1 id="_idParaDest-218"><a id="_idTextAnchor218"/>Red Hat AAP components</h1>
<p>Red Hat AAP is an <a id="_idIndexMarker753"/>automation suite that contains multiple components, as shown in the following diagram:</p>
<div><div><img alt="Figure 12.4 – High-level diagram of Red Hat AAP 2.1 components (source: https://www.ansible.com/blog/introducing-red-hat-ansible-automation-platform-2.1) " height="668" src="img/B18383_12_04.jpg" width="1083"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.4 – High-level diagram of Red Hat AAP 2.1 components (source: https://www.ansible.com/blog/introducing-red-hat-ansible-automation-platform-2.1)</p>
<p>In the following sections, you will learn about the different components of AAP, such as the automation controller, execution environments, and automation mesh.</p>
<h2 id="_idParaDest-219"><a id="_idTextAnchor219"/>Ansible automation controller</h2>
<p>The <strong class="bold">automation controller</strong> was<a id="_idIndexMarker754"/> referred to as <strong class="bold">Ansible Tower</strong> previously. It is the control plane and the core component of AAP. With<a id="_idIndexMarker755"/> the introduction of the Ansible automation controller, the control plane components (WebUI and API) become decoupled <a id="_idIndexMarker756"/>from the <strong class="bold">execution environment</strong> (<strong class="bold">EE</strong>), which also helps the solution with additional execution nodes. </p>
<p>With the automation controller, we can manage the AAP operations from the WebUI, such as managing remote nodes (inventory), credentials, projects, job templates, and other operations. The automation controller contains many components, as follows:</p>
<ul>
<li>A REST API for<a id="_idIndexMarker757"/> inventory, credential, and job management</li>
<li>A database for storing the resource details, including the automation job’s history</li>
<li>Am automation mesh connector and receptor</li>
<li>A message queue and caching</li>
<li>A task <a id="_idIndexMarker758"/>scheduler</li>
</ul>
<p>Based on the RBAC configuration, the user will have different permissions on the automation controller interface.</p>
<p class="callout-heading">What is the Red Hat Ansible Automation Platform Automation Controller?</p>
<p class="callout">To learn more about <a id="_idIndexMarker759"/>automation controller, check <em class="italic">What is the Red Hat Ansible Automation Platform automation controller?</em> (<a href="https://www.redhat.com/en/technologies/management/ansible/automation-controller">https://www.redhat.com/en/technologies/management/ansible/automation-controller</a>).</p>
<p class="callout-heading">Ansible Tower and AAP Life Cycle</p>
<p class="callout">Ansible automation controller 3.8 (Ansible Tower) has been part of AAP since version 1.2. Refer to the <a id="_idIndexMarker760"/>Ansible Tower life cycle (<a href="https://access.redhat.com/support/policy/updates/ansible-tower">https://access.redhat.com/support/policy/updates/ansible-tower</a>) and AAP life cycle (<a href="https://access.redhat.com/support/policy/updates/ansible-automation-platform">https://access.redhat.com/support/policy/updates/ansible-automation-platform</a>) to learn more about these versions.</p>
<p><code>ansible-navigator</code>) is a TUI utility for interacting with automation execution <a id="_idIndexMarker761"/>environments. It can be seen in the following screenshot. <code>ansible-navigator</code> is also helpful for developing and testing automation content:</p>
<div><div><img alt="Figure 12.5 – The ansible-navigator TUI " height="478" src="img/B18383_12_05.jpg" width="1018"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.5 – The ansible-navigator TUI</p>
<p>Instead of using <code>ansible-playbook</code> and other <code>ansible-*</code> commands, we can use <code>ansible-navigator</code> to manage all command-line operations of Ansible, such as executing playbooks, managing collections, executing environments, and so on.</p>
<p>Refer to the Ansible navigator documentation<a id="_idIndexMarker762"/> (<a href="https://ansible-navigator.readthedocs.io">https://ansible-navigator.readthedocs.io</a>) and Ansible navigator <a id="_idIndexMarker763"/>cheat sheet (<a href="https://www.techbeatly.com/ansible-navigator-cheat-sheet">https://www.techbeatly.com/ansible-navigator-cheat-sheet</a>) to learn more.</p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor220"/>Automation execution environments</h2>
<p>The automaton execution environment<a id="_idIndexMarker764"/> provides a<a id="_idIndexMarker765"/> standard and portable mechanism for executing Ansible playbooks. Execution environments are consistent by design and deliver container images that contain the following components:</p>
<ul>
<li>Ansible </li>
<li>Ansible Runner </li>
<li>Required Ansible collections</li>
<li>Other dependencies for the playbook’s execution (for example, Python libraries, system packages)</li>
</ul>
<p>Previously, Python virtual environments (for example, <code>/var/lib/awx/venv/ansible</code>) were used to achieve this functionality. This was not easy to manage and maintain in terms of consistency as you needed to manage the Python virtual environments on all nodes in the AAP or Ansible Tower cluster. By containerizing the <a id="_idIndexMarker766"/>executables and dependencies, it is possible to distribute the same image to multiple cluster nodes consistently:</p>
<div><div><img alt="Figure 12.6 – Components inside the automation execution environment " height="578" src="img/B18383_12_06.jpg" width="614"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.6 – Components inside the automation execution environment</p>
<p><code>ansible-builder</code>) is<a id="_idIndexMarker767"/> a command-line utility that can be used to build and manage container images for the automation execution environment. Refer to the automation execution environment<a id="_idIndexMarker768"/> documentation (<a href="https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.xhtml</a>) to learn more about building and distributing automation execution environments.</p>
<h2 id="_idParaDest-221"><a id="_idTextAnchor221"/>The automation mesh</h2>
<p>The <a id="_idIndexMarker769"/>automation mesh <a id="_idIndexMarker770"/>is a service mesh concept for Ansible automation and was introduced in AAP 2.1. The automation mesh replaces the isolated node concept in older versions of AAP (version 1.2 and below) and provides the flexibility to scale the automation landscape. The automation mesh replaces the need for jump servers (or bastion hosts), and it is possible to place the execution nodes near the managed nodes, as shown in the following diagram:</p>
<div><div><img alt="Figure 12.7 – AAP and the automation mesh (source: https://www.ansible.com/blog/whats-new-in-ansible-automation-platform-2.1-automation-mesh)  " height="1096" src="img/B18383_12_07.jpg" width="1071"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.7 – AAP and the automation mesh (source: https://www.ansible.com/blog/whats-new-in-ansible-automation-platform-2.1-automation-mesh) </p>
<p>Refer to the<a id="_idIndexMarker771"/> documentation (<a href="https://www.ansible.com/products/automation-mesh">https://www.ansible.com/products/automation-mesh</a>) to learn more about the automation mesh.</p>
<h2 id="_idParaDest-222"><a id="_idTextAnchor222"/>Automation Hub</h2>
<p>Ansible Automation Hub<a id="_idIndexMarker772"/> is the official location for downloading<a id="_idIndexMarker773"/> the supported and certified Ansible collections. The hosted Automation Hub<a id="_idIndexMarker774"/> is available at <a href="https://console.redhat.com/ansible/automation-hub">https://console.redhat.com/ansible/automation-hub</a>, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.8 – Ansible Automation Hub " height="555" src="img/B18383_12_08.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.8 – Ansible Automation Hub</p>
<p>To manage your content collection and other supported collections, it is possible to use a <strong class="bold">Private Automation Hub</strong> (<strong class="bold">PAH</strong>). This concept was introduced in AAP 1.2. Content from other sources (such as Red Hat Ansible Automation Hub or Ansible Galaxy) can be synced to private automation hubs, as shown in the following diagram:</p>
<div><div><img alt="Figure 12.9 – Private Automation Hub with AAP " height="613" src="img/B18383_12_09.jpg" width="836"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.9 – Private Automation Hub with AAP</p>
<p>Refer to the <a id="_idIndexMarker775"/>documentation (<a href="https://docs.ansible.com/ansible/latest/reference_appendices/automationhub.xhtml">https://docs.ansible.com/ansible/latest/reference_appendices/automationhub.xhtml</a>) and product page (<a href="https://www.ansible.com/products/automation-hub">https://www.ansible.com/products/automation-hub</a>) to learn more about Automation Hub.</p>
<p class="callout-heading">Ansible AWX and the Ansible Automation Controller</p>
<p class="callout">Ansible AWX<a id="_idIndexMarker776"/> is an open source community project sponsored by Red Hat. It is an upstream project for the automation controller component in Red Hat AAP. (Red Hat Ansible Tower 3.2 is the first version based on the Ansible AWX project.) Ansible AWX <a id="_idIndexMarker777"/>is a fast-moving project (<a href="https://github.com/ansible/awx">https://github.com/ansible/awx</a>) that is primarily supported by the community via IRC (<a href="https://web.libera.chat/#ansible-awx">https://web.libera.chat/#ansible-awx</a>) and the AWX mailing list (<a href="https://groups.google.com/forum/#!forum/awx-project">https://groups.google.com/forum/#!forum/awx-project</a>). Refer to the project page (<a href="https://www.ansible.com/community/awx-project">https://www.ansible.com/community/awx-project</a>) and <a id="_idIndexMarker778"/>frequently asked questions (<a href="https://www.ansible.com/products/awx-project/faq">https://www.ansible.com/products/awx-project/faq</a>) to learn more about Ansible AWX.</p>
<p>In the next section, you will learn how to start using Red Hat AAP for automation use cases.</p>
<h1 id="_idParaDest-223"><a id="_idTextAnchor223"/>Database management using Red Hat AAP</h1>
<p>In <a href="B18383_08.xhtml#_idTextAnchor144"><em class="italic">Chapter 8</em></a>, <em class="italic">Helping the Database Team with Automation</em>, you learned how to use Ansible to automate<a id="_idIndexMarker779"/> database creation and user management operations. This section will reuse the same Ansible artifacts but in a different repository and execute the job from Red Hat AAP.</p>
<p>The following are the prerequisites for this section:</p>
<ul>
<li>Access to the Red Hat Ansible automation controller WebUI</li>
<li>Access to the GitHub repository that contains the necessary Ansible artifacts (<a href="https://github.com/ginigangadharan/ansible-database-demo">https://github.com/ginigangadharan/ansible-database-demo</a>) </li>
<li>Access to the target nodes (database node)</li>
</ul>
<p>Job templates are the core resources in the automation controller, but a job template requires few other resources as dependencies. </p>
<div><div><img alt="Figure 12.10 – Components and dependencies in Ansible Automation Platform " height="421" src="img/B18383_12_10.jpg" width="743"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.10 – Components and dependencies in Ansible Automation Platform</p>
<p>You will learn the basic operations in the <a id="_idIndexMarker780"/>Ansible automation controller and create various resources, as follows:</p>
<ul>
<li>Organizations</li>
<li>Projects</li>
<li>Inventory, managed nodes, and groups</li>
<li>Credentials</li>
<li>A job template with survey forms and extra variables</li>
</ul>
<p>In the following section, we will learn how to access the Ansible automation controller and create the resources inside.</p>
<h2 id="_idParaDest-224"><a id="_idTextAnchor224"/>Accessing the Ansible automation controller</h2>
<p>Access the <a id="_idIndexMarker781"/>automation controller IP address or hostname from a supported web browser and log in with your <a id="_idIndexMarker782"/>username and password, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.11 – Ansible automation controller WebUI login page " height="454" src="img/B18383_12_11.jpg" width="825"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.11 – Ansible automation controller WebUI login page</p>
<p>Based on the RBAC configurations and permissions, you will find allowed menus and configuration items on the dashboard:</p>
<div><div><img alt="Figure 12.12 – Ansible automation controller dashboard " height="602" src="img/B18383_12_12.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.12 – Ansible automation controller dashboard</p>
<p>To manage<a id="_idIndexMarker783"/> different projects, users, and other resources, create a new <em class="italic">organization</em>; see the example shown in the following screenshot. An organization is a logical collection of projects, inventories, teams and users (this is an optional step; use the <strong class="bold">Default</strong> organization that <a id="_idIndexMarker784"/>already exists in the automation controller):</p>
<div><div><img alt="Figure 12.13 – Creating a new organization " height="355" src="img/B18383_12_13.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.13 – Creating a new organization</p>
<p>Once you have created a new organization, create a new project.</p>
<h2 id="_idParaDest-225"><a id="_idTextAnchor225"/>Creating a project in automation controller</h2>
<p>Click <a id="_idIndexMarker785"/>on the <strong class="bold">Projects</strong> menu <a id="_idIndexMarker786"/>and then click <strong class="bold">Add</strong> to create a new project, as shown in the following screenshot. For <strong class="bold">Source Control URL</strong>, use <a href="https://github.com/ginigangadharan/ansible-database-demo">https://github.com/ginigangadharan/ansible-database-demo</a>:</p>
<div><div><img alt="Figure 12.14 – Creating a new project in the automation controller " height="525" src="img/B18383_12_14.jpg" width="1064"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.14 – Creating a new project in the automation controller</p>
<p>Since the GitHub repository is public, we do not require a credential to access it. For private GitHub repositories, you need to provide one; you will learn how to create credentials in the next section when we add the inventory and managed nodes.</p>
<p>Verify the project’s sync status, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.15 – Project details and job status " height="315" src="img/B18383_12_15.jpg" width="1055"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.15 – Project details and job status</p>
<p>As you can see, the automation controller has finished syncing the content from the GitHub repository to a local directory (<code>Playbook Directory: _15__database_management</code>).</p>
<p>If you come <a id="_idIndexMarker787"/>across any issues while syncing content, check your internet connection or connection to the <a id="_idIndexMarker788"/>Git server (for private repositories) and ensure the necessary access is in place. </p>
<h2 id="_idParaDest-226"><a id="_idTextAnchor226"/>Creating the inventory and managed nodes</h2>
<p>In the previous <a id="_idIndexMarker789"/>chapters, you created <a id="_idIndexMarker790"/>Ansible inventories using static files (and dynamic inventory plugins), as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.16 – Creating an Ansible inventory using a static file  " height="168" src="img/B18383_12_16.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.16 – Creating an Ansible inventory using a static file </p>
<p>Now, let’s create a new inventory, managed nodes, and host groups in the automation controller using the WebUI:</p>
<ol>
<li>Open the <strong class="bold">Inventories</strong> tab on the left-hand side and <strong class="bold">Add</strong> a new inventory, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 12.17 – Creating an Ansible inventory in the automation controller " height="515" src="img/B18383_12_17.jpg" width="1058"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.17 – Creating an Ansible inventory in the automation controller</p>
<p>A <a id="_idIndexMarker791"/>new inventory <a id="_idIndexMarker792"/>will be created and its status will be displayed:</p>
<div><div><img alt="Figure 12.18 – The Ansible inventory on the automation controller " height="409" src="img/B18383_12_18.jpg" width="1126"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.18 – The Ansible inventory on the automation controller</p>
<ol>
<li value="2">Now, select the <strong class="bold">Groups</strong> tab at the top and click <strong class="bold">Add</strong> to create a new host group:</li>
</ol>
<div><div><img alt="Figure 12.19 – Creating a new host group " height="458" src="img/B18383_12_19.jpg" width="950"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.19 – Creating a new host group</p>
<p>New <a id="_idIndexMarker793"/>host group details will <a id="_idIndexMarker794"/>be displayed, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.20 – New host group details " height="403" src="img/B18383_12_20.jpg" width="1212"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.20 – New host group details</p>
<ol>
<li value="3">Click on the <strong class="bold">Hosts</strong> tab at the top. Then, click <strong class="bold">Add</strong> and select <strong class="bold">Add new host</strong>, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 12.21 – Adding new hosts to the host group " height="358" src="img/B18383_12_21.jpg" width="1208"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.21 – Adding new hosts to the host group</p>
<p>If you have already added the hosts directly, then add the host to this host group by selecting <strong class="bold">Add existing host</strong>.</p>
<ol>
<li value="4">Create <a id="_idIndexMarker795"/>a new host with a<a id="_idIndexMarker796"/> hostname and <code>ansible_host</code> information, as shown here:</li>
</ol>
<div><div><img alt="Figure 12.22 – Creating a new host " height="469" src="img/B18383_12_22.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.22 – Creating a new host</p>
<p>More variables can be added for host groups as hosts under the <strong class="bold">Variables</strong> section, as shown in <em class="italic">Figures 12.22</em> and <em class="italic">12.20</em>.</p>
<p class="callout-heading">Importing Your Inventory into the Automation Controller</p>
<p class="callout">Instead of adding managed nodes one by one, it is also possible to import your inventory from the project <a id="_idIndexMarker797"/>source, public cloud, or other inventory management systems. Refer to the documentation at <a href="https://docs.ansible.com/automation-controller/latest/html/administration/scm-inv-source.xhtml">https://docs.ansible.com/automation-controller/latest/html/administration/scm-inv-source.xhtml</a> to learn more.</p>
<h2 id="_idParaDest-227"><a id="_idTextAnchor227"/>Creating credentials in the automation controller</h2>
<p>In the<a id="_idIndexMarker798"/> previous chapters, we used SSH keys to access the managed nodes. The SSH private key was stored in the Ansible control node (<code>/home/ansible/.ssh/id_rsa</code>), but in this case, we must pass the private key using a credential.</p>
<p>Open the <code>devops</code>) and the SSH private key (you can also use <code>password</code> as the credential):</p>
<div><div><img alt="Figure 12.23 – Adding the Machine credential " height="564" src="img/B18383_12_23.jpg" width="1047"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.23 – Adding the Machine credential</p>
<p>Since we have enabled <code>NOPASSWD</code> (refer to <a href="B18383_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Ansible Automation – Introduction</em>, the <em class="italic">Configuring your managed nodes</em> section) for the <code>sudo</code> access, we do not need to enter any data in the <strong class="bold">Privilege Escalation</strong> fields:</p>
<div><div><img alt="Figure 12.24 – Machine credential privilege escalation fields " height="160" src="img/B18383_12_24.jpg" width="1067"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.24 – Machine credential privilege escalation fields</p>
<p>Save the <a id="_idIndexMarker799"/>credential and verify its details. The passwords and SSH private key content will be encrypted and will not be visible to anyone. You can only reset the SSH private key content or password in the credential, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.25 – Encrypted SS private key content " height="564" src="img/B18383_12_25.jpg" width="1212"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.25 – Encrypted SS private key content</p>
<p>With that, you have created a project, an inventory with a managed node (<code>dbnode1</code>), and a credential to access the node. Now, you must create a job template using the <code>Chapter-08/postgres-manage-database.yaml</code> playbook, as explained in the next section. </p>
<p class="callout-heading">Ansible Automation Controller – Credentials</p>
<p class="callout">Learn<a id="_idIndexMarker800"/> more about the credentials in the automation controller at <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/credentials.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/credentials.xhtml</a>. Please go to <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/credential_types.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/credential_types.xhtml</a> to learn more about custom credentials.</p>
<h2 id="_idParaDest-228"><a id="_idTextAnchor228"/>Creating a new job template</h2>
<p>A job template in the <a id="_idIndexMarker801"/>automation controller is a preconfigured definition with a set of parameters and a playbook for executing an Ansible automation job. To execute the same jobs several times, use a job template and pass the parameter as needed. Follow these steps:</p>
<ol>
<li value="1">Open the <strong class="bold">Templates</strong> tab on the left-hand side of the dashboard. Then, click on <strong class="bold">Add</strong> and select <strong class="bold">Add job template</strong>, as shown here:</li>
</ol>
<div><div><img alt="Figure 12.26 – Creating a job template " height="418" src="img/B18383_12_26.jpg" width="1211"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.26 – Creating a job template</p>
<ol>
<li value="2">Enter the details of the job template:</li>
</ol>
<div><div><img alt="Figure 12.27 – Job template details  " height="557" src="img/B18383_12_27.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.27 – Job template details </p>
<p class="callout-heading">Job Templates in the Automation Controller</p>
<p class="callout">Refer to the<a id="_idIndexMarker802"/> documentation at <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/job_templates.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/job_templates.xhtml</a> to learn more about how to customize job templates with additional options.</p>
<p>We have <a id="_idIndexMarker803"/>used variables inside the playbook (<em class="italic">Figure 12.28</em>) to demonstrate the operations without complexity. In the actual environment, the variables can be fetched from additional variable files, group variables, host variables, or extra variables. Now, we must pass the variables and values to the job template instead of using the hardcoded variables in the Ansible playbook: </p>
<div><div><img alt="Figure 12.28 – Hardcoded variables in the Ansible playbook " height="512" src="img/B18383_12_28.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.28 – Hardcoded variables in the Ansible playbook</p>
<p>It is possible to override these values by passing the parameters to the playbook using the <code>extra_vars</code> automatically.</p>
<ol>
<li value="3">Click on the <strong class="bold">Survey</strong> tab of <strong class="bold">Job template</strong>, as follows:</li>
</ol>
<div><div><img alt="Figure 12.29 – Job template survey " height="297" src="img/B18383_12_29.jpg" width="994"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.29 – Job template survey</p>
<ol>
<li value="4">Create a new survey question by clicking the <strong class="bold">Add</strong> button and filling in the details:</li>
</ol>
<div><div><img alt="Figure 12.30 – Job template survey form for collecting the NODES information " height="535" src="img/B18383_12_30.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.30 – Job template survey form for collecting the NODES information</p>
<p>In the preceding<a id="_idIndexMarker805"/> screenshot, we can see the following details:</p>
<ul>
<li>The answer variable’s name is <code>NODES</code>, which we will pass to the playbook for <code>hosts</code> (<code>hosts: "{{ NODES }}"</code>).</li>
<li>A multiple-choice menu will be displayed with options.</li>
</ul>
<p>Proceed to create survey questions for other variables as needed. Also, remember to enable the survey, as highlighted in the following screenshot:</p>
<div><div><img alt="Figure 12.31 – Ansible survey variables for the job template " height="692" src="img/B18383_12_31.jpg" width="1211"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.31 – Ansible survey variables for the job template</p>
<p>Remember to<a id="_idIndexMarker806"/> use the <code>password</code> type for the variables that carry sensitive information such as passwords or secrets.</p>
<p class="callout-heading">Surveys in the Automation Controller</p>
<p class="callout">A survey can be used to set extra variables <a id="_idIndexMarker807"/>for the playbook with user-friendly forms and validations. Refer to the documentation at https://docs.ansible.com/automation-controller/latest/html/userguide/job_templates.xhtml#surveys to learn more about survey forms.</p>
<p>We assume that the following variables will not change every time and do not need to be inside the survey form:</p>
<pre class="source-code">
ansible_become_user: postgres 
postgres_host: localhost</pre>
<p>Instead, add them as extra variables and save the job template:</p>
<div><div><img alt="Figure 12.32 – Extra variables in the Ansible job template " height="661" src="img/B18383_12_32.jpg" width="1229"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.32 – Extra variables in the Ansible job template</p>
<p>Also pass <a id="_idIndexMarker808"/>variables such as <code>ansible_become_user</code> in the host variable or group variable section, but this will impact all the jobs on that node, which is not the desired configuration in this case.</p>
<p>In the next section, you will learn how to execute the automation job that we configured previously.</p>
<h2 id="_idParaDest-229"><a id="_idTextAnchor229"/>Executing an automation job from the automation controller</h2>
<p>In the <a id="_idIndexMarker809"/>previous sections, you configured many resources in the automation controller, such as the organization, projects, inventory, managed nodes, credentials, job templates, and more. Now, let’s test the job template by launching the automation job.</p>
<p class="callout-heading">Ansible Collection and Execution Environment</p>
<p class="callout">Use the collection from the execution environment or the project repository (<code>COLLECTIONS_PATHS = ./collections</code>). Not all Ansible collections (or latest versions) will be available in the execution environment, and it is possible to create a custom execution <a id="_idIndexMarker810"/>environment with the required collections and libraries. Refer to the documentation at <a href="https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.xhtml">https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.xhtml</a> to learn more about creating an execution environment. In this demonstration, we will be using the <code>community.postgresql</code> Ansible collection, which is already available in the project repository (refer to <a href="B18383_08.xhtml#_idTextAnchor144"><em class="italic">Chapter 8</em></a>, <em class="italic">Helping the Database Team with Automation</em>).</p>
<p>Open<a id="_idIndexMarker811"/> the <strong class="bold">Templates</strong> tab from the automation controller dashboard and find the PostgreSQL job template that we created in the previous section. Click on the <strong class="bold">Launch Template</strong> button (the small rocket icon) and wait for the survey template to pop up:</p>
<div><div><img alt="Figure 12.33 – Launching the job template from the automation controller " height="393" src="img/B18383_12_33.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.33 – Launching the job template from the automation controller</p>
<p>Enter the details in the survey’s form and click <strong class="bold">Next</strong>:</p>
<div><div><img alt="Figure 12.34 – Entering the details in the survey form " height="710" src="img/B18383_12_34.jpg" width="1021"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.34 – Entering the details in the survey form</p>
<p>The details <a id="_idIndexMarker812"/>will be displayed on the preview screen. Notice that the survey variables are passing as extra variables. Click on the <strong class="bold">Launch</strong> button and wait for the job screen to load:</p>
<div><div><img alt="Figure 12.35 – Details of the job in preview " height="703" src="img/B18383_12_35.jpg" width="1021"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.35 – Details of the job in preview</p>
<p>The job<a id="_idIndexMarker813"/> will be executed on the target nodes. Every detail about the job will be displayed on the <strong class="bold">Output</strong> tab, including the playbook execution output, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.36 – Job execution output on the automation controller " height="731" src="img/B18383_12_36.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.36 – Job execution output on the automation controller</p>
<p>Verify the <a id="_idIndexMarker814"/>database and user creation on the database nodes (<code>dbnode1</code>) as needed. </p>
<p>The same job template can be used to execute the operations on different database nodes or databases as the variables are dynamic and do not need to be modified in the playbook.</p>
<p>In this section, you learned how to create basic resources and launch the automation job in the automation controller. In the next section, you will learn how to integrate other applications, such as the Jenkins CI/CD server, with the automation controller and trigger automated executions.</p>
<h1 id="_idParaDest-230"><a id="_idTextAnchor230"/>Integrating Jenkins with AAP</h1>
<p>Jenkins (https://www.jenkins.io) is <a id="_idIndexMarker815"/>a well-known open source tool (written in the Java programming language) that<a id="_idIndexMarker816"/> can be<a id="_idIndexMarker817"/> used to implement <strong class="bold">continuous integration/continuous delivery</strong> (<strong class="bold">CI/CD</strong>) and deployment solutions. Automating<a id="_idIndexMarker818"/> the build and deployment is the key to effective <a id="_idIndexMarker819"/>DevOps practices. As shown in the following diagram, developers and testers can offload such tasks to CI/CD tools such as Jenkins:</p>
<div><div><img alt="Figure 12.37 – CI/CD workflow using Jenkins " height="740" src="img/B18383_12_37.jpg" width="1138"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.37 – CI/CD workflow using Jenkins</p>
<p>Jenkins can execute many tasks natively or use plugins but for complex tasks, Jenkins can utilize the appropriate tools. For example, instead of calling complex scripts or commands inside the Jenkins pipeline, a specific job can be offloaded to the Ansible automation controller, as shown in the following diagram:</p>
<div><div><img alt="Figure 12.38 – Jenkins integration with AAP for database operations " height="825" src="img/B18383_12_38.jpg" width="1122"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.38 – Jenkins integration with AAP for database operations</p>
<p>The automation <a id="_idIndexMarker820"/>controller will execute the job based on the parameters <a id="_idIndexMarker821"/>passed and return the result to Jenkins as feedback (success/fail and other messages).</p>
<p class="callout-heading">GitOps and CI/CD Courses</p>
<p class="callout">Refer to <a href="https://www.techbeatly.com/gitops-cicd/">https://www.techbeatly.com/gitops-cicd/</a> to find free GitOps and CI/CD courses and<a id="_idIndexMarker822"/> certifications, including those for Jenkins. </p>
<p>In the following demonstration, you will reuse the database creation job template as part of deploying the ToDo application.</p>
<p>The following are the prerequisites:</p>
<ul>
<li>The Jenkins server must have been installed with the Ansible Tower plugin (<a href="https://plugins.jenkins.io/ansible-tower">https://plugins.jenkins.io/ansible-tower</a>).</li>
<li>Knowledge of Jenkins operations and configurations.</li>
<li>The <code>PostgreSQL - Create Database and User Access</code> job template must have been configured on the automation controller.</li>
<li>Application repository (<a href="https://github.com/ginigangadharan/nodejs-todo-demo-app">https://github.com/ginigangadharan/nodejs-todo-demo-app</a>).</li>
</ul>
<h2 id="_idParaDest-231"><a id="_idTextAnchor231"/>Ansible Tower plugin for Jenkins </h2>
<p>The Ansible Tower plugin in <a id="_idIndexMarker823"/>Jenkins helps you execute automation jobs on Ansible Tower (or the automation controller) by passing the appropriate parameters:</p>
<div><div><img alt="Figure 12.39 – Ansible Tower plugin for Jenkins " height="317" src="img/B18383_12_39.jpg" width="1049"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.39 – Ansible Tower plugin for Jenkins</p>
<p>Install the plugin if you haven’t done so yet and create an Ansible Tower (automation controller) connection (add the appropriate credentials needed) under <strong class="bold">Manage Jenkins</strong> | <strong class="bold">Configure System</strong>:</p>
<div><div><img alt="Figure 12.40 – Automation controller configuration for the Ansible Tower plugin in Jenkins " height="535" src="img/B18383_12_40.jpg" width="1060"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.40 – Automation controller configuration for the Ansible Tower plugin in Jenkins</p>
<p>Verify the connection from<a id="_idIndexMarker824"/> Jenkins to the Ansible automation controller by tapping the <strong class="bold">Test Connection</strong> button, as shown in the preceding screenshot. </p>
<p>In the next section, you will learn how to create and configure multibranch pipelines in Jenkins.</p>
<h2 id="_idParaDest-232"><a id="_idTextAnchor232"/>Multibranch pipelines in Jenkins</h2>
<p>Create a multibranch pipeline<a id="_idIndexMarker825"/> in Jenkins using the ToDo app repository (<a href="https://github.com/ginigangadharan/nodejs-todo-demo-app">https://github.com/ginigangadharan/nodejs-todo-demo-app</a>), as <a id="_idIndexMarker826"/>shown in the following screenshot:</p>
<div><div><img alt="Figure 12.41 – A multibranch pipeline in Jenkins " height="294" src="img/B18383_12_41.jpg" width="945"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.41 – A multibranch pipeline in Jenkins</p>
<p>Also, configure<a id="_idIndexMarker827"/> the automated pipeline trigger by scanning<a id="_idIndexMarker828"/> the source repository every minute. By enabling this, Jenkins will scan the repository for changes every minute and trigger the build process automatically:</p>
<div><div><img alt="Figure 12.42 – Scanning multibranch pipeline triggers " height="160" src="img/B18383_12_42.jpg" width="945"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.42 – Scanning multibranch pipeline triggers</p>
<h2 id="_idParaDest-233"><a id="_idTextAnchor233"/>Creating a Jenkinsfile</h2>
<p>A <code>Jenkinsfile</code> is a <code>Jenkinsfile</code>. The following screenshot shows the available <code>Jenkinsfile</code> in the <code>todo</code> application source repository:</p>
<div><div><img alt="Figure 12.43 – A Jenkinsfile with environment variables " height="536" src="img/B18383_12_43.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.43 – A Jenkinsfile with environment variables</p>
<p>In a production environment, sensitive variables need to be considered when storing vault services or credentials. </p>
<p>The following screenshot shows calling the database creation job in the automation controller:</p>
<div><div><img alt="Figure 12.44 – Database creation stage in the Jenkinsfile " height="328" src="img/B18383_12_44.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.44 – Database creation stage in the Jenkinsfile</p>
<p><code>ansible_controller_job()</code> is <a id="_idIndexMarker830"/>written at the bottom of the <code>Jenkinsfile</code>, as shown here:</p>
<div><div><img alt="Figure 12.45 – ansible_controller_job in the Jenkinsfile " height="749" src="img/B18383_12_45.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.45 – ansible_controller_job in the Jenkinsfile</p>
<p>Notice the <code>extraVars</code> parameter <a id="_idIndexMarker831"/>we are passing since those variables are mandatory and need to pass via extra variables or a survey form (which is not applicable in this case).</p>
<p>In the next section, you will explore the automated build trigger and automated database provisioning that can be done via the Ansible automation controller.</p>
<h2 id="_idParaDest-234"><a id="_idTextAnchor234"/>Triggering a build in the Jenkins pipeline</h2>
<p>A new <a id="_idIndexMarker832"/>build will be triggered automatically whenever <a id="_idIndexMarker833"/>there is a change (new commit) in the repository or whenever the build is initiated manually. The following screenshot shows the build history in the job; notice that the <strong class="bold">Creating Database</strong> stage is highlighted:</p>
<div><div><img alt="Figure 12.46 – Build jobs in the Jenkins pipeline " height="522" src="img/B18383_12_46.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.46 – Build jobs in the Jenkins pipeline</p>
<p>Check the build console logs and find the Ansible automation controller job execution with detailed output, as shown in the following screenshot:</p>
<div><div><img alt="Figure 12.47 – The Jenkins build console with Ansible job execution details " height="671" src="img/B18383_12_47.jpg" width="1099"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.47 – The Jenkins build console with Ansible job execution details</p>
<p>With that, you have learned how to call automation controller jobs from a Jenkins pipeline and automate complex build steps. </p>
<h2 id="_idParaDest-235"><a id="_idTextAnchor235"/>Further enhancements to the Jenkins pipeline</h2>
<p>Explore the <a id="_idIndexMarker834"/>integration between Jenkins and the Ansible automation controller by adding more Ansible jobs to the pipeline, as follows:</p>
<ul>
<li>Create a job template in the automation controller for building container images and push them to the container registry. (Refer to the Ansible artifacts from <a href="B18383_10.xhtml#_idTextAnchor178"><em class="italic">Chapter 10</em></a>, <em class="italic">Managing Containers Using Ansible</em>.)</li>
<li>Add a build step in the <code>Jenkinsfile</code> and call the automation controller job to build the container image for the application.</li>
<li>Create another job template in the automation controller for deploying applications in a Kubernetes cluster by using the container image that was created in the previous stage. (Refer to the Ansible artifacts from <a href="B18383_11.xhtml#_idTextAnchor194"><em class="italic">Chapter 11</em></a>, <em class="italic">Managing Kubernetes Using Ansible</em>.)</li>
<li>Add a deployment step to the <code>Jenkinsfile</code> and call the automation controller job to <a id="_idIndexMarker835"/>deploy the updated application with the latest container image.</li>
</ul>
<p>In the next section, you will learn how to enable notifications in the automation controller and integrate it with the Slack messaging service.</p>
<h1 id="_idParaDest-236"><a id="_idTextAnchor236"/>Integrating an automation controller with Slack and notification services</h1>
<p>In <a href="B18383_03.xhtml#_idTextAnchor052"><em class="italic">Chapter 3</em></a>, <em class="italic">Automating Your Daily Jobs</em>, you learned how to use the <code>mail</code> module to send custom emails using Ansible. In the <a id="_idIndexMarker836"/>Ansible automation <a id="_idIndexMarker837"/>controller, it is possible to configure <strong class="bold">Notifications</strong> to send emails and messages based on job start, success, or fail status. The following notification types are supported in the automation controller:</p>
<ul>
<li>Email</li>
<li>IRC</li>
<li>Webhook</li>
<li>Grafana</li>
<li>Slack</li>
<li>Mattermost</li>
<li>PagerDuty</li>
<li>Rocket.Chat</li>
<li>Twilio</li>
</ul>
<p>Multiple notifications can be created and required notifications can be enabled for the job template.</p>
<h2 id="_idParaDest-237"><a id="_idTextAnchor237"/>Creating email notifications in the automation controller</h2>
<p>To<a id="_idIndexMarker838"/> create an email notification, open the <strong class="bold">Notifications</strong> tab from the dashboard and click <strong class="bold">Add</strong>. Select the type as <strong class="bold">Email</strong> and fill <a id="_idIndexMarker839"/>in the details, as shown in the following screenshot:</p>
<ul>
<li>If the email server is open (no authentication required), then leave the <strong class="bold">Username</strong> and <strong class="bold">Password</strong> fields empty.</li>
<li>Enable TLS or SSL if the email server supports it.</li>
<li>Enter an approved sender email (email whitelisting).</li>
</ul>
<p>Save the form and create the notification:</p>
<div><div><img alt="Figure 12.48 – Creating an email notification in the automation controller " height="708" src="img/B18383_12_48.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.48 – Creating an email notification in the automation controller</p>
<p>Once you have created the notification, open the job template that you want to enable this notification for and select the <strong class="bold">Notifications</strong> tab. Toggle the switches for <strong class="bold">Start</strong>, <strong class="bold">Success</strong>, and <strong class="bold">Failure</strong> as needed:</p>
<div><div><img alt="Figure 12.49 – Enabling notifications in the job template " height="356" src="img/B18383_12_49.jpg" width="1090"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.49 – Enabling notifications in the job template</p>
<p>In the preceding example, the notification will only be triggered if the job is successful. </p>
<p>Execute <a id="_idIndexMarker840"/>the job template and verify that you can<a id="_idIndexMarker841"/> receive the email on job success. A sample email is shown in the following screenshot:</p>
<div><div><img alt="Figure 12.50 – Sample email notification from the automation controller " height="866" src="img/B18383_12_50.jpg" width="1097"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.50 – Sample email notification from the automation controller</p>
<p>Customize<a id="_idIndexMarker842"/> the notification message and its content<a id="_idIndexMarker843"/> by editing the notification entry, as shown here:</p>
<div><div><img alt="Figure 12.51 – Customizing the email notification in the automation controller " height="703" src="img/B18383_12_51.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.51 – Customizing the email notification in the automation controller</p>
<p>In the next section, you will learn how to integrate automation control with Slack to enable notifications in the Slack channel.</p>
<h2 id="_idParaDest-238"><a id="_idTextAnchor238"/>Sending Slack notifications from the automation controller</h2>
<p>Slack<a id="_idIndexMarker844"/> is a workplace messaging platform (<a href="https://app.slack.com">https://app.slack.com</a>) in which users can send instant <a id="_idIndexMarker845"/>messages and create calls, video conferences, and more. Slack conversations are organized as Slack channels and multiple channels can be created in a workplace. </p>
<p>Slack is well known for its flexibility in integrating with your IT and application infrastructure. This is because it supports integration with about 2,400 applications (<a href="https://slack.com/apps">https://slack.com/apps</a>):</p>
<div><div><img alt="Figure 12.52 – Slack integration (source: https://slack.com/integrations) " height="605" src="img/B18383_12_52.jpg" width="756"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.52 – Slack integration (source: https://slack.com/integrations)</p>
<p>In the<a id="_idIndexMarker846"/> following demonstration, you<a id="_idIndexMarker847"/> will learn how to create a Slack authentication token to send notifications from the automation controller. Follow these steps:</p>
<ol>
<li value="1">Sign up/log into Slack and access your existing workplace. (If you do not have a workplace to use, then create a new workplace by following the documentation at <a href="https://slack.com/help/articles/206845317-Create-a-Slack-workspace">https://slack.com/help/articles/206845317-Create-a-Slack-workspace</a>.)</li>
<li>Use an existing channel in your workplace (or create a new channel for testing purposes by following the documentation at <a href="https://slack.com/help/articles/201402297-Create-a-channel">https://slack.com/help/articles/201402297-Create-a-channel</a>). For this demonstration, we have created a new channel called <code>#database-operations</code>.</li>
<li>Open <a href="https://api.slack.com">https://api.slack.com</a> in a web browser, click on the <strong class="bold">Tutorials</strong> menu (top right) and <a id="_idIndexMarker848"/>select <strong class="bold">Publish interactive notifications</strong>, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 12.53 – Publish interactive notifications tutorial " height="452" src="img/B18383_12_53.jpg" width="570"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.53 – Publish interactive notifications tutorial</p>
<ol>
<li value="4">The tutorial will <a id="_idIndexMarker849"/>open at <a href="https://api.slack.com/tutorials/tracks/actionable-notifications">https://api.slack.com/tutorials/tracks/actionable-notifications</a>. Select <strong class="bold">Create App</strong> from the <strong class="bold">Create a pre-configured app</strong> section.</li>
<li>Slack will ask you to choose your workplace. Here, configure the app’s details, such as its name, redirect URL, and other items.</li>
<li>Complete the instructions in the tutorial to create the app.</li>
<li>Once the<a id="_idIndexMarker850"/> app has been created, open the app configuration and copy the OAuth token, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 12.54 – Copying the Slack app OAuth token " height="595" src="img/B18383_12_54.jpg" width="934"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.54 – Copying the Slack app OAuth token</p>
<ol>
<li value="8">Log into the Ansible <a id="_idIndexMarker851"/>automation controller and create a new notification with its <code>#database-operations</code>). Customize the message as well if required:</li>
</ol>
<div><div><img alt="Figure 12.55 – Creating a Slack notification in the automation controller " height="533" src="img/B18383_12_55.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.55 – Creating a Slack notification in the automation controller</p>
<ol>
<li value="9">Open the<a id="_idIndexMarker852"/> notification settings <a id="_idIndexMarker853"/>for the job template and enable the newly created Slack notification, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 12.56 – Enabling the Slack notification for the job template " height="386" src="img/B18383_12_56.jpg" width="1208"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.56 – Enabling the Slack notification for the job template</p>
<ol>
<li value="10">Execute the job again and verify the Slack channel to see the message:</li>
</ol>
<div><div><img alt="Figure 12.57 – Job notification in Slack from the automation controller " height="435" src="img/B18383_12_57.jpg" width="1145"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.57 – Job notification in Slack from the automation controller</p>
<p>Explore the <strong class="bold">Notifications</strong> option<a id="_idIndexMarker854"/> with other <a id="_idIndexMarker855"/>applications to implement effective notifications for your team and workplace.</p>
<p class="callout-heading">Slack Tutorials</p>
<p class="callout">Refer to <a href="https://api.slack.com/tutorials">https://api.slack.com/tutorials</a> to learn more about Slack<a id="_idIndexMarker856"/> and its available tutorials.</p>
<p>With that, you have learned how to integrate Ansible with Slack to enable notifications. Implement the same for other notification and messaging services such as Mattermost, Rocket.Chat, and others.</p>
<h1 id="_idParaDest-239"><a id="_idTextAnchor239"/>Summary</h1>
<p>In this chapter, you learned about the enterprise automation solution called Red Hat AAP. First, you learned about the benefits of using AAP and its features. You also learned about the different components of AAP, such as its execution environment, automation controller, automation mesh, and Automation Hub.</p>
<p>After that, you learned more about the automation controller by creating different resources such as organizations, projects, inventories, managed nodes and groups, credential job templates with survey forms and extra variables, and more. You also learned how to integrate the Jenkins CI/CD tool with Red Hat AAP to trigger the jobs automatically as part of the build and deployment pipeline. </p>
<p>Finally, you explored the notification options in the automation controller and tested them with different types of notifications such as email and Slack. All this knowledge will help you implement and manage automation using AAP and integrate AAP with different tools in your environment.</p>
<p>In the next chapter, you will learn how to use Ansible Vault to manage secrets and sensitive information for Ansible artifacts. </p>
<h1 id="_idParaDest-240"><a id="_idTextAnchor240"/>Further reading</h1>
<p>To learn more about the topics that were covered in this chapter, take a look at the following resources:</p>
<ul>
<li><em class="italic">Why choose Red Hat for automation?</em>: <a href="https://www.redhat.com/en/topics/automation/why-choose-red-hat-for-automation">https://www.redhat.com/en/topics/automation/why-choose-red-hat-for-automation</a></li>
<li><em class="italic">Deploying Ansible Automation Platform 2.1</em>: <a href="https://access.redhat.com/documentation/en-us/reference_architectures/2021/html-single/deploying_ansible_automation_platform_2.1/index">https://access.redhat.com/documentation/en-us/reference_architectures/2021/html-single/deploying_ansible_automation_platform_2.1/index</a> </li>
<li><em class="italic">Red Hat Ansible Automation Platform datasheet</em>: <a href="https://www.redhat.com/en/resources/ansible-automation-platform-datasheet%0D">https://www.redhat.com/en/resources/ansible-automation-platform-datasheet</a></li>
<li><em class="italic">Control your content with private Automation Hub – Ansible blog</em>: <a href="https://www.ansible.com/blog/control-your-content-with-private-automation-hub%0D">https://www.ansible.com/blog/control-your-content-with-private-automation-hub</a></li>
<li><em class="italic">What is a Red Hat AAP automation execution environment?</em>: <a href="https://www.redhat.com/en/technologies/management/ansible/automation-execution-environments">https://www.redhat.com/en/technologies/management/ansible/automation-execution-environments</a> </li>
</ul>
</div>
<div><div></div>
</div>
</div></body></html>