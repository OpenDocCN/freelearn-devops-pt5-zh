<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure Networking - Foundation of Azure IaaS</h1>
                </header>
            
            <article>
                
<p>The next step in our cloud journey is Azure networking. This step will lay the foundation for our Azure infrastructure and will be used by both IaaS and PaaS in chapters to come. It's important to design and implement your Azure network with consideration for all Azure services that will be used in the future. This will save you a lot of headaches, and keep your cloud journey safe and without turbulence. </p>
<p>The areas that we'll cover in this chapter are the following:</p>
<ul>
<li>Azure VNet</li>
<li>Address ranges</li>
<li>Subntets</li>
<li>IP address types and reservations</li>
<li>DNS</li>
<li><strong>Network security groups</strong> (<strong>NSGs</strong>)</li>
<li>Azure virtual machine networking</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>For this chapter, you'll need an <span>Azure subscription.</span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure networking basics</h1>
                </header>
            
            <article>
                
<p>The networking stack in Microsoft Azure is very important and is the foundation for other services, especially when we talk about IaaS. Setting up Azure networking correctly is very important, as it will be key to setting up your <span>IaaS</span> infrastructure and allowing your virtual machines to communicate. The networking stack in Azure is composed of two components, external and private. External is used to access service endpoints over the internet and private is used for communication between Azure services internally.</p>
<p>Almost all Azure services have external endpoints configured by default, but we have some special cases when we don't want to enable access over the internet. In these cases, we can disable external endpoints and set up these services to use private traffic only. This applies to PaaS as well, even though these services usually don't have private network access configured by default (except for some PaaS services that are designed for this, for example, app service isolated). In this chapter, we'll discuss basic networking features and will continue to explore networking options for specific services when the time comes.</p>
<p><span>IaaS</span> usually has external endpoints configured as well, but we have the option to disable these and not allow access over the internet. On the other hand, IaaS always comes with a private network configured. Every virtual machine in Azure has to be assigned to a virtual network and have a private IP address assigned. Even if we have a single virtual machine configured and want to use it only for public access over the internet, a virtual network will be created in the background, and this VM will have a private IP address assigned. </p>
<p>Azure networking also extends to VPN options, which allow you to access services only over a private network and private IP addresses. This allows you to secure resources further and disable any kind of public access. We will explore these features and options when we discuss hybrid cloud with Microsoft Azure.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating your first virtual network in Azure</h1>
                </header>
            
            <article>
                
<p><strong>Azure virtual network</strong> (<strong>Azure VNet</strong>) is created in two cases, when you create a new VNet or when you create a new Azure virtual machine. Options are similar in both cases, but I recommend creating Azure VNet in advance and joining virtual machines to an existing VNet because this gives you a few more options.</p>
<p>To create a new Azure Vnet, open the Azure portal, select <span class="packt_screen">Create a resource</span> and choose <span class="packt_screen">Virtual network</span> in <span class="packt_screen">Networking</span> services (or search for <kbd>Virtual network</kbd> in the search bar), as shown in the following screenshot:</p>
<p class="mce-root"/>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-567 image-border" src="Images/8b11dcce-39f3-4980-9162-59b52e6da46f.png" style="width:40.58em;height:30.17em;" width="762" height="565"/></div>
<p><span>You need parameters for your virtual network. The resource name must be unique on the resource group level and must be one string, with no spaces allowed. My resource <span class="packt_screen">Name</span> is <kbd>PacktVNet</kbd>, but it could be <kbd>Packt_VNet</kbd> if I wanted to separate the words. The next parameter we need to provide is <span class="packt_screen">Address space</span>. This will define how many IP addresses will be available in this VNet and uses CIDR format. The biggest address space is <kbd>/8</kbd> and smallest is <kbd>/29</kbd>. In this case, I'll use <kbd>/16</kbd>, which will give me plenty of address space to use. We need to select the subscription where we want to place our resource (only if we have multiple subscriptions; one will be selected by default in the case of a single subscription). Two options are available for <span class="packt_screen">Resource group</span> name, either a new one or to select an existing resource group. As I usually configure virtual network prior to any other resource, a new resource group is created along with</span> VNet<span>. The next step is to select the region where we want to create the resource. I recommend to select the Azure data center closest to you geographically, as this will provide the least network latency in the future. If you selected an existing resource group, this option will be preselected as the same region in which the resource group is located. You need to name the default subnet and provide an address space for that subnet. The address range for the subnet must be inside the address range of your VNet address space.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p class="mceNonEditable"/>
<p><span>Basic DDoS protection is provided by default for free, but you can select the standard tier, which is charged separately. We will discuss DDoS further when we reach <a href="0e16c405-a21c-4cfc-9dc6-e20fc05db041.xhtml" target="_blank">Chapter 9</a>, <em>Azure Security and Administration</em>. Examples of the information needed for virtual network deployment are shown in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-568 image-border" src="Images/f237aaca-ae7a-447e-8603-2db4cdd05800.png" style="width:21.42em;height:49.00em;" width="344" height="786"/></div>
<p>The final option is related to service endpoints. If we enable this, new windows will be shown, as in the following screenshot. This option enables you to attach PaaS services to your VNet. You can select between Azure Cosmos DB, event hub, key vault, service bus, SQL, and storage, or you can select all of them. At this time, I'll disable endpoints and we'll discuss them later:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-569 image-border" src="Images/aef94448-da9a-4ac3-8540-4a9eaad02f6c.png" style="width:15.08em;height:13.33em;" width="274" height="241"/></div>
<p><span>The last step is to confirm options and start the process of creating a resource. Azure virtual network works relatively fast and a resource should be created in less than a minute. This can depend on data center workload and the number of requests but should be completed relatively quickly, even in high-demand situations. </span></p>
<p>Azure virtual network represents your own network in the cloud. It has similar features to your local network, such as IP address range and subnets. If you're familiar with networking in on-premises scenarios, it will be very easy to understand Azure networking.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Azure virtual network options</h1>
                </header>
            
            <article>
                
<p>Once deployment is finished, you have different management options available. Locate your resource group and open <span>the </span>VNet blade. In <span>the</span> <span class="packt_screen"><span>O</span>verview</span> tab, you can see different information about your VNet, such as resource group, subscription location, and so on. </p>
<p>In settings, we have multiple options that are available for configuration: <span class="packt_screen">Address space</span>, <span class="packt_screen">Connected Devices</span>, <span class="packt_screen">Subnets</span>, <span class="packt_screen">DDoS protection</span>, <span class="packt_screen">DNS servers</span>, <span class="packt_screen">Peering</span>, and <span class="packt_screen">Service endpoints</span>. Properties, locks, and automation scripts are available for every resource in Azure and aren't limited only to Azure VNet. Properties have read-only information about your resource, and locks point out if there are any services in dependency to this service. The automation script will generate an ARM template for resource redeployment. Note that this option generates an ARM template for a complete resource group, not only for a specific resource. The automation script can be used for future redeployment, in case we need to replicate resources for a new client or a new environment. </p>
<p>In address space, we can edit an existing address space or add additional ones. There are two restrictions: address spaces can't overlap and you can't change an address space to be smaller than <span>the </span>subnets using that address space. For example, if you created address space <kbd>10.1.0.0/16</kbd> and subnet <kbd>10.1.0.0./16</kbd>, <span>the </span>address space can't be changed to less than <kbd>10.1.0.0/16</kbd> unless <span>the </span>subnet is changed first. It's important, how you use an address space; in terms of future VPN connection, you cannot connect Azure VNet to a network (Azure or physical) using <span>the </span>same address space. Adding <span>a </span>new address space can be seen in the following screenshot. Make sure <span>the </span>new address space doesn't overlap with <span>the </span>existing one:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-570 image-border" src="Images/6352acd0-2a3f-428d-83aa-233e0cab8707.png" style="width:32.25em;height:12.58em;" width="559" height="218"/></div>
<p>In <span>the s</span>ubnet blade, you have two options: to change <span>the </span>existing subnet or to add a new one. For both options, you have to use existing address spaces, and subnets can't overlap. An existing subnet can't be changed to use less address space than already in use. For example, if you have an address space of <kbd>10.1.0.0/24</kbd> and have 200 VMs on <span>the </span>subnet already, then you can't change to anything less than <kbd>/24</kbd>, as <kbd>/25</kbd> has only 128 addresses available.</p>
<p>Another thing to note is that you don't have <span>the </span>complete IP range available on your subnet; five IP addresses are reserved for Azure-provided network roles such as DNS or DHCP. Speaking of DHCP, having a custom DHCP solution in Azure is not supported, you have to use an Azure-provided DHCP. This is not the case with DNS; by default, you use the Azure DNS service, but can use a custom solution as well.</p>
<p>To add a new subnet, you need to provide similar information to when you created the default one during VNet deployment, but you have a couple of additional options. Again, you need to provide a name for your subnet and IP address range that must use <span>the </span>existing IP address range of your VNet and must not overlap with other subnets on your VNet. Note that here you get information about <span>the </span>reservation of five IP addresses for Azure networking services. A similar VNet deployment is the service endpoint option, which allows you to add PaaS services to your subnet. You can assign a <span class="packt_screen">Network security group</span> to <span>the </span>subnet level and assign <span class="packt_screen">Route table</span>.</p>
<p><span>NSG</span>s are your main tool to control traffic on Azure Vnets, and we'll discuss them in more detail later. Azure routes traffic automatically between all subnets on <span>the </span>same VNet, but you can create custom route tables to override <span>the </span>default options. This can be useful in cases when you have VPN or virtual appliance (third-party firewalls in Azure). An example of adding a new subnet to VNet is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-571 image-border" src="Images/d298e1e3-7721-4314-8571-c483c8cdcb11.png" style="width:38.25em;height:39.67em;" width="764" height="791"/></div>
<p>The DNS blade allows us to add a custom DNS solution to our VNet. As mentioned before, this is Azure-<span>provided by default but you can use your own DNS, either a VM with DNS or public DNS.</span></p>
<p><span>If you have a Site2Site connection to your local network, this can be DNS for your local network. If this is the case, I would recommend using a replica of your DNS in Azure. This will make the response faster and DNS available on your Azure VNet in case the VPN connection or your local network is down for some reason. The option to provide custom DNS is shown in the following screenshot. You need to provide the IP address of the DNS server, the public IP in case you choose public DNS, or a private one if you deploy DNS on your VNet:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-572 image-border" src="Images/11db6274-3098-461f-a78f-ae7648c290b6.png" style="width:67.17em;height:23.42em;" width="806" height="281"/></div>
<p>We had the option to add service endpoints to our VNet during deployment, but we can add them at any time using <span>the s</span>ervice endpoint blade, shown in the following screenshot. As adding these services starts a provisioning process that will set up routing and rules, it can take up to 15 minutes for <span>the </span>process to complete. The service endpoint option is available on at the VNet and subnet levels, so you can enable endpoints either for a complete network or on a single subnet. Using a single subnet gives you more control and the ability to separate <span>the </span>PaaS service from rest of your virtual network:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-573 image-border" src="Images/4f2dc55d-584b-4138-8af4-b8334d5a5888.png" style="width:30.25em;height:16.42em;" width="568" height="309"/></div>
<p>Peering allows you to connect your VNet to other VNets in order to exchange traffic. This is available only for VNets in a single Azure tenant (but available across subscriptions in that tenant). You need to give a name to <span>the</span> connection and then select <span>the </span>appropriate subscription and virtual network. You have some additional options to define if needed, like if you want traffic forwarding, allowing gateway transit, and use of remote gateways. By default, only traffic coming from one VNet will go to <span>the </span>second VNet. Traffic coming from outside VNets that are connected by peering (coming from a second peer, only one of <span>the </span>VNets is involved in or coming over gateways) will not be forwarded unless you specify these options.</p>
<p>For example, let's say we have three VNets: A, B, and C. A is connected to B, and C is connected to B, but there is no direct connection between A and C. By default, traffic would be allowed for A to B, from B to A, from B to C, and C to B. No traffic would go from A to C or from C to A. If we enable traffic forwarding, traffic from A to C and C to A would go through.</p>
<p>A similar thing goes for virtual gateways. Let's say we have networks A and B and peering between these VNets. VNet A has a virtual gateway and is connected to our on-premises network. By default, traffic would be allowed from A to B, B to A, from the on-premises network to A and from A to on-premises network. No traffic would be allowed from on-premises network to B and from B to on-premises network, unless we allow this traffic using extra options that allow gateway transit and the use of remote gateways.</p>
<p>Another way to achieve this is to create a virtual gateway for each VNet and create a Site2Site connection, <span>the </span>same one that you would use in case you wanted to connect to your on-premises network (we'll discuss this in the hybrid cloud chapter). The big difference between <span>the </span>two approaches is that peering is free and you pay for a virtual gateway. If you want to connect two VNets that are located on different tenants, you need to use a virtual gateway; peering is available only for VNets on <span>the </span>same tenant.</p>
<p>To connect different networks, either VNet to VNet or VNet to local network, IP address spaces/subnets must not overlap. If you have <span>the </span>same subnet for both networks, you won't be able to create this connection as this would create confusion and make routing impossible. It would be impossible to distinguish which device is on which network and where traffic should go. How to connect your VNet to another VNet in your subscription is shown in the following screenshot: </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-574 image-border" src="Images/f2088ad9-ccee-4943-9ef2-eff8063208b1.png" style="width:34.92em;height:39.25em;" width="689" height="774"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p>Where we have multiple networks connected either by peering or Site2Site, it's recommended to use route tables. Custom route tables allow us to create and forward traffic in specific cases and define rules concerning where traffic should go in each situation. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Connected devices</h1>
                </header>
            
            <article>
                
<p>We have our VNet configured and ready but we need resources in there to actually start using it. The first step is to add a new Azure virtual machine to our VNet in order to start using <span>the </span>Azure networking stack.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating an Azure virtual machine</h1>
                </header>
            
            <article>
                
<p>In order to create a new Azure virtual machine through <span>the </span>portal, we have to take three steps. We need to select <span class="packt_screen">New resource</span> and select a new virtual machine. We have hundreds of images available and we'll discuss that in chapters to come:</p>
<ol>
<li>In this case, we need a single VM only, to show networking options for it, and we'll set all default parameters in order to get there quickly. I selected <span>the </span><span class="packt_screen">Windows Server 2016</span> image and started providing <span>the </span>basic information needed: <span class="packt_screen">Name</span>, <span class="packt_screen">VM disk type</span>, <span class="packt_screen">Username</span>, <span class="packt_screen">Password</span>, <span class="packt_screen">Subscription</span>, <span class="packt_screen">Resource group</span>, and <span class="packt_screen">Location</span>. Note that under <span class="packt_screen">Location</span>, you have <span>the </span>options to create a new resource group and select an existing one. I selected to <span class="packt_screen">Use existing</span>, the same one where our VNet is located.</li>
</ol>
<p style="padding-left: 60px">    An example of basic VM creation is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-575 image-border" src="Images/cf139d58-0d9c-4b30-b836-db2501700914.png" style="width:20.08em;height:53.58em;" width="297" height="792"/></div>
<ol start="2">
<li><span><span>The next </span></span>step is to choose virtual machine size. This again is not <span>relevant </span>to <span>the </span>networking part and I'll select <span>the </span>first one offered, <span class="packt_screen">B1s</span>, shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-576 image-border" src="Images/c1f64034-7e9b-4d48-b4de-6f8c65ac585d.png" style="width:44.25em;height:31.25em;" width="1120" height="791"/></div>
<ol start="3">
<li>In the final step, we are getting to the part where we have some networking options. I'll leave all other options at their defaults and concentrate on the network part.</li>
</ol>
<p class="mce-root"/>
<p>First, we need to choose <span>the </span><span class="packt_screen">Virtual network</span> our VM will be connected to. We can choose either an existing one or create a new VNet. If no VNet is found, new VNet parameters will be automatically provided. If there is already a virtual network in <span>the r</span>esource group where we place our VM, that VNet will be automatically selected. In our case, <span>the </span><span class="packt_screen">PacktVNet</span> created in <span>the </span>first step is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-577 image-border" src="Images/f671e0f2-5066-4a76-bf76-2549fc7b9385.png" style="width:39.17em;height:27.00em;" width="731" height="504"/></div>
<p>The second option we have is to choose <span>the</span> <span class="packt_screen"><span>S</span>ubnet</span> for our VM. If we are creating a new VNet along with <span>the </span>VM, this option will not be available; only <span>the </span>default subnet will be created. To be able to choose between subnets, a virtual network needs to be created prior to <span>the </span>VM, along with <span>the </span>subnet you want to use. In this case, I'll choose to join <span>the </span>VM to the DMZ subnet I created before. Selecting <span>the</span> <span class="packt_screen"><span>S</span>ubnet</span> option is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-578 image-border" src="Images/d913aedf-a375-4067-81ee-e0236077353b.png" style="width:32.33em;height:20.33em;" width="737" height="464"/></div>
<p>We also have options to choose <span>the</span> <span class="packt_screen"><span>P</span>ublic IP address</span> for our VM. We can choose from an existing one (a reserved IP address no longer in use) or create a new public IP address. Same goes for <span class="packt_screen">Network Security Groups</span>: we can choose an existing one or create a new one. I'll select to create a new <span class="packt_screen">Public IP address</span> and a new <span class="packt_screen">Network Security Group</span> for my VM, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-579 image-border" src="Images/229c263d-ff92-4152-8419-1a8ff9261189.png" style="width:19.25em;height:26.33em;" width="358" height="489"/></div>
<p class="mce-root"/>
<p>After this, <span>the </span>deployment of <span>the </span>VM starts and it takes a few minutes until <span>the </span>process is complete. The time required to deploy a new Azure virtual machine depends on <span>the </span>VM size, screenshot, and number of requests against <span>the </span>data center.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">IP address types</h1>
                </header>
            
            <article>
                
<p>Once <span>the </span>deployment of <span>the </span>VM is finished, we can see <span>the </span>device in <span class="packt_screen">Connected devices</span> under <span>the v</span>irtual network blade. An example of what the connected device blade looks like is shown in the following screenshot. Information shown here includes the device name, type of device connected, private IP address, and subnet <span>the </span>device is assigned to. IP address information is related to a private IP address, one that was assigned to our VM on <span>the </span>VNet level and is used only for internal traffic. Note that type of device is <span class="packt_screen">Network interface</span>. Every VM has a <strong>network interface card</strong> (<strong>NIC</strong>) that is used to communicate with the network and one is automatically created with your VM. A <span>virtual machine</span> can have more than one NIC if you need to connect to multiple subnets or make sure that <span>the </span>VM is available, even when one NIC fails. The number of NICs depends on VM size, it can be from 1 for basic tier VMs to 8 for higher tiers:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-580 image-border" src="Images/a66337bd-c431-4e79-ab10-b5a1393cebb1.png" style="width:128.33em;height:43.25em;" width="1540" height="519"/></div>
<p class="mce-root"/>
<p>If we click on <span>the </span>device, it will take us to <span>the NIC</span> blade, as illustrated in the following screenshot. We can get to <span>the </span>same blade if we select NIC in <span>the r</span>esource group. In IP configuration, we can enable or disable <span class="packt_screen">IP forwarding</span>, change <span>the</span> <span class="packt_screen"><span>S</span>ubnet</span> that <span>the </span>NIC is connected to, and see <span>the </span><span class="packt_screen">IP configurations</span> for both private and public IP addresses:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-581 image-border" src="Images/96bf93cf-2f4a-4831-b588-1af4e10be46e.png" style="width:136.17em;height:46.92em;" width="1634" height="563"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Private IP addresses</h1>
                </header>
            
            <article>
                
<p>If we select IP configuration, we have further options for IP addresses. An example is show in the following screenshot.</p>
<p>By default, a public IP address is enabled but we can disable it if needed. This is often used when <span>the </span>VM is in <span>the </span>backend and now public exposure is needed. In this case, we need to make sure that we have other options to connect to this VM, usually through a VPN. Disabling a public IP address is often in hybrid cloud <span>scenarios</span><span> </span><span>when no access over <span>the </span>internet is needed. Beside using <span>the </span>public IP address assigned, we can create a new one as well here.</span></p>
<p class="mce-root"/>
<p>A private IP address is by default dynamic and can change over time. A change of IP address will not happen out of thin air but in <span>the </span>case of a VM restart or shutdown. If we use a private IP address for communication with other VMs on our VNet, we may want to keep this address. This can be done by setting IP address assignment from <span class="packt_screen">Dynamic</span> to <span class="packt_screen">Static</span>. This will reserve our IP for this NIC even if <span>the </span>VM is kept turned off for a long period of time:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-582 image-border" src="Images/e5d12c21-7387-42f3-99bd-4db4f9bd028c.png" style="width:41.25em;height:33.00em;" width="687" height="550"/></div>
<p>DNS is another option that is available on <span>both</span><span> </span><span>the </span><span>Vnet and VM levels. We can assign <span class="packt_screen">Custom</span> DNS that will apply only for this specific NIC. If we assign DNS to <span>the </span>VNet level, that DNS will be applied to all VMs connected to that VNet. The default option for NIC DNS is to inherit <span>the </span>setting from <span>the </span>virtual network. In this case, it will be either Azure DNS or custom DNS, depending on VNet settings. If we selected <span class="packt_screen">Custom</span> DNS for VNet, we can no longer choose Azure DNS as an option on <span>the </span>NIC level. Our only option available is to use <span class="packt_screen">Inherit from virtual network</span> or <span class="packt_screen">Custom</span> DNS. The DNS blade on <span>the </span>NIC level is shown in the following screenshot:</span></p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-583 image-border" src="Images/e600ed88-1b4a-4e19-a026-a012e5aaedf0.png" style="width:126.50em;height:44.17em;" width="1518" height="530"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Network security groups</h1>
                </header>
            
            <article>
                
<p>NSGs are a set of security rules applied on your Azure network resources. They are <span>the </span>main tool to enforce and control network traffic rules for your resources. NSGs can be applied to two types of resources: subnets and NICs. If an NSG is applied to a subnet, <span>the </span>rules will be applied to all devices that are connected to that subnet. When an NSG is applied to an NIC, <span>the </span>rules will be applied only for that device.</p>
<p>In <span>the </span>overview of <span>the </span>NSG blade, we can see all <span>the </span>rules that are currently applied, both inbound and outbound. By default, all inbound traffic from outside is disabled, except port <kbd>3389</kbd>, which allows us to connect to <span>the </span>VM remotely. All inbound traffic coming from inside <span>the </span>virtual network or Azure load balancers is allowed. These rules can be edited and more added as needed.</p>
<p>Outbound traffic is by default allowed on all levels, going to <span>the </span>virtual network or outside. These rules can be edited as well, but there is usually no need to restrict outbound traffic.</p>
<p>All rules have a priority assigned to them; a lower number represents a rule with a higher priority. For example, we have <span>the </span>RDP rule with priority <kbd>1000</kbd> and <span>the </span><kbd>DenyAllInBound</kbd> rule (which will block all inbound traffic) with priority <kbd>65500</kbd>. Even though <span>the </span><kbd><span>DenyAllInBound </span></kbd><span>rule</span><span> to block all incoming traffic is enforced, <span>the </span>rule to allow RDP has a higher priority and will be enforced first. As a result, we have all inbound traffic blocked with <span>the </span>exception of RDP, which is allowed due to being a higher priority rule.</span></p>
<p>NSG settings can be opened either through <span>the </span>NIC blade or by selecting NSG in <span>the </span>list of resources in <span>the r</span>esource group. The overview of <span>the </span>NSG blade is shown in the following screenshot:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-584 image-border" src="Images/0b141627-152f-4af7-9ee5-9d464fda092f.png" style="width:136.83em;height:65.42em;" width="1642" height="785"/></div>
<p>To add a new rule, go to <span class="packt_screen">Inbound security rules</span> and select <span class="packt_screen">Add new rule</span>. You can choose basic or advanced. If you choose basic, only a few options will be available to choose from. I recommend using advanced, as this will give you more control over rules:</p>
<ul>
<li><span><span class="packt_screen">Source</span>: </span>For <span class="packt_screen">Source</span>, you can select between several options. <span class="packt_screen">Any</span> will allow traffic from any source. <span class="packt_screen">IP addresses</span> will allow traffic only from named addresses; you can enter either a single IP or a range of IP addresses in the CIDR format. This can be very useful for restricting access over port <kbd>3389</kbd> and to secure your <span>virtual machine</span>s. <span class="packt_screen">Service tag</span> will allow traffic coming from a specific service. For example, using <span>the </span><span class="packt_screen">Service tag</span> option, you can allow traffic coming from Azure storage but block everything else.<br/>
The last option for source is an <strong>Application Security Group</strong> <span>(</span><strong>ASG</strong><span>)</span><span>. An ASG allows you to create rules and allow traffic only to a certain  group of resources on your network. For example, we have multiple servers in our VNet, web servers and database servers. Allowing traffic over port</span> <kbd>1433 </kbd> <span>to database servers should be enabled for web servers but not over</span> <span>the </span><span>internet. Placing web servers in an ASG and creating a rule would allow only web servers to access our databases over port</span> <kbd>1433</kbd> <span>and stop any other traffic.</span></li>
</ul>
<ul>
<li><span><span class="packt_screen">Source port ranges</span>: </span>With <span class="packt_screen">Source port ranges</span>, we can also restrict traffic and allow it only if it's coming from a specific port or port range.</li>
<li><span class="packt_screen"><span>Destination </span><span>port ranges</span></span><span>: </span>The <span class="packt_screen">Destination <span>port ranges</span></span> option is similar to <span>the </span>source option; we have <span>the </span>same set of options available. An ASG is something that can be useful to allow traffic only to a certain type of VM on your network. For example, placing web servers in an ASG and allowing traffic over ports <kbd>443</kbd> or <kbd>80</kbd> would allow only these servers to be accessed over these ports and block traffic to any other type of VM.<br/>
The <span class="packt_screen">Destination port ranges</span> <span>allow us to specify over which ports traffic is allowed, restricting it to a single port or a range.</span></li>
<li><span class="packt_screen">Protocol</span>: It helps us define which protocols are allowed, choosing from either TCP or UDP.</li>
<li><span class="packt_screen">Action</span>: It defines whether this rule is used to allow traffic or block it. An NSG can be used either way, it can help us define if certain traffic is allowed, but can be used to deny traffic as well and help us secure our resources in Azure.</li>
<li><span class="packt_screen">Priority</span>: This option is very important as it allows us to define which rules are applied first and which rules have <span>the </span>advantage. As mentioned before, the lower <span>the </span>priority number assigned to <span>the </span>rule, <span>the </span>higher priority <span>the </span>rule has. The rules are processed in order, from the highest priority rule (the lowest number) to the lower priority rule (higher number) until the condition is met. Once the condition is met, the rule is processed, and the rule processing stops. For example, let's create a rule that will block all traffic over port <kbd>1433</kbd> and give it priority <kbd>1000</kbd>, and then create a rule that will allow certain sources to have traffic over port <kbd>1433</kbd> with priority <kbd>2000</kbd>. No traffic over port <kbd>1433</kbd> will ever go through, as a rule with a higher priority is blocking this traffic.</li>
<li><span class="packt_screen">Name</span>: The last options are to <span class="packt_screen">Name</span> <span>the </span>rule and enter a <span class="packt_screen">Description</span>. The <span class="packt_screen">Description</span> is optional, but I encourage you to fill this in, as it will help you later to keep track and understand why something was created in the first place.</li>
</ul>
<p class="mce-root"/>
<p>Example settings<span> for advanced options in an NSG are shown in the following screenshot:</span></p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-585 image-border" src="Images/150a7fd7-3759-434d-a382-f6d849896d56.png" style="width:22.08em;height:48.17em;" width="378" height="825"/></div>
<p><span>NSG</span>s can be applied on two levels, to NICs and to subnets. If an NSG is applied to an NIC, <span>the </span>rules defined in that NSG will be enforced only for <span>the virtual machine</span> attached to that NIC. If an NSG is applied to a subnet, <span>the </span>rules will be enforced on all VMs on that subnet. </p>
<p>You can have an NSG applied both on a subnet and an NIC in some cases. Be careful with configuration in that case, as only traffic that is allowed on both levels will go through. If we have traffic over port <kbd>80</kbd> allowed on <span>the </span>subnet level but blocked on <span>the </span>NIC level, nothing will pass over port <kbd>80</kbd>. Same goes <span>the </span>other way around, if allowed on <span>the </span>NIC but blocked on <span>the </span>subnet, nothing will pass. If you want to block something on <span>the </span>VM that has NSG applied on both <span>the </span>subnet and NIC levels, it's enough to block traffic over <span>the </span>named port on one of <span>the </span>NSGs.</p>
<p>Using <span>NSG</span>s in combination with ASGs is <span>the </span>best possible way to protect and secure your resources.</p>
<p>Let's create a scenario where we have three groups of servers: web, application, and database.</p>
<p>We need web servers to have a connection to application servers and application servers to have a connection to <span>the </span>database server. The only connection allowed over <span>the </span>internet would be to web servers and we don't want a connection over internet to database servers under any circumstances. The first step would be to create three Azure security groups, one ASG for each server role. The next step would be to configure NSG rules with <span>the </span>use of ASGs.</p>
<p>Connection over <span>the </span>internet would be allowed only to servers that are in the web ASG. Connection to application servers would be allowed only in <span>the </span>case that traffic is coming from servers placed in <span>the </span>web ASG. This would be achieved by setting a rule that would allow traffic to <span>the </span>application ASG from <span>the </span>web ASG, blocking everything else. Finally, we create a rule that allows traffic to database servers (<span>the </span>database ASG) only in cases when <span>the </span>traffic is coming from <span>the </span>application ASG. </p>
<p>This approach makes administration and maintenance easier and more consistent. If you are adding a server to any of <span>the </span>three pools, you need to set proper rules and all apply <span>the </span>settings needed. It's easy to make a misstep that would result in that server not having all <span>the </span>needed connections or, in <span>the </span>worst case, being a security issue. When using an NSG and ASG to keep track of all <span>the </span>rules, all we need to do is add a new server to <span>the </span>proper ASG and all <span>the </span>rules and settings will automatically apply.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Public IP address</h1>
                </header>
            
            <article>
                
<p>Public IP address settings are available through NSG settings or by selecting <span class="packt_screen">Public IP address</span> from <span>the </span>resources in <span>the </span><span class="packt_screen">Resource group</span> blade.</p>
<p>Settings for public IP addresses are similar to private IP addresses. By default, they are <span class="packt_screen">Dynamic</span>, so <span>the </span>IP can change in <span>the </span>case of a restart or shutdown, but we can change this setting to <span class="packt_screen">Static</span>. <span class="packt_screen">Static</span> will keep <span>the </span>reservation of our IP but there is a difference between public and private IP addresses in this case. Private IP reservation is free of charge as this is an internal IP, so you can choose <span>the </span>range and even set an IP address from that range to be reserved for a specific VM. Public IP addresses are assigned and there isn't <span>the </span>option to choose which IP address you want. The other difference is that public IP address reservation is not free; the first five public IP address reservations are free per subscription, but every reservation over that number is charged. The price of a reservation over <span>the </span>initial five public IP addresses is not much (around $3 per month), but it's good to know what you're paying for.</p>
<p>A public IP address can be removed from your NIC if you want to restrict access (private IP addresses can't be removed). If you choose to use a public IP address, you'll probably need it either to connect to your VM remotely or to use it for applications. If you don't want to create a reservation, there is another option, to use a DNS name label. This option will assign a DNS name to your NIC and you can use it to access your VM. Any change of public IP address, which may happen as result of a restart or shutdown of your VM, will be handled by Azure DNS. Options for public IP address configuration are shown in the following screenshot:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-586 image-border" src="Images/c1ceee20-9179-4829-8e54-5052785a91fe.png" style="width:93.17em;height:43.92em;" width="1118" height="527"/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Other Azure network services</h1>
                </header>
            
            <article>
                
<p>The Azure services that we have covered so far are just part of the Azure networking stack. The <span>Azure networking stack doesn't stop here and there are many other Azure services that are network-related,</span> such as traffic manager, load balancers, or virtual gateways. <span>Some of them will be covered in chapters to come.</span></p>
<p>For example, we'll discuss load balancers with <span>virtual machine</span> high availability. A similar case will be with traffic manager when we discuss high availability for PaaS. Virtual gateways will be our topic in the chapter about hybrid cloud with Microsoft Azure.</p>
<p>Hybrid scenarios and security can be managed with a virtual appliance. Virtual appliances are Azure <span>virtual machine</span>s with third-party firewall software. Most leading <span>industry</span><span> </span><span>firewalls are supported and available (such as Barracuda, CheckPoint, Cisco, and PaloAlto). Virtual machine images for virtual appliances are available through Azure marketplace, and you can easily configure and set up a virtual appliance and use it to manage and secure your Azure network.</span></p>
<p><span>However, Microsoft Azure is evolving daily and more services are becoming available. It would be impossible to cover all services and features. Each chapter in this book is potentially a standalone book.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">ARM templates</h1>
                </header>
            
            <article>
                
<p>We already talked about ARM templates and how they can help us automate things. For this chapter, I created a virtual network and joined one <span>virtual machine </span>to that network. </p>
<p>If you move to automation, you can find an ARM template in JSON format that you can use to redeploy my resources. The ARM template will contain all <span>the </span>resources and all <span>the </span>settings: a virtual network and parameters, a <span>virtual machine</span> with information about <span>the </span>image and size, <span>NSG</span> rules, and so on. It will contain information on all dependencies and information on what needs to be created first. For example, in order to create a VM, a subnet needs to be created in order to join <span>the </span>VM to that subnet, and a subnet can't be created until a VNet is created.</p>
<p class="mce-root"/>
<p>Note that some <kbd>parameters</kbd>, such as passwords, are not provided as a password isn't allowed to be shown in clear text, but only as a secure string, so you need to provide these <kbd>parameters</kbd> manually:</p>
<pre>{<br/> "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",<br/> "contentVersion": "1.0.0.0",<br/> "parameters": {<br/> "virtualMachines_PacktVM1_name": {<br/> "defaultValue": "PacktVM1",<br/> "type": "String"<br/> },<br/> "virtualNetworks_PacktVNet_name": {<br/> "defaultValue": "PacktVNet",<br/> "type": "String"<br/> },<br/> "networkInterfaces_packtvm1240_name": {<br/> "defaultValue": "packtvm1240",<br/> "type": "String"<br/> },<br/> "publicIPAddresses_PacktVM1_ip_name": {<br/> "defaultValue": "PacktVM1-ip",<br/> "type": "String"<br/> },<br/> "networkSecurityGroups_PacktVM1_nsg_name": {<br/> "defaultValue": "PacktVM1-nsg",<br/> "type": "String"<br/> },<br/> "subnets_DMZ_name": {<br/> "defaultValue": "DMZ",<br/> "type": "String"<br/> },<br/> "subnets_default_name": {<br/> "defaultValue": "default",<br/> "type": "String"<br/> },<br/> "securityRules_default_allow_rdp_name": {<br/> "defaultValue": "default-allow-rdp",<br/> "type": "String"<br/> },<br/> "adminUsername": {<br/> "type": "string",<br/> "metadata": {<br/> "description": "Default Admin username"<br/> }<br/> },<br/> "adminPassword": {<br/> "type": "securestring",<br/> "metadata": {<br/> "description": "Default Admin password"<br/> }<br/> }<br/> },<br/> "variables": {},<br/> "resources": [<br/> {<br/> "type": "Microsoft.Compute/virtualMachines",<br/> "name": "[parameters('virtualMachines_PacktVM1_name')]",<br/> "apiVersion": "2017-12-01",<br/> "location": "westeurope",<br/> "scale": null,<br/> "properties": {<br/> "hardwareProfile": {<br/> "vmSize": "Standard_B1s"<br/> },<br/> "storageProfile": {<br/> "imageReference": {<br/> "publisher": "MicrosoftWindowsServer",<br/> "offer": "WindowsServer",<br/> "sku": "2016-Datacenter",<br/> "version": "latest"<br/> },<br/> "osDisk": {<br/> "osType": "Windows",<br/> "name": "[concat(parameters('virtualMachines_PacktVM1_name'),'_OsDisk_1_b6ae3bba44ef491f8c2acd7bfb5aa975')]",<br/> "createOption": "FromImage",<br/> "caching": "ReadWrite",<br/> "managedDisk": {<br/> "storageAccountType": "Standard_LRS"<br/> },<br/> "diskSizeGB": 127<br/> },<br/> "dataDisks": []<br/> },<br/> "osProfile": {<br/> "computerName": "[parameters('virtualMachines_PacktVM1_name')]",<br/> "adminUsername": "[parameters('adminUsername')]",<br/> "adminPassword": "[parameters('adminPassword')]",<br/> "windowsConfiguration": {<br/> "provisionVMAgent": true,<br/> "enableAutomaticUpdates": true<br/> },<br/> "secrets": []<br/> },<br/> "networkProfile": {<br/> "networkInterfaces": [<br/> {<br/> "id": "[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaces_packtvm1240_name'))]"<br/> }<br/> ]<br/> },<br/> "diagnosticsProfile": {<br/> "bootDiagnostics": {<br/> "enabled": true,<br/> "storageUri": "https://nagiosdiag316.blob.core.windows.net/"<br/> }<br/> }<br/> },<br/> "dependsOn": [<br/> "[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaces_packtvm1240_name'))]"<br/> ] <br/> },<br/> {<br/> "type": "Microsoft.Network/networkInterfaces",<br/> "name": "[parameters('networkInterfaces_packtvm1240_name')]",<br/> "apiVersion": "2018-02-01",<br/> "location": "westeurope",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "resourceGuid": "2d51720b-041b-4248-ab04-8dd9fd3fa7d9",<br/> "ipConfigurations": [<br/> {<br/> "name": "ipconfig1",<br/> "etag": "W/\"b681e202-2d98-4d28-a30d-aaf93b9f1243\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "privateIPAddress": "10.1.1.4",<br/> "privateIPAllocationMethod": "Static",<br/> "publicIPAddress": {<br/> "id": "[resourceId('Microsoft.Network/publicIPAddresses', parameters('publicIPAddresses_PacktVM1_ip_name'))]"<br/> },<br/> "subnet": {<br/> "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_PacktVNet_name'), parameters('subnets_DMZ_name'))]"<br/> },<br/> "primary": true,<br/> "privateIPAddressVersion": "IPv4"<br/> }<br/> }<br/> ],<br/> "dnsSettings": {<br/> "dnsServers": [],<br/> "appliedDnsServers": [],<br/> "internalDomainNameSuffix": "gbyhmwrx0mmutogdwlxg2i521c.ax.internal.cloudapp.net"<br/> },<br/> "macAddress": "00-0D-3A-2E-EA-03",<br/> "enableAcceleratedNetworking": false,<br/> "enableIPForwarding": false,<br/> "networkSecurityGroup": {<br/> "id": "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_PacktVM1_nsg_name'))]"<br/> },<br/> "primary": true<br/> },<br/> "dependsOn": [<br/> "[resourceId('Microsoft.Network/publicIPAddresses', parameters('publicIPAddresses_PacktVM1_ip_name'))]",<br/> "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_PacktVNet_name'), parameters('subnets_DMZ_name'))]",<br/> "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_PacktVM1_nsg_name'))]"<br/> ]<br/> },<br/> {<br/> "type": "Microsoft.Network/networkSecurityGroups",<br/> "name": "[parameters('networkSecurityGroups_PacktVM1_nsg_name')]",<br/> "apiVersion": "2018-02-01",<br/> "location": "westeurope",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "resourceGuid": "11b65174-a94e-44e1-947c-dd140c45a6c8",<br/> "securityRules": [<br/> {<br/> "name": "default-allow-rdp",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "protocol": "TCP",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "3389",<br/> "sourceAddressPrefix": "*",<br/> "destinationAddressPrefix": "*",<br/> "access": "Allow",<br/> "priority": 1000,<br/> "direction": "Inbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> }<br/> ],<br/> "defaultSecurityRules": [<br/> {<br/> "name": "AllowVnetInBound",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "description": "Allow inbound traffic from all VMs in VNET",<br/> "protocol": "*",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "*",<br/> "sourceAddressPrefix": "VirtualNetwork",<br/> "destinationAddressPrefix": "VirtualNetwork",<br/> "access": "Allow",<br/> "priority": 65000,<br/> "direction": "Inbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> },<br/> {<br/> "name": "AllowAzureLoadBalancerInBound",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "description": "Allow inbound traffic from azure load balancer",<br/> "protocol": "*",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "*",<br/> "sourceAddressPrefix": "AzureLoadBalancer",<br/> "destinationAddressPrefix": "*",<br/> "access": "Allow",<br/> "priority": 65001,<br/> "direction": "Inbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> },<br/> {<br/> "name": "DenyAllInBound",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "description": "Deny all inbound traffic",<br/> "protocol": "*",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "*",<br/> "sourceAddressPrefix": "*",<br/> "destinationAddressPrefix": "*",<br/> "access": "Deny",<br/> "priority": 65500,<br/> "direction": "Inbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> },<br/> {<br/> "name": "AllowVnetOutBound",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "description": "Allow outbound traffic from all VMs to all VMs in VNET",<br/> "protocol": "*",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "*",<br/> "sourceAddressPrefix": "VirtualNetwork",<br/> "destinationAddressPrefix": "VirtualNetwork",<br/> "access": "Allow",<br/> "priority": 65000,<br/> "direction": "Outbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> },<br/> {<br/> "name": "AllowInternetOutBound",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "description": "Allow outbound traffic from all VMs to Internet",<br/> "protocol": "*",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "*",<br/> "sourceAddressPrefix": "*",<br/> "destinationAddressPrefix": "Internet",<br/> "access": "Allow",<br/> "priority": 65001,<br/> "direction": "Outbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> },<br/> {<br/> "name": "DenyAllOutBound",<br/> "etag": "W/\"9b7736d4-5a76-4804-a63f-6cd1875f1d5c\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "description": "Deny all outbound traffic",<br/> "protocol": "*",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "*",<br/> "sourceAddressPrefix": "*",<br/> "destinationAddressPrefix": "*",<br/> "access": "Deny",<br/> "priority": 65500,<br/> "direction": "Outbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> }<br/> }<br/> ]<br/> },<br/> "dependsOn": []<br/> },<br/>{<br/> "type": "Microsoft.Network/publicIPAddresses",<br/> "sku": {<br/> "name": "Basic",<br/> "tier": "Regional"<br/> },<br/> "name": "[parameters('publicIPAddresses_PacktVM1_ip_name')]",<br/> "apiVersion": "2018-02-01",<br/> "location": "westeurope",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "resourceGuid": "972b3091-fe6e-49cc-bd06-22d260608254",<br/> "ipAddress": "40.74.60.181",<br/> "publicIPAddressVersion": "IPv4",<br/> "publicIPAllocationMethod": "Dynamic",<br/> "idleTimeoutInMinutes": 4,<br/> "ipTags": []<br/> },<br/> "dependsOn": []<br/> },<br/>{<br/> "type": "Microsoft.Network/virtualNetworks",<br/> "name": "[parameters('virtualNetworks_PacktVNet_name')]",<br/> "apiVersion": "2018-02-01",<br/> "location": "westeurope",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "resourceGuid": "5a767030-d337-4919-b8c3-b2ee6e23fcda",<br/> "addressSpace": {<br/> "addressPrefixes": [<br/> "10.1.0.0/16",<br/> "10.2.0.0/16"<br/> ]<br/> },<br/> "subnets": [<br/> {<br/> "name": "default",<br/> "etag": "W/\"98f91850-e7b2-40b6-8043-1caa5bf4865a\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "addressPrefix": "10.1.0.0/24",<br/> "serviceEndpoints": []<br/> }<br/> },<br/> {<br/> "name": "DMZ",<br/> "etag": "W/\"98f91850-e7b2-40b6-8043-1caa5bf4865a\"",<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "addressPrefix": "10.1.1.0/24",<br/> "serviceEndpoints": []<br/> }<br/> }<br/> ],<br/> "virtualNetworkPeerings": [],<br/> "enableDdosProtection": false,<br/> "enableVmProtection": false<br/> },<br/> "dependsOn": []<br/> },<br/>{<br/> "type": "Microsoft.Network/networkSecurityGroups/securityRules",<br/> "name": "[concat(parameters('networkSecurityGroups_PacktVM1_nsg_name'), '/', parameters('securityRules_default_allow_rdp_name'))]",<br/> "apiVersion": "2018-02-01",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "protocol": "TCP",<br/> "sourcePortRange": "*",<br/> "destinationPortRange": "3389",<br/> "sourceAddressPrefix": "*",<br/> "destinationAddressPrefix": "*",<br/> "access": "Allow",<br/> "priority": 1000,<br/> "direction": "Inbound",<br/> "sourcePortRanges": [],<br/> "destinationPortRanges": [],<br/> "sourceAddressPrefixes": [],<br/> "destinationAddressPrefixes": []<br/> },<br/> "dependsOn": [<br/> "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_PacktVM1_nsg_name'))]"<br/> ]<br/> },<br/>{<br/> "type": "Microsoft.Network/virtualNetworks/subnets",<br/> "name": "[concat(parameters('virtualNetworks_PacktVNet_name'), '/', parameters('subnets_default_name'))]",<br/> "apiVersion": "2018-02-01",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "addressPrefix": "10.1.0.0/24",<br/> "serviceEndpoints": []<br/> },<br/> "dependsOn": [<br/> "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_PacktVNet_name'))]"<br/> ]<br/> },<br/>{<br/> "type": "Microsoft.Network/virtualNetworks/subnets",<br/> "name": "[concat(parameters('virtualNetworks_PacktVNet_name'), '/', parameters('subnets_DMZ_name'))]",<br/> "apiVersion": "2018-02-01",<br/> "scale": null,<br/> "properties": {<br/> "provisioningState": "Succeeded",<br/> "addressPrefix": "10.1.1.0/24",<br/> "serviceEndpoints": []<br/> },<br/>"dependsOn": [<br/>"[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_PacktVNet_name'))]"<br/>]<br/>}<br/>]<br/>}</pre>
<p>This can be particularly helpful once we have multiple resources deployed in our resource  group. Using these <span>templates, we can provision identical</span> environments<span> automatically, quickly, and with precision. Redeploying a resource group to recreate an environment by hand can lead to</span> inconsistencies<span> and missing steps. Using ARM templates produces the same result each and every time.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>We covered <span>the </span>basic features of Azure networking with virtual networks, IP address types, and <span>NSG</span>s. This basic knowledge of Azure networking will be <span>the </span>foundation for chapters to come.</p>
<p><span>It's also very important to understand ARM templates, as they will be very helpful once our infrastructure becomes more complex. </span></p>
<p>From here, we'll advance to Azure IaaS, which will use Azure networking as <span>the </span>backbone and <span>the </span>service that holds everything together. We'll see how to create advanced VM scenarios that will use Azure networking, private for communication between VMs and public for external access. We'll explain in more detail options for creating new Azure <span>virtual machine</span>s, availability groups, and high-availability for IaaS in Azure. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>Which services are depended on <span>the </span>Azure network in Microsoft Azure?
<ol>
<li><span>IaaS</span></li>
<li>PaaS</li>
<li>Both</li>
</ol>
</li>
<li>What defines <span>the </span>IP address range in Azure?
<ol>
<li>Subnet mask</li>
<li>CIDR</li>
<li>RIP</li>
</ol>
</li>
<li>Service endpoints are used to connect which services to your virtual network?
<ol>
<li>Virtual machines</li>
<li>PaaS</li>
<li>SaaS</li>
</ol>
</li>
<li>The default DNS service in Microsoft Azure is...?
<ol>
<li>Azure DNS</li>
<li>Public DNS</li>
<li>Custom DNS</li>
</ol>
</li>
<li>When can service endpoints be added?
<ol>
<li>When creating a virtual network</li>
<li>After a virtual network is created</li>
<li>At any time</li>
</ol>
</li>
<li>Private IP addresses in Azure can be...?
<ol>
<li>Dynamic</li>
<li>Static</li>
<li>Both</li>
</ol>
</li>
<li><span>Public IP addresses in Azure can be...</span>?
<ol>
<li>Dynamic</li>
<li>Static</li>
<li>Both</li>
</ol>
</li>
<li><span>NSG</span>s are...? 
<ol>
<li>Security rules that define traffic flow</li>
<li>Rules on IP address reservations</li>
<li>Both</li>
</ol>
</li>
</ol>
<ol start="9">
<li>What does an NSG define?
<ol>
<li>Outbound traffic rules</li>
<li>Inbound traffic rules</li>
<li>Both</li>
</ol>
</li>
<li>To what can an NSG not be assigned to?
<ol>
<li>Virtual network</li>
<li>NIC</li>
<li>Subnet</li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    </div>



  </body></html>