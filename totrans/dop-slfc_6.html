<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Continuous Integration</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we learned about the importance of version control systems in projects and how we can achieve version control in our Salesforce project. We looked at instructions for how to set up our own GitLab server and push metadata from the Salesforce organization to the Git repository. After following the steps to install Git on a developer machine and sync it with the Salesforce sandbox, developers will be able to make and save their changes in the Git repository.</p>
<p>In this chapter, we will learn about how we can use Git integration with Jenkins to automate backups and the deployment of Salesforce metadata. We will discuss Jenkins and look at how continuous integration is achieved in Salesforce using Jenkins and the Ant Migration Tool. We will look at how to configure the Ant Migration Tool with Jenkins and and how to configure a Jenkins job to retrieve metadata from the sandbox. We will cover step-by-step instructions for deploying changes to UAT or a testing environment using Jenkins.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>What is Jenkins?</li>
<li>Installing Jenkins</li>
<li>Configuring the Ant Migration Tool with Jenkins</li>
<li>Providing sandbox credentials to Jenkins</li>
<li>Configuring a Jenkins job to retrieve metadata from a sandbox</li>
<li>Configuring a Jenkins job to deploy metadata on a sandbox</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What is Jenkins?</h1>
                </header>
            
            <article>
                
<p>Jenkins is a continuous integration server written in Java. Jenkins is an open source automation server. You can install it on your machine easily. Jenkins can be installed on Windows, macOS, and Linux machines. Jenkins is easily configurable and has many plugins to support continuous integration and deployment. If you have experience of using containers, you can use Docker to install Jenkins using Docker images from the registry.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">CI using Jenkins</h1>
                </header>
            
            <article>
                
<p>Continuous integration entails developers pushing their code to a shared repository and testing it using regular builds so that they can detect problems in the code gradually.</p>
<div class="packt_infobox">There are several tools that can be used to achieve continuous integration.</div>
<p>Using continuous integration, you can easily back-track where things have gone wrong in the code. If you don't follow continuous integration, it will be more difficult and expensive to detect errors in the code at the production stage.</p>
<p>The following is a list of CI tools:</p>
<ul>
<li>Jenkins</li>
<li>TeamCity</li>
<li>Travis CI</li>
<li>Go CD</li>
<li>Bamboo</li>
</ul>
<p>In this chapter, we are going to use Jenkins to achieve continuous integration.</p>
<p>Jenkins is an open source, cross-platform CI tool. Jenkins has ability to add plugins, which makes it very flexible and easy to integrate. You can configure CI using the UI as well as commands.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing a Jenkins server</h1>
                </header>
            
            <article>
                
<p>Let's start with the Jenkins server installation on a Windows server. Installation on the Linux server has already been covered in <a href="92e8e2f1-2836-46d5-bfc4-7876cf9b8a9f.xhtml">Chapter 2</a>, <em>Applying DevOps to Salesforce Applications.</em> We will cover Jenkins server installation on a Windows machine here so that Windows users can get an idea about the setup.</p>
<p>The following are the hardware and software requirements for installation of the Jenkins server.</p>
<p>The hardware requirements are:</p>
<ul>
<li>256 MB of RAM</li>
<li>1 GB of drive space</li>
</ul>
<p>The software requirements are:</p>
<ul>
<li>Java 8</li>
<li>A web browser: Jenkins is supported by most of popular web browsers, such as Google Chrome, Mozilla Firefox, Microsoft Internet Explorer, and the latest version of Apple Safari</li>
</ul>
<p>Download the latest Jenkins server package for Windows at the following website <a href="http://mirrors.jenkins.io/windows/latest"><span class="URLPACKT">http://mirrors.jenkins.io/windows/latest</span></a>. You will get the latest ZIP file on your machine of the version of the Jenkins package.</p>
<p>Once the download is completed, extract the ZIP file and start the installation by double-clicking on the <kbd>jenkins.msi</kbd> file. Follow the Jenkins setup wizard to complete the Jenkins server installation. Choose the path for the Jenkins server installation and click on <span class="packt_screen">Next</span>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/7f59f533-24f7-4693-9bfc-c21eb0013f22.png" style="width:39.75em;height:31.08em;"/></div>
<p>On the next screen, click on <span class="packt_screen">Install</span> to proceed with the installation:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c9104091-7d45-4cb9-9016-4901b3593ed0.png" style="width:41.00em;height:32.00em;"/></div>
<p class="mce-root"/>
<p>After the Jenkins installation is done, you need to configure the Jenkins server. Visit <kbd>http://&lt;Server-IP-address&gt;:8080</kbd> if the setup has been done on a local machine for testing. You can access the Jenkins server at <a href="http://localhost:8080"><kbd>http://localhost:8080</kbd></a>. You will need to wait for some time if you see a message such as <span class="packt_screen">Please wait while Jenkins is getting ready to work...</span>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/be45e823-f63f-4440-87fc-2dc9a576275b.png"/></div>
<p>To unlock the Jenkins server, you need to provide the default Jenkins password stored at the following location: <kbd>C:\Program Files (x86)\Jenkins\secrets\initialAdminPassword</kbd>. For a Linux machine, the path will be different.</p>
<p>On the next screen, we will be able to choose plugins to install in the Jenkins server. Click on <span class="packt_screen">Select plugins to install</span>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/9e971faf-0096-45aa-9c16-f48852960606.png"/></div>
<p>We will only choose <span class="packt_screen">Ant Plugin</span> and <span class="packt_screen">Git Plugin</span>, as we can install other plugins after the basic setup is done:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/25693d51-ae4d-494d-bb8b-df5b1b0eacc3.png"/></div>
<p>Here is the next page:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b2975f11-a07f-4567-aa1f-7a63b64c8f05.png"/></div>
<p>After the plugin installation has been completed, in <span class="packt_screen">Create First Admin User</span> provide a <span class="packt_screen">Username</span>, <span class="packt_screen">Password</span>, <span class="packt_screen">Full name</span>, and <span class="packt_screen">E-mail address:</span></p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/2308a870-5995-493b-8ca0-7f89d755d0f2.png"/></div>
<p>Click on <span class="packt_screen">Save and Finish</span> to complete the Jenkins setup.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring the Ant Migration Tool with Jenkins</h1>
                </header>
            
            <article>
                
<p>To communicate with Salesforce, we need to install the Ant Migration Tool on the Jenkins server. We have already covered the installation steps for the Ant Migration Tool in <a href="6f12a8fb-da46-4121-ab9f-415af1276871.xhtml">Chapter 4</a>, <em>Introduction to the Force.com Migration Tool</em>. Install the Ant Migration Tool on the Jenkins server and configure the path in Jenkins. Once you install the Ant plugin in Jenkins, you will get the option to <span class="packt_screen">Invoke Ant</span> in the <span class="packt_screen">Add build step</span> <span> dropdown menu</span> for your Jenkins Job, which will run <kbd>build.xml</kbd> and perform the tasks mentioned in the script:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/48410d95-a933-48f4-b3ad-8b2c784b2382.png" style="width:43.08em;height:20.25em;"/></div>
<p>When the developer triggers the Jenkins Job, we will select <span class="packt_screen">Invoke Ant</span> to retrieve the Salesforce metadata. Once the build is successful, we will have the metadata in the directory and trigger the Jenkins job to push the metadata from Jenkins to the GitLab repository. Verify the metadata in the GitLab repository.</p>
<p>Now we will set the global credentials in Jenkins.</p>
<p>Go to <span class="packt_screen">Manage Jenkins</span> and select <span class="packt_screen">Global Tool Configuration</span>. On your machine, the executable file can be different. Go to the <span class="packt_screen">Git</span> section and provide <span class="packt_screen">Path to <span class="packt_screen">Git</span> executable</span> as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/83a91bed-0dce-4300-abb8-ccb1c5beb369.png" style="width:43.08em;height:17.08em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a Jenkins job to retrieve metadata from a sandbox</h1>
                </header>
            
            <article>
                
<p>We have created the Git repository with the metadata from the Salesforce Production organization in <a href="45e26817-986f-4fa4-a9c3-3044e7aad5da.xhtml">Chapter 5</a>, <em>Version Control</em>. We will use the same sample project and GitLab repository, <kbd>Salesforce_demo</kbd>, with the current production code from the Salesforce Sandbox. The instructions are as follows:</p>
<ol>
<li>Create the branch to retrieve code from the sandbox:</li>
</ol>
<pre style="padding-left: 90px"><strong>Branch : sandbox_to_git  </strong></pre>
<ol start="2">
<li>Log in to the Jenkins server and click on <span class="packt_screen">New Item</span> to create a Jenkins job:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/08692ed5-6b53-41bb-8a4b-d831e181d3c9.png" style="width:13.00em;height:16.67em;"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="3">
<li>Give the name <kbd>Retrive_sandbox_to_git</kbd> to the Jenkins job. As we are working on an Ant build project, select Build a <span class="packt_screen">Free-style Project</span>. Click <span class="packt_screen">OK</span>. The Freestyle project type is used to create a Jenkins project with any SCM using any build system:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/684e37f5-2d15-4297-8858-f2dff196501f.png"/></div>
<ol start="4">
<li>Configure the job. After the job has been created, we will go to the job configuration page. In the <span class="packt_screen">General</span> tab, provide the project name and description, as follows:
<ul>
<li><span class="packt_screen">Project Name</span>: <kbd>Retrive_sandbox_to_git</kbd>.</li>
<li><span class="packt_screen">Description</span>: Job to retrieve metadata from sandbox and push to Git.</li>
<li><span class="packt_screen">Source Code Management</span>: Keep it as <span class="packt_screen">None</span>, as we don't need SCM for this job.</li>
<li><span class="packt_screen">Build Triggers</span>: Do not choose any trigger.</li>
<li><span class="packt_screen">Build Environment</span>: Select Add timestamp to console output if available:</li>
</ul>
</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/33bb1266-d791-4f90-b8dc-e0f53930ad43.png"/></div>
<ol start="5">
<li class="packt_nosymbol">Select <span class="packt_screen">Invoke Ant</span> from the <span><span class="packt_screen">Add build step</span> dropdown menu and p</span>rovide the path for <kbd>build.xml</kbd> to retrieve the metadata from the sandbox to the Jenkins workspace:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ebc36f3a-52e3-4387-97f6-7f720d4ab966.png"/></div>
<ol start="6">
<li>Configure the build:
<ol start="1">
<li><span class="packt_screen">Targets</span>: Leave the target empty. Here, you can specify a list of targets you want to run. If we leave it empty, the target specified in the build script will be executed.</li>
<li><span class="packt_screen">Build File</span>: The location of <kbd>build.xml</kbd> is at <kbd>&lt;JENKINS_WORKSPACE&gt;/&lt;ITEM-NAME&gt;</kbd>. You can specify your build file here; by default Ant will use <kbd>build.xml</kbd> in the root directory. The workspace root directory is at: <kbd>&lt;JENKINS_WORKSPACE&gt;/$ITEM_NAME</kbd>. Example: Building in workspace <kbd>&lt;JENKoNS_WORKSPACE&gt;/Retrive_SandBox_to_Git</kbd>.</li>
<li><span class="packt_screen">Java Options</span>: <kbd>&lt;-Xmn1024m&gt;</kbd> provide the Java memory limit, because the job will throw error if its less.</li>
</ol>
</li>
</ol>
<p style="padding-left: 90px">The sample <kbd>build.xml</kbd> is as shown:</p>
<pre style="padding-left: 120px">&lt;project name="Force.com Migration Tool" default="retrieveUnpackaged" basedir="." &gt; 
&lt;taskdef uri="antlib:com.Salesforce" 
       resource="com/Salesforce/antlib.xml" 
       classpath="lib/ant-Salesforce.jar" 
   /&gt; 
   &lt;property file="build.properties"/&gt; 
       &lt;property environment="env"/&gt; 
       &lt;property name="sf.username" value="${env.SF_USERNAME}"/&gt; 
       &lt;property name="sf.password" value="${env.SF_PASSWORD}"/&gt; 
       &lt;property name="sf.token" value="${env.SF_TOKEN}"/&gt; 
       &lt;property name="sf.serverurl" value="${env.SF_SERVERURL}"/&gt; 
             &lt;target name="retrieveUnpackaged"&gt; 
                     &lt;sf:retrieve 
                       username="${sf.username}" 
                       password="${sf.password}${sf.token}" 
                       serverurl="${sf.serverurl}" 
                       retrieveTarget="DevOps/src" 
                       unpackaged="${basedir}/package.xml" 
               /&gt; 
       &lt;/target&gt; 
&lt;/project&gt; </pre>
<p style="padding-left: 90px">This will retrieve an unpackaged set of metadata from your organization. In <kbd>retrieveTarget</kbd>, mention the path where the metadata will be stored:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/3ffa82e6-d041-4187-a1d5-fc33963abfc7.png" style="width:44.17em;height:35.00em;"/></div>
<ol start="7">
<li>In <span class="packt_screen">Post-build Actions</span>, we will execute a shell script to perform a Git push to the <kbd>sandbox_to_git</kbd> branch:
<ul>
<li>Trigger job <kbd>Retrive_SandBox_to_Git2</kbd>. It will push all the code retrieved by the <kbd>Build.xml</kbd> script in <kbd>DevOps/src</kbd>.</li>
<li class="packt_nosymbol">The following are some sample commands to push code in the Git repository:</li>
</ul>
</li>
</ol>
<pre style="padding-left: 120px">    <strong>$git add.</strong>
    <strong>$git commit -m "Retrieve metadata from sandbox"</strong>
    <strong>$git remote add origin &lt;remote-repository-URL&gt;</strong>
    <strong>$git push -u origin sandbox_to_git</strong>
  </pre>
<ol start="8">
<li>Test the job: Make sure the project is <em>enabled</em> in Jenkins. Select it from the list of projects, and click <span class="packt_screen">Build Now</span>.
<ol>
<li>Check the <span class="packt_screen">Console Output</span>. After the build, click <span class="packt_screen">Build Details</span> and you can also refer to the <span class="packt_screen">Console Output</span> and check if there are any errors on the build script:</li>
</ol>
</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/e72e0ebb-d675-4e7e-8c33-555daece8f19.png"/></div>
<ol start="9">
<li>Check the Console Output in the Jenkins Console. If the build is successful, then it will show the following message: <span class="packt_screen">BUILD SUCCESSFUL</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/0df7d616-50c6-447d-a4fe-b40b87c377fb.png" style="width:42.08em;height:8.75em;"/></div>
<ol start="10">
<li>Verify the updated code in the Git Branch <kbd>sandbox_to_git</kbd>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Triggering the same job again</h1>
                </header>
            
            <article>
                
<p>To execute the same Jenkins job again, follow these steps:</p>
<ol>
<li>Log in to Jenkins.</li>
<li>Select the job that you want to run.</li>
<li>Click on <span class="packt_screen">Build Now</span>.</li>
<li>Check the status/console output.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring a Jenkins job to deploy metadata on a sandbox</h1>
                </header>
            
            <article>
                
<p>We have Eclipse with the Force.com IDE and Git installed in it. The developer sandbox is in sync with Eclipse. Developers work with Eclipse and the Force.com IDE. Sandbox will be in sync with the Eclipse workspace. After changes are done, the developer will push changes to the Git branch and mention the deployment component in <kbd>package.xml</kbd>. This Git push will trigger a Jenkins job that will execute the Ant deploy script and deploy changes from the developer sandbox to test the sandbox:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ab0ba0cd-55d5-4b7f-a7c8-945b0bc9c700.png" style="width:39.83em;height:23.00em;"/></div>
<p>The tools used are:</p>
<ul>
<li><strong>Git</strong>: To track Salesforce changes in Git</li>
<li><strong>Force.com Migration Tool</strong>: For Salesforce deployments</li>
<li><strong>Jenkins</strong>: To automate deployments to a pre-UAT environment with Jenkins and Ant scripts</li>
</ul>
<p>The configuration steps are as follows:</p>
<ol>
<li>Create a Jenkins job to deploy code to the sandbox. Log in to the Jenkins server and click on <span class="packt_screen">New Item</span> to create a Jenkins job:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6f0bc8c6-6525-4d6a-82b4-89ffe722e6ac.png"/></div>
<ol start="2">
<li>Configure <span class="packt_screen">Source Code Management</span>. Copy the project URL from your Git project and paste it the to <span class="packt_screen">Repository URL</span>.</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/10ed69f1-eeed-4a9d-9f00-1d523058a067.png"/></div>
<ol start="3">
<li>Add the credentials for Git access in Jenkins Credentials. Add your username and password and select the following credential:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/fb5c3725-a5d0-4880-9c78-1703b9c71cfb.png" style="width:40.42em;height:30.25em;"/></div>
<ol start="4">
<li>Configure the Git credentials and branches you want to build:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/72de775b-ded1-48b9-b5f9-890c96024d35.png"/></div>
<ol start="5">
<li>Select the build and select <span class="packt_screen">Invoke Ant.</span> Configure the build file and the <kbd>build.properties</kbd> file:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/d96095f6-46cd-4864-8ffd-58e159ecfd6a.png"/></div>
<ol start="6">
<li>The components developers want to deploy will be mentioned in <kbd>package.xml</kbd> and deployed in the ant job. The sample <kbd>Build.xml</kbd> for the deploy job is as follows:</li>
</ol>
<pre style="padding-left: 90px">&lt;target name="deployCode"&gt;             
    &lt;!-- Deploy Code From src to SandBox --&gt; 
        &lt;sf:deploy 
            username="${sf.username}" 
            password="${sf.password}${sf.token}" 
            serverurl="${sf.serverurl}" 
            deployroot="src" 
                        runAllTests="false" 
        /&gt; 
&lt;/target&gt; </pre>
<ol start="7">
<li>Once developers push the code to the respective Git branch, the Jenkins job will be triggered and the new code is deployed to the destination sandbox. This sandbox can be a UAT sandbox or production. You can use the same job for different scenarios.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we have learned how to automate backups for Salesforce metadata and push code to the Git repository using Jenkins. Tracking changes in Salesforce is possible with GitLab and Jenkins jobs. We have explained how to configure the Ant Migration Tool with Jenkins and what the flow is for this retrieved code from the sandbox to the Jenkins server so as to push it to the Git branch using the script for backup.</p>
<p>We have learned how to set up our own Jenkins server and configure it to retrieve metadata from our Salesforce sandbox. Also we have configured a Jenkins job for deploying metadata from one sandbox to another sandbox. Regarding the deployment job, we discussed the tools that can be used and explained the flow for deployment to UAT or testing with a diagram.</p>
<p>In the next chapter, we will learn about continuous testing and code coverage in Salesforce. We will discuss the steps to perform tests on Salesforce using Selenium and Qualitia. We will learn about automating<span> the</span> process of continuous testing using Jenkins.</p>


            </article>

            
        </section>
    </body></html>