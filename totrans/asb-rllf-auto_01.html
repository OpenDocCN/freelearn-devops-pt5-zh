<html><head></head><body>
<div><div><h1 class="chapter-number" id="_idParaDest-15"><a id="_idTextAnchor014"/>1</h1>
<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>Ansible Automation – Introduction</h1>
<p>Ansible is open source automation and orchestration software that can be used for automating most of your operations with IT infrastructure components including servers, storage, networks, and application platforms. Ansible is one of the most popular automation tools in the IT world now and has strong community support with more than 5,000 contributors around the world.</p>
<p>In this chapter we are going to cover the following topics:</p>
<ul>
<li>What is Ansible? Where should I use this automation tool?</li>
<li>Deploying Ansible</li>
<li>Configuring your managed nodes</li>
</ul>
<p>As of today, Ansible is only available on Linux/Unix platforms, but that doesn't mean you cannot use Ansible to automate other <strong class="bold">operating systems</strong> (<strong class="bold">OSs</strong>) or devices. It is possible to use Ansible to automate almost all components involved in the IT infrastructure, as there are thousands of supported modules available to support Ansible automation.</p>
<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Technical requirements</h1>
<p>The following are the technical requirements to proceed with this chapter:</p>
<ul>
<li>A basic understanding of the Linux OS and how to handle basic operations in Linux</li>
<li>One or more Linux machines</li>
</ul>
<p>The codes and snippets used in the chapter are tested in <strong class="bold">Red Hat Enterprise Linux 8</strong> (<strong class="bold">RHEL8</strong>). All the Ansible code, Ansible playbooks, commands, and snippets for this chapter can be found in the GitHub repository at <a href="https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-01">https://github.com/PacktPublishing/Ansible-for-Real-life-Automation/tree/main/Chapter-01</a>.</p>
<h1 id="_idParaDest-18"><a id="_idTextAnchor017"/>Hello engineers!</h1>
<p>The primary role of a systems engineer<a id="_idIndexMarker000"/> is building and managing IT infrastructure for hosting applications and their data. In the olden days, the number of applications used was a lot less, hence the infrastructure size. As the applications and components grew, the IT infrastructure also grew, and systems engineers and system administrators started experiencing resource conjunction. In other ways, systems engineers are spending more time on building, maintaining, and supporting the infrastructure rather than spending time on improving the infrastructure designs and optimizing them.</p>
<p>For the support team, 90% of the event tickets are simple fixes including disk space full, user account locked, volumes not mounted, and so on. But the support engineer still needs to manually log in to each and every server and fix the issues one by one.</p>
<p>The task can be fixing a low disk space issue on servers, installing some packages, patching OSs, creating virtual machines, or resetting a user password; engineers are doing the same job repeatedly for multiple systems, and this led to the invention of automated operations. Initially, the solution for automation was custom scripts developed and maintained by individual engineers, but it was never a real solution for the enterprises as there was no collaboration, maintenance, or accountability for such custom automation scripts. If the developer leaves the organization, the script will become an orphan and the next engineer will create their own custom scripts.</p>
<p>With the introduction of DevOps methodologies and practices, developers, systems engineers, operations teams, and other platform teams started working together, the boundaries between them became thinner, and a better accountable ecosystem evolved. Everyone started building and maintaining the applications and the underlying IT infrastructure, which, in turn, made the automation use case list bigger and more complex.</p>
<h1 id="_idParaDest-19"><a id="_idTextAnchor018"/>What is Ansible? Where should I use this tool?</h1>
<p>Ansible is an open source automation tool<a id="_idIndexMarker001"/> that was written and released<a id="_idIndexMarker002"/> by Michael DeHaan on February 20, 2012. In 2013, <strong class="bold">Ansible, Inc.</strong> (originally <strong class="bold">AnsibleWorks, Inc.</strong>) was founded by Michael DeHaan, Timothy Gerla, and Saïd Ziouani, and their intention was to commercially support and sponsor Ansible. In 2015, Ansible was acquired by Red Hat, and Red Hat supports and promotes Ansible as per the expectations of the open source community.</p>
<p>As of today, the Ansible control node<a id="_idIndexMarker003"/> is only available for Linux/Unix based<a id="_idIndexMarker004"/> platforms (most of the general-purpose OSs, such as Red Hat Enterprise Linux, CentOS, Fedora, Debian, or Ubuntu) and you cannot install it on Windows natively (it is possible to use Windows Subsystem for Linux or virtual machines for the same). This does not mean that you cannot use Ansible to automate your Windows operations. It is possible to use the Ansible control node on Linux and manage your Windows machines together, with other devices and platforms such as network devices, firewall devices, cloud platforms, and container platforms. There are more than 3,200 Ansible modules (as of today) available to use and, for Windows alone, there are more than 100 Ansible modules to automate Windows OS-based operations.</p>
<p class="callout-heading">Ansible-Supported Windows OSs</p>
<p class="callout">Ansible can manage<a id="_idIndexMarker005"/> desktop OSs including Windows 7, 8.1, and 10, and server OSs including Windows<a id="_idIndexMarker006"/> Server 2008, 2008 R2, 2012, 2012 R2, 2016, and 2019. Refer to <a href="https://docs.ansible.com/ansible/latest/user_guide/windows_setup.xhtml#host-requirements">https://docs.ansible.com/ansible/latest/user_guide/windows_setup.xhtml#host-requirements</a> for more details.</p>
<p>The community version of Ansible is free to use like other open source software, but there is also a product offering<a id="_idIndexMarker007"/> from Red Hat based on Ansible called Red Hat <strong class="bold">Ansible Automation Platform</strong>, which is available with a paid subscription. Use either the community version of Ansible or the Red Hat-supported version<a id="_idIndexMarker008"/> with a subscription. Ansible<a id="_idIndexMarker009"/> Automation Platform is for enterprise<a id="_idIndexMarker010"/> use with functionalities such as <strong class="bold">role-based access control</strong> (<strong class="bold">RBAC</strong>), <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>), <strong class="bold">Application Programming Interface</strong> (<strong class="bold">API</strong>), redundancy, and scalability. Consider these options when you expand your automation use cases with a bigger team with many engineers working on automation and when you need auditing, tracing, and other integrations. Read more about<a id="_idIndexMarker011"/> Ansible Automation Platform at <a href="https://www.ansible.com/products/automation-platform">https://www.ansible.com/products/automation-platform</a>.</p>
<p class="callout-heading">Red Hat Ansible Automation Platform</p>
<p class="callout">The enterprise automation product<a id="_idIndexMarker012"/> from Red Hat was known as <strong class="bold">Ansible Tower</strong> until the announcement of the Red Hat<a id="_idIndexMarker013"/> Ansible Automation Platform<a id="_idIndexMarker014"/> in September 2019 (<a href="https://www.ansible.com/blog/introducing-red-hat-ansible-automation-platform">https://www.ansible.com/blog/introducing-red-hat-ansible-automation-platform</a>). The components inside Ansible Automation Platform were renamed with more meaningful names, such as automation controller and execution environment. Read more about Ansible Automation Platform at <a href="https://www.redhat.com/en/technologies/management/ansible">https://www.redhat.com/en/technologies/management/ansible</a>.</p>
<p class="callout">Ansible documentation is available at <a href="https://docs.ansible.com">https://docs.ansible.com</a>.</p>
<h2 id="_idParaDest-20"><a id="_idTextAnchor019"/>Prerequisites</h2>
<p>We will write automation<a id="_idIndexMarker015"/> steps in a YAML file called an <strong class="bold">Ansible playbook</strong>. Ansible will parse the playbook<a id="_idIndexMarker016"/> file and execute the tasks on target machines:</p>
<ul>
<li>You should know the basics of Linux; as I mentioned earlier, it is possible to install Ansible on a Linux or Unix machine only at the current time. That does not mean that you should be a Linux subject matter expert, but you need to be able to handle basic operations in Linux, such as file management and file editing.</li>
<li>You need to understand the YAML syntax, which is easy, as YAML is one of the easiest human-readable file formats.</li>
</ul>
<p>Ansible is based on the Python programming language, but you don't need to learn Python or any kind of programming language to develop Ansible automation playbooks.</p>
<p class="callout-heading">What is YAML?</p>
<p class="callout"><strong class="bold">YAML Ain't Markup Language</strong> (<strong class="bold">YAML</strong>) is a human-readable language format<a id="_idIndexMarker017"/> used for most modern tools and software, including Ansible, Kubernetes, and OpenShift. YAML is often used as a file format for application data and configuration, for example.</p>
<h2 id="_idParaDest-21"><a id="_idTextAnchor020"/>Ansible control node requirements</h2>
<p>There are no specific hardware<a id="_idIndexMarker018"/> requirements for the Ansible control node machine. It is possible to<a id="_idIndexMarker019"/> use a machine with 512 MB memory and one <strong class="bold">virtual central processing unit</strong> (<strong class="bold">vCPU</strong>). Follow some standard <strong class="bold">virtual machine</strong> (<strong class="bold">VM</strong>) specifications, such as 4 GB or higher, as you may<a id="_idIndexMarker020"/> need more memory when you have more managed nodes and more tasks to run in parallel. For the disk, you may follow standard VM specifications, as Ansible is a small program and does not require much disk space. Use any Linux/Unix machine with Python 3.8 or newer installed.</p>
<p class="callout-heading">Ansible Control Node Requirements</p>
<p class="callout">Find <a id="_idIndexMarker021"/>the Ansible control node requirements at https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml#control-node-requirements.</p>
<h2 id="_idParaDest-22"><a id="_idTextAnchor021"/>Ansible managed node requirements</h2>
<p>The target nodes (managed nodes) should<a id="_idIndexMarker022"/> be installed with Python 2.6 or later (3.x is recommended) to execute the task. For Windows machines, you need to install PowerShell and .NET.</p>
<p>Ansible is also supported for the following:</p>
<ul>
<li>Network devices</li>
<li>VMware</li>
<li>Public clouds such as AWS, Azure, and GCP</li>
<li>Security devices</li>
</ul>
<p class="callout-heading">Python 2.x EOL</p>
<p class="callout">Install Ansible<a id="_idIndexMarker023"/> on a machine with Python 2.x, but Python 2.x is already <strong class="bold">end-of-life</strong> (<strong class="bold">EOL</strong>) by January 1, 2020, and it is best practice to use the latest Python version. For<a id="_idIndexMarker024"/> more detailsabout Python 2 end of life, visit <a href="https://www.python.org/doc/sunset-python-2/">https://www.python.org/doc/sunset-python-2/</a>.</p>
<h2 id="_idParaDest-23"><a id="_idTextAnchor022"/>Ansible is agentless</h2>
<p>There are two types<a id="_idIndexMarker025"/> of machines involved in Ansible automation. The machine in which you install<a id="_idIndexMarker026"/> the Ansible program is known as the <strong class="bold">Ansible control node</strong>. The control node can be any machine, a dedicated server, or even your workstation, and it will have your Ansible playbook and other configurations. Then, the machines or devices<a id="_idIndexMarker027"/> that you want to automate are known as <strong class="bold">managed hosts</strong>. You will run the Ansible jobs and playbooks from the control node and the jobs will be executed on the target nodes or managed nodes.</p>
<p>The following diagram shows the basic<a id="_idIndexMarker028"/> components of Ansible:</p>
<div><div><img alt="Figure 1.1 – Ansible and components " height="510" src="img/B18383_01_01.jpg" width="806"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Ansible and components</p>
<p>Ansible is agentless and you do not need to install any kind of agents on the managed nodes. Ansible uses default connection methods to communicate with managed nodes, such as <code>ssh</code>, <code>WinRM</code>, <code>http</code>, or other appropriate protocols. During the onboarding, you need to configure the credentials for the managed nodes, such as an SSH credential, with SSH keys, or an SSL certificate for WinRM connection. This is a one-time setup, and it is possible to configure or change<a id="_idIndexMarker029"/> this anytime. It is possible to use the same or different credentials for different managed nodes, and configure this for individual nodes or a group of managed nodes. You will learn about managed nodes and inventory in the next sections of this chapter.</p>
<h2 id="_idParaDest-24"><a id="_idTextAnchor023"/>Ansible architecture</h2>
<p>The following diagram shows the Ansible internals<a id="_idIndexMarker030"/> and its components' structure:</p>
<div><div><img alt="Figure 1.2 – Ansible and components " height="431" src="img/B18383_01_02.jpg" width="1008"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Ansible and components</p>
<h2 id="_idParaDest-25"><a id="_idTextAnchor024"/>Ansible inventory</h2>
<p>The Ansible inventory<a id="_idIndexMarker031"/> is a file or script that will provide the details about the managed nodes, including the hostname, connection methods, credential to use, and many other details. It is possible to pass the inventory to Ansible using static inventory<a id="_idIndexMarker032"/> files, dynamic inventory scripts, or using the <strong class="bold">configuration management database</strong> (<strong class="bold">CMDB</strong>). The CMDB is the same CMDB that can provide the managed nodes information. It is best practice to integrate CMDB with Ansible in an environment to avoid frequent updates on the static inventory files, but this is not a mandatory component.</p>
<p>It is possible to add any number of managed nodes inside the inventory file, as follows:</p>
<div><div><img alt="Figure 1.3 – Ansible inventory with managed nodes " height="512" src="img/B18383_01_03.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – Ansible inventory with managed nodes</p>
<p>It is best practice to separate<a id="_idIndexMarker033"/> the managed nodes information in multiple inventory files based on the criticality, server types, and environment. You will learn more about inventory best practices in <a href="B18383_16.xhtml#_idTextAnchor294"><em class="italic">Chapter 16</em></a>, <em class="italic">Storing Remote Host Information – Inventory Best Practices</em>.</p>
<p>Dynamic inventory<a id="_idIndexMarker034"/> plugins will collect the details of managed nodes from your virtualization platforms such as VMware, OpenStack, AWS, Azure, and GCP, or from other container platforms such as Kubernetes. There are more than 40 dynamic inventory plugins available to use in the Ansible GitHub repository. Use them if needed or create your own dynamic inventory scripts if those are not suitable for your requirements.</p>
<p class="callout-heading">Ansible Dynamic Inventory</p>
<p class="callout">For more details about<a id="_idIndexMarker035"/> the Ansible dynamic inventory, look it up at <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml">https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml</a> and <a href="https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory">https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory</a>.</p>
<h2 id="_idParaDest-26"><a id="_idTextAnchor025"/>Ansible plugins</h2>
<p>Ansible plugins are small pieces<a id="_idIndexMarker036"/> of code that help to enable a flexible and expandable architecture. You have Ansible executable, and add plugins as needed for other features<a id="_idIndexMarker037"/> and capabilities like<a id="_idIndexMarker038"/> any other software. There<a id="_idIndexMarker039"/> are different types of plugins in Ansible such as <code>ssh</code>, and it is possible to use connection plugins called <code>docker</code> or <code>buildah</code> for connecting to containers. If you need to, install and use these plugins.</p>
<p class="callout-heading">Ansible Plugins</p>
<p class="callout">Read<a id="_idIndexMarker041"/> more about Ansible plugins at <a href="https://docs.ansible.com/ansible/latest/plugins/plugins.xhtml">https://docs.ansible.com/ansible/latest/plugins/plugins.xhtml</a>.</p>
<h2 id="_idParaDest-27"><a id="_idTextAnchor026"/>Ansible modules</h2>
<p>An Ansible module<a id="_idIndexMarker042"/> is a piece of reusable and standalone script that can be used to achieve some specific tasks. Modules provide a defined interface with options to accept arguments and return information to Ansible in JSON format. When you execute a task using a module, the module script will be executed on the target machine using Python or using PowerShell for Windows machines.</p>
<p>For example, the following Ansible content is using a <code>ping</code> module to verify the connectivity to the target machine and another task with the <code>yum</code> module for installing <code>httpd package</code> on a managed node using the <code>yum</code> package manager: </p>
<div><div><img alt="Figure 1.4 – Ansible ping module and yum module " height="248" src="img/B18383_01_04.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.4 – Ansible ping module and yum module</p>
<p>I said earlier that we can automate<a id="_idIndexMarker043"/> network devices and firewall devices using Ansible, but, we all know that we cannot install Python or PowerShell on those devices. Unlike most of the Ansible modules, network modules do not run on network devices. Instead, these modules will be executed from the Ansible control node itself and run the appropriate commands on target network devices to achieve the task. From the user's point of view, there is no difference in the execution of network modules as you still use them like any other modules. It is possible to manage the network devices like other Linux machines and Windows machines but with different connection methods, such as <code>network_cli</code>, <code>netconf</code>, and <code>httpapi</code>.</p>
<p class="callout-heading">Read: How Network Automation Is Different</p>
<p class="callout">Go<a id="_idIndexMarker044"/> to <a href="https://docs.ansible.com/ansible/latest/network/getting_started/network_differences.xhtml">https://docs.ansible.com/ansible/latest/network/getting_started/network_differences.xhtml</a> to learn more about network device automation.</p>
<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/>Ansible content collections</h2>
<p>Before version 2.10, Ansible was a big package<a id="_idIndexMarker045"/> with all modules and libraries inside, but the community grew very fast and thousands of new modules were contributed to Ansible. Whenever there is a new module or new version of a module available from the community or vendors, then users need to wait for the next release of Ansible to get the updated module. To resolve this dependency, a new way of distribution has started in which Ansible modules are separated from the Ansible base and distributed as <strong class="bold">Ansible content collections</strong>, or simply <strong class="bold">Ansible collections</strong>. You have the choice of installing<a id="_idIndexMarker046"/> Ansible alone or installing the Ansible package including Ansible collections. If you need to manage some different set of nodes or systems (for example, managing the VMware private cloud or automating Fortigate firewall devices), then install the required Ansible collection and use it. This modularity allows you to install only the required modules and plugins rather than all available modules.</p>
<p>The following diagram shows the transition of the Ansible collection from old Ansible:</p>
<div><div><img alt="Figure 1.5 – Ansible to Ansible core and Ansible collection transformation " height="414" src="img/B18383_01_05.jpg" width="1212"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.5 – Ansible to Ansible core and Ansible collection transformation</p>
<p>Also, note some of the changes in the Ansible<a id="_idIndexMarker047"/> base and Ansible collection restructuring:</p>
<ul>
<li>Before version 2.9.x: The package included <code>ansible</code> and all the Ansible modules and other plugins.</li>
<li>From version 2.10++: Ansible was renamed to <code>ansible-base</code> and modules were moved to Ansible collections (vendors and communities).</li>
<li>From version 2.11++: <code>ansible-base</code> was renamed to <code>ansible-core</code>.</li>
<li>When you install Ansible 3.x or Ansible 4.x, then you are installing the Ansible community package, which includes <code>ansible-core</code> and all the Ansible collections (vendor and community).</li>
</ul>
<p class="callout-heading">Restructuring the Ansible Project </p>
<p class="callout">Read the blog post <a href="http://ansible.com/blog/thoughts-on-restructuring-the-ansible-project">ansible.com/blog/thoughts-on-restructuring-the-ansible-project</a> and <a href="http://ansible.com/blog/the-future-of-ansible-content-delivery">ansible.com/blog/the-future-of-ansible-content-delivery</a> to know more<a id="_idIndexMarker048"/> about Ansible collection transition. </p>
<h2 id="_idParaDest-29"><a id="_idTextAnchor028"/>Ansible playbook</h2>
<p>The Ansible playbook<a id="_idIndexMarker049"/> is a simple file written in YAML format with the instruction list of automation tasks. The following diagram explains the components, syntax, and structure of an Ansible playbook:</p>
<div><div><img alt="Figure 1.6 – Ansible playbook basic components " height="394" src="img/B18383_01_06.jpg" width="602"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.6 – Ansible playbook basic components</p>
<p>Each task in the <strong class="bold">play</strong> runs a module<a id="_idIndexMarker050"/> to do some specific job on the target node. You can have multiple tasks in a play and multiple plays inside a single playbook, as shown in the diagram. The plays, tasks, and module arguments are identified by the indentation in YAML format. In this example, we have a playbook with two plays.</p>
<p>In the first play, <code>Enable Intranet Services</code>, we are running the tasks against <code>node1</code> – see the <code>hosts: node1</code> line.</p>
<p>Under the tasks, see two tasks:</p>
<ul>
<li>The first task is using the <code>yum</code> module and installing the <code>httpd</code> package.</li>
<li>The second task is using the <code>service</code> module to start the <code>httpd</code> service.</li>
</ul>
<p>Then, we have a second play, <code>Test intranet web server</code>, in the playbook, in which you have only one task:</p>
<ul>
<li>Using the <code>uri</code> module to test the intranet web server</li>
</ul>
<p>Ansible will parse this playbook<a id="_idIndexMarker051"/> and execute the tasks one by one on the target nodes.</p>
<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>Ansible use cases</h2>
<p>It is possible to build, manage, or maintain almost<a id="_idIndexMarker052"/> all components in IT infrastructure using Ansible:</p>
<ul>
<li>Servers and storages</li>
<li>Network devices, firewalls, <strong class="bold">software-defined networks</strong> (<strong class="bold">SDNs</strong>), and load balancers</li>
<li>Application components</li>
<li>Containers and container platforms</li>
<li>Database applications</li>
<li>Public cloud and private cloud</li>
</ul>
<p>You need to find the use cases from your day-to-day work and find the highest number of tasks you are repeating every day and consider those tasks as automation candidates. The following is a sample list of such use cases:</p>
<ul>
<li>OS patching</li>
<li>Application and package deployment</li>
<li>Orchestration of application</li>
<li>Configuration management</li>
<li>Infrastructure provisioning</li>
<li>Continuous delivery</li>
<li>Security and compliance auditing and remediation</li>
<li>Database provisioning<a id="_idIndexMarker053"/> and management</li>
</ul>
<p>In the following section, we will learn how to install and configure Ansible.</p>
<h1 id="_idParaDest-31"><a id="_idTextAnchor030"/>Installing Ansible</h1>
<p>There are multiple ways to install Ansible<a id="_idIndexMarker054"/> on your system, such as using the default package manager (<code>yum</code>, <code>apt</code>, <code>dnf</code>), using Python’s <code>pip</code>, or installing the source code itself. Depending on your environment and restrictions, follow any of the methods<a id="_idIndexMarker055"/> provided in the official documentation (<a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml">https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml</a>). If you are using the OS package manager, such as <code>dnf</code>, <code>yum</code>, or <code>apt</code>, then you need <code>sudo</code> privileges (or <code>root</code> access) to install Ansible.</p>
<p>Please note, you do not require <code>root</code> or <code>sudo</code> access on the Ansible control node for using Ansible. In the following snippet, <code>sudo</code> access is used for installing and updating packages.</p>
<h2 id="_idParaDest-32"><a id="_idTextAnchor031"/>Verify dependencies</h2>
<p>As you learned that Ansible<a id="_idIndexMarker056"/> needs Python to work, you need to check the Python installation first:</p>
<div><div><img alt="Figure 1.7 – Checking installed Python packages and version " height="431" src="img/B18383_01_07.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Figure">Figure 1.7 – Checking installed Python packages and version</p>
<p>If you have a supported<a id="_idIndexMarker057"/> Python version installed, then proceed with the Ansible installation as explained in the next section.</p>
<h2 id="_idParaDest-33"><a id="_idTextAnchor032"/>Installing Ansible using the package manager</h2>
<p>Depending on the OS, you need to add<a id="_idIndexMarker058"/> and enable the appropriate<a id="_idIndexMarker059"/> repositories before installing<a id="_idIndexMarker060"/> Ansible. For example, if you are using <strong class="bold">Red Hat Enterprise Linux</strong> (<strong class="bold">RHEL</strong>), then you need to ensure the Red Hat subscriptions are in place and repositories are enabled to install Ansible:</p>
<div><div><img alt="Figure 1.8 – Installing Ansible package " height="219" src="img/B18383_01_08.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.8 – Installing Ansible package</p>
<p>Verify an installed Ansible version with the following command:</p>
<div><div><img alt="Figure 1.9 – Verifying Ansible installation " height="272" src="img/B18383_01_09.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.9 – Verifying Ansible installation</p>
<p>From this output, see the version of Ansible (<em class="italic">2.9.27</em>), the default configuration file used(config file = <code>/etc/ansible/ansible.cfg</code>), the module search path, the Python version in use, and other details.</p>
<p>The preceding Ansible version<a id="_idIndexMarker061"/> is coming from the default repository<a id="_idIndexMarker062"/> that you have configured on the OS. If you want to install the latest or different version of Ansible, then you need to follow different methods.</p>
<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/>Installing Ansible using Python pip </h2>
<p>You need<a id="_idIndexMarker063"/> to install <code>pip</code> if it is not already<a id="_idIndexMarker064"/> available on the system and then install Ansible using Python pip as follows:</p>
<div><div><img alt="Figure 1.10 – Installing Ansible using Python pip " height="327" src="img/B18383_01_10.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.10 – Installing Ansible using Python pip</p>
<p>Please note, when you execute <code>pip install ansible</code>, you are installing the Ansible package, which contains <code>ansible-core</code> and Ansible collections. I have already explained Ansible collections earlier in this chapter.</p>
<p class="callout-heading">Pip-Based Ansible Installation and Support</p>
<p class="callout">It is best practice<a id="_idIndexMarker065"/> to follow the installation based on the OS package manager to get the appropriate support and updates automatically. Also, pip-based installations are hard to maintain and upgrade when there are newer versions of software available.</p>
<p>If you want to install a specific version of <code>ansible</code>, <code>ansible-base</code>, or <code>ansible-core</code>, then use the version information as follows:</p>
<div><div><img alt="Figure 1.11 – Installing specific version of Ansible using pip  " height="378" src="img/B18383_01_11.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.11 – Installing specific version of Ansible using pip </p>
<p>Let's check<a id="_idIndexMarker066"/> the Ansible version<a id="_idIndexMarker067"/> now:</p>
<div><div><img alt="Figure 1.12 – Check Ansible version " height="458" src="img/B18383_01_12.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.12 – Check Ansible version</p>
<p>See the <code>DEPRECATION WARNING</code> message and<a id="_idIndexMarker068"/> ignore that in a development<a id="_idIndexMarker069"/> environment. But in the production environment, you need to make sure you are using the supported Python version for Ansible.</p>
<p class="callout-heading">Ansible Installation</p>
<p class="callout">Check the Ansible documentation<a id="_idIndexMarker070"/> for instructions for different OSs and methods at <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml">https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml</a>.</p>
<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/>Deploying Ansible</h2>
<p>Before you start with automation jobs, you need to configure<a id="_idIndexMarker071"/> Ansible for your environment using the <code>ansible.cfg</code> file. Ansible will look for a configuration file in four places in order, as listed in the following:</p>
<ul>
<li><code>$ANSIBLE_CONFIG</code>: Configuration file path in an environment variable</li>
<li><code>./ansible.cfg</code>: Configuration file in the current directory</li>
<li><code>~/.ansible.cfg</code>: Configuration file in the home directory</li>
<li><code>/etc/ansible/ansible.cfg</code>: Default configuration file</li>
</ul>
<p>It is a best practice to keep the project-specific <code>ansible.cfg</code> file in the project directory:</p>
<div><div><img alt="Figure 1.13 – Creating the ansible.cfg file  " height="168" src="img/B18383_01_13.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.13 – Creating the ansible.cfg file </p>
<p>Add some basic configurations<a id="_idIndexMarker072"/> inside the <code>ansible.cfg</code> file:</p>
<div><div><img alt="Figure 1.14 – Content of the ansible.cfg file  " height="194" src="img/B18383_01_14.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.14 – Content of the ansible.cfg file </p>
<p>It is not a best practice to keep <code>remote_user = devops</code> in <code>ansible.cfg</code>; instead, configure it inside the inventory for different hosts and host groups. You will learn about this later in this chapter, in the <em class="italic">Creating an Ansible inventory </em>section.</p>
<p>Now, check the Ansible version again to see the difference and see that Ansible is taking <code>/home/ansible/ansible-demo/ansible.cfg</code> as the configuration:</p>
<div><div><img alt="Figure 1.15 – Checking which ansible.cfg is taken by Ansible  " height="219" src="img/B18383_01_15.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.15 – Checking which ansible.cfg is taken by Ansible </p>
<p>You have many other parameters to configure in <code>ansible.cfg</code> but not all of them are mandatory as if you have not specified parameters in your custom <code>ansible.cfg</code> file, then Ansible will load the default configurations as needed.</p>
<p>See another sample <code>ansible.cfg</code> file, which contains some of the important parameters, deciding the privilege escalation in Ansible. These parameters decide the <code>sudo</code> or <code>su</code> operation on the target nodes:</p>
<div><div><img alt="Figure 1.16 – Another ansible.cfg sample with privilege escalation parameters " height="378" src="img/B18383_01_16.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.16 – Another ansible.cfg sample with privilege escalation parameters</p>
<p>In the preceding<a id="_idIndexMarker073"/> example, the following happens:</p>
<ul>
<li>Ansible will log in to the remote node as a <code>devops</code> user and without asking for a password (<code>ask_pass = false</code>).</li>
<li>Ansible will automatically escalate privilege (<code>become = true</code>) to <code>root</code> (<code>become_user = root</code>) by using the <code>sudo</code> method (<code>become_method = sudo</code>) and it will also ask for a <code>sudo</code> password for the user. Turn this off with the <code>become_ask_pass = false</code> setting.</li>
</ul>
<p>Configure different credentials for different nodes in the Ansible inventory. You will learn about that in a later section of this chapter.</p>
<p>Also note, in the preceding example I have not created any inventory files yet. I just mentioned the inventory filename there as <code>./hosts</code>.</p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/>Creating an Ansible inventory</h2>
<p>Use any name<a id="_idIndexMarker074"/> for your inventory file, such as <code>hosts</code>, <code>inventory</code>, <code>myhosts</code>, or <code>production-servers</code>. Do not confuse this hosts file with the <code>/etc/hosts</code> file. When you have more and more managed nodes in inventory files, split the inventory into groups or into separate inventory files. For example, put production servers and devices in a file called <code>production-hosts</code>, and staging nodes into the <code>staging-hosts</code> file; there are no restrictions on this. Also note, if you are installing Ansible using the <code>yum</code> or <code>apt</code> utilities, then there will be a default inventory file called <code>/etc/ansible/hosts</code> with sample inventory content. Refer to that file to start with, but it is best practice to create your project-specific inventory file inside your project directory itself. It is possible to create inventory files in the <code>ini</code> or <code>yaml</code> formats as follows:</p>
<div><div><img alt="Figure 1.17 – Creating inventory file inside project directory  " height="219" src="img/B18383_01_17.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.17 – Creating inventory file inside project directory </p>
<p>Add content inside the file as follows and save the file:</p>
<div><div><img alt="Figure 1.18 – Sample inventory file  " height="219" src="img/B18383_01_18.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.18 – Sample inventory file </p>
<p>You do not need to add <code>localhost</code> as the <code>localhost</code> entry is implicit in Ansible. That means we can still call the <code>localhost</code> node and Ansible will create an implicit entry. In the preceding demonstration, I have added this to show an entry as a sample. Since <code>localhost</code> is the local machine, you will not be using an SSH connection and it is possible tell Ansible the connection type for localhost as <code>local</code>:</p>
<pre class="source-code">
localhost ansible_connection=local</pre>
<p>It is not easy to remember the nodes with IP addresses or nodes with long hostnames. In Ansible, use any name for your hosts, and mention the actual name or IP address using the <code>ansible_host</code> parameter.</p>
<p>Update your inventory with the correct entry name now. Please note, this is optional, but it is a best practice to use human-readable<a id="_idIndexMarker075"/> names rather than IP addresses and long <strong class="bold">Fully Qualified Domain Names</strong> (<strong class="bold">FQDNs</strong>):</p>
<div><div><img alt="Figure 1.19 – Ansible inventory with human-readable names and ansible_host " height="248" src="img/B18383_01_19.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.19 – Ansible inventory with human-readable names and ansible_host</p>
<p>The default <code>ansible_connection</code> is <code>ssh</code> and you do not need to mention<a id="_idIndexMarker076"/> that in the inventory. If you are using any other connection types, then you need to mention them, such as <code>local</code>, <code>winrm</code>, or <code>paramiko</code>.</p>
<p>Add any number of nodes here with multiple host groups (as the <code>dev</code> host group in the preceding example).</p>
<p>Now, test your inventory to make sure Ansible is able to read and understand your inventory and hosts. Please note that you are not connecting to the hosts from Ansible using this command:</p>
<div><div><img alt="Figure 1.20 – List inventory hosts  " height="194" src="img/B18383_01_20.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.20 – List inventory hosts </p>
<p>Create another inventory file with some dummy managed nodes:</p>
<div><div><img alt="Figure 1.21 – Another Ansible inventory with more hosts and groups  " height="484" src="img/B18383_01_21.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.21 – Another Ansible inventory with more hosts and groups </p>
<p>In the preceding<a id="_idIndexMarker077"/> inventory, see the following:</p>
<ul>
<li>You have four host groups: <code>myself</code>, <code>intranet</code>, <code>database</code>, and <code>everyone</code>.</li>
<li><code>everyone</code> is the parent of the <code>myself</code>, <code>intranet</code>, and <code>database</code> host groups.</li>
</ul>
<p>You have two inventory files here now:</p>
<div><div><img alt="Figure 1.22 – Multiple inventory files in project directory  " height="219" src="img/B18383_01_22.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.22 – Multiple inventory files in project directory </p>
<p>To use a different inventory file, you do not need to change the content of <code>ansible.cfg</code>; instead, use the <code>-i</code> switch to specify the inventory file dynamically. Ansible will take the mentioned inventory files instead of the one configured in the <code>ansible.cfg</code> file as follows:</p>
<div><div><img alt="Figure 1.23 – List inventory hosts with different a inventory file " height="248" src="img/B18383_01_23.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.23 – List inventory hosts with different a inventory file</p>
<p>Use the <code>--help</code> options to see<a id="_idIndexMarker078"/> all the available switches with the Ansible command:</p>
<div><div><img alt="Figure 1.24 – List inventory hosts with different a inventory file " height="564" src="img/B18383_01_24.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.24 – List inventory hosts with different a inventory file</p>
<p>It is also possible to use patterns to filter the managed hosts with supported patterns. For example, let us display only managed nodes with <code>*techbeatly.com</code>:</p>
<div><div><img alt="Figure 1.25 – Host selection using patterns " height="353" src="img/B18383_01_25.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.25 – Host selection using patterns</p>
<p class="callout-heading">Ansible host patterns</p>
<p class="callout">Look up more<a id="_idIndexMarker079"/> information about patterns, targeting hosts, and groups at <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_patterns.xhtml">https://docs.ansible.com/ansible/latest/user_guide/intro_patterns.xhtml</a>.</p>
<p class="callout">Look up more<a id="_idIndexMarker080"/> information about the Ansible dynamic inventory at <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml">https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml</a> and <a href="https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory">https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory</a>.</p>
<p>In the next section, we will learn how to configure managed nodes and connections.</p>
<h1 id="_idParaDest-37"><a id="_idTextAnchor036"/>Configuring your managed nodes</h1>
<p>Use any supported authentication<a id="_idIndexMarker081"/> mechanisms to connect from the Ansible control node to managed node, such as SSH key-based authentication, username and password-based authentication, and SSL certificate authentication, for example.</p>
<h2 id="_idParaDest-38"><a id="_idTextAnchor037"/>Setting up SSH key-based authentication</h2>
<p>It is possible to automate most of the following<a id="_idIndexMarker082"/> steps using Ansible ad hoc <a id="_idIndexMarker083"/>commands, but we will be using the manual approach to understand what backend configurations are needed. </p>
<p>The steps to create a user (for example devops) and enable SSH key based access on node-1 are as follows:</p>
<ol>
<li>Create a dedicated user on the target node (e.g.: node01) as follows. (This is not mandatory, and it is possible to use any existing user accounts and configure that in Ansible.):</li>
</ol>
<div><div><img alt="Figure 1.26 – Create new user and set password  " height="327" src="img/B18383_01_26.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.26 – Create new user and set password </p>
<p>If you do not have <code>ansible_host</code> option, or add entries in <code>/etc/hosts</code> as local DNS resolution.</p>
<ol>
<li value="2">Enable the <code>sudo</code> access for the new user because, for any kind of privileged operation on the target node, you will be required to have this access:</li>
</ol>
<div><div><img alt="Figure 1.27 – Enabled privileged access for the new user  " height="114" src="img/B18383_01_27.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.27 – Enabled privileged access for the new user </p>
<ol>
<li value="3">Create an <code>SSH</code> key pair<a id="_idIndexMarker084"/> on the <strong class="bold">Ansible control</strong><strong class="bold"><a id="_idIndexMarker085"/></strong><strong class="bold"> node</strong>. It is possible to create any supported type and size. Please note, if you have any existing key with the same name, please remember to use a different name or backup the original SSH key pairs:</li>
</ol>
<div><div><img alt="Figure 1.28 – Generating SSH key pair on Ansible control node  " height="353" src="img/B18383_01_28.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.28 – Generating SSH key pair on Ansible control node </p>
<ol>
<li value="4">Verify the SSH key permissions:</li>
</ol>
<div><div><img alt="Figure 1.29 – Verify SSH key permission  " height="248" src="img/B18383_01_29.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.29 – Verify SSH key permission </p>
<ol>
<li value="5">Copy the SSH public key from<a id="_idIndexMarker086"/> the Ansible control node to managed<a id="_idIndexMarker087"/> nodes under the <code>devops</code> user using the <code>ssh-copy-id</code> command:</li>
</ol>
<p class="IMG---Figure"/>
<div><div><img alt="Figure 1.30 – Copy SSH public key to managed node  " height="484" src="img/B18383_01_30.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.30 – Copy SSH public key to managed node </p>
<p>If you have issues with password authentication or copying, then manually copy the public key content from <code>/home/ansible/.ssh/id_rsa.pub</code> to the <code>/home/devops/.ssh./authorized_keys</code> file on the managed node.</p>
<ol>
<li value="6">Verify the passwordless SSH access<a id="_idIndexMarker088"/> from the Ansible control node<a id="_idIndexMarker089"/> to the managed node:</li>
</ol>
<div><div><img alt="Figure 1.31 – Login to managed node without password " height="299" src="img/B18383_01_31.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.31 – Login to managed node without password</p>
<p class="callout-heading">How to Set Up SSH Key-Based Authentication</p>
<p class="callout">Check out the steps<a id="_idIndexMarker090"/> on how to set up SSH key-based authentication at <a href="https://www.techbeatly.com/2018/06/how-to-setup-ssh-key-based-authentication.xhtml">https://www.techbeatly.com/2018/06/how-to-setup-ssh-key-based-authentication.xhtml</a>.</p>
<p>In the next section, we will explore the option to use multiple credential for different managed nodes.</p>
<h2 id="_idParaDest-39"><a id="_idTextAnchor038"/>Multiple users and credentials</h2>
<p>If you have different credentials<a id="_idIndexMarker091"/> for different managed nodes, then configure the remote username, SSH key to be used, and more in your inventory file. Let me show a sample for our <code>node01</code> managed node in our inventory:</p>
<div><div><img alt="Figure 1.32 – Configuring SSH key information for managed nodes  " height="378" src="img/B18383_01_32.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.32 – Configuring SSH key information for managed nodes </p>
<p>In the latter example, we have<a id="_idIndexMarker092"/> used a variable section for the <code>dev</code> host group and mentioned the SSH key and remote user details.</p>
<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/>Ansible ad hoc commands</h2>
<p>The <code>ansible</code> command<a id="_idIndexMarker093"/> can be used to execute single jobs on managed nodes<a id="_idIndexMarker094"/> without a playbook; this is called an <code>ping</code>) to the managed nodes, creating a user account, copying some files, or restarting a service, and execute these tasks without writing an Ansible playbook.</p>
<p>For example, it is possible to use the <code>ping</code> module to test the connection from Ansible to the managed node, <code>node01</code>, using this user and SSH key pair:</p>
<div><div><img alt="Figure 1.33 – Ansible ad hoc command using ping module  " height="484" src="img/B18383_01_33.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.33 – Ansible ad hoc command using ping module </p>
<p>In the preceding<a id="_idIndexMarker095"/> snippet, as you have <code>localhost</code> also in the inventory (by implicit), the task will be executed<a id="_idIndexMarker096"/> on both localhost and node01 nodes when you mention <code>all</code>. The Ansible <code>ping</code> module is not just a regular network ping (ICMP); instead, it will log in to the managed node and return the result, <code>pong</code>.</p>
<p>Execute another Ansible ad hoc command using the <code>shell</code> module to check what remote user Ansible is using for connection:</p>
<div><div><img alt="Figure 1.34 – Ansible ad hoc command using shell module  " height="219" src="img/B18383_01_34.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.34 – Ansible ad hoc command using shell module </p>
<p>From the preceding output, see that <code>localhost</code> is executed with the default <code>ansible</code> user and the <code>dev</code> node with the <code>devops</code> user.</p>
<p>Now, execute multiple commands using the <code>shell</code> module:</p>
<div><div><img alt="Figure 1.35 – Multiple commands in shell module  " height="458" src="img/B18383_01_35.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.35 – Multiple commands in shell module </p>
<p>Please note that the preceding <a id="_idIndexMarker097"/>example was used to demonstrate the <code>shell</code> module, and similar<a id="_idIndexMarker098"/> details can be collected using <code>ansible_facts</code> without such tasks. </p>
<div><div><img alt="Figure 1.36 – Ansible ad hoc command using setup module " height="114" src="img/B18383_01_36.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.36 – Ansible ad hoc command using setup module</p>
<p>You will learn more about <code>ansible_facts</code> in <a href="B18383_03.xhtml#_idTextAnchor052"><em class="italic">Chapter 3</em></a>, <em class="italic">Automating Your Daily Jobs</em>.</p>
<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/>Installing a package using Ansible</h2>
<p>You need to ensure<a id="_idIndexMarker099"/> that you have package<a id="_idIndexMarker100"/> repositories (<code>yum</code> or <code>apt</code>) configured and enabled<a id="_idIndexMarker101"/> on the target machine.</p>
<p>Install the <code>vim</code> package on <code>node01</code>:</p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<div><div><img alt="Figure 1.37 – Ansible ad hoc command using dnf module " height="327" src="img/B18383_01_37.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.37 – Ansible ad hoc command using dnf module</p>
<p>From the preceding output, see<a id="_idIndexMarker102"/> that you are using the <code>devops</code> user for connecting<a id="_idIndexMarker103"/> to managed nodes, which<a id="_idIndexMarker104"/> is a normal user. You do not need to add the <code>become</code> details in <code>ansible.cfg</code>; instead, pass this <code>become</code> switch while executing the <code>ansible</code> command, which is <code>-b</code>. (For Ansible playbooks, you can enable or disable the privilege escalation at the play level or tasks level):</p>
<div><div><img alt="Figure 1.38 – Installing package using dnf module and privileged mode  " height="458" src="img/B18383_01_38.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.38 – Installing package using dnf module and privileged mode </p>
<p>The package installation is successful as per the output.</p>
<p>The preceding ad hoc execution can be written in a playbook as follows:</p>
<div><div><img alt="Figure 1.39 – Package installation using an Ansible playbook " height="353" src="img/B18383_01_39.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.39 – Package installation using an Ansible playbook</p>
<p>You will learn<a id="_idIndexMarker105"/> more about writing<a id="_idIndexMarker106"/> playbooks<a id="_idIndexMarker107"/> in <a href="B18383_02.xhtml#_idTextAnchor043"><em class="italic">Chapter 2</em></a>, <em class="italic">Starting with Simple Automation</em>.</p>
<p>Now, remove the same package using an Ansible ad hoc command; instead of <code>state=latest</code>, use <code>state=absent</code>:</p>
<div><div><img alt="Figure 1.40 – Removing package using Ansible ad hoc command  " height="405" src="img/B18383_01_40.jpg" width="1191"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.40 – Removing package using Ansible ad hoc command </p>
<p>We have now<a id="_idIndexMarker108"/> successfully installed <a id="_idIndexMarker109"/>and uninstalled a package<a id="_idIndexMarker110"/> using Ansible.</p>
<h1 id="_idParaDest-42"><a id="_idTextAnchor041"/>Summary</h1>
<p>In this chapter, you have learned about the core concepts of Ansible, how Ansible works, and the key terminology, including Ansible inventory, playbooks, tasks, Ansible control node, managed nodes, and modules. You have also learned about basic Ansible installation, configuration, and deployment, and the importance of managed node configuration, SSH key credentials, and passwordless SSH.</p>
<p>In the next chapter, you will learn how to start with simple automation playbooks and execution. Then, you will learn how to find suitable Ansible modules for playbook development and remote node connection methods.</p>
<h1 id="_idParaDest-43"><a id="_idTextAnchor042"/>Further reading</h1>
<ul>
<li><em class="italic">Ansible documentation</em>: https://docs.ansible.com/ansible/latest/index.xhtml</li>
<li><em class="italic">Ansible control node requirements</em>: https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml#control-node-requirements</li>
<li><em class="italic">Ansible dynamic inventory</em>: https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.xhtml and https://github.com/ansible/ansible/tree/stable-2.9/contrib/inventory</li>
<li><em class="italic">Ansible Automation Platform</em>: https://www.ansible.com/blog/introducing-red-hat-ansible-automation-platform</li>
<li><em class="italic">Installing Ansible</em>: https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.xhtml</li>
<li><em class="italic">How network automation is different</em>: https://docs.ansible.com/ansible/latest/network/getting_started/network_differences.xhtml</li>
</ul>
</div>
</div></body></html>