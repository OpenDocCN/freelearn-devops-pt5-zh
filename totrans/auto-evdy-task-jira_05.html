<html><head></head><body>
		<div><h1 id="_idParaDest-79"><em class="italic"><a id="_idTextAnchor065"/>Chapter 3</em>: Enhancing Rules with Smart Values</h1>
			<p>The visual rule editor, which we explored in <a href="B16551_01_Final_ASB_ePub.xhtml#_idTextAnchor017"><em class="italic">Chapter 1</em></a>, <em class="italic">Key Concepts of Automation</em>, makes the creation of complex automation rules really easy and requires no knowledge of the Jira API or any specialist scripting knowledge in order to get started.</p>
			<p>While this approach will work for a large number of use cases, there will always be cases where you will need direct access to issue data and the ability to perform more complex functions against this data. This is where smart values come to the rescue.</p>
			<p>This chapter will introduce you to smart values. You will learn how to find smart values, how smart functions work, and how you can introduce your own smart values into automation rules. You will also get an overview of how to manipulate dates, lists of data, text values, and how to perform numeric calculations using math expressions.</p>
			<p>In this chapter, we'll cover the following topics:</p>
			<ul>
				<li>Understanding smart values</li>
				<li>Using smart value date functions</li>
				<li>Using smart value text functions</li>
				<li>Using smart value list functions</li>
				<li>Using smart value math expressions and functions</li>
			</ul>
			<p>By the end of this chapter, you will have learned how you can use smart values and functions to manipulate dates, text strings, and lists, as well as how to use math expressions and functions to perform calculations involving numerical values.</p>
			<h1 id="_idParaDest-80"><a id="_idTextAnchor066"/>Technical requirements</h1>
			<p>The requirements for this chapter are as follows:</p>
			<ul>
				<li><strong class="bold">Jira Cloud environment</strong>: If you don't already have access to Jira, you can create a free Jira Cloud account at <a href="https://www.atlassian.com/software/jira/free">https://www.atlassian.com/software/jira/free</a> and ensure that you have both Jira Software and Jira Service Management selected.</li>
				<li><strong class="bold">Jira Server environment</strong>: If you are using Jira Server (available from <a href="https://www.atlassian.com/software/jira/download">https://www.atlassian.com/software/jira/download</a>), ensure you have licenses for both Jira Software and Jira Service Management. In addition, you will also need to ensure that you install the <em class="italic">Automation for Jira</em> app, available from the Atlassian Marketplace.</li>
			</ul>
			<p>In both instances, you will need to have at least project administrator access to a Service Management project and a Scrum Software project to be able to follow the examples in this chapter. For the examples in this chapter, we have used the <em class="italic">IT Service Management project template</em> to create the Service Management project, and the <em class="italic">Scrum Software project template</em> to create the Software project.</p>
			<p>You can download the latest code samples for this chapter from this book's official GitHub repository at <a href="https://github.com/PacktPublishing/Automate-Everyday-Tasks-in-Jira">https://github.com/PacktPublishing/Automate-Everyday-Tasks-in-Jira</a>. The Code in Action videos for this chapter are available at <a href="https://bit.ly/39Hk44d">https://bit.ly/39Hk44d</a>.</p>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor067"/>Understanding smart values</h1>
			<p>Smart values allow <a id="_idIndexMarker130"/>you to access and manipulate almost all issue data in the context of an automation rule. In addition to allowing you to access the issue data, smart values also provide advanced functionality in the form of functions that allow you to perform complex operations on the issue data.</p>
			<p>In this section, we'll explore what smart values are available to you and how to recognize and use them in rules. We will also introduce you to smart value functions and explain how you can create your own smart values for use in your rules.</p>
			<p>Let's begin by taking a look at where we can find smart values and how to use them.</p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor068"/>Finding and using smart values</h2>
			<p>Smart values<a id="_idIndexMarker131"/> are <a id="_idIndexMarker132"/>generally set in the rule context by the trigger that initiated execution of the rule. In addition, certain actions, such as <a id="_idIndexMarker133"/>the <strong class="bold">Send web request</strong> action, can also introduce smart values into the rule context.</p>
			<p>Each of the smart values made available by these triggers are data structures that contain fields. These can either be simple field types, such as text or numbers, or more complex data structures that, in turn, contain other fields.</p>
			<p>For example, a trigger such as <code>{{issue}}</code> to the current Jira issue in the rule context. This smart value is a data structure that represents an issue in Jira and contains both simple and complex fields.</p>
			<p>Examples of simple fields would be <code>{{issue.summary}}</code> and <code>{{issue.key}}</code>, which allow you to access the summary and key of the issue, respectively. An example of a complex field, a field that itself is a data object, would be <code>{{issue.assignee}}</code>, as it itself contains further fields, which allow you to access the assignee's display name, email address, and accountId fields<a id="_idIndexMarker134"/> in<a id="_idIndexMarker135"/> the case of <code>{{issue.assignee.displayName}}</code>, <code>{{issue.assignee.emailAddress}}</code>, <code>{{issue.assignee.accountId}}</code>, and <code>{{issue.assignee.key}}</code>, respectively.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">To access a custom field in a smart value, you can either use the custom field's name or its ID. For example, if you had a custom field named <code>My Custom Field</code> with an ID value of <code>10000</code>, you could access it in a smart value as either <code>{{issue.My Custom Field}}</code>, <code>{{issue.my custom field}}</code>, or <code>{{issue.customfield_10000}}</code>. You can find the custom field ID by editing the custom field from the <strong class="bold">Custom Fields</strong> admin section and copying the ID from the resulting URL. However, you should only use this approach if, for some reason, you have multiple custom fields with the same name.</p>
			<p>In the following table, we can see the smart values made available by each automation trigger that you can use in subsequent rule components:</p>
			<div><div><img src="img/Figure_3.1_B16551.jpg" alt="Figure 3.1 - Smart values available by trigger&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.1 - Smart values available by trigger</p>
			<p>The preceding table shows the main smart value for each trigger and, for the majority of cases, you can find the fields available for each of these smart values listed at <a href="https://support.atlassian.com/jira-software-cloud/docs/smart-values-general">https://support.atlassian.com/jira-software-cloud/docs/smart-values-general</a> for Jira Cloud, or <a href="https://confluence.atlassian.com/display/AUTOMATION/Smart+values">https://confluence.atlassian.com/display/AUTOMATION/Smart+values</a> for Jira Server and Jira Data Center.</p>
			<p>Smart values are based on the Mustache templating system (https://mustache.github.io). To use smart values (or tags, as they are referred to in Mustache), you surround keys using double curly braces (or mustaches). Using this format signifies to the rule engine that it needs to treat the given value as a smart value, and not just static text.</p>
			<p>To access<a id="_idIndexMarker136"/> fields within smart value objects, you use dot notation. For <a id="_idIndexMarker137"/>example, to access the display name of the assignee of an issue, you would use dot notation as follows: <code>{{issue.assignee.displayName}}</code>.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">When you reference a field or value that does not exist in a particular issue, the smart value will be empty. You can instead specify that a smart value has a default value by using the pipe (|) symbol. For example, the smart value <code>{{issue.description|No description was supplied}}</code> will return the text <strong class="bold">No description was supplied</strong> if the <strong class="bold">Description</strong> field is empty.</p>
			<p>Smart values can be used in <strong class="bold">Advanced compare condition</strong>, <strong class="bold">JQL condition</strong>, and <strong class="bold">User condition</strong>, as well as in most rule actions.</p>
			<p>Let's take a look at an example rule that uses smart values.</p>
			<h3 id="_idParaDest-83">Creating a rule to add a comment when issues first become assigned</h3>
			<p>In this example rule, we<a id="_idIndexMarker138"/> are going to add a comment to the issue when the issue is first assigned, which will notify the reporter that we're working on their request:</p>
			<ol>
				<li>In your Service Management project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab, and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select <strong class="bold">Issue assigned</strong> and then click <strong class="bold">Save</strong>.</li>
				<li>Then select <code>{{changelog.assignee.fromString}}</code></p><p><code>equals</code></p><p><strong class="bold">Second value</strong>: Leave blank</p></li>
				<li>Now, select <code>Hi {{issue.reporter.displayName}}</code></p><p><code>We're now looking into your issue {{issue.summary}}.</code></p><p><code>We'll get back to you soon with an update.</code></p><p><code>{{issue.assignee.displayName}}.</code></p><p>The rule should look as follows:</p><div><img src="img/Figure_3.2_B16551.jpg" alt="Figure 3.2 - Using smart values in a rule&#13;&#10;"/></div><p class="figure-caption">Figure 3.2 - Using smart values in a rule</p></li>
				<li>Finally, name the rule <code>Comment to reporter on issue assigned</code> and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>In this section, we <a id="_idIndexMarker140"/>learned how we can use smart values in our rules to make them more flexible and, in the next section, we will introduce you to smart value functions.</p>
			<h2 id="_idParaDest-84"><a id="_idTextAnchor069"/>Smart value functions</h2>
			<p>In addition to the ability <a id="_idIndexMarker141"/>to access data fields with smart values, you can also manipulate these data values with the addition of functions.</p>
			<p>Functions are generally appended to the end of smart values using dot notation. For example, to truncate the issue summary to the first 50 characters and add an ellipsis to the end of the truncated summary, we would use the following smart function: <code>{{issue.summary.abbreviate(50)}}</code>.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Smart value functions can only be applied to fields of the corresponding type. For example, date and time functions can only be applied to the <em class="italic">created</em>, <em class="italic">updated</em>, <em class="italic">duedate</em>, <em class="italic">resolutiondate</em>, and any custom fields with <em class="italic">Date Picker</em> or <em class="italic">Date Time Picker</em> types.</p>
			<p>Smart functions can also be chained together, allowing us to perform multiple transformations in a single step. For example, the following smart function chain will convert the summary to lowercase, extract the fifth to tenth characters, and then append an exclamation to the end: <code>{{issue.summary.toLowerCase().substring(5,10).concat("!")}}</code>.</p>
			<p>Let's look at an<a id="_idIndexMarker142"/> example of using smart value functions in a rule.</p>
			<h3 id="_idParaDest-85">Creating a rule to add a comment asking for screenshots</h3>
			<p>In this example, we<a id="_idIndexMarker143"/> are going to create a manually triggered rule that a user can invoke to create a customized comment on the issue requesting the reporter to upload attachments to help further diagnose an issue:</p>
			<ol>
				<li value="1">In your Service Management project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab, and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select <strong class="bold">Manual trigger</strong> and click <strong class="bold">Save</strong>.</li>
				<li>Next, select <code>Hi {{issue.reporter.displayName.split(" ").first}}</code></p><p><code>We require a little more info in order to diagnose your issue further.</code></p><p><code>Please take a screenshot and attach it to this issue by no later than {{now.plusBusinessDays(2).fullDate}}.</code></p><p><code>Thank you :)</code></p><p><code>{{issue.assignee.displayName}}</code></p><p>The rule should look similar to the following screenshot:</p><div><img src="img/Figure_3.3_B16551.jpg" alt="Figure 3.3 - Using smart value functions&#13;&#10;"/></div><p class="figure-caption">Figure 3.3 - Using smart value functions</p></li>
				<li>Finally, name the rule <code>Ask reporter to attach screenshot</code> and click <strong class="bold">Turn it on</strong> to save<a id="_idIndexMarker144"/> and enable the rule.<p class="callout-heading">Important note</p><p class="callout">In Jira Cloud, it is possible to use the <em class="italic">Create variable</em> action to create a custom smart value based on other smart value functions and expressions that you can then make use of in later conditions and actions.</p></li>
			</ol>
			<p>In this section, we learned what smart values are and how we can use them to access data in automation rules. We also learned how to find the correct smart value for triggers and how to find the associated smart value fields. We also looked at smart value functions and saw how we can chain them together to apply multiple transformations in a single step.</p>
			<p>In the next section, we will look at how we can use smart values to manipulate and format dates in automation rules.</p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor070"/>Using smart value date functions</h1>
			<p>As a project management<a id="_idIndexMarker145"/> and tracking tool, having the ability to manipulate dates in Jira is critical to the correct operation of the application, and smart values in automation rules give us a lot of flexibility in how we can use and manipulate dates and times in rules.</p>
			<p>In this section, we will look at how we can use smart values to format dates and times for inclusion in other date and time fields, as well as how to format them for use in other fields such as text fields, the advanced field editor, or for use in notifications.</p>
			<p>We will also explore all the available formats and functions applicable to dates and see how we can use these in automation rules.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">You can access the current date and time using the smart value <em class="italic">{{now}}</em>. All formatting and date manipulation functions that can be used with date fields can also be used with the <em class="italic">{{now}}</em> smart value.</p>
			<p>Let's take a look at how we can format dates using smart value functions.</p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor071"/>Formatting dates</h2>
			<p>The ability to format<a id="_idIndexMarker146"/> dates and times gives<a id="_idIndexMarker147"/> us flexibility in how we can display these to users, in either comments, text fields, or notifications. It also allows us to be able to specify the exact format to use when communicating with external systems that require date and time inputs in specific formats and in reformatting dates and times received from external systems.</p>
			<p>Finally, being able to control the format of dates and times allows us to manipulate them using smart value functions and ensure that we can set a date or time field with the resulting calculation correctly.</p>
			<p>In the following table, we can see how the date, <em class="italic">Tuesday, December 31, 2019 10:25:30 PM CET</em> will be formatted using each of the available date and time formats available to automation rules:</p>
			<div><div><img src="img/Figure_3.4_B16551.jpg" alt="Figure 3.4 - Available date formats&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.4 - Available date formats</p>
			<p>As you can see from the preceding list, dates and times can be formatted for display in a variety of ways, and <a id="_idIndexMarker148"/>it is also possible to use a <a id="_idIndexMarker149"/>custom pattern if none of the standard ones are suitable.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">The pattern syntax used for the custom formatters <code>format("pattern")</code> and <code>as("pattern")</code> are defined by the underlying Java platform and the full syntax descriptions can be found at the following link, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html">https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html</a>, under the heading <em class="italic">Patterns for Formatting and Parsing</em>.</p>
			<h3 id="_idParaDest-88">Formatting dates with locales and time zones</h3>
			<p>In addition to the<a id="_idIndexMarker150"/> formats that we have just looked at, with smart values, it is also possible to format dates and times for specific locales and time zones, or even the locale or time zone of a specific user, such as the assignee or reporter of an issue.</p>
			<p>The following formatting functions are provided to enable locale- and time zone-based formatting of dates and times:</p>
			<ul>
				<li><code>{{issue.created.withLocale("fr_CA")}}</code> to format the issue created date using Canadian French, or <code>{{issue.created.withLocale(issue.reporter.locale)}}</code> to format the issue created date using the reporter's locale.</li>
				<li><code>{{issue.created.convertToTimeZone("America/New_York")}}</code> to format the issue created date to display in the current time zone in New York, or <code>{{issue.created.convertToTimeZone(issue.reporter.timeZone)}}</code> to format the issue created date to the reporter's time zone.</li>
				<li><strong class="bold">setTimeZone(string timezone)</strong>: Sets the time zone component of the <strong class="bold">DateTime</strong> field to the given time zone. This function will change the time zone without converting the time.</li>
			</ul>
			<p>The full list of supported locales can be found at https://www.oracle.com/java/technologies/javase/jdk11-suported-locales.html#modules. The list of time zones is defined by the tz database and the full list can be<a id="_idIndexMarker151"/> found at <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a>.</p>
			<p>Let's see how we can use date formats in an example rule.</p>
			<h3 id="_idParaDest-89">Creating a rule to create onboarding sub-tasks</h3>
			<p>In this rule, when <a id="_idIndexMarker152"/>a new employee onboarding request is created, we need to ensure that certain tasks, such as provisioning a laptop and desk phone, are completed before the new employee starts.</p>
			<p>We want the sub-task summaries to include the start date so that it is immediately apparent to the user assigned to the request when the task is due:</p>
			<ol>
				<li value="1">In your Service Management project, navigate to <strong class="bold">Project settings</strong>, click on the <strong class="bold">Automation</strong> tab, and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select the <strong class="bold">Issue created</strong> trigger and click <strong class="bold">Save</strong>.</li>
				<li>Then select <code>Request Type</code></p><p><code>equals</code></p><p><code>Onboard new employees</code></p></li>
				<li>Next, select <code>Provision new laptop by {{issue.duedate.longDate}}</code></p><p><code>Setup new desk phone by {{issue.duedate.longDate}}</code></p><p>The rule should look similar to the following screenshot:</p><div><img src="img/Figure_3.5_B16551.jpg" alt="Figure 3.5 - Using the smart value date format&#13;&#10;"/></div><p class="figure-caption">Figure 3.5 - Using the smart value date format</p></li>
				<li>Finally, click <code>Create onboarding sub-tasks</code>, and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>Now that we've seen how to format dates and time, let's take a look at how we can manipulate them using smart value functions.</p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor072"/>Manipulating dates</h2>
			<p>In addition to<a id="_idIndexMarker154"/> providing the ability to format dates, a number of smart value functions are provided that enable us to perform operations on dates. These operations allow us to perform comparisons on dates and times, perform basic arithmetic on dates and times, and manipulate the various components of dates and times.</p>
			<p>Let's take a look at the functions you can use to manipulate dates in your rules. The first set of functions relate to date comparisons and allow you to compare one date with another:</p>
			<ul>
				<li><code>function</code> parameter. This function will return <code>date</code> parameter, and <strong class="bold">false</strong> otherwise.</li>
				<li><code>function</code> parameter. This function will return <code>date</code> parameter, and <strong class="bold">false</strong> otherwise.</li>
				<li><code>function</code> parameter. This function will return <code>date</code> parameter, and <strong class="bold">false</strong> otherwise.</li>
				<li><code>-1</code>) when the date field used to call the function is earlier than the date in the parameter, <code>0</code> if they are equal, or a positive integer (such as <code>1</code>) if the date field is later than the date field in the parameter.</li>
			</ul>
			<p>The next set of functions allows us to manipulate dates and times in various ways:</p>
			<ul>
				<li><code>diffDate(date).seconds</code> will display the difference between the dates in seconds. The default output is <em class="italic">prettyPrint</em>, which displays the difference in words, for example, <em class="italic">2 days 3 hours</em>.</li>
				<li><strong class="bold">plusDays(int days)</strong>/<strong class="bold">minusDays(int days)</strong>: Adds or subtracts the given number of days to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusHours(int hours)</strong>/<strong class="bold">minusHours(int hours)</strong>: Adds or subtracts the given number of hours to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusWeeks(int weeks)</strong>/<strong class="bold">minusWeeks(int weeks)</strong>: Adds or subtracts the given number of weeks to or from the respective date component and returns a new date with the<a id="_idIndexMarker160"/> relevant calculation applied.</li>
				<li><strong class="bold">plusMillis(int millis)</strong>/<strong class="bold">minusMillis(int millis)</strong>: Adds or subtracts the given number of milliseconds to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusMinutes(int minutes)</strong>/<strong class="bold">minusMinutes(int minutes)</strong>: Adds or subtracts the given number of minutes to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusMonths(int months)</strong>/<strong class="bold">minusMonths(int months)</strong>: Adds or subtracts the given number of months to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusSeconds(int seconds)</strong>/<strong class="bold">minusSeconds(int seconds)</strong>: Adds or subtracts the given number of seconds to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusYears(int years)</strong>/<strong class="bold">minusYears(int years)</strong>: Adds or subtracts the given number of years to or from the respective date component and returns a new date with the relevant calculation applied.</li>
				<li><strong class="bold">plusBusinessDays(int days)</strong>/<strong class="bold">minusBusinessDays(int days)</strong>: Adds or subtracts the given number of business days to or from the respective date component and returns a new date with the relevant calculation applied. A business day is defined as the hours of 9 a.m. to 6 p.m., Monday to Friday.</li>
				<li><strong class="bold">toBusinessDay</strong>/<strong class="bold">toBusinessDayBackwards</strong>: Returns the first business day after or before the date used to call the function, respectively.</li>
				<li><strong class="bold">toStartOfDay</strong>/<strong class="bold">toDateTimeAtStartOfDay</strong>: Sets the time components to zero (that is, midnight) for the given date using the server's default time zone. The first function is used for <strong class="bold">DateTime</strong> fields, while the second function will convert a <strong class="bold">Date</strong> field to a <strong class="bold">DateTime</strong> field and set the time component accordingly.</li>
				<li><strong class="bold">toCurrentTime</strong>/<strong class="bold">toDateTimeAtCurrentTime</strong>: Sets the time components to the current time for the given date. The first function is used for <strong class="bold">DateTime</strong> fields, while the second function will convert a <strong class="bold">Date</strong> field to a <strong class="bold">DateTime</strong> field and set the time <a id="_idIndexMarker161"/>component accordingly.</li>
				<li><code>MON</code><em class="italic">,</em> <code>TUE</code>, <code>WED</code>, <code>THU</code>, <code>FRI</code>, <code>SAT</code>, or <code>SUN</code> as values for the <code>dayOfWeek</code> parameter.</li>
				<li><code>dayOfMonth</code>. The allowable range for the <code>dayOfMonth</code> parameter is <code>1</code> to <code>31</code>.</li>
				<li><code>0</code> to <code>23</code>.</li>
				<li><code>0</code> to <code>999</code>.</li>
				<li><code>0</code> to <code>59</code>.</li>
				<li><code>1</code> to <code>12</code>.</li>
				<li><code>0</code> to <code>59</code>.</li>
				<li><strong class="bold">withYear(int year)</strong>: Sets the year component of the <strong class="bold">Date</strong> or <strong class="bold">DateTime</strong> field to the supplied year. The allowable range for the year parameter is any valid year in the Gregorian calendar.</li>
				<li><code>dayOfYear</code>. The allowable range for the <code>dayOfYear</code> parameter is <code>1</code> to <code>365</code>.</li>
				<li><strong class="bold">startOfMonth</strong>/<strong class="bold">endOfMonth</strong>: Sets the date component of the <strong class="bold">Date</strong> or <strong class="bold">DateTime</strong> field to the first or last calendar day of the month in the field's month component.</li>
				<li><strong class="bold">firstBusinessDayOfMonth</strong>/<strong class="bold">lastBusinessDayOfMonth</strong>: Sets the day of month component of the <strong class="bold">Date</strong> or <strong class="bold">DateTime</strong> field to the first or last business day of the month in the field's month component.</li>
				<li><code>1</code> to <code>7</code>, 1 being Monday and <code>7</code> being Sunday. For example, calling <code>{{datefield.firstOfTheMonth(3)}}</code> will set the date to the first Wednesday of the month.</li>
				<li><code>weekOfMonth</code> parameter is from <code>1</code> to <code>5</code> and the range for the <code>dayOfWeek</code> parameter is <code>1</code> to <code>7</code>, <code>1</code> being Monday and <code>7</code> being Sunday. For example, to set the date to the third Monday of the month, you would<a id="_idIndexMarker163"/> use <code>{{datefield.ofTheMonth(3, 1)}}</code>.</li>
			</ul>
			<p>Now that we've taken a look at the various functions available to manipulate dates and times, let's take a look at a couple of examples of how to use them in rules.</p>
			<h3 id="_idParaDest-91">Creating a rule to update the due date based on sub-tasks</h3>
			<p>For this example, we<a id="_idIndexMarker164"/> have a number of sub-tasks for each user story in the software project, and we would like to update the due date of the user story to 5 business days from the current date when the last sub-task transitions to <strong class="bold">In Progress</strong>:</p>
			<ol>
				<li value="1">In your Software project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab (or <strong class="bold">Project automation</strong> tab if you're using Jira Server), and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select the <strong class="bold">Issue transitioned</strong> trigger and set the <strong class="bold">To status</strong> field to <strong class="bold">In Progress</strong> and then click <strong class="bold">Save</strong>.</li>
				<li>Then select <code>Issue Type</code></p><p><code>equals</code></p><p><code>Sub-task</code></p></li>
				<li>Next, select <strong class="bold">Branch rule / related issues</strong>, set <strong class="bold">Type of related issues</strong> to <strong class="bold">Parent</strong>, and then click <strong class="bold">Save</strong>.</li>
				<li>Now select <code>Sub-tasks</code></p><p><code>All match specified JQL</code></p><p><code>status = "In Progress"</code></p></li>
				<li>Select <code>{{now.plusBusinessDays(5)}}</code> in the <strong class="bold">Due date</strong> field and click <strong class="bold">Save</strong>.<p>Your rule should <a id="_idIndexMarker165"/>now look similar to the following screenshot:</p><div><img src="img/Figure_3.6_B16551.jpg" alt="Figure 3.6 - Adding business days to the current date&#13;&#10;"/></div><p class="figure-caption">Figure 3.6 - Adding business days to the current date</p></li>
				<li>Finally, name your rule <code>Set user story due date</code> and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>Let's now take a look at another example of using smart value functions to manipulate dates.</p>
			<h3 id="_idParaDest-92">Creating a rule to set the due date</h3>
			<p>For this example, we<a id="_idIndexMarker166"/> want to set the due date of an issue to the 15th of the current month if the issue is created before the 15th of the month, and to the 15th of the following month if the issue is created after the 15th of the month:</p>
			<ol>
				<li value="1">In your Software project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab (or the <strong class="bold">Project automation</strong> tab if you're using Jira Server), and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select <strong class="bold">Issue created</strong> and then click <strong class="bold">Save</strong>.</li>
				<li>Next, select <strong class="bold">New condition</strong>, followed by <strong class="bold">If / else block</strong>, and add an <strong class="bold">Advanced compare condition</strong> to the If block.</li>
				<li>Set the fields for the <code>{{issue.created}}</code></p><p><code>greater than</code></p><p><code>{{now.startOfMonth.plusDays(15)}}</code></p></li>
				<li>Now select <code>{{now.endOfMonth.plusDays(15)}}</code> and click <strong class="bold">Save</strong>.<p>Your rule should now look as per the following screenshot:</p><div><img src="img/Figure_3.7_B16551.jpg" alt="Figure 3.7 - Setting the date to the middle of next month&#13;&#10;"/></div><p class="figure-caption">Figure 3.7 - Setting the date to the middle of next month</p></li>
				<li>Now that we've dealt<a id="_idIndexMarker167"/> with due dates for next month, let's complete the rule for due dates this month. Click on <strong class="bold">Add else</strong> in the rule-chain view and then click <strong class="bold">Save</strong>.</li>
				<li>Next, add a <code>{{now.withDayOfMonth(15)}}</code> and click <strong class="bold">Save</strong>.<p>Your rule should look similar to the following screenshot:</p><div><img src="img/Figure_3.8_B16551.jpg" alt="Figure 3.8 - Setting the date to the middle of the current month&#13;&#10;"/></div><p class="figure-caption">Figure 3.8 - Setting the date to the middle of the current month</p></li>
				<li>Finally, name the rule <code>Set due date to middle of the month</code> and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>In this section, we <a id="_idIndexMarker168"/>have taken a look at the various smart value date and time functions available and learned how to use these to manipulate dates in automation rules. Next, we'll take a look at how we can use smart values to work with text.</p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor073"/>Using smart value text functions</h1>
			<p>In a similar fashion to<a id="_idIndexMarker169"/> working with dates and times, smart value functions that deal with text strings allow us to manipulate any text field type, including the sub-attributes of fields where they are also text-type fields.</p>
			<p>In this section, we will look at how smart value functions for text allow us to manipulate text, encode it for use in HTML, JSON, XML, or URLs, and how we can use functions to test for specific characteristics within blocks of text.</p>
			<p>Let's take a look at the functions available to manipulate text in automation rules. The first set of functions we'll look at deal with text comparisons and return either <strong class="bold">true</strong> or <strong class="bold">false</strong> depending on whether the check passes or fails:</p>
			<ul>
				<li><strong class="bold">startsWith(string)</strong>/<strong class="bold">endsWith(string)</strong>: Checks whether the text field starts or ends with the given string, respectively</li>
				<li><strong class="bold">equals(string)</strong>/<strong class="bold">equalsIgnoreCase(string)</strong>: Checks whether the text field equals the given string exactly or ignoring capitalization, respectively</li>
				<li><strong class="bold">isAlpha</strong>: Checks whether the text field contains only letters</li>
				<li><strong class="bold">isNumeric</strong>: Checks whether the text field contains only numbers</li>
				<li><strong class="bold">isAlphaNumeric</strong>: Checks <a id="_idIndexMarker170"/>whether the text field contains only letters and numbers</li>
				<li><strong class="bold">isEmpty</strong>: Checks for the absence of data in the text field</li>
				<li><strong class="bold">isNotEmpty</strong>: Checks for the presence of data in the text field</li>
			</ul>
			<p>The next set of functions allows us to convert text into other types, such as numbers, dates, or lists:</p>
			<ul>
				<li><strong class="bold">asNumber</strong>: Converts the text field to a number allowing you to perform numeric operations and calculations on the converted value.<p class="callout-heading">Tip</p><p class="callout">Use the <em class="italic">isNumeric</em> test on the text field prior to conversion to ensure you don't get errors by trying to convert text that cannot be represented as numbers.</p></li>
				<li><strong class="bold">toDate</strong>/<strong class="bold">toDate(string pattern)</strong>: Converts a text field to a date. Use the second form of the function to specify what the format of the date in its textual representation should be. Refer to the <em class="italic">Formatting dates</em> section for examples of how to define the pattern.</li>
				<li><strong class="bold">split(string separator)</strong>: Splits a text field into a list of items around the separator. The resulting list of items can then be manipulated using the smart value list functions.</li>
				<li><strong class="bold">match(string regularExpression)</strong>: Performs a regular expression search on the text field. Multiple matches of regularExpression are returned as a list of items that can be manipulated further using the smart value list functions.<p class="callout-heading">Tip</p><p class="callout">A <em class="italic">regular expression</em> is a special text string for describing a search pattern. These patterns are usually used to perform find or find-and-replace operations on text strings or to validate input. In Jira automation, regular expressions are based on the underlying Java implementation, which can be found at <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html</a>.</p></li>
			</ul>
			<p>The following set of <a id="_idIndexMarker171"/>functions allows us to change the way text is displayed, extract portions of text, or even replace blocks of text:</p>
			<ul>
				<li><strong class="bold">abbreviate(int maxLength)</strong>: Abbreviates the text field to the maximum length specified and adds an ellipsis ("â€¦") to the end of the text.</li>
				<li><strong class="bold">toLowerCase</strong>: Converts the text field to all lowercase.</li>
				<li><strong class="bold">toUpperCase</strong>: Converts the text field to all uppercase.</li>
				<li><strong class="bold">capitalize</strong>: Converts the first character of the text field to uppercase.</li>
				<li><strong class="bold">reverse</strong>: Reverses all the characters of the text field.</li>
				<li><strong class="bold">trim</strong>: Removes all leading and trailing white spaces from the text field.</li>
				<li><strong class="bold">concat(string)</strong>: Appends the given string to the end of the text field.</li>
				<li><code>0</code>.</li>
				<li><strong class="bold">indexOf(string) / lastIndexOf(string)</strong>: Finds the first or last position of the given string within the text field.</li>
				<li><strong class="bold">length</strong>: Returns the total number of characters of the text field.</li>
				<li><strong class="bold">quote</strong>: Formats the text field into a literal expression that can then be used in a regular expression in the match function. For example, if the text field contains regular expression special characters, such as * or \, these will be treated as normal (or literal) characters rather than as regular expressions.</li>
				<li><strong class="bold">remove(string)</strong>: Removes all occurrences of the given string from the text field.</li>
				<li><strong class="bold">replace(string target, string replacement)</strong>: Replaces the target string in the text field with the replacement string value.</li>
				<li><code>regex</code> with the replacement string.</li>
				<li><strong class="bold">left(int length)</strong>/<strong class="bold">right(int length)</strong>: Returns the specified number of characters from either the left<a id="_idIndexMarker172"/> or right of the text field, respectively.</li>
				<li><strong class="bold">leftPad(int length, string)</strong>/<strong class="bold">rightPad(int length, string)</strong>: Adds the given string to either the left or right of the text field until the text reaches the total length specified.</li>
				<li><strong class="bold">substring(int start)</strong>: Returns a portion of the text field beginning at the start index.</li>
				<li><strong class="bold">substring(int start, int end)</strong>: Returns a portion of the text field beginning at the start index and ending at the end index.</li>
				<li><strong class="bold">substringAfter(string)</strong>/<strong class="bold">substringAfterLast(string)</strong>: Returns a portion of the text field after the first or last occurrence of the supplied string, respectively.</li>
				<li><strong class="bold">substringBefore(string)</strong>/<strong class="bold">substringBeforeLast(string)</strong>: Returns a portion of the text field before the first or last occurrence of the supplied string, respectively.</li>
				<li><strong class="bold">substringBetween(string open, string close)</strong>: Returns a portion of the text field between the given start and end strings.</li>
			</ul>
			<p>The final set of functions allows us to encode text to comply with specific standards. This is especially useful when integrating with external systems or when sending email notifications from rules:</p>
			<ul>
				<li><strong class="bold">htmlEncode</strong>: Use this function to ensure the text field value is correctly encoded when including the field in HTML output.</li>
				<li><strong class="bold">jsonEncode)</strong>: Use this function to ensure the text field value is correctly encoded when including the field in JSON output.</li>
				<li><strong class="bold">urlEncode</strong>: Use this function to ensure the text field value is correctly encoded when using the field to create a URL link.</li>
				<li><strong class="bold">xmlEncode</strong>: Use this<a id="_idIndexMarker173"/> function to ensure the text field value is correctly encoded when including the field in XML output.</li>
			</ul>
			<p>Now that we've looked at the various functions available that we can use to manipulate text, let's take a look at how we can leverage these in automation rules.</p>
			<h2 id="_idParaDest-94"><a id="_idTextAnchor074"/>Creating a rule to auto-close an issue</h2>
			<p>A common scenario <a id="_idIndexMarker174"/>faced by many teams is that after a ticket has been resolved, the reporter replies to say thank you. This will generally cause the ticket to re-open and someone will have to manually go and resolve the ticket again. </p>
			<p>In this example, we'll use text smart value functions to examine the latest comment and auto-resolve the issue if we find the words "thank you":</p>
			<ol>
				<li value="1">In your Service Management project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab, and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select the <strong class="bold">Issue transitioned</strong> trigger, set the <strong class="bold">From status</strong> field to <strong class="bold">Resolved</strong>, the <strong class="bold">To status</strong> field to <strong class="bold">In Progress</strong>, and then click <strong class="bold">Save</strong>.</li>
				<li>Now select <code>{{issue.comments.last.body.trim.toLowercase}}</code></p><p><code>contains regular expression</code></p><p><code>thank\s+you</code></p><p>The rule should now look as follows:</p><div><img src="img/Figure_3.9_B16551.jpg" alt="Figure 3.9 - Using text smart value functions in conditions&#13;&#10;"/></div><p class="figure-caption">Figure 3.9 - Using text smart value functions in conditions</p></li>
				<li>Next, select <strong class="bold">New action</strong> and <a id="_idIndexMarker175"/>then <strong class="bold">Transition issue</strong>. Set <strong class="bold">Transition the issue by</strong> to <strong class="bold">Selecting the destination status</strong>, and, in the <strong class="bold">Destination status</strong> field, select <strong class="bold">Resolved</strong> and then click <strong class="bold">Save</strong>.</li>
				<li>Name the rule <code>Auto-resolve thank you comments</code> and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>In this section, we have seen how we can use smart value functions to compare and manipulate text values. In the next section, we'll take a look at how we can use smart values and functions to work with lists of items.</p>
			<h1 id="_idParaDest-95"><a id="_idTextAnchor075"/>Using smart value list functions</h1>
			<p>There are a <a id="_idIndexMarker176"/>number of scenarios you'll come across when authoring automation rules, where you'll be presented with a list of items. This could be a list of versions or components attached to an issue, or a list of issues, such as all the sub-tasks of a particular issue.</p>
			<p>Smart value functions for lists give us the ability to work with these lists of items by iterating over each item and being able to perform additional functions against attributes of the items. We also have access to functions that allow us to perform simple calculations against all the items in a list.</p>
			<p>In this section, we'll take a look at the smart value functions available for accessing and formatting lists of items.</p>
			<p>We'll cover examples of iterating over lists using smart values when we look at sending notifications via email and Slack in <a href="B16551_04_Final_ASB_ePub.xhtml#_idTextAnchor080"><em class="italic">Chapter 4</em></a>, <em class="italic">Sending Automated Notifications</em>.</p>
			<p>Let's now take a look at the smart value functions available for working with lists:</p>
			<ul>
				<li><strong class="bold">isEmpty</strong>: Checks whether a list contains any items. This function will return <strong class="bold">true</strong> if the list is empty and <strong class="bold">false</strong> if it contains items.</li>
				<li><strong class="bold">size</strong>: Returns the number of items in the list.</li>
				<li><strong class="bold">join(string separator)</strong>: Joins all the items in the list into a single text value, separated by the supplied separator.</li>
				<li><code>0</code> (zero) on either end of the list.</li>
				<li><strong class="bold">first</strong>: Retrieves the first item of the list.</li>
				<li><strong class="bold">last</strong>: Retrieves the last item of the list.</li>
				<li><strong class="bold">average</strong>: Computes the average of all the items in a numerical list.</li>
				<li><strong class="bold">max</strong>: Finds the item with the largest number in a numerical list or finds the latest date in a list of dates.</li>
				<li><strong class="bold">min</strong>: Finds the item with the smallest number in a numerical list or finds the earliest date in a list of dates.</li>
				<li><strong class="bold">sum</strong>: Computes the sum of all the items in a numerical list.</li>
			</ul>
			<p>Let's take a look at how<a id="_idIndexMarker177"/> we can incorporate what we have learned about lists into a practical example that uses a smart value list function to calculate the sum of story points in sub-tasks.</p>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor076"/>Creating a rule to sum up sub-task story points in a parent story</h2>
			<p>In this example, we are<a id="_idIndexMarker178"/> tracking story points against sub-tasks and would like to ensure that the parent story always reflects the correct total of story points whenever the story points in one of its sub-tasks' changes. You will need to enable the configuration context for the <strong class="bold">Story Points</strong> custom field to include <strong class="bold">sub-tasks</strong> in addition to <strong class="bold">Epics</strong> and <strong class="bold">Stories</strong>:</p>
			<ol>
				<li value="1">In your Software Project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab (or the <strong class="bold">Project automation</strong> tab if you're using Jira Server), and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select <strong class="bold">Field value changed</strong>, set <strong class="bold">Fields to monitor for changes</strong> to <strong class="bold">Story Points</strong>, and then click <strong class="bold">Save</strong>.</li>
				<li>Now select <code>Issue Type</code></p><p><code>equals</code></p><p><code>Sub-task</code></p></li>
				<li>Then select <code>Parent</code> and click <strong class="bold">Save</strong>.</li>
				<li>Next, select <strong class="bold">New action</strong> and then select <strong class="bold">Edit issue</strong>.</li>
				<li>In the <code>{{issue.subtasks.Story Points.sum}}</code></p><p>Your rule should <a id="_idIndexMarker179"/>now look as per the following screenshot:</p><div><img src="img/Figure_3.10_B16551.jpg" alt="Figure 3.10 - Using a smart value list function to sum list item values&#13;&#10;"/></div><p class="figure-caption">Figure 3.10 - Using a smart value list function to sum list item values</p></li>
				<li>Finally, name the rule <code>Keep parent in sync with sub-task story points</code> and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>In this section, we have learned how we can use smart value list functions to iterate over items in a list and how to perform operations against values in a list.</p>
			<p>Next we'll take a look at the mathematical operations available for use in automation rules.</p>
			<h1 id="_idParaDest-97"><a id="_idTextAnchor077"/>Using smart value math expressions and functions</h1>
			<p>So far, we have<a id="_idIndexMarker180"/> seen how to use smart values for working with <a id="_idIndexMarker181"/>dates, text, and lists and how they are able to help you create powerful and flexible automation rules.</p>
			<p>In this section, we are going to look at math expressions and functions. Math expressions and functions will allow you to perform calculations directly in numeric fields as well as allow you to reference numeric fields in calculations for display in text fields. In Jira, all numeric fields are based on floating-point numbers.</p>
			<p>To use any of the math expressions, they need to be surrounded by the following smart value block in order to be recognized as shown in the following example:</p>
			<p><code>{{#=}} &lt;math expression&gt; {{/}}</code></p>
			<p>The <code>{{#=}}</code> operator signifies to the automation engine that you are about to perform a calculation and is a custom addition to the underlying Mustache library.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Jira Cloud offers additional capabilities for working with numbers, including the ability to format numbers using locales or with custom patterns.</p>
			<p>Let's take a look at the math expressions in common between Jira Cloud and Jira Server first.</p>
			<p>Math expressions support the usual operations you'd expect to see, as can be seen in the following table:</p>
			<div><div><img src="img/Figure_3.11_B16551.jpg" alt="Figure 3.11 - Basic math expression operators&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.11 - Basic math expression operators</p>
			<p>In addition to the <a id="_idIndexMarker182"/>basic operations, math expressions support Boolean<a id="_idIndexMarker183"/> operators as well, and the supported operators can be seen in the following table:</p>
			<div><div><img src="img/Figure_3.12_B16551.jpg" alt="Figure 3.12 - Boolean math expression operators&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.12 - Boolean math expression operators</p>
			<p>Math expressions also <a id="_idIndexMarker184"/>support a number of functions that can be<a id="_idIndexMarker185"/> used, and we can see a full list of supported functions in the following table:</p>
			<div><div><img src="img/Figure_3.13_B16551.jpg" alt="Figure 3.13 - Supported math functions&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.13 - Supported math functions</p>
			<p>There are also a few constant values that are supported for use in math expressions, and these are listed here:</p>
			<div><div><img src="img/Figure_3.14_B16551.jpg" alt="Figure 3.14 - Support constant values&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.14 - Support constant values</p>
			<p>In addition to the <a id="_idIndexMarker186"/>preceding common functions and <a id="_idIndexMarker187"/>operations, Jira Cloud introduces some additional numerical operations. These operations do not need to be surrounded by the smart value block we learned about earlier, but rather can be applied directly to numerical smart values or fields.</p>
			<p>Let's take a look at these additional numerical operations:</p>
			<ul>
				<li><strong class="bold">abs</strong>: Returns the absolute value of a number</li>
				<li><strong class="bold">round</strong>: Returns a number rounded to the nearest whole number</li>
				<li><strong class="bold">floor</strong>/<strong class="bold">ceil</strong>: Returns the lower or upper value of a number, respectively</li>
				<li><strong class="bold">plus(value)</strong>/<strong class="bold">minus(value)</strong>: Adds or subtracts the number or smart value in the parameter to or from the numerical value or field used to call the operation</li>
				<li><strong class="bold">multiply(value)</strong>/<strong class="bold">divide(value)</strong>: Multiplies or divides the number or smart value in the parameter with or by the numerical value or field used to call the operation</li>
				<li><strong class="bold">gt(value)</strong>/<strong class="bold">gte(value)</strong>: Checks whether the numerical smart value is greater than, or greater than or equal to, the value given in the parameter</li>
				<li><strong class="bold">eq(value)</strong>: Checks whether the numerical smart value is equal to the value given in the parameter</li>
				<li><strong class="bold">lt(value)</strong>/<strong class="bold">lte(value)</strong>: Checks whether the numerical smart value is less than, or less than or equal to, the value given in the parameter</li>
			</ul>
			<p>Jira Cloud also adds the ability to format numerical values using smart value functions, and these functions are listed here:</p>
			<ul>
				<li><strong class="bold">format</strong>: Formats the numerical field using the numerical format of the US locale.</li>
				<li><code>fr_CA</code>.</li>
				<li><strong class="bold">format(string pattern)</strong>: Formats the numerical field using a custom pattern. The patterns you <a id="_idIndexMarker188"/>can use rely on the underlying Java <a id="_idIndexMarker189"/>implementation and can be found at the following link: https://docs.oracle.com/javase/tutorial/java/data/numberformat.html.</li>
				<li><strong class="bold">asPercentage</strong>/<strong class="bold">asPercentage(string locale)</strong>: Formats the numerical field as a percentage in the US locale or as a percentage in the locale specified.</li>
				<li><strong class="bold">asCurrency</strong>/<strong class="bold">asCurrency(string locale)</strong>: Formats the numerical field as a currency in the US locale or as a currency in the locale specified.</li>
			</ul>
			<p>As we've seen, there is a comprehensive number of smart value functions that we can make use of to perform advanced mathematical operations in automation rules. Let's now take a look at using math expressions in an example.</p>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor078"/>Creating a rule to keep an original estimate for an epic in sync with its child issues</h2>
			<p>In this example, we're<a id="_idIndexMarker190"/> going to update the original <a id="_idIndexMarker191"/>estimate of an epic any time tracking fields in the epic's underlying issues change:</p>
			<ol>
				<li value="1">In your Software project, navigate to <strong class="bold">Project settings</strong>, click the <strong class="bold">Automation</strong> tab (or the <strong class="bold">Project automation</strong> tab if you're using Jira Server), and then click on <strong class="bold">Create rule</strong>.</li>
				<li>Select the <strong class="bold">Field value changed</strong> trigger and, in the <strong class="bold">Fields to monitor for changes</strong> list, select <strong class="bold">Time tracking</strong> and then click <strong class="bold">Save</strong>.</li>
				<li>Next, select <code>Epic</code></p><p><code>Exists</code></p></li>
				<li>Now select <code>Epic (parent)</code> and click <strong class="bold">Save</strong>.</li>
				<li>Then, select <code>Original Estimate (System)</code>.<p>Add the following math expression to the <strong class="bold">Original Estimate (System)</strong> field and click <strong class="bold">Save</strong>:</p><pre>{{#=}}{{fieldChange.to}}/60 â€“ {{fieldChange.from}}/60 + {{issue.original estimate}}/60{{/}}</pre><p>The rule should now look similar to the following screenshot:</p><div><img src="img/Figure_3.15_B16551.jpg" alt="Figure 3.15 - Using math expressions in a rule&#13;&#10;"/></div><p class="figure-caption">Figure 3.15 - Using math expressions in a rule</p></li>
				<li>Finally, name the rule <code>Keep Epic estimates in sync</code> and click <strong class="bold">Turn it on</strong> to save and enable the rule.</li>
			</ol>
			<p>In this section, we <a id="_idIndexMarker192"/>have seen the comprehensive list<a id="_idIndexMarker193"/> of smart value mathematical functions available for use in your automation rules and how we can use these to manipulate numerical values.</p>
			<h1 id="_idParaDest-99"><a id="_idTextAnchor079"/>Summary</h1>
			<p>In this chapter, you have learned how to enhance the functionality of automation rules by using smart values and smart value functions.</p>
			<p>We learned which smart values are set by the various triggers and how you can access their attributes or fields. In addition, you learned about smart value functions and how they can be used in isolation against a particular field or chained together to perform multiple operations on data in a single step.</p>
			<p>Finally, we learned about the various smart value functions available for dates, text, lists, and numerical values and how these can be used to format and manipulate data to create extremely powerful and flexible rules.</p>
			<p>Smart values and their associated functions can be used in nearly every field in automation rule conditions and actions, and we'll learn throughout the rest of this book how they will help us to create much more powerful and richer rules as a result of their use.</p>
			<p>In the next chapter, we will be looking at how to send notifications to various channels from your automation rules.</p>
		</div>
	</body></html>