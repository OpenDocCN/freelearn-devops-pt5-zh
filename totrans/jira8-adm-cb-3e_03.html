<html><head></head><body>
        

                            
                    <h1 class="header-title">Jira Workflows</h1>
                
            
            
                
<p>Workflows are one of the core and most powerful features in Jira. They control how issues in Jira move from one stage to another as they are being worked on, sometimes being re-assigned to other users and capturing additional information during the process. For this reason, workflows can be thought of as the life cycle of issues.</p>
<p>Unlike many other systems, Jira allows you to create your own workflows to resemble the work processes you may already have in your organization. This is a good example of how Jira is able to adapt to your needs without you having to change the way you work.</p>
<p>In this chapter, we will learn not only about how to create workflows with the new workflow designer, but also how to use workflow components, such as conditions and validators, to add additional behavior to your workflows. We will also look at the many different apps that are available to expand the possibilities of what you can do with workflows.</p>
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Setting up different workflows for your project</li>
<li>Capturing additional information during workflow transitions</li>
<li>Using common transitions</li>
<li>Using global transitions</li>
<li>Restricting the availability of workflow transitions</li>
<li>Validating user input in workflow transitions</li>
<li>Performing additional processing after a transition is executed</li>
<li>Reacting to events coming from outside of Jira</li>
<li>Rearranging the workflow transition bar</li>
<li>Restricting the resolution values in a transition</li>
<li>Preventing issue updates in selected statuses</li>
<li>Making a field required during a workflow transition</li>
<li>Creating custom workflow transition logic</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting up different workflows for your project</h1>
                
            
            
                
<p>A workflow is like a flowchart in which issues can go from one state to another by following the direction paths between the states. In Jira's workflow terminology, the states are called <strong>statuses</strong>, and the paths are called <strong>transitions</strong>. We will use these two major components when customizing a workflow.</p>
<p>In this recipe, we will create a new, simple workflow from scratch. We will look at how to use existing statuses, create new statuses, and link them together using transitions.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>The first step is to create a new skeleton workflow in Jira:</p>
<ol>
<li>Log into Jira with a user that has a Jira Administrator's permission.</li>
<li>Navigate to <strong>Administration</strong> &gt; <strong>Issues</strong> &gt; <strong>Workflows</strong>.</li>
<li>Click on the <strong>Add workflow</strong> button, and name the workflow <kbd>Simple Workflow</kbd>.</li>
<li>Click on the <strong>Diagram</strong> button to use the workflow designer or diagram mode.</li>
</ol>
<p class="mce-root"/>
<p>The following screenshot explains some of the key elements of the workflow designer:</p>
<div><img src="img/06e9cede-00d3-4d8e-b697-0aa0bf252811.png" style="width:48.17em;height:28.92em;"/></div>
<p>Now we have created a new, inactive workflow. The next step is to add various statuses for the issues to go through. Jira comes with a number of existing statuses, such as In Progress and Resolved, for us to use:</p>
<ol>
<li>Click on the <strong>Add status </strong>button.</li>
<li>Select the <strong>In Progress </strong>status from the list, and click on <strong>Add</strong>.</li>
<li>Repeat the steps to add the Closed status.</li>
</ol>
<p>You can type the status name into the field, and Jira will automatically find the status for you.</p>
<p>Once you have added the statuses to the workflow, you can drag them around to reposition them on the canvas. We can also create new statuses, as follows:</p>
<ol>
<li>Click on the <strong>Add status </strong>button.</li>
</ol>
<ol start="2">
<li>Name the new status <kbd>Frozen</kbd>, check the <strong>Allow all statuses to transition to this one</strong> option, and click on <strong>Add</strong>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="img/95e0e238-9dde-4ee4-9abe-65720327317d.png" style="width:24.17em;height:17.33em;"/></p>
<p>Jira will let you know if the status you are entering is new by showing the text (new status) next to the status name.</p>
<p>Now that we have added the statuses, we need to link them using transitions:</p>
<ol>
<li>Select the originating status, which, in this example, is <strong>OPEN</strong>.</li>
<li>Click on the small circle around the <strong>OPEN </strong>status and drag your cursor onto the <strong>IN PROGRESS </strong>status. This will prompt you to provide details for the new transition, as shown in the following screenshot:</li>
</ol>
<div><img src="img/e7f6ccee-8370-4934-bf4e-c996a15769a4.png" style="width:18.17em;height:17.92em;"/></div>
<ol start="3">
<li>Name the new transition <kbd>Start Progress</kbd>, and select the <strong>None </strong>option for the screen.</li>
<li>Repeat the steps to create a transition called <kbd>Close</kbd> between the <strong>IN</strong> <strong>PROGRESS </strong>and <strong>CLOSED </strong>statuses.</li>
</ol>
<p>You should finish with a workflow that looks like the following screenshot:</p>
<div><img src="img/8bc69826-320f-42a2-8f0c-10aa32b28eee.png" style="width:26.17em;height:25.00em;"/></div>
<p>At this point, the workflow is inactive, which means it is not being used by a project and you can edit it without any restrictions. Workflows are applied on a project and issue type basis. Perform the following steps to apply the new workflow to a project:</p>
<ol>
<li>Select the project to apply the workflow to.</li>
<li>Click on the <strong>Administration </strong>tab to go to the project administration page.</li>
<li>Select <strong>Workflows </strong>from the left-hand side of the page.</li>
<li>Click on <strong>Add Existing </strong>from the <strong>Add Workflow </strong>menu.</li>
<li>Select the new <strong>Simple Workflow </strong>from the dialog, and click on <strong>Next</strong>.</li>
<li>Choose the issue types to apply (for example, Bug) the workflow to, and click on <strong>Finish</strong>.</li>
</ol>
<p>After we have applied the workflow to a project, the workflow is placed in the active state. So, if we now create a new issue in the target project of the selected issue type, our new Simple Workflow will be used.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Capturing additional information during workflow transitions</h1>
                
            
            
                
<p>When users execute a workflow transition, we have an option to display an intermediate workflow screen. This is a very useful way of collecting some additional information from the user. For example, the default Jira workflow will display a screen for users to select the Resolution value when the issue is resolved.</p>
<p>Issues with resolution values are considered completed. You should only add the Resolution field to workflow screens that represent the closing of an issue.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>We need to have a workflow to configure, such as the Simple Workflow that was created in the previous recipe. We also need to have screens to display; Jira's out-of-the-box workflow screen and <strong>Result Issue </strong>Screen will suffice, but if you have created your own screens, they can also be used.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to add a screen to a workflow transition:</p>
<ol>
<li>Select the workflow to update, such as our <strong>Simple Workflow</strong>.</li>
<li>Click on the <strong>Edit </strong>button if the workflow is active. This will create a draft workflow for us to work on.</li>
<li>Select the <strong>Start Progress </strong>transition, and click on the <strong>Edit </strong>link from the panel on the right-hand side.</li>
<li>Select the screen you want to use, such as the workflow screen from the <strong>Screen</strong> drop-down menu, and click on <strong>Save</strong>.</li>
<li>Repeat <em>step 3</em> and <em>step 4 </em>to add Resolve Issue Screen to the <strong>Close</strong> transition.</li>
</ol>
<p>If we are working with a draft workflow, we must click on the Publish Draft button to apply our changes to the live workflow.</p>
<p>If you do not see your changes reflected, it is most likely you forgot to publish your draft workflow.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using common transitions</h1>
                
            
            
                
<p>Often, you will have transitions that need to be made available from several different statuses in a workflow, such as the <strong>Resolve</strong> and <strong>Close</strong> transitions. In other words, these are transitions that have a common destination status but many different originating statuses.</p>
<p>To help you simplify the process of creating these transitions, Jira lets you reuse an existing transition as a common transition if it has the same destination status.</p>
<p>Common transitions are transitions that have the same destination status but different originating statuses.</p>
<p>A common transition has an additional advantage of ensuring that transition screens and other relevant configurations, such as <strong>validators</strong>, will stay consistent. Otherwise, you will have to constantly check the various transitions every time you make a change to one of them.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to create and use common transitions in your workflow:</p>
<ol>
<li>Select the workflow, and click on the <strong>Edit</strong> link to create a draft.</li>
<li>Select the <strong>Diagram</strong> mode.</li>
<li>Create a transition between two statuses, for example, <strong>Open</strong> and <strong>Closed</strong>.</li>
</ol>
<ol start="4">
<li>Create another transition from a different status to the same destination status, and click on the <strong>Reuse a transition</strong> tab, as seen in the following screenshot:</li>
</ol>
<div><img src="img/5bc646fd-c593-4341-9097-eba33493034d.png" style="width:29.42em;height:17.00em;"/></div>
<ol start="5">
<li>Select the transition created in <em>step 3</em> from the <strong>Transition to reuse</strong> drop-down menu, and click on <strong>Add</strong>.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>Refer to the <em>Using global transitions</em> recipe, which helps us to create complicated workflows with ease by allowing an issue to transition into a status at any time.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using global transitions</h1>
                
            
            
                
<p>While a common transition is a great way to share transitions in a workflow and reduce the amount of management work that would otherwise be required, it has the limitation of having to manually create the transitions between the various statuses.</p>
<p>As your workflow starts becoming more complicated, explicitly creating the transitions becomes a tedious job; this is where <strong>global transitions</strong> come in.</p>
<p>A global transition is similar to a common transition in the sense that they both share the property of having a single destination status. The difference between the two is that the global transition is a single transition that is available to all the statuses in a workflow.</p>
<p class="mce-root"/>
<p>In this recipe, we will look at how to use global transitions so that issues can be transitioned to the Frozen status from any status throughout the workflow.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>As usual, you need to have a workflow you can edit. Since we will be demonstrating how global transitions work, you need to have a status called Frozen in your workflow and ensure that there are no transitions linked to it.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to create and use global transitions in your workflow:</p>
<ol>
<li>Select and edit the workflow you will be adding the global transition to.</li>
<li>Select <strong>Diagram</strong> mode.</li>
<li>Select the <strong>Frozen</strong>status.</li>
<li>Check the <strong>Allow all statuses to transition to this one</strong> option.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p style="padding-left: 60px">The following screenshot depicts the preceding steps:</p>
<div><img src="img/92e5b7ea-42b5-49b1-abd7-1a95eed7ec97.png" style="width:16.83em;height:21.58em;"/></div>
<ol start="6">
<li>Once you have created a global transition for a status, it will be represented as an <strong>All</strong> transition, as shown in the following screenshot:</li>
</ol>
<div><img src="img/dd7b70b5-5a9b-41d2-9d46-83adc432f3fd.png" style="width:39.33em;height:26.67em;"/></div>
<p>After the global transition is added to the <strong>Frozen</strong> status, you will be able to transition issues to FROZEN regardless of their current status.</p>
<p>You can only add global transitions in Diagram mode.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>Refer to the <em>Restricting the availability of workflow transitions</em> recipe, which explains how to remove a transition when an issue is already in the Frozen status.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Restricting the availability of workflow transitions</h1>
                
            
            
                
<p>Workflow transitions, by default, are accessible to anyone who has access to the issue. There will be times when you want to restrict access to certain transitions. For example, you might want to restrict access to the Freeze Issue transition for the following reasons:</p>
<ul>
<li>You want the transition to be available only to users in specific groups or project roles.</li>
<li>Since the transition is a global transition, it is available to all the workflow statuses, but it does not make sense to show the transition when the issue is already in the <strong>Frozen</strong> status.</li>
</ul>
<p>To restrict the availability of a workflow transition, we can use workflow conditions.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>For this recipe, we need to have the JSU Automation Suite for Jira Workflows app installed. You can download it from the following link, or install it directly from the <strong>Universal Plugin Manager</strong> (<strong>UPM</strong>): <a href="https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities" target="_blank">https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>We need to add a new workflow condition to the transition we want to apply restrictions to:</p>
<ol>
<li>Select and edit the workflow to configure.</li>
<li>Select <strong>Diagram</strong> mode.</li>
<li>Click on the <strong>Frozen</strong> global workflow transition.</li>
<li>Click on the <strong>Conditions</strong> link from the panel on the right-hand side.</li>
<li>Click on <strong>Add condition</strong>, select Value Field (JSU) from the list, and click on <strong>Add</strong>.</li>
<li>Configure the condition with the following parameters:
<ul>
<li>The <kbd>Status</kbd> field for <strong>Field</strong></li>
<li>The not-equal sign, <kbd>!=</kbd>, for <strong>Condition</strong></li>
<li><kbd>Frozen</kbd> for <strong>Value</strong></li>
<li><kbd>String</kbd> for <strong>Comparison Type</strong></li>
</ul>
</li>
</ol>
<p style="padding-left: 60px">This means that the transition will be shown only if the issue's status field value is not Frozen as shown in the following screenshot:</p>
<div><img src="img/2e72af28-4680-4fe8-80b2-480d6eaa25db.png" style="width:43.92em;height:31.83em;"/></div>
<ol start="7">
<li>Click on the <strong>Add</strong> button to complete the condition setup.</li>
</ol>
<p style="padding-left: 60px">At this point, we have added a condition that will make sure that the Freeze Issue transition is not shown when the issue is already in the Frozen status. The next step is to add another condition to restrict the transition to be available only to users in the Developer role.</p>
<ol start="8">
<li>Click on <strong>Add condition</strong> again and select <strong>User in the Project Role</strong> condition.</li>
<li>Select the Developer project role and click on <strong>Add</strong>.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>After you have applied the workflow conditions, the Frozen transition will no longer be available if the issue is already in the Frozen status, and/or if the current user is not in the Developer project role.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p class="mce-root">When a workflow transition option is to be rendered on the page, such as when viewing an issue, all its associated conditions are evaluated to determine if the option should be displayed. If there is more than one condition, the transition with conditions will only be displayed when one or all of the conditions pass, depending on the logic setting (see the following section) for the conditions.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>Using the Value Field condition (which comes with the JSU Automation Suite for Jira Workflows app) is one of the many ways in which we can restrict the availability of a transition based on the issue's current status. There is another app, called <strong>Jira Misc Workflow Extensions</strong>, which comes with a previous status condition for checking against the previous status an issue was in. You can download it from <a href="https://marketplace.atlassian.com/plugins/com.innovalog.jmwe.jira-misc-workflow-extensions" target="_blank">https://marketplace.atlassian.com/plugins/com.innovalog.jmwe.jira-misc-workflow-extensions</a>.</p>
<p>When you have more than one workflow condition applied to the transition, as in our example, the default behavior is that all conditions must pass for the transition to be available.</p>
<p>You can change this so that only one condition needs to pass for the transition to be available by changing the condition group logic from <strong>All of the following conditions</strong> to <strong>Any of the following conditions</strong>, as shown in the following screenshot:</p>
<div><img src="img/f3c517ee-a848-413c-919b-a1ebd488d3f9.png" style="width:39.00em;height:14.25em;"/></div>
<p>Make sure you pay close attention when configuring this to make sure you do not expose workflow transitions to users who should not be allowed to execute them.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Validating user input in workflow transitions</h1>
                
            
            
                
<p>For workflow transitions that have transition screens, you can add validation logic to make sure what the users put in is what you are expecting. This is a great way to ensure data integrity, and we can do this with workflow validators.</p>
<p>In this recipe, we will add a validator to perform a date comparison between a custom field and the issue's creation date, so the date value we select for the custom field must be after the issue's creation date.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>For this recipe, we need to have the JSU Automation Suite for Jira Workflows app installed. You can download it from the following link, or install it directly using the UPM: <a href="https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities" target="_blank">https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities</a>.</p>
<p>Since we are also doing a date comparison, we need to create a new date custom field called <kbd>Start Date</kbd> and add it to the workflow screen.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to add validation rules during a workflow transition:</p>
<ol>
<li>Select and edit the workflow to configure.</li>
<li>Select the <strong>Diagram</strong> mode.</li>
<li>Select the <strong>Start Progress</strong> transition and click on the <strong>Validators</strong> link on the right-hand side.</li>
<li>Click on the <strong>Add validator</strong> link and select <strong>Date Compare (JSU)</strong> from the list.</li>
<li>Configure the validator with the following parameters:
<ul>
<li>The <kbd>Start Date</kbd> custom field for <strong>This date.</strong></li>
<li>The greater-than sign, <kbd>&gt;</kbd>, for <strong>Condition</strong></li>
<li><kbd>Created</kbd> for Compare with</li>
<li>An optional custom error message, or leave it blank and a default error message will be displayed if the validation fails</li>
</ul>
</li>
</ol>
<ol start="6">
<li>Click on <strong>Add</strong> to add the validator:</li>
</ol>
<div><img src="img/f2463e8d-4309-4289-bcbc-6045a4973d56.png" style="width:47.83em;height:26.92em;"/></div>
<ol start="7">
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>After adding the validator, if we now try to select a date that is before the issue's create date, Jira will prompt you with an error message and stop the transition from going through, as shown in the following screenshot:</p>
<div><img src="img/1b0825c9-fcc9-4108-8c0d-11bf7de82f66.png" style="width:38.00em;height:17.67em;"/></div>
<p>As we can see, the date validation fails, and our custom defined error message is displayed.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Validators are run before the workflow transition is executed. This way, validators can intercept and prevent a transition from going through if any validation logic fails.</p>
<p>If you have more than one validator, all of them must pass for the transition to go through.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">See also</h1>
                
            
            
                
<p>Validators can be used to make a field required only during workflow transitions. Refer to the <em>Making a field required during a workflow transition</em> recipe for more details.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Performing additional processing after a transition is executed</h1>
                
            
            
                
<p>Jira allows you to perform additional tasks as part of a workflow transition through the use of post functions. Jira makes heavy use of post functions internally; for example, in the case of an out-of-the-box workflow, the resolution field value is cleared automatically when you reopen an issue.</p>
<p>In this recipe, we will look at how to add post functions to a workflow transition. We will add a post function to automatically clear out the value stored in a <strong>Reason for Freezing</strong> custom field when we take it out of the <strong>Frozen</strong> status.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Since we are clearing the value of a custom field called Reason for Freezing, we need to have a Text field (multi-line) custom field created and add it to the screens used by the project.</p>
<p class="mce-root"/>
<p>By default, Jira comes with a post function that can change the values for standard issue fields, but since <strong>Reason for Freezing</strong> will be a custom field, we need to have the JSU Automation Suite for Jira Workflows app installed.</p>
<p>You can download it from the following link, or install it directly using the UPM: <a href="https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities" target="_blank">https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to add processing logic after a workflow transition is executed:</p>
<ol>
<li>Select and edit the workflow to configure.</li>
<li>Select the <strong>Diagram</strong> mode.</li>
<li>Create a new workflow transition that will take the issue out of the <strong>Frozen</strong> status to another status.</li>
<li>Click on the <strong>Post functions</strong> link for the newly created transition.</li>
<li>Click on <strong>Add post</strong> <strong>function</strong>, select <strong>Clear Field Value (JSU)</strong> from the list, and click on <strong>Add</strong>.</li>
<li>Select the Reason for Freezing field from <strong>Field</strong>, and click on the <strong>Add</strong> button.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>With the post function in place, after you have executed the transition, the <strong>Reason for Freezing</strong> field will be cleared out. You can also see from the issue's change history, as part of the transition execution, where the <strong>Status</strong> field is changed from <strong>Frozen</strong> to <strong>Open</strong>, the change for the <strong>Reason for Freezing</strong> field is also recorded.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Post functions are run after the transition has been executed. When you add a new post function, you might notice that the transition already has a number of post functions pre-added; this is shown in the screenshot that follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="img/53e769ac-3e2c-479f-bf38-f08e0a4c2253.png" style="width:34.58em;height:14.67em;"/></p>
<p>These post functions are system post functions that carry out important internal functions, such as keeping the search index up to date. The order of these post functions is important.</p>
<p>Always add your own post functions to the top of the list.</p>
<p>For example, any changes to issue field values, such as the one we just added, should always happen before the Re-index post function, so by the time the transition is completed, all the field indexes are up to date, and ready to be searched:</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Reacting to events coming from outside of Jira</h1>
                
            
            
                
<p>When you are using Jira with other systems, especially applications also built by Atlassian, such as Bitbucket and Bamboo, you can get a lot more synergy with them working together. One example of such synergy is automatically executing a workflow transition when certain actions happen from the other application.</p>
<p>In this recipe, we will look at such a use case, where if a developer commits some code against a Jira issue, we automatically transition the issue into the <strong>In Progress</strong> status without needing the developer to manually go into Jira and perform the workflow transition.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Since our use case is about developers committing code, you will need to have a supported code management application available; both Bitbucket and GitHub are supported. In this recipe, we will be using Bitbucket. You can get a trial version of the application from <a href="https://www.atlassian.com/software/bitbucket/download">https://www.atlassian.com/software/bitbucket/download</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>To automatically transition an issue based on the outside event, we need to add the appropriate workflow trigger to the transition:</p>
<ol>
<li>Select and edit the workflow to configure.</li>
<li>Select the <strong>Start Progress</strong> transition.</li>
<li>Click on the <strong>Triggers</strong> button.</li>
<li>Click on the <strong>Add trigger</strong> button. If the button is disabled, it means you have not integrated Jira with Bitbucket yet.</li>
<li>Select the <strong>Commit created</strong> trigger and click <strong>Next</strong>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="img/179a7d6b-0699-47e3-b830-aa76cd8fe76d.png" style="width:36.75em;height:22.00em;"/></p>
<ol start="6">
<li>Click <strong>Add Trigger</strong> to apply the trigger to the workflow transition.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>With the trigger applied, if you commit some code with the issue's key as part of the commit message, the issue will be automatically transitioned to the destination status, in this case, the In Progress status.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Rearranging the workflow transition bar</h1>
                
            
            
                
<p>By default, workflow transitions are displayed based in the order in which they are defined in the workflow (as listed in text mode); the first two transitions will be shown as buttons, and the remaining transitions will be added to the <strong>Workflow</strong> menu.</p>
<p>This sequence is determined by the order in which the transitions are added, so you cannot change that. But you can rearrange them by using the <kbd>opsbar-sequence</kbd> property.</p>
<p>In this recipe, we will move the Frozen transition out from the Workflow menu and to its own transition button so that the users can easily access it.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to rearrange the order of transitions to be displayed in the issue transition bar:</p>
<ol>
<li>Select and edit the workflow to configure.</li>
<li>Select the <strong>Frozen</strong> global transition.</li>
<li>Click on the <strong>Properties</strong> button.</li>
<li>Enter <kbd>opsbar-sequence</kbd> as the <strong>Property Key</strong> and the value <kbd>10</kbd> in <strong>Property Value</strong> and click on <strong>Add</strong>. Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>As shown in the following screenshot, by increasing the sequence value of the workflow transition, it is moved out of the Workflow menu and made into its own button:</p>
<div><img src="img/fb4490d6-557f-4c7f-9f8f-044e0a556b49.png" style="width:43.50em;height:17.75em;"/></div>
<p>Now let's understand the working part.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The <kbd>opsbar-sequence</kbd> property orders the workflow transitions numerically, from the smallest to the largest. Its value needs to be a positive integer. The smaller the number, the closer the transition will appear to the front.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>Jira only displays the first two transitions as buttons. You can change this setting by editing the <kbd>ops.bar.group.size.opsbar-transitions</kbd> property in the <kbd>jira-config.properties</kbd> file located in your <kbd>JIRA_HOME</kbd> directory.</p>
<p>All you have to do is edit the file, set the property to the desired number of transition buttons to display as shown (we are setting the number of transition buttons to <kbd>3</kbd>), and restart Jira:</p>
<pre>ops.bar.group.size.opsbar-transitions=3 </pre>
<p>If you do not see the <kbd>jira-config.properties</kbd> file, you can simply create a new file with the same name and add your properties there.</p>
<p>See the following screenshot:</p>
<div><img src="img/6a7d24c2-06df-446a-832d-323586890888.png" style="width:39.92em;height:16.33em;"/></div>
<p>Jira now shows three transition buttons instead of two.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Restricting the resolution values in a transition</h1>
                
            
            
                
<p>Normally, issue resolution values such as <strong>Fixed</strong> and <strong>Won't Fix</strong> are global, so regardless of the project and issue type, the same set of values will be available. As you implement different workflows in Jira, you may find that certain resolutions are not relevant for a given project or issue type.</p>
<p>In this recipe, we will select a subset of the global resolutions available when we close issues using our Simple Workflow.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to selectively include a subset of resolutions for a given workflow transition:</p>
<ol>
<li>Select and edit the <strong>Simple Workflow</strong>.</li>
<li>Select the <strong>Close Issue</strong> workflow transition.</li>
<li>Click on the <strong>Properties</strong> option.</li>
</ol>
<ol start="4">
<li>Enter <kbd>jira.field.resolution.include</kbd> for the <strong>Property Name</strong> and the IDs (comma separated) for resolutions we want to make available into <strong>Property Value</strong>. So, if we want to only include the <strong>Done</strong>, <strong>Won't Do</strong>, and <strong>Duplicate</strong> resolutions, we need to specify the <kbd>10000</kbd>, <kbd>10001</kbd>, and <kbd>10002</kbd> values as the property values, with no spaces in between.</li>
</ol>
<p>Take a look at the following screenshot:</p>
<div><img src="img/c3ac72cd-d530-46ac-a0cb-235e00d22750.png" style="width:30.42em;height:10.50em;"/></div>
<ol start="5">
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>Note that the actual values for the three resolutions might be different for your Jira instance. Please double-check their values when configuring the property.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>Other than selecting a subset of resolutions, there is also a <kbd>jira.field.resolution.exclude</kbd> property that lets you exclude a subset of resolutions from the global list.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Preventing issue updates in selected statuses</h1>
                
            
            
                
<p>By default, when an issue is in the Closed status, it cannot be updated. It is a good practice to make issues read-only when they are in a status that signifies logical completion.</p>
<p>In this recipe, we will make sure that, when an issue is moved to the Frozen status, it can no longer be updated until it is moved back to the Open status.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to make an issue read-only when it is in the Frozen status:</p>
<ol>
<li>Select and edit the workflow to update.</li>
<li>Select the <strong>Frozen</strong> workflow status.</li>
<li>Click on the <strong>Properties</strong> link from the panel on the right-hand side.</li>
<li>Enter <kbd>jira.issue.editable</kbd> for <strong>Property Key</strong> and <kbd>false</kbd> into <strong>Property Value</strong>, and click on <strong>Add</strong>.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Making a field required during a workflow transition</h1>
                
            
            
                
<p>Using field configuration to make a field required will make the field required all the time. There are many use cases where you will only need the field to be required during certain workflow transitions.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>For this recipe, we need to have the JSU Automation Suite for Jira Workflows app installed. You can download it from the following link, or install it directly using the UPM: <a href="https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities" target="_blank">https://marketplace.atlassian.com/plugins/com.googlecode.jira-suite-utilities</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p class="mce-root">Perform the following steps to make the Reason for Freezing field required during the Frozen transition:</p>
<ol>
<li>Select and edit the <strong>Simple Workflow</strong>.</li>
<li>Select <strong>Diagram</strong> mode.</li>
<li>Click on the <strong>Frozen</strong> global workflow transition.</li>
<li>Click on the <strong>Validators</strong> link from the panel on the right-hand side.</li>
<li>Click on <strong>Add validator</strong>, select Fields Required (JSU) from the list, and click on <strong>Add</strong>.</li>
</ol>
<ol start="6">
<li>Select the <strong>Reason for Freezing</strong> field from <strong>Available fields</strong> and click on <strong>Add &gt;&gt;</strong>. This will add the selected field to the <strong>Required fields</strong> list, as seen in the next screenshot:</li>
</ol>
<div><img src="img/aaf22fb1-bd39-473f-a9ff-40f1df191962.png" style="width:44.75em;height:33.50em;"/></div>
<ol start="7">
<li>Enter an optional error message if you would like to display a customized message instead of the default error message.</li>
<li>Click on the <strong>Add</strong> button to complete the validator setup.</li>
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>After you have added the validator, if you try to execute the Frozen transition without specifying a value for the Reason for Freezing field, Jira will prompt you with an error message, as shown in the following screenshot:</p>
<div><img src="img/cf1c465b-0fd0-4a34-9d3e-0f22cf3e34dd.png" style="width:46.17em;height:23.17em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating custom workflow transition logic</h1>
                
            
            
                
<p>In previous recipes, we have looked at using workflow conditions, validators, and post functions that come out of the box with Jira and from other third-party apps.</p>
<p>In this recipe, we will take a look at how to use scripts to define our own validation rules for a workflow validator. We will address a common use case, which is to make a field required during a workflow transition only when another field is set to a certain value.</p>
<p>So, our validation logic will be as follows:</p>
<ul>
<li>If the <strong>Resolution</strong> field is set to <strong>Done</strong>, the <strong>Solution Details</strong> field will be required.</li>
<li>If the <strong>Resolution</strong> field is set to a value other than <strong>Fixed</strong>, the <strong>Solution Details</strong> field will not be required.</li>
</ul>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>For this recipe, we need to have the ScriptRunner for Jira app installed. You can download it from the following link, or install it directly using the UPM: <a href="https://marketplace.atlassian.com/plugins/com.onresolve.jira.groovy.groovyrunner" target="_blank">https://marketplace.atlassian.com/plugins/com.onresolve.jira.groovy.groovyrunner</a>.</p>
<p>You might also want to get familiar with Groovy scripting (<a href="http://groovy.codehaus.org/" target="_blank">http://groovy.codehaus.org</a>).</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Perform the following steps to set up a validator with custom-scripted logic:</p>
<ol>
<li>Select and edit the <strong>Simple Workflow</strong>.</li>
<li>Select <strong>Diagram</strong> mode.</li>
<li>Click on the <strong>Done</strong> global workflow transition.</li>
<li>Click on the <strong>Validators</strong> link from the panel on the right-hand side.</li>
<li>Click on <strong>Add validator</strong>, select <strong>Script Validator</strong> [ScriptRunner] from the list, and click on <strong>Add</strong>.</li>
<li>Select the <strong>Simple scripted validator</strong> option.</li>
<li>Enter the following script code in the <strong>Condition</strong> text box:</li>
</ol>
<pre style="padding-left: 60px">import com.opensymphony.workflow.InvalidInputException<br/>import com.atlassian.jira.component.ComponentAccessor<br/>import com.atlassian.jira.issue.CustomFieldManager<br/>import org.apache.commons.lang3.StringUtils<br/><br/>def customFieldManager = ComponentAccessor.getCustomFieldManager()<br/>def solutionField = customFieldManager.getCustomFieldObjectByName("Solution Details")<br/>def resolution = issue.getResolution().getName()<br/>String solution = issue.getCustomFieldValue(solutionField)<br/><br/>if(resolution == "Done" &amp;&amp; StringUtils.isBlank(solution)) {<br/>    false<br/>} else {<br/>    true<br/>}</pre>
<ol start="8">
<li>Enter <kbd>You must provide the Solution Details if the Resolution is set to Done.</kbd> in the <strong>Error</strong> field.</li>
<li>Select <strong>Solution Details</strong> for <strong>Field</strong>.</li>
<li>Click on the <strong>Add</strong> button to complete the validator setup.</li>
</ol>
<ol start="11">
<li>Click on <strong>Publish Draft</strong> to apply the change.</li>
</ol>
<p>Your validator configuration should look something like the following screenshot:</p>
<div><img src="img/bf66327c-6a19-49eb-8724-bdc9abeabe2f.png" style="width:37.17em;height:42.58em;"/></div>
<p>Once we add our custom validator, the Groovy script will run every time the resolve issue transition is executed. If the Resolution field is set to Done and the Solution Details field is empty, we will get a message from the Error field, as shown in the following screenshot:</p>
<div><img src="img/5c221cfa-9a9b-4363-a6b3-071280a8136e.png" style="width:43.50em;height:26.50em;"/></div>
<p>We will now see how these steps work.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The Script Validator works just like any other validator, except that we can define our own validation logic using Groovy scripts. So, let's go through the script, and see what it does.</p>
<p>We first get the Solution Details custom field via its name, as shown in the following line of code. If you have more than one custom field with the same name, you need to use its ID instead of its name:</p>
<pre>def solutionField = customFieldManager.getCustomFieldObjectByName("Solution Details")</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>We then select the resolution value and obtain the value entered for Solution Details during the transition, as follows:</p>
<pre>def resolution = issue.getResolutionObject().getName() 
String solution = issue.getCustomFieldValue(solutionField) </pre>
<p>In our example, we check the resolution name; we can also check the ID of the resolution by changing <kbd>getName()</kbd> to <kbd>getId()</kbd>.</p>
<p>If you have multiple custom fields with the same name, use <kbd>getId()</kbd>.</p>
<p>Lastly, we check whether the <strong>Resolution</strong> value is <strong>Done</strong> and the <strong>Solution Details</strong> value is blank. In this case, we return a value of <kbd>false</kbd>, so the validation fails. All other cases will return the value <kbd>true</kbd>, so the validation passes. We also use <kbd>StringUtils.isBlank(solution)</kbd> to check for blank values so that we can catch cases when users enter empty spaces for the <strong>Solution Details</strong> field.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>You are not limited to creating scripted validators. With the ScriptRunner for Jira app, you can create scripted conditions and post functions using Groovy scripts.</p>


            

            
        
    </body></html>