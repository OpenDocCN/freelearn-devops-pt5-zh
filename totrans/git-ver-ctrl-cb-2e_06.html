<html><head></head><body>
        

                            
                    <h1 class="header-title">Extracting Data from the Repository</h1>
                
            
            
                
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Extracting the top contributor</li>
<li>Finding bottlenecks in the source tree</li>
<li>Grepping the commit messages</li>
<li>The contents of the releases</li>
<li>Finding what has been achieved in the repository in the last period</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Introduction</h1>
                
            
            
                
<p>Whether you work in big or small organizations, safeguarding and maintaining data is always important and it keeps track of a fair amount of information for you; it is just a matter of extracting the data. Some of the data is included in the system by you or any other developer when the commit message is filled in with the proper information – for instance, details of the bug you are fixing from the bug tracking system.</p>
<p>The data is not only valid for management but can also be used to add more time to refactor the C files, where almost all bugs are fixed.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Extracting the top contributor</h1>
                
            
            
                
<p>Git has a few built-in stats you can get instantaneously. The <kbd>git log</kbd> command has different options, such as <kbd>--numstat</kbd>, that will show the number of files added and lines deleted for each file since each commit. However, for finding the top committer in the repository, we can just use the <kbd>git shortlog</kbd> command.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>For all the examples throughout the book, we are using the <kbd>jgit</kbd> repository; you can either clone it or go to one of the clones you might already have.</p>
<p>Clone the <kbd>jgit</kbd> repository as follows:</p>
<pre><strong>$ git clone https://git.eclipse.org/r/jgit/jgit chapter6</strong> 
<strong>$ cd chapter6</strong> </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>The <kbd>shortlog</kbd> Git command is very simple and does not have a lot of options or flags to use with it. It can show the log but in a boiled-down version, and then it can summarize it for us as follows:</p>
<ol>
<li> Start by showing the last five commits with <kbd>shortlog</kbd>. We can use <kbd>-5</kbd> to limit the amount of output:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog -5</strong> 
<strong>Jonathan Nieder (1):</strong> 
<strong>  Update commons-compress to 1.6</strong> 
 
<strong>Matthias Sohn (2):</strong> 
<strong>  Update com.jcraft.jsch to 0.1.50 in Kepler target platform</strong> 
<strong>  Update target platforms to use latest orbit build</strong> 
 
<strong>SATO taichi (1):</strong> 
<strong>  Add git checkout --orphan implementation</strong> 
 
<strong>Stefan Lay (1):</strong> 
<strong>  Fix fast forward rebase with rebase.autostash=true</strong> </pre>
<ol start="2">
<li>As you can see, the output is very different from the <kbd>git log</kbd> output. You can try it for yourself with <kbd>git log -5</kbd>. The numbers in parentheses are the number of commits by that committer. Beneath the name and number are the commit titles of the commits. Note that no commit hashes are shown. To find the top committer with just those five commits is easy, but when you try running <kbd>git shortlog</kbd> without <kbd>-5</kbd>, it is hard to find that person. To sort and find the top committer, we can use the <kbd>-n</kbd> or <kbd>--numbered</kbd> option to sort the output; the top committer is on top:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog -5 --numbered</strong> 
<strong>Matthias Sohn (2):</strong> 
<strong>      Update com.jcraft.jsch to 0.1.50 in Kepler target platform</strong> 
<strong>      Update target platforms to use latest orbit build</strong> 
 
<strong>Jonathan Nieder (1):</strong> 
<strong>      Update commons-compress to 1.6</strong> 
 
<strong>SATO taichi (1):</strong> 
<strong>      Add git checkout --orphan implementation</strong> 
 
<strong>Stefan Lay (1):</strong> 
<strong>      Fix fast forward rebase with rebase.autostash=true</strong> </pre>
<ol start="3">
<li> As you can see, the output is nicely sorted. If we don't care about the commit subjects, we can use <kbd>-s</kbd> or <kbd>--summary</kbd> to only show the commit count for each developer as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog -5 --numbered --summary</strong> 
<strong>     2  Matthias Sohn</strong> 
<strong>     1  Jonathan Nieder</strong> 
<strong>     1  SATO taichi</strong> 
<strong>     1  Stefan Lay</strong> </pre>
<ol start="4">
<li>Finally, we have what we want, except that we don't have the email addresses of the committers; this option is also available with <kbd>-e</kbd> or <kbd>--email</kbd>. This will also show the email addresses of the committers in the list. This time, we will try it on the entire repository. Currently, we have only listed it for the HEAD commit. To list it for the repository, we need to add <kbd>--all</kbd> at the end of the command so as to execute the command for all branches as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog  --numbered --summary --email --all</strong> 
<strong>   765  Shawn O. Pearce &lt;spearce@spearce.org&gt;</strong> 
<strong>   399  Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>   360  Robin Rosenberg &lt;robin.rosenberg@dewire.com&gt;</strong> 
<strong>   181  Chris Aniszczyk &lt;caniszczyk@gmail.com&gt;</strong> 
<strong>   172  Shawn Pearce &lt;spearce@spearce.org&gt;</strong> 
<strong>   160  Christian Halstrick &lt;christian.halstrick@sap.com&gt;</strong> 
<strong>   114  Robin Stocker &lt;robin@nibor.org&gt;</strong></pre>
<ol start="5">
<li>So, this is the list now; we know who contributed with the most commits, but this picture can be a little skewed, as the top committer may just happen to be the creator of the project and may not actively contribute to the repository. So, to list the top committers for the last six months, we can add <kbd>--since="6 months ago"</kbd> to the <kbd>git shortlog</kbd> command as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog  --numbered --summary --email --all --since="6 months ago"</strong> 
<strong>    73  Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>    15  Robin Stocker &lt;robin@nibor.org&gt;</strong> 
<strong>    14  Robin Rosenberg &lt;robin.rosenberg@dewire.com&gt;</strong> 
<strong>    13  Shawn Pearce &lt;sop@google.com&gt;</strong> 
<strong>    12  Stefan Lay &lt;stefan.lay@sap.com&gt;</strong> 
<strong>     8  Christian Halstrick &lt;christian.halstrick@sap.com&gt;</strong> 
<strong>     7  Colby Ranger &lt;cranger@google.com&gt;</strong> </pre>
<ol start="6">
<li>As you can see, the picture has changed since the start of the repository.</li>
</ol>
<p>You can use <em>"n weeks ago"</em>, <em>"n days ago"</em>, <em>"n months ago"</em>, <em>" n hours ago"</em>, and so on for specifying time periods. You can also use specific dates, such as <kbd>"1 october 2013"</kbd>.</p>
<p style="padding-left: 60px">You can also list the top committer for a specific month using the <kbd>--until</kbd> option, where you can specify the date you wish to list the commit until. This can be done as follows:</p>
<pre style="padding-left: 60px"><strong>$ git shortlog  --numbered --summary --email --all --since="30 september 2013" --until="1 november 2013"</strong> 
<strong>    15  Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>     4  Kaloyan Raev &lt;kaloyan.r@zend.com&gt;</strong> 
<strong>     4  Robin Rosenberg &lt;robin.rosenberg@dewire.com&gt;</strong> 
<strong>     3  Colby Ranger &lt;cranger@google.com&gt;</strong> 
<strong>     2  Robin Stocker &lt;robin@nibor.org&gt;</strong> 
<strong>     1  Christian Halstrick &lt;christian.halstrick@sap.com&gt;</strong> 
<strong>     1  Michael Nelson &lt;michael.nelson@tasktop.com&gt;</strong> 
<strong>     1  Rüdiger Herrmann &lt;ruediger.herrmann@gmx.de&gt;</strong> 
<strong>     1  Tobias Pfeifer &lt;to.pfeifer@web.de&gt;</strong> 
<strong>     1 Tomasz Zarna &lt;tomasz.zarna@tasktop.com&gt;</strong> </pre>
<ol start="7">
<li>As you can see, we get another list, and it seems like Matthias is the main contributor, at least compared to the initial result. These types of data can also be used to visualize the shift of responsibility in a repository by collecting the data for each month since the repository's initialization.</li>
</ol>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>While working with code, it is often useful to know who to go to when you need to perform a fix in the software, especially in an area where you are inexperienced. So, it would be nice to figure out who is the code owner of the file or the files you are changing. The obvious reason is to get some input on the code, but also to know who to go to for a code review. You can again use <kbd>git shortlog</kbd> to figure this out. You can use the command on the files as well:</p>
<ol>
<li>To do this, we simply add the file to the end of the <kbd>git shortlog</kbd> command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog  --numbered --summary --email ./pom.xml</strong> 
<strong>    86  Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>    21  Shawn O. Pearce &lt;spearce@spearce.org&gt;</strong> 
<strong>     4  Chris Aniszczyk &lt;caniszczyk@gmail.com&gt;</strong> 
<strong>     4  Jonathan Nieder &lt;jrn@google.com&gt;</strong> 
<strong>     3  Igor Fedorenko &lt;igor@ifedorenko.com&gt;</strong> 
<strong>     3  Kevin Sawicki &lt;kevin@github.com&gt;</strong> 
<strong>     2  Colby Ranger &lt;cranger@google.com&gt;</strong> </pre>
<ol start="2">
<li>As for <kbd>pom.xml</kbd>, we also have a top committer. As all the options you have for <kbd>git log</kbd> are available for <kbd>shortlog</kbd>, we can also do this on a directory as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git shortlog  --numbered --summary --email org.eclipse.jgit.lfs.server.test</strong>
<strong>    35 Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong><br/><strong>    20 David Pursehouse &lt;david.pursehouse@gmail.com&gt;</strong><br/><strong>     4 Markus Duft &lt;markus.duft@ssi-schaefer.com&gt;</strong><br/><strong>     2 Saša Živkov &lt;sasa.zivkov@sap.com&gt;</strong><br/><strong>     1 David Ostrovsky &lt;david@ostrovsky.org&gt;</strong><br/><strong>     1 Mat Booth &lt;mat.booth@redhat.com&gt;</strong><br/><strong>     1 Karsten Thoms &lt;karsten.thoms@itemis.de&gt;</strong></pre>
<ol start="3">
<li> As you can see, it is fairly simple to get some indication of who to go to for the different files or directories in Git.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Finding bottlenecks in the source tree</h1>
                
            
            
                
<p>Often, the development teams know where the bottleneck in the source tree is, but it can be challenging to convince the management that you need resources to rewrite some code. However, with Git, it is fairly simple to extract that type of data from the repository.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Start by checking out the stable-3.1 release as follows:</p>
<pre><strong>$ git checkout stable-3.1</strong> 
<strong>Branch stable-3.1 set up to track remote branch stable-3.1 from origin.</strong> 
<strong>Switched to a new branch 'stable-3.1'</strong> </pre>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>We want to start by listing some stats for one commit, and then we can extend the examples to larger chunks of commits:</p>
<ol>
<li>The first option we will be using is <kbd>--dirstat</kbd> for <kbd>git log</kbd> as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log -1 --dirstat</strong> 
<strong>commit da6e87bc373c54c1cda8ed563f41f65df52bacbf</strong> 
<strong>Author: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>Date:   Thu Oct 3 17:22:08 2013 +0200</strong> 
 
<strong>    Prepare post 3.1.0 builds</strong> 
 
<strong>    Change-Id: I306a3d40c6ddb88a16d17f09a60e3d19b0716962</strong> 
<strong>    Signed-off-by: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
 
<strong>   5.0% org.eclipse.jgit.http.server/META-INF/</strong> 
<strong>   6.9% org.eclipse.jgit.http.test/META-INF/</strong> 
<strong>   3.3% org.eclipse.jgit.java7.test/META-INF/</strong> 
<strong>   4.3% org.eclipse.jgit.junit.http/META-INF/</strong> 
<strong>   6.6% org.eclipse.jgit.junit/META-INF/</strong> 
<strong>   5.5% org.eclipse.jgit.packaging/</strong> 
<strong>   5.9% org.eclipse.jgit.pgm.test/META-INF/</strong> 
<strong>  13.7% org.eclipse.jgit.pgm/META-INF/</strong> 
<strong>  15.4% org.eclipse.jgit.test/META-INF/</strong> 
<strong>   3.7% org.eclipse.jgit.ui/META-INF/</strong> 
<strong>  13.1% org.eclipse.jgit/META-INF/</strong></pre>
<p class="mce-root"/>
<ol start="2">
<li> The <kbd>--dirstat</kbd> option shows which directories have changed in the commit and how much they have changed compared to each other. The default setting is to count the number of lines added to or removed from the commit. So, rearranging the code potentially does not count for any change, as the line count might be the same. You can compensate for this slightly by using <kbd>--dirstat=lines</kbd>. This option will look at each file line by line and see whether they have changed compared to the previous version as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log -1 --dirstat=lines</strong> 
<strong>commit da6e87bc373c54c1cda8ed563f41f65df52bacbf</strong> 
<strong>Author: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>Date:   Thu Oct 3 17:22:08 2013 +0200</strong> 
 
<strong>    Prepare post 3.1.0 builds</strong> 
 
<strong>    Change-Id: I306a3d40c6ddb88a16d17f09a60e3d19b0716962</strong> 
<strong>    Signed-off-by: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 

<strong>   4.8% org.eclipse.jgit.http.server/META-INF/</strong> 
<strong>   6.5% org.eclipse.jgit.http.test/META-INF/</strong> 
<strong>   3.2% org.eclipse.jgit.java7.test/META-INF/</strong> 
<strong>   4.0% org.eclipse.jgit.junit.http/META-INF/</strong> 
<strong>   6.1% org.eclipse.jgit.junit/META-INF/</strong> 
<strong>   6.9% org.eclipse.jgit.packaging/</strong> 
<strong>   5.7% org.eclipse.jgit.pgm.test/META-INF/</strong> 
<strong>  13.0% org.eclipse.jgit.pgm/META-INF/</strong> 
<strong>  14.6% org.eclipse.jgit.test/META-INF/</strong> 
<strong>   3.6% org.eclipse.jgit.ui/META-INF/</strong> 
<strong>  13.8% org.eclipse.jgit/META-INF/</strong> </pre>
<ol start="3">
<li>This also gives a slightly different result. If you would like to limit the output to only show directories with a certain percentage or higher, we can limit the output as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log -1 --dirstat=lines,10</strong> 
<strong>commit da6e87bc373c54c1cda8ed563f41f65df52bacbf</strong> 
<strong>Author: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>Date:   Thu Oct 3 17:22:08 2013 +0200</strong> 
 
<strong>    Prepare post 3.1.0 builds</strong> <br/><strong>    Change-Id: I306a3d40c6ddb88a16d17f09a60e3d19b0716962</strong> 
<strong>    Signed-off-by: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
 
<strong>  13.0% org.eclipse.jgit.pgm/META-INF/</strong> 
<strong>  14.6% org.eclipse.jgit.test/META-INF/</strong> 
<strong>  13.8% org.eclipse.jgit/META-INF/</strong></pre>
<p class="mce-root"/>
<ol start="4">
<li>By adding <kbd>10</kbd> to the <kbd>--dirstat=lines</kbd> command, we are asking Git to only show the directories that have 10 percent or higher changes; you can use any number you like here. By default, Git does not count the changes in the subdirectories, but only the files in the directory. So, in the following diagram, only changes in <strong>File A1</strong> are counted as changes; for the <strong>Dir A1</strong> directory and the <strong>File B1</strong> file, it is counted as a change in <strong>Dir A2</strong>:</li>
</ol>
<div><img class="alignnone size-full wp-image-245 image-border" src="img/31fd16f6-6591-4ea4-b2bc-252f7dd058f3.png" style="width:10.17em;height:15.42em;"/></div>
<ol start="5">
<li>To cumulate this, we can add <kbd>cumulative</kbd> to the <kbd>--dirstat=lines,10</kbd> command, and this will cumulate the changes and calculate a percentage.<br/>
Be aware that the percentage can go beyond 100 due to the way it is calculated:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log -1 --dirstat=files,10,cumulative</strong> 
<strong>commit da6e87bc373c54c1cda8ed563f41f65df52bacbf</strong> 
<strong>Author: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
<strong>Date:   Thu Oct 3 17:22:08 2013 +0200</strong> 
 
<strong>    Prepare post 3.1.0 builds</strong> 
 
<strong>    Change-Id: I306a3d40c6ddb88a16d17f09a60e3d19b0716962</strong> 
<strong>    Signed-off-by: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong> 
 
<strong>  31.3% org.eclipse.jgit.packaging/</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="6">
<li>As you can see, the output is slightly different from what we have seen earlier. By using <kbd>git log --dirstat</kbd>, you can get some information about what goes on in the repository. Obviously, you can also do this for all the commits between two releases or two commit hashes. Let's try this, but instead of using <kbd>git log</kbd>, we will be using <kbd>git diff</kbd>, as Git will show the accumulated <kbd>diff</kbd> between the two releases, and <kbd>git log</kbd> will show <kbd>dirstat</kbd> for each commit between the releases:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git diff  origin/stable-3.1..origin/stable-3.2 --dirstat</strong> 
<strong>   4.0% org.eclipse.jgit.packaging/org.eclipse.jgit.target/</strong> 
<strong>   3.9% org.eclipse.jgit.pgm.test/tst/org/eclipse/jgit/pgm/</strong> 
<strong>   4.1% org.eclipse.jgit.pgm/</strong> 
<strong>  20.7% org.eclipse.jgit.test/tst/org/eclipse/jgit/api/</strong> 
<strong>  21.3% org.eclipse.jgit.test/tst/org/eclipse/jgit/internal/storage/file/</strong> 
<strong>   5.2% org.eclipse.jgit.test/tst/org/eclipse/jgit/</strong> 
<strong>  14.5% org.eclipse.jgit/src/org/eclipse/jgit/api/</strong> 
<strong>   6.5% org.eclipse.jgit/src/org/eclipse/jgit/lib/</strong> 
<strong>   3.9% org.eclipse.jgit/src/org/eclipse/jgit/transport/</strong> 
<strong>   4.6% org.eclipse.jgit/src/org/eclipse/jgit/</strong> </pre>
<ol start="7">
<li>So, between the <kbd>origin/stable-3.1</kbd> and <kbd>origin/stable-3.2</kbd> branches, we can see which directories have the highest percentage of changes. We can then dig a little deeper using <kbd>--stat</kbd> or <kbd>--numstat</kbd> for the directory, and again use <kbd>git diff</kbd>. We will also use <kbd>--relative="org.eclipse.jgit.test/tst/org/eclipse/"</kbd>, which will show the relative path of the files from <kbd>org.eclipse.jgit.test/tst/org/eclipse/</kbd>. This will look better on the console. Feel free to try this without using the following option:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git diff --pretty  origin/stable-3.1..origin/stable-3.2 --numstat  --relative</strong><strong>="org.eclipse.jgit.test/tst/org/eclipse/jgit/internal/"  org.eclipse.jgit.test/</strong> 

<strong>tst/org/eclipse/jgit/internal/</strong> 
<strong>4       2       storage/file/FileRepositoryBuilderTest.java</strong> 
<strong>8       1       storage/file/FileSnapshotTest.java</strong> 
<strong>0       741     storage/file/GCTest.java</strong> 
<strong>162     0       storage/file/GcBasicPackingTest.java</strong> 
<strong>119     0       storage/file/GcBranchPrunedTest.java</strong> 
<strong>119     0       storage/file/GcConcurrentTest.java</strong> 
<strong>85      0       storage/file/GcDirCacheSavesObjectsTest.jav</strong> 
<strong>104     0       storage/file/GcKeepFilesTest.java</strong> 
<strong>180     0       storage/file/GcPackRefsTest.java</strong> 
<strong>120     0       storage/file/GcPruneNonReferencedTest.java</strong> 
<strong>146     0       storage/file/GcReflogTest.java</strong> 
<strong>78      0       storage/file/GcTagTest.java</strong> 
<strong>113     0       storage/file/GcTestCase.java</strong> </pre>
<ol start="8">
<li>The first number is the number of lines added, and the second number is the lines removed from the files between the two branches.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>We have used <kbd>git log</kbd>, <kbd>git diff</kbd>, and <kbd>git shortlog</kbd> to find information about the repository, but there are so many options for those commands on how to find bottlenecks in the source code.</p>
<p>If we want to find the files with the most commits, and these are not necessarily the files with the most line additions or deletions, we can use <kbd>git log</kbd>:</p>
<ol>
<li> We can use <kbd>git log</kbd> between the <kbd>origin/stable-3.1</kbd> and <kbd>origin/stable-3.2</kbd> branches and list all the files changed in each commit.<br/>
Then, we just need to sort and accumulate the result with some Bash tools as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log origin/stable-3.1..origin/stable-3.2 --format=format: --name-only</strong> 
 
<strong>org.eclipse.jgit.ant.test/META-INF/MANIFEST.MF</strong> 
<strong>org.eclipse.jgit.ant.test/pom.xml</strong> </pre>
<ol start="2">
<li> First, we are just executing the command without the use of the Bash tools. You can see from the extensive output that you only see file names and nothing else. This is due to the options used. The <kbd>--format=format:</kbd> option tells Git to not display any commit-message-related information, and <kbd>--name-only</kbd> tells Git to list the files for each commit. Now, all we have to do is count them:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log origin/stable-3.1..origin/stable-3.2 --format=format: --name-only | sed '/^$/d'  | sort | uniq -c | sort -r | head -10</strong> 
<strong>     12 se.jgit/src/org/eclipse/jgit/api/RebaseCommand.java</strong> 
<strong>     12 est/tst/org/eclipse/jgit/api/RebaseCommandTest.java</strong> 
<strong>      9 org.eclipse.jgit/META-INF/MANIFEST.MF</strong> 
<strong>      7 org.eclipse.jgit.pgm.test/META-INF/MANIFEST.MF</strong> 
<strong>      7 org.eclipse.jgit.packaging/pom.xml</strong> 
<strong>      6 pom.xml</strong> 
<strong>      6 pse.jgit/src/org/eclipse/jgit/api/RebaseResult.java</strong> 
<strong>      6 org.eclipse.jgit.test/META-INF/MANIFEST.MF</strong> 
<strong>      6 org/eclipse/jgit/pgm/internal/CLIText.properties</strong> 
<strong>      6 org.eclipse.jgit.pgm/META-INF/MANIFEST.MF</strong> </pre>
<ol start="3">
<li>Now, we have a list of the top ten files between the two releases, but before we proceed further, let's just go through what we did. We got the list of files, and we used <kbd>sed '/^$/d'</kbd> to remove empty lines from the output. After this, we used <kbd>sort</kbd> to sort the list of files. Then, we used <kbd>uniq -c</kbd>, which counts the occurrences of each item in the files and adds the number from the output. Finally, we sorted in reverse order using <kbd>sort -r</kbd> and displayed only the top ten results using <kbd>head 10</kbd>. To proceed from here, we should list all the commits between the branches that are changing the top file as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log origin/stable-3.1..origin/stable-3.2 \\<br/>  org.eclipse.jgit/src/org/eclipse</strong><strong>/jgit/api/RebaseCommand.java</strong> 

<strong>commit e90438c0e867bd105334b75df3a6d640ef8dab01</strong> 
<strong>Author: Stefan Lay &lt;stefan.lay@sap.com&gt;</strong> 
<strong>Date:   Tue Dec 10 15:54:48 2013 +0100</strong> 
 
<strong>    Fix aborting rebase with detached head</strong> 
 
<strong>    Bug: 423670</strong> 
<strong>    Change-Id: Ia6052867f85d4974c4f60ee5a6c820501e8d2427</strong> 
 
<strong>commit f86a488e32906593903acb31a93a82bed8d87915</strong> </pre>
<ol start="4">
<li>By adding the file to the end of the <kbd>git log</kbd> command, we will see the commits between the two branches. Now, all we have to do is to grep commits that have the bug, so we can tell our manager the number of bugs we fixed in this file.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Grepping the commit messages</h1>
                
            
            
                
<p>Now we know how to list and sort files that we make frequent changes to and vice versa, but we are also interested in finding out the bugs that we are fixing, the features that we are implementing, and perhaps who is signing the code. All this information is usually available in the commit message. Some companies have a policy that you need to have a referral to a bug, a feature, or some other reference in the commit message. By having this information in the commit message, it is a lot easier to produce a nice release note as well.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>As we will mostly be grepping the Git database in these examples, we really don't need to check something out or be at a specific commit for this example. So, if you are still lurking around in the <kbd>chapter6</kbd> folder, we can continue.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>Let's see how many commits in the repository are referring to a bug:</p>
<ol>
<li> First of all, we need to know the pattern for bugs referred to in the commit messages. I did this by looking in the commits, and the pattern for <kbd>jgit</kbd> is to use <kbd>Bug: 6 digits</kbd>; so, to find all of these commits, we use the <kbd>--grep</kbd> option for <kbd>git log</kbd>, and we can grep for <kbd>"[Bb][Uu][gG]: [0-9]+"</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --grep="^[bB][uU][gG]: [0-9]"</strong> 
<strong>commit 3db6e05e52b24e16fbe93376d3fd8935e5f4fc9b</strong> 
<strong>Author: Stefan Lay &lt;stefan.lay@sap.com&gt;</strong> 
<strong>Date:   Wed Jan 15 13:23:49 2014 +0100</strong> 
 
<strong>    Fix fast forward rebase with rebase.autostash=true</strong> 
 
<strong>    The folder .git/rebase-merge was not removed in this case. The</strong> 
<strong>    repository was then still in rebase state, but neither abort nor</strong> 
<strong>    continue worked.</strong> 
 
<strong>    Bug: 425742</strong> 
<strong>    Change-Id: I43cea6c9e5f3cef9d6b15643722fddecb40632d9</strong> </pre>
<ol start="2">
<li>You should get a lot of commits as output, but you should notice that all the commits have a referral to a bug ID. So what was the grep doing? The <kbd>^[Bb][Uu][gG]:</kbd> part matches any combination of lowercase and uppercase bugs. The <kbd>^</kbd> character means from the beginning of the line. The <kbd>:</kbd> character is matching <kbd>:</kbd>. Then, we have <kbd>[0-9]+</kbd>, which will match any number between zero and nine, and the <kbd>+</kbd> part means one or more occurrences. But enough with regular expressions for grep. We have a lot of output (which is valuable), but for now, we just want to count the commits. We can do this by piping it to <kbd>wc -l</kbd> (word count <kbd>-l</kbd> is to count the lines):</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --oneline --grep="^[bB][uU][gG]: [0-9]+" | wc -l</strong> 

<strong>    366</strong></pre>
<ol start="3">
<li>Before piping it to <kbd>wc</kbd>, remember to use <kbd>--oneline</kbd> to limit the output to one line for each commit. As you can see, when I was writing this, <kbd>jgit</kbd> has reference to <kbd>366</kbd> bugs that have all been fixed and released into the repository. If you are used to using regular expressions in another scripting or programming language, you will see that using <kbd>--grep</kbd> does not support everything. You can enable a more extensive regular expression support using the <kbd>--extended-regexp</kbd> option for <kbd>git log</kbd>; however, the pattern still has to be used with <kbd>--grep</kbd> as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --oneline  --extended-regexp --grep="^[bB][uU][gG]: [0-9]{6}"</strong> 

<strong>3db6e05 Fix fast forward rebase with rebase.autostash=true</strong> 
<strong>c6194c7 Update com.jcraft.jsch to 0.1.50 in Kepler target platform</strong> 
<strong>1def0a1 Fix for core.autocrlf=input resulting in modified file and unsmudge</strong> 
<strong>0ce61ca Canonicalize worktree path in BaseRepositoryBuilder if set via config</strong> 
<strong>e90438c Fix aborting rebase with detached head</strong> 
<strong>2e0d178 Add recursive variant of Config.getNames() methods</strong> </pre>
<ol start="4">
<li>We have used it in the preceding example, and you can see that we are getting the same commits. I have used a slightly different expression, and have now added <kbd>{6}</kbd> instead of <kbd>+</kbd>; the <kbd>{6}</kbd> searches for six occurrences of the associated pattern. In our case, it is six digits as it is next to the <kbd>[0-9]</kbd> pattern. We can verify by counting the lines or commits again with <kbd>wc -l</kbd> as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --oneline  --extended-regexp --grep="^[bB][uU][gG]: [0-9]{6}" | wc -l</strong> 

<strong>    366</strong> </pre>
<ol start="5">
<li>We get the same number. To shrink the regular expression even more, we can use <kbd>--regexp-ignore-case</kbd>, which will ignore the case for the pattern:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --oneline  --regexp-ignore-case --extended-regexp --grep="^bug: [0-9]{6}"</strong> 

<strong>3db6e05 Fix fast forward rebase with rebase.autostash=true</strong> 
<strong>c6194c7 Update com.jcraft.jsch to 0.1.50 in Kepler target platform</strong> 
<strong>1def0a1 Fix for core.autocrlf=input resulting in modified file and unsmudge</strong> 
<strong>0ce61ca Canonicalize worktree path in BaseRepositoryBuilder if set via config</strong> 
<strong>e90438c Fix aborting rebase with detached head</strong> 
<strong>2e0d178 Add recursive variant of Config.getNames() methods</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<ol start="6">
<li>Now we have the exact same output, and we no longer have <kbd>[bB][uU][Gg]</kbd> but just <kbd>bug</kbd>.</li>
</ol>
<p>Now you know how to grep the commit messages for information, and you can grep for anything in the commit message and list all the commits where the regular expression matches.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">The contents of the releases</h1>
                
            
            
                
<p>While extracting information from Git, one of the natural things to do is to generate release notes. To generate a release note, you need all the valid information from the repository between this release and the previous release.</p>
<p>We can utilize some of the methods we have used earlier to generate the data we want.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>We start by listing the commits between two tags, <kbd>v2.3.1.201302201838-r</kbd> and <kbd>v3.0.0.201305080800-m7</kbd>, and then we build on that information:</p>
<ol>
<li>By using <kbd>git log</kbd> with <kbd>v3.0.0.201305080800-m7.. v3.0.0.201305080800-m7</kbd>, we will get the commits between the tags:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --oneline v2.3.1.201302201838-r..v3.0.0.201305080800-m7</strong> 

<strong>00108d0 JGit v3.0.0.201305080800-m7</strong> 
<strong>e27993f Add missing @since tags</strong> 
<strong>d7cc6eb Move org.eclipse.jgit.pgm's resource bundle to internal package</strong> 
<strong>75e1bdb Merge "URIish: Allow multiple slashes in paths"</strong> 
<strong>b032623 Remove unused repository field from RevWalk</strong> 
<strong>a626f9f Merge "Require a DiffConfig when creating a FollowFilter"</strong> </pre>
<ol start="2">
<li> As we have a lot of commits between these two tags, let's count them using <kbd>wc -l</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --oneline v2.3.1.201302201838-r..v3.0.0.201305080800-m7 | wc -l</strong> 

<strong>    211</strong></pre>
<ol start="3">
<li>There are <kbd>211</kbd> commits between the tags. Now, we will show the most modified files between the releases:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log  v2.3.1.201302201838-r..v3.0.0.201305080800-m7  --format=format: --name-only | sed '/^$/d'  | sort | uniq -c | sort -r | head -10</strong> 

<strong>     11 org.eclipse.jgit/src/org/eclipse/jgit/internal/st</strong> 
<strong>     10 org.eclipse.jgit/src/org/eclipse/jgit/internal/sto</strong> 
<strong>     10 org.eclipse.jgit.pgm/resources/org/eclipse/jgit/p</strong> 
<strong>      9 org.eclipse.jgit.test/META-INF/MANIFEST.MF</strong> 
<strong>      8 pom.xml</strong> 
<strong>      8 org.eclipse.jgit/src/org/eclipse/jgit/storage/pac</strong> 
<strong>      8 org.eclipse.jgit/src/org/eclipse/jgit/internal/sto</strong> 
<strong>      8 org.eclipse.jgit.pgm/src/org/eclipse/jgit/pgm/CLI</strong> 
<strong>      7 org.eclipse.jgit/src/org/eclipse/jgit/storage/dfs/D</strong> 
<strong>      7 org.eclipse.jgit/src/org/eclipse/jgit/storage/dfs/D</strong> </pre>
<ol start="4">
<li>This information is useful as we now have an overview of where the majority of the changes are. Then, we can find the commit that refers to bugs so we can list the bug IDs:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --format=format:%h --regexp-ignore-case  --extended-regexp --grep="bug: [0-9]{6}"  v2.3.1.201302201838-r..v3.0.0.201305080800-m7 | xargs -n1 git log -1 | grep --ignore-case -E "commit [0-9a-f]{40}|bug:"</strong> 

<strong>commit e8f720335f86198d4dc99af10ffb6f52e40ba06f</strong> 
<strong>    Bug: 406722</strong> 
<strong>commit f448d62d29acc996a97ffbbdec955d14fde5c254</strong> 
<strong>    Bug: 388095</strong> 
<strong>commit 68b378a4b5e08b80c35e6ad91df25b1034c379a3</strong> 
<strong>    Bug: 388095</strong> 
<strong>commit 8bd1e86bb74da17f18272a7f2e8b6857c800a2cc</strong> 
<strong>    Bug: 405558   </strong> 
<strong>commit 37f0e324b5e82f55371ef8adc195d35f7a196c58</strong> 
<strong>    Bug: 406722</strong> 
<strong>commit 1080cc5a0d67012c0ef08d9468fbbc9d90b0c238</strong> 
<strong>    Bug: 403697</strong> 
<strong>commit 7a42b7fb95ecd2c132b2588e5ede0f1251772b30</strong> 
<strong>    Bug: 403282</strong> 
<strong>commit 78fca8a099bd2efc88eb44a0b491dd8aecc222b0</strong> 
<strong>    Bug: 405672</strong> 
<strong>commit 4c638be79fde7c34ca0fcaad13d7c4f1d9c5ddd2</strong> 
<strong>    Bug: 405672</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<ol start="5">
<li>So, what we have here is a nice list of the bugs being fixed and their corresponding commit hashes.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>We are using some Bash tools to get this list of fixed bugs. I will briefly explain what they are doing in this section:</p>
<ul>
<li>The <kbd>xargs -n1 git log -1</kbd> part will execute <kbd>git log -1</kbd> on each commit coming from the first <kbd>git log</kbd> command, <kbd>git log --format=format:%h --regexp-ignore-case --extended-regexp --grep="bug: [0-9]{6}" v2.3.1.201302201838-r..v3.0.0.201305080800-m7</kbd>.</li>
<li>The <kbd>grep --ignore-case -E "commit [0-9a-f]{40}|bug:"</kbd> part will ignore the case in the regular expression and <kbd>-E</kbd> will enable an extended regular expression. You might see that a lot of these options for the tool grep are the same options we have for git log. The regular expression is matching commit and 40 characters with the <kbd>[0-9a-f]</kbd> range or bug. The <kbd>|</kbd> character means or. Remember we are in the output from <kbd>git log -1</kbd>.</li>
</ul>
<p>All of this information we have extracted is the basis for a good, solid release note, with information on what has changed from one release to another.</p>
<p>The next natural step would be to look into the bug tracking system and also list the titles for each error being fixed in the commits. However, that is not something we will go through here as it all depends on the system you are using.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Finding what has been achieved in the repository in the last period</h1>
                
            
            
                
<p>Sometimes it's useful to be able to extract what has been achieved in a specific range of time. Let's see how <kbd>git log</kbd> numerous arguments can help with this task.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Let's say we want to know everything that has been done in the last 30 days in the <kbd>jgit</kbd> repository that we have been analyzing so far:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --since="30 days ago"</strong><br/><strong>commit 6efedb41c6fe3fc6eb88f49afc3e7f481514e806 (HEAD -&gt; master, origin/master, origin/HEAD)</strong><br/><strong>Author: Jonathan Nieder &lt;jrn@google.com&gt;</strong><br/><strong>Date: Wed May 2 15:23:31 2018 -0700</strong><br/><br/><strong>    Mark CrissCrossMergeTest as flaky</strong><br/><br/><strong>    It often fails on my machine, both in maven and bazel.</strong><br/><br/><strong>    This patch marks the test flaky[1] in bazel so that "bazel test" can</strong><br/><strong>    run it a few times before declaring failure.</strong><br/><br/><strong>    [1] https://docs.bazel.build/versions/master/be/common-definitions.html#test.flaky</strong><br/><br/><strong>    Bug: 534285</strong><br/><strong>    Change-Id: Ibe5414fefbffe4e8f86af7047608d51cf5df5c47</strong><br/><br/><strong>commit 5f2ddc8ac0528f2fc9776be822568dff3f065670</strong><br/><strong>Merge: b1f8ddfb7 3d89622d4</strong><br/><strong>Author: Matthias Sohn &lt;matthias.sohn@sap.com&gt;</strong><br/><strong>Date: Sat May 5 19:44:26 2018 -0400</strong><br/><br/><strong>    Merge "Add API filter for "non-API type FileRepository" in tests"</strong><br/><br/><strong>commit 3d89622d4e32eb24c203b71f4cce49e35dff8e09</strong><br/><strong>Author: David Pursehouse &lt;david.pursehouse@gmail.com&gt;</strong><br/><strong>Date: Thu Apr 12 10:53:29 2018 +0900</strong><br/><br/><strong>    Add API filter for "non-API type FileRepository" in tests</strong><br/><br/><strong>    Change-Id: If805ad4a962e48dd16fbc7eff915fd6539839933</strong><br/><strong>    Signed-off-by: David Pursehouse &lt;david.pursehouse@gmail.com&gt;</strong><br/><br/><strong>[...]</strong></pre>
<p style="padding-left: 60px">Here, we use <kbd>--all</kbd> in order to see the commits in all the branches and not only the current one. We also use <kbd>--since</kbd> as illustrated previously during this chapter.</p>
<ol start="2">
<li>Now, let's only show the commits by <kbd>David Pursehouse</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --since="30 days ago" --oneline --author="David Pursehouse"</strong><br/><strong>3d89622d4 Add API filter for "non-API type FileRepository" in tests</strong><br/><strong>9fb724f1b RefDatabase: add hasRefs convenience method</strong><br/><strong>4dcf2f93d RefDatabase: Introduce getAllRefs method</strong><br/><strong>57f158632 RefDatabase: Update Javadoc for ALL constant</strong><br/><strong>20d431f79 LargePackedWholeObject#openStream: Suppress resource warning</strong><br/><strong>7575cab53 Upgrade error_prone_core to 2.3.1</strong><br/><strong>cbb2e65db PushProcess: Remove unused import of HashMap</strong><br/><strong>5b0129641 Merge "Push: Ensure ref updates are processed in input order"</strong><br/><strong>e5ba2c9bd DirCache: Use constant from StandardCharsets</strong><br/><strong>ec84767c3 Use Constants.CHARACTER_ENCODING in tests</strong><br/><strong>b0ac5f9c8 LargePackedWholeObject: Refactor to open DfsReader in try-with-resource</strong><br/><strong>045799f2e Merge branch 'stable-4.11'</strong></pre>
<p style="padding-left: 60px">We used <kbd>--author</kbd> to specify the desired commit author and <kbd>--oneline</kbd> to condense the output to a more manageable format.</p>
<p>If you're looking for your own commits you can pass your name to <kbd>--author</kbd>, but if you are writing a script or an alias and you want it to be portable, you can, at least on Linux and macOS, use a subshell to retrieve the information automatically: <kbd>--author=$(git config user.name)</kbd>.</p>
<ol start="3">
<li>It looks like some merge commits are present. These are not really useful to describe the activity of the last month, so let's get rid of those with <kbd>--no-merges</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ git log --all --since="30 days ago" --oneline --author="David Pursehouse" --no-merges</strong><br/><strong>3d89622d4 Add API filter for "non-API type FileRepository" in tests</strong><br/><strong>9fb724f1b RefDatabase: add hasRefs convenience method</strong><br/><strong>4dcf2f93d RefDatabase: Introduce getAllRefs method</strong><br/><strong>57f158632 RefDatabase: Update Javadoc for ALL constant</strong><br/><strong>20d431f79 LargePackedWholeObject#openStream: Suppress resource warning</strong><br/><strong>7575cab53 Upgrade error_prone_core to 2.3.1</strong><br/><strong>cbb2e65db PushProcess: Remove unused import of HashMap</strong><br/><strong>e5ba2c9bd DirCache: Use constant from StandardCharsets</strong><br/><strong>ec84767c3 Use Constants.CHARACTER_ENCODING in tests</strong><br/><strong>b0ac5f9c8 LargePackedWholeObject: Refactor to open DfsReader in try-with-resource</strong></pre>
<p>We finally have the information we need. This simple example also shows the importance of good commit messages as they will make the history managed by Git so much more useful and valuable!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>In this example, we didn't have to jump through hoops to get the result we needed; we simply used the power of the log command and its options. As a matter of fact, <kbd>git log</kbd> has almost 200 different arguments, and its help document, reachable with <kbd>git log --help</kbd>, is composed of more than 11,000 words! Now you know what to do during your next long flight without internet access!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">There's more...</h1>
                
            
            
                
<p>What about across repositories? The previous approach can, of course, be scaled with some scripting in order to repeat the operation on a list of repositories, but a better and simpler option is available as a third-party application that leverages the same <kbd>git log</kbd> capabilities we have been exploring thus far: <kbd>git-standup</kbd>.</p>
<p>It can easily be installed with a <kbd>curl</kbd> command:</p>
<pre><strong>curl -L https://raw.githubusercontent.com/kamranahmedse/git-standup/master/installer.sh | sudo sh<br/></strong></pre>
<p>Its source code is available on <kbd>https://github.com/kamranahmedse/git-standup</kbd> and it features several options that will make daily or weekly team meetings much easier to prepare.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p><kbd>git-standup</kbd> is also able to operate on a single repository, and when applied to the previous example, its output looks like this:</p>
<pre><strong>$ git-standup -a "David Pursehouse" -d 30</strong><br/><strong>3d89622d4 - Add API filter for "non-API type FileRepository" in tests (6 days ago) &lt;David Pursehouse&gt;</strong><br/><strong>9fb724f1b - RefDatabase: add hasRefs convenience method (12 days ago) &lt;David Pursehouse&gt;</strong><br/><strong>4dcf2f93d - RefDatabase: Introduce getAllRefs method (2 weeks ago) &lt;David Pursehouse&gt;</strong><br/><strong>57f158632 - RefDatabase: Update Javadoc for ALL constant (2 weeks ago) &lt;David Pursehouse&gt;</strong><br/><strong>20d431f79 - LargePackedWholeObject#openStream: Suppress resource warning (2 weeks ago) &lt;David Pursehouse&gt;</strong><br/><strong>7575cab53 - Upgrade error_prone_core to 2.3.1 (3 weeks ago) &lt;David Pursehouse&gt;</strong><br/><strong>cbb2e65db - PushProcess: Remove unused import of HashMap (4 weeks ago) &lt;David Pursehouse&gt;</strong><br/><strong>e5ba2c9bd - DirCache: Use constant from StandardCharsets (4 weeks ago) &lt;David Pursehouse&gt;</strong></pre>


            

            
        
    </body></html>