<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Installing Docker Locally</h1></div></div></div><p>In this, the first chapter, we are going to look at installing and configuring Docker on the following platforms:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">macOS Sierra</li><li class="listitem" style="list-style-type: disc">Windows 10 Professional</li><li class="listitem" style="list-style-type: disc">Ubuntu 16.04 LTS Desktop</li></ul></div><p>Once installed, we will then look at how you can interact with your local Docker installation.</p><p>Before we start our installation, I would like to take a moment to quickly talk about the version of Docker which we will be installing.</p><p>At the time of writing, Docker 17.03 has just been released and like most updates, introduces new features as well as changes to existing features. This book has been written with this version of Docker so some of the commands listed may not work or have the same effect when using older versions.</p><p>If you already have Docker installed, I would recommend that you check that you are running Docker 17.03 by running the following command:</p><div><pre class="programlisting">
<strong>docker version</strong>
</pre></div><p>If your version of Docker is older that 17.03 then please refer to the upgrade instructions in each of the following sections before proceeding with the rest of the chapters.</p><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Docker for Mac and Windows</h1></div></div></div><p>As we have <a id="id0" class="indexterm"/>already <a id="id1" class="indexterm"/>touched upon in the preface, the version of the Docker Engine we are going to be covering in this book is very much a Linux-based tool, so how does it work on macOS and Windows?</p><p>It is easy to assume that because macOS is an operating system built on-top of a UNIX like kernel called XNU<a id="id2" class="indexterm"/> that Docker will just run as it would do on a Linux machine, unfortunately, a lot of the features which allow Docker to run are not present in the Kernel used by macOS.</p><p>While there is the recently<a id="id3" class="indexterm"/> launched Windows Subsystem for Linux which is currently in beta, Docker for Windows does not currently take advantage of this, meaning that there is even less of a Linux-like kernel for Docker to use.</p><div><div><h3 class="title"><a id="note02"/>Note</h3><p>The Windows Subsystem<a id="id4" class="indexterm"/> for Linux exposes an Ubuntu shell which allows you to run native Linux command-line tools on your Windows installation; for more information, please see <a class="ulink" href="https://msdn.microsoft.com/en-gb/commandline/wsl/about">https://msdn.microsoft.com/en-gb/commandline/wsl/about</a>.</p></div></div><p>So how does Docker for Mac <a id="id5" class="indexterm"/>and Windows work? The latest versions of macOS and Windows 10 Professional ship with hypervisors which are built into the operating systems kernel, macOS has <strong>Hypervisor framework</strong>
<a id="id6" class="indexterm"/> while<a id="id7" class="indexterm"/> Windows 10 uses Hyper-V.</p><div><div><h3 class="title"><a id="note03"/>Note</h3><p>Hypervisor framework allows developers to build applications without the need to install third-party kernel extensions, meaning they can leverage full hardware virtualization but remain purely in user space meaning that virtual machines remain sandboxed as if they were running as a native application. The following URL gives a technical overview: <a class="ulink" href="https://developer.apple.com/reference/hypervisor">https://developer.apple.com/reference/hypervisor</a></p></div></div><p>For Docker for Mac Docker have built their own open source framework which works with the Hypervisor framework called <strong>HyperKit</strong>: you can<a id="id8" class="indexterm"/> find out more about <a id="id9" class="indexterm"/>HyperKit at <a class="ulink" href="https://github.com/docker/HyperKit/">https://github.com/docker/HyperKit/</a>.</p><p>Hyper-V <a id="id10" class="indexterm"/>has been the native hypervisor for Windows-based operating systems since Windows Server 2008; it has also been part of the desktop version of Windows since Windows 8 (Professional and Enterprise editions), it allows users and developers to launch Windows and Linux virtual machines with hardware virtualization in a sandboxed environment. For more information on <a id="id11" class="indexterm"/>Hyper-V, please see <a class="ulink" href="https://www.microsoft.com/en-us/cloud-platform/server-virtualization">https://www.microsoft.com/en-us/cloud-platform/server-virtualization</a>.</p><p>Docker for Mac and Windows uses these native virtualisation technologies to launch a virtual machine running their MobyLinux distribution, MobyLinux is a light-weight distribution based on Alpine <a id="id12" class="indexterm"/>Linux who's only function is to run Docker.</p><div><div><h3 class="title"><a id="note04"/>Note</h3><p>The ISO for Alpine Linux currently weighs in at 26 MB, and a fully functioning minimal installation requires a footprint of ~130MB, while the distribution is extremely small it is as useable and secure as more common Linux distributions. You can find out more at <a class="ulink" href="https://alpinelinux.org/">https://alpinelinux.org/</a>.</p></div></div><p>Docker for Mac and Windows takes care of launching, configuring, and maintaining the virtual machine as well as functions such as networking and mounting filesystems from your local machine to a MobyLinux virtual machine.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec06"/>Docker for Mac</h2></div></div></div><p>Docker for Mac <a id="id13" class="indexterm"/>has the following system requirements; if your machine does not meet them then Docker for Mac will fail to install:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Your Mac must be a 2010 or later model, with support for Intel's hardware support for <strong>memory man</strong><strong>agement unit</strong> (<strong>MMU</strong>)<a id="id14" class="indexterm"/> virtualization.</li><li class="listitem" style="list-style-type: disc">You must be running OS X El Capitan 10.11 or newer. I recommend that you are running the latest macOS.</li><li class="listitem" style="list-style-type: disc">You must have at least 4GB of RAM.</li><li class="listitem" style="list-style-type: disc">Versions of VirtualBox 4.3.30 or lower must NOT be installed as this causes problems with Docker for Mac.</li></ul></div><p>To check that your machine can support Docker for Mac you can run the following command:</p><div><pre class="programlisting">
<strong>sysctl kern.hv_support</strong>
</pre></div><p>This should return a <code class="literal">1</code> when you run the command; this means the virtualization is enabled in your kernel as it is available on your CPU.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Downloading Docker for Mac</h3></div></div></div><p>Docker for Mac is <a id="id15" class="indexterm"/>available<a id="id16" class="indexterm"/> from the following URL:</p><p><a class="ulink" href="https://store.docker.com/editions/community/docker-ce-desktop-mac">https://store.docker.com/editions/community/docker-ce-desktop-mac</a></p><p>I would recommend sticking with the <strong>Stable channel</strong> for now as this is the version we will be installing on remote machines in later chapters. Clicking on <strong>Get Docker for Mac (stable)</strong> will kick off a download of a disk image (DMG) file, once downloaded double-click on the file to mount it.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Installing Docker for Mac</h3></div></div></div><p>Like most <a id="id17" class="indexterm"/>macOS apps, all you have to do is the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Drag the Docker application from the mounted disc image to your applications folder; opening the mounted image in the macOS finder by double clicking on it makes this task easy, as you can see from the following screenshot:<div><img src="img/B06455_01_01.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">Once the application has been copied, you can close the finder window and open your <strong>Applications</strong>, find Docker, and open it:<div><img src="img/B06455_01_02.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">When you open <a id="id18" class="indexterm"/>Docker for the first time you will be walked through the initial installation:<div><img src="img/B06455_01_03.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">Clicking <strong>Next</strong> will tell you that Docker will ask for your password, it needs this to complete the installation.<div><img src="img/B06455_01_04.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">After clicking <a id="id19" class="indexterm"/><strong>OK</strong> and entering your password when prompted a whale icon will appear in the menu bar, and while Docker starts you should see something which looks like the following popup:<div><img src="img/B06455_01_05.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">Clicking<a id="id20" class="indexterm"/> <strong>Got it!</strong> will close the pop-up. You can tell that Docker has started as the small boxes on the whales back in the icon will stop animating; also left-clicking over the icon will bring up a menu which shows the status of your Docker installation:<div><img src="img/B06455_01_06.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">Selecting<a id="id21" class="indexterm"/> <strong>About Docker</strong> from the menu will open the following window:<div><img src="img/B06455_01_07.jpg" alt="Installing Docker for Mac"/></div></li><li class="listitem">Running<a id="id22" class="indexterm"/> the following command in a terminal shows additional information about your Docker installation:<div><pre class="programlisting">docker version</pre></div><p>You should see something like the following output:</p><div><img src="img/B06455_01_08.jpg" alt="Installing Docker for Mac"/></div></li></ol></div><p>As you can see, it gives details on the Docker client which is installed on your macOS host and the MobyLinux virtual machine the client is connecting to.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Docker for Windows</h2></div></div></div><p>Docker for Windows has the <a id="id23" class="indexterm"/>following system requirements; if your machine does not meet them then Docker for Windows will inform you before exiting:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You must be running a 64bit Windows 10 Pro, Enterprise and Education (1511 November update, build 10586 or later) installation or later (there are plans to support other versions in the future)</li><li class="listitem" style="list-style-type: disc">Hyper-V must be enabled, though the installer will enable it for you if needed</li><li class="listitem" style="list-style-type: disc">You must have at least 4GB of RAM</li></ul></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Downloading Docker for Windows</h3></div></div></div><p>Docker for Windows <a id="id24" class="indexterm"/>is available<a id="id25" class="indexterm"/> from the following URL:</p><p><a class="ulink" href="https://store.docker.com/editions/community/docker-ce-desktop-windows">https://store.docker.com/editions/community/docker-ce-desktop-windows</a></p><p>Like Docker for Mac, I would recommend sticking with the <strong>Stable channel</strong>. Clicking on <strong>Get Docker for Windows (stable)</strong> will download an installer; once the installer has finished downloading, you will be given the option to <strong>Run</strong> it.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Installing Docker for Windows</h3></div></div></div><p>When the Docker<a id="id26" class="indexterm"/> for Windows installer first opens, you will be greeted by the Docker License Agreement:</p><div><img src="img/B06455_01_11.jpg" alt="Installing Docker for Windows"/></div><p>Clicking <a id="id27" class="indexterm"/>
<strong>I accept the terms of the License Agreement</strong> will enable the <strong>Install</strong> button, clicking <strong>Install</strong> with immediately start the installation.</p><p>After a minute or two, you should receive confirmation that the installation has been completed.</p><div><img src="img/B06455_01_13.jpg" alt="Installing Docker for Windows"/></div><p>Making sure <a id="id28" class="indexterm"/>that <strong>Launch Docker</strong> is ticked (it should be by default), click on <strong>Finish</strong> to open Docker. If you do not have Hyper-V enabled, then you will receive the following prompt:</p><div><img src="img/B06455_01_14.jpg" alt="Installing Docker for Windows"/></div><p>Clicking<a id="id29" class="indexterm"/> <strong>Ok</strong> will reboot your computer so ensure that you have saved any open documents you may have. Once rebooted, Docker should launch automatically, and like Docker for Mac, you will notice that there is an icon of a whale in your menu bar:</p><div><img src="img/B06455_01_15.jpg" alt="Installing Docker for Windows"/></div><p>Once Docker has started, selecting <strong>About Docker</strong> from the menu will open the following window:</p><div><img src="img/B06455_01_16.jpg" alt="Installing Docker for Windows"/></div><p>Finally, <a id="id30" class="indexterm"/>open Windows PowerShell and entering the following command:</p><div><pre class="programlisting">
<strong>docker version</strong>
</pre></div><p>This will return similar information on Docker for Mac, showing both the client information and details on the MobyLinux virtual machine:</p><div><img src="img/B06455_01_17.jpg" alt="Installing Docker for Windows"/></div><p>There is one more <a id="id31" class="indexterm"/>thing with Docker for Windows: you can run native Windows containers. You can enable this feature by selecting the <strong>Switch to Windows containers …</strong> option from the menu; if it is your first time enabling this feature then you will get the following dialog popup:</p><div><img src="img/B06455_01_18.jpg" alt="Installing Docker for Windows"/></div><p>Clicking <strong>Ok</strong> will reboot your machine. Once rebooted, selecting the menu option again will switch you over from using Linux to Windows; this is reflected when you run the following:</p><div><pre class="programlisting">
<strong>docker version</strong>
</pre></div><div><img src="img/B06455_01_19.jpg" alt="Installing Docker for Windows"/></div><p>As you can see, the <a id="id32" class="indexterm"/>server <strong>OS/Arch</strong> has changed from <strong>linux/amd64</strong> to <strong>windows/amd64</strong>. We will not be looking at Windows containers in this book; you can change back to Linux containers by using the menu option:</p><div><img src="img/B06455_01_20.jpg" alt="Installing Docker for Windows"/></div><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>If you have any problems running the commands in later chapters on Docker for Windows, check that you are using Linux containers by running <code class="literal">docker version</code> or using the menu.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Upgrading Docker for Mac and Windows</h2></div></div></div><p>Both Docker for Mac <a id="id33" class="indexterm"/>and Windows allow you to easily update your installed<a id="id34" class="indexterm"/> version of Docker. If you have an old version of Docker for Mac or Windows installed, you should have been prompted that there is a later version of Docker available when you first open Docker. I you haven't had a prompt then selecting <strong>Check for Updates…</strong> from the menu will kick off the upgrade process, which is similar to the installation process we have already covered for each of the versions.</p><p>If there are no updates, then you will receive a notification confirming you are on the latest version.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Docker on Ubuntu 16.04</h1></div></div></div><p>If you have been looking at the Docker website, you <a id="id35" class="indexterm"/>will notice that there is not a Docker for Linux Desktop download, that is because there is no need for one. Docker is a Linux tool and will run natively on most Linux desktops and servers.</p><p>While Docker is available in the main Ubuntu repositories, I would recommend installing Docker using the official repository. You can do this by running the following command:</p><div><pre class="programlisting">
<strong>curl -sSL https://get.docker.com/ | sh</strong>
</pre></div><p>This will configure and install the latest version of Docker Engine. Once installed, you will receive a command to run to give your user permission to run Docker, run the command and then log out.</p><p>When you log back in, you will be able to run the following command:</p><div><pre class="programlisting">
<strong>docker version</strong>
</pre></div><p>You should see something like the following:</p><div><img src="img/B06455_01_21.jpg" alt="Docker on Ubuntu 16.04"/></div><div><div><h3 class="title"><a id="note05"/>Note</h3><p>One thing I haven't mentioned so far is that when we installed Docker for Mac and Windows two additional components were installed. These were Docker Machine and Docker Compose, we will be covering these in <a class="link" href="ch02.html" title="Chapter 2. Launching Applications Using Docker">Chapter 2</a>, <em>Launching Applications Using Docker</em> and <a class="link" href="ch03.html" title="Chapter 3. Docker in the Cloud">Chapter 3</a>, <em>Docker in the Cloud</em>.</p></div></div><p>To install Docker<a id="id36" class="indexterm"/> Machine run the following commands:</p><div><pre class="programlisting">
<strong>curl -L "https://github.com/docker/machine/releases/download/v0.9.0/docker-machine-$(uname -s)-$(uname -m)" -o /</strong>
<strong>tmp/docker-machine</strong>
<strong>chmod +x /tmp/docker-machine</strong>
<strong>sudo cp /tmp/docker-machine /usr/local/bin/docker-machine</strong>
</pre></div><p>To install Docker Compose, run the following commands:</p><div><pre class="programlisting">
<strong>curl -L "https://github.com/docker/compose/releases/download/1.</strong>
<strong>10.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</strong>
<strong>chmod +x /tmp/docker-compose</strong>
<strong>sudo cp /tmp/docker-compose /usr/local/bin/docker-compose</strong>
</pre></div><p>Once installed you should be able to run the following two commands:</p><div><pre class="programlisting">
<strong>docker-compose version</strong>
<strong>docker-machine version</strong>
</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Testing your installation</h1></div></div></div><p>Now that we have Docker<a id="id37" class="indexterm"/> installed, we are going to quickly test our installation by downloading, running and connecting to a NGINX container.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>NGINX is a free, open source, high-performance HTTP server and reverse proxy. NGINX is known for its high performance, stability, rich feature set, simple configuration, and low resource consumption.</p></div></div><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p><strong>A note on Docker commands</strong></p><p>Docker 1.13 introduced <a id="id38" class="indexterm"/>a slightly altered set of command line instructions for interacting with containers and images. As this syntax will eventually become the new standard we will be using it throughout this book. For more information on the CLI restructure, please see the Docker 1.13 announcement blog post at <a class="ulink" href="https://blog.docker.com/2017/01/whats-new-in-docker-1-13/">https://blog.docker.com/2017/01/whats-new-in-docker-1-13/</a></p></div></div><p>To download and launch the container all you need to do run the following commands from your terminal prompt;</p><div><pre class="programlisting">
<strong>docker image pull nginx</strong>
<strong>docker container run -d --name nginx-test -p 8080:80 nginx</strong>
</pre></div><p>The first command pulls the NGINX container image from the Docker Hub, and the second command launches our NGINX container, naming it <code class="literal">nginx-test</code> mapping port <code class="literal">8080</code> on your machine to port <code class="literal">80</code> on the container.</p><p>You can check that the container is running using the following command:</p><div><pre class="programlisting">
<strong>docker container ps</strong>
</pre></div><p>Opening your browser and going to <code class="literal">http://localhost:8080/</code> should show you the default <strong>Welcome to NGINX</strong> page.</p><p>As you can see from the following screens, the process is the same when using Docker for Mac:</p><div><img src="img/B06455_01_23.jpg" alt="Testing your installation"/></div><p>Docker for <a id="id39" class="indexterm"/>Windows:</p><div><img src="img/B06455_01_24.jpg" alt="Testing your installation"/></div><p>Or Docker on Ubuntu 16.04:</p><div><img src="img/B06455_01_25.jpg" alt="Testing your installation"/></div><p>As you can see from the screens above, the result of us running the same command on each of the three platforms is exactly the same.</p><p>Once you have tested launching a container you can tidy up afterwards by running the following commands to stop and remove the container and then delete the image:</p><div><pre class="programlisting">
<strong>docker container stop nginx-test</strong>
<strong>docker container rm nginx-test</strong>
<strong>docker image rm nginx</strong>
</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Summary</h1></div></div></div><p>In this chapter, we have worked through installing Docker for Mac, Docker for Windows and Docker on Ubuntu 16.04. Hopefully, you will have followed along with one or more of the installations on your local machine. We have also launched our first container and connected to it using our web browser.</p><p>In the next chapter, we will go into a lot more detail on the commands we used to launch our test container as well as using Docker Compose to launch multi-container applications.</p></div></body></html>