<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Customizing the UI</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Changing the basic look and feel</li><li class="listitem" style="list-style-type: disc">Adding new web sections in the UI</li><li class="listitem" style="list-style-type: disc">Adding new web items in the UI</li><li class="listitem" style="list-style-type: disc">Adding conditions for web fragments</li><li class="listitem" style="list-style-type: disc">Creating new velocity context for web fragments</li><li class="listitem" style="list-style-type: disc">Adding a new drop-down on the top navigation bar</li><li class="listitem" style="list-style-type: disc">Dynamic creation of web items</li><li class="listitem" style="list-style-type: disc">Adding new tabs in the <strong>View</strong> <strong>Issue</strong> screen</li><li class="listitem" style="list-style-type: disc">Adding new tabs in the <strong>Browse</strong> <strong>Project</strong> screen</li><li class="listitem" style="list-style-type: disc">Creating the <strong>Project Tab Panel</strong> using fragments</li><li class="listitem" style="list-style-type: disc">Adding new tabs in the <strong>Browse</strong> <strong>Version</strong> screen</li><li class="listitem" style="list-style-type: disc">Adding new tabs in the <strong>Browse</strong> <strong>Component</strong> screen</li><li class="listitem" style="list-style-type: disc">Extending a webwork action to add UI elements</li><li class="listitem" style="list-style-type: disc">Displaying dynamic notifications/warnings on issues</li><li class="listitem" style="list-style-type: disc">Re-ordering issue operations in the <strong>View</strong> <strong>Issue</strong> page</li><li class="listitem" style="list-style-type: disc">Re-ordering fields in the <strong>View</strong> <strong>Issue</strong> page</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec90"/>Introduction</h1></div></div></div><p>One of the good things about JIRA is that it has a simple but powerful user interface. A lot has changed between 3.13.x and 4.1.x in terms of the user interface, and it still continues to be one that keeps the users happy and plugin developers interested.</p><p>While the existing JIRA interface works for many people, there are cases where we need to modify bits and pieces of it, add new UI elements, remove some, and so on.</p><p>Normally, when we think of modifying a web application's user interface, the first thought that comes to our mind is to go and modify the JSPs, VMs, and many others involved. While it is true, in some cases, for JIRA as well, a lot of the user-interface changes can be introduced without even touching the JIRA code. JIRA helps us to do that with the help of a number of UI-related plugin modules.</p><p>In this chapter, we will be looking at various recipes for enhancing the JIRA UI with the various plugin modules available, and also, in some cases, by modifying the JSPs or other files involved.</p><p>Note that the look and feel can be changed to a big extent only by modifying the CSS files and other templates involved. But here we are talking about adding new web fragments, such as new sections and links, in the various parts of the UI without actually modifying the core JIRA files or with little modification of them. If we modify the JIRA files, it should be noted that maintaining the files over various JIRA versions, enabling or disabling of the changes, and so on, would be very difficult and worth considering!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec91"/>Changing the basic look and feel</h1></div></div></div><a id="id1370" class="indexterm"/><a id="id1371" class="indexterm"/><p>As mentioned earlier, any big changes to the look and feel of JIRA can be achieved only by modifying the CSS files, JSPs, templates, and other tools involved. But JIRA lets its administrators make slightly simpler changes like changing the logo, coloring scheme, and so on, with some simple configurations. In this recipe, we will see some examples on how easy it is to make those changes.</p><p>There are mainly four things that can be configured to change JIRA's appearance:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Logo</strong>: Understandably, this is one thing everyone wants to change.</li><li class="listitem" style="list-style-type: disc"><strong>Colors</strong>: JIRA has a nice theme of colors revolving around a theme of blue. But we can easily change these colors to suit our taste or rather the company's taste!</li><li class="listitem" style="list-style-type: disc"><strong>Gadget colors</strong>: For each gadget in JIRA, we can set a different color chosen from a predefined set of colors. We can easily change the predefined list of colors through simple configuration.</li><li class="listitem" style="list-style-type: disc"><strong>Date and Time formats</strong>: The Date and Time formats in JIRA could be modified easily to suit our needs, provided it is a valid format supported by Java's <code class="literal">SimpleDateFormat</code> (<a class="ulink" href="http://download.oracle.com/javase/1.4.2/docs/api/java/text/SimpleDateFormat.html">http://download.oracle.com/javase/1.4.2/docs/api/java/text/SimpleDateFormat.html</a>).</li></ul></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec260"/>How to do it...</h2></div></div></div><p>The following are the steps to make changes to the basic JIRA look and feel.</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to JIRA as an administrator.</li><li class="listitem">Navigate to <strong>Administration</strong> | <strong>Global</strong> <strong>Settings</strong> | <strong>Look</strong> <strong>and</strong> <strong>Feel</strong>.</li><li class="listitem">Click on <strong>Edit</strong> <strong>Configuration</strong>.</li><li class="listitem">Make the changes as appropriate:<div><ol class="orderedlist loweralpha"><li class="listitem"><strong>Logo</strong>: Bundle your new logo as part of the JIRA WAR or drop it under the JIRA installation under the <code class="literal">images</code> folder or another valid directory. Refer to the new logo's URL as a relative path to your new logo within the JIRA installation directory.<p>For example, <code class="literal">/images/logo/mynewlogo.png</code> will refer to the <code class="literal">mynewlogo.png</code> image under the <code class="literal">images/logo</code> folder. Enter the new logo width or height as suitable.</p></li><li class="listitem"><strong>Colors</strong>: Specify the hexadecimal notations (HEX values) of the interested colors if the color scheme needs to be changed.</li><li class="listitem"><strong>Gadget</strong> <strong>colors</strong>: Here also, specify the hexadecimal notations (HEX values) of the interested colors so that gadget users can pick from the new set of colors.</li><li class="listitem"><strong>Date</strong> <strong>and Time</strong> <strong>formats</strong>: Enter the new Date and Time formats, provided it is a valid format supported by Java's <code class="literal">SimpleDateFormat</code> (<a class="ulink" href="http://download.oracle.com/javase/1.4.2/docs/api/java/text/SimpleDateFormat.html">http://download.oracle.com/javase/1.4.2/docs/api/java/text/SimpleDateFormat.html</a>).</li></ol></div></li><li class="listitem">Click on <strong>Update</strong>.</li></ol></div><a id="id1372" class="indexterm"/><a id="id1373" class="indexterm"/><p>Repeat the cycle until the desired result is achieved. We can always get back to the defaults by clicking on <strong>Reset</strong> <strong>Defaults</strong> while editing the configurations.</p><p>With some simple changes, the JIRA UI can look a lot different from how it normally looks. The following screenshot is a small example:</p><div><img src="img/1803-08-01.jpg" alt="How to do it..."/></div><a id="id1374" class="indexterm"/><a id="id1375" class="indexterm"/><p>In this case, the <strong>View</strong> <strong>issue</strong> page will look like the following screenshot:</p><div><img src="img/1803-08-02.jpg" alt="How to do it..."/></div><p>This is a small, yet powerful change!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec92"/>Adding new web sections in the UI</h1></div></div></div><a id="id1376" class="indexterm"/><p>A web <em>fragment</em> is a link or a section of links at a particular location of the JIRA web interface. It can be a menu in JIRA's top navigation bar, a new set of issue operations, or a new section in the <strong>Admin</strong> <strong>UI</strong> section.</p><a id="id1377" class="indexterm"/><a id="id1378" class="indexterm"/><a id="id1379" class="indexterm"/><p>There are two types of plugin modules to add new web fragments in JIRA, namely, the <strong>Web</strong> <strong>Section</strong> plugin module and the <strong>Web</strong> <strong>Item</strong> plugin module. A <strong>Web</strong> <strong>Section</strong> is a collection of links that is displayed together at a particular location of the JIRA user interface. It maybe a group of buttons on the issue operations bar or a set of links separated by lines.</p><p>In this recipe, we will see how to add a new web section to JIRA.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec261"/>How to do it...</h2></div></div></div><p>The following are the steps to add a new web section into JIRA:</p><div><ol class="orderedlist arabic"><li class="listitem">Identify the <em>location</em> where the new sections should be added.<p>JIRA has a lot of identified locations in its user interface and it lets us add new web sections in any of these locations. A complete list of the available locations can be found at <a class="ulink" href="http://confluence.atlassian.com/display/JIRA/Web+Fragments">http://confluence.atlassian.com/display/JIRA/Web+Fragments</a>.</p></li><li class="listitem">Add the new <code class="literal">web-section</code> module into the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;web-section key="jtricks-admin-section" name="JTricks Section" location="system.admin" i18n-name-key="webfragments.admin.jtricks.section" weight="900"&gt;
  &lt;label&gt;J Tricks&lt;/label&gt;
  &lt;description&gt;J Tricks Section Descitption&lt;/description&gt;
  &lt;tooltip&gt;J Tricks - Little JIRA Tricks&lt;/tooltip&gt;
&lt;/web-section&gt;</pre></div></li><li class="listitem">As with all other plugin modules, it has unique module <code class="literal">key</code>. Here, the two other important attributes of the <code class="literal">web-section</code> element are <code class="literal">location</code> and <code class="literal">weight</code>. <code class="literal">location</code> defines the location in the UI where the section should appear and <code class="literal">weight</code> defines the order in which it should appear.<p>In the above example, location is <code class="literal">system.admin</code>, which will create a new web section under the administration screen, just like the existing sections: <strong>Project</strong>, <strong>Global</strong> <strong>Settings</strong>, and so on.</p></li><li class="listitem">The <code class="literal">web-section</code> module also has a set of child elements. The <code class="literal">condition</code> or <code class="literal">conditions</code> element can be used to define conditions, one or more, details of which we will see in the following recipes. The <code class="literal">context-provider</code> element can be used to add a new context provider which will then define the velocity context for the web section. <code class="literal">label</code> is what will be displayed to the user. <code class="literal">param</code> is another element that can be used to define key/value parameters and is handy if we want to use additional custom values from the UI. The <code class="literal">resource</code> element can be used to include resource files like JavaScript or CSS files and the <code class="literal">tooltip</code> element<a id="id1380" class="indexterm"/> will provide a tooltip for the section. <code class="literal">label</code> is the only mandatory element.<p>Elements such as <code class="literal">label</code> and <code class="literal">tooltip</code> can have optional key value parameters, as shown in the following code:</p><div><pre class="programlisting">&lt;label key="some.valid.key"&gt;
  &lt;param name="param0"&gt;$somevariable&lt;/param&gt;
&lt;/label&gt;</pre></div><a id="id1381" class="indexterm"/><a id="id1382" class="indexterm"/><a id="id1383" class="indexterm"/><p>As you can see in the example, label takes a <code class="literal">key/value</code> parameters where the value is dynamically populated from a velocity variable. The <code class="literal">param</code> will be passed to the text as <code class="literal">{0}</code> and will substitute that position in the label. Here, the parameters allow one to insert values into the <code class="literal">label</code> using Java's <code class="literal">MessageFormat</code> syntax, the details of which can be found at <code class="literal">http://download.oracle.com/javase/7/docs/api/java/text/MessageFormat.html</code>.Parameter names must start with <code class="literal">param</code> and will be mapped in alphabetical order to the substitutions in the format string, that is, <code class="literal">param0</code> is <code class="literal">{0}</code>, <code class="literal">param1</code> is <code class="literal">{1}</code>, <code class="literal">param2</code> is <code class="literal">{2</code>}, so on and so forth.</p></li><li class="listitem">Deploy the plugin.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec262"/>How it works...</h2></div></div></div><p>Once the plugin is deployed, we can see that a new section is created in the Admin screen of JIRA, as shown in the following screenshot. The web item is explained in detail in the next recipe.</p><div><img src="img/1803-08-03.jpg" alt="How it works..."/></div><p>We can add the section at many different places just by changing the <code class="literal">location</code> attribute. If we change the location alone to <code class="literal">opsbar-operations</code>, the new section will appear on the <strong>View</strong> <strong>issue</strong> page, as shown in the next screenshot.</p><a id="id1384" class="indexterm"/><a id="id1385" class="indexterm"/><a id="id1386" class="indexterm"/><p>The web item's section attribute must be changed to match the new location as well, that is, <code class="literal">opsbar-operations/jtricks-admin-section</code>.</p><div><img src="img/1803-08-04.jpg" alt="How it works..."/></div><p>Note that the web section label may not always be visible because in some cases the section is used to just group the links. For example, in the case of issue operations, the <a id="id1387" class="indexterm"/>
<a id="id1388" class="indexterm"/>
<a id="id1389" class="indexterm"/>section is just used to group the links together as shown before.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec263"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Adding</em> <em>new</em> <em>web</em> <em>items</em> <em>in</em> <em>the</em> <em>UI</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec93"/>Adding new web items in the UI</h1></div></div></div><a id="id1390" class="indexterm"/><p>A <em>web</em> <em>item</em> is a new link that can be added at various places in the JIRA UI. A link will typically go under a <em>web</em> <em>section</em>. A link can simply point to a URL or can be used to invoke an action. In this recipe, we will see how to add a new web item to JIRA.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec264"/>How to do it...</h2></div></div></div><a id="id1391" class="indexterm"/><p>The following are the steps to add a new web item into JIRA:</p><div><ol class="orderedlist arabic"><li class="listitem">Identify the <em>web section</em> where the new link should be added.</li><li class="listitem">We have already seen how to create a new web section. A link is then added into a section created as above or into a predefined JIRA section. We can add the link directly to a location if it is a <strong>non-sectioned</strong> one. For <strong>sectioned</strong> locations, it is the location <strong>key</strong>, followed by a slash ('/'), and the <strong>key</strong> of the web section in which it should appear.<p>For example, if we want to place a link in the web section created before, the section element will have the value <code class="literal">system.admin/jtricks-admin-section</code>.</p></li><li class="listitem">Add the new web item module into the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;web-item key="jtricks-admin-link" name="JTricks Link" section="system.admin/jtricks-admin-section" i18n-name-key="webfragments.admin.jtricks.item" weight="10"&gt;
  &lt;label&gt;J Tricks Website&lt;/label&gt;
  &lt;link linkId="jtricks.admin.link"&gt;http://www.j-tricks.com&lt;/link&gt;
&lt;/web-item&gt;</pre></div><p>A Web item module also has a unique <code class="literal">key</code>. The other two important attributes of a web-item are <code class="literal">section</code> and <code class="literal">weight</code>. <code class="literal">section</code> defines the web section where the link is placed, as mentioned above, and <code class="literal">weight</code> defines the order in which the link will appear.</p><p>A web item also has all the elements of a web section: <code class="literal">condition</code>/<code class="literal">conditions</code>, <code class="literal">context</code>-<code class="literal">provider</code>, <code class="literal">description</code>, <code class="literal">param</code>, <code class="literal">resource</code>, and <code class="literal">toolitp</code>. In addition, a web item also has a <code class="literal">link</code> element that defines where the web item should link to. The link could be an action, a direct link, and so on, and can be created using velocity parameters dynamically, as shown in the examples below:</p><div><pre class="programlisting">&lt;link linkId="create_link" absolute="false"&gt;/secure/CreateIssue!default.jspa&lt;/link&gt;
&lt;link linkId="google_link"&gt;http://www.google.com&lt;/link&gt;
&lt;link linkId="profile_link" absolute="false"&gt;/secure/ViewProfile.jspa?name=$user.name&lt;/link&gt;</pre></div><p>In the third example, <code class="literal">user</code> is a variable available in the velocity context!</p><p>An <code class="literal">icon</code> element is used when we need to add an icon alongside the link:</p><div><pre class="programlisting">&lt;icon height="16" width="16"&gt;
  &lt;link&gt;/images/avatar.gif&lt;/link&gt;
&lt;/icon&gt;</pre></div></li><li class="listitem">Deploy the plugin.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec265"/>How it works...</h2></div></div></div><a id="id1392" class="indexterm"/><a id="id1393" class="indexterm"/><a id="id1394" class="indexterm"/><p>Once the plugin is deployed, we can see that a new web item is shown in the web section we created previously under the <strong>Admin</strong> screen of JIRA.</p><div><img src="img/1803-08-03.jpg" alt="How it works..."/></div><p>We can add the item under various different places, just by changing the section attribute. We have seen an example while creating a new issue operation in the previous recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec266"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Adding</em> <em>new</em> <em>web</em> <em>sections</em> <em>in</em> <em>the</em> <em>UI</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec94"/>Adding conditions for web fragments</h1></div></div></div><a id="id1395" class="indexterm"/><a id="id1396" class="indexterm"/><a id="id1397" class="indexterm"/><p>As we saw in the previous recipes, adding a web fragment is pretty easy. However, the job doesn't stop with that always. In many cases, we would want to limit the web item based on a set of conditions.</p><p>For example, an <strong>Edit</strong> <strong>Issue</strong> link should only appear for people with edit permission on an issue. An admin link should appear only if the user is a JIRA Administrator. In this recipe, let us look at how we can implement conditions for displaying web fragments.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec267"/>How to do it...</h2></div></div></div><p>It is possible to add one or more conditions to a web section or a web item. In the latter case, the <code class="literal">conditions</code> element is used, in this case, a collection of <code class="literal">condition/conditions</code> elements and a <code class="literal">type</code> attribute. The type attribute is either the logical <code class="literal">AND</code> or <code class="literal">OR</code>.</p><p>For example, the following condition specifies that the user should have either the <code class="literal">admin</code> permission or <code class="literal">use</code> permission in a project before he/she can see the web fragment that has the following condition:</p><div><pre class="programlisting">&lt;conditions type="OR"&gt;
  &lt;condition class="com.atlassian.jira.plugin.webfragment.conditions.JiraGlobalPermissionCondition"&gt;
    &lt;param name="permission"&gt;admin&lt;/param&gt;
  &lt;/condition&gt;
  &lt;condition class="com.atlassian.jira.plugin.webfragment.conditions.JiraGlobalPermissionCondition"&gt;
    &lt;param name="permission"&gt;use&lt;/param&gt;
  &lt;/condition&gt;
&lt;/conditions&gt;</pre></div><p>Possible values of permission are <code class="literal">admin</code>, <code class="literal">use</code>, <code class="literal">sysadmin</code>, <code class="literal">project</code>, <code class="literal">browse</code>, <code class="literal">create</code>, <code class="literal">edit</code>, <code class="literal">scheduleissue</code>, <code class="literal">assign</code>, <code class="literal">assignable</code>, <code class="literal">attach</code>, <code class="literal">resolve</code>, <code class="literal">close</code>, <code class="literal">comment</code>, <code class="literal">delete</code>, <code class="literal">work</code>, <code class="literal">worklogdeleteall</code>, <code class="literal">worklogdeleteown</code>, <code class="literal">worklogeditall</code>, <code class="literal">worklogeditown</code>, <code class="literal">link</code>, <code class="literal">sharefilters</code>, <code class="literal">groupsubscriptions</code>, <code class="literal">move</code>, <code class="literal">setsecurity</code>, <code class="literal">pickusers</code>, <code class="literal">viewversioncontrol</code>, <code class="literal">modifyreporter</code>, <code class="literal">viewvotersandwatchers</code>, <code class="literal">managewatcherlist</code>, <code class="literal">bulkchange</code>, <code class="literal">commenteditall</code>, <code class="literal">commenteditown</code>, <code class="literal">commentdeleteall</code>, <code class="literal">commentdeleteown</code>, <code class="literal">attachdeleteall</code>, and <code class="literal">attachdeleteown</code>.</p><p>Let us consider a simple example of how to write a condition and display the web items based on it. In this example, we will display a web item in the top navigation bar if, and only if, the user has logged in and belongs to the <code class="literal">jira-developer</code> group. The following are the steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Write the <code class="literal">condition</code> class. The class should extend the <code class="literal">AbstractJiraCondition</code> class and override the following abstract method.<div><pre class="programlisting">public abstract boolean shouldDisplay(User user, JiraHelper jiraHelper);</pre></div></li><li class="listitem">In our example, all we need to check is that the user is not null and is a member of the group <code class="literal">jira-developers</code>. The class is implemented as follows:<div><pre class="programlisting">public class DeveloperCondition extends AbstractJiraCondition {
  @Override
  public boolean shouldDisplay(User user, JiraHelper jiraHelper) {
    return user != null &amp;&amp; user.getGroups().contains("jira-developers");
  }
}</pre></div></li><li class="listitem"><a id="id1398" class="indexterm"/><a id="id1399" class="indexterm"/><a id="id1400" class="indexterm"/>Add the new condition class in the <code class="literal">web-item</code>:<div><pre class="programlisting">&lt;web-item key="jtricks-condition-menu" name="JTricks Condition Menu" section="system.top.navigation.bar" weight="160"&gt;</pre></div><div><pre class="programlisting">  &lt;description&gt;J Tricks Web site with condition&lt;/description&gt;
  &lt;label&gt;JTricks Conditional Menu&lt;/label&gt;
  &lt;tooltip&gt;J Tricks Web site&lt;/tooltip&gt;
  &lt;link linkId="jtricks-condition-menu"&gt;http://www.j-tricks.com&lt;/link&gt;
  &lt;condition class="com.jtricks.conditions.DeveloperCondition"/&gt;
&lt;/web-item&gt;</pre></div><p>As you can see, the section here is <code class="literal">system.top.navigation.bar</code>, which will place the new link on the Top Navigation bar. But the link will be visible only if the condition <code class="literal">DeveloperCondition</code> returns <code class="literal">true</code>.</p><p>We can easily invert a condition using the <code class="literal">invert</code> flag as follows:</p><div><pre class="programlisting">&lt;condition class="com.jtricks.conditions.DeveloperCondition" invert="true"/&gt;</pre></div><p>This will display the link if the user is not logged in or not in the group of JIRA developers!</p></li><li class="listitem">Deploy the plugin.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec268"/>How it works...</h2></div></div></div><a id="id1401" class="indexterm"/><a id="id1402" class="indexterm"/><a id="id1403" class="indexterm"/><p>Once the plugin is deployed, we can see that the new <strong>JTricks</strong> <strong>Conditional</strong> <strong>Menu</strong> is rendered in the Top Navigation bar only when the user is logged in and in the group of JIRA developers.</p><p>The following screenshot shows the dashboard of a user who is logged in and in the group of JIRA developers:</p><div><img src="img/1803-08-06.jpg" alt="How it works..."/></div><p>If the user is not logged in, the menu is not shown as seen in the following screenshot. In this case, we only have web items that don't have conditions defined for them!</p><div><img src="img/1803-08-07.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec95"/>Creating new velocity context for web fragments</h1></div></div></div><a id="id1404" class="indexterm"/><a id="id1405" class="indexterm"/><a id="id1406" class="indexterm"/><p>As we have mentioned in the previous recipes, it is possible to add velocity variables while constructing a JIRA web fragment. JIRA supports a list of variables by default, which includes <code class="literal">user</code>, <code class="literal">req</code>, <code class="literal">baseurl</code>, and so on. The full list and the details of these variables can be found at <a class="ulink" href="http://confluence.atlassian.com/display/JIRADEV/Web+Fragments#WebFragments-VelocityContext">http://confluence.atlassian.com/display/JIRADEV/Web+Fragments#WebFragments-VelocityContext</a>.</p><p>In this recipe, we will see how to add more variables to the velocity context with the use of the <code class="literal">context-provider</code> element.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec269"/>How to do it...</h2></div></div></div><p>The <code class="literal">context-provider</code> element<a id="id1407" class="indexterm"/> adds to the Velocity context available to the web section and web item modules. Only one <code class="literal">context-provider</code> can be added for an item. The following steps show how we can make use of a context provider:</p><div><ol class="orderedlist arabic"><li class="listitem">Create the new <code class="literal">ContextProvider</code> class.<p>The class must implement <code class="literal">com.atlassian.plugin.web.ContextProvider</code>. To make things easy, it is enough to extend the <code class="literal">AbstractJiraContextProvider</code> class and override the following abstract method in it:</p><div><pre class="programlisting">public abstract Map getContextMap(User user, JiraHelper jiraHelper);</pre></div><p>The following is what the <code class="literal">class</code> looks like if you want to add the full name of the user as a separate variable in the velocity context.</p><div><pre class="programlisting">public class UserContextProvider extends AbstractJiraContextProvider {
  @Override
  public Map getContextMap(User user, JiraHelper helper) {
    return EasyMap.build("userName", user.getFullName());
  }
}</pre></div><p>Please note that the <code class="literal">$user</code> variable is already available in the velocity context of web fragments and so the full name can be retrieved easily using <code class="literal">$user.getFullName()</code>. This is just a simple example of how to use the context providers.</p></li><li class="listitem">Use the variable which is added into the velocity context appropriately while constructing the web section/item.<p>In the example, let us create a new web section with the user's full name in the admin section with a single web item in it to link to the user's website.</p><div><pre class="programlisting">&lt;web-section key="jtricks-admin-context-section" name="JTricks Context Section" location="system.admin" i18n-name-key="webfragments.admin.context.jtricks.section" weight="910"&gt;
  &lt;label&gt;$userName&lt;/label&gt;
  &lt;context-provider class="com.jtricks.context.UserContextProvider" /&gt;
&lt;/web-section&gt;

&lt;web-item key="jtricks-admin-context-link" name="JTricks Context Link" section="system.admin/jtricks-admin-context-section" i18n-name-key="webfragments.admin.context.jtricks.item" weight="10"&gt;
  &lt;label&gt;Website&lt;/label&gt;
  &lt;link linkId="jtricks.admin.context.link"&gt;http://www.j-tricks.com&lt;/link&gt;
&lt;/web-item&gt;</pre></div><p>As you can see, the web section refers to <code class="literal">$userName</code> in its label.</p></li><li class="listitem">Deploy the plugin.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec270"/>How it works...</h2></div></div></div><a id="id1408" class="indexterm"/><a id="id1409" class="indexterm"/><a id="id1410" class="indexterm"/><p>Once the plugin is deployed, we can see that the new web section is created under JIRA Admin UI, as shown in the following screenshot. The <code class="literal">$userName</code> variable is dynamically replaced by the current user's full name.</p><div><img src="img/1803-08-08.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec96"/>Adding a new drop-down menu on the top navigation bar</h1></div></div></div><a id="id1411" class="indexterm"/><a id="id1412" class="indexterm"/><a id="id1413" class="indexterm"/><p>In this recipe, we will show how to use the web section and web-item modules quickly to add a new drop-down menu in JIRA's top navigation bar.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec271"/>How to do it...</h2></div></div></div><p>Here we need a <em>web</em> <em>item</em> first to be placed in the system's top navigation bar and then have a <em>web</em> <em>section</em> declared under it. The web section can then have a list of web items created under it which will then form the links on the drop-down menu.</p><p>Following are the steps to do it:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new web item under the system's top navigation bar:<div><pre class="programlisting">&lt;web-item key="jtricks-menu" name="JTricks Menu" section="system.top.navigation.bar" weight="150"&gt;
  &lt;description&gt;J Tricks Web site&lt;/description&gt;
  &lt;label&gt;J Tricks&lt;/label&gt;
  &lt;tooltip&gt;J Tricks Web site&lt;/tooltip&gt;
  &lt;link linkId="jtricks-menu"&gt;http://www.j-tricks.com&lt;/link&gt;
&lt;/web-item&gt;</pre></div><p>As you can see, the section is <code class="literal">system.top.navigation.bar</code>. It can have a link that is pointed to somewhere, in this case, the JTricks' website. Here, an important thing to notice is that the <code class="literal">linkId</code> should be same as the <code class="literal">key</code>. In this case, both come under <code class="literal">jtricks-menu</code>.</p></li><li class="listitem">Define a web section located under the above web item:<div><pre class="programlisting">&lt;web-section key="jtricks-section" name="JTricks Dropdown" location="jtricks-menu" weight="200"&gt;&lt;/web-section&gt;</pre></div><p>Make sure the location is pointing to the <code class="literal">key</code> of the first web item which is also its <code class="literal">linkId</code>.</p></li><li class="listitem">Now add the various web-items under the above web section.<div><pre class="programlisting">&lt;web-item key="jtricks-item" name="Jtricks Item" section="jtricks-menu/jtricks-section" weight="210"&gt;
  &lt;description&gt;J Tricks Tutorials&lt;/description&gt;
  &lt;label&gt;J Tricks Tutorials&lt;/label&gt;
  &lt;tooltip&gt;Tutorials from J Tricks&lt;/tooltip&gt;
  &lt;link linkId="jtricks.link"&gt;http://www.j-tricks.com/tutorials&lt;/link&gt;
&lt;/web-item&gt;</pre></div><p>Note that the section is pointed to <code class="literal">jtricks-menu/jtricks-section</code>, which is similar to a localized section. Here <code class="literal">jtricks-menu</code> is the key for the first web-item and <code class="literal">jtricks-section</code> is the key for the previous web section.</p></li><li class="listitem">Deploy the plugin.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec272"/>How it works...</h2></div></div></div><a id="id1414" class="indexterm"/><a id="id1415" class="indexterm"/><a id="id1416" class="indexterm"/><p>Once the plugin is deployed, we can see that the new web fragments are created in the top navigation banner. We have a web item, <code class="literal">JTricks</code> <code class="literal">Menu</code>, under which a list of links are grouped into a section, as shown in the following screenshot:</p><div><img src="img/1803-08-09.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec97"/>Dynamic creation of web items</h1></div></div></div><a id="id1417" class="indexterm"/><a id="id1418" class="indexterm"/><p>We have now seen quite a few recipes on how to create web items and place them at different places in the UI. But in all the cases, we knew what links we needed. How about creating these links on the fly?</p><p>In this recipe, we will see how to create web items dynamically.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec273"/>Getting ready</h2></div></div></div><p>Create a new web item, <strong>Favourites</strong>, in the system top navigation bar, as discussed in the previous recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec274"/>How to do it...</h2></div></div></div><p>Let us assume we want to create some links in the system top navigation bar. We have seen the same thing in the previous recipe, but that works only when we know the links in advance. Let us consider a new scenario where the user sees different sets of links when he/she is logged in and not logged in! Here the links change based on the user's status and hence need to be created dynamically.</p><p>The following is a step-by-step process to do the same:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a <strong>Favourites</strong> web section in the system top navigation bar.<div><pre class="programlisting">&lt;web-item key="favourites-menu" name="Favourites Menu" section="system.top.navigation.bar" weight="900"&gt;
  &lt;description&gt;Favourites Menu&lt;/description&gt;
  &lt;label&gt;Favourites&lt;/label&gt;
  &lt;tooltip&gt;My Favourite Links&lt;/tooltip&gt;
  &lt;link linkId="favourites-menu"&gt;http://www.j-tricks.com&lt;/link&gt;
&lt;/web-item&gt;

&lt;web-section key="favourites-section" name="Favourites Dropdown" location="favourites-menu" weight="200"&gt;
&lt;/web-section&gt;</pre></div><p>Here, we did exactly what we saw in the previous recipe. A web-item is created in the top navigation bar under which a web section is created.</p></li><li class="listitem"><a id="id1419" class="indexterm"/><a id="id1420" class="indexterm"/>Define a <strong>simple</strong> <strong>link</strong> <strong>factory</strong> in the <code class="literal">atlassian-plugin.xml</code>. A Simple Link Factory defines a new link factory that creates the set of links dynamically. It always hangs off an already declared web section, <code class="literal">favourites-section</code> in our case.<div><pre class="programlisting">&lt;simple-link-factory key="favourites-factory" name="Favourites Link Factory" section="favourites-menu/favourites-section"  i18n-name-key="jtricks.favourites.factory" weight="10" lazy="true" class="com.jtricks.web.links.FavouritesLinkFactory"/&gt;</pre></div></li><li class="listitem">As you can see, a simple link factory has a unique <code class="literal">key</code> and it points to an already available <code class="literal">location</code>. In our case, the location is <code class="literal">favourites-menu/favourites-section</code>, which is declared in <em>Step</em> <em>1</em>.<p>The most important attribute is the <code class="literal">class</code> attribute, <code class="literal">FavouritesLinkFactory</code>. Also, notice that the attribute <code class="literal">lazy</code> is declared as <code class="literal">true</code> to represent lazy loading.</p><p>Create the <strong>simple</strong> <strong>link</strong> <strong>factory</strong> class. The class should implement the <code class="literal">SimpleLinkFactory</code> interface, as shown:</p><div><pre class="programlisting">public class FavouritesLinkFactory implements SimpleLinkFactory {

  public List&lt;SimpleLink&gt; getLinks(User user, Map&lt;String, Object&gt; arg1) {
    ...
  }

  public void init(SimpleLinkFactoryModuleDescriptor arg0) {
  }
}</pre></div><p>All we need to do is to implement two methods, <code class="literal">getLinks</code> and <code class="literal">init</code>. The <code class="literal">init</code> method needs to be implemented only when you need to initialize anything in your plugin. This will be invoked only once, that is, at JIRA startup.</p><p>The <code class="literal">getLinks</code> method is the actual method that we need to implement.</p></li><li class="listitem"><a id="id1421" class="indexterm"/><a id="id1422" class="indexterm"/>Implement the <code class="literal">getLinks</code> method. In this method, we need to return a collection of links that will be then displayed as a <code class="literal">web-item</code> under the section we defined earlier.<p>Each link we return is an instance of the <code class="literal">SimpleLink</code> class. A <code class="literal">SimpleLink</code> object is the Java representation of a web item we normally declare in the <code class="literal">atlassian-plugin.xml</code>. It has all the same attributes such as the <code class="literal">label</code>, <code class="literal">title</code>, <code class="literal">iconUrl</code>, <code class="literal">style</code>, <code class="literal">url</code>, and an <code class="literal">accesskey</code>.</p><p>The following is the method for our example:</p><div><pre class="programlisting">public List&lt;SimpleLink&gt; getLinks(User user, Map&lt;String, Object&gt; arg1) {
  List&lt;SimpleLink&gt; links = new ArrayList&lt;SimpleLink&gt;();

  if (user != null) {
    links.add(new SimpleLinkImpl("id1", "Favourites 1", "My Favourite One", null, null, "http://www.google.com", null));
     links.add(new SimpleLinkImpl("id2", "Favourites 2", "My Favourite Two", null, null, "http://www.j-tricks.com", null));
   } else {
    links.add(new SimpleLinkImpl("id1", "Favourite Link", "My Default Favourite", null, null, "http://www.google.com", null));
  }
  return links;
}</pre></div><p>Here, we just create different links based on whether the user is null or not. A user is null if he/she is not logged in. As you can see, each link has different attributes mentioned earlier.</p></li><li class="listitem">Package the plugin and deploy it.</li></ol></div><p>The links should now be created dynamically.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec275"/>How it works...</h2></div></div></div><p>Once the plugin is deployed, we can see that the new web fragments are created in the top navigation banner. If the user is not logged in, the <strong>Favourites</strong> menu is shown with the default link, as shown in the following screenshot:</p><div><img src="img/1803-08-10.jpg" alt="How it works..."/></div><a id="id1423" class="indexterm"/><a id="id1424" class="indexterm"/><p>Once the user is logged in, he/she will see a different set of links, as per the <code class="literal">getLinks</code> method.</p><div><img src="img/1803-08-11.jpg" alt="How it works..."/></div><p>The same idea can be used to create dynamic links based on a different criterion, and of course, at various different places in the UI.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec98"/>Adding new tabs in the View Issue screen</h1></div></div></div><p>We have seen how to enhance the UI by adding new sections and links at various locations. In this recipe, we will see how to add a new tab panel under the view issue page, similar to the existing panels such as Comments, Change History, and so on.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec276"/>Getting ready</h2></div></div></div><a id="id1425" class="indexterm"/><a id="id1426" class="indexterm"/><a id="id1427" class="indexterm"/><p>Create a new skeleton plugin using the Atlassian Plugin SDK.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec277"/>How to do it...</h2></div></div></div><p>Adding a new tab panel to the <strong>View</strong> <strong>Issue</strong> page can be done by the<strong> Issue</strong> <strong>Tab Panel</strong> Plugin <strong>Module</strong><a id="id1428" class="indexterm"/>. Following are the steps to create a new issue tab panel that displays some static text with a greeting to the logged-in user.</p><div><ol class="orderedlist arabic"><li class="listitem">Define the <code class="literal">Issue</code> <code class="literal">Tab</code> <code class="literal">Panel</code> in the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;issue-tabpanel key="jtricks-issue-tabpanel" i18n-name-key="issuetabpanel.jtricks.name" name="Issue Tab Panel" class="com.jtricks.JTricksIssueTabPanel"&gt;
  &lt;description&gt;A sample Issue Tab Panel&lt;/description&gt;
  &lt;label&gt;JTricks Panel&lt;/label&gt;
  &lt;resource type="velocity" name="view" location="templates/issue/issue-panel.vm" /&gt;
  &lt;order&gt;100&lt;/order&gt;
  &lt;sortable&gt;true&lt;/sortable&gt;
&lt;/issue-tabpanel&gt;</pre></div><p>Here, the plugin module has a unique <code class="literal">key</code> and should define the <code class="literal">class</code> that implements the tab panel. It also has a list of elements, as explained as follows:</p><div><ol class="orderedlist loweralpha"><li class="listitem"><code class="literal">description</code>: A description of the tab panel</li><li class="listitem"><code class="literal">label</code>: A human-readable label for the panel</li><li class="listitem"><code class="literal">resource</code>: Defines the velocity template that renders the tab panel view</li><li class="listitem"><code class="literal">order</code>: Defines the order in which the panels will appear on the view issue page</li><li class="listitem"><code class="literal">sortable</code>: Defines whether the contents of the panel is sortable or not. For example, sorting comments or the change history elements.</li></ol></div></li><li class="listitem">Implement the <code class="literal">Issue</code> <code class="literal">Tab</code> <code class="literal">Panel</code> class.<p>The class should extend the <code class="literal">AbstractIssueTabPanel</code> class, which in turn implements the <code class="literal">IssueTabPanel</code> interface. We need to implement the <code class="literal">showPanel</code> and <code class="literal">getActions</code> methods.</p><div><ol class="orderedlist loweralpha"><li class="listitem">Implement the <code class="literal">shownPanel</code> method to return <code class="literal">true</code> if the panel can be displayed to the user. This method can have complex logic to check whether the user can see the tab or not, but in the example we have, we just return <code class="literal">true</code>.<div><pre class="programlisting">public boolean showPanel(Issue issue, User remoteUser) {
  return true;
}</pre></div></li><li class="listitem">Implement the <code class="literal">IssueAction</code> classes that need to be returned in the <code class="literal">getActions</code> method. It is in the <code class="literal">Action</code> classes that we populate the velocity context to render the view and also return the time performed to facilitate sorting if <code class="literal">sortable = true.</code><p>In the example, let us create a single <code class="literal">Action</code> class as follows:</p><div><pre class="programlisting">public class JTricksAction extends AbstractIssueAction{
  private final JiraAuthenticationContext authenticationContext;

  public JTricksAction(IssueTabPanelModuleDescriptor 
  descriptor, JiraAuthenticationContext 
  authenticationContext) {
    super(descriptor);
    this.authenticationContext = authenticationContext;
  }

  @Override
  public Date getTimePerformed() {
    return new Date();
  }
  
  @Override
  protected void populateVelocityParams(Map params) {	           params.put("user", this.authenticationContext.getUser().getFullName());
  }
}</pre></div><p>As you can see, the action class must extend the <code class="literal">AbstractIssueAction</code> class, which in turn implements the <code class="literal">IssueAction</code> interface.</p><p>In the <code class="literal">getTimePerformed</code> method, it just returns the current date. <code class="literal">populateVelocityParams</code> is the important method where the velocity context is populated. In our example, we just include the current user's full name with key name as <code class="literal">user</code>.</p></li><li class="listitem">Implement the <code class="literal">getActions</code> method in the <code class="literal">Tab</code> <code class="literal">Panel</code> class to return a list of <code class="literal">IssueActions</code>. In our example, we just return a list that contains the new <code class="literal">JTricksAction</code>.<div><pre class="programlisting">public List getActions(Issue issue, User remoteUser) {
  List&lt;JTricksAction&gt; panelActions = new ArrayList&lt;JTricksAction&gt;();
  panelActions.add(new JTricksAction(descriptor, authenticationContext));	  
  return panelActions;
}</pre></div><p>Here, the <code class="literal">descriptor</code> is an instance variable of the super class. All we do here is create an instance of the <code class="literal">Action</code> class and return a list of such actions.</p><a id="id1429" class="indexterm"/><a id="id1430" class="indexterm"/><a id="id1431" class="indexterm"/></li></ol></div></li><li class="listitem">Create the view template in the location specified earlier.<code class="literal">Hey $user, sample Issue Tab Panel!</code> is all we need and the user here is populated into the context in the <code class="literal">Action</code> class.</li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec278"/>How it works...</h2></div></div></div><a id="id1432" class="indexterm"/><a id="id1433" class="indexterm"/><a id="id1434" class="indexterm"/><p>Once the plugin is deployed, a new tab panel will appear in the <strong>View</strong> <strong>Issue</strong> page, as shown in the following screenshot.</p><p>As you can see, the greeting message there is populated using the velocity context and the attributes in it.</p><div><img src="img/1803-08-12.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec99"/>Adding new tabs in the Browse Project screen</h1></div></div></div><a id="id1435" class="indexterm"/><a id="id1436" class="indexterm"/><a id="id1437" class="indexterm"/><p>In this recipe, we will see how to add a new tab in the <strong>Browse</strong> <strong>Project</strong> screen.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec279"/>Getting ready</h2></div></div></div><p>Create a new skeleton plugin using Atlassian Plugin SDK.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec280"/>How to do it...</h2></div></div></div><p>The following are the steps to create a new project tab panel:</p><div><ol class="orderedlist arabic"><li class="listitem">Define the <code class="literal">Project</code> <code class="literal">Tab</code> <code class="literal">Panel</code> in the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;project-tabpanel key="jtricks-project-panel" i18n-name-key="projectpanels.jtricks.name" name="JTricks Panel" class="com.jtricks.JTricksProjectTabPanel"&gt;
  &lt;description&gt;A sample Project Tab Panel&lt;/description&gt;
  &lt;label&gt;JTricks Panel&lt;/label&gt;
  &lt;order&gt;900&lt;/order&gt;
  &lt;resource type="velocity" name="view" location="templates/project/project-panel.vm" /&gt;
&lt;/project-tabpanel&gt;</pre></div><p>Here, the plugin module has a unique <code class="literal">key</code> and should define the <code class="literal">class</code> that implements the tab panel. It also has a list of elements, as explained as follows:</p><div><ol class="orderedlist loweralpha"><li class="listitem"><code class="literal">description</code>: A description of the tab panel</li><li class="listitem"><code class="literal">label</code>: A human-readable label for the panel</li><li class="listitem"><code class="literal">resource</code>: Defines the velocity template that renders the tab panel view</li><li class="listitem"><code class="literal">order</code>: Defines the order in which the panels will appear on the browse project screen.</li></ol></div></li><li class="listitem">Implement the <code class="literal">Project</code> <code class="literal">Tab</code> <code class="literal">Panel</code> class.<p>The class should extend the <code class="literal">AbstractProjectTabPanel</code> class, which in turn implements the <code class="literal">ProjectTabPanel</code> interface. We need to implement only the <code class="literal">showPanel</code> method.</p><p>The <code class="literal">showPanel</code> method should return <code class="literal">true</code> if the panel can be displayed to the user. This method can have complex logic to check whether the user can see the tab or not, but in the example we have, we just return <code class="literal">true</code>.</p><div><pre class="programlisting">public boolean showPanel(Issue issue, User remoteUser) {
  return true;
}</pre></div></li><li class="listitem">Create the view template in the location specified earlier. The template we defined is as follows:<div><pre class="programlisting">Sample Project Tab Panel from &lt;a href="http://www.j-tricks.com"&gt;J Tricks&lt;/a&gt;</pre></div><p>If we need extra velocity parameters in this context, it can be populated in the <code class="literal">Project</code> <code class="literal">Tab</code> <code class="literal">Panel</code> class by overriding the <code class="literal">createVelocityParams</code> method.</p></li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec281"/>How it works...</h2></div></div></div><a id="id1438" class="indexterm"/><a id="id1439" class="indexterm"/><a id="id1440" class="indexterm"/><p>Once the plugin is deployed, a new tab panel will appear in the <strong>Browse</strong> <strong>Project</strong> page, as shown in the following screenshot:</p><div><img src="img/1803-08-13.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec100"/>Creating Project Tab Panel using fragments</h1></div></div></div><a id="id1441" class="indexterm"/><a id="id1442" class="indexterm"/><a id="id1443" class="indexterm"/><p>We have seen how to create a new <code class="literal">Project</code> <code class="literal">Tab</code> <code class="literal">Panel</code> in the previous recipe. While this works in most cases, sometimes we would like to create the nice fragmented view in JIRA 4.1+. Here, each project tab panel has a list of fragments organized in two columns. We can create the fragments and order them so that they appear in a formatted way on clicking the new tab panel.</p><p>In this recipe, we will see how to create the project tab panel using fragments. Before we start, there are a couple of things worth mentioning.</p><div><ol class="orderedlist arabic"><li class="listitem">We need to use the same package structure, <code class="literal">com.atlassian.jira.plugin.projectpanel.impl</code>, to create the fragment class, as we need to override the protected methods in it.</li><li class="listitem">The components used in creating the fragments are not available in the OSGI v2.0 plugins, and hence we have chosen to go with a v1.0 plugin.</li></ol></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec282"/>How to do it...</h2></div></div></div><p>Following are the steps to create a fragmented <code class="literal">Project</code> <code class="literal">Tab</code> <code class="literal">Panel</code>.</p><div><ol class="orderedlist arabic"><li class="listitem">Add the project tab panel module in <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;project-tabpanel key="jtricks-project-fragment-panel" i18n-name-key="projectpanels.fragments.jtricks.name" name="JTricks Frag Panel" class="com.atlassian.jira.plugin.projectpanel.impl.JTricksFragProjectTabPanel"&gt;	
  &lt;description&gt;A sample Project Tab Panel with fragments&lt;/description&gt;
  &lt;label&gt;JTricks Fragments Panel&lt;/label&gt;
  &lt;order&gt;910&lt;/order&gt;
&lt;/project-tabpanel&gt;</pre></div><p>The attributes and elements are similar to a normal <code class="literal">Project</code> <code class="literal">Tab</code> <code class="literal">Panel</code>, except that it doesn't have a view velocity resource defined. The HTML here is constructed with the help of fragments.</p></li><li class="listitem">Create the fragments needed in the project panel. Let us assume we need two fragments, <code class="literal">FragmentOne</code> and <code class="literal">FragmentTwo</code>, for our example.<p>Each Fragment must extend the <code class="literal">AbstractFragment</code> class. We need to override three methods for a fragment.</p><div><ol class="orderedlist loweralpha"><li class="listitem"><code class="literal">getId</code>: It defines the ID of the fragment, which will also be the name of the velocity template used to render this fragment.</li><li class="listitem"><code class="literal">getTemplateDirectoryPath</code>: It returns the path where the velocity template is placed.</li><li class="listitem"><code class="literal">showFragment</code>: It defines whether the fragment is visible to the user or not.</li></ol></div><p>A fourth method, <code class="literal">createVelocityParams</code>, can be overridden if we need to pass extra parameters to the velocity context. Following is how <code class="literal">FragmentOne</code> looks:</p><div><pre class="programlisting">public class FragmentOne extends AbstractFragment{
  protected static final String TEMPLATE_DIRECTORY_PATH = "templates/project/fragments/";
  public FragmentOne(VelocityManager velocityManager, ApplicationProperties applicationProperites, JiraAuthenticationContext jiraAuthenticationContext) {  
    super(velocityManager, applicationProperites, jiraAuthenticationContext);
  }
  public String getId() {
    return "fragmentone";
  }
  public boolean showFragment(BrowseContext ctx) {
    return true;
  }
  @Override
  protected String getTemplateDirectoryPath() {
    return TEMPLATE_DIRECTORY_PATH;
  }
  @Override
  protected Map&lt;String, Object&gt; createVelocityParams(BrowseContext ctx) {
    Map&lt;String, Object&gt; createVelocityParams = super.createVelocityParams(ctx);
    createVelocityParams.put("user", ctx.getUser().getFullName());
    return createVelocityParams;
  }
}</pre></div><a id="id1444" class="indexterm"/><a id="id1445" class="indexterm"/><a id="id1446" class="indexterm"/><p>Here the velocity template will be <code class="literal">fragmentone.vm</code>, placed under <code class="literal">templates/project/fragments/</code>. The fragment is always shown, but this can be modified to include complex logic. We also add a new variable, <code class="literal">user</code>, to the context which then holds the full name of the current user. Note that user variable is already in the context, but this is just for an example.</p><p><code class="literal">FragmentTwo</code> will be similar, as shown in the next few lines of code:</p><div><pre class="programlisting">public class FragmentTwo extends AbstractFragment {
  protected static final String TEMPLATE_DIRECTORY_PATH = "templates/project/fragments/";
  public FragmentTwo(VelocityManager velocityManager, ApplicationProperties applicationProperites, JiraAuthenticationContext jiraAuthenticationContext) {
    super(velocityManager, applicationProperites, jiraAuthenticationContext);
  }
  public String getId() {
    return "fragmenttwo";
  }
  public boolean showFragment(BrowseContext ctx) {
    return true;
  }
  @Override
  protected String getTemplateDirectoryPath() {
    return TEMPLATE_DIRECTORY_PATH;
  }
}</pre></div><p>Here, the velocity template will be <code class="literal">templates/project/fragments/fragmenttwo.vm</code>. Note that we don't override the <code class="literal">createVelocityParams</code> method here as we don't need any extra parameter in the context.</p></li><li class="listitem"><a id="id1447" class="indexterm"/><a id="id1448" class="indexterm"/><a id="id1449" class="indexterm"/>Create the fragment-based project tab panel class. In our example, the class is <code class="literal">JTricksFragProjectTabPanel</code>. The class must extend the <code class="literal">AbstractFragmentBasedProjectTabPanel</code> class. We need to implement three methods in this class:<div><ol class="orderedlist loweralpha"><li class="listitem"><code class="literal">getLeftColumnFragments</code>: This returns a list of <code class="literal">ProjectTabPanelFragment</code> classes that form to the left column of the panel.</li><li class="listitem"><code class="literal">getRightColumnFragments</code>: This returns a list of <code class="literal">ProjectTabPanelFragment</code> classes that forms to the right column of the panel.</li><li class="listitem"><code class="literal">showPanel</code>: This determines whether the panel can be shown or not.</li></ol></div><p>The class will look like the following:</p><div><pre class="programlisting">public class JTricksFragProjectTabPanel extends AbstractFragmentBasedProjectTabPanel {
  private final FragmentOne fragmentOne;
  private final FragmentTwo fragmentTwo;
  public JTricksFragProjectTabPanel(VelocityManager velocityManager, ApplicationProperties applicationProperites, JiraAuthenticationContext jiraAuthenticationContext) {
    this.fragmentOne = new FragmentOne(velocityManager, applicationProperites, jiraAuthenticationContext);
    this.fragmentTwo = new FragmentTwo(velocityManager, applicationProperites, jiraAuthenticationContext);
  }

  @Override
  protected List&lt;ProjectTabPanelFragment&gt; getLeftColumnFragments(BrowseContext ctx) {
    final List&lt;ProjectTabPanelFragment&gt; frags = new ArrayList&lt;ProjectTabPanelFragment&gt;();
    frags.add(fragmentOne);
    return frags;
  }
  @Override
  protected List&lt;ProjectTabPanelFragment&gt; getRightColumnFragments(BrowseContext ctx) {
    final List&lt;ProjectTabPanelFragment&gt; frags = new ArrayList&lt;ProjectTabPanelFragment&gt;();
    frags.add(fragmentTwo);
    return frags;
  }
  
  public boolean showPanel(BrowseContext ctx) {
    return true;
  }
}</pre></div><p>Here, we just construct the fragment objects and return them to the appropriate column list.</p></li><li class="listitem"><a id="id1450" class="indexterm"/><a id="id1451" class="indexterm"/><a id="id1452" class="indexterm"/>Create the velocity templates for the fragments.<p>In our example, <code class="literal">fragmentone.vm</code> looks like the following:</p><div><pre class="programlisting">&lt;div class="mod-header"&gt;
  &lt;h3&gt;Fragment 1&lt;/h3&gt;
&lt;/div&gt;
&lt;div class="mod-content"&gt;
  &lt;ul class="item-details"&gt;
    &lt;li&gt;Welcome, $user!&lt;/li&gt;
    &lt;li&gt;This is fragment 1.&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;</pre></div><p>Notice the use of <code class="literal">$user</code>, which was populated in the velocity context of the <code class="literal">FragmentOne</code> class. Also, the various <code class="literal">div</code> elements are used for the UI conformance.</p><p>Similarly, <code class="literal">fragmenttwo.vm</code> is as follows:</p><div><pre class="programlisting">&lt;div class="mod-header"&gt;
  &lt;h3&gt;Fragment 2&lt;/h3&gt;
&lt;/div&gt;
&lt;div class="mod-content"&gt;
  &lt;ul class="item-details"&gt;
    &lt;li&gt;This is fragment 2!!&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;</pre></div><p>The only difference is that we don't use the <code class="literal">velocity</code> variable here.</p></li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec283"/>How it works...</h2></div></div></div><a id="id1453" class="indexterm"/><a id="id1454" class="indexterm"/><a id="id1455" class="indexterm"/><p>Once the plugin is deployed, a new fragment-based tab panel will appear in the <strong>Browse</strong> <strong>Project</strong> page, as shown in the following screenshot:</p><div><img src="img/1803-08-14.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec101"/>Adding new tabs in the Browse Version screen</h1></div></div></div><a id="id1456" class="indexterm"/><a id="id1457" class="indexterm"/><a id="id1458" class="indexterm"/><p>In this recipe, we will see how to add a new tab in the <strong>Browse</strong> <strong>Version</strong> screen. This screen holds details of a particular version in JIRA.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec284"/>Getting ready</h2></div></div></div><p>Create a new skeleton plugin using <strong>Atlassian</strong> <strong>Plugin</strong> <strong>SDK</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec285"/>How to do it...</h2></div></div></div><p>The following are the steps to create a new version tab panel. It is much similar to creating a new project tab panel, except for the obvious changes in the files and keywords involved.</p><div><ol class="orderedlist arabic"><li class="listitem">Define the <code class="literal">Version</code> <code class="literal">Tab</code> <code class="literal">Panel</code> in the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;version-tabpanel key="jtricks-version-panel" i18n-name-key="versionpanels.jtricks.name" name="jtricks Version Panel" class="com.jtricks.JTricksVersionTabPanel"&gt;
  &lt;description&gt;A sample Version Tab Panel&lt;/description&gt;
  &lt;label&gt;JTricks Panel&lt;/label&gt;
  &lt;order&gt;900&lt;/order&gt;</pre></div><div><pre class="programlisting">  &lt;resource type="velocity" name="view" location="templates/version/version-panel.vm" /&gt;
&lt;/version-tabpanel&gt;</pre></div><p>Here, the plugin module has a unique <code class="literal">key</code> and should define the <code class="literal">class</code> that implements the tab panel. It also has a list of elements, as explained below:</p><div><ol class="orderedlist loweralpha"><li class="listitem"><code class="literal">description</code>: A description of the tab panel</li><li class="listitem"><code class="literal">label</code>: A human-readable label for the panel</li><li class="listitem"><code class="literal">resource</code>: Defines the velocity template that renders the tab panel view</li><li class="listitem"><code class="literal">order</code>: Defines the order in which the panels will appear on the Browse Version Screen.</li></ol></div></li><li class="listitem"><a id="id1459" class="indexterm"/><a id="id1460" class="indexterm"/><a id="id1461" class="indexterm"/>Implement the <code class="literal">Version</code> <code class="literal">Tab</code> <code class="literal">Panel</code> class.<p>The class should extend the <code class="literal">GenericTabPanel</code> class, which in turn would implement the <code class="literal">TabPanel</code> interface. We need to implement only the <code class="literal">showPanel</code> and <code class="literal">createVelocityParams</code> methods, the latter only if we need to add extra variables into the velocity context.</p><p>The <code class="literal">showPanel</code> method should return true if the panel can be displayed to the user. This method can have complex logic to check whether the user can see the tab or not, but in the example we have, we just return true.</p><div><pre class="programlisting">public boolean showPanel(Issue issue, User remoteUser) {
  return true;
}

Let us just override the createVelocityParams method to add a new variable, user to the velocity context.
@Override
protected Map&lt;String, Object&gt; createVelocityParams(BrowseVersionContext context) {
  Map&lt;String, Object&gt; createVelocityParams = super.createVelocityParams(context);
  createVelocityParams.put("user", context.getUser().getFullName());
  return createVelocityParams;
}</pre></div><p>This variable will now be available on the view template that we are using.</p></li><li class="listitem">Create the view template in the location specified in the plugin descriptor. Let us just create a simple template with a greeting to the current user as follows:<p><strong>Welcome $user, This is your new Version Tab!</strong></p><p>Note that we have used the <code class="literal">$user</code> variable that we populated in the previous step.</p></li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec286"/>How it works...</h2></div></div></div><a id="id1462" class="indexterm"/><a id="id1463" class="indexterm"/><a id="id1464" class="indexterm"/><p>Once the plugin is deployed, a new tab panel will appear in the <strong>Browse</strong> <strong>Version</strong> page, as shown in the next screenshot:</p><div><img src="img/1803-08-15.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec102"/>Adding new tabs in the Browse Component screen</h1></div></div></div><a id="id1465" class="indexterm"/><a id="id1466" class="indexterm"/><a id="id1467" class="indexterm"/><p>In this recipe, we will see how to add a new tab in the <strong>Browse</strong> <strong>Component</strong> screen. This screen holds details of a particular component in JIRA, and the process of adding a new tab is much similar to adding a new version tab or project tab panel.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec287"/>Getting ready</h2></div></div></div><p>Create a new skeleton plugin using <strong>Atlassian</strong> <strong>Plugin</strong> <strong>SDK</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec288"/>How to do it...</h2></div></div></div><p>The following are the steps to create a new component tab panel.</p><div><ol class="orderedlist arabic"><li class="listitem">Define the <code class="literal">Component</code> <code class="literal">Tab</code> <code class="literal">Panel</code> in the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;component-tabpanel key="jtricks-component-panel" i18n-name-key="componentpanels.jtricks.name" name="jtricks Component Panel" class="com.jtricks.JTricksComponentTabPanel"&gt;</pre></div><div><pre class="programlisting">  &lt;description&gt;A sample Component Tab Panel&lt;/description&gt;
  &lt;label&gt;JTricks Panel&lt;/label&gt;
  &lt;order&gt;900&lt;/order&gt;
  &lt;resource type="velocity" name="view" location="templates/component/component-panel.vm" /&gt;
&lt;/component-tabpanel&gt;</pre></div><p>As in the case of a version tab panel, component tab panel also has a unique key and should define the <code class="literal">class</code> that implements the tab panel. It also has a list of elements, as explained below:</p><div><ol class="orderedlist loweralpha"><li class="listitem"><code class="literal">description</code>: A description of the tab panel</li><li class="listitem"><code class="literal">label</code>: A human-readable label for the panel</li><li class="listitem"><code class="literal">resource</code>: Defines the velocity template that renders the tab panel view</li><li class="listitem"><code class="literal">order</code>: Defines the order in which the panels will appear on the Browse Component Screen.</li></ol></div></li><li class="listitem"><a id="id1468" class="indexterm"/><a id="id1469" class="indexterm"/><a id="id1470" class="indexterm"/>Implement the <code class="literal">Component</code> <code class="literal">Tab</code> <code class="literal">Panel</code> class.<p>The class should extend the <code class="literal">GenericTabPanel</code> class, which in turn implements the <code class="literal">ComponentTabPanel</code> interface. We need to implement only the <code class="literal">showPanel</code> method and <code class="literal">createVelocityParams</code> method, the latter only if we need to add extra variables into the velocity context.</p><p>The <code class="literal">showPanel</code> method should return true if the panel can be displayed to the user. This method can have complex logic to check whether the user can see the tab or not, but in the example we have, we just return true.</p><div><pre class="programlisting">public boolean showPanel(Issue issue, User remoteUser) {
  return true;
}</pre></div><p>As in the previous recipe, let us override the <code class="literal">createVelocityParams</code> method to add a new variable, <code class="literal">user</code>, to the velocity context.</p><div><pre class="programlisting">@Override
protected Map&lt;String, Object&gt; createVelocityParams(BrowseVersionContext context) {
  Map&lt;String, Object&gt; createVelocityParams = super.createVelocityParams(context);
  createVelocityParams.put("user", context.getUser().getFullName());
  return createVelocityParams;
}</pre></div><p>This variable will now be available on the view template that we are using.</p></li><li class="listitem">Create the view template in the location specified in the plugin descriptor. Let us create a simple template, as in the previous recipe, as follows:<p><strong>Welcome $user, This is your new Component Tab!</strong></p><p>Note that we have used the $user variable, which we populated in the previous step.</p></li><li class="listitem">Package the plugin and deploy it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec289"/>How it works...</h2></div></div></div><a id="id1471" class="indexterm"/><a id="id1472" class="indexterm"/><a id="id1473" class="indexterm"/><p>Once the plugin is deployed, a new tab panel will appear in the Browse component page, as shown in the following screenshot:</p><div><img src="img/1803-08-16.jpg" alt="How it works..."/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec103"/>Extending a webwork action to add UI elements</h1></div></div></div><p>In the second chapter, we have seen how to extend a webwork action. In this recipe, let us build on it and see how we can add more UI elements to an existing JIRA form.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec290"/>Getting ready</h2></div></div></div><p>Create a skeleton plugin using Atlassian plugin SDK .</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec291"/>How to do it...</h2></div></div></div><a id="id1474" class="indexterm"/><a id="id1475" class="indexterm"/><a id="id1476" class="indexterm"/><p>Let us consider a simple example for explaining this. The clone issue operation in JIRA creates a copy of the original issue with the value of almost all of its fields copied across, barring few fields like issue key, created date, updated date, estimates, number of votes, and so on.</p><p>What if we want to copy across the number of votes on the issue as well? Let us say we want to add a checkbox on the clone issue form, leaving the decision to the user whether to copy the votes across or not. If the user selects the checkbox, votes will be copied across and if not, the cloned issue will be created with 0 votes as it happens in JIRA by default. This example will give a rough idea on adding new UI elements on JIRA forms and using them in the action classes.</p><p>The following is the step-by-step process that can be used to implement our example:</p><div><ol class="orderedlist arabic"><li class="listitem">Override the JIRA web action for <code class="literal">CloneIssue</code> by creating an entry for it in the <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;webwork1 key="clone-issue" name="Clone Issue with new UI elements" class="java.lang.Object"&gt;
  &lt;description&gt;Sample Webwork action with extended UI elements&lt;/description&gt;
  &lt;actions&gt;
    &lt;action name="com.jtricks.web.action.ExtendedCloneIssueDetails" alias="CloneIssueDetails"&gt;
       &lt;view name="input"&gt;/secure/views/extended-cloneissue-start.jsp&lt;/view&gt;
      &lt;view name="error"&gt;/secure/views/extended-cloneissue-start.jsp&lt;/view&gt;
    &lt;/action&gt;
  &lt;/actions&gt;
&lt;/webwork1&gt;</pre></div><p>As we have seen in <a class="link" href="ch02.html" title="Chapter 2. Understanding Plugin Framework">Chapter 2</a>, <em>Understanding</em> <em>Plugin</em> <em>Framework</em>, the alias of the action remains the same as that of the <code class="literal">Clone</code> <code class="literal">Issue</code> action. We have gone for a custom class <code class="literal">ExtendedCloneIssueDetails</code> that extends the JIRA action class <code class="literal">CloneIssueDetails</code>.</p><p>Here, we also use a copy of the original JSP, named as <code class="literal">extended-cloneissue-start.jsp</code>, just to keep track of the modified files. It is entirely possible to modify directly on the JIRA-supplied <code class="literal">cloneissue-start.jsp</code>.</p></li><li class="listitem">Create the new action class extending the original action class. It is also possible to create an entirely new action class, but extending the original action will be easier as it leaves us with the task of only adding the extra bits that are needed.<div><pre class="programlisting">public class ExtendedCloneIssueDetails extends CloneIssueDetails {

  public ExtendedCloneIssueDetails(ApplicationProperties applicationProperties, PermissionManager permissionManager, IssueLinkManager issueLinkManager, IssueLinkTypeManager issueLinkTypeManager, SubTaskManager subTaskManager, AttachmentManager attachmentManager, FieldManager fieldManager, IssueCreationHelperBean issueCreationHelperBean, IssueFactory issueFactory, IssueService issueService) {
  super(applicationProperties, permissionManager, issueLinkManager, issueLinkTypeManager, subTaskManager, attachmentManager, fieldManager, issueCreationHelperBean, issueFactory, issueService);}
  ...
}</pre></div></li><li class="listitem"><a id="id1477" class="indexterm"/><a id="id1478" class="indexterm"/><a id="id1479" class="indexterm"/>Declare a variable for the new field we are going to add in the Clone Issue form. The variable name will be same as the name of the UI element.<p>The variable that we declare should match the type of the UI element. For example, a checkbox will have a Java Boolean as the variable type.</p><div><pre class="programlisting">private boolean cloneVotes = false;</pre></div><p>Different UI elements are mapped to different Java types like text fields to Java String, number fields to Long, and so on.</p></li><li class="listitem">Create getters and setters for the new field.<div><pre class="programlisting">public boolean isCloneVotes() {
  return cloneVotes;
}

public void setCloneVotes(boolean cloneVotes) {
  this.cloneVotes = cloneVotes;
}</pre></div><p>These getter/setter methods will be used to get values to and from the JSPs.</p></li><li class="listitem">Add the new UI element into the JSP. In our case, the JSP is <code class="literal">extended-cloneissue-start.jsp</code>, which is a copy of <code class="literal">cloneissue-start.jsp</code>. The UI element that we add should follow the rules of the templates used in the version of JIRA we are using. This is important as the UI keeps changing between versions.<p>As in JIRA 4.3, the new checkbox can be added as follows:</p><div><pre class="programlisting">&lt;page:applyDecorator name="auifieldgroup"&gt;
  &lt;aui:checkbox label="'Clone Votes?'" name="'cloneVotes'" fieldValue="'true'" theme="'aui'"&gt;
    &lt;aui:param name="'description'"&gt;
      &lt;ww:text name="'Clone the votes on the original issue?'"/&gt;
    &lt;/aui:param&gt;
  &lt;/aui:checkbox&gt;
&lt;/page:applyDecorator&gt;</pre></div><p>Note that the checkbox field has the same <code class="literal">name</code> as that of the class variable in the Action class. The rest of the code revolves around the decorator to use, attributes and elements to be passed, and so on.</p></li><li class="listitem"><a id="id1480" class="indexterm"/><a id="id1481" class="indexterm"/>Capture the checkbox value in the action class when the form is submitted. The value can be retrieved in the class using the getter method. We can now do all the things that we want using the checkbox value.<p>In this case, if the cloneVotes checkbox is checked, the votes field should be copied across from the original issue to the cloned one. As we have seen in the previous chapter while discarding field values during cloning, we can override the <code class="literal">setFields</code> method to do that.</p><div><pre class="programlisting">@Override
protected void setFields() throws FieldLayoutStorageException {
  super.setFields();
  if (isCloneVotes()) {
    getIssueObject().setVotes(getOriginalIssue().getVotes());
  }
}</pre></div><p>The important bit here is that the checkbox value is passed across to the action class behind the scenes and we are using the same to decide whether to copy the votes' values across.</p></li><li class="listitem">Package the plugin, deploy it, and see it in action. Don't forget to copy the modified JSP file to the <code class="literal">/secure/views</code> folder.</li></ol></div><p>An action can be overridden only once. Care must be taken not to override it again in another plugin (might be a third party one), as only one will be picked up.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec292"/>How it works...</h2></div></div></div><p>Once the plugin is deployed and the JSP file is copied across to the right location, we can find the modified UI while cloning an issue. The form will have the new field, <strong>Clone</strong> <strong>Votes?</strong>, as shown in the following screenshot:</p><div><img src="img/1803-08-17.jpg" alt="How it works..."/></div><a id="id1482" class="indexterm"/><a id="id1483" class="indexterm"/><a id="id1484" class="indexterm"/><p>Note that the issue we are cloning has one vote on it. If the cloneVotes field is checked, the cloned issue will have the votes on it, as shown in the following screenshot:</p><div><img src="img/1803-08-18.jpg" alt="How it works..."/></div><a id="id1485" class="indexterm"/><a id="id1486" class="indexterm"/><a id="id1487" class="indexterm"/><p>A similar approach can be used to add any new fields into the JIRA forms and use the fields in the action classes, as required. You can find more information about the various elements and its attributes by looking at the <code class="literal">webwork.tld</code> file, residing in the <code class="literal">WEB-INF/tld/</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec293"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Extending a webwork action in JIRA</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec104"/>Displaying dynamic notifications/warnings on issues</h1></div></div></div><p>JIRA has an interesting feature, the <a id="id1488" class="indexterm"/>Announcement Banner, which can be used to make announcements to its user community via JIRA itself. But sometimes, it isn't enough to satisfy all its users. Power users of JIRA sometimes want to see warnings or notifications while they are viewing an issue based on some attributes of the issue.</p><a id="id1489" class="indexterm"/><a id="id1490" class="indexterm"/><a id="id1491" class="indexterm"/><a id="id1492" class="indexterm"/><p>In this recipe, we will see how to add a warning or error message on an issue based on whether the issue has subtasks or not!</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec294"/>Getting ready</h2></div></div></div><p>Create a Skeleton plugin using Atlassian Plugin SDK. Here also, as in the previous recipe, the core logic is in extending the JIRA action and modifying the existing JSP files.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec295"/>How to do it...</h2></div></div></div><a id="id1493" class="indexterm"/><a id="id1494" class="indexterm"/><a id="id1495" class="indexterm"/><a id="id1496" class="indexterm"/><p>The following are the steps to display warnings/errors based on the number of subtasks on a standard issue type.</p><div><ol class="orderedlist arabic"><li class="listitem">As in the previous recipe, extend the JIRA action (in this case, View action) by adding a webwork module in <code class="literal">atlassian-plugin.xml</code>.<div><pre class="programlisting">&lt;webwork1 key="view-issue" name="View Issue with warning" class="java.lang.Object"&gt;
  &lt;description&gt;View Issue Screen with Warnings&lt;/description&gt;
    &lt;actions&gt;
      &lt;action name="com.jtricks.web.action.ExtendedViewIssue" alias="ViewIssue"&gt;
        &lt;view name="success"&gt;/secure/views/issue/extended-viewissue.jsp&lt;/view&gt;
        &lt;view name="issuenotfound"&gt;/secure/views/issuenotfound.jsp&lt;/view&gt;
        &lt;view name="permissionviolation"&gt;/secure/views/permissionviolation.jsp&lt;/view&gt;
        &lt;command name="moveIssueLink" alias="MoveIssueLink"&gt;
          &lt;view name="error"&gt;/secure/views/issue/viewissue.jsp&lt;/view&gt;
        &lt;/command&gt;
      &lt;/action&gt;
    &lt;/actions&gt;
&lt;/webwork1&gt;</pre></div></li><li class="listitem">Override the action class <code class="literal">ViewIssue</code> with <code class="literal">ExtendedViewIssue</code>, mentioned above, and add a public method to check whether the issue has any subtasks or not. Make sure the method is public so that it can be invoked from the JSP.<div><pre class="programlisting">public boolean hasNoSubtasks(){
  return !getIssueObject().isSubTask() &amp;&amp; getIssueObject().getSubTaskObjects().isEmpty();
}</pre></div></li><li class="listitem">It just checks whether the issue is a subtask or not and returns <code class="literal">true</code> if it is a standard <code class="literal">issuetype</code> and has no subtasks of its own.</li><li class="listitem">Modify the <code class="literal">extended-viewissue.jsp</code> file to add a warning at the top, if the issue has no subtasks. Here we add a condition to check if the public method returns <code class="literal">true</code>, and if so, the warning is added, as shown below:<div><pre class="programlisting">&lt;ww:if test="/hasNoSubtasks() == true"&gt;
  &lt;div class="aui-message warning"&gt;
    &lt;span class="aui-icon icon-warning"&gt;&lt;/span&gt;
    The Issue has no Subtasks!  - WARNING
  &lt;/div&gt;
&lt;/ww:if&gt;</pre></div></li><li class="listitem">As you can see, we have used the JIRA styles to add a warning icon and a warning div container.</li><li class="listitem">Package the plugin and deploy it to see it in action.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec296"/>How it works...</h2></div></div></div><a id="id1497" class="indexterm"/><a id="id1498" class="indexterm"/><a id="id1499" class="indexterm"/><a id="id1500" class="indexterm"/><p>Once the plugin is deployed, if a standard issue has no subtasks, the user will see a warning, as shown below, if the warning code was added immediately after the summary field.</p><div><img src="img/1803-08-19.jpg" alt="How it works..."/></div><p>Just by modifying the CSS to add error styles, the message will appear as shown:</p><div><pre class="programlisting">&lt;ww:if test="/hasNoSubtasks() == true"&gt;
  &lt;div class="aui-message error"&gt;
    &lt;span class="aui-icon icon-error"&gt;&lt;/span&gt;
    The Issue has no Subtasks! - ERROR
  &lt;/div&gt;
&lt;/ww:if&gt;</pre></div><div><img src="img/1803-08-20.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec297"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a id="id1501" class="indexterm"/><a id="id1502" class="indexterm"/><a id="id1503" class="indexterm"/><a id="id1504" class="indexterm"/><em>Extending</em> <em>a</em> <em>webwork</em> <em>action</em> <em>in</em> <em>JIRA</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec105"/>Re-ordering Issue Operations in the View Issue page</h1></div></div></div><a id="id1505" class="indexterm"/><a id="id1506" class="indexterm"/><a id="id1507" class="indexterm"/><p>In the previous chapter, we have seen how to create new issue operations. All the existing issue operations in JIRA have a predefined order associated with it. Currently, in JIRA, the actions are ordered as shown in the following screenshot:</p><div><img src="img/1803-08-21.jpg" alt="Re-ordering Issue Operations in the View Issue page"/></div><a id="id1508" class="indexterm"/><a id="id1509" class="indexterm"/><a id="id1510" class="indexterm"/><p>In this recipe, we will see how we can reorder those actions with out actually doing any coding! For example, let us assume we want to move <strong>Delete</strong> option to first in the list and then move the subtask operations up the chart!</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec298"/>How to do it...</h2></div></div></div><p>Following is the step-by-step process to reorder the issue operations:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to the <code class="literal">system-issueoperations-plugin.xml</code> residing under the <code class="literal">WEB-INF/classes</code> folder. This is the file where all the issue operations are defined.</li><li class="listitem">Modify the <code class="literal">weight</code> attribute on the relevant plugin modules to order them.<p><code class="literal">weight</code> is the attribute that defines the order of JIRA web fragments. Issue operations post JIRA 4.1.x are stored as web fragments and hence are reordered using weight.</p><p>Prior to JIRA 4.1, issue operations were defined using Issue Operations plugin module<a id="id1511" class="indexterm"/> instead of <code class="literal">web-items</code>. In those modules, the <code class="literal">order</code> attribute was used to define the ordering, which is an equivalent to the current <code class="literal">weight</code> attribute.</p><a id="id1512" class="indexterm"/><a id="id1513" class="indexterm"/><a id="id1514" class="indexterm"/><p>Lower the <code class="literal">weight</code>, and the item will appear first.</p></li><li class="listitem">Save the file and restart JIRA.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec299"/>How it works...</h2></div></div></div><p>In our example, we wanted the Delete operation to appear first. As 10 is the lowest weight value by default, if we give a weight of 5 to the <code class="literal">delete</code> web section, that is, <code class="literal">operations-delete</code>, it will appear first in the list, as shown below. Similarly, we can reorder every other action, as we have done for the subtask operations as well.</p><div><img src="img/1803-08-22.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec300"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a id="id1515" class="indexterm"/><a id="id1516" class="indexterm"/><a id="id1517" class="indexterm"/><em>Adding</em> <em>new</em> <em>Issue</em> <em>Operations</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec106"/>Re-ordering fields in the View Issue page</h1></div></div></div><a id="id1518" class="indexterm"/><a id="id1519" class="indexterm"/><a id="id1520" class="indexterm"/><p>It is always difficult to satisfy everyone in a big user community and that is what has happened with JIRA's view issue page. While some people love it, some think there are simple improvements possible, resulting in huge customer satisfaction.</p><p>One such thing is the layout of the view issue page. While it is neatly organised in terms of the code, the order in which they appear seems to be a strong contender for change in many cases.</p><p>For example, in the view issue page, the summary of the issue is followed by standard issue fields like Status, Priority, versions, components, and so on. It is then followed by the custom fields and then comes the description of the issue. This can sometimes be a pain, for example, in cases where description is the most important field.</p><p>Following is how the view issue page looks when you have a large custom field:</p><div><img src="img/1803-08-23.jpg" alt="Re-ordering fields in the View Issue page"/></div><p>As you can see, the <code class="literal">Test</code> <code class="literal">Free</code> <code class="literal">Text</code> field has a huge value and the <code class="literal">description</code> field is not present anywhere on the screen. In this recipe, we will see how we can re-order some of the things.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec301"/>How to do it...</h2></div></div></div><a id="id1521" class="indexterm"/><a id="id1522" class="indexterm"/><a id="id1523" class="indexterm"/><p>As we saw in the previous recipe, the view issue action makes use of <code class="literal">/secure/views/issue/viewissue.jsp</code>. If we closely look at the JSP, it is neatly arranged by placing the different section of fields in different JSPs. For example, custom fields, description, attachments, linking, subtasks, and so on, all have different dedicated JSPs and are ordered in a manner that works for most.</p><p>If we want to make <code class="literal">description</code> the very first field on the view issue page, we can do that by just moving the JSP rendering description, that is, <code class="literal">issue_descriptiontable.jsp</code>,  higher up in the order.</p><p>The page will then appear like this:</p><div><img src="img/1803_08_24.jpg" alt="How to do it..."/></div><a id="id1524" class="indexterm"/><a id="id1525" class="indexterm"/><a id="id1526" class="indexterm"/><p>We can even wrap the custom fields in a separate div with the appropriate CSS classes, as shown in the following screenshot. Make sure you don't duplicate the values.</p><div><pre class="programlisting">&lt;div id="details-module" class="module toggle-wrap"&gt;
  &lt;div class="mod-header"&gt;|
     &lt;h3 class="toggle-title"&gt;Custom Fields&lt;/h3&gt;
   &lt;/div&gt;
  &lt;div class="mod-content"&gt;
    &lt;jsp:include page="/includes/panels/issue/view_customfields.jsp" /&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div><div><img src="img/1803-08-25.jpg" alt="How to do it..."/></div><a id="id1527" class="indexterm"/><a id="id1528" class="indexterm"/><a id="id1529" class="indexterm"/><p>Similarly, we can reorder the other UI fragments on JIRA's <strong>View</strong> <strong>Issue</strong> page as well!</p></div></div></body></html>