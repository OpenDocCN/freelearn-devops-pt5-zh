# 案例研究

在本章中，我们将通过整个移动 DevOps 过程，从移动应用开发和集成，到持续测试和部署。

我们将使用两个应用程序作为案例研究，展示整个过程：

+   一个基本的 Hello World 图形界面

+   一个 ButtonWidget

# 案例研究 1 - Hello World 图形界面

在这个案例研究中，我们将讨论移动 DevOps 生命周期，并通过一个简单的 Android 应用程序来演示，该应用程序的 MainActivity 中包含一个`Hello World`文本标签。

本研究将简要介绍整个过程，并向您展示一个逐步的工作流。

# 前提条件

由于这些案例研究将涵盖生命周期中的所有步骤，因此无法详细介绍这些主题，也无法解释 IDE 和 Android 开发基础的不同部分。

以下是顺利完成本章所需的最小前提条件。如果您需要更深入理解以下任何主题，请参阅前面的章节：

+   假设您的计算机上已经安装并配置好了 Visual Studio 和 Xamarin，并准备好进行 Android 应用开发。如果您的系统中没有安装 Visual Studio 和 Xamarin，请参考第三章，*使用 Xamarin 进行跨平台移动应用开发*，并首先安装它们。

+   对 Visual Studio 的基本理解。

+   对 Android 开发基础的基本理解。

+   您应该拥有一个可以访问的有效 Git 账户。

让我们按照以下步骤开始，为移动应用开发构建一个完整的实用工作流：

1.  打开 Visual Studio，选择 文件 | 新建 | 项目：

![](img/0adef156-b51c-4ae5-8ab3-30c5f99548a6.png)

1.  在下一个窗口中，从左侧窗格中选择 Android，然后选择 Blank App (Android)。为您的项目命名，并勾选“创建一个新的 Git 仓库”复选框（这将为您的项目创建一个新的 Git 仓库），然后点击确定：

![](img/a50272bb-6a8d-4bd7-9927-a74b4644bf7f.png)

1.  Visual Studio 将为您创建一个名为`HelloWorld`的新项目：

![](img/8790195b-d895-4cc1-b292-b1b1af866b9a.png)

1.  完成后，打开解决方案资源管理器查看项目结构。选择 视图 | 解决方案资源管理器：

![](img/320dbcc4-cc61-4219-b6ab-a04aed94fad2.png)

1.  在解决方案资源管理器中，展开`Resources`文件夹和`layout`文件夹，找到一个名为`Main.axml`的文件。这是布局文件，或者可以说是我们的 MainActivity 的视图：

![](img/90e9a277-33bc-45c8-a177-3d31d88f97c1.png)

1.  双击`Main.axml`打开它。这应该会为您打开布局设计器：

![](img/349c5dd8-f1ea-49f3-b2e2-b080df025fd2.png)

1.  如果您无法在左侧看到工具箱，请前往 视图 | 工具箱 使其显示：

![](img/1fc79b8a-144a-45ae-9935-064c8a71d46b.png)

1.  现在，我们将仅在活动中添加一个文本视图，显示`HelloWorld`。

1.  在左侧的工具箱中，从表单小部件部分选择 Text (Medium)，并将其拖放到 Activity View 中：

![](img/e8a8550d-af30-4b6b-bb6f-9743ab36c66b.png)

1.  双击文本视图并将其文本更改为`Hello World`：

![](img/da8a089b-6d34-40da-9c5c-003436fb5bee.png)

1.  太棒了，`HelloWorld` 应用程序完成了，现在我们只需构建解决方案，以确保一切正常并准备好在 Android 设备或模拟器上部署。

1.  右键点击解决方案，点击 Build Solution：

![](img/b0558428-e2a7-43a4-a069-9e88b7619dcc.png)

1.  这将为你构建解决方案，完成时，左下角的蓝色条将显示“Build Succeeded”。

1.  若要在模拟器上部署和测试应用程序，请点击顶部工具栏中的 Android Emulator Manager (AVD) 图标：

![](img/9c1f2620-2636-4510-8948-9bb5c01cd9ec.png)

1.  这将打开 Android Emulator Manager，在此你可以从 Visual Studio 提供的列表中选择任何现有的虚拟设备并点击启动按钮：

![](img/c4c96f52-6a83-4d97-a8d3-c8807bc09fa2.png)

1.  然后，在下一个窗口中点击 Launch，而不更改任何配置：

![](img/d46dbe0e-ad83-4e39-9a80-971ecacd534a.png)

1.  这应该会在你的机器上启动一个新的 AVD：

![](img/29b4a1c9-55e3-4b70-b290-264398e18886.png)

1.  现在，在 AVD 启动后返回到 Visual Studio，选择设备并点击播放按钮，将应用程序部署并启动到 AVD 上：

![](img/522131df-442e-42f8-851a-5a4fd18c657f.png)

1.  一旦应用程序部署完成，它将打开在 AVD 上，你应该能在 MainActivity 屏幕上看到你的 Hello World 文本：

![](img/134f64d5-6a15-4249-8f3d-b250cff31b9c.png)

1.  恭喜，你的 HelloWorld 应用程序已经在模拟器上成功运行！

1.  现在是时候将我们新创建的项目推送到 Git 远程仓库了。记住，在创建项目时我们已经创建了本地仓库，所以现在需要将本地仓库连接到远程 Git 仓库，然后推送代码。

1.  在 Visual Studio 中点击右下角的推送图标。这将打开 Team Explorer，如下截图所示：

![](img/7b12e4bf-2550-45e4-b97a-c05c1418888d.png)

1.  现在，在发布之前，我们需要在 GitHub 上创建一个仓库，以连接到这个本地仓库。

1.  访问 GitHub 并登录到你的帐户。

1.  创建一个名为`HelloWorld`的新仓库，并复制该仓库的 URL。

1.  完成后，返回到 Visual Studio 并点击 Publish Git Repo，如前面的截图所示，然后复制仓库链接并点击 Publish：

![](img/41c3402e-1723-4ef7-8094-fd6701e6fa2d.png)

1.  Visual Studio 可能会要求你提供凭证来连接 Git，这是第一次时需要的，但完成后，它应该会将远程仓库与本地仓库配置连接。

1.  之后，点击显示“Changes (2)”的编辑图标，将更改提交到本地。

1.  添加一些提交备注，然后点击 Commit All：

![](img/6105f2e9-4052-4bf0-8d8e-dbe48c07d2d3.png)

1.  接下来，点击同步链接，将您的提交更改与远程存储库共享：

![](img/3b6bc70e-07a4-42a2-a8af-3a83f453795f.png)

1.  在下一页上，点击 Push 以将您的更改推送到 GitHub 远程存储库。

由于该应用程序没有太多需要测试的内容，我们将在下一个案例研究中介绍。

# 案例研究 2 - ButtonWidget

在本案例研究中，我们将创建一个新的 Android 应用程序，该应用程序将在点击时显示一个新的文本视图。我们还将为此应用程序编写 UITest：

1.  在 Visual Studio 中创建一个新的空白 Android 应用程序项目，命名为`ButtonWidget`，然后点击确定：

![](img/44e1124c-48aa-4bbd-b076-a79644b5d102.png)

1.  创建项目后，从解决方案资源管理器中的 Resources | Layout 打开`Main.axml`文件。

1.  然后，从左侧的工具箱中添加一个文本视图和一个按钮到视图中。

1.  为每个 ID 分配标识以便在代码中识别它们。您可以选择它们，然后显示属性窗口，在那里为它们指定 ID：

![](img/9644673b-558e-4368-bf9a-a68fa792e42d.png)

1.  同样，将文本视图的可见性设置为隐藏，因为我们将仅在按钮点击时显示此文本：

![](img/89de4430-dd45-4a53-ac58-7b194ccdea12.png)

1.  现在，从解决方案资源管理器中打开`MainActivity.cs`文件：

![](img/ee70252c-ca55-41d1-bd4a-b9287031cb93.png)

1.  在`MainActivtiy.cs`中，添加代码以在按钮点击时显示文本视图。更改您的代码以匹配以下屏幕截图显示的内容：

![](img/3bbe63a1-8d91-448c-9d64-54e285a1e336.png)

1.  就这样。应用程序的编码部分已完成。现在，将添加文本视图，但在点击按钮之前不会显示在应用程序中。

1.  构建您的应用程序并运行。您会看到应用程序加载时文本视图不可见：

![](img/10ba6cb1-939a-4388-8f25-61079af598c3.png)

1.  现在，点击按钮，查看文本视图是否出现：

![](img/d24641e8-c35a-4913-bb35-cdf2e3c3c097.png)

1.  现在应用程序正常运行，让我们为其编写 Xamarin.UITest 并将其上传到 Xamarin Test Cloud。

1.  将一个新的测试项目添加到解决方案中：

![](img/3565e2ba-8734-433d-9813-3e69d74d84d2.png)

1.  在新增项目窗口中，从左侧窗格点击测试，然后选择 UI 测试应用程序（Xamarin.UITest | Android）。为项目命名，然后点击确定：

![](img/4bcdd9d2-d95a-43a0-affe-3ca4fc6c2775.png)

1.  接下来，我们需要添加对应用程序项目的引用，以便`UITest`项目可以构建和运行应用程序。

1.  在`UITest`项目下右键单击引用，然后点击添加引用：

![](img/0b73f11c-3356-4169-9814-632ddad7a0fa.png)

1.  在接下来的屏幕上，从左侧选择项目，然后选择 ButtonWidget（我们要测试的应用程序项目），然后点击确定：

![](img/38341c66-f34a-4cf2-bd66-13e07bcab24e.png)

1.  我们已准备好开始为 ButtonWidget 应用程序编写测试了。从解决方案资源管理器中的 TestProjectName | Tests.cs 打开`Tests.cs`文件：

![](img/468cda17-f83b-4e41-9f68-56b0278c7f2b.png)

1.  现在，修改代码，在`Tests.cs`文件中添加一个新测试，测试按钮按下时是否显示文本视图：

![](img/b92ab4d2-63aa-4b62-b08b-39ca101d30d1.png)

1.  现在，重新构建并部署解决方案，然后点击“测试 | Windows | 测试资源管理器”：

![](img/b6038ee3-5ba8-4db2-ab76-d3973f5734de.png)

1.  你应该能够在测试资源管理器中看到编写的测试：

![](img/751b7f05-210d-41ef-9aa5-73e6f6d1c66e.png)

1.  点击“运行所有”以运行测试。

1.  现在，要将这些测试上传到 Xamarin Test Cloud，请登录到你的 Xamarin Test Cloud 帐户。

1.  进入帐户设置 | 团队与应用。

1.  点击“新建团队”按钮以创建新团队。

1.  添加成员到团队，然后点击“新建测试运行”。

1.  这将打开一个自引导对话框，我们可以在其中选择平台、选择设备等。

1.  设置操作系统为 Android，并选择你希望的设备，然后进入最后一步。

1.  你将看到如下屏幕，点击命令将测试上传到 Xamarin Test Cloud：

![](img/89bb7340-5521-4a9b-9d5c-2047a7268ebf.png)

1.  在将应用程序上传到 Xamarin Test Cloud 之前，确保在发布构建配置中构建应用程序。

1.  在项目的清单文件中添加互联网权限。

1.  一旦你使用发布版本构建了项目，你就可以准备好将应用程序上传到 Xamarin，并在那里的 UITests 中进行调试。使用前一步的命令，将`Xamarin.UITest.[版本]`修改为你的 UITest 版本，然后输入 APK 文件的完整路径和`UITest`文件夹的相对路径，然后在项目的根目录中运行。

1.  在对命令进行这些更改后，进入根目录，打开命令提示符窗口，并运行命令将 UITests 上传到 Xamarin：

![](img/3d0b9530-5bc8-4527-a5eb-7bc36037e213.png)

1.  通过此操作，应用程序正在部署并在 Xamarin Test Cloud 上进行真实物理设备测试。

1.  你可以使用此命令与 CI 工具一起自动化此过程，作为持续集成和持续测试的一部分。

1.  在返回 Xamarin Test Cloud 的 Web 应用程序后，我们可以看到在选定的设备上测试已通过：

![](img/9189052e-6d35-4595-8823-ca026fad6345.png)

# 总结

在本章中，我们已通过整个应用程序开发、部署、编写测试用例，并通过在 Xamarin Test Cloud 上进行持续测试来测试应用程序的过程。本章使用了两个案例研究，逐步解释了整个过程，从创建一个简单的 Android 项目，到编写 UITests 并使用 Test Cloud 进行持续测试。
