# 前言

开发人员面临着日益增加的压力，需要在高频率下构建、修改、测试和部署高度分布式应用程序。运维工程师正在寻找一个统一的部署策略，涵盖他们日益增长的应用程序组合中的大部分或全部，而利益相关者希望保持其总体拥有成本低廉。Docker 容器结合像 Kubernetes 这样的容器编排器帮助他们实现这些目标。

Docker 容器加速并简化了高度分布式应用程序的构建、交付和运行。容器极大地提升了 CI/CD 流水线的速度，而容器化应用程序使公司能够统一在一个共同的部署平台上，例如 Kubernetes。容器化应用程序更加安全，并且可以在本地或云端的任何能运行容器的平台上运行。

# 本书的受众

本书的目标读者包括系统管理员、运维工程师、DevOps 工程师以及有兴趣从零开始学习 Docker 的开发人员或利益相关者。

# 本书内容涵盖

第一章，*什么是容器，为什么我应该使用它们？*，介绍了容器的概念以及它们在软件行业中的极端实用性。

第二章，*设置工作环境*，详细讨论了如何为开发人员、DevOps 和运营人员设置一个理想的工作环境，用于处理 Docker 容器。

第三章，*精通容器*，详细介绍了如何启动、停止和删除容器。我们还将看到如何检查容器以从中检索额外的元数据。此外，我们还将看到如何运行额外的进程，如何附加到已运行容器中的主进程，并如何检索容器内由其运行的进程产生的日志信息。最后，本章介绍了容器的内部工作原理，包括 Linux 命名空间和组。

第四章，*创建和管理容器镜像*，介绍了创建容器镜像的不同方法，这些镜像作为容器的模板。它介绍了镜像的内部结构及其构建方式。本章还解释了如何将现有的传统应用程序移植到容器中运行。

第五章，*数据卷和配置*，介绍了数据卷，可以供运行在容器中的有状态组件使用。本章还展示了如何为容器内运行的应用程序定义单独的环境变量，以及如何使用包含整套配置设置的文件。

第六章，*调试在容器中运行的代码*，讨论了开发人员常用的技术，这些技术可以让开发人员在容器中运行时演进、修改、调试和测试他们的代码。掌握这些技术后，开发人员将在容器中开发应用时，享受到类似本地开发时的无摩擦开发过程。

第七章，*使用 Docker 提升自动化*，展示了如何使用工具执行管理任务，而无需在主机计算机上安装这些工具。我们还将看到如何使用容器来托管和运行测试脚本或用于测试和验证在容器中运行的应用服务的代码。最后，本章引导我们构建一个简单的基于 Docker 的 CI/CD 流水线。

第八章，*高级 Docker 使用场景*，介绍了在容器化复杂分布式应用程序时，或使用 Docker 自动化复杂任务时，有用的高级技巧、窍门和概念。

第九章，*分布式应用架构*，介绍了分布式应用架构的概念，并讨论了成功运行分布式应用所需的各种模式和最佳实践。最后，它讨论了在生产环境中运行此类应用所需满足的额外要求。

第十章，*单主机网络*，介绍了 Docker 容器的网络模型及其在单主机上的实现方式——桥接网络。本章介绍了软件定义网络的概念，并解释了它们如何用于保护容器化的应用程序。它还讨论了如何将容器端口开放给公众，从而使容器化组件能够从外部世界访问。最后，本章介绍了反向代理工具 Traefik，以实现容器之间的复杂 HTTP 应用层路由。

第十一章，*Docker Compose*，讲解了由多个服务组成的应用程序的概念，每个服务都运行在容器中，以及 Docker Compose 如何通过声明式方法使我们轻松构建、运行和扩展此类应用程序。

第十二章，*编排器*，介绍了编排器的概念。它解释了为什么需要编排器，以及它们的概念性工作原理。本章还将概述最受欢迎的编排器，并列出它们的一些优缺点。

第十三章，*Docker Swarm 简介*，介绍了 Docker 的原生编排工具 SwarmKit。我们将了解 SwarmKit 用于在本地或云中部署和运行分布式、弹性、稳健和高可用应用程序的所有概念和对象。本章还介绍了 SwarmKit 如何利用软件定义网络确保应用程序的安全性，以隔离容器，并通过机密保护敏感信息。此外，本章展示了如何在云中安装高可用的 Docker Swarm。它介绍了路由网格，提供了第 4 层路由和负载均衡。最后，本章展示了如何将由多个服务组成的应用程序部署到 Swarm 中。

第十四章，*零停机部署和机密*，解释了如何将服务或应用程序部署到 Docker Swarm 上，实现零停机和自动回滚功能。它还介绍了机密作为保护敏感信息的手段。

第十五章，*Kubernetes 简介*，介绍了当前最流行的容器编排工具 Kubernetes。它介绍了用于定义和运行分布式、弹性、稳健和高可用应用程序的 Kubernetes 核心对象。最后，它介绍了 MiniKube，作为本地部署 Kubernetes 应用程序的方式，以及 Kubernetes 与 Docker for Mac 和 Docker for Windows 的集成。

第十六章，*使用 Kubernetes 部署、更新和保护应用程序*，解释了如何将应用程序部署、更新和扩展到 Kubernetes 集群中。它还解释了如何通过活性探针和就绪探针为应用程序服务提供支持，以帮助 Kubernetes 进行健康检查和可用性检查。此外，本章还介绍了如何实现零停机部署，以便对关键任务应用程序进行无中断的更新和回滚。最后，本章介绍了 Kubernetes 机密，作为配置服务和保护敏感数据的手段。

第十七章，*在生产环境中监控和排除应用程序故障*，教授了在 Kubernetes 集群中监控单个服务或整个分布式应用程序的不同技术。它还展示了如何在不改变集群或集群节点的情况下，排除生产环境中运行的应用程序服务的故障。

第十八章，*在云中运行容器化应用程序*，概述了在云中运行容器化应用程序的一些最流行方式。我们包括自托管和托管解决方案，并讨论了它们的优缺点。还简要讨论了微软 Azure 和谷歌云引擎等供应商的完全托管服务。

# 为了最大程度地利用本书

期望读者对分布式应用架构有一定了解，并有兴趣加速和简化构建、交付和运行高度分布式应用的过程。无需具备 Docker 容器的先前经验。

强烈推荐使用安装了 Windows 10 Professional 或 macOS 的电脑。该电脑应至少有 16GB 内存。

| **书中涉及的软件/硬件** | **操作系统要求** |
| --- | --- |
| Docker for Desktop, Docker Toolbox, Visual Studio Code, Powershell 或 Bash 终端。 | Windows 10 Pro/macOS/Linux，最低 8GB 内存 |

**如果你使用的是本书的数字版，我们建议你自己输入代码，或通过 GitHub 仓库访问代码（链接将在下一部分提供）。这样可以帮助你避免与代码复制/粘贴相关的潜在错误。**

# 下载示例代码文件

你可以从你的账户在[www.packt.com](http://www.packt.com)下载本书的示例代码文件。如果你在其他地方购买了本书，可以访问[www.packtpub.com/support](https://www.packtpub.com/support)，并注册以便直接将文件通过邮件发送给你。

你可以通过以下步骤下载代码文件：

1.  在[www.packt.com](http://www.packt.com)上登录或注册。

1.  选择“支持”标签。

1.  点击“代码下载”。

1.  在搜索框中输入书名，并按照屏幕上的指示操作。

下载文件后，请确保使用以下最新版本的软件解压或提取文件夹：

+   WinRAR/7-Zip for Windows

+   Zipeg/iZip/UnRarX for Mac

+   7-Zip/PeaZip for Linux

本书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Learn-Docker---Fundamentals-of-Docker-19.x-Second-Edition`](https://github.com/PacktPublishing/Learn-Docker---Fundamentals-of-Docker-19.x-Second-Edition)。如果代码有更新，它将会在现有的 GitHub 仓库中更新。

我们还提供来自我们丰富的书籍和视频目录中的其他代码包，网址是**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**。快来看看吧！

# 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的截图/图表的彩色图像。你可以在这里下载： [`www.packtpub.com/sites/default/files/downloads/9781838827472_ColorImages.pdf`](http://www.packtpub.com/sites/default/files/downloads/9781838827472_ColorImages.pdf)。

# 使用的约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。示例：“Docker 主机上的容器运行时由`containerd`和`runc`组成。”

一段代码如下所示：

```
{
  "name": "api",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

当我们希望引起你对代码块中特定部分的注意时，相关行或项目将以粗体显示：

```
ARG BASE_IMAGE_VERSION=12.7-stretch
FROM node:${BASE_IMAGE_VERSION}
WORKDIR /app
COPY packages.json .
RUN npm install
COPY . .
CMD npm start
```

任何命令行输入或输出均如下所示：

```
$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

**粗体**：表示新术语、重要单词或屏幕上显示的词语。例如，菜单或对话框中的词语在文本中会这样显示。举个例子：“从管理面板中选择 System info。”

警告或重要说明如下所示。

小贴士和技巧如下所示。

# 联系我们

我们欢迎读者提供反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中注明书名，并通过`customercare@packtpub.com`与我们联系。

**勘误表**：尽管我们已经尽力确保内容的准确性，但错误是难以避免的。如果您发现本书中有错误，欢迎向我们报告。请访问 [www.packtpub.com/support/errata](https://www.packtpub.com/support/errata)，选择您的书籍，点击勘误提交表单链接，并填写相关信息。

**盗版**：如果您在互联网上遇到任何非法复制的我们的作品，感谢您提供相关的网址或网站名称。请通过`copyright@packt.com`与我们联系，并附上该材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且有意写书或为书籍贡献内容，请访问 [authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下您的评论。在阅读并使用本书后，为什么不在您购买书籍的站点上留下评论呢？潜在的读者可以通过您的客观意见做出购买决策，我们在 Packt 可以了解您对我们产品的看法，作者们也能看到您对他们书籍的反馈。感谢您的支持！

如需了解更多关于 Packt 的信息，请访问 [packt.com](http://www.packt.com/)。
